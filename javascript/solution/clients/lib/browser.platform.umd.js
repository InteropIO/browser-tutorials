!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).IoConnectBrowserPlatform=t()}(this,(function(){"use strict";const global=window;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function __rest$4(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function __awaiter$7(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))}function __rest$2$1(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function __awaiter$1$1(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))}const defaultConfig={logger:"info",gateway:{webPlatform:{}},libraries:[],exposeAPI:!0},parseConfig=e=>{var t,n,r;const i=!!(null===(n=null===(t=null==e?void 0:e.gateway)||void 0===t?void 0:t.webPlatform)||void 0===n?void 0:n.port),o=Object.assign({},defaultConfig,e,{isPlatformInternal:i});return o.systemLogger&&(o.logger=null!==(r=o.systemLogger.level)&&void 0!==r?r:"info"),o},checkSingleton=()=>{const e=window.glue42core||window.iobrowser;if(e&&e.webStarted)throw new Error("IoConnect Browser has already been started for this application.");e?e.webStarted=!0:window.iobrowser={webStarted:!0}},enterprise=e=>{var t,n,r;const i={windows:!0,layouts:"full",appManager:"full",channels:!0,libraries:null!==(t=null==e?void 0:e.libraries)&&void 0!==t?t:[],logger:null!==(r=null===(n=null==e?void 0:e.systemLogger)||void 0===n?void 0:n.level)&&void 0!==r?r:"warn"};return(window.IODesktop||window.Glue)(i)};var ok$1$1=function(e){return{ok:!0,result:e}},err$1$1=function(e){return{ok:!1,error:e}},asPromise$1$1=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},withDefault$1$1=function(e,t){return!0===t.ok?t.result:e},withException$1$1=function(e){if(!0===e.ok)return e.result;throw e.error},map$1$1=function(e,t){return!0===t.ok?ok$1$1(e(t.result)):t},map2$1$1=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:ok$1$1(e(t.result,n.result))},mapError$1$1=function(e,t){return!0===t.ok?t:err$1$1(e(t.error))},andThen$1$1=function(e,t){return!0===t.ok?e(t.result):t},__assign$2$1=function(){return __assign$2$1=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign$2$1.apply(this,arguments)};function __rest$1$1(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function isEqual$1$1(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!=typeof t)return!1;if("object"==typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!isEqual$1$1(e[n],t[n]))return!1;return!0}var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(n=0;n<r.length;n++){if(!t.hasOwnProperty(r[n]))return!1;if(!isEqual$1$1(e[r[n]],t[r[n]]))return!1}return!0}}var isJsonArray$1$1=function(e){return Array.isArray(e)},isJsonObject$1$1=function(e){return"object"==typeof e&&null!==e&&!isJsonArray$1$1(e)},typeString$1$1=function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}},expectedGot$1$1=function(e,t){return"expected "+e+", got "+typeString$1$1(t)},printPath$1$1=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},prependAt$1$1=function(e,t){var n=t.at,r=__rest$1$1(t,["at"]);return __assign$2$1({at:e+(n||"")},r)},Decoder$1$1=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return mapError$1$1((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return asPromise$1$1(n.run(e))},this.runWithException=function(e){return withException$1$1(n.run(e))},this.map=function(t){return new e((function(e){return map$1$1(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return andThen$1$1((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,r){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(r)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?ok$1$1(e):err$1$1({message:expectedGot$1$1("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?ok$1$1(e):err$1$1({message:expectedGot$1$1("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?ok$1$1(e):err$1$1({message:expectedGot$1$1("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return isEqual$1$1(e,t)?ok$1$1(t):err$1$1({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(isJsonObject$1$1(e)&&t){var n={};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].decode(e[r]);if(!0!==i.ok)return void 0===e[r]?err$1$1({message:"the key '"+r+"' is required but was not present"}):err$1$1(prependAt$1$1("."+r,i.error));void 0!==i.result&&(n[r]=i.result)}return ok$1$1(n)}return isJsonObject$1$1(e)?ok$1$1(e):err$1$1({message:expectedGot$1$1("an object",e)})}))},e.array=function(t){return new e((function(e){if(isJsonArray$1$1(e)&&t){return e.reduce((function(e,n,r){return map2$1$1((function(e,t){return e.concat([t])}),e,function(e,n){return mapError$1$1((function(e){return prependAt$1$1("["+n+"]",e)}),t.decode(e))}(n,r))}),ok$1$1([]))}return isJsonArray$1$1(e)?ok$1$1(e):err$1$1({message:expectedGot$1$1("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(isJsonArray$1$1(e)){if(e.length!==t.length)return err$1$1({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e[r]);if(!i.ok)return err$1$1(prependAt$1$1("["+r+"]",i.error));n[r]=i.result}return ok$1$1(n)}return err$1$1({message:expectedGot$1$1("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.oneOf.apply(e,[t,n].concat(r))},e.intersection=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e((function(e){return[t,n].concat(r).reduce((function(t,n){return map2$1$1(Object.assign,t,n.decode(e))}),ok$1$1({}))}))},e.anyJson=function(){return new e((function(e){return ok$1$1(e)}))},e.unknownJson=function(){return new e((function(e){return ok$1$1(e)}))},e.dict=function(t){return new e((function(e){if(isJsonObject$1$1(e)){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=t.decode(e[r]);if(!0!==i.ok)return err$1$1(prependAt$1$1("."+r,i.error));n[r]=i.result}return ok$1$1(n)}return err$1$1({message:expectedGot$1$1("an object",e)})}))},e.optional=function(t){return new e((function(e){return null==e?ok$1$1(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e);if(!0===i.ok)return i;n[r]=i.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return err$1$1({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return ok$1$1(withDefault$1$1(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var r=e,i=0;i<t.length;i++){if(void 0===r)return err$1$1({at:printPath$1$1(t.slice(0,i+1)),message:"path does not exist"});if("string"==typeof t[i]&&!isJsonObject$1$1(r))return err$1$1({at:printPath$1$1(t.slice(0,i+1)),message:expectedGot$1$1("an object",r)});if("number"==typeof t[i]&&!isJsonArray$1$1(r))return err$1$1({at:printPath$1$1(t.slice(0,i+1)),message:expectedGot$1$1("an array",r)});r=r[t[i]]}return mapError$1$1((function(e){return void 0===r?{at:printPath$1$1(t),message:"path does not exist"}:prependAt$1$1(printPath$1$1(t),e)}),n.decode(r))}))},e.succeed=function(t){return new e((function(e){return ok$1$1(t)}))},e.fail=function(t){return new e((function(e){return err$1$1({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),string$1$1=Decoder$1$1.string,number$1$1=Decoder$1$1.number,boolean$1$1=Decoder$1$1.boolean,anyJson$1$1=Decoder$1$1.anyJson;Decoder$1$1.unknownJson;var constant$1$1=Decoder$1$1.constant,object$1$1=Decoder$1$1.object,array$1$1=Decoder$1$1.array;Decoder$1$1.tuple,Decoder$1$1.dict;var optional$1$1=Decoder$1$1.optional,oneOf$1$1=Decoder$1$1.oneOf;Decoder$1$1.union,Decoder$1$1.intersection,Decoder$1$1.withDefault,Decoder$1$1.valueAt,Decoder$1$1.succeed,Decoder$1$1.fail;var lazy$1=Decoder$1$1.lazy;const connectBrowserAppProps$1=["name","title","version","customProperties","icon","caption","type"],fdc3v2AppProps$1=["appId","name","type","details","version","title","tooltip","lang","description","categories","icons","screenshots","contactEmail","moreInfo","publisher","customConfig","hostManifests","interop","localizedVersions"];var ok$3=function(e){return{ok:!0,result:e}},err$3=function(e){return{ok:!1,error:e}},asPromise$3=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},withDefault$3=function(e,t){return!0===t.ok?t.result:e},withException$3=function(e){if(!0===e.ok)return e.result;throw e.error},map$3=function(e,t){return!0===t.ok?ok$3(e(t.result)):t},map2$3=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:ok$3(e(t.result,n.result))},mapError$3=function(e,t){return!0===t.ok?t:err$3(e(t.error))},andThen$3=function(e,t){return!0===t.ok?e(t.result):t},__assign$1$1=function(){return __assign$1$1=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign$1$1.apply(this,arguments)};function __rest$3(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function isEqual$3(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!=typeof t)return!1;if("object"==typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!isEqual$3(e[n],t[n]))return!1;return!0}var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(n=0;n<r.length;n++){if(!t.hasOwnProperty(r[n]))return!1;if(!isEqual$3(e[r[n]],t[r[n]]))return!1}return!0}}var isJsonArray$3=function(e){return Array.isArray(e)},isJsonObject$3=function(e){return"object"==typeof e&&null!==e&&!isJsonArray$3(e)},typeString$3=function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}},expectedGot$3=function(e,t){return"expected "+e+", got "+typeString$3(t)},printPath$3=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},prependAt$3=function(e,t){var n=t.at,r=__rest$3(t,["at"]);return __assign$1$1({at:e+(n||"")},r)},Decoder$3=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return mapError$3((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return asPromise$3(n.run(e))},this.runWithException=function(e){return withException$3(n.run(e))},this.map=function(t){return new e((function(e){return map$3(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return andThen$3((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,r){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(r)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?ok$3(e):err$3({message:expectedGot$3("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?ok$3(e):err$3({message:expectedGot$3("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?ok$3(e):err$3({message:expectedGot$3("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return isEqual$3(e,t)?ok$3(t):err$3({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(isJsonObject$3(e)&&t){var n={};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].decode(e[r]);if(!0!==i.ok)return void 0===e[r]?err$3({message:"the key '"+r+"' is required but was not present"}):err$3(prependAt$3("."+r,i.error));void 0!==i.result&&(n[r]=i.result)}return ok$3(n)}return isJsonObject$3(e)?ok$3(e):err$3({message:expectedGot$3("an object",e)})}))},e.array=function(t){return new e((function(e){if(isJsonArray$3(e)&&t){return e.reduce((function(e,n,r){return map2$3((function(e,t){return e.concat([t])}),e,function(e,n){return mapError$3((function(e){return prependAt$3("["+n+"]",e)}),t.decode(e))}(n,r))}),ok$3([]))}return isJsonArray$3(e)?ok$3(e):err$3({message:expectedGot$3("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(isJsonArray$3(e)){if(e.length!==t.length)return err$3({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e[r]);if(!i.ok)return err$3(prependAt$3("["+r+"]",i.error));n[r]=i.result}return ok$3(n)}return err$3({message:expectedGot$3("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.oneOf.apply(e,[t,n].concat(r))},e.intersection=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e((function(e){return[t,n].concat(r).reduce((function(t,n){return map2$3(Object.assign,t,n.decode(e))}),ok$3({}))}))},e.anyJson=function(){return new e((function(e){return ok$3(e)}))},e.unknownJson=function(){return new e((function(e){return ok$3(e)}))},e.dict=function(t){return new e((function(e){if(isJsonObject$3(e)){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=t.decode(e[r]);if(!0!==i.ok)return err$3(prependAt$3("."+r,i.error));n[r]=i.result}return ok$3(n)}return err$3({message:expectedGot$3("an object",e)})}))},e.optional=function(t){return new e((function(e){return null==e?ok$3(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e);if(!0===i.ok)return i;n[r]=i.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return err$3({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return ok$3(withDefault$3(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var r=e,i=0;i<t.length;i++){if(void 0===r)return err$3({at:printPath$3(t.slice(0,i+1)),message:"path does not exist"});if("string"==typeof t[i]&&!isJsonObject$3(r))return err$3({at:printPath$3(t.slice(0,i+1)),message:expectedGot$3("an object",r)});if("number"==typeof t[i]&&!isJsonArray$3(r))return err$3({at:printPath$3(t.slice(0,i+1)),message:expectedGot$3("an array",r)});r=r[t[i]]}return mapError$3((function(e){return void 0===r?{at:printPath$3(t),message:"path does not exist"}:prependAt$3(printPath$3(t),e)}),n.decode(r))}))},e.succeed=function(t){return new e((function(e){return ok$3(t)}))},e.fail=function(t){return new e((function(e){return err$3({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),string$3=Decoder$3.string,number$3=Decoder$3.number,boolean$2=Decoder$3.boolean,anyJson$3=Decoder$3.anyJson;Decoder$3.unknownJson;var constant$3=Decoder$3.constant,object$3=Decoder$3.object,array$3=Decoder$3.array;Decoder$3.tuple;var dict$1=Decoder$3.dict,optional$3=Decoder$3.optional,oneOf$3=Decoder$3.oneOf;Decoder$3.union,Decoder$3.intersection,Decoder$3.withDefault,Decoder$3.valueAt,Decoder$3.succeed,Decoder$3.fail,Decoder$3.lazy;const nonEmptyStringDecoder$1$1=string$3().where((e=>e.length>0),"Expected a non-empty string"),nonNegativeNumberDecoder$1$1=number$3().where((e=>e>=0),"Expected a non-negative number"),intentDefinitionDecoder$1$1=object$3({name:nonEmptyStringDecoder$1$1,displayName:optional$3(string$3()),contexts:optional$3(array$3(string$3())),customConfig:optional$3(object$3())}),v2TypeDecoder$1=oneOf$3(constant$3("web"),constant$3("native"),constant$3("citrix"),constant$3("onlineNative"),constant$3("other")),v2DetailsDecoder$1=object$3({url:nonEmptyStringDecoder$1$1}),v2IconDecoder$1=object$3({src:nonEmptyStringDecoder$1$1,size:optional$3(nonEmptyStringDecoder$1$1),type:optional$3(nonEmptyStringDecoder$1$1)}),v2ScreenshotDecoder$1=object$3({src:nonEmptyStringDecoder$1$1,size:optional$3(nonEmptyStringDecoder$1$1),type:optional$3(nonEmptyStringDecoder$1$1),label:optional$3(nonEmptyStringDecoder$1$1)}),v2ListensForIntentDecoder$1=object$3({contexts:array$3(nonEmptyStringDecoder$1$1),displayName:optional$3(nonEmptyStringDecoder$1$1),resultType:optional$3(nonEmptyStringDecoder$1$1),customConfig:optional$3(anyJson$3())}),v2IntentsDecoder$1=object$3({listensFor:optional$3(dict$1(v2ListensForIntentDecoder$1)),raises:optional$3(dict$1(array$3(nonEmptyStringDecoder$1$1)))}),v2UserChannelDecoder$1=object$3({broadcasts:optional$3(array$3(nonEmptyStringDecoder$1$1)),listensFor:optional$3(array$3(nonEmptyStringDecoder$1$1))}),v2AppChannelDecoder$1=object$3({name:nonEmptyStringDecoder$1$1,description:optional$3(nonEmptyStringDecoder$1$1),broadcasts:optional$3(array$3(nonEmptyStringDecoder$1$1)),listensFor:optional$3(array$3(nonEmptyStringDecoder$1$1))}),v2InteropDecoder$1=object$3({intents:optional$3(v2IntentsDecoder$1),userChannels:optional$3(v2UserChannelDecoder$1),appChannels:optional$3(array$3(v2AppChannelDecoder$1))}),glue42ApplicationDetailsDecoder$1=object$3({url:nonEmptyStringDecoder$1$1,top:optional$3(number$3()),left:optional$3(number$3()),width:optional$3(nonNegativeNumberDecoder$1$1),height:optional$3(nonNegativeNumberDecoder$1$1)}),glue42HostManifestsBrowserDecoder$1=object$3({name:optional$3(nonEmptyStringDecoder$1$1),type:optional$3(nonEmptyStringDecoder$1$1.where((e=>"window"===e),"Expected a value of window")),title:optional$3(nonEmptyStringDecoder$1$1),version:optional$3(nonEmptyStringDecoder$1$1),customProperties:optional$3(anyJson$3()),icon:optional$3(string$3()),caption:optional$3(string$3()),details:optional$3(glue42ApplicationDetailsDecoder$1),intents:optional$3(array$3(intentDefinitionDecoder$1$1)),hidden:optional$3(boolean$2())}),hostManifestsBrowserDecoder$1=oneOf$3(object$3({Glue42:oneOf$3(glue42HostManifestsBrowserDecoder$1,anyJson$3())}),anyJson$3()),v1DefinitionDecoder$1=object$3({name:nonEmptyStringDecoder$1$1,appId:nonEmptyStringDecoder$1$1,title:optional$3(nonEmptyStringDecoder$1$1),version:optional$3(nonEmptyStringDecoder$1$1),manifest:nonEmptyStringDecoder$1$1,manifestType:nonEmptyStringDecoder$1$1,tooltip:optional$3(nonEmptyStringDecoder$1$1),description:optional$3(nonEmptyStringDecoder$1$1),contactEmail:optional$3(nonEmptyStringDecoder$1$1),supportEmail:optional$3(nonEmptyStringDecoder$1$1),publisher:optional$3(nonEmptyStringDecoder$1$1),images:optional$3(array$3(object$3({url:optional$3(nonEmptyStringDecoder$1$1)}))),icons:optional$3(array$3(object$3({icon:optional$3(nonEmptyStringDecoder$1$1)}))),customConfig:anyJson$3(),intents:optional$3(array$3(intentDefinitionDecoder$1$1))}),v2LocalizedDefinitionDecoder$1=object$3({appId:optional$3(nonEmptyStringDecoder$1$1),name:optional$3(nonEmptyStringDecoder$1$1),details:optional$3(v2DetailsDecoder$1),version:optional$3(nonEmptyStringDecoder$1$1),title:optional$3(nonEmptyStringDecoder$1$1),tooltip:optional$3(nonEmptyStringDecoder$1$1),lang:optional$3(nonEmptyStringDecoder$1$1),description:optional$3(nonEmptyStringDecoder$1$1),categories:optional$3(array$3(nonEmptyStringDecoder$1$1)),icons:optional$3(array$3(v2IconDecoder$1)),screenshots:optional$3(array$3(v2ScreenshotDecoder$1)),contactEmail:optional$3(nonEmptyStringDecoder$1$1),supportEmail:optional$3(nonEmptyStringDecoder$1$1),moreInfo:optional$3(nonEmptyStringDecoder$1$1),publisher:optional$3(nonEmptyStringDecoder$1$1),customConfig:optional$3(array$3(anyJson$3())),hostManifests:optional$3(hostManifestsBrowserDecoder$1),interop:optional$3(v2InteropDecoder$1)}),v2DefinitionDecoder$1=object$3({appId:nonEmptyStringDecoder$1$1,name:nonEmptyStringDecoder$1$1,type:v2TypeDecoder$1,details:v2DetailsDecoder$1,version:optional$3(nonEmptyStringDecoder$1$1),title:optional$3(nonEmptyStringDecoder$1$1),tooltip:optional$3(nonEmptyStringDecoder$1$1),lang:optional$3(nonEmptyStringDecoder$1$1),description:optional$3(nonEmptyStringDecoder$1$1),categories:optional$3(array$3(nonEmptyStringDecoder$1$1)),icons:optional$3(array$3(v2IconDecoder$1)),screenshots:optional$3(array$3(v2ScreenshotDecoder$1)),contactEmail:optional$3(nonEmptyStringDecoder$1$1),supportEmail:optional$3(nonEmptyStringDecoder$1$1),moreInfo:optional$3(nonEmptyStringDecoder$1$1),publisher:optional$3(nonEmptyStringDecoder$1$1),customConfig:optional$3(array$3(anyJson$3())),hostManifests:optional$3(hostManifestsBrowserDecoder$1),interop:optional$3(v2InteropDecoder$1),localizedVersions:optional$3(dict$1(v2LocalizedDefinitionDecoder$1))}),allDefinitionsDecoder$1=oneOf$3(v1DefinitionDecoder$1,v2DefinitionDecoder$1),parseDecoderErrorToStringMessage$1=e=>`${e.kind} at ${e.at}: ${JSON.stringify(e.input)}. Reason - ${e.message}`;let FDC3Service$1=class{constructor(){this.fdc3ToDesktopDefinitionType={web:"window",native:"exe",citrix:"citrix",onlineNative:"clickonce",other:"window"}}toApi(){return{isFdc3Definition:this.isFdc3Definition.bind(this),parseToBrowserBaseAppData:this.parseToBrowserBaseAppData.bind(this),parseToDesktopAppConfig:this.parseToDesktopAppConfig.bind(this)}}isFdc3Definition(e){const t=allDefinitionsDecoder$1.run(e);return t.ok?e.appId&&e.details?{isFdc3:!0,version:"2.0"}:e.manifest?{isFdc3:!0,version:"1.2"}:{isFdc3:!1,reason:"The passed definition is not FDC3"}:{isFdc3:!1,reason:parseDecoderErrorToStringMessage$1(t.error)}}parseToBrowserBaseAppData(e){var t;const{isFdc3:n,version:r}=this.isFdc3Definition(e);if(!n)throw new Error("The passed definition is not FDC3");const i=allDefinitionsDecoder$1.run(e);if(!i.ok)throw new Error(`Invalid FDC3 ${r} definition. Error: ${parseDecoderErrorToStringMessage$1(i.error)}`);const o=this.getUserPropertiesFromDefinition(e,r),l={url:this.getUrl(e,r)};let s={name:e.appId,type:"window",createOptions:l,userProperties:Object.assign(Object.assign({},o),{intents:"1.2"===r?o.intents:this.getIntentsFromV2AppDefinition(e),details:l}),title:e.title,version:e.version,icon:this.getIconFromDefinition(e,r),caption:e.description,fdc3:"2.0"===r?Object.assign(Object.assign({},e),{definitionVersion:"2.0"}):void 0};if(null===(t=e.hostManifests)||void 0===t?void 0:t.Glue42){const t=glue42HostManifestsBrowserDecoder$1.run(e.hostManifests.Glue42);if(!t.ok)throw new Error(`Invalid FDC3 ${r} definition. Error: ${parseDecoderErrorToStringMessage$1(t.error)}`);if(!Object.keys(t.result).length)throw new Error("Invalid 'hostManifests['Glue42]' key");s=this.mergeBaseAppDataWithGlueManifest(s,t.result)}return s}parseToDesktopAppConfig(e){var t,n,r;const{isFdc3:i,version:o}=this.isFdc3Definition(e);if(!i)throw new Error("The passed definition is not FDC3");const l=allDefinitionsDecoder$1.run(e);if(!l.ok)throw new Error(`Invalid FDC3 ${o} definition. Error: ${parseDecoderErrorToStringMessage$1(l.error)}`);if("1.2"===o){const n=e;return{name:n.appId,type:"window",details:{url:this.getUrl(e,o)},version:n.version,title:n.title,tooltip:n.tooltip,caption:n.description,icon:null===(t=n.icons)||void 0===t?void 0:t[0].icon,intents:n.intents,customProperties:{manifestType:n.manifestType,images:n.images,contactEmail:n.contactEmail,supportEmail:n.supportEmail,publisher:n.publisher,icons:n.icons,customConfig:n.customConfig}}}const s=e;let a={name:s.appId,type:this.fdc3ToDesktopDefinitionType[s.type],details:s.details,version:s.version,title:s.title,tooltip:s.tooltip,caption:s.description,icon:this.getIconFromDefinition(s,"2.0"),intents:this.getIntentsFromV2AppDefinition(s),fdc3:Object.assign(Object.assign({},s),{definitionVersion:"2.0"})};if(null===(n=s.hostManifests)||void 0===n?void 0:n.Glue42){if("object"!=typeof s.hostManifests.Glue42||Array.isArray(s.hostManifests.Glue42))throw new Error("Invalid 'hostManifests['Glue42]' key");a=this.mergeDesktopConfigWithGlueManifest(a,null===(r=s.hostManifests)||void 0===r?void 0:r.Glue42)}return a}getUserPropertiesFromDefinition(e,t){return"1.2"===t?Object.fromEntries(Object.entries(e).filter((([e])=>!connectBrowserAppProps$1.includes(e)))):Object.fromEntries(Object.entries(e).filter((([e])=>!connectBrowserAppProps$1.includes(e)&&!fdc3v2AppProps$1.includes(e))))}getUrl(e,t){var n,r;let i;if("1.2"===t){const t=JSON.parse(e.manifest);i=(null===(n=t.details)||void 0===n?void 0:n.url)||t.url}else i=null===(r=e.details)||void 0===r?void 0:r.url;if(!i||"string"!=typeof i)throw new Error(`Invalid FDC3 ${t} definition. Provide valid 'url' under '${"1.2"===t?"manifest":"details"}' key`);return i}getIntentsFromV2AppDefinition(e){var t,n;const r=null===(n=null===(t=e.interop)||void 0===t?void 0:t.intents)||void 0===n?void 0:n.listensFor;if(!r)return;return Object.entries(r).map((e=>{const[t,n]=e;return Object.assign({name:t},n)}))}getIconFromDefinition(e,t){var n,r,i,o;return"1.2"===t?(null===(r=null===(n=e.icons)||void 0===n?void 0:n.find((e=>e.icon)))||void 0===r?void 0:r.icon)||void 0:(null===(o=null===(i=e.icons)||void 0===i?void 0:i.find((e=>e.src)))||void 0===o?void 0:o.src)||void 0}mergeBaseAppDataWithGlueManifest(e,t){let n=e;if(t.details){const r=Object.assign(Object.assign({},e.createOptions),t.details);n.createOptions=r,n.userProperties.details=r}return Array.isArray(t.intents)&&(n.userProperties.intents=(n.userProperties.intents||[]).concat(t.intents)),n=Object.assign(Object.assign({},n),t),delete n.details,delete n.intents,n}mergeDesktopConfigWithGlueManifest(e,t){const n=Object.assign({},e,t,{details:Object.assign(Object.assign({},e.details),t.details)});return Array.isArray(t.intents)&&(n.intents=(e.intents||[]).concat(t.intents)),n}};const decoders$1$1={common:{nonEmptyStringDecoder:nonEmptyStringDecoder$1$1,nonNegativeNumberDecoder:nonNegativeNumberDecoder$1$1},fdc3:{allDefinitionsDecoder:allDefinitionsDecoder$1,v1DefinitionDecoder:v1DefinitionDecoder$1,v2DefinitionDecoder:v2DefinitionDecoder$1}};var INTENTS_ERRORS$1;!function(e){e.USER_CANCELLED="User Closed Intents Resolver UI without choosing a handler",e.CALLER_NOT_DEFINED="Caller Id is not defined",e.TIMEOUT_HIT="Timeout hit",e.INTENT_NOT_FOUND="Cannot find Intent",e.HANDLER_NOT_FOUND="Cannot find Intent Handler",e.TARGET_INSTANCE_UNAVAILABLE="Cannot start Target Instance",e.INTENT_DELIVERY_FAILED="Target Instance did not add a listener",e.RESOLVER_UNAVAILABLE="Intents Resolver UI unavailable",e.RESOLVER_TIMEOUT="User did not choose a handler",e.INVALID_RESOLVER_RESPONSE="Intents Resolver UI returned invalid response",e.INTENT_HANDLER_REJECTION="Intent Handler function processing the raised intent threw an error or rejected the promise it returned"}(INTENTS_ERRORS$1||(INTENTS_ERRORS$1={}));let IoC$1$1=class{constructor(){this._decoders=decoders$1$1,this._errors={intents:INTENTS_ERRORS$1}}get fdc3(){return this._fdc3||(this._fdc3=(new FDC3Service$1).toApi()),this._fdc3}get decoders(){return this._decoders}get errors(){return this._errors}};const ioc$1=new IoC$1$1;ioc$1.fdc3;const decoders$2=ioc$1.decoders;ioc$1.errors;const nonEmptyStringDecoder$3=string$1$1().where((e=>e.length>0),"Expected a non-empty string"),nonNegativeNumberDecoder$3=number$1$1().where((e=>e>=0),"Expected a non-negative number"),optionalNonEmptyStringDecoder=optional$1$1(nonEmptyStringDecoder$3),libDomainDecoder$1=oneOf$1$1(constant$1$1("system"),constant$1$1("windows"),constant$1$1("appManager"),constant$1$1("layouts"),constant$1$1("intents"),constant$1$1("notifications"),constant$1$1("channels"),constant$1$1("extension"),constant$1$1("themes"),constant$1$1("prefs")),windowOperationTypesDecoder=oneOf$1$1(constant$1$1("openWindow"),constant$1$1("windowHello"),constant$1$1("windowAdded"),constant$1$1("windowRemoved"),constant$1$1("getBounds"),constant$1$1("getFrameBounds"),constant$1$1("getUrl"),constant$1$1("moveResize"),constant$1$1("focus"),constant$1$1("close"),constant$1$1("getTitle"),constant$1$1("setTitle"),constant$1$1("focusChange"),constant$1$1("getChannel")),appManagerOperationTypesDecoder$1=oneOf$1$1(constant$1$1("appHello"),constant$1$1("appDirectoryStateChange"),constant$1$1("instanceStarted"),constant$1$1("instanceStopped"),constant$1$1("applicationStart"),constant$1$1("instanceStop"),constant$1$1("clear")),layoutsOperationTypesDecoder$1=oneOf$1$1(constant$1$1("layoutAdded"),constant$1$1("layoutChanged"),constant$1$1("layoutRemoved"),constant$1$1("get"),constant$1$1("getAll"),constant$1$1("export"),constant$1$1("import"),constant$1$1("remove"),constant$1$1("clientSaveRequest"),constant$1$1("getGlobalPermissionState"),constant$1$1("checkGlobalActivated"),constant$1$1("requestGlobalPermission"),constant$1$1("getDefaultGlobal"),constant$1$1("setDefaultGlobal"),constant$1$1("clearDefaultGlobal")),notificationsOperationTypesDecoder=oneOf$1$1(constant$1$1("raiseNotification"),constant$1$1("requestPermission"),constant$1$1("notificationShow"),constant$1$1("notificationClick"),constant$1$1("getPermission"),constant$1$1("list"),constant$1$1("notificationRaised"),constant$1$1("notificationClosed"),constant$1$1("click"),constant$1$1("clear"),constant$1$1("clearAll"),constant$1$1("configure"),constant$1$1("getConfiguration"),constant$1$1("configurationChanged"),constant$1$1("setState"),constant$1$1("clearOld"),constant$1$1("activeCountChange"),constant$1$1("stateChange")),systemOperationTypesDecoder$1=oneOf$1$1(constant$1$1("getEnvironment"),constant$1$1("getBase"),constant$1$1("platformShutdown")),windowRelativeDirectionDecoder$1=oneOf$1$1(constant$1$1("top"),constant$1$1("left"),constant$1$1("right"),constant$1$1("bottom")),windowBoundsDecoder$1=object$1$1({top:number$1$1(),left:number$1$1(),width:nonNegativeNumberDecoder$3,height:nonNegativeNumberDecoder$3}),windowOpenSettingsDecoder$1=optional$1$1(object$1$1({top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$3),height:optional$1$1(nonNegativeNumberDecoder$3),context:optional$1$1(anyJson$1$1()),relativeTo:optional$1$1(nonEmptyStringDecoder$3),relativeDirection:optional$1$1(windowRelativeDirectionDecoder$1),windowId:optional$1$1(nonEmptyStringDecoder$3),layoutComponentId:optional$1$1(nonEmptyStringDecoder$3)})),openWindowConfigDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,url:nonEmptyStringDecoder$3,options:windowOpenSettingsDecoder$1}),windowHelloDecoder=object$1$1({windowId:optional$1$1(nonEmptyStringDecoder$3)}),coreWindowDataDecoder=object$1$1({windowId:nonEmptyStringDecoder$3,name:nonEmptyStringDecoder$3}),simpleWindowDecoder$1=object$1$1({windowId:nonEmptyStringDecoder$3}),helloSuccessDecoder=object$1$1({windows:array$1$1(coreWindowDataDecoder),isWorkspaceFrame:boolean$1$1()}),windowTitleConfigDecoder$1=object$1$1({windowId:nonEmptyStringDecoder$3,title:string$1$1()}),focusEventDataDecoder$1=object$1$1({windowId:nonEmptyStringDecoder$3,hasFocus:boolean$1$1()}),windowMoveResizeConfigDecoder$1=object$1$1({windowId:nonEmptyStringDecoder$3,top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$3),height:optional$1$1(nonNegativeNumberDecoder$3),relative:optional$1$1(boolean$1$1())}),windowBoundsResultDecoder$1=object$1$1({windowId:nonEmptyStringDecoder$3,bounds:object$1$1({top:number$1$1(),left:number$1$1(),width:nonNegativeNumberDecoder$3,height:nonNegativeNumberDecoder$3})}),frameWindowBoundsResultDecoder$1=object$1$1({bounds:object$1$1({top:number$1$1(),left:number$1$1(),width:nonNegativeNumberDecoder$3,height:nonNegativeNumberDecoder$3})}),windowUrlResultDecoder$1=object$1$1({windowId:nonEmptyStringDecoder$3,url:nonEmptyStringDecoder$3}),anyDecoder$1=anyJson$1$1(),boundsDecoder=object$1$1({top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$3),height:optional$1$1(nonNegativeNumberDecoder$3)}),instanceDataDecoder$1=object$1$1({id:nonEmptyStringDecoder$3,applicationName:nonEmptyStringDecoder$3}),applicationDetailsDecoder$1=object$1$1({url:nonEmptyStringDecoder$3,top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$3),height:optional$1$1(nonNegativeNumberDecoder$3)}),intentDefinitionDecoder$2=object$1$1({name:nonEmptyStringDecoder$3,displayName:optional$1$1(string$1$1()),contexts:optional$1$1(array$1$1(string$1$1())),customConfig:optional$1$1(object$1$1())});object$1$1({name:nonEmptyStringDecoder$3,title:optional$1$1(nonEmptyStringDecoder$3),version:optional$1$1(nonEmptyStringDecoder$3),appId:optional$1$1(nonEmptyStringDecoder$3),manifest:nonEmptyStringDecoder$3,manifestType:nonEmptyStringDecoder$3,tooltip:optional$1$1(nonEmptyStringDecoder$3),description:optional$1$1(nonEmptyStringDecoder$3),contactEmail:optional$1$1(nonEmptyStringDecoder$3),supportEmail:optional$1$1(nonEmptyStringDecoder$3),publisher:optional$1$1(nonEmptyStringDecoder$3),images:optional$1$1(array$1$1(object$1$1({url:optional$1$1(nonEmptyStringDecoder$3)}))),icons:optional$1$1(array$1$1(object$1$1({icon:optional$1$1(nonEmptyStringDecoder$3)}))),customConfig:anyJson$1$1(),intents:optional$1$1(array$1$1(intentDefinitionDecoder$2))});const applicationDefinitionDecoder=object$1$1({name:nonEmptyStringDecoder$3,type:nonEmptyStringDecoder$3.where((e=>"window"===e),"Expected a value of window"),title:optional$1$1(nonEmptyStringDecoder$3),version:optional$1$1(nonEmptyStringDecoder$3),customProperties:optional$1$1(anyJson$1$1()),icon:optional$1$1(string$1$1()),caption:optional$1$1(string$1$1()),details:applicationDetailsDecoder$1,intents:optional$1$1(array$1$1(intentDefinitionDecoder$2)),hidden:optional$1$1(boolean$1$1()),fdc3:optional$1$1(decoders$2.fdc3.v2DefinitionDecoder)}),allApplicationDefinitionsDecoder$1=oneOf$1$1(applicationDefinitionDecoder,decoders$2.fdc3.v2DefinitionDecoder,decoders$2.fdc3.v1DefinitionDecoder);object$1$1({definitions:array$1$1(allApplicationDefinitionsDecoder$1),mode:oneOf$1$1(constant$1$1("replace"),constant$1$1("merge"))});const appRemoveConfigDecoder$1=object$1$1({name:nonEmptyStringDecoder$3}),appsExportOperationDecoder$1=object$1$1({definitions:array$1$1(applicationDefinitionDecoder)}),applicationDataDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,type:nonEmptyStringDecoder$3.where((e=>"window"===e),"Expected a value of window"),instances:array$1$1(instanceDataDecoder$1),userProperties:optional$1$1(anyJson$1$1()),title:optional$1$1(nonEmptyStringDecoder$3),version:optional$1$1(nonEmptyStringDecoder$3),icon:optional$1$1(nonEmptyStringDecoder$3),caption:optional$1$1(nonEmptyStringDecoder$3)}),baseApplicationDataDecoder=object$1$1({name:nonEmptyStringDecoder$3,type:nonEmptyStringDecoder$3.where((e=>"window"===e),"Expected a value of window"),userProperties:anyJson$1$1(),title:optional$1$1(nonEmptyStringDecoder$3),version:optional$1$1(nonEmptyStringDecoder$3),icon:optional$1$1(nonEmptyStringDecoder$3),caption:optional$1$1(nonEmptyStringDecoder$3)}),appDirectoryStateChangeDecoder=object$1$1({appsAdded:array$1$1(baseApplicationDataDecoder),appsChanged:array$1$1(baseApplicationDataDecoder),appsRemoved:array$1$1(baseApplicationDataDecoder)}),appHelloSuccessDecoder$1=object$1$1({apps:array$1$1(applicationDataDecoder$1),initialChannelId:optional$1$1(nonEmptyStringDecoder$3)}),basicInstanceDataDecoder$1=object$1$1({id:nonEmptyStringDecoder$3}),applicationStartConfigDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,waitForAGMReady:boolean$1$1(),id:optional$1$1(nonEmptyStringDecoder$3),context:optional$1$1(anyJson$1$1()),top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$3),height:optional$1$1(nonNegativeNumberDecoder$3),relativeTo:optional$1$1(nonEmptyStringDecoder$3),relativeDirection:optional$1$1(windowRelativeDirectionDecoder$1),forceChromeTab:optional$1$1(boolean$1$1()),layoutComponentId:optional$1$1(nonEmptyStringDecoder$3),channelId:optional$1$1(nonEmptyStringDecoder$3)}),layoutTypeDecoder$1=oneOf$1$1(constant$1$1("Global"),constant$1$1("Activity"),constant$1$1("ApplicationDefault"),constant$1$1("Swimlane"),constant$1$1("Workspace")),componentTypeDecoder$1=oneOf$1$1(constant$1$1("application"),constant$1$1("activity")),windowComponentStateDecoder$1=object$1$1({context:optional$1$1(anyJson$1$1()),bounds:windowBoundsDecoder$1,createArgs:object$1$1({name:optional$1$1(nonEmptyStringDecoder$3),url:optional$1$1(nonEmptyStringDecoder$3),context:optional$1$1(anyJson$1$1())}),windowState:optional$1$1(nonEmptyStringDecoder$3),restoreState:optional$1$1(nonEmptyStringDecoder$3),instanceId:nonEmptyStringDecoder$3,isCollapsed:optional$1$1(boolean$1$1()),isSticky:optional$1$1(boolean$1$1()),restoreSettings:object$1$1({groupId:optional$1$1(nonEmptyStringDecoder$3),groupZOrder:optional$1$1(number$1$1())})}),windowLayoutComponentDecoder$1=object$1$1({type:constant$1$1("window"),componentType:optional$1$1(componentTypeDecoder$1),application:nonEmptyStringDecoder$3,state:windowComponentStateDecoder$1}),windowLayoutItemDecoder$1=object$1$1({type:constant$1$1("window"),config:object$1$1({appName:nonEmptyStringDecoder$3,url:optional$1$1(nonEmptyStringDecoder$3),title:optional$1$1(string$1$1()),allowExtract:optional$1$1(boolean$1$1()),allowReorder:optional$1$1(boolean$1$1()),showCloseButton:optional$1$1(boolean$1$1()),isMaximized:optional$1$1(boolean$1$1())})}),groupLayoutItemDecoder$2=object$1$1({type:constant$1$1("group"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(windowLayoutItemDecoder$1))}),columnLayoutItemDecoder$2=object$1$1({type:constant$1$1("column"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(groupLayoutItemDecoder$2,windowLayoutItemDecoder$1,lazy$1((()=>columnLayoutItemDecoder$2)),lazy$1((()=>rowLayoutItemDecoder$2))))}),rowLayoutItemDecoder$2=object$1$1({type:constant$1$1("row"),config:anyJson$1$1(),children:array$1$1(oneOf$1$1(columnLayoutItemDecoder$2,groupLayoutItemDecoder$2,windowLayoutItemDecoder$1,lazy$1((()=>rowLayoutItemDecoder$2))))}),workspaceLayoutComponentStateDecoder$1=object$1$1({config:anyJson$1$1(),context:anyJson$1$1(),children:array$1$1(oneOf$1$1(rowLayoutItemDecoder$2,columnLayoutItemDecoder$2,groupLayoutItemDecoder$2,windowLayoutItemDecoder$1))}),workspaceLayoutComponentDecoder$1=object$1$1({type:constant$1$1("Workspace"),application:optional$1$1(nonEmptyStringDecoder$3),state:workspaceLayoutComponentStateDecoder$1}),workspaceFrameComponentStateDecoder$1=object$1$1({bounds:windowBoundsDecoder$1,instanceId:nonEmptyStringDecoder$3,selectedWorkspace:nonNegativeNumberDecoder$3,workspaces:array$1$1(workspaceLayoutComponentStateDecoder$1),windowState:optional$1$1(nonEmptyStringDecoder$3),restoreState:optional$1$1(nonEmptyStringDecoder$3),context:optional$1$1(anyJson$1$1())}),workspaceFrameComponentDecoder$1=object$1$1({type:constant$1$1("workspaceFrame"),application:nonEmptyStringDecoder$3,componentType:optional$1$1(componentTypeDecoder$1),state:workspaceFrameComponentStateDecoder$1}),glueLayoutDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,type:layoutTypeDecoder$1,components:array$1$1(oneOf$1$1(windowLayoutComponentDecoder$1,workspaceLayoutComponentDecoder$1,workspaceFrameComponentDecoder$1)),context:optional$1$1(anyJson$1$1()),metadata:optional$1$1(anyJson$1$1()),version:optional$1$1(number$1$1())}),newLayoutOptionsDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,context:optional$1$1(anyJson$1$1()),metadata:optional$1$1(anyJson$1$1()),instances:optional$1$1(array$1$1(nonEmptyStringDecoder$3)),ignoreInstances:optional$1$1(array$1$1(nonEmptyStringDecoder$3))}),restoreOptionsDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,context:optional$1$1(anyJson$1$1()),closeRunningInstance:optional$1$1(boolean$1$1()),closeMe:optional$1$1(boolean$1$1()),timeout:optional$1$1(nonNegativeNumberDecoder$3)}),layoutSummaryDecoder$2=object$1$1({name:nonEmptyStringDecoder$3,type:layoutTypeDecoder$1,context:optional$1$1(anyJson$1$1()),metadata:optional$1$1(anyJson$1$1())}),simpleLayoutConfigDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,type:layoutTypeDecoder$1}),saveLayoutConfigDecoder$1=object$1$1({layout:newLayoutOptionsDecoder$1}),restoreLayoutConfigDecoder$1=object$1$1({layout:restoreOptionsDecoder$1}),getAllLayoutsConfigDecoder$1=object$1$1({type:layoutTypeDecoder$1}),allLayoutsFullConfigDecoder$1=object$1$1({layouts:array$1$1(glueLayoutDecoder$1)}),importModeDecoder$1=oneOf$1$1(constant$1$1("replace"),constant$1$1("merge")),layoutsImportConfigDecoder$1=object$1$1({layouts:array$1$1(glueLayoutDecoder$1),mode:importModeDecoder$1,isManagerOperation:optional$1$1(boolean$1$1())}),allLayoutsSummariesResultDecoder$1=object$1$1({summaries:array$1$1(layoutSummaryDecoder$2)}),simpleLayoutResultDecoder=object$1$1({layout:glueLayoutDecoder$1}),optionalSimpleLayoutResult$1=object$1$1({layout:optional$1$1(glueLayoutDecoder$1)}),setDefaultGlobalConfigDecoder$1=object$1$1({name:nonEmptyStringDecoder$3}),intentsOperationTypesDecoder$1=oneOf$1$1(constant$1$1("findIntent"),constant$1$1("getIntents"),constant$1$1("raiseIntent"),constant$1$1("raise"),constant$1$1("filterHandlers")),intentHandlerDecoder$1=object$1$1({applicationName:nonEmptyStringDecoder$3,applicationTitle:optional$1$1(string$1$1()),applicationDescription:optional$1$1(string$1$1()),applicationIcon:optional$1$1(string$1$1()),type:oneOf$1$1(constant$1$1("app"),constant$1$1("instance")),displayName:optional$1$1(string$1$1()),contextTypes:optional$1$1(array$1$1(nonEmptyStringDecoder$3)),instanceId:optional$1$1(string$1$1()),instanceTitle:optional$1$1(string$1$1()),resultType:optional$1$1(string$1$1())});object$1$1({applicationName:string$1$1(),applicationIcon:optional$1$1(string$1$1()),instanceId:optional$1$1(string$1$1())});const intentResolverResponseDecoder=object$1$1({intent:nonEmptyStringDecoder$3,handler:intentHandlerDecoder$1}),intentDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,handlers:array$1$1(intentHandlerDecoder$1)}),intentTargetDecoder$1=oneOf$1$1(constant$1$1("startNew"),constant$1$1("reuse"),object$1$1({app:optional$1$1(nonEmptyStringDecoder$3),instance:optional$1$1(nonEmptyStringDecoder$3)})),intentContextDecoder$1=object$1$1({type:optional$1$1(nonEmptyStringDecoder$3),data:optional$1$1(anyJson$1$1())}),intentsDecoder$1=array$1$1(intentDecoder$1),wrappedIntentsDecoder$1=object$1$1({intents:intentsDecoder$1}),intentFilterDecoder=object$1$1({name:optional$1$1(nonEmptyStringDecoder$3),contextType:optional$1$1(nonEmptyStringDecoder$3),resultType:optional$1$1(nonEmptyStringDecoder$3)}),findFilterDecoder=oneOf$1$1(nonEmptyStringDecoder$3,intentFilterDecoder),wrappedIntentFilterDecoder$1=object$1$1({filter:optional$1$1(intentFilterDecoder)}),intentRequestDecoder$1=object$1$1({intent:nonEmptyStringDecoder$3,target:optional$1$1(intentTargetDecoder$1),context:optional$1$1(intentContextDecoder$1),options:optional$1$1(windowOpenSettingsDecoder$1),handlers:optional$1$1(array$1$1(intentHandlerDecoder$1)),timeout:optional$1$1(nonNegativeNumberDecoder$3),waitUserResponseIndefinitely:optional$1$1(boolean$1$1())}),raiseRequestDecoder=oneOf$1$1(nonEmptyStringDecoder$3,intentRequestDecoder$1),resolverConfigDecoder$1=object$1$1({enabled:boolean$1$1(),appName:nonEmptyStringDecoder$3,waitResponseTimeout:number$1$1()}),raiseIntentRequestDecoder$1=object$1$1({intentRequest:intentRequestDecoder$1,resolverConfig:resolverConfigDecoder$1}),intentResultDecoder$1=object$1$1({request:intentRequestDecoder$1,handler:intentHandlerDecoder$1,result:anyJson$1$1()}),handlersFilterDecoder$1=object$1$1({title:optional$1$1(nonEmptyStringDecoder$3),openResolver:optional$1$1(boolean$1$1()),timeout:optional$1$1(nonNegativeNumberDecoder$3),intent:optional$1$1(nonEmptyStringDecoder$3),contextTypes:optional$1$1(array$1$1(nonEmptyStringDecoder$3)),resultType:optional$1$1(nonEmptyStringDecoder$3),applicationNames:optional$1$1(array$1$1(nonEmptyStringDecoder$3))}),filterHandlersResultDecoder$1=object$1$1({handlers:array$1$1(intentHandlerDecoder$1)}),filterHandlersWithResolverConfigDecoder$1=object$1$1({filterHandlersRequest:handlersFilterDecoder$1,resolverConfig:resolverConfigDecoder$1}),AddIntentListenerRequestDecoder=object$1$1({intent:nonEmptyStringDecoder$3,contextTypes:optional$1$1(array$1$1(nonEmptyStringDecoder$3)),displayName:optional$1$1(string$1$1()),icon:optional$1$1(string$1$1()),description:optional$1$1(string$1$1()),resultType:optional$1$1(string$1$1())}),AddIntentListenerDecoder=oneOf$1$1(nonEmptyStringDecoder$3,AddIntentListenerRequestDecoder),intentInfoDecoder$1=object$1$1({intent:nonEmptyStringDecoder$3,contextTypes:optional$1$1(array$1$1(nonEmptyStringDecoder$3)),description:optional$1$1(nonEmptyStringDecoder$3),displayName:optional$1$1(nonEmptyStringDecoder$3),icon:optional$1$1(nonEmptyStringDecoder$3),resultType:optional$1$1(nonEmptyStringDecoder$3)}),getIntentsResultDecoder$1=object$1$1({intents:array$1$1(intentInfoDecoder$1)}),channelNameDecoder=e=>nonEmptyStringDecoder$3.where((t=>e.includes(t)),"Expected a valid channel name"),interopActionSettingsDecoder$1=object$1$1({method:nonEmptyStringDecoder$3,arguments:optional$1$1(anyJson$1$1()),target:optional$1$1(oneOf$1$1(constant$1$1("all"),constant$1$1("best")))}),glue42NotificationActionDecoder$1=object$1$1({action:string$1$1(),title:nonEmptyStringDecoder$3,icon:optional$1$1(string$1$1()),interop:optional$1$1(interopActionSettingsDecoder$1)}),notificationStateDecoder$1=oneOf$1$1(constant$1$1("Active"),constant$1$1("Acknowledged"),constant$1$1("Seen"),constant$1$1("Closed"),constant$1$1("Stale"),constant$1$1("Snoozed"),constant$1$1("Processing")),activeNotificationsCountChangeDecoder=object$1$1({count:number$1$1()}),notificationDefinitionDecoder=object$1$1({badge:optional$1$1(string$1$1()),body:optional$1$1(string$1$1()),data:optional$1$1(anyJson$1$1()),dir:optional$1$1(oneOf$1$1(constant$1$1("auto"),constant$1$1("ltr"),constant$1$1("rtl"))),icon:optional$1$1(string$1$1()),image:optional$1$1(string$1$1()),lang:optional$1$1(string$1$1()),renotify:optional$1$1(boolean$1$1()),requireInteraction:optional$1$1(boolean$1$1()),silent:optional$1$1(boolean$1$1()),tag:optional$1$1(string$1$1()),timestamp:optional$1$1(nonNegativeNumberDecoder$3),vibrate:optional$1$1(array$1$1(number$1$1()))}),glue42NotificationOptionsDecoder$1=object$1$1({title:nonEmptyStringDecoder$3,clickInterop:optional$1$1(interopActionSettingsDecoder$1),actions:optional$1$1(array$1$1(glue42NotificationActionDecoder$1)),focusPlatformOnDefaultClick:optional$1$1(boolean$1$1()),badge:optional$1$1(string$1$1()),body:optional$1$1(string$1$1()),data:optional$1$1(anyJson$1$1()),dir:optional$1$1(oneOf$1$1(constant$1$1("auto"),constant$1$1("ltr"),constant$1$1("rtl"))),icon:optional$1$1(string$1$1()),image:optional$1$1(string$1$1()),lang:optional$1$1(string$1$1()),renotify:optional$1$1(boolean$1$1()),requireInteraction:optional$1$1(boolean$1$1()),silent:optional$1$1(boolean$1$1()),tag:optional$1$1(string$1$1()),timestamp:optional$1$1(nonNegativeNumberDecoder$3),vibrate:optional$1$1(array$1$1(number$1$1())),severity:optional$1$1(oneOf$1$1(constant$1$1("Low"),constant$1$1("None"),constant$1$1("Medium"),constant$1$1("High"),constant$1$1("Critical"))),showToast:optional$1$1(boolean$1$1()),showInPanel:optional$1$1(boolean$1$1()),state:optional$1$1(notificationStateDecoder$1)}),notificationSetStateRequestDecoder$1=object$1$1({id:nonEmptyStringDecoder$3,state:notificationStateDecoder$1}),channelContextDecoder$1=object$1$1({name:nonEmptyStringDecoder$3,meta:object$1$1({color:nonEmptyStringDecoder$3}),data:optional$1$1(object$1$1())}),raiseNotificationDecoder$1=object$1$1({settings:glue42NotificationOptionsDecoder$1,id:nonEmptyStringDecoder$3}),raiseNotificationResultDecoder$1=object$1$1({settings:glue42NotificationOptionsDecoder$1}),permissionRequestResultDecoder$1=object$1$1({permissionGranted:boolean$1$1()}),permissionQueryResultDecoder$1=object$1$1({permission:oneOf$1$1(constant$1$1("default"),constant$1$1("granted"),constant$1$1("denied"))}),notificationEventPayloadDecoder=object$1$1({definition:notificationDefinitionDecoder,action:optional$1$1(string$1$1()),id:optional$1$1(nonEmptyStringDecoder$3)}),notificationFilterDecoder$1=object$1$1({allowed:optional$1$1(array$1$1(nonEmptyStringDecoder$3)),blocked:optional$1$1(array$1$1(nonEmptyStringDecoder$3))}),notificationsConfigurationDecoder$1=object$1$1({enable:optional$1$1(boolean$1$1()),enableToasts:optional$1$1(boolean$1$1()),sourceFilter:optional$1$1(notificationFilterDecoder$1)}),notificationsConfigurationProtocolDecoder$1=object$1$1({configuration:notificationsConfigurationDecoder$1}),strictNotificationsConfigurationProtocolDecoder=object$1$1({configuration:object$1$1({enable:boolean$1$1(),enableToasts:boolean$1$1(),sourceFilter:object$1$1({allowed:array$1$1(nonEmptyStringDecoder$3),blocked:array$1$1(nonEmptyStringDecoder$3)})})}),platformSaveRequestConfigDecoder=object$1$1({layoutType:oneOf$1$1(constant$1$1("Global"),constant$1$1("Workspace")),layoutName:nonEmptyStringDecoder$3,context:optional$1$1(anyJson$1$1())}),saveRequestClientResponseDecoder=object$1$1({windowContext:optional$1$1(anyJson$1$1())}),permissionStateResultDecoder$1=object$1$1({state:oneOf$1$1(constant$1$1("prompt"),constant$1$1("denied"),constant$1$1("granted"))}),simpleAvailabilityResultDecoder$1=object$1$1({isAvailable:boolean$1$1()}),simpleItemIdDecoder=object$1$1({itemId:nonEmptyStringDecoder$3}),operationCheckResultDecoder$1=object$1$1({isSupported:boolean$1$1()}),operationCheckConfigDecoder$1=object$1$1({operation:nonEmptyStringDecoder$3}),workspaceFrameBoundsResultDecoder=object$1$1({bounds:windowBoundsDecoder$1}),themeDecoder$1=object$1$1({displayName:nonEmptyStringDecoder$3,name:nonEmptyStringDecoder$3}),simpleThemeResponseDecoder$1=object$1$1({theme:themeDecoder$1}),allThemesResponseDecoder$1=object$1$1({themes:array$1$1(themeDecoder$1)}),selectThemeConfigDecoder$1=object$1$1({name:nonEmptyStringDecoder$3}),notificationsDataDecoder$1=object$1$1({id:nonEmptyStringDecoder$3,title:nonEmptyStringDecoder$3,clickInterop:optional$1$1(interopActionSettingsDecoder$1),actions:optional$1$1(array$1$1(glue42NotificationActionDecoder$1)),focusPlatformOnDefaultClick:optional$1$1(boolean$1$1()),badge:optional$1$1(string$1$1()),body:optional$1$1(string$1$1()),data:optional$1$1(anyJson$1$1()),dir:optional$1$1(oneOf$1$1(constant$1$1("auto"),constant$1$1("ltr"),constant$1$1("rtl"))),icon:optional$1$1(string$1$1()),image:optional$1$1(string$1$1()),lang:optional$1$1(string$1$1()),renotify:optional$1$1(boolean$1$1()),requireInteraction:optional$1$1(boolean$1$1()),silent:optional$1$1(boolean$1$1()),tag:optional$1$1(string$1$1()),timestamp:optional$1$1(nonNegativeNumberDecoder$3),vibrate:optional$1$1(array$1$1(number$1$1())),severity:optional$1$1(oneOf$1$1(constant$1$1("Low"),constant$1$1("None"),constant$1$1("Medium"),constant$1$1("High"),constant$1$1("Critical"))),showToast:optional$1$1(boolean$1$1()),showInPanel:optional$1$1(boolean$1$1()),state:optional$1$1(notificationStateDecoder$1)}),simpleNotificationDataDecoder=object$1$1({notification:notificationsDataDecoder$1}),allNotificationsDataDecoder$1=object$1$1({notifications:array$1$1(notificationsDataDecoder$1)}),simpleNotificationSelectDecoder$1=object$1$1({id:nonEmptyStringDecoder$3}),getWindowIdsOnChannelDataDecoder$1=object$1$1({channel:nonEmptyStringDecoder$3}),getWindowIdsOnChannelResultDecoder$1=object$1$1({windowIds:array$1$1(nonEmptyStringDecoder$3)}),channelsOperationTypesDecoder=oneOf$1$1(constant$1$1("addChannel"),constant$1$1("getMyChannel"),constant$1$1("getWindowIdsOnChannel"),constant$1$1("getWindowIdsWithChannels"),constant$1$1("joinChannel")),getMyChanelResultDecoder$1=object$1$1({channel:optional$1$1(nonEmptyStringDecoder$3)}),windowWithChannelFilterDecoder$1=object$1$1({application:optional$1$1(nonEmptyStringDecoder$3),channels:optional$1$1(array$1$1(nonEmptyStringDecoder$3)),windowIds:optional$1$1(array$1$1(nonEmptyStringDecoder$3))}),wrappedWindowWithChannelFilterDecoder$1=object$1$1({filter:optional$1$1(windowWithChannelFilterDecoder$1)}),getWindowIdsWithChannelsResultDecoder$1=object$1$1({windowIdsWithChannels:array$1$1(object$1$1({application:nonEmptyStringDecoder$3,channel:optional$1$1(nonEmptyStringDecoder$3),windowId:nonEmptyStringDecoder$3}))}),startApplicationContextDecoder=optional$1$1(anyJson$1$1()),startApplicationOptionsDecoder=optional$1$1(object$1$1({top:optional$1$1(number$1$1()),left:optional$1$1(number$1$1()),width:optional$1$1(nonNegativeNumberDecoder$3),height:optional$1$1(nonNegativeNumberDecoder$3),relativeTo:optional$1$1(nonEmptyStringDecoder$3),relativeDirection:optional$1$1(windowRelativeDirectionDecoder$1),waitForAGMReady:optional$1$1(boolean$1$1()),channelId:optional$1$1(nonEmptyStringDecoder$3),reuseId:optional$1$1(nonEmptyStringDecoder$3)})),joinChannelDataDecoder$1=object$1$1({channel:nonEmptyStringDecoder$3,windowId:nonEmptyStringDecoder$3}),windowChannelResultDecoder$1=object$1$1({channel:optional$1$1(nonEmptyStringDecoder$3)}),prefsOperationTypesDecoder$1=oneOf$1$1(constant$1$1("clear"),constant$1$1("clearAll"),constant$1$1("get"),constant$1$1("getAll"),constant$1$1("set"),constant$1$1("update"),constant$1$1("prefsChanged"),constant$1$1("prefsHello")),appPreferencesDecoder$1=object$1$1({app:nonEmptyStringDecoder$3,data:object$1$1(),lastUpdate:optional$1$1(nonEmptyStringDecoder$3)}),basePrefsConfigDecoder$1=object$1$1({app:nonEmptyStringDecoder$3}),getPrefsResultDecoder$1=object$1$1({prefs:appPreferencesDecoder$1}),getAllPrefsResultDecoder$1=object$1$1({all:array$1$1(appPreferencesDecoder$1)}),changePrefsDataDecoder$1=object$1$1({app:nonEmptyStringDecoder$3,data:object$1$1()}),prefsHelloSuccessDecoder$1=object$1$1({platform:object$1$1({app:nonEmptyStringDecoder$3})}),operations$9={openWindow:{name:"openWindow",dataDecoder:openWindowConfigDecoder$1,resultDecoder:coreWindowDataDecoder},windowHello:{name:"windowHello",dataDecoder:windowHelloDecoder,resultDecoder:helloSuccessDecoder},windowAdded:{name:"windowAdded",dataDecoder:coreWindowDataDecoder},windowRemoved:{name:"windowRemoved",dataDecoder:simpleWindowDecoder$1},getBounds:{name:"getBounds",dataDecoder:simpleWindowDecoder$1,resultDecoder:windowBoundsResultDecoder$1},getFrameBounds:{name:"getFrameBounds",dataDecoder:simpleWindowDecoder$1,resultDecoder:frameWindowBoundsResultDecoder$1},getUrl:{name:"getUrl",dataDecoder:simpleWindowDecoder$1,resultDecoder:windowUrlResultDecoder$1},moveResize:{name:"moveResize",dataDecoder:windowMoveResizeConfigDecoder$1},focus:{name:"focus",dataDecoder:simpleWindowDecoder$1},close:{name:"close",dataDecoder:simpleWindowDecoder$1},getTitle:{name:"getTitle",dataDecoder:simpleWindowDecoder$1,resultDecoder:windowTitleConfigDecoder$1},setTitle:{name:"setTitle",dataDecoder:windowTitleConfigDecoder$1},focusChange:{name:"focusChange",dataDecoder:focusEventDataDecoder$1},getChannel:{name:"getChannel",dataDecoder:simpleWindowDecoder$1,resultDecoder:windowChannelResultDecoder$1}};function getDefaultExportFromCjs$1$1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createRegistry$1$1(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};function r(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,i){var o=n[e];return o||(o=[],n[e]=o),o.push(t),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(t){r(t,e)}}))}),0),function(){var r=n[e];r&&(0===(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[])).length?delete n[e]:n[e]=r)}},execute:function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=n[e];if(!o||0===o.length)return[];var l=[];return o.forEach((function(n){try{var i=n.apply(void 0,t);l.push(i)}catch(t){l.push(void 0),r(t,e)}})),l},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}createRegistry$1$1.default=createRegistry$1$1;var lib$3$1=createRegistry$1$1;class WebWindowModel{constructor(e,t,n){this._id=e,this._name=t,this._bridge=n,this.registry=lib$3$1(),this.myCtxKey=`___window___${this.id}`}get id(){return this._id.slice()}get name(){return this._name.slice()}clean(){this.ctxUnsubscribe&&this.ctxUnsubscribe()}processSelfFocusEvent(e){this.me.isFocused=e,this.registry.execute("focus-change",this.me)}toApi(){return __awaiter$1$1(this,void 0,void 0,(function*(){return this.ctxUnsubscribe=yield this._bridge.contextLib.subscribe(this.myCtxKey,(e=>this.registry.execute("context-updated",e))),this.me={id:this.id,name:this.name,isFocused:!1,getURL:this.getURL.bind(this),moveResize:this.moveResize.bind(this),resizeTo:this.resizeTo.bind(this),moveTo:this.moveTo.bind(this),focus:this.focus.bind(this),close:this.close.bind(this),getTitle:this.getTitle.bind(this),setTitle:this.setTitle.bind(this),getBounds:this.getBounds.bind(this),getContext:this.getContext.bind(this),updateContext:this.updateContext.bind(this),setContext:this.setContext.bind(this),onContextUpdated:this.onContextUpdated.bind(this),onFocusChanged:this.onFocusChanged.bind(this),getChannel:this.getChannel.bind(this)},this.me}))}getURL(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations$9.getUrl,{windowId:this.id})).url}))}onFocusChanged(e){if("function"!=typeof e)throw new Error("Cannot subscribe to context changes, because the provided callback is not a function!");return this.registry.add("focus-change",e)}moveResize(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=boundsDecoder.runWithException(e),n=Object.assign({},t,{windowId:this.id,relative:!1});return yield this._bridge.send("windows",operations$9.moveResize,n),this.me}))}resizeTo(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){if(void 0===e&&void 0===t)return this.me;void 0!==e&&nonNegativeNumberDecoder$3.runWithException(e),void 0!==t&&nonNegativeNumberDecoder$3.runWithException(t);const n=Object.assign({},{width:e,height:t},{windowId:this.id,relative:!0});return yield this._bridge.send("windows",operations$9.moveResize,n),this.me}))}moveTo(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){if(void 0===e&&void 0===t)return this.me;void 0!==e&&number$1$1().runWithException(e),void 0!==t&&number$1$1().runWithException(t);const n=Object.assign({},{top:e,left:t},{windowId:this.id,relative:!0});return yield this._bridge.send("windows",operations$9.moveResize,n),this.me}))}focus(){return __awaiter$1$1(this,void 0,void 0,(function*(){return"Platform"===this.name?window.open(void 0,this.id):yield this._bridge.send("windows",operations$9.focus,{windowId:this.id}),this.me}))}close(){return __awaiter$1$1(this,void 0,void 0,(function*(){return yield this._bridge.send("windows",operations$9.close,{windowId:this.id}),this.me}))}getTitle(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations$9.getTitle,{windowId:this.id})).title}))}setTitle(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=nonEmptyStringDecoder$3.runWithException(e);return yield this._bridge.send("windows",operations$9.setTitle,{windowId:this.id,title:t}),this.me}))}getBounds(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations$9.getBounds,{windowId:this.id})).bounds}))}getContext(){return __awaiter$1$1(this,void 0,void 0,(function*(){return yield this._bridge.contextLib.get(this.myCtxKey)}))}updateContext(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=anyDecoder$1.runWithException(e);return yield this._bridge.contextLib.update(this.myCtxKey,t),this.me}))}setContext(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=anyDecoder$1.runWithException(e);return yield this._bridge.contextLib.set(this.myCtxKey,t),this.me}))}onContextUpdated(e){if("function"!=typeof e)throw new Error("Cannot subscribe to context changes, because the provided callback is not a function!");return this.registry.add("context-updated",(t=>{e(t,this.me)}))}getChannel(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this._bridge.send("windows",operations$9.getChannel,{windowId:this.id},void 0,{includeOperationCheck:!0})).channel}))}}const systemOperations={operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder$1,resultDecoder:operationCheckResultDecoder$1},getWorkspaceWindowFrameBounds:{name:"getWorkspaceWindowFrameBounds",resultDecoder:workspaceFrameBoundsResultDecoder,dataDecoder:simpleItemIdDecoder}},PromiseWrap$1=(e,t,n)=>new Promise(((r,i)=>{let o=!0;const l=setTimeout((()=>{if(!o)return;o=!1;i(n||`Promise timeout hit: ${t}`)}),t);e().then((e=>{o&&(o=!1,clearTimeout(l),r(e))})).catch((e=>{o&&(o=!1,clearTimeout(l),i(e))}))})),PromisePlus$1$1=(e,t,n)=>new Promise(((r,i)=>{const o=setTimeout((()=>{i(n||`Promise timeout hit: ${t}`)}),t);new Promise(e).then((e=>{clearTimeout(o),r(e)})).catch((e=>{clearTimeout(o),i(e)}))}));let WindowsController$1=class{constructor(){this.registry=lib$3$1(),this.allWindowProjections=[]}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("windows.controller.web"),this.logger.trace("starting the web windows controller"),this.publicWindowId=t.publicWindowId,this.addWindowOperationExecutors(),this.ioc=t,this.bridge=t.bridge,this.instanceId=e.interop.instance.instance,this.channelsController=t.channelsController,this.logger.trace(`set the public window id: ${this.publicWindowId}, set the bridge operations and ioc, registering with the platform now`),this.platformRegistration=this.registerWithPlatform(),yield this.platformRegistration,yield this.initializeFocusTracking(),this.logger.trace("registration with the platform successful, attaching the windows property to glue and returning");const n=this.toApi();e.windows=n}))}handlePlatformShutdown(){this.registry.clear(),this.allWindowProjections=[],this.focusEventHandler&&(document.removeEventListener("visibilityChange",this.focusEventHandler),window.removeEventListener("focus",this.focusEventHandler),window.removeEventListener("blur",this.focusEventHandler))}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.platformRegistration;const t=windowOperationTypesDecoder.runWithException(e.operation),n=operations$9[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=n.dataDecoder.runWithException(e.data)),yield n.execute(r)}))}open(e,t,n){return __awaiter$1$1(this,void 0,void 0,(function*(){nonEmptyStringDecoder$3.runWithException(e),nonEmptyStringDecoder$3.runWithException(t);const r=windowOpenSettingsDecoder$1.runWithException(n),i=yield this.bridge.send("windows",operations$9.openWindow,{name:e,url:t,options:r});return this.waitForWindowAdded(i.windowId)}))}list(){return this.allWindowProjections.map((e=>e.api))}findById(e){var t;return nonEmptyStringDecoder$3.runWithException(e),null===(t=this.allWindowProjections.find((t=>t.id===e)))||void 0===t?void 0:t.api}toApi(){return{open:this.open.bind(this),my:this.my.bind(this),list:this.list.bind(this),findById:this.findById.bind(this),onWindowAdded:this.onWindowAdded.bind(this),onWindowRemoved:this.onWindowRemoved.bind(this),onWindowGotFocus:this.onWindowGotFocus.bind(this),onWindowLostFocus:this.onWindowLostFocus.bind(this)}}addWindowOperationExecutors(){operations$9.focusChange.execute=this.handleFocusChangeEvent.bind(this),operations$9.windowAdded.execute=this.handleWindowAdded.bind(this),operations$9.windowRemoved.execute=this.handleWindowRemoved.bind(this),operations$9.getBounds.execute=this.handleGetBounds.bind(this),operations$9.getFrameBounds.execute=this.handleGetBounds.bind(this),operations$9.getTitle.execute=this.handleGetTitle.bind(this),operations$9.getUrl.execute=this.handleGetUrl.bind(this),operations$9.moveResize.execute=this.handleMoveResize.bind(this),operations$9.setTitle.execute=this.handleSetTitle.bind(this),operations$9.getChannel.execute=this.handleGetChannel.bind(this)}my(){return Object.assign({},this.me)}onWindowAdded(e){if("function"!=typeof e)throw new Error("Cannot subscribe to window added, because the provided callback is not a function!");return this.registry.add("window-added",e)}onWindowRemoved(e){if("function"!=typeof e)throw new Error("Cannot subscribe to window removed, because the provided callback is not a function!");return this.registry.add("window-removed",e)}onWindowGotFocus(e){if("function"!=typeof e)throw new Error("Cannot subscribe to onWindowGotFocus, because the provided callback is not a function!");return this.registry.add("window-got-focus",e)}onWindowLostFocus(e){if("function"!=typeof e)throw new Error("Cannot subscribe to onWindowLostFocus, because the provided callback is not a function!");return this.registry.add("window-lost-focus",e)}sayHello(){return __awaiter$1$1(this,void 0,void 0,(function*(){return yield this.bridge.send("windows",operations$9.windowHello,{windowId:this.publicWindowId})}))}registerWithPlatform(){return __awaiter$1$1(this,void 0,void 0,(function*(){const{windows:e,isWorkspaceFrame:t}=yield this.sayHello();if(this.isWorkspaceFrame=t,this.logger.trace("the platform responded to the hello message"),!this.isWorkspaceFrame&&this.publicWindowId){this.logger.trace("i am not treated as a workspace frame, setting my window");const t=e.find((e=>e.windowId===this.publicWindowId));if(!t)throw new Error("Cannot initialize the window library, because I received no information about me from the platform");const n=yield this.ioc.buildWebWindow(this.publicWindowId,t.name);this.me=n.api,this.allWindowProjections.push(n)}const n=yield Promise.all(e.filter((e=>e.windowId!==this.publicWindowId)).map((e=>this.ioc.buildWebWindow(e.windowId,e.name))));this.logger.trace("all windows projections are completed, building the list collection"),this.allWindowProjections.push(...n)}))}handleFocusChangeEvent(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.allWindowProjections.find((t=>t.id===e.windowId));if(!t)return;t.model.processSelfFocusEvent(e.hasFocus);const n=e.hasFocus?"window-got-focus":"window-lost-focus";this.registry.execute(n,t.api)}))}handleWindowAdded(e){return __awaiter$1$1(this,void 0,void 0,(function*(){if(this.allWindowProjections.some((t=>t.id===e.windowId)))return;const t=yield this.ioc.buildWebWindow(e.windowId,e.name);this.allWindowProjections.push(t),this.registry.execute("window-added",t.api)}))}handleWindowRemoved(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.allWindowProjections.find((t=>t.id===e.windowId));t&&(this.allWindowProjections=this.allWindowProjections.filter((t=>t.id!==e.windowId)),t.model.clean(),this.registry.execute("window-removed",t.api))}))}handleGetBounds(){return __awaiter$1$1(this,void 0,void 0,(function*(){if(!this.me&&!this.isWorkspaceFrame)throw new Error("This window cannot report it's bounds, because it is not a Glue Window, most likely because it is an iframe");return{windowId:this.isWorkspaceFrame?"noop":this.me.id,bounds:{top:window.screenTop,left:window.screenLeft,width:window.innerWidth,height:window.innerHeight}}}))}handleGetTitle(){return __awaiter$1$1(this,void 0,void 0,(function*(){if(!this.me)throw new Error("This window cannot report it's title, because it is not a Glue Window, most likely because it is an iframe");return{windowId:this.me.id,title:document.title}}))}handleGetUrl(){return __awaiter$1$1(this,void 0,void 0,(function*(){if(!this.me)throw new Error("This window cannot report it's url, because it is not a Glue Window, most likely because it is an iframe");return{windowId:this.me.id,url:window.location.href}}))}handleMoveResize(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t="number"==typeof e.top?e.top:e.relative?0:window.screenTop,n="number"==typeof e.left?e.left:e.relative?0:window.screenLeft,r="number"==typeof e.height?e.height:e.relative?0:window.innerHeight,i="number"==typeof e.width?e.width:e.relative?0:window.innerWidth,o=e.relative?window.moveBy:window.moveTo,l=e.relative?window.resizeBy:window.resizeTo;o(n,t),l(i,r)}))}handleSetTitle(e){return __awaiter$1$1(this,void 0,void 0,(function*(){document.title=e.title}))}initializeFocusTracking(){return __awaiter$1$1(this,void 0,void 0,(function*(){if(this.isWorkspaceFrame)return void this.logger.trace("Ignoring the focus tracking, because this client is a workspace frame");try{yield this.bridge.send("windows",systemOperations.operationCheck,{operation:"focusChange"})}catch(e){return void this.logger.warn("The platform of this client is outdated and does not support focus tracking, disabling focus events for this client.")}const e=document.hasFocus();yield this.transmitFocusChange(!0),e||(yield this.transmitFocusChange(!1)),this.defineEventListeners()}))}processFocusEvent(){const e=document.hasFocus();this.transmitFocusChange(e)}waitForWindowAdded(e){const t=this.allWindowProjections.find((t=>t.id===e));return t?Promise.resolve(t.api):PromisePlus$1$1((t=>{const n=this.onWindowAdded((r=>{r.id===e&&(n(),t(r))}))}),3e4,`Timed out waiting for ${e} to be announced`)}transmitFocusChange(e){var t;return __awaiter$1$1(this,void 0,void 0,(function*(){const n={windowId:(null===(t=this.me)||void 0===t?void 0:t.id)||`iframe-${this.instanceId}`,hasFocus:e};this.me&&(this.me.isFocused=e),yield this.bridge.send("windows",operations$9.focusChange,n)}))}defineEventListeners(){this.focusEventHandler=this.processFocusEvent.bind(this),document.addEventListener("visibilityChange",this.focusEventHandler),window.addEventListener("focus",this.focusEventHandler),window.addEventListener("blur",this.focusEventHandler)}handleGetChannel(){return __awaiter$1$1(this,void 0,void 0,(function*(){if(!this.me)throw new Error("This window cannot report it's channel, because it is not a Glue Window, most likely because it is an iframe");const e=this.channelsController.my();return Object.assign({},e?{channel:e}:{})}))}};const GlueWebPlatformControlName$1="T42.Web.Platform.Control",GlueWebPlatformStreamName$1="T42.Web.Platform.Stream",GlueClientControlName$1="T42.Web.Client.Control",GlueCorePlusThemesStream$1="T42.Core.Plus.Themes.Stream";class GlueBridge{constructor(e,t){this.coreGlue=e,this.communicationId=t,this.platformMethodTimeoutMs=1e4}get contextLib(){return this.coreGlue.contexts}get interopInstance(){return this.coreGlue.interop.instance.instance}stop(){return __awaiter$1$1(this,void 0,void 0,(function*(){this.running=!1,this.sub.close(),yield this.coreGlue.interop.unregister(GlueClientControlName$1)}))}start(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.running=!0,this.controllers=e,yield Promise.all([this.checkWaitMethod(GlueWebPlatformControlName$1),this.checkWaitMethod(GlueWebPlatformStreamName$1)]);const t=this.communicationId,[n]=yield Promise.all([this.coreGlue.interop.subscribe(GlueWebPlatformStreamName$1,t?{target:{instance:this.communicationId}}:void 0),this.coreGlue.interop.registerAsync(GlueClientControlName$1,((e,t,n,r)=>this.passMessageController(e,n,r)))]);this.sub=n,this.sub.onData((e=>this.passMessageController(e.data)))}))}getInteropInstance(e){const t=this.coreGlue.interop.servers().find((t=>t.windowId&&t.windowId===e));return{application:null==t?void 0:t.application,applicationName:null==t?void 0:t.applicationName,peerId:null==t?void 0:t.peerId,instance:null==t?void 0:t.instance,windowId:null==t?void 0:t.windowId}}send(e,t,n,r,i){return __awaiter$1$1(this,void 0,void 0,(function*(){if(t.dataDecoder)try{t.dataDecoder.runWithException(n)}catch(e){throw new Error(`Unexpected Web->Platform outgoing validation error: ${e.message}, for operation: ${t.name} and input: ${JSON.stringify(e.input)}`)}if(!(!(null==i?void 0:i.includeOperationCheck)||(yield this.checkOperationSupported(e,t)).isSupported))throw new Error(`Cannot complete operation: ${t.name} for domain: ${e} because this client is connected to a platform which does not support it`);try{const i=yield this.transmitMessage(e,t,n,r);return t.resultDecoder&&t.resultDecoder.runWithException(i),i}catch(e){if(e.kind)throw new Error(`Unexpected Web<-Platform incoming validation error: ${e.message}, for operation: ${t.name} and input: ${JSON.stringify(e.input)}`);throw new Error(e.message)}}))}createNotificationsSteam(){return __awaiter$1$1(this,void 0,void 0,(function*(){if(!this.coreGlue.interop.methods().some((e=>e.name===GlueCorePlusThemesStream$1)))throw new Error("Cannot subscribe to theme changes, because the underlying interop stream does not exist. Most likely this is the case when this client is not connected to Core Plus.");return this.coreGlue.interop.subscribe(GlueCorePlusThemesStream$1,this.communicationId?{target:{instance:this.communicationId}}:void 0)}))}checkOperationSupported(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){try{return yield this.send(e,systemOperations.operationCheck,{operation:t.name})}catch(e){return{isSupported:!1}}}))}checkWaitMethod(e){return PromisePlus$1$1((t=>{if(this.coreGlue.interop.methods().some((t=>{const n=t.name===e,r=!this.communicationId||t.getServers().some((e=>e.instance===this.communicationId));return n&&r})))return t();const n=this.coreGlue.interop.serverMethodAdded((r=>{const i=r.method,o=r.server,l=!this.communicationId||o.instance===this.communicationId;i.name===e&&l&&(n(),t())}))}),this.platformMethodTimeoutMs,`Cannot initiate Glue Web, because a system method's discovery timed out: ${e}`)}passMessageController(e,t,n){const r=libDomainDecoder$1.run(e.domain);if(!r.ok)return void(n&&n(`Cannot execute this client control, because of domain validation error: ${JSON.stringify(r.error)}`));const i=r.result;this.controllers[i].handleBridgeMessage(e).then((e=>{t&&t(e)})).catch((e=>{n&&n(e),console.warn(e)}))}transmitMessage(e,t,n,r){return __awaiter$1$1(this,void 0,void 0,(function*(){const i={domain:e,data:n,operation:t.name};let o;const l=`Internal Platform Communication Error. Attempted operation: ${JSON.stringify(t.name)} with data: ${JSON.stringify(n)}. `,s=this.communicationId;try{if(!this.running)throw new Error("Cannot send a control message, because the platform shut down");if(o=yield this.coreGlue.interop.invoke(GlueWebPlatformControlName$1,i,s?{instance:this.communicationId}:void 0,r),!o)throw new Error("Received unsupported result from the platform - empty result");if(!Array.isArray(o.all_return_values)||0===o.all_return_values.length)throw new Error("Received unsupported result from the platform - empty values collection")}catch(e){if(e&&e.all_errors&&e.all_errors.length){const t=e.all_errors[0].message;throw new Error(`${l} -> Inner message: ${t}`)}throw new Error(`${l} -> Inner message: ${e.message}`)}return o.all_return_values[0].returned}))}}const operations$8={appHello:{name:"appHello",dataDecoder:windowHelloDecoder,resultDecoder:appHelloSuccessDecoder$1},appDirectoryStateChange:{name:"appDirectoryStateChange",dataDecoder:appDirectoryStateChangeDecoder},instanceStarted:{name:"instanceStarted",dataDecoder:instanceDataDecoder$1},instanceStopped:{name:"instanceStopped",dataDecoder:instanceDataDecoder$1},applicationStart:{name:"applicationStart",dataDecoder:applicationStartConfigDecoder$1,resultDecoder:instanceDataDecoder$1},instanceStop:{name:"instanceStop",dataDecoder:basicInstanceDataDecoder$1},import:{name:"import"},remove:{name:"remove",dataDecoder:appRemoveConfigDecoder$1},export:{name:"export",resultDecoder:appsExportOperationDecoder$1},clear:{name:"clear"}};class AppManagerController{constructor(){this.baseApplicationsTimeoutMS=6e4,this.appImportTimeoutMS=20,this.registry=lib$3$1(),this.applications=[],this.instances=[]}handlePlatformShutdown(){this.registry.clear(),this.applications=[],this.instances=[],delete this.me}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("appManger.controller.web"),this.logger.trace("starting the web appManager controller"),this.publicWindowId=t.publicWindowId,this.addOperationsExecutors(),this.ioc=t,this.bridge=t.bridge,this.channelsController=t.channelsController,this.sessionController=t.sessionController,this.platformRegistration=this.registerWithPlatform(),yield this.platformRegistration,this.logger.trace("registration with the platform successful, attaching the appManager property to glue and returning");const n=this.toApi();e.appManager=n}))}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.platformRegistration;const t=appManagerOperationTypesDecoder$1.runWithException(e.operation),n=operations$8[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=n.dataDecoder.runWithException(e.data)),yield n.execute(r)}))}onInstanceStarted(e){if("function"!=typeof e)throw new Error("onInstanceStarted requires a single argument of type function");return this.registry.add("instance-started",e,this.instances)}onInstanceStopped(e){if("function"!=typeof e)throw new Error("onInstanceStopped requires a single argument of type function");return this.registry.add("instance-stopped",e)}startApplication(e,t,n){var r;return __awaiter$1$1(this,void 0,void 0,(function*(){const i=yield this.channelsController.all();if((null==n?void 0:n.channelId)&&!i.includes(n.channelId))throw new Error(`The channel with name "${n.channelId}" doesn't exist!`);const o={name:e,waitForAGMReady:null===(r=null==n?void 0:n.waitForAGMReady)||void 0===r||r,context:t,top:null==n?void 0:n.top,left:null==n?void 0:n.left,width:null==n?void 0:n.width,height:null==n?void 0:n.height,relativeTo:null==n?void 0:n.relativeTo,relativeDirection:null==n?void 0:n.relativeDirection,id:null==n?void 0:n.reuseId,forceChromeTab:null==n?void 0:n.forceTab,layoutComponentId:null==n?void 0:n.layoutComponentId,channelId:null==n?void 0:n.channelId},l=yield this.bridge.send("appManager",operations$8.applicationStart,o),s=this.applications.find((e=>e.name===l.applicationName));return this.ioc.buildInstance(l,s)}))}getApplication(e){const t=nonEmptyStringDecoder$3.runWithException(e);return this.applications.find((e=>e.name===t))}getInstances(){return this.instances.slice()}toApi(){return{myInstance:this.me,inMemory:{import:this.import.bind(this),remove:this.remove.bind(this),export:this.export.bind(this),clear:this.clear.bind(this)},application:this.getApplication.bind(this),applications:this.getApplications.bind(this),instances:this.getInstances.bind(this),onAppAdded:this.onAppAdded.bind(this),onAppChanged:this.onAppChanged.bind(this),onAppRemoved:this.onAppRemoved.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)}}addOperationsExecutors(){operations$8.appDirectoryStateChange.execute=this.handleAppDirectoryStateChange.bind(this),operations$8.instanceStarted.execute=this.handleInstanceStartedMessage.bind(this),operations$8.instanceStopped.execute=this.handleInstanceStoppedMessage.bind(this)}handleAppDirectoryStateChange(e){return __awaiter$1$1(this,void 0,void 0,(function*(){e.appsAdded.forEach(this.handleApplicationAddedMessage.bind(this)),e.appsChanged.forEach(this.handleApplicationChangedMessage.bind(this)),e.appsRemoved.forEach(this.handleApplicationRemovedMessage.bind(this))}))}onAppAdded(e){if("function"!=typeof e)throw new Error("onAppAdded requires a single argument of type function");return this.registry.add("application-added",e,this.applications)}onAppRemoved(e){if("function"!=typeof e)throw new Error("onAppRemoved requires a single argument of type function");return this.registry.add("application-removed",e)}onAppChanged(e){if("function"!=typeof e)throw new Error("onAppChanged requires a single argument of type function");return this.registry.add("application-changed",e)}handleApplicationAddedMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){if(this.applications.some((t=>t.name===e.name)))return;const t=yield this.ioc.buildApplication(e,[]),n=this.instances.filter((e=>e.application.name===t.name));t.instances.push(...n),this.applications.push(t),this.registry.execute("application-added",t)}))}handleApplicationRemovedMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.applications.findIndex((t=>t.name===e.name));if(t<0)return;const n=this.applications[t];this.applications.splice(t,1),this.registry.execute("application-removed",n)}))}handleApplicationChangedMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.applications.find((t=>t.name===e.name));if(!t)return this.handleApplicationAddedMessage(e);t.title=e.title,t.version=e.version,t.icon=e.icon,t.caption=e.caption,t.userProperties=e.userProperties,this.registry.execute("application-changed",t)}))}handleInstanceStartedMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){if(this.instances.some((t=>t.id===e.id)))return;const t=this.applications.find((t=>t.name===e.applicationName));if(!t)throw new Error(`Cannot add instance: ${e.id}, because there is no application definition associated with it`);const n=this.ioc.buildInstance(e,t);this.instances.push(n),t.instances.push(n),this.registry.execute("instance-started",n)}))}handleInstanceStoppedMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.instances.find((t=>t.id===e.id));if(t){const t=this.instances.findIndex((t=>t.id===e.id));this.instances.splice(t,1)}const n=this.applications.find((t=>t.instances.some((t=>t.id===e.id))));if(n){const t=n.instances.findIndex((t=>t.id===e.id));n.instances.splice(t,1)}t&&this.registry.execute("instance-stopped",t)}))}import(e,t="replace"){return __awaiter$1$1(this,void 0,void 0,(function*(){if(importModeDecoder$1.runWithException(t),!Array.isArray(e))throw new Error("Import must be called with an array of definitions");if(e.length>1e4)throw new Error("Cannot import more than 10000 app definitions in Glue42 Core.");const n=e.reduce(((e,t)=>{const n=allApplicationDefinitionsDecoder$1.run(t);return n.ok?e.valid.push(t):e.invalid.push({app:null==t?void 0:t.name,error:JSON.stringify(n.error)}),e}),{valid:[],invalid:[]}),r=this.baseApplicationsTimeoutMS+this.appImportTimeoutMS*n.valid.length;return yield this.bridge.send("appManager",operations$8.import,{definitions:n.valid,mode:t},{methodResponseTimeoutMs:r}),{imported:n.valid.map((e=>e.name)),errors:n.invalid}}))}remove(e){return __awaiter$1$1(this,void 0,void 0,(function*(){nonEmptyStringDecoder$3.runWithException(e),yield this.bridge.send("appManager",operations$8.remove,{name:e},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})}))}clear(){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.bridge.send("appManager",operations$8.clear,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})}))}export(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("appManager",operations$8.export,void 0,{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS})).definitions}))}getApplications(){return this.applications.slice()}joinInitialChannel(e){return __awaiter$1$1(this,void 0,void 0,(function*(){try{yield this.channelsController.join(e)}catch(t){this.logger.warn(`Application instance ${this.me} was unable to join the ${e} channel. Reason: ${JSON.stringify(t)}`)}}))}registerWithPlatform(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=yield this.bridge.send("appManager",operations$8.appHello,{windowId:this.publicWindowId},{methodResponseTimeoutMs:this.baseApplicationsTimeoutMS});this.logger.trace("the platform responded to the hello message with a full list of apps"),this.applications=yield Promise.all(e.apps.map((e=>this.ioc.buildApplication(e,e.instances)))),this.instances=this.applications.reduce(((e,t)=>(e.push(...t.instances),e)),[]),this.me=this.findMyInstance(),this.logger.trace(`all applications were parsed and saved. I am ${this.me?"NOT a":"a"} valid instance`);const{channels:t}=this.sessionController.getWindowData(),n=t?t.currentName:e.initialChannelId;n&&(yield this.joinInitialChannel(n))}))}findMyInstance(){for(const e of this.applications){const t=e.instances.find((e=>e.id===this.publicWindowId));if(t)return t}}}class InstanceModel{constructor(e,t,n){this.data=e,this.bridge=t,this.application=n,this.myCtxKey=`___instance___${this.data.id}`}toApi(){const e=this.bridge.getInteropInstance(this.data.id),t={id:this.data.id,agm:e,application:this.application,stop:this.stop.bind(this),getContext:this.getContext.bind(this)};return this.me=Object.freeze(t),this.me}getContext(){return __awaiter$1$1(this,void 0,void 0,(function*(){return this.bridge.contextLib.get(this.myCtxKey)}))}stop(){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.bridge.send("appManager",operations$8.instanceStop,{id:this.data.id})}))}}class ApplicationModel{constructor(e,t,n){this.data=e,this.instances=t,this.controller=n}toApi(){const e={name:this.data.name,title:this.data.title,version:this.data.version,icon:this.data.icon,caption:this.data.caption,userProperties:this.data.userProperties,instances:this.instances,start:this.start.bind(this),onInstanceStarted:this.onInstanceStarted.bind(this),onInstanceStopped:this.onInstanceStopped.bind(this)};return this.me=e,this.me}onInstanceStarted(e){if("function"!=typeof e)throw new Error("OnInstanceStarted requires a single argument of type function");return this.controller.onInstanceStarted((t=>{t.application.name===this.data.name&&e(t)}))}onInstanceStopped(e){if("function"!=typeof e)throw new Error("OnInstanceStarted requires a single argument of type function");return this.controller.onInstanceStopped((t=>{t.application.name===this.data.name&&e(t)}))}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const n=startApplicationContextDecoder.runWithException(e),r=startApplicationOptionsDecoder.runWithException(t);return this.controller.startApplication(this.data.name,n,r)}))}}const operations$7={layoutAdded:{name:"layoutAdded",dataDecoder:glueLayoutDecoder$1},layoutChanged:{name:"layoutChanged",dataDecoder:glueLayoutDecoder$1},layoutRemoved:{name:"layoutRemoved",dataDecoder:glueLayoutDecoder$1},get:{name:"get",dataDecoder:simpleLayoutConfigDecoder$1,resultDecoder:optionalSimpleLayoutResult$1},getAll:{name:"getAll",dataDecoder:getAllLayoutsConfigDecoder$1,resultDecoder:allLayoutsSummariesResultDecoder$1},export:{name:"export",dataDecoder:getAllLayoutsConfigDecoder$1,resultDecoder:allLayoutsFullConfigDecoder$1},import:{name:"import",dataDecoder:layoutsImportConfigDecoder$1},remove:{name:"remove",dataDecoder:simpleLayoutConfigDecoder$1},save:{name:"save",dataDecoder:saveLayoutConfigDecoder$1,resultDecoder:simpleLayoutResultDecoder},restore:{name:"restore",dataDecoder:restoreLayoutConfigDecoder$1},clientSaveRequest:{name:"clientSaveRequest",dataDecoder:platformSaveRequestConfigDecoder,resultDecoder:saveRequestClientResponseDecoder},getGlobalPermissionState:{name:"getGlobalPermissionState",resultDecoder:permissionStateResultDecoder$1},requestGlobalPermission:{name:"requestGlobalPermission",resultDecoder:simpleAvailabilityResultDecoder$1},checkGlobalActivated:{name:"checkGlobalActivated",resultDecoder:simpleAvailabilityResultDecoder$1},getDefaultGlobal:{name:"getDefaultGlobal",resultDecoder:optionalSimpleLayoutResult$1},setDefaultGlobal:{name:"setDefaultGlobal",dataDecoder:setDefaultGlobalConfigDecoder$1},clearDefaultGlobal:{name:"clearDefaultGlobal"}};let LayoutsController$1=class{constructor(){this.defaultLayoutRestoreTimeoutMS=12e4,this.registry=lib$3$1()}handlePlatformShutdown(){this.registry.clear()}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("layouts.controller.web"),this.logger.trace("starting the web layouts controller"),this.bridge=t.bridge,this.windowsController=t.windowsController,this.addOperationsExecutors();const n=this.toApi();this.logger.trace("no need for platform registration, attaching the layouts property to glue and returning"),e.layouts=n}))}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=layoutsOperationTypesDecoder$1.runWithException(e.operation),n=operations$7[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=n.dataDecoder.runWithException(e.data)),yield n.execute(r)}))}toApi(){const e={get:this.get.bind(this),getAll:this.getAll.bind(this),export:this.export.bind(this),import:this.import.bind(this),save:this.save.bind(this),restore:this.restore.bind(this),remove:this.remove.bind(this),onAdded:this.onAdded.bind(this),onChanged:this.onChanged.bind(this),onRemoved:this.onRemoved.bind(this),onSaveRequested:this.subscribeOnSaveRequested.bind(this),getMultiScreenPermissionState:this.getGlobalPermissionState.bind(this),requestMultiScreenPermission:this.requestGlobalPermission.bind(this),getGlobalTypeState:this.checkGlobalActivated.bind(this),getDefaultGlobal:this.getDefaultGlobal.bind(this),setDefaultGlobal:this.setDefaultGlobal.bind(this),clearDefaultGlobal:this.clearDefaultGlobal.bind(this)};return Object.freeze(e)}addOperationsExecutors(){operations$7.layoutAdded.execute=this.handleOnAdded.bind(this),operations$7.layoutChanged.execute=this.handleOnChanged.bind(this),operations$7.layoutRemoved.execute=this.handleOnRemoved.bind(this),operations$7.clientSaveRequest.execute=this.handleSaveRequest.bind(this)}get(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){nonEmptyStringDecoder$3.runWithException(e),layoutTypeDecoder$1.runWithException(t);return(yield this.bridge.send("layouts",operations$7.get,{name:e,type:t})).layout}))}getAll(e){return __awaiter$1$1(this,void 0,void 0,(function*(){layoutTypeDecoder$1.runWithException(e);return(yield this.bridge.send("layouts",operations$7.getAll,{type:e})).summaries}))}export(e){return __awaiter$1$1(this,void 0,void 0,(function*(){layoutTypeDecoder$1.runWithException(e);return(yield this.bridge.send("layouts",operations$7.export,{type:e})).layouts}))}import(e,t="replace"){return __awaiter$1$1(this,void 0,void 0,(function*(){if(importModeDecoder$1.runWithException(t),!Array.isArray(e))throw new Error("Import must be called with an array of layouts");if(e.length>1e3)throw new Error("Cannot import more than 1000 layouts at once in Glue42 Core.");const n=e.reduce(((e,t)=>{const n=glueLayoutDecoder$1.run(t);return n.ok?e.valid.push(t):this.logger.warn(`A layout with name: ${t.name} was not imported, because of error: ${JSON.stringify(n.error)}`),e}),{valid:[]}),r=e.filter((e=>n.valid.some((t=>t.name===e.name))));yield this.bridge.send("layouts",operations$7.import,{layouts:r,mode:t})}))}save(e){return __awaiter$1$1(this,void 0,void 0,(function*(){newLayoutOptionsDecoder$1.runWithException(e);return(yield this.bridge.send("layouts",operations$7.save,{layout:e})).layout}))}restore(e){return __awaiter$1$1(this,void 0,void 0,(function*(){restoreOptionsDecoder$1.runWithException(e);const t=e.timeout?2*e.timeout:this.defaultLayoutRestoreTimeoutMS;yield this.bridge.send("layouts",operations$7.restore,{layout:e},{methodResponseTimeoutMs:t})}))}remove(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){layoutTypeDecoder$1.runWithException(e),nonEmptyStringDecoder$3.runWithException(t),yield this.bridge.send("layouts",operations$7.remove,{type:e,name:t})}))}handleSaveRequest(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t={};if(this.saveRequestSubscription)try{const n=this.saveRequestSubscription(e);t.windowContext=null==n?void 0:n.windowContext}catch(e){this.logger.warn(`An error was thrown by the onSaveRequested callback, ignoring the callback: ${JSON.stringify(e)}`)}return t}))}getGlobalPermissionState(){return __awaiter$1$1(this,void 0,void 0,(function*(){return yield this.bridge.send("layouts",operations$7.getGlobalPermissionState,void 0)}))}requestGlobalPermission(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=(yield this.getGlobalPermissionState()).state;if("denied"===e)return{permissionGranted:!1};if("granted"===e)return{permissionGranted:!0};const t=this.windowsController.my(),n=(window.glue42core||window.iobrowser).isPlatformFrame;if("Platform"!==t.name&&!n)throw new Error("Cannot request permission for multi-window placement from any app other than the Platform.");return{permissionGranted:(yield this.bridge.send("layouts",operations$7.requestGlobalPermission,void 0,{methodResponseTimeoutMs:18e4})).isAvailable}}))}checkGlobalActivated(){return __awaiter$1$1(this,void 0,void 0,(function*(){return{activated:(yield this.bridge.send("layouts",operations$7.checkGlobalActivated,void 0)).isAvailable}}))}getDefaultGlobal(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("layouts",operations$7.getDefaultGlobal,void 0,void 0,{includeOperationCheck:!0})).layout}))}setDefaultGlobal(e){return __awaiter$1$1(this,void 0,void 0,(function*(){nonEmptyStringDecoder$3.runWithException(e),yield this.bridge.send("layouts",operations$7.setDefaultGlobal,{name:e},void 0,{includeOperationCheck:!0})}))}clearDefaultGlobal(){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.bridge.send("layouts",operations$7.clearDefaultGlobal,void 0,void 0,{includeOperationCheck:!0})}))}onAdded(e){return this.export("Global").then((t=>t.forEach((t=>e(t))))).catch((()=>{})),this.export("Workspace").then((t=>t.forEach((t=>e(t))))).catch((()=>{})),this.registry.add(operations$7.layoutAdded.name,e)}onChanged(e){return this.registry.add(operations$7.layoutChanged.name,e)}onRemoved(e){return this.registry.add(operations$7.layoutRemoved.name,e)}subscribeOnSaveRequested(e){if("function"!=typeof e)throw new Error("Cannot subscribe to onSaveRequested, because the provided argument is not a valid callback function.");if(this.saveRequestSubscription)throw new Error("Cannot subscribe to onSaveRequested, because this client has already subscribed and only one subscription is supported. Consider unsubscribing from the initial one.");return this.saveRequestSubscription=e,()=>{delete this.saveRequestSubscription}}handleOnAdded(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.registry.execute(operations$7.layoutAdded.name,e)}))}handleOnChanged(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.registry.execute(operations$7.layoutChanged.name,e)}))}handleOnRemoved(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.registry.execute(operations$7.layoutRemoved.name,e)}))}};const operations$6={raiseNotification:{name:"raiseNotification",dataDecoder:raiseNotificationDecoder$1,resultDecoder:raiseNotificationResultDecoder$1},requestPermission:{name:"requestPermission",resultDecoder:permissionRequestResultDecoder$1},notificationShow:{name:"notificationShow",dataDecoder:notificationEventPayloadDecoder},notificationClick:{name:"notificationClick",dataDecoder:notificationEventPayloadDecoder},getPermission:{name:"getPermission",resultDecoder:permissionQueryResultDecoder$1},list:{name:"list",resultDecoder:allNotificationsDataDecoder$1},notificationRaised:{name:"notificationRaised",dataDecoder:simpleNotificationDataDecoder},notificationClosed:{name:"notificationClosed",dataDecoder:simpleNotificationSelectDecoder$1},click:{name:"click"},clear:{name:"clear"},clearAll:{name:"clearAll"},clearOld:{name:"clearOld"},configure:{name:"configure",dataDecoder:notificationsConfigurationProtocolDecoder$1},getConfiguration:{name:"getConfiguration",resultDecoder:strictNotificationsConfigurationProtocolDecoder},configurationChanged:{name:"configurationChanged",resultDecoder:strictNotificationsConfigurationProtocolDecoder},setState:{name:"setState",dataDecoder:notificationSetStateRequestDecoder$1},activeCountChange:{name:"activeCountChange",resultDecoder:activeNotificationsCountChangeDecoder},stateChange:{name:"stateChange",resultDecoder:notificationSetStateRequestDecoder$1}};var shortidExports$1={},shortid$3$1={get exports(){return shortidExports$1},set exports(e){shortidExports$1=e}},libExports$1$1={},lib$2$1={get exports(){return libExports$1$1},set exports(e){libExports$1$1=e}},seed$1$1=1;function getNextValue$1$1(){return(seed$1$1=(9301*seed$1$1+49297)%233280)/233280}function setSeed$3$1(e){seed$1$1=e}var randomFromSeed$3$1={nextValue:getNextValue$1$1,seed:setSeed$3$1},randomFromSeed$2$1=randomFromSeed$3$1,ORIGINAL$1$1="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$5$1,previousSeed$1$1,shuffled$1$1;function reset$1$1(){shuffled$1$1=!1}function setCharacters$1$1(e){if(e){if(e!==alphabet$5$1){if(e.length!==ORIGINAL$1$1.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$1$1.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$1$1.length+" unique characters. These characters were not unique: "+t.join(", "));alphabet$5$1=e,reset$1$1()}}else alphabet$5$1!==ORIGINAL$1$1&&(alphabet$5$1=ORIGINAL$1$1,reset$1$1())}function characters$1$1(e){return setCharacters$1$1(e),alphabet$5$1}function setSeed$2$1(e){randomFromSeed$2$1.seed(e),previousSeed$1$1!==e&&(reset$1$1(),previousSeed$1$1=e)}function shuffle$1$1(){alphabet$5$1||setCharacters$1$1(ORIGINAL$1$1);for(var e,t=alphabet$5$1.split(""),n=[],r=randomFromSeed$2$1.nextValue();t.length>0;)r=randomFromSeed$2$1.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function getShuffled$1$1(){return shuffled$1$1||(shuffled$1$1=shuffle$1$1())}function lookup$1$1(e){return getShuffled$1$1()[e]}function get$1$1(){return alphabet$5$1||ORIGINAL$1$1}var alphabet_1$1$1={get:get$1$1,characters:characters$1$1,seed:setSeed$2$1,lookup:lookup$1$1,shuffled:getShuffled$1$1},crypto$1$1="object"==typeof window&&(window.crypto||window.msCrypto),randomByte$1$1;randomByte$1$1=crypto$1$1&&crypto$1$1.getRandomValues?function(e){return crypto$1$1.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t};var randomByteBrowser$1$1=randomByte$1$1,format_browser$1$1=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*r*n/t.length),o="";;)for(var l=e(i),s=i;s--;)if((o+=t[l[s]&r]||"").length===+n)return o},alphabet$4$1=alphabet_1$1$1,random$1$1=randomByteBrowser$1$1,format$1$1=format_browser$1$1;function generate$3$1(e){for(var t,n=0,r="";!t;)r+=format$1$1(random$1$1,alphabet$4$1.get(),1),t=e<Math.pow(16,n+1),n++;return r}var generate_1$1$1=generate$3$1,generate$2$1=generate_1$1$1,REDUCE_TIME$1$1=1567752802062,version$3$1=7,counter$1$1,previousSeconds$1$1;function build$1$1(e){var t="",n=Math.floor(.001*(Date.now()-REDUCE_TIME$1$1));return n===previousSeconds$1$1?counter$1$1++:(counter$1$1=0,previousSeconds$1$1=n),t+=generate$2$1(version$3$1),t+=generate$2$1(e),counter$1$1>0&&(t+=generate$2$1(counter$1$1)),t+=generate$2$1(n)}var build_1$1$1=build$1$1,alphabet$3$1=alphabet_1$1$1;function isShortId$1$1(e){return!(!e||"string"!=typeof e||e.length<6)&&!new RegExp("[^"+alphabet$3$1.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}var isValid$1$1=isShortId$1$1;!function(e){var t=alphabet_1$1$1,n=build_1$1$1,r=isValid$1$1,i=0;function o(){return n(i)}e.exports=o,e.exports.generate=o,e.exports.seed=function(n){return t.seed(n),e.exports},e.exports.worker=function(t){return i=t,e.exports},e.exports.characters=function(e){return void 0!==e&&t.characters(e),t.shuffled()},e.exports.isValid=r}(lib$2$1),function(e){e.exports=libExports$1$1}(shortid$3$1);var shortid$2$1=getDefaultExportFromCjs$1$1(shortidExports$1);let NotificationsController$1=class{constructor(){this.registry=lib$3$1(),this.notifications={}}handlePlatformShutdown(){this.notifications={},this.registry.clear()}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("notifications.controller.web"),this.logger.trace("starting the web notifications controller"),this.bridge=t.bridge,this.coreGlue=e,this.notificationsSettings=t.config.notifications,this.buildNotificationFunc=t.buildNotification;const n=this.toApi();this.addOperationExecutors(),e.notifications=n,this.logger.trace("notifications are ready")}))}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=notificationsOperationTypesDecoder.runWithException(e.operation),n=operations$6[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=n.dataDecoder.runWithException(e.data)),yield n.execute(r)}))}toApi(){const e={raise:this.raise.bind(this),requestPermission:this.requestPermission.bind(this),getPermission:this.getPermission.bind(this),list:this.list.bind(this),onRaised:this.onRaised.bind(this),onClosed:this.onClosed.bind(this),click:this.click.bind(this),clear:this.clear.bind(this),clearAll:this.clearAll.bind(this),clearOld:this.clearOld.bind(this),configure:this.configure.bind(this),getConfiguration:this.getConfiguration.bind(this),getFilter:this.getFilter.bind(this),setFilter:this.setFilter.bind(this),setState:this.setState.bind(this),onConfigurationChanged:this.onConfigurationChanged.bind(this),onActiveCountChanged:this.onActiveCountChanged.bind(this),onStateChanged:this.onStateChanged.bind(this)};return Object.freeze(e)}getPermission(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("notifications",operations$6.getPermission,void 0)).permission}))}requestPermission(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("notifications",operations$6.requestPermission,void 0)).permissionGranted}))}raise(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=glue42NotificationOptionsDecoder$1.runWithException(e);t.showToast="boolean"!=typeof t.showToast||t.showToast,t.showInPanel="boolean"!=typeof t.showInPanel||t.showInPanel;if(!(yield this.requestPermission()))throw new Error("Cannot raise the notification, because the user has declined the permission request");const n=shortidExports$1.generate(),r=yield this.bridge.send("notifications",operations$6.raiseNotification,{settings:t,id:n}),i=this.buildNotificationFunc(r.settings,n);return this.notifications[n]=i,i}))}list(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("notifications",operations$6.list,void 0,void 0,{includeOperationCheck:!0})).notifications}))}onRaised(e){if("function"!=typeof e)throw new Error("onRaised expects a callback of type function");return this.registry.add("notification-raised",e)}onClosed(e){if("function"!=typeof e)throw new Error("onRaised expects a callback of type function");return this.registry.add("notification-closed",e)}click(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){nonEmptyStringDecoder$3.runWithException(e),t&&nonEmptyStringDecoder$3.runWithException(t),yield this.bridge.send("notifications",operations$6.click,{id:e,action:t},void 0,{includeOperationCheck:!0})}))}clear(e){return __awaiter$1$1(this,void 0,void 0,(function*(){nonEmptyStringDecoder$3.runWithException(e),yield this.bridge.send("notifications",operations$6.clear,{id:e},void 0,{includeOperationCheck:!0})}))}clearAll(){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.bridge.send("notifications",operations$6.clearAll,void 0,void 0,{includeOperationCheck:!0})}))}clearOld(){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.bridge.send("notifications",operations$6.clearOld,void 0,void 0,{includeOperationCheck:!0})}))}configure(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=notificationsConfigurationDecoder$1.runWithException(e);yield this.bridge.send("notifications",operations$6.configure,{configuration:t},void 0,{includeOperationCheck:!0})}))}getConfiguration(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("notifications",operations$6.getConfiguration,void 0,void 0,{includeOperationCheck:!0})).configuration}))}getFilter(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("notifications",operations$6.getConfiguration,void 0,void 0,{includeOperationCheck:!0})).configuration.sourceFilter}))}setFilter(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=notificationFilterDecoder$1.runWithException(e);return yield this.bridge.send("notifications",operations$6.configure,{configuration:{sourceFilter:t}},void 0,{includeOperationCheck:!0}),t}))}setState(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){nonEmptyStringDecoder$3.runWithException(e),notificationStateDecoder$1.runWithException(t),yield this.bridge.send("notifications",operations$6.setState,{id:e,state:t},void 0,{includeOperationCheck:!0})}))}onConfigurationChanged(e){if("function"!=typeof e)throw new Error("Cannot subscribe to configuration changed, because the provided callback is not a function!");return this.registry.add("notifications-config-changed",e)}onActiveCountChanged(e){if("function"!=typeof e)throw new Error("Cannot subscribe to onActiveCountChanged changed, because the provided callback is not a function!");return this.registry.add("notifications-active-count-changed",e)}onStateChanged(e){if("function"!=typeof e)throw new Error("Cannot subscribe to onStateChanged changed, because the provided callback is not a function!");return this.registry.add("notification-state-changed",e)}addOperationExecutors(){operations$6.notificationShow.execute=this.handleNotificationShow.bind(this),operations$6.notificationClick.execute=this.handleNotificationClick.bind(this),operations$6.notificationRaised.execute=this.handleNotificationRaised.bind(this),operations$6.notificationClosed.execute=this.handleNotificationClosed.bind(this),operations$6.configurationChanged.execute=this.handleConfigurationChanged.bind(this),operations$6.activeCountChange.execute=this.handleActiveCountChanged.bind(this),operations$6.stateChange.execute=this.handleNotificationStateChanged.bind(this)}handleConfigurationChanged(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.registry.execute("notifications-config-changed",e.configuration)}))}handleActiveCountChanged(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.registry.execute("notifications-active-count-changed",e)}))}handleNotificationStateChanged(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.registry.execute("notification-state-changed",{id:e.id},e.state)}))}handleNotificationShow(e){return __awaiter$1$1(this,void 0,void 0,(function*(){if(!e.id)return;const t=this.notifications[e.id];t&&t.onshow&&t.onshow()}))}handleNotificationClick(e){var t,n,r,i,o;return __awaiter$1$1(this,void 0,void 0,(function*(){if(!e.action&&(null===(t=this.notificationsSettings)||void 0===t?void 0:t.defaultClick)&&this.notificationsSettings.defaultClick(this.coreGlue,e.definition),e.action&&(null===(r=null===(n=this.notificationsSettings)||void 0===n?void 0:n.actionClicks)||void 0===r?void 0:r.some((t=>t.action===e.action)))){(null===(o=null===(i=this.notificationsSettings)||void 0===i?void 0:i.actionClicks)||void 0===o?void 0:o.find((t=>t.action===e.action))).handler(this.coreGlue,e.definition)}if(!e.id)return;const l=this.notifications[e.id];l&&l.onclick&&(l.onclick(),delete this.notifications[e.id])}))}handleNotificationRaised(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.registry.execute("notification-raised",e.notification)}))}handleNotificationClosed(e){return __awaiter$1$1(this,void 0,void 0,(function*(){this.registry.execute("notification-closed",e)}))}};const operations$5={getIntents:{name:"getIntents",resultDecoder:wrappedIntentsDecoder$1},findIntent:{name:"findIntent",dataDecoder:wrappedIntentFilterDecoder$1,resultDecoder:wrappedIntentsDecoder$1},raiseIntent:{name:"raiseIntent",dataDecoder:intentRequestDecoder$1,resultDecoder:intentResultDecoder$1},raise:{name:"raise",dataDecoder:raiseIntentRequestDecoder$1,resultDecoder:intentResultDecoder$1},filterHandlers:{name:"filterHandlers",dataDecoder:filterHandlersWithResolverConfigDecoder$1,resultDecoder:filterHandlersResultDecoder$1},getIntentsByHandler:{name:"getIntentsByHandler",dataDecoder:intentHandlerDecoder$1,resultDecoder:getIntentsResultDecoder$1}},GLUE42_FDC3_INTENTS_METHOD_PREFIX="Tick42.FDC3.Intents.",INTENTS_RESOLVER_INTEROP_PREFIX$1="T42.Intents.Resolver.Control.",INTENTS_RESOLVER_APP_NAME="intentsResolver",DEFAULT_RESOLVER_RESPONSE_TIMEOUT=6e4,ADDITIONAL_BRIDGE_OPERATION_TIMEOUT=3e4,INTENTS_RESOLVER_WIDTH$1=400,INTENTS_RESOLVER_HEIGHT$1=440,MAX_SET_TIMEOUT_DELAY=2147483647,DEFAULT_PICK_HANDLER_BY_TIMEOUT=9e4;let IntentsController$1=class{constructor(){this.myIntents=new Set,this.useIntentsResolverUI=!0,this.unregisterIntentPromises=[]}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("intents.controller.web"),this.logger.trace("starting the web intents controller"),this.bridge=t.bridge,this.interop=e.interop,this.legacyIntentsController=t.legacyIntentsHelper,this.checkIfIntentsResolverIsEnabled(t.config);const n=this.toApi();this.logger.trace("no need for platform registration, attaching the intents property to glue and returning"),e.intents=n}))}handlePlatformShutdown(){this.myIntents=new Set,this.unregisterIntentPromises=[]}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=intentsOperationTypesDecoder$1.runWithException(e.operation),n=operations$5[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=n.dataDecoder.runWithException(e.data)),yield n.execute(r)}))}toApi(){return{raise:this.raise.bind(this),all:this.all.bind(this),addIntentListener:this.addIntentListener.bind(this),register:this.register.bind(this),find:this.find.bind(this),filterHandlers:this.filterHandlers.bind(this),getIntents:this.getIntentsByHandler.bind(this)}}raise(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=raiseRequestDecoder.runWithException(e),n="string"==typeof t?{intent:t}:t;yield Promise.all(this.unregisterIntentPromises);const r={intentRequest:n,resolverConfig:this.getResolverConfigByRequest({intentRequest:n})},i=yield this.isRaiseOperationSupported();if(!i.supported)return this.logger.warn(`${i.reason}. Invoking legacy raise method`),this.legacyIntentsController.raise(r,this.find.bind(this));this.logger.trace(`Sending raise request to the platform: ${JSON.stringify(e)} and method response timeout of ${this.intentResolverResponseTimeout}ms`);const o=n.waitUserResponseIndefinitely?MAX_SET_TIMEOUT_DELAY:(n.timeout||this.intentResolverResponseTimeout)+ADDITIONAL_BRIDGE_OPERATION_TIMEOUT;return yield this.bridge.send("intents",operations$5.raise,r,{methodResponseTimeoutMs:o,waitTimeoutMs:o})}))}getResolverConfigByRequest(e){var t,n,r,i;if(e.handlerFilter)return{enabled:"boolean"==typeof(null===(t=e.handlerFilter)||void 0===t?void 0:t.openResolver)?null===(n=e.handlerFilter)||void 0===n?void 0:n.openResolver:this.useIntentsResolverUI,appName:this.intentsResolverAppName,waitResponseTimeout:(null===(r=e.handlerFilter)||void 0===r?void 0:r.timeout)||DEFAULT_PICK_HANDLER_BY_TIMEOUT};const o=(null===(i=e.intentRequest)||void 0===i?void 0:i.waitUserResponseIndefinitely)?MAX_SET_TIMEOUT_DELAY:this.intentResolverResponseTimeout;return{enabled:this.useIntentsResolverUI,appName:this.intentsResolverAppName,waitResponseTimeout:o}}isRaiseOperationSupported(){return __awaiter$1$1(this,void 0,void 0,(function*(){try{const{isSupported:e}=yield this.bridge.send("intents",systemOperations.operationCheck,{operation:"raise"});return{supported:e,reason:e?"":'The platform of this client is outdated and does not support "raise" operation'}}catch(e){return{supported:!1,reason:'The platform of this client is outdated and does not support "operationCheck" command'}}}))}all(){return __awaiter$1$1(this,void 0,void 0,(function*(){yield Promise.all(this.unregisterIntentPromises);return(yield this.bridge.send("intents",operations$5.getIntents,void 0)).intents}))}addIntentListener(e,t){if(AddIntentListenerDecoder.runWithException(e),"function"!=typeof t)throw new Error("Cannot add intent listener, because the provided handler is not a function!");let n;const r="string"==typeof e?e:e.intent,i=this.buildInteropMethodName(r);if(this.myIntents.has(r))throw new Error(`Intent listener for intent ${r} already registered!`);this.myIntents.add(r);const o={unsubscribe:()=>{this.myIntents.delete(r),n.then((()=>this.interop.unregister(i))).catch((e=>this.logger.trace(`Unregistration of a method with name ${i} failed with reason: ${e}`)))}};let l={};if("object"==typeof e){l=__rest$2$1(e,["intent"])}return n=this.interop.register({name:i,flags:{intent:l}},(e=>{if(this.myIntents.has(r)){const n=__rest$2$1(e,["_initialCallerId"]);return t(n)}})),n.catch((e=>{this.myIntents.delete(r),this.logger.warn(`Registration of a method with name ${i} failed with reason: ${e}`)})),o}register(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){if(AddIntentListenerDecoder.runWithException(e),"function"!=typeof t)throw new Error("Cannot add intent listener, because the provided handler is not a function!");yield Promise.all(this.unregisterIntentPromises);const n="string"==typeof e?e:e.intent,r=this.buildInteropMethodName(n);if(this.myIntents.has(n))throw new Error(`Intent listener for intent ${n} already registered!`);this.myIntents.add(n);let i={};if("object"==typeof e){i=__rest$2$1(e,["intent"])}try{yield this.interop.register({name:r,flags:{intent:i}},(e=>{if(this.myIntents.has(n)){const{_initialCallerId:n}=e,r=__rest$2$1(e,["_initialCallerId"]),i=this.interop.servers().find((e=>e.instance===n));return t(r,i)}}))}catch(e){throw this.myIntents.delete(n),new Error(`Registration of a method with name ${r} failed with reason: ${JSON.stringify(e)}`)}return{unsubscribe:()=>this.unsubscribeIntent(n)}}))}find(e){return __awaiter$1$1(this,void 0,void 0,(function*(){let t;if(void 0!==e){const n=findFilterDecoder.runWithException(e);"string"==typeof n?t={filter:{name:n}}:"object"==typeof n&&(t={filter:n})}yield Promise.all(this.unregisterIntentPromises);return(yield this.bridge.send("intents",operations$5.findIntent,t)).intents}))}checkIfIntentsResolverIsEnabled(e){var t,n,r,i,o;this.useIntentsResolverUI="boolean"!=typeof(null===(t=e.intents)||void 0===t?void 0:t.enableIntentsResolverUI)||e.intents.enableIntentsResolverUI,this.intentsResolverAppName=null!==(r=null===(n=e.intents)||void 0===n?void 0:n.intentsResolverAppName)&&void 0!==r?r:INTENTS_RESOLVER_APP_NAME,this.intentResolverResponseTimeout=null!==(o=null===(i=e.intents)||void 0===i?void 0:i.methodResponseTimeoutMs)&&void 0!==o?o:DEFAULT_RESOLVER_RESPONSE_TIMEOUT}clearUnregistrationPromise(e){this.unregisterIntentPromises=this.unregisterIntentPromises.filter((t=>t!==e))}buildInteropMethodName(e){return`${GLUE42_FDC3_INTENTS_METHOD_PREFIX}${e}`}unsubscribeIntent(e){this.myIntents.delete(e);const t=this.buildInteropMethodName(e),n=this.interop.unregister(t);this.unregisterIntentPromises.push(n),n.then((()=>{this.clearUnregistrationPromise(n)})).catch((e=>{this.logger.error(`Unregistration of a method with name ${t} failed with reason: ${e}`),this.clearUnregistrationPromise(n)}))}filterHandlers(e){return __awaiter$1$1(this,void 0,void 0,(function*(){if(handlersFilterDecoder$1.runWithException(e),this.checkIfAtLeastOneFilterIsPresent(e),e.openResolver&&!this.useIntentsResolverUI)throw new Error("Cannot resolve 'filterHandlers' request using Intents Resolver UI because it's globally disabled");const t=(e.timeout||DEFAULT_PICK_HANDLER_BY_TIMEOUT)+ADDITIONAL_BRIDGE_OPERATION_TIMEOUT,n={filterHandlersRequest:e,resolverConfig:this.getResolverConfigByRequest({handlerFilter:e})};return yield this.bridge.send("intents",operations$5.filterHandlers,n,{methodResponseTimeoutMs:t,waitTimeoutMs:t},{includeOperationCheck:!0})}))}checkIfAtLeastOneFilterIsPresent(e){const t="Provide at least one filter criteria of the following: 'intent' | 'contextTypes' | 'resultType' | 'applicationNames'";if(!Object.keys(e).length)throw new Error(t);const{intent:n,resultType:r,contextTypes:i,applicationNames:o}=e,l=null==i?void 0:i.length,s=null==o?void 0:o.length;if(!(n||r||l||s))throw new Error(t)}getIntentsByHandler(e){return __awaiter$1$1(this,void 0,void 0,(function*(){intentHandlerDecoder$1.runWithException(e);return yield this.bridge.send("intents",operations$5.getIntentsByHandler,e,void 0,{includeOperationCheck:!0})}))}};const Glue42CoreMessageTypes$1={platformUnload:{name:"platformUnload"},transportSwitchRequest:{name:"transportSwitchRequest"},transportSwitchResponse:{name:"transportSwitchResponse"},getCurrentTransport:{name:"getCurrentTransport"},getCurrentTransportResponse:{name:"getCurrentTransportResponse"},checkPreferredLogic:{name:"checkPreferredLogic"},checkPreferredConnection:{name:"checkPreferredConnection"},checkPreferredLogicResponse:{name:"checkPreferredLogicResponse"},checkPreferredConnectionResponse:{name:"checkPreferredConnectionResponse"}},webPlatformTransportName$1="web-platform",latestFDC3Type="latest_fdc3_type",operations$4={addChannel:{name:"addChannel",dataDecoder:channelContextDecoder$1},getMyChannel:{name:"getMyChannel",resultDecoder:getMyChanelResultDecoder$1},getWindowIdsOnChannel:{name:"getWindowIdsOnChannel",dataDecoder:getWindowIdsOnChannelDataDecoder$1,resultDecoder:getWindowIdsOnChannelResultDecoder$1},getWindowIdsWithChannels:{name:"getWindowIdsWithChannels",dataDecoder:wrappedWindowWithChannelFilterDecoder$1,resultDecoder:getWindowIdsWithChannelsResultDecoder$1},joinChannel:{name:"joinChannel",dataDecoder:joinChannelDataDecoder$1}};let ChannelsController$1=class{constructor(){this.registry=lib$3$1(),this.GlueWebChannelsPrefix="___channel___",this.SubsKey="subs",this.ChangedKey="changed",this.replaySubscribe=(e,t)=>{this.get(t).then((t=>{if("object"==typeof t.data&&Object.keys(t.data).length){const n=this.createContextName(t.name);return this.contexts.subscribe(n,((t,n,r,i,o)=>{e(t.data,t,null==o?void 0:o.updaterId)}))}})).then((e=>{e&&"function"==typeof e&&e()})).catch((e=>this.logger.trace(e)))}}handlePlatformShutdown(){this.registry.clear()}addOperationsExecutors(){operations$4.getMyChannel.execute=this.handleGetMyChannel.bind(this),operations$4.joinChannel.execute=this.handleJoinChannel.bind(this)}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("channels.controller.web"),this.logger.trace("starting the web channels controller"),this.contexts=e.contexts,this.addOperationsExecutors(),this.bridge=t.bridge,this.windowsController=t.windowsController,this.sessionController=t.sessionController,this.logger.trace("no need for platform registration, attaching the channels property to glue and returning");const n=this.toApi();e.channels=n}))}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=channelsOperationTypesDecoder.runWithException(e.operation),n=operations$4[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=n.dataDecoder.runWithException(e.data)),yield n.execute(r)}))}list(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=this.getAllChannelNames();return yield Promise.all(e.map((e=>this.get(e))))}))}my(){return this.current()}handleGetMyChannel(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=this.my();return e?{channel:e}:{}}))}join(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const n=this.getAllChannelNames();channelNameDecoder(n).runWithException(e),optionalNonEmptyStringDecoder.runWithException(t),t&&t!==this.windowsController.my().id?yield this.bridge.send("channels",operations$4.joinChannel,{channel:e,windowId:t},void 0,{includeOperationCheck:!0}):yield this.switchToChannel(e)}))}handleJoinChannel({channel:e,windowId:t}){return this.join(e,t)}onChanged(e){return this.changed(e)}leave(){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.switchToChannel()}))}toApi(){const e={subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),publish:this.publish.bind(this),all:this.all.bind(this),list:this.list.bind(this),get:this.get.bind(this),join:this.join.bind(this),leave:this.leave.bind(this),current:this.current.bind(this),my:this.my.bind(this),changed:this.changed.bind(this),onChanged:this.onChanged.bind(this),add:this.add.bind(this),getMy:this.getMy.bind(this),getWindowsOnChannel:this.getWindowsOnChannel.bind(this),getWindowsWithChannels:this.getWindowsWithChannels.bind(this)};return Object.freeze(e)}createContextName(e){return`${this.GlueWebChannelsPrefix}${e}`}getAllChannelNames(){return this.contexts.all().filter((e=>e.startsWith(this.GlueWebChannelsPrefix))).map((e=>e.replace(this.GlueWebChannelsPrefix,"")))}unsubscribe(){this.unsubscribeFunc&&(this.unsubscribeFunc(),this.unsubscribeFunc=void 0)}switchToChannel(e){return __awaiter$1$1(this,void 0,void 0,(function*(){if(this.unsubscribe(),this.currentChannelName=e,void 0!==e){const t=this.createContextName(e);this.unsubscribeFunc=yield this.contexts.subscribe(t,((e,t,n,r,i)=>{this.registry.execute(this.SubsKey,e.data,e,null==i?void 0:i.updaterId)}))}this.registry.execute(this.ChangedKey,e),this.sessionController.setWindowData({currentName:e},"channels")}))}updateData(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const n=this.createContextName(e),r=this.getFDC3Type(t);if(this.contexts.setPathSupported){const e=Object.keys(t).map((e=>({path:`data.${e}`,value:t[e]})));r&&e.push({path:latestFDC3Type,value:r}),yield this.contexts.setPaths(n,e)}else r&&(t[latestFDC3Type]=r),yield this.contexts.update(n,{data:t})}))}getFDC3Type(e){const t=Object.keys(e).filter((e=>0===e.indexOf("fdc3_")));if(0!==t.length){if(t.length>1)throw new Error("FDC3 does not support updating of multiple context keys");return t[0].split("_").slice(1).join("_")}}subscribe(e){if("function"!=typeof e)throw new Error("Cannot subscribe to channels, because the provided callback is not a function!");const t=this.current();return t&&this.replaySubscribe(e,t),this.registry.add(this.SubsKey,e)}subscribeFor(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const n=this.getAllChannelNames();if(channelNameDecoder(n).runWithException(e),"function"!=typeof t)throw new Error(`Cannot subscribe to channel ${e}, because the provided callback is not a function!`);const r=this.createContextName(e);return this.contexts.subscribe(r,((e,n,r,i,o)=>{t(e.data,e,null==o?void 0:o.updaterId)}))}))}publish(e,t){if("object"!=typeof e)throw new Error("Cannot publish to channel, because the provided data is not an object!");if(void 0!==t){const n=this.getAllChannelNames();return channelNameDecoder(n).runWithException(t),this.updateData(t,e)}if(void 0===this.currentChannelName)throw new Error("Cannot publish to channel, because not joined to a channel!");return this.updateData(this.currentChannelName,e)}all(){return __awaiter$1$1(this,void 0,void 0,(function*(){return this.getAllChannelNames()}))}get(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.getAllChannelNames();channelNameDecoder(t).runWithException(e);const n=this.createContextName(e),r=yield this.contexts.get(n);if(r.latest_fdc3_type){const e=__rest$2$1(r,["latest_fdc3_type"]);return Object.assign({},e)}return r}))}current(){return this.currentChannelName}changed(e){if("function"!=typeof e)throw new Error("Cannot subscribe to channel changed, because the provided callback is not a function!");return this.registry.add(this.ChangedKey,e)}add(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=channelContextDecoder$1.runWithException(e);if(this.getAllChannelNames().includes(t.name))throw new Error("There's an already existing channel with such name");return yield this.bridge.send("channels",operations$4.addChannel,t),t}))}getMy(){return __awaiter$1$1(this,void 0,void 0,(function*(){if(this.currentChannelName)return this.get(this.currentChannelName)}))}getWindowsOnChannel(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.getAllChannelNames();channelNameDecoder(t).runWithException(e);const{windowIds:n}=yield this.bridge.send("channels",operations$4.getWindowIdsOnChannel,{channel:e},void 0,{includeOperationCheck:!0});return n.reduce(((e,t)=>{const n=this.windowsController.findById(t);return n?[...e,n]:e}),[])}))}getWindowsWithChannels(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=void 0!==e?{filter:windowWithChannelFilterDecoder$1.runWithException(e)}:{},{windowIdsWithChannels:n}=yield this.bridge.send("channels",operations$4.getWindowIdsWithChannels,t,void 0,{includeOperationCheck:!0}),r=n.reduce(((e,{application:t,channel:n,windowId:r})=>{const i=this.windowsController.findById(r);return i?[...e,{application:t,channel:n,window:i}]:e}),[]);return r}))}};const operations$3={getEnvironment:{name:"getEnvironment",resultDecoder:anyDecoder$1},getBase:{name:"getBase",resultDecoder:anyDecoder$1},platformShutdown:{name:"platformShutdown"}};let SystemController$1=class{start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.bridge=t.bridge,this.ioc=t,this.addOperationsExecutors(),yield this.setEnvironment()}))}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=systemOperationTypesDecoder$1.runWithException(e.operation),n=operations$3[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=n.dataDecoder.runWithException(e.data)),yield n.execute(r)}))}processPlatformShutdown(){return __awaiter$1$1(this,void 0,void 0,(function*(){Object.values(this.ioc.controllers).forEach((e=>e.handlePlatformShutdown?e.handlePlatformShutdown():null)),this.ioc.preferredConnectionController.stop(),this.ioc.eventsDispatcher.stop(),yield this.bridge.stop()}))}setEnvironment(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=yield this.bridge.send("system",operations$3.getEnvironment,void 0),t=yield this.bridge.send("system",operations$3.getBase,void 0),n=window.glue42core||window.iobrowser,r=window.glue42core?"glue42core":"iobrowser",i=Object.assign({},n,t,{environment:e});window[r]=Object.freeze(i)}))}addOperationsExecutors(){operations$3.platformShutdown.execute=this.processPlatformShutdown.bind(this)}},Notification$1=class{constructor(e,t){this.onclick=()=>{},this.onshow=()=>{},this.id=t,this.badge=e.badge,this.body=e.body,this.data=e.data,this.dir=e.dir,this.icon=e.icon,this.image=e.image,this.lang=e.lang,this.renotify=e.renotify,this.requireInteraction=e.requireInteraction,this.silent=e.silent,this.tag=e.tag,this.timestamp=e.timestamp,this.vibrate=e.vibrate,this.title=e.title,this.clickInterop=e.clickInterop,this.actions=e.actions,this.focusPlatformOnDefaultClick=e.focusPlatformOnDefaultClick,this.severity=e.severity,this.showToast=e.showToast,this.showInPanel=e.showInPanel,this.state=e.state}};oneOf$1$1(constant$1$1("clientHello"));const extensionConfigDecoder=object$1$1({widget:object$1$1({inject:boolean$1$1()})}),operations$2={clientHello:{name:"clientHello",resultDecoder:extensionConfigDecoder}};class ExtController{constructor(){this.channels=[],this.unsubFuncs=[],this.contentCommands={widgetVisualizationPermission:{name:"widgetVisualizationPermission",handle:this.handleWidgetVisualizationPermission.bind(this)},changeChannel:{name:"changeChannel",handle:this.handleChangeChannel.bind(this)}}}handlePlatformShutdown(){this.unsubFuncs.forEach((e=>e())),this.channels=[],this.unsubFuncs=[]}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("extension.controller.web"),this.windowId=t.publicWindowId,this.logger.trace("starting the extension web controller"),this.bridge=t.bridge,this.channelsController=t.channelsController,this.eventsDispatcher=t.eventsDispatcher;try{yield this.registerWithPlatform()}catch(e){return}this.channels=yield this.channelsController.list();const n=this.eventsDispatcher.onContentMessage(this.handleContentMessage.bind(this)),r=this.channelsController.onChanged((e=>{this.eventsDispatcher.sendContentMessage({command:"channelChange",newChannel:e})}));this.unsubFuncs.push(n),this.unsubFuncs.push(r)}))}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){}))}handleContentMessage(e){if(!e||"string"!=typeof e.command)return;const t=this.contentCommands[e.command];t&&t.handle(e)}registerWithPlatform(){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger.trace("registering with the platform"),this.config=yield this.bridge.send("extension",operations$2.clientHello,{windowId:this.windowId}),this.logger.trace("the platform responded to the hello message with a valid extension config")}))}handleWidgetVisualizationPermission(){var e;return __awaiter$1$1(this,void 0,void 0,(function*(){if(!(null===(e=this.config)||void 0===e?void 0:e.widget.inject))return this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!1});const t=this.channels.find((e=>e.name===this.channelsController.my()));this.eventsDispatcher.sendContentMessage({command:"permissionResponse",allowed:!0,channels:this.channels,currentChannel:t})}))}handleChangeChannel(e){return __awaiter$1$1(this,void 0,void 0,(function*(){"no-channel"!==e.name?yield this.channelsController.join(e.name):yield this.channelsController.leave()}))}}class EventsDispatcher{constructor(e){this.config=e,this.registry=lib$3$1(),this.glue42EventName="Glue42",this.events={notifyStarted:{name:"notifyStarted",handle:this.handleNotifyStarted.bind(this)},contentInc:{name:"contentInc",handle:this.handleContentInc.bind(this)},requestGlue:{name:"requestGlue",handle:this.handleRequestGlue.bind(this)}}}stop(){window.removeEventListener(this.glue42EventName,this._handleMessage)}start(e){this.glue=e,this.wireCustomEventListener(),this.announceStarted()}sendContentMessage(e){this.send("contentOut","glue42core",e)}onContentMessage(e){return this.registry.add("content-inc",e)}wireCustomEventListener(){this._handleMessage=this.handleMessage.bind(this),window.addEventListener(this.glue42EventName,this._handleMessage)}handleMessage(e){var t;const n=e.detail,r=null!==(t=null==n?void 0:n.glue42)&&void 0!==t?t:null==n?void 0:n.glue42core;if(!r)return;const i=r.event,o=this.events[i];o&&o.handle(r.message)}announceStarted(){this.send("start","glue42")}handleRequestGlue(){this.config.exposeAPI?this.send("requestGlueResponse","glue42",{glue:this.glue}):this.send("requestGlueResponse","glue42",{error:"Will not give access to the underlying Glue API, because it was explicitly denied upon initialization."})}handleNotifyStarted(){this.announceStarted()}handleContentInc(e){this.registry.execute("content-inc",e)}send(e,t,n){const r={};r[t]={event:e,message:n};const i=new CustomEvent(this.glue42EventName,{detail:r});window.dispatchEvent(i)}}let PreferredConnectionController$1=class{constructor(e){this.coreGlue=e,this.transactionTimeout=15e3,this.transactionLocks={},this.reconnectCounter=0,this.logger=this.coreGlue.logger.subLogger("web.preferred.connection.controller")}stop(){this.webPlatformMessagesUnsubscribe&&this.webPlatformMessagesUnsubscribe()}start(e){return __awaiter$1$1(this,void 0,void 0,(function*(){if(e.isPlatformInternal)return void this.logger.trace("This is an internal client to the platform, skipping all client preferred communication logic.");if(!(this.coreGlue.connection.transport.name()===webPlatformTransportName$1))throw new Error("Cannot initiate the Glue Web Bridge, because the initial connection was not handled by a Web Platform transport.");if(!this.coreGlue.connection.transport.isPreferredActivated)return void this.logger.trace("The platform of this client was configured without a preferred connection, skipping the rest of the initialization.");this.webPlatformTransport=this.coreGlue.connection.transport,this.webPlatformMessagesUnsubscribe=this.webPlatformTransport.onMessage(this.handleWebPlatformMessage.bind(this));const t=yield this.getCurrentPlatformTransportState();yield this.checkSwitchTransport(t)}))}handleWebPlatformMessage(e){if("string"==typeof e)return;const t=this.coreGlue.connection.transport.name()===webPlatformTransportName$1,n=e.type,r=e.args,i=e.transactionId;return n===Glue42CoreMessageTypes$1.transportSwitchRequest.name?this.handleTransportSwitchRequest(r,i):n!==Glue42CoreMessageTypes$1.platformUnload.name||t?n===Glue42CoreMessageTypes$1.getCurrentTransportResponse.name?this.handleGetCurrentTransportResponse(r,i):n===Glue42CoreMessageTypes$1.checkPreferredLogic.name?this.handleCheckPreferredLogic(i):n===Glue42CoreMessageTypes$1.checkPreferredConnection.name?this.handleCheckPreferredConnection(r,i):void 0:this.handlePlatformUnload()}reEstablishPlatformPort(){return __awaiter$1$1(this,void 0,void 0,(function*(){try{yield this.webPlatformTransport.connect()}catch(e){if(this.logger.trace(`Error when re-establishing port connection to the platform: ${JSON.stringify(e)}`),--this.reconnectCounter,this.reconnectCounter>0)return this.reEstablishPlatformPort();this.logger.warn("This client lost connection to the platform while connected to a preferred GW and was not able to re-connect to the platform.")}this.logger.trace("The connection to the platform was re-established, closing the connection to the web gateway."),this.reconnectCounter=0,this.webPlatformTransport.close();const e=yield this.getCurrentPlatformTransportState();yield this.checkSwitchTransport(e)}))}checkSwitchTransport(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.coreGlue.connection.transport.name();if(t===e.transportName)return void this.logger.trace("A check switch was requested, but the platform transport and my transport are identical, no switch is necessary");this.logger.trace(`A check switch was requested and a transport switch is necessary, because this client is now on ${t}, but it should reconnect to ${JSON.stringify(e)}`);const n=yield this.coreGlue.connection.switchTransport(e);this.setConnected(),this.logger.trace(`The transport switch was completed with result: ${JSON.stringify(n)}`)}))}getCurrentPlatformTransportState(){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger.trace("Requesting the current transport state of the platform.");const e=this.setTransaction(Glue42CoreMessageTypes$1.getCurrentTransport.name);this.sendPlatformMessage(Glue42CoreMessageTypes$1.getCurrentTransport.name,e.id);const t=yield e.lock;return this.logger.trace(`The platform responded with transport state: ${JSON.stringify(t)}`),t}))}setTransaction(e){const t={},n=shortidExports$1.generate(),r=new Promise(((r,i)=>{let o=!0;t.lift=e=>{o=!1,delete this.transactionLocks[n],r(e)},t.fail=e=>{o=!1,delete this.transactionLocks[n],i(e)},setTimeout((()=>{o&&(o=!1,this.logger.warn(`Transaction for operation: ${e} timed out.`),delete this.transactionLocks[n],i(`Transaction for operation: ${e} timed out.`))}),this.transactionTimeout)}));return t.lock=r,t.id=n,this.transactionLocks[n]=t,t}sendPlatformMessage(e,t,n){this.logger.trace(`Sending a platform message of type: ${e}, id: ${t} and args: ${JSON.stringify(n)}`),this.webPlatformTransport.sendObject({glue42core:{type:e,args:n,transactionId:t}})}handleTransportSwitchRequest(e,t){this.logger.trace(`Received a transport switch request with id: ${t} and data: ${JSON.stringify(e)}`),this.coreGlue.connection.switchTransport(e.switchSettings).then((e=>{this.logger.trace(`The transport switch was completed with result: ${JSON.stringify(e)}`),this.setConnected(),this.sendPlatformMessage(Glue42CoreMessageTypes$1.transportSwitchResponse.name,t,{success:e.success})})).catch((e=>{this.logger.error(e),this.sendPlatformMessage(Glue42CoreMessageTypes$1.transportSwitchResponse.name,t,{success:!1})}))}handlePlatformUnload(){this.reconnectCounter=5,this.logger.trace("The platform was unloaded while I am connected to a preferred connection, re-establishing the port connection."),this.reEstablishPlatformPort()}handleGetCurrentTransportResponse(e,t){this.logger.trace(`Got a current transport response from the platform with id: ${t} and data: ${JSON.stringify(e)}`);const n=e.transportState,r=this.transactionLocks[t];null==r||r.lift(n)}handleCheckPreferredLogic(e){setTimeout((()=>this.sendPlatformMessage(Glue42CoreMessageTypes$1.checkPreferredLogicResponse.name,e)),0)}handleCheckPreferredConnection(e,t){const n=e.url;this.logger.trace(`Testing the possible connection to: ${n}`),this.checkPreferredConnection(n).then((e=>{this.logger.trace(`The connection to ${n} is possible`),this.sendPlatformMessage(Glue42CoreMessageTypes$1.checkPreferredConnectionResponse.name,t,e)})).catch((e=>{this.logger.trace(`The connection to ${n} is not possible`),this.sendPlatformMessage(Glue42CoreMessageTypes$1.checkPreferredConnectionResponse.name,t,{error:e})}))}checkPreferredConnection(e){return new Promise((t=>{const n=new WebSocket(e);n.onerror=()=>t({live:!1}),n.onopen=()=>{n.close(),t({live:!0})}}))}setConnected(){this.webPlatformTransport.manualSetReadyState()}};class LegacyIntentsHelper{constructor(e,t,n,r,i){this.bridge=t,this.interop=n,this.appManagerController=r,this.windowsController=i,this.intentsResolverResponsePromises={},this.logger=this.configureLogger(e)}raise(e,t){var n;return __awaiter$1$1(this,void 0,void 0,(function*(){const{intentRequest:r,resolverConfig:i}=e,o=(yield t(r.intent)).find((e=>e.name===r.intent));if(!o)throw new Error(`Intent with name ${r.intent} not found`);const{open:l,reason:s}=this.checkIfResolverShouldBeOpened(o,r,i);if(!l)return null===(n=this.logger)||void 0===n||n.trace(`Intent Resolver UI won't be used. Reason: ${s}`),this.invokeRaiseIntent(r);return yield this.raiseIntentWithResolverApp(e)}))}configureLogger(e){return e.subLogger("intents.legacy.helper.web")}raiseIntentWithResolverApp(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const{intentRequest:t,resolverConfig:n}=e;this.logger.trace(`Intents Resolver UI with app name ${n.appName} will be used`);const r=yield this.registerResponseMethod();this.logger.trace(`Registered interop method ${r}`);const i=yield this.openIntentResolverApplication(e,r);this.logger.trace(`Intents Resolver Instance with id ${i.id} opened`);const o=yield this.handleInstanceResponse(i.id),l="app"===o.type?{app:o.applicationName}:{instance:o.instanceId};this.logger.trace(`Intent handler chosen by the user: ${JSON.stringify(l)}`);return yield this.invokeRaiseIntent(Object.assign(Object.assign({},t),{target:l}))}))}handleInstanceResponse(e){var t;return __awaiter$1$1(this,void 0,void 0,(function*(){try{const{handler:n,intent:r}=yield this.intentsResolverResponsePromises[e].promise;return null===(t=this.logger)||void 0===t||t.trace(`Intent handler chosen for intent ${r}: ${JSON.stringify(n)}`),this.stopResolverInstance(e),n}catch(t){throw this.stopResolverInstance(e),new Error(t)}}))}invokeRaiseIntent(e){return this.bridge.send("intents",operations$5.raiseIntent,e)}registerResponseMethod(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=INTENTS_RESOLVER_INTEROP_PREFIX$1+shortid$2$1();return yield this.interop.register(e,this.resolverResponseHandler.bind(this)),e}))}openIntentResolverApplication(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const{intentRequest:n,resolverConfig:r}=e,i=this.buildStartContext(n,t),o=yield this.buildStartOptions();this.logger.trace(`Starting Intents Resolver UI with context: ${JSON.stringify(i)} and options: ${o}`);const l=yield this.appManagerController.getApplication(r.appName).start(i,o);return this.logger.trace(`Intents Resolver instance with id ${l.id} opened`),this.subscribeOnInstanceStopped(l),this.createResponsePromise(n.intent,l.id,t,r.waitResponseTimeout),l}))}cleanUpIntentResolverPromise(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.intentsResolverResponsePromises[e];if(!t)return;this.interop.unregister(t.methodName).catch((e=>this.logger.warn(e))),delete this.intentsResolverResponsePromises[e]}))}buildStartContext(e,t){return{intent:e,callerId:this.interop.instance.instance,methodName:t}}buildStartOptions(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=yield this.getTargetBounds();return{top:(e.height-INTENTS_RESOLVER_HEIGHT$1)/2+e.top,left:(e.width-INTENTS_RESOLVER_WIDTH$1)/2+e.left,width:INTENTS_RESOLVER_WIDTH$1,height:INTENTS_RESOLVER_HEIGHT$1}}))}getTargetBounds(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=(yield this.tryGetWindowBasedBounds())||(yield this.tryGetWorkspaceBasedBounds());if(e)return this.logger.trace(`Opening Intents Resolver UI with bounds: ${JSON.stringify(e)}`),e;const t={top:window.screen.availTop||0,left:window.screen.availLeft||0,width:window.screen.width,height:window.screen.height};return this.logger.trace(`Opening Intents Resolver UI relative to my screen bounds: ${JSON.stringify(t)}`),t}))}tryGetWindowBasedBounds(){return __awaiter$1$1(this,void 0,void 0,(function*(){try{const e=yield this.windowsController.my().getBounds();return this.logger.trace(`Opening the resolver UI relative to my window bounds: ${JSON.stringify(e)}`),e}catch(e){this.logger.trace(`Failure to get my window bounds: ${JSON.stringify(e)}`)}}))}tryGetWorkspaceBasedBounds(){return __awaiter$1$1(this,void 0,void 0,(function*(){try{yield this.bridge.send("workspaces",systemOperations.operationCheck,{operation:"getWorkspaceWindowFrameBounds"});const e=(yield this.bridge.send("workspaces",systemOperations.getWorkspaceWindowFrameBounds,{itemId:this.windowsController.my().id})).bounds;return this.logger.trace(`Opening the resolver UI relative to my workspace frame window bounds: ${JSON.stringify(e)}`),e}catch(e){this.logger.trace(`Failure to get my workspace frame window bounds: ${JSON.stringify(e)}`)}}))}subscribeOnInstanceStopped(e){const{application:t}=e,n=t.onInstanceStopped((r=>{if(r.id!==e.id)return;const i=this.intentsResolverResponsePromises[r.id];if(!i)return n();i.reject(`Cannot resolve raised intent "${i.intent}" - User closed ${t.name} app without choosing an intent handler`),this.cleanUpIntentResolverPromise(r.id),n()}))}createResponsePromise(e,t,n,r){let i=()=>{},o=()=>{};const l=PromisePlus$1$1(((e,t)=>{i=e,o=t}),r,`Timeout of ${r}ms hit waiting for the user to choose a handler for intent ${e}`);this.intentsResolverResponsePromises[t]={intent:e,resolve:i,reject:o,promise:l,methodName:n}}resolverResponseHandler(e,t){const n=intentResolverResponseDecoder.run(e),r=t.instance;if(n.ok)return this.logger.trace(`Intent Resolver instance with id ${r} send a valid response: ${JSON.stringify(n.result)}`),this.intentsResolverResponsePromises[r].resolve(n.result);this.logger.trace(`Intent Resolver instance with id ${r} sent an invalid response. Error: ${JSON.stringify(n.error)}`),this.intentsResolverResponsePromises[r].reject(n.error.message),this.stopResolverInstance(r)}stopResolverInstance(e){const t=this.appManagerController.getInstances().find((t=>t.id===e));t&&t.stop().catch((e=>this.logger.error(e)))}checkIfIntentHasMoreThanOneHandler(e,t){return"object"!=typeof t.target&&(t.handlers?t.handlers.length>1:e.handlers.length>1)}checkIfResolverShouldBeOpened(e,t,n){if(!n.enabled)return{open:!1,reason:"Intent Resolver is disabled. Raising intent to first found handler"};if(!this.appManagerController.getApplication(n.appName))return{open:!1,reason:`Application with name ${n.appName} not found`};return this.checkIfIntentHasMoreThanOneHandler(e,t)?{open:!0}:{open:!1,reason:"Raised intent has only one handler"}}}const operations$1={getCurrent:{name:"getCurrent",resultDecoder:simpleThemeResponseDecoder$1},list:{name:"list",resultDecoder:allThemesResponseDecoder$1},select:{name:"select",dataDecoder:selectThemeConfigDecoder$1}};let ThemesController$1=class{constructor(){this.registry=lib$3$1(),this.activeThemeSubs=0}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("themes.controller.web"),this.logger.trace("starting the web themes controller"),this.bridge=t.bridge;const n=this.toApi();e.themes=n,this.logger.trace("themes are ready")}))}handlePlatformShutdown(){var e;this.registry.clear(),this.activeThemeSubs=0,null===(e=this.themesSubscription)||void 0===e||e.close(),delete this.themesSubscription}handleBridgeMessage(){return __awaiter$1$1(this,void 0,void 0,(function*(){}))}toApi(){const e={getCurrent:this.getCurrent.bind(this),list:this.list.bind(this),select:this.select.bind(this),onChanged:this.onChanged.bind(this)};return Object.freeze(e)}getCurrent(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("themes",operations$1.getCurrent,void 0,void 0,{includeOperationCheck:!0})).theme}))}list(){return __awaiter$1$1(this,void 0,void 0,(function*(){return(yield this.bridge.send("themes",operations$1.list,void 0,void 0,{includeOperationCheck:!0})).themes}))}select(e){return __awaiter$1$1(this,void 0,void 0,(function*(){nonEmptyStringDecoder$3.runWithException(e),yield this.bridge.send("themes",operations$1.select,{name:e},void 0,{includeOperationCheck:!0})}))}onChanged(e){return __awaiter$1$1(this,void 0,void 0,(function*(){if("function"!=typeof e)throw new Error("onChanged requires a callback of type function");const t=this.themesSubscription?Promise.resolve():this.configureThemeSubscription();yield t,++this.activeThemeSubs;const n=this.registry.add("on-theme-change",e);return()=>this.themeUnsub(n)}))}configureThemeSubscription(){return __awaiter$1$1(this,void 0,void 0,(function*(){this.themesSubscription||(this.themesSubscription=yield this.bridge.createNotificationsSteam(),this.themesSubscription.onData((e=>{const t=e.data,n=simpleThemeResponseDecoder$1.run(t);if(!n.ok)return void this.logger.warn(`Received invalid theme data on the theme event stream: ${JSON.stringify(n.error)}`);const r=n.result;this.registry.execute("on-theme-change",r.theme)})),this.themesSubscription.onClosed((()=>{this.logger.warn("The Themes interop stream was closed, no theme changes notifications will be received"),this.registry.clear(),this.activeThemeSubs=0,delete this.themesSubscription})))}))}themeUnsub(e){var t;e(),--this.activeThemeSubs,this.activeThemeSubs||(null===(t=this.themesSubscription)||void 0===t||t.close(),delete this.themesSubscription)}},SessionStorageController$1=class{constructor(){this.sessionStorage=window.sessionStorage}get allNamespaces(){return[{namespace:this.windowNamespace,defaultValue:{}}]}configure(e){this.windowId=e.windowId,this.allNamespaces.forEach((({namespace:e,defaultValue:t})=>{this.sessionStorage.getItem(e)||this.sessionStorage.setItem(e,JSON.stringify(t))}))}get windowNamespace(){return`io_connect_window_${this.windowId}`}getWindowData(){return JSON.parse(this.sessionStorage.getItem(this.windowNamespace))}setWindowData(e,t){const n=this.getWindowData();n[t]=e,this.sessionStorage.setItem(this.windowNamespace,JSON.stringify(n))}};const operations={clear:{name:"clear",dataDecoder:basePrefsConfigDecoder$1},clearAll:{name:"clearAll"},get:{name:"get",dataDecoder:basePrefsConfigDecoder$1,resultDecoder:getPrefsResultDecoder$1},getAll:{name:"getAll",resultDecoder:getAllPrefsResultDecoder$1},set:{name:"set",dataDecoder:changePrefsDataDecoder$1},update:{name:"update",dataDecoder:changePrefsDataDecoder$1},prefsChanged:{name:"prefsChanged",dataDecoder:getPrefsResultDecoder$1},prefsHello:{name:"prefsHello",resultDecoder:prefsHelloSuccessDecoder$1}};let PrefsController$1=class{constructor(){this.registry=lib$3$1()}handlePlatformShutdown(){this.registry.clear()}start(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){this.logger=e.logger.subLogger("prefs.controller.web"),this.logger.trace("starting the web prefs controller"),this.addOperationsExecutors(),this.bridge=t.bridge,this.config=t.config,this.appManagerController=t.appManagerController;try{const e=yield this.bridge.send("prefs",operations.prefsHello,void 0,void 0,{includeOperationCheck:!0});this.platformAppName=e.platform.app}catch(e){return void this.logger.warn("The platform of this client is outdated and does not support Prefs API.")}this.logger.trace("no need for platform registration, attaching the prefs property to glue and returning");const n=this.toApi();e.prefs=n}))}handleBridgeMessage(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=prefsOperationTypesDecoder$1.runWithException(e.operation),n=operations[t];if(!n.execute)return;let r=e.data;return n.dataDecoder&&(r=n.dataDecoder.runWithException(e.data)),yield n.execute(r)}))}addOperationsExecutors(){operations.prefsChanged.execute=this.handleOnChanged.bind(this)}toApi(){return{clear:this.clear.bind(this),clearAll:this.clearAll.bind(this),clearFor:this.clearFor.bind(this),get:this.get.bind(this),getAll:this.getAll.bind(this),set:this.set.bind(this),setFor:this.setFor.bind(this),subscribe:this.subscribe.bind(this),subscribeFor:this.subscribeFor.bind(this),update:this.update.bind(this),updateFor:this.updateFor.bind(this)}}clear(){return __awaiter$1$1(this,void 0,void 0,(function*(){const e=this.getMyAppName();yield this.clearFor(e)}))}clearAll(){return __awaiter$1$1(this,void 0,void 0,(function*(){yield this.bridge.send("prefs",operations.clearAll,void 0,void 0,{includeOperationCheck:!0})}))}clearFor(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=nonEmptyStringDecoder$3.runWithException(e);yield this.bridge.send("prefs",operations.clear,{app:t},void 0,{includeOperationCheck:!0})}))}get(e){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=null==e?this.getMyAppName():nonEmptyStringDecoder$3.runWithException(e),{prefs:n}=yield this.bridge.send("prefs",operations.get,{app:t},void 0,{includeOperationCheck:!0});return n}))}getAll(){return __awaiter$1$1(this,void 0,void 0,(function*(){return yield this.bridge.send("prefs",operations.getAll,void 0,void 0,{includeOperationCheck:!0})}))}set(e,t){var n;return __awaiter$1$1(this,void 0,void 0,(function*(){const r=optional$1$1(basePrefsConfigDecoder$1).runWithException(t),i=null!==(n=null==r?void 0:r.app)&&void 0!==n?n:this.getMyAppName();yield this.setFor(i,e)}))}setFor(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const n=nonEmptyStringDecoder$3.runWithException(e),r=object$1$1().runWithException(t);yield this.bridge.send("prefs",operations.set,{app:n,data:r},void 0,{includeOperationCheck:!0})}))}subscribe(e){const t=this.getMyAppName();return this.subscribeFor(t,e)}subscribeFor(e,t){const n=nonEmptyStringDecoder$3.runWithException(e),r=this.appManagerController.getApplications();if(!(n===this.platformAppName||r.some((e=>e.name===n))))throw new Error(`The provided app name "${e}" is not valid.`);if("function"!=typeof t)throw new Error("Cannot subscribe to prefs, because the provided callback is not a function!");const i=this.getSubscriptionKey(n);return this.get(n).then(t),this.registry.add(i,t)}update(e,t){var n;return __awaiter$1$1(this,void 0,void 0,(function*(){const r=optional$1$1(basePrefsConfigDecoder$1).runWithException(t),i=null!==(n=null==r?void 0:r.app)&&void 0!==n?n:this.getMyAppName();yield this.updateFor(i,e)}))}updateFor(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const n=nonEmptyStringDecoder$3.runWithException(e),r=object$1$1().runWithException(t);yield this.bridge.send("prefs",operations.update,{app:n,data:r},void 0,{includeOperationCheck:!0})}))}getMyAppName(){var e;const t=this.config.isPlatformInternal?this.platformAppName:null===(e=this.appManagerController.me)||void 0===e?void 0:e.application.name;if(!t)throw new Error("App Preferences operations can not be executed for windows that do not have app!");return t}getSubscriptionKey(e){return`prefs-changed-${e}`}handleOnChanged({prefs:e}){return __awaiter$1$1(this,void 0,void 0,(function*(){const t=this.getSubscriptionKey(e.app);this.registry.execute(t,e)}))}},IoC$3=class{constructor(){this.controllers={windows:this.windowsController,appManager:this.appManagerController,layouts:this.layoutsController,notifications:this.notificationsController,intents:this.intentsController,channels:this.channelsController,system:this.systemController,extension:this.extensionController,themes:this.themesController,prefs:this.prefsController}}get communicationId(){return this._communicationId}get publicWindowId(){return this._publicWindowId}get windowsController(){return this._windowsControllerInstance||(this._windowsControllerInstance=new WindowsController$1),this._windowsControllerInstance}get appManagerController(){return this._appManagerControllerInstance||(this._appManagerControllerInstance=new AppManagerController),this._appManagerControllerInstance}get layoutsController(){return this._layoutsControllerInstance||(this._layoutsControllerInstance=new LayoutsController$1),this._layoutsControllerInstance}get themesController(){return this._themesControllerInstance||(this._themesControllerInstance=new ThemesController$1),this._themesControllerInstance}get notificationsController(){return this._notificationsControllerInstance||(this._notificationsControllerInstance=new NotificationsController$1),this._notificationsControllerInstance}get intentsController(){return this._intentsControllerInstance||(this._intentsControllerInstance=new IntentsController$1),this._intentsControllerInstance}get legacyIntentsHelper(){return this._legacyIntentsHelperInstance||(this._legacyIntentsHelperInstance=new LegacyIntentsHelper(this._coreGlue.logger,this.bridge,this._coreGlue.interop,this.appManagerController,this.windowsController)),this._legacyIntentsHelperInstance}get systemController(){return this._systemControllerInstance||(this._systemControllerInstance=new SystemController$1),this._systemControllerInstance}get channelsController(){return this._channelsControllerInstance||(this._channelsControllerInstance=new ChannelsController$1),this._channelsControllerInstance}get prefsController(){return this._prefsControllerInstance||(this._prefsControllerInstance=new PrefsController$1),this._prefsControllerInstance}get extensionController(){return this._extensionController||(this._extensionController=new ExtController),this._extensionController}get eventsDispatcher(){return this._eventsDispatcher||(this._eventsDispatcher=new EventsDispatcher(this.config)),this._eventsDispatcher}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new GlueBridge(this._coreGlue,this.communicationId)),this._bridgeInstance}get preferredConnectionController(){return this._preferredConnectionController||(this._preferredConnectionController=new PreferredConnectionController$1(this._coreGlue)),this._preferredConnectionController}get sessionController(){return this._sessionController||(this._sessionController=new SessionStorageController$1),this._sessionController}get config(){return this._webConfig}defineGlue(e){this._coreGlue=e,this._publicWindowId=e.connection.transport.publicWindowId;const t=window.glue42core||window.iobrowser;this._communicationId=e.connection.transport.communicationId||t.communicationId}defineConfig(e){this._webConfig=e}buildWebWindow(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const n=new WebWindowModel(e,t,this.bridge),r=yield n.toApi();return{id:e,model:n,api:r}}))}buildNotification(e,t){return new Notification$1(e,t)}buildApplication(e,t){return __awaiter$1$1(this,void 0,void 0,(function*(){const n=new ApplicationModel(e,[],this.appManagerController).toApi(),r=t.map((e=>this.buildInstance(e,n)));return n.instances.push(...r),n}))}buildInstance(e,t){return new InstanceModel(e,this.bridge,t).toApi()}};var version$2$1="3.2.0";const createFactoryFunction=e=>t=>__awaiter$1$1(void 0,void 0,void 0,(function*(){if(window.glue42gd||window.iodesktop)return enterprise(t);const n=new IoC$3,r=parseConfig(t);checkSingleton();const i=yield PromiseWrap$1((()=>e(r,{version:version$2$1})),3e4,"Glue Web initialization timed out, because core didn't resolve"),o=i.logger.subLogger("web.main.controller");return n.defineGlue(i),n.sessionController.configure({windowId:i.interop.instance.instance}),yield n.preferredConnectionController.start(r),yield n.bridge.start(n.controllers),n.defineConfig(r),o.trace("the bridge has been started, initializing all controllers"),yield Promise.all(Object.values(n.controllers).map((e=>e.start(i,n)))),o.trace("all controllers reported started, starting all additional libraries"),yield Promise.all(r.libraries.map((e=>e(i,r)))),o.trace("all libraries were started"),n.eventsDispatcher.start(i),o.trace("start event dispatched, glue is ready, returning it"),i}));var extendStatics$1=function(e,t){return extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},extendStatics$1(e,t)};function __extends$1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}extendStatics$1(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign$4=function(){return __assign$4=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign$4.apply(this,arguments)};function __awaiter$6(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))}function __generator$1(e,t){var n,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(l=0)),l;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return l.label++,{value:s[1],done:!1};case 5:l.label++,r=s[1],s=[0];continue;case 7:s=l.ops.pop(),l.trys.pop();continue;default:if(!(i=l.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){l=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){l.label=s[1];break}if(6===s[0]&&l.label<i[1]){l.label=i[1],i=s;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(s);break}i[2]&&l.ops.pop(),l.trys.pop();continue}s=t.call(e,l)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function __spreadArray$1(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var MetricTypes$1={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function getMetricTypeByValue$1(e){return e.type===MetricTypes$1.TIMESTAMP?"timestamp":e.type===MetricTypes$1.NUMBER?"number":e.type===MetricTypes$1.STRING?"string":e.type===MetricTypes$1.OBJECT?"object":"unknown"}function getTypeByValue$1(e){return e.constructor===Date?"timestamp":"number"==typeof e?"number":"string"==typeof e?"string":"object"==typeof e?"object":"string"}function serializeMetric$1(e){var t={},n=getMetricTypeByValue$1(e);if("object"===n){var r=Object.keys(e.value).reduce((function(t,n){var r=getTypeByValue$1(e.value[n]);if("object"===r){var i=defineNestedComposite$1(e.value[n]);t[n]={type:"object",description:"",context:{},composite:i}}else t[n]={type:r,description:"",context:{}};return t}),{});t.composite=r}return t.name=normalizeMetricName$1(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function defineNestedComposite$1(e){return Object.keys(e).reduce((function(t,n){var r=getTypeByValue$1(e[n]);return t[n]="object"===r?{type:"object",description:"",context:{},composite:defineNestedComposite$1(e[n])}:{type:r,description:"",context:{}},t}),{})}function normalizeMetricName$1(e){return void 0!==e&&e.length>0&&"/"!==e[0]?"/"+e:e}function getMetricValueByType$1(e){return"timestamp"===getMetricTypeByValue$1(e)?Date.now():publishNestedComposite$1(e.value)}function publishNestedComposite$1(e){return"object"!=typeof e?e:Object.keys(e).reduce((function(t,n){var r=e[n];return"object"==typeof r&&r.constructor!==Date?t[n]=publishNestedComposite$1(r):r.constructor===Date?t[n]=new Date(r).getTime():r.constructor===Boolean?t[n]=r.toString():t[n]=r,t}),{})}function flatten$1(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?flatten$1(t):t)}),[])}function getHighestState$1(e){return e.sort((function(e,t){return e.state?t.state?t.state-e.state:-1:1}))[0]}function aggregateDescription$1(e){var t="";return e.forEach((function(e,n,r){var i=e.path.join(".");n===r.length-1?t+=i+"."+e.name+": "+e.description:t+=i+"."+e.name+": "+e.description+","})),t.length>100?t.slice(0,100)+"...":t}function composeMsgForRootStateMetric$1(e){var t=flatten$1(e.root.getAggregateState()),n=getHighestState$1(t);return{description:aggregateDescription$1(t),value:n.state}}function gw3$1(e,t){var n,r,i=this;if(!e||"object"!=typeof e)throw new Error("Connection is required parameter");var o=function(e){l(e.root)},l=function(e){s(e),e.metrics.forEach((function(e){a(e)})),e.subSystems.forEach((function(e){l(e)}))},s=function(e){return __awaiter$6(i,void 0,void 0,(function(){var t,i;return __generator$1(this,(function(o){switch(o.label){case 0:return void 0===e.parent?[2]:[4,n];case 1:return o.sent(),t={name:normalizeMetricName$1(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[t]},r.send(i),[2]}}))}))},a=function(e){return __awaiter$6(i,void 0,void 0,(function(){var t,i,o;return __generator$1(this,(function(l){switch(l.label){case 0:return t=c(e),[4,n];case 1:return l.sent(),i=serializeMetric$1(t),o={type:"define",metrics:[i]},r.send(o),void 0!==t.value&&u(t),[2]}}))}))},u=function(e){if(h()){var t=getMetricValueByType$1(e),n={type:"publish",values:[{name:normalizeMetricName$1(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};return r.sendFireAndForget(n)}return Promise.resolve()},c=function(e){var t=__assign$4({},e);return"object"==typeof e.value&&null!==e.value&&(t.value=__assign$4({},e.value)),t},h=function(){var e;try{return(null!==(e=t.canUpdateMetric)&&void 0!==e?e:function(){return!0})()}catch(e){return!0}};return{init:function(i){var l;n=new Promise((function(e){l=e})),(r=e.domain("metrics")).onJoined((function(e){!e&&l&&(l(),l=void 0);var t={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(t),e&&o(i)})),r.join({system:t.system,service:t.service,instance:t.instance})},createSystem:s,updateSystem:function(t,o){return __awaiter$6(i,void 0,void 0,(function(){var i,l,s;return __generator$1(this,(function(a){switch(a.label){case 0:return[4,n];case 1:return a.sent(),i={type:"publish",values:[{name:normalizeMetricName$1(t.path.join("/")+"/"+t.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},r.send(i),l=composeMsgForRootStateMetric$1(t),s={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:l.description,Value:l.value},timestamp:Date.now()}]},r.send(s),[2]}}))}))},createMetric:a,updateMetric:function(e){return __awaiter$6(i,void 0,void 0,(function(){var t;return __generator$1(this,(function(r){switch(r.label){case 0:return t=c(e),[4,n];case 1:return r.sent(),u(t),[2]}}))}))}}}var Helpers$1={validate:function(e,t,n){if(null===e||"object"!=typeof e)throw new Error("Missing definition");if(null===t||"object"!=typeof t)throw new Error("Missing parent");if(null===n||"object"!=typeof n)throw new Error("Missing transport")}},BaseMetric$1=function(){function e(e,t,n,r,i){this.definition=e,this.system=t,this.transport=n,this.value=r,this.type=i,this.path=[],Helpers$1.validate(e,t,n),this.path=t.path.slice(0),this.path.push(t.name),this.name=e.name,this.description=e.description,n.createMetric(this)}return Object.defineProperty(e.prototype,"repo",{get:function(){var e;return null===(e=this.system)||void 0===e?void 0:e.repo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return"".concat(this.system.path,"/").concat(name)},enumerable:!1,configurable:!0}),e.prototype.update=function(e){return this.value=e,this.transport.updateMetric(this)},e}(),NumberMetric$1=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,MetricTypes$1.NUMBER)||this}return __extends$1(t,e),t.prototype.incrementBy=function(e){this.update(this.value+e)},t.prototype.increment=function(){this.incrementBy(1)},t.prototype.decrement=function(){this.incrementBy(-1)},t.prototype.decrementBy=function(e){this.incrementBy(-1*e)},t}(BaseMetric$1),ObjectMetric$1=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,MetricTypes$1.OBJECT)||this}return __extends$1(t,e),t.prototype.update=function(e){return this.mergeValues(e),this.transport.updateMetric(this)},t.prototype.mergeValues=function(e){var t=this;return Object.keys(this.value).forEach((function(n){void 0!==e[n]&&(t.value[n]=e[n])}))},t}(BaseMetric$1),StringMetric$1=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,MetricTypes$1.STRING)||this}return __extends$1(t,e),t}(BaseMetric$1),TimestampMetric$1=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,MetricTypes$1.TIMESTAMP)||this}return __extends$1(t,e),t.prototype.now=function(){this.update(new Date)},t}(BaseMetric$1);function system$1(e,t,n,r,i){if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var o,l,s=n,a=e,u=i||"",c=t,h=r,d=function e(t){if(!t||!t.parent)return[];var n=e(t.parent);return n.push(t.name),n}(r),f={},p=(l="/",((o=d)&&o.length>0?o.join(l):"")+e),g=t.root,w=[],m=[];function v(e,t,n,r){var i={name:""};i="string"==typeof e?{name:e}:e;var o=m.filter((function(e){return e.name===i.name}));if(o.length>0){var l=o[0];if(l.type!==t)throw new Error("A metric named ".concat(i.name," is already defined with different type."));return void 0!==n&&l.update(n).catch((function(){})),l}var s=r(i);return m.push(s),s}var y={get name(){return a},get description(){return u},get repo(){return c},get parent(){return h},path:d,id:p,root:g,get subSystems(){return w},get metrics(){return m},subSystem:function(e,t){if(!e||0===e.length)throw new Error("name is required");var n=w.filter((function(t){return t.name===e}));if(n.length>0)return n[0];var r=system$1(e,c,s,y,t);return w.push(r),r},getState:function(){return f},setState:function(e,t){f={state:e,description:t},s.updateSystem(y,f)},stringMetric:function(e,t){return v(e,MetricTypes$1.STRING,t,(function(e){return new StringMetric$1(e,y,s,t)}))},timestampMetric:function(e,t){return v(e,MetricTypes$1.TIMESTAMP,t,(function(e){return new TimestampMetric$1(e,y,s,t)}))},objectMetric:function(e,t){return v(e,MetricTypes$1.OBJECT,t,(function(e){return new ObjectMetric$1(e,y,s,t)}))},numberMetric:function(e,t){return v(e,MetricTypes$1.NUMBER,t,(function(e){return new NumberMetric$1(e,y,s,t)}))},getAggregateState:function(){var e=[];return Object.keys(f).length>0&&e.push({name:a,path:d,state:f.state,description:f.description}),w.forEach((function(t){var n=t.getAggregateState();n.length>0&&e.push.apply(e,n)})),e}};return s.createSystem(y),y}var Repository$1=function(){function e(e,t){t.init(this),this.root=system$1("",this,t),this.addSystemMetrics(this.root,e.clickStream||void 0===e.clickStream)}return e.prototype.addSystemMetrics=function(e,t){if("undefined"!=typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!=typeof document){var n=e.subSystem("ClickStream"),r=function(e){var t;if(e.target){var r=e.target,i=r&&null!==(t=r.getAttribute("class"))&&void 0!==t?t:"";n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:i,id:r.id,type:"<"+r.tagName.toLowerCase()+">",href:r.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}e.stringMetric("StartTime",(new Date).toString());var i=e.stringMetric("StartURL",""),o=e.stringMetric("AppName","");if("undefined"!=typeof window){if(void 0!==window.location){var l=window.location.href;i.update(l)}void 0!==window.glue42gd&&o.update(window.glue42gd.appName)}},e}(),NullProtocol$1=function(){function e(){}return e.prototype.init=function(e){},e.prototype.createSystem=function(e){return Promise.resolve()},e.prototype.updateSystem=function(e,t){return Promise.resolve()},e.prototype.createMetric=function(e){return Promise.resolve()},e.prototype.updateMetric=function(e){return Promise.resolve()},e}(),PerfTracker$1=function(){function e(e,t,n){this.api=e,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!=t?t:this.initialPublishTimeout,this.publishInterval=null!=n?n:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return e.prototype.scheduleCollection=function(){var e=this;setTimeout((function(){e.collect(),setInterval((function(){e.collect()}),e.publishInterval)}),this.initialPublishTimeout)},e.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(e){}},e.prototype.collectMemory=function(){var e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))},e.prototype.collectEntries=function(){var e=window.performance.getEntries();if(!(e.length<=this.lastCount)){this.lastCount=e.length;var t=e.map((function(e){return e.toJSON()}));this.system.stringMetric("entries",JSON.stringify(t))}},e}(),metrics$1=function(e){var t;t=e.connection&&"object"==typeof e.connection?gw3$1(e.connection,e):new NullProtocol$1;var n=new Repository$1(e,t).root;e.disableAutoAppSystem||(n=n.subSystem("App"));var r=addFAVSupport$1(n);return initPerf$1(r,e.pagePerformanceMetrics),r};function initPerf$1(e,t){var n,r;if("undefined"!=typeof window){var i=null===(r=null===(n=null===window||void 0===window?void 0:window.glue42gd)||void 0===n?void 0:n.metrics)||void 0===r?void 0:r.pagePerformanceMetrics;i&&(t=i),(null==t?void 0:t.enabled)&&new PerfTracker$1(e,t.initialPublishTimeout,t.publishInterval)}}function addFAVSupport$1(e){var t,n=e.subSystem("reporting"),r={name:"features"};return e.featureMetric=function(e,i,o){if(void 0===e||""===e)throw new Error("name is mandatory");if(void 0===i||""===i)throw new Error("action is mandatory");if(void 0===o||""===o)throw new Error("payload is mandatory");t?t.update({name:e,action:i,payload:o}):t=n.objectMetric(r,{name:e,action:i,payload:o})},e}var commonjsGlobal$2="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs$2(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createRegistry$3(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};function r(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,i){var o=n[e];return o||(o=[],n[e]=o),o.push(t),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(t){r(t,e)}}))}),0),function(){var r=n[e];r&&(0===(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[])).length?delete n[e]:n[e]=r)}},execute:function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=n[e];if(!o||0===o.length)return[];var l=[];return o.forEach((function(n){try{var i=n.apply(void 0,t);l.push(i)}catch(t){l.push(void 0),r(t,e)}})),l},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}createRegistry$3.default=createRegistry$3;var lib$1$1=createRegistry$3,InProcTransport$1=function(){function e(e,t){var n=this;this.registry=lib$1$1(),this.gw=e.facade,this.gw.connect((function(e,t){n.messageHandler(t)})).then((function(e){n.client=e}))}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"in-memory"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),SharedWorkerTransport$1=function(){function e(e,t){var n=this;this.logger=t,this.registry=lib$1$1(),this.worker=new SharedWorker(e),this.worker.port.onmessage=function(e){n.messageHandler(e.data)}}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return this.worker.port.postMessage(e),Promise.resolve()},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"shared-worker"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),Utils$1=function(){function e(){}return e.isNode=function(){if(void 0!==e._isNode)return e._isNode;if("undefined"!=typeof window)return e._isNode=!1,!1;try{e._isNode="[object process]"===Object.prototype.toString.call(global.process)}catch(t){e._isNode=!1}return e._isNode},e}(),PromiseWrapper$2=function(){function e(){var e=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(t,n){e.resolve=function(n){e.resolved=!0,t(n)},e.reject=function(t){e.rejected=!0,n(t)}}))}return e.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Object.defineProperty(e.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!1,configurable:!0}),e}(),timers$1={};function getAllTimers$1(){return timers$1}function timer$1(e){var t=timers$1[e];if(t)return t;var n=[];function r(){return(new Date).getTime()}var i,o,l=r();function s(e,t){var i=null!=t?t:r(),o=0;n.length>0&&(o=i-n[n.length-1].time),n.push({name:e,time:i,diff:o})}s("start",l);var a={get startTime(){return l},get endTime(){return i},get period(){return o},stop:function(){return s("end",i=r()),o=i-l},mark:s,marks:n};return timers$1[e]=a,a}var WebSocketConstructor$1=Utils$1.isNode()?require("ws"):window.WebSocket,WS$1=function(){function e(e,t){if(this.startupTimer=timer$1("connection"),this._running=!0,this._registry=lib$1$1(),this.wsRequests=[],this.settings=e,this.logger=t,!this.settings.ws)throw new Error("ws is missing")}return e.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},e.prototype.send=function(e,t){var n=this;return new Promise((function(t,r){n.waitForSocketConnection((function(){var i;try{null===(i=n.ws)||void 0===i||i.send(e),t()}catch(e){r(e)}}),r)}))},e.prototype.open=function(){var e=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(t,n){e.waitForSocketConnection(t,n)}))},e.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},e.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},e.prototype.name=function(){return this.settings.ws},e.prototype.reconnect=function(){var e;null===(e=this.ws)||void 0===e||e.close();var t=new PromiseWrapper$2;return this.waitForSocketConnection((function(){t.resolve()})),t.promise},e.prototype.waitForSocketConnection=function(e,t){var n;t=null!=t?t:function(){},this._running?1!==(null===(n=this.ws)||void 0===n?void 0:n.readyState)?(this.wsRequests.push({callback:e,failed:t}),this.wsRequests.length>1||this.openSocket()):e():t("wait for socket on ".concat(this.settings.ws," failed - socket closed by user"))},e.prototype.openSocket=function(e,t){return __awaiter$6(this,void 0,void 0,(function(){var n=this;return __generator$1(this,(function(r){switch(r.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===e&&(e=this.settings.reconnectInterval),void 0===t&&(t=this.settings.reconnectAttempts),void 0!==t){if(0===t)return this.notifyForSocketState("wait for socket on ".concat(this.settings.ws," failed - no more retries left")),[2];this.logger.debug("will retry ".concat(t," more times (every ").concat(e," ms)"))}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return r.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return r.sent(),setTimeout((function(){var r=void 0===t?void 0:t-1;n.openSocket(e,r)}),e),[3,4];case 4:return[2]}}))}))},e.prototype.initiateSocket=function(){var e=this,t=new PromiseWrapper$2;return this.logger.debug("initiating ws to ".concat(this.settings.ws,"...")),this.ws=new WebSocketConstructor$1(this.settings.ws||""),this.ws.onerror=function(n){var r="";try{r=JSON.stringify(n)}catch(e){var i=new WeakSet;r=JSON.stringify(n,(function(e,t){if("object"==typeof t&&null!==t){if(i.has(t))return;i.add(t)}return t}))}t.reject("error"),e.notifyStatusChanged(!1,r)},this.ws.onclose=function(n){e.logger.info("ws closed ".concat(n)),t.reject("closed"),e.notifyStatusChanged(!1)},this.ws.onopen=function(){var n;e.startupTimer.mark("ws-opened"),e.logger.info("ws opened ".concat(null===(n=e.settings.identity)||void 0===n?void 0:n.application)),t.resolve(),e.notifyStatusChanged(!0)},this.ws.onmessage=function(t){e._registry.execute("onMessage",t.data)},t.promise},e.prototype.notifyForSocketState=function(e){this.wsRequests.forEach((function(t){e?t.failed&&t.failed(e):t.callback()})),this.wsRequests=[]},e.prototype.notifyStatusChanged=function(e,t){this._registry.execute("onConnectedChanged",e,t)},e}(),shortidExports$2={},shortid$1$1={get exports(){return shortidExports$2},set exports(e){shortidExports$2=e}},libExports$2={},lib$5={get exports(){return libExports$2},set exports(e){libExports$2=e}},seed$2=1;function getNextValue$2(){return(seed$2=(9301*seed$2+49297)%233280)/233280}function setSeed$1$1(e){seed$2=e}var randomFromSeed$1$1={nextValue:getNextValue$2,seed:setSeed$1$1},randomFromSeed$4=randomFromSeed$1$1,ORIGINAL$2="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$2$1,previousSeed$2,shuffled$2;function reset$2(){shuffled$2=!1}function setCharacters$2(e){if(e){if(e!==alphabet$2$1){if(e.length!==ORIGINAL$2.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$2.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$2.length+" unique characters. These characters were not unique: "+t.join(", "));alphabet$2$1=e,reset$2()}}else alphabet$2$1!==ORIGINAL$2&&(alphabet$2$1=ORIGINAL$2,reset$2())}function characters$2(e){return setCharacters$2(e),alphabet$2$1}function setSeed$4(e){randomFromSeed$4.seed(e),previousSeed$2!==e&&(reset$2(),previousSeed$2=e)}function shuffle$2(){alphabet$2$1||setCharacters$2(ORIGINAL$2);for(var e,t=alphabet$2$1.split(""),n=[],r=randomFromSeed$4.nextValue();t.length>0;)r=randomFromSeed$4.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function getShuffled$2(){return shuffled$2||(shuffled$2=shuffle$2())}function lookup$2(e){return getShuffled$2()[e]}function get$2(){return alphabet$2$1||ORIGINAL$2}var alphabet_1$2={get:get$2,characters:characters$2,seed:setSeed$4,lookup:lookup$2,shuffled:getShuffled$2},crypto$4="object"==typeof window&&(window.crypto||window.msCrypto),randomByte$2;randomByte$2=crypto$4&&crypto$4.getRandomValues?function(e){return crypto$4.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t};var randomByteBrowser$2=randomByte$2,format_browser$2=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*r*n/t.length),o="";;)for(var l=e(i),s=i;s--;)if((o+=t[l[s]&r]||"").length===+n)return o},alphabet$1$1=alphabet_1$2,random$2=randomByteBrowser$2,format$2=format_browser$2;function generate$1$1(e){for(var t,n=0,r="";!t;)r+=format$2(random$2,alphabet$1$1.get(),1),t=e<Math.pow(16,n+1),n++;return r}var generate_1$2=generate$1$1,generate$4=generate_1$2,REDUCE_TIME$2=1567752802062,version$1$1=7,counter$2,previousSeconds$2;function build$2(e){var t="",n=Math.floor(.001*(Date.now()-REDUCE_TIME$2));return n===previousSeconds$2?counter$2++:(counter$2=0,previousSeconds$2=n),t+=generate$4(version$1$1),t+=generate$4(e),counter$2>0&&(t+=generate$4(counter$2)),t+=generate$4(n)}var build_1$2=build$2,alphabet$6=alphabet_1$2;function isShortId$2(e){return!(!e||"string"!=typeof e||e.length<6)&&!new RegExp("[^"+alphabet$6.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}var isValid$2=isShortId$2;!function(e){var t=alphabet_1$2,n=build_1$2,r=isValid$2,i=0;function o(){return n(i)}e.exports=o,e.exports.generate=o,e.exports.seed=function(n){return t.seed(n),e.exports},e.exports.worker=function(t){return i=t,e.exports},e.exports.characters=function(e){return void 0!==e&&t.characters(e),t.shuffled()},e.exports.isValid=r}(lib$5),function(e){e.exports=libExports$2}(shortid$1$1);var shortid$4=getDefaultExportFromCjs$2(shortidExports$2);function domainSession$1(e,t,n,r,i){null==e&&(e="global"),r=r||["success"],i=i||["error"];var o,l=!1,s=!1,a=!1,u=lib$1$1();t.disconnected((function(){a=!1,n.debug("connection is down"),l=!1,s=!0,u.execute("onLeft",{disconnected:!0})})),t.loggedIn((function(){a=!0,s&&(n.debug("connection is now up - trying to reconnect..."),h(o))})),t.on("success",(function(e){return f(e)})),t.on("error",(function(e){return d(e)})),t.on("result",(function(e){return f(e)})),r&&r.forEach((function(e){t.on(e,(function(e){return f(e)}))})),i&&i.forEach((function(e){t.on(e,(function(e){return d(e)}))}));var c={};function h(t){return o=t,new Promise((function(r,i){if(l)r({});else{var o;if("global"===e)o=a?Promise.resolve({}):Promise.reject("not connected to gateway");else n.debug("joining domain ".concat(e)),o=g({type:"join",destination:e,domain:"global",options:t});o.then((function(){!function(){n.debug("did join "+e),l=!0;var t=s;s=!1,u.execute("onJoined",t)}(),r({})})).catch((function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),i(t)}))}}))}function d(t){if(e===t.domain){var n=t.request_id;if(n){var r=c[n];r&&r.error(t)}}}function f(t){if(t.domain===e){var n=t.request_id;if(n){var r=c[n];r&&r.success(t)}}}function p(){return shortid$4()}function g(r,i,o){o=o||{},r.request_id=r.request_id||p(),r.domain=r.domain||e,o.skipPeerId||(r.peer_id=t.peerId);var l=r.request_id;return new Promise((function(e,s){c[l]={success:function(t){delete c[l],t._tag=i,e(t)},error:function(e){n.warn("GW error - ".concat(JSON.stringify(e)," for request ").concat(JSON.stringify(r))),delete c[l],e._tag=i,s(e)}},t.send(r,o).catch((function(e){c[l].error({err:e})}))}))}return{join:h,leave:function(){return"global"===e?Promise.resolve():(n.debug("stopping session "+e+"..."),s=!1,g({type:"leave",destination:e,domain:"global"}).then((function(){l=!1,u.execute("onLeft")})).catch((function(){l=!1,u.execute("onLeft")})))},onJoined:function(e){return l&&e(!1),u.add("onJoined",e)},onLeft:function(e){return l||e(),u.add("onLeft",e)},send:g,sendFireAndForget:function(n){return n.request_id=n.request_id?n.request_id:p(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(n)},on:function(r,i){t.on(r,(function(t){if(t.domain===e)try{i(t)}catch(e){n.error("Callback  failed: ".concat(e," \n ").concat(e.stack," \n msg was: ").concat(JSON.stringify(t)),e)}}))},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId},get domain(){return e}}}var GW3ProtocolImpl$1=function(){function e(e,t,n){var r=this;this.connection=e,this.settings=t,this.logger=n,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=lib$1$1(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],e.disconnected((function(){r.handleDisconnected()})),this.ping()}return Object.defineProperty(e.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!1,configurable:!0}),e.prototype.processStringMessage=function(e){var t=this,n=JSON.parse(e,(function(e,n){if("string"!=typeof n)return n;if(n.length<t.dateMinLen)return n;if(n[0]!==t.datePrefixFirstChar)return n;if(n.substring(0,t.datePrefixLen)!==t.datePrefix)return n;try{var r=parseInt(n.substring(t.datePrefixLen,n.length),10);return isNaN(r)?n:new Date(r)}catch(e){return n}}));return{msg:n,msgType:n.type}},e.prototype.createStringMessage=function(e){var t=Date.prototype.toJSON;try{var n=this.datePrefix;return Date.prototype.toJSON=function(){return n+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=t}},e.prototype.processObjectMessage=function(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}},e.prototype.createObjectMessage=function(e){return e},e.prototype.login=function(e,t){return __awaiter$6(this,void 0,void 0,(function(){var n,r,i,o,l,s,a,u,c,h;return __generator$1(this,(function(d){switch(d.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,n={},this.connection.gatewayToken=e.gatewayToken,!e.gatewayToken)return[3,5];if(!t)return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return u=d.sent(),e.gatewayToken=u,[3,4];case 3:return r=d.sent(),this.logger.warn("failed to get GW token when reconnecting ".concat((null==r?void 0:r.message)||r)),[3,4];case 4:return n.method="gateway-token",n.token=e.gatewayToken,this.connection.gatewayToken=e.gatewayToken,[3,10];case 5:return"sspi"!==e.flowName?[3,9]:(n.provider="win",n.method="access-token",e.flowCallback&&e.sessionId?(i=n,[4,e.flowCallback(e.sessionId,null)]):[3,7]);case 6:return i.token=d.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(e.token)n.method="access-token",n.token=e.token;else if(e.username)n.method="secret",n.login=e.username,n.secret=e.password;else{if(!e.provider)throw new Error("invalid auth message"+JSON.stringify(e));n.provider=e.provider,n.providerContext=e.providerContext}d.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:n},e.sessionId&&(o.request_id=e.sessionId),this.globalDomain=domainSession$1("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),l={skipPeerId:!0},this.initialLogin&&(l.retryInterval=this.settings.reconnectInterval,l.maxRetries=this.settings.reconnectAttempts),d.label=11;case 11:d.trys.push([11,19,20,21]),s=void 0,d.label=12;case 12:return[4,this.globalDomain.send(o,void 0,l)];case 13:return"authentication-request"!==(a=d.sent()).type?[3,16]:(u=Buffer.from(a.authentication.token,"base64"),e.flowCallback&&e.sessionId?(c=o.authentication,[4,e.flowCallback(e.sessionId,u)]):[3,15]);case 14:c.token=d.sent().data.toString("base64"),d.label=15;case 15:return o.request_id=e.sessionId,[3,12];case 16:if("welcome"===a.type)return s=a,[3,18];throw"error"===a.type?new Error("Authentication failed: "+a.reason):new Error("Unexpected message type during authentication: "+a.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+s.peer_id),this.connection.peerId=s.peer_id,this.connection.resolvedIdentity=s.resolved_identity,this.connection.availableDomains=s.available_domains,s.options&&(this.connection.token=s.options.access_token,this.connection.info=s.options.info),this.setLoggedIn(!0),[2,s.resolved_identity];case 19:throw h=d.sent(),this.logger.error("error sending hello message - "+(h.message||h.msg||h.reason||h),h),h;case 20:return e&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null),[7];case 21:return[2]}}))}))},e.prototype.logout=function(){return __awaiter$6(this,void 0,void 0,(function(){var e;return __generator$1(this,(function(t){switch(t.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),e=this.sessions.map((function(e){e.leave()})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)},e.prototype.domain=function(e,t,n,r){var i=this.sessions.filter((function(t){return t.domain===e}))[0];return i||(i=domainSession$1(e,this.connection,t,n,r),this.sessions.push(i)),i},e.prototype.handleDisconnected=function(){var e=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(e.handleDisconnected.bind(e),e.settings.reconnectInterval||1e3)}))}},e.prototype.setLoggedIn=function(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")},e.prototype.ping=function(){var e=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){e.ping()}),3e4))},e.prototype.authToken=function(){return this.globalDomain?this.globalDomain.send({type:"create-token"}).then((function(e){return e.token})):Promise.reject(new Error("no global domain session"))},e.prototype.getNewGWToken=function(){if("undefined"!=typeof window){var e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))},e}(),MessageReplayerImpl$1=function(){function e(e){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var t=0,n=e;t<n.length;t++){var r=n[t];this.specs[r.name]=r,this.specsNames.push(r.name)}}return e.prototype.init=function(e){var t=this;this.connection=e;for(var n=0,r=this.specsNames;n<r.length;n++)for(var i=r[n],o=function(n){var r=l.subsRefCount[n];if(r||(r=0),r+=1,l.subsRefCount[n]=r,r>1)return"continue";var i=e.on(n,(function(e){return t.processMessage(n,e)}));l.subs[n]=i},l=this,s=0,a=this.specs[i].types;s<a.length;s++){o(a[s])}},e.prototype.processMessage=function(e,t){if(!this.isDone&&t)for(var n=0,r=this.specsNames;n<r.length;n++){var i=r[n];if(-1!==this.specs[i].types.indexOf(e)){var o=this.messages[i]||[];this.messages[i]=o,o.push(t)}}},e.prototype.drain=function(e,t){var n;t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(var r=0,i=this.specs[e].types;r<i.length;r++){var o=i[r];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(n=this.connection)||void 0===n||n.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[e],this.specs.length||(this.isDone=!0)},e}(),PromisePlus$2=function(e,t,n){return new Promise((function(r,i){var o=setTimeout((function(){var e=n||"Promise timeout hit: ".concat(t);i(e)}),t);new Promise(e).then((function(e){clearTimeout(o),r(e)})).catch((function(e){clearTimeout(o),i(e)}))}))},WebPlatformTransport$1=function(){function e(e,t,n){this.settings=e,this.logger=t,this.identity=n,this.iAmConnected=!1,this.parentReady=!1,this.rejected=!1,this.children=[],this.extContentAvailable=!1,this.extContentConnecting=!1,this.extContentConnected=!1,this.parentInExtMode=!1,this.webNamespace="g42_core_web",this.parentPingTimeout=5e3,this.connectionRequestTimeout=7e3,this.defaultTargetString="*",this.registry=lib$1$1(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:function(){}},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}},this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.parentType=window.name.includes("#wsp")?"workspace":void 0}return e.prototype.manualSetReadyState=function(){this.iAmConnected=!0,this.parentReady=!0},Object.defineProperty(e.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"communicationId",{get:function(){return this._communicationId},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return __awaiter$6(this,void 0,void 0,(function(){return __generator$1(this,(function(t){if(this.extContentConnected)return[2,window.postMessage({glue42ExtOut:e},this.defaultTargetString)];if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(e),[2]}))}))},Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.send=function(){return Promise.reject("not supported")},e.prototype.onConnectedChanged=function(e){return this.registry.add("onConnectedChanged",e)},e.prototype.open=function(){return __awaiter$6(this,void 0,void 0,(function(){return __generator$1(this,(function(e){switch(e.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return e.sent(),this.notifyStatusChanged(!0),[2]}}))}))},e.prototype.close=function(){var e,t,n={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};return null===(t=this.port)||void 0===t||t.postMessage(n),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()},e.prototype.name=function(){return"web-platform"},e.prototype.reconnect=function(){return __awaiter$6(this,void 0,void 0,(function(){return __generator$1(this,(function(e){switch(e.label){case 0:return[4,this.close()];case 1:return e.sent(),[2,Promise.resolve()]}}))}))},e.prototype.initiateInternalConnection=function(){var e=this;return new Promise((function(t,n){e.logger.debug("opening an internal web platform connection"),e.port=e.settings.port,e.iAmConnected?e.logger.warn("cannot open a new connection, because this client is currently connected"):(e.port.onmessage=function(r){var i,o;if(!e.iAmConnected||(null===(i=r.data)||void 0===i?void 0:i.glue42core)){var l=null===(o=r.data)||void 0===o?void 0:o.glue42core;l&&(l.type===e.messages.gatewayInternalConnect.name&&l.success&&(e.publicWindowId=e.settings.windowId,e.identity&&e.publicWindowId&&(e.identity.windowId=e.publicWindowId,e.identity.instance=e.publicWindowId),t()),l.type===e.messages.gatewayInternalConnect.name&&l.error&&n(l.error))}else e.registry.execute("onMessage",r.data)},e.port.postMessage({glue42core:{type:e.messages.gatewayInternalConnect.name}}))}))},e.prototype.initiateRemoteConnection=function(e){var t=this;return PromisePlus$2((function(n,r){var i;t.connectionResolve=n,t.connectionReject=r,t.myClientId=null!==(i=t.myClientId)&&void 0!==i?i:shortid$4();var o=t.getMyWindowId()||shortid$4(),l={glue42core:{type:t.messages.connectionRequest.name,clientId:t.myClientId,clientType:"child",bridgeInstanceId:o,selfAssignedWindowId:t.selfAssignedWindowId}};if(t.logger.debug("sending connection request"),t.extContentConnecting)return l.glue42core.clientType="child",l.glue42core.bridgeInstanceId=t.myClientId,l.glue42core.parentWindowId=t.parentWindowId,window.postMessage(l,t.defaultTargetString);if(!e)throw new Error("Cannot send a connection request, because no glue target was specified!");e.postMessage(l,t.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the target glue window timed out")},e.prototype.isParentCheckSuccess=function(e){return __awaiter$6(this,void 0,void 0,(function(){return __generator$1(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e];case 1:return t.sent(),[2,{success:!0}];case 2:return t.sent(),[2,{success:!1}];case 3:return[2]}}))}))},e.prototype.setUpMessageListener=function(){var e=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(t){var n,r=null===(n=t.data)||void 0===n?void 0:n.glue42core;if(r&&!e.rejected){var i=e.settings.allowedOrigins||[];if(!i.length||i.includes(t.origin))if(e.checkMessageTypeValid(r.type)){var o=r.type;e.logger.debug("received valid glue42core message of type: ".concat(o)),e.messages[o].handle(t)}else e.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: ".concat(r.type));else e.logger.warn("received a message from an origin which is not in the allowed list: ".concat(t.origin))}}))},e.prototype.setUpUnload=function(){var e=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var t,n;if(!e.extContentConnected){var r={glue42core:{type:e.messages.clientUnload.name,data:{clientId:e.myClientId,ownWindowId:null===(t=e.identity)||void 0===t?void 0:t.windowId}}};e.parent&&e.parent.postMessage(r,e.defaultTargetString),null===(n=e.port)||void 0===n||n.postMessage(r)}}))},e.prototype.handlePlatformReady=function(e){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval),this.parent=e.source,this.parentType=window.name.includes("#wsp")?"workspace":"window"},e.prototype.handleConnectionAccepted=function(e){var t,n=null===(t=e.data)||void 0===t?void 0:t.glue42core;return this.myClientId===n.clientId?this.handleAcceptanceOfMyRequest(n):this.handleAcceptanceOfGrandChildRequest(n,e)},e.prototype.handleAcceptanceOfMyRequest=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(e.port){if(this.publicWindowId=this.getMyWindowId(),this.identity&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.identity.instance?this.identity.instance:this.publicWindowId||shortid$4()),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=function(e){return t.registry.execute("onMessage",e.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},e.prototype.processExtContentConnection=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",(function(e){var n,r=null===(n=e.data)||void 0===n?void 0:n.glue42ExtInc;if(r){var i=t.settings.allowedOrigins||[];!i.length||i.includes(e.origin)?t.registry.execute("onMessage",r):t.logger.warn("received a message from an origin which is not in the allowed list: ".concat(e.origin))}})),this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve},e.prototype.handleAcceptanceOfGrandChildRequest=function(e,t){if(this.extContentConnecting||this.extContentConnected)this.logger.debug("cannot process acceptance of a grandchild, because I am connected to a content script");else{this.logger.debug("handling a connection accepted signal targeted at a grandchild: ".concat(e.clientId));var n=this.children.find((function(t){return t.grandChildId===e.clientId}));n?(n.connected=!0,this.logger.debug("the grandchild connection for ".concat(e.clientId," is set up, forwarding the success message and the gateway port")),e.parentWindowId=this.publicWindowId,n.source.postMessage(t.data,n.origin,[e.port])):this.logger.error("cannot handle connection accepted for grandchild: ".concat(e.clientId,", because there is no grandchild with this id"))}},e.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},e.prototype.handleConnectionRequest=function(e){if(this.extContentConnecting)this.logger.debug("This connection request event is targeted at the extension content");else{var t=e.source,n=e.data.glue42core;if(!n.clientType||"grandChild"!==n.clientType)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source was not opened by a glue API call");if(!n.clientId)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source did not provide a valid id");if(!this.parent)return this.rejectConnectionRequest(t,e.origin,"Cannot forward the connection request, because no direct connection to the platform was found");this.logger.debug("handling a connection request for a grandchild: ".concat(n.clientId)),this.children.push({grandChildId:n.clientId,source:t,connected:!1,origin:e.origin}),this.logger.debug("grandchild: ".concat(n.clientId," is prepared, forwarding connection request to the platform")),this.parent.postMessage(e.data,this.defaultTargetString)}},e.prototype.handleParentPing=function(e){if(this.parentReady)if(this.iAmConnected){var t={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(t.glue42core.extMode={windowId:this.myClientId});var n=e.source;this.logger.debug("responding to a parent ping with a ready message"),n.postMessage(t,e.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},e.prototype.setupPlatformUnloadListener=function(){var e=this;this.onMessage((function(t){"platformUnload"===t.type&&(e.logger.debug("detected a web platform unload"),e.parentReady=!1,e.notifyStatusChanged(!1,"Gateway unloaded"))}))},e.prototype.handleManualUnload=function(){var e,t,n={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:n},this.defaultTargetString);null===(t=this.port)||void 0===t||t.postMessage(n)},e.prototype.handleClientUnload=function(e){var t=e.data.glue42core,n=null==t?void 0:t.data.clientId;n?this.children.find((function(e){return e.grandChildId===n}))?(this.logger.debug("handling grandchild unload for id: ".concat(n)),this.children=this.children.filter((function(e){return e.grandChildId!==n}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},e.prototype.handlePlatformPing=function(){},e.prototype.notifyStatusChanged=function(e,t){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,t)},e.prototype.checkMessageTypeValid=function(e){return"string"==typeof e&&!!this.messages[e]},e.prototype.rejectConnectionRequest=function(e,t,n){this.rejected=!0,this.logger.error(n);var r={glue42core:{type:this.messages.connectionRejected.name}};e.postMessage(r,t)},e.prototype.requestConnectionPermissionFromExt=function(){var e=this;return this.waitForContentScript().then((function(){return PromisePlus$2((function(t,n){e.extConnectionResolve=t,e.extConnectionReject=n;e.logger.debug("permission request to the extension content script was sent"),window.postMessage({glue42core:{type:"extSetupRequest"}},e.defaultTargetString)}),e.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out")}))},e.prototype.handleExtConnectionResponse=function(e){var t;if(!(null===(t=e.data)||void 0===t?void 0:t.glue42core).approved)return this.extConnectionReject?this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected"):void 0;this.extConnectionResolve&&(this.extConnectionResolve(),delete this.extConnectionResolve),this.extContentConnecting=!0,this.parentType="extension",this.logger.debug("The extension connection was approved, proceeding.")},e.prototype.handleExtSetupRequest=function(){},e.prototype.handleGatewayDisconnect=function(){},e.prototype.handleGatewayInternalConnect=function(){},e.prototype.waitForContentScript=function(){var e;return!!(null===(e=window.glue42ext)||void 0===e?void 0:e.content)?Promise.resolve():PromisePlus$2((function(e){window.addEventListener("Glue42EXTReady",(function(){e()}))}),this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")},e.prototype.connect=function(){return __awaiter$6(this,void 0,void 0,(function(){return __generator$1(this,(function(e){switch(e.label){case 0:return this.settings.port?[4,this.initiateInternalConnection()]:[3,2];case 1:return e.sent(),this.logger.debug("internal web platform connection completed"),[2];case 2:return this.logger.debug("opening a client web platform connection"),[4,this.findParent()];case 3:return e.sent(),[4,this.initiateRemoteConnection(this.parent)];case 4:return e.sent(),this.logger.debug("the client is connected"),[2]}}))}))},e.prototype.findParent=function(){var e;return __awaiter$6(this,void 0,void 0,(function(){var t,n,r,i;return __generator$1(this,(function(o){switch(o.label){case 0:if(t="Cannot initiate glue, because this window was not opened or created by a glue client",n=this.getPossibleParentsInWindow(window),r=this.getPossibleParentsOutsideWindow(null===(e=window.top)||void 0===e?void 0:e.opener,window.top),!(i=new Set(__spreadArray$1(__spreadArray$1([],n,!0),r,!0))).size&&!this.extContentAvailable)throw new Error(t);return i.size||!this.extContentAvailable?[3,2]:[4,this.requestConnectionPermissionFromExt()];case 1:case 4:return o.sent(),[2];case 2:return[4,this.isParentCheckSuccess(this.confirmParent(Array.from(i)))];case 3:if(o.sent().success)return this.logger.debug("The default parent was found!"),[2];if(!this.extContentAvailable)throw new Error(t);return[4,this.requestConnectionPermissionFromExt()]}}))}))},e.prototype.getPossibleParentsInWindow=function(e){return e&&e!==e.top?__spreadArray$1([e.parent],this.getPossibleParentsInWindow(e.parent),!0):[]},e.prototype.getPossibleParentsOutsideWindow=function(e,t){return e&&t&&e!==t?__spreadArray$1(__spreadArray$1([e],this.getPossibleParentsInWindow(e),!0),this.getPossibleParentsOutsideWindow(e.opener,e),!0):[]},e.prototype.confirmParent=function(e){var t=this,n=PromisePlus$2((function(n){t.parentPingResolve=n;var r={glue42core:{type:t.messages.platformPing.name}};t.parentPingInterval=setInterval((function(){e.forEach((function(e){e.postMessage(r,t.defaultTargetString)}))}),1e3)}),this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client");return n.catch((function(){t.parentPingInterval&&(clearInterval(t.parentPingInterval),delete t.parentPingInterval)})),n},e.prototype.getMyWindowId=function(){var e;return"workspace"===this.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window===window.top?(null===(e=window.name)||void 0===e?void 0:e.includes("g42"))?window.name:(this.selfAssignedWindowId=this.selfAssignedWindowId||"g42-".concat(shortid$4()),this.selfAssignedWindowId):void 0},e}(),waitForInvocations$1=function(e,t){var n=e;return function(){0===--n&&t()}},AsyncSequelizer$3=function(){function e(e){void 0===e&&(e=0),this.minSequenceInterval=e,this.queue=[],this.isExecutingQueue=!1}return e.prototype.enqueue=function(e){var t=this;return new Promise((function(n,r){t.queue.push({action:e,resolve:n,reject:r}),t.executeQueue()}))},e.prototype.executeQueue=function(){return __awaiter$6(this,void 0,void 0,(function(){var e,t,n;return __generator$1(this,(function(r){switch(r.label){case 0:if(this.isExecutingQueue)return[2];this.isExecutingQueue=!0,r.label=1;case 1:if(!this.queue.length)return[3,7];if(!(e=this.queue.shift()))return this.isExecutingQueue=!1,[2];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.action()];case 3:return t=r.sent(),e.resolve(t),[3,5];case 4:return n=r.sent(),e.reject(n),[3,5];case 5:return[4,this.intervalBreak()];case 6:return r.sent(),[3,1];case 7:return this.isExecutingQueue=!1,[2]}}))}))},e.prototype.intervalBreak=function(){var e=this;return new Promise((function(t){return setTimeout(t,e.minSequenceInterval)}))},e}(),Connection$1=function(){function e(e,t){if(this.settings=e,this.logger=t,this.messageHandlers={},this.ids=1,this.registry=lib$1$1(),this._connected=!1,this.isTrace=!1,this._swapTransport=!1,this._switchInProgress=!1,this._transportSubscriptions=[],this._sequelizer=new AsyncSequelizer$3,(e=e||{}).reconnectAttempts=e.reconnectAttempts||10,e.reconnectInterval=e.reconnectInterval||1e3,e.inproc)this.transport=new InProcTransport$1(e.inproc,t.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new SharedWorkerTransport$1(e.sharedWorker,t.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new WebPlatformTransport$1(e.webPlatform,t.subLogger("web-platform"),e.identity);else{if(void 0===e.ws)throw new Error("No connection information specified");this.transport=new WS$1(e,t.subLogger("ws"))}this.isTrace=t.canPublish("trace"),t.debug("starting with ".concat(this.transport.name()," transport")),this.protocol=new GW3ProtocolImpl$1(this,e,t.subLogger("protocol"));var n=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),r=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(n),this._transportSubscriptions.push(r),this._defaultTransport=this.transport}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;return null===(e=this.protocol)||void 0===e?void 0:e.protocolVersion},enumerable:!1,configurable:!0}),e.prototype.switchTransport=function(e){return __awaiter$6(this,void 0,void 0,(function(){var t=this;return __generator$1(this,(function(n){return[2,this._sequelizer.enqueue((function(){return __awaiter$6(t,void 0,void 0,(function(){var t,n,r;return __generator$1(this,(function(i){switch(i.label){case 0:if(!e||"object"!=typeof e)throw new Error("Cannot switch transports, because the settings are missing or invalid.");if(void 0===e.type)throw new Error("Cannot switch the transport, because the type is not defined");return this.logger.trace("Starting transport switch with settings: ".concat(JSON.stringify(e))),t="secondary"===e.type?this.getNewSecondaryTransport(e):this._defaultTransport,this._targetTransport=t,this._targetAuth="secondary"===e.type?this.getNewSecondaryAuth(e):this._defaultAuth,n=this.verifyConnection(),this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),[4,this.transport.close()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,n];case 3:return i.sent(),r=this.transport===t,this.logger.info("The reconnection after the switch was completed. Was the switch a success: ".concat(r)),this._switchInProgress=!1,[2,{success:r}];case 4:return i.sent(),this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,[2,{success:!1}];case 5:return[2]}}))}))}))]}))}))},e.prototype.onLibReAnnounced=function(e){return this.registry.add("libReAnnounced",e)},e.prototype.setLibReAnnounced=function(e){this.registry.execute("libReAnnounced",e)},e.prototype.send=function(e,t){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var n=this.protocol.createObjectMessage(e);return this.isTrace&&this.logger.trace(">> ".concat(JSON.stringify(n))),this.transport.sendObject(n,t)}var r=this.protocol.createStringMessage(e);return this.isTrace&&this.logger.trace(">> ".concat(r)),this.transport.send(r,t)},e.prototype.on=function(e,t){e=e.toLowerCase(),void 0===this.messageHandlers[e]&&(this.messageHandlers[e]={});var n=this.ids++;return this.messageHandlers[e][n]=t,{type:e,id:n}},e.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!1,configurable:!0}),e.prototype.connected=function(e){var t=this;return this.protocol.loggedIn((function(){var n=t.transport.name();e(n)}))},e.prototype.disconnected=function(e){return this.registry.add("disconnected",e)},e.prototype.login=function(e,t){return __awaiter$6(this,void 0,void 0,(function(){var n,r,i;return __generator$1(this,(function(o){switch(o.label){case 0:this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),n=this.transportSwap(),e=null!=n?n:e),this.logger.trace("Starting login for transport: ".concat(this.transport.name()," and auth ").concat(JSON.stringify(e))),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.transport.open()];case 2:return o.sent(),this.logger.trace("Transport: ".concat(this.transport.name()," opened, logging in")),timer$1("connection").mark("transport-opened"),[4,this.protocol.login(e,t)];case 3:return r=o.sent(),this.logger.trace("Logged in with identity: ".concat(JSON.stringify(r))),timer$1("connection").mark("protocol-logged-in"),[2,r];case 4:throw i=o.sent(),this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(i);case 5:return[2]}}))}))},e.prototype.logout=function(){return __awaiter$6(this,void 0,void 0,(function(){return __generator$1(this,(function(e){switch(e.label){case 0:return[4,this.protocol.logout()];case 1:return e.sent(),[4,this.transport.close()];case 2:return e.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this.protocol.loggedIn(e)},e.prototype.domain=function(e,t,n){return this.protocol.domain(e,this.logger.subLogger("domain=".concat(e)),t,n)},e.prototype.authToken=function(){return this.protocol.authToken()},e.prototype.reconnect=function(){return this.transport.reconnect()},e.prototype.distributeMessage=function(e,t){var n=this,r=this.messageHandlers[t.toLowerCase()];void 0!==r&&Object.keys(r).forEach((function(t){var i=r[t];if(void 0!==i)try{i(e)}catch(e){try{n.logger.error("Message handler failed with ".concat(e.stack),e)}catch(t){console.log("Message handler failed",e)}}}))},e.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?(this.settings.replaySpecs&&this.settings.replaySpecs.length&&(this.replayer=new MessageReplayerImpl$1(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):this.registry.execute("disconnected"))},e.prototype.handleTransportMessage=function(e){var t;t="string"==typeof e?this.protocol.processStringMessage(e):this.protocol.processObjectMessage(e),this.isTrace&&this.logger.trace("<< ".concat(JSON.stringify(t))),this.distributeMessage(t.msg,t.msgType)},e.prototype.verifyConnection=function(){var e=this;return PromisePlus$2((function(t){var n,r=waitForInvocations$1(2,(function(){n&&n(),t()}));n=e.onLibReAnnounced((function(e){return"interop"===e.name||"contexts"===e.name?r():void 0}))}),1e4,"Transport switch timed out waiting for all libraries to be re-announced")},e.prototype.getNewSecondaryTransport=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.url))throw new Error("Missing secondary transport URL.");return new WS$1(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))},e.prototype.getNewSecondaryAuth=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth},e.prototype.transportSwap=function(){if(this._swapTransport=!1,this._targetTransport&&this._targetAuth){this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport=this._targetTransport;var e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),t=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(t),this._targetAuth}this.logger.warn("Error while switching transports - either the target transport or auth is not defined: transport defined -> ".concat(!!this._defaultTransport,", auth defined -> ").concat(!!this._targetAuth,". Staying on the current one."))},e.prototype.prepareDefaultSwap=function(){var e=this;this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport.close().catch((function(t){return e.logger.warn("Error closing the ".concat(e.transport.name()," transport after a failed connection attempt: ").concat(JSON.stringify(t)))})),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0},e}(),order$1=["trace","debug","info","warn","error","off"],Logger$1=function(){function e(e,t,n){this.name=e,this.parent=t,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=e,this.path=t?"".concat(t.path,".").concat(e):e,this.loggerFullName="[".concat(this.path,"]"),this.includeTimeAndLevel=!n,n&&(this.logFn=n,this.customLogFn=!0)}return e.prototype.subLogger=function(t){var n=this.subLoggers.filter((function(e){return e.name===t}))[0];if(void 0!==n)return n;Object.keys(this).forEach((function(e){if(e===t)throw new Error("This sub logger name is not allowed.")}));var r=new e(t,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r},e.prototype.publishLevel=function(e){var t;return e&&(this._publishLevel=e),this._publishLevel||(null===(t=this.parent)||void 0===t?void 0:t.publishLevel())},e.prototype.consoleLevel=function(e){var t;return e&&(this._consoleLevel=e),this._consoleLevel||(null===(t=this.parent)||void 0===t?void 0:t.consoleLevel())},e.prototype.log=function(e,t,n){this.publishMessage(t||"info",e,n)},e.prototype.trace=function(e){this.log(e,"trace")},e.prototype.debug=function(e){this.log(e,"debug")},e.prototype.info=function(e){this.log(e,"info")},e.prototype.warn=function(e){this.log(e,"warn")},e.prototype.error=function(e,t){this.log(e,"error")},e.prototype.canPublish=function(e,t){return order$1.indexOf(e)>=order$1.indexOf(t||this.consoleLevel()||"trace")},e.prototype.publishMessage=function(t,n,r){var i=this.loggerFullName;if("error"===t&&!r){var o=new Error;o.stack&&(n=n+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(t,this.publishLevel())){var l=e.Interop;if(l)try{l.methods({name:e.InteropMethodName}).length>0&&l.invoke(e.InteropMethodName,{msg:"".concat(n),logger:i,level:t})}catch(e){}}if(this.canPublish(t)){var s="";if(this.includeTimeAndLevel){var a=new Date,u="".concat(a.getHours(),":").concat(a.getMinutes(),":").concat(a.getSeconds(),":").concat(a.getMilliseconds());s="[".concat(u,"] [").concat(t,"] ")}var c="".concat(s).concat(i,": ").concat(n);switch(t){case"trace":this.logFn.debug(c);break;case"debug":this.logFn.debug?this.logFn.debug(c):this.logFn.log(c);break;case"info":this.logFn.info(c);break;case"warn":this.logFn.warn(c);break;case"error":this.logFn.error(c,r)}}},e.InteropMethodName="T42.AppLogger.Log",e}(),GW_MESSAGE_CREATE_CONTEXT$1="create-context",GW_MESSAGE_ACTIVITY_CREATED$1="created",GW_MESSAGE_ACTIVITY_DESTROYED$1="destroyed",GW_MESSAGE_CONTEXT_CREATED$1="context-created",GW_MESSAGE_CONTEXT_ADDED$1="context-added",GW_MESSAGE_SUBSCRIBE_CONTEXT$1="subscribe-context",GW_MESSAGE_SUBSCRIBED_CONTEXT$1="subscribed-context",GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1="unsubscribe-context",GW_MESSAGE_DESTROY_CONTEXT$1="destroy-context",GW_MESSAGE_CONTEXT_DESTROYED$1="context-destroyed",GW_MESSAGE_UPDATE_CONTEXT$1="update-context",GW_MESSAGE_CONTEXT_UPDATED$1="context-updated",GW_MESSAGE_JOINED_ACTIVITY$1="joined",ContextMessageReplaySpec$1={get name(){return"context"},get types(){return[GW_MESSAGE_CREATE_CONTEXT$1,GW_MESSAGE_ACTIVITY_CREATED$1,GW_MESSAGE_ACTIVITY_DESTROYED$1,GW_MESSAGE_CONTEXT_CREATED$1,GW_MESSAGE_CONTEXT_ADDED$1,GW_MESSAGE_SUBSCRIBE_CONTEXT$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1,GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1,GW_MESSAGE_DESTROY_CONTEXT$1,GW_MESSAGE_CONTEXT_DESTROYED$1,GW_MESSAGE_UPDATE_CONTEXT$1,GW_MESSAGE_CONTEXT_UPDATED$1,GW_MESSAGE_JOINED_ACTIVITY$1]}},version$5="6.2.0";function prepareConfig$1(e,t,n){var r,i,o,l,s;if(Utils$1.isNode()){var a=process.env._GD_STARTING_CONTEXT_;if(a)try{s=JSON.parse(a)}catch(e){}}function u(){if(e.application)return e.application;if(n)return n.applicationName;if("undefined"!=typeof window&&void 0!==window.glue42electron)return window.glue42electron.application;var t=shortid$4();return Utils$1.isNode()?s?s.applicationConfig.name:"NodeJS"+t:"undefined"!=typeof window&&"undefined"!=typeof document?document.title+" (".concat(t,")"):t}var c=function(){var r,i,o,l,a,c,h,d,f,p,g,w=e.gateway,m=null!==(r=null==w?void 0:w.protocolVersion)&&void 0!==r?r:3,v=null==w?void 0:w.reconnectInterval,y=null==w?void 0:w.reconnectAttempts,b=null==w?void 0:w.ws,S=null==w?void 0:w.sharedWorker,$=null==w?void 0:w.inproc,C=null!==(i=null==w?void 0:w.webPlatform)&&void 0!==i?i:void 0;n&&(b=n.gwURL),Utils$1.isNode()&&s&&s.gwURL&&(b=s.gwURL),b||S||$||(b="ws://localhost:8385");var I=u(),x=I;void 0!==n?(d=n.windowId,f=n.pid,n.env&&(p=n.env.env,g=n.env.region),x=null!==(o=n.application)&&void 0!==o?o:"glue-app",h=n.appInstanceId):Utils$1.isNode()?(f=process.pid,s&&(p=s.env,g=s.region,h=s.instanceId)):void 0!==(null===window||void 0===window?void 0:window.glue42electron)&&(d=null===window||void 0===window?void 0:window.glue42electron.instanceId,f=null===window||void 0===window?void 0:window.glue42electron.pid,p=null===window||void 0===window?void 0:window.glue42electron.env,g=null===window||void 0===window?void 0:window.glue42electron.region,x=null!==(l=null===window||void 0===window?void 0:window.glue42electron.application)&&void 0!==l?l:"glue-app",h=null===window||void 0===window?void 0:window.glue42electron.instanceId);var E=null!==(c=null===(a=e.gateway)||void 0===a?void 0:a.replaySpecs)&&void 0!==c?c:[];E.push(ContextMessageReplaySpec$1);var D={application:x,applicationName:I,windowId:d,instance:h,process:f,region:g,environment:p,api:t.version||version$5};return e.identity&&(D=Object.assign(D,e.identity)),{identity:D,reconnectInterval:v,ws:b,sharedWorker:S,webPlatform:C,inproc:$,protocolVersion:m,reconnectAttempts:y,replaySpecs:E}}(),h=u();if("undefined"!=typeof window){var d=window,f=d.htmlContainer?"".concat(d.htmlContainer.containerName,".").concat(d.htmlContainer.application):null===(r=null==d?void 0:d.glue42gd)||void 0===r?void 0:r.application;f&&(h=f)}return{bus:null!==(i=e.bus)&&void 0!==i&&i,application:h,auth:function(){var t,n,r;return"string"==typeof e.auth?{token:e.auth}:e.auth?e.auth:Utils$1.isNode()&&s&&s.gwToken?{gatewayToken:s.gwToken}:(null===(t=e.gateway)||void 0===t?void 0:t.webPlatform)||(null===(n=e.gateway)||void 0===n?void 0:n.inproc)||(null===(r=e.gateway)||void 0===r?void 0:r.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}(),logger:function(){var t,r,i,o=e.logger,l="warn";return o||(o=l),n&&(i=n.consoleLogLevel),"string"==typeof o?{console:null!=i?i:o,publish:l}:{console:null!==(t=null!=i?i:o.console)&&void 0!==t?t:l,publish:null!==(r=o.publish)&&void 0!==r?r:l}}(),connection:c,metrics:null===(o=e.metrics)||void 0===o||o,contexts:void 0===e.contexts||"boolean"==typeof e.contexts&&e.contexts?{reAnnounceKnownContexts:!0}:"object"==typeof e.contexts&&Object.assign({},{reAnnounceKnownContexts:!0},e.contexts),version:t.version||version$5,libs:null!==(l=t.libs)&&void 0!==l?l:[],customLogger:e.customLogger}}var GW3ContextData$1=function(){function e(e,t,n,r){this.updateCallbacks={},this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=r,this.context={}}return e.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},e.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},e}(),lodash_clonedeepExports$1={},lodash_clonedeep$1={get exports(){return lodash_clonedeepExports$1},set exports(e){lodash_clonedeepExports$1=e}};!function(e,t){var n="__lodash_hash_undefined__",r=9007199254740991,i="[object Arguments]",o="[object Boolean]",l="[object Date]",s="[object Function]",a="[object GeneratorFunction]",u="[object Map]",c="[object Number]",h="[object Object]",d="[object Promise]",f="[object RegExp]",p="[object Set]",g="[object String]",w="[object Symbol]",m="[object WeakMap]",v="[object ArrayBuffer]",y="[object DataView]",b="[object Float32Array]",S="[object Float64Array]",$="[object Int8Array]",C="[object Int16Array]",I="[object Int32Array]",x="[object Uint8Array]",E="[object Uint8ClampedArray]",D="[object Uint16Array]",A="[object Uint32Array]",k=/\w*$/,_=/^\[object .+?Constructor\]$/,j=/^(?:0|[1-9]\d*)$/,N={};N[i]=N["[object Array]"]=N[v]=N[y]=N[o]=N[l]=N[b]=N[S]=N[$]=N[C]=N[I]=N[u]=N[c]=N[h]=N[f]=N[p]=N[g]=N[w]=N[x]=N[E]=N[D]=N[A]=!0,N["[object Error]"]=N[s]=N[m]=!1;var R="object"==typeof commonjsGlobal$2&&commonjsGlobal$2&&commonjsGlobal$2.Object===Object&&commonjsGlobal$2,T="object"==typeof self&&self&&self.Object===Object&&self,P=R||T||Function("return this")(),O=t&&!t.nodeType&&t,F=O&&e&&!e.nodeType&&e,B=F&&F.exports===O;function M(e,t){return e.set(t[0],t[1]),e}function Q(e,t){return e.add(t),e}function G(e,t,n,r){var i=-1,o=e?e.length:0;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function U(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function J(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function W(e,t){return function(n){return e(t(n))}}function q(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var L,K=Array.prototype,H=Function.prototype,z=Object.prototype,V=P["__core-js_shared__"],X=(L=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+L:"",Z=H.toString,Y=z.hasOwnProperty,ee=z.toString,te=RegExp("^"+Z.call(Y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=B?P.Buffer:void 0,re=P.Symbol,ie=P.Uint8Array,oe=W(Object.getPrototypeOf,Object),le=Object.create,se=z.propertyIsEnumerable,ae=K.splice,ue=Object.getOwnPropertySymbols,ce=ne?ne.isBuffer:void 0,he=W(Object.keys,Object),de=Fe(P,"DataView"),fe=Fe(P,"Map"),pe=Fe(P,"Promise"),ge=Fe(P,"Set"),we=Fe(P,"WeakMap"),me=Fe(Object,"create"),ve=Ue(de),ye=Ue(fe),be=Ue(pe),Se=Ue(ge),$e=Ue(we),Ce=re?re.prototype:void 0,Ie=Ce?Ce.valueOf:void 0;function xe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ee(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function De(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ae(e){this.__data__=new Ee(e)}function ke(e,t){var n=We(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&qe(e)}(e)&&Y.call(e,"callee")&&(!se.call(e,"callee")||ee.call(e)==i)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,o=!!r;for(var l in e)!t&&!Y.call(e,l)||o&&("length"==l||Qe(l,r))||n.push(l);return n}function _e(e,t,n){var r=e[t];Y.call(e,t)&&Je(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function je(e,t){for(var n=e.length;n--;)if(Je(e[n][0],t))return n;return-1}function Ne(e,t,n,r,d,m,_){var j;if(r&&(j=m?r(e,d,m,_):r(e)),void 0!==j)return j;if(!He(e))return e;var R=We(e);if(R){if(j=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&Y.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(e,j)}else{var T=Me(e),P=T==s||T==a;if(Le(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if(T==h||T==i||P&&!m){if(U(e))return m?e:{};if(j=function(e){return"function"!=typeof e.constructor||Ge(e)?{}:(t=oe(e),He(t)?le(t):{});var t}(P?{}:e),!t)return function(e,t){return Pe(e,Be(e),t)}(e,function(e,t){return e&&Pe(t,ze(t),e)}(j,e))}else{if(!N[T])return m?e:{};j=function(e,t,n,r){var i=e.constructor;switch(t){case v:return Te(e);case o:case l:return new i(+e);case y:return function(e,t){var n=t?Te(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case b:case S:case $:case C:case I:case x:case E:case D:case A:return function(e,t){var n=t?Te(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case u:return function(e,t,n){var r=t?n(J(e),!0):J(e);return G(r,M,new e.constructor)}(e,r,n);case c:case g:return new i(e);case f:return function(e){var t=new e.constructor(e.source,k.exec(e));return t.lastIndex=e.lastIndex,t}(e);case p:return function(e,t,n){var r=t?n(q(e),!0):q(e);return G(r,Q,new e.constructor)}(e,r,n);case w:return s=e,Ie?Object(Ie.call(s)):{}}var s}(e,T,Ne,t)}}_||(_=new Ae);var O=_.get(e);if(O)return O;if(_.set(e,j),!R)var F=n?function(e){return function(e,t,n){var r=t(e);return We(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,ze,Be)}(e):ze(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(F||e,(function(i,o){F&&(i=e[o=i]),_e(j,o,Ne(i,t,n,r,o,e,_))})),j}function Re(e){return!(!He(e)||(t=e,X&&X in t))&&(Ke(e)||U(e)?te:_).test(Ue(e));var t}function Te(e){var t=new e.constructor(e.byteLength);return new ie(t).set(new ie(e)),t}function Pe(e,t,n,r){n||(n={});for(var i=-1,o=t.length;++i<o;){var l=t[i],s=r?r(n[l],e[l],l,n,e):void 0;_e(n,l,void 0===s?e[l]:s)}return n}function Oe(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Fe(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Re(n)?n:void 0}xe.prototype.clear=function(){this.__data__=me?me(null):{}},xe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},xe.prototype.get=function(e){var t=this.__data__;if(me){var r=t[e];return r===n?void 0:r}return Y.call(t,e)?t[e]:void 0},xe.prototype.has=function(e){var t=this.__data__;return me?void 0!==t[e]:Y.call(t,e)},xe.prototype.set=function(e,t){return this.__data__[e]=me&&void 0===t?n:t,this},Ee.prototype.clear=function(){this.__data__=[]},Ee.prototype.delete=function(e){var t=this.__data__,n=je(t,e);return!(n<0)&&(n==t.length-1?t.pop():ae.call(t,n,1),!0)},Ee.prototype.get=function(e){var t=this.__data__,n=je(t,e);return n<0?void 0:t[n][1]},Ee.prototype.has=function(e){return je(this.__data__,e)>-1},Ee.prototype.set=function(e,t){var n=this.__data__,r=je(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},De.prototype.clear=function(){this.__data__={hash:new xe,map:new(fe||Ee),string:new xe}},De.prototype.delete=function(e){return Oe(this,e).delete(e)},De.prototype.get=function(e){return Oe(this,e).get(e)},De.prototype.has=function(e){return Oe(this,e).has(e)},De.prototype.set=function(e,t){return Oe(this,e).set(e,t),this},Ae.prototype.clear=function(){this.__data__=new Ee},Ae.prototype.delete=function(e){return this.__data__.delete(e)},Ae.prototype.get=function(e){return this.__data__.get(e)},Ae.prototype.has=function(e){return this.__data__.has(e)},Ae.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ee){var r=n.__data__;if(!fe||r.length<199)return r.push([e,t]),this;n=this.__data__=new De(r)}return n.set(e,t),this};var Be=ue?W(ue,Object):function(){return[]},Me=function(e){return ee.call(e)};function Qe(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||j.test(e))&&e>-1&&e%1==0&&e<t}function Ge(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||z)}function Ue(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Je(e,t){return e===t||e!=e&&t!=t}(de&&Me(new de(new ArrayBuffer(1)))!=y||fe&&Me(new fe)!=u||pe&&Me(pe.resolve())!=d||ge&&Me(new ge)!=p||we&&Me(new we)!=m)&&(Me=function(e){var t=ee.call(e),n=t==h?e.constructor:void 0,r=n?Ue(n):void 0;if(r)switch(r){case ve:return y;case ye:return u;case be:return d;case Se:return p;case $e:return m}return t});var We=Array.isArray;function qe(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}(e.length)&&!Ke(e)}var Le=ce||function(){return!1};function Ke(e){var t=He(e)?ee.call(e):"";return t==s||t==a}function He(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ze(e){return qe(e)?ke(e):function(e){if(!Ge(e))return he(e);var t=[];for(var n in Object(e))Y.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}e.exports=function(e){return Ne(e,!0,!0)}}(lodash_clonedeep$1,lodash_clonedeepExports$1);var cloneDeep$1=lodash_clonedeepExports$1;function applyContextDelta$1(e,t,n){try{if((null==n?void 0:n.canPublish("trace"))&&(null==n||n.trace("applying context delta ".concat(JSON.stringify(t)," on context ").concat(JSON.stringify(e)))),!t)return e;if(t.reset)return e=__assign$4({},t.reset);if(e=deepClone$1(e,void 0),t.commands){for(var r=0,i=t.commands;r<i.length;r++){var o=i[r];"remove"===o.type?deletePath$1(e,o.path):"set"===o.type&&setValueToPath$1(e,o.value,o.path)}return e}var l=t.added,s=t.updated,a=t.removed;return l&&Object.keys(l).forEach((function(t){e[t]=l[t]})),s&&Object.keys(s).forEach((function(t){mergeObjectsProperties$1(t,e,s)})),a&&a.forEach((function(t){delete e[t]})),e}catch(r){return null==n||n.error("error applying context delta ".concat(JSON.stringify(t)," on context ").concat(JSON.stringify(e)),r),e}}function deepClone$1(e,t){return cloneDeep$1(e)}var mergeObjectsProperties$1=function(e,t,n){var r=n[e];if(void 0===r)return t;var i=t[e];return i&&r?"string"==typeof i||"number"==typeof i||"boolean"==typeof i||"string"==typeof r||"number"==typeof r||"boolean"==typeof r||Array.isArray(i)||Array.isArray(r)?(t[e]=r,t):(t[e]=Object.assign({},i,r),t):(t[e]=r,t)};function deepEqual$3(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!=typeof e[n])return!1;if(!deepEqual$3(e[n],t[n]))return!1}}for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}function setValueToPath$1(e,t,n){var r,i=n.split(".");for(r=0;r<i.length-1;r++)e[i[r]]||(e[i[r]]={}),"object"!=typeof e[i[r]]&&(e[i[r]]={}),e=e[i[r]];e[i[r]]=t}function isSubset$1(e,t){return Object.keys(t).every((function(n){return"object"==typeof t[n]?isSubset$1((null==e?void 0:e[n])||{},t[n]||{}):t[n]===(null==e?void 0:e[n])}))}function deletePath$1(e,t){var n,r=t.split(".");for(n=0;n<r.length-1;n++){if(!e[r[n]])return;e=e[r[n]]}delete e[r[n]]}var GW3Bridge$1=function(){function e(e){var t,n=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._creationPromises={},this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._contextsTempCache={},this._contextsSubscriptionsCache=[],this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[GW_MESSAGE_CONTEXT_CREATED$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1,GW_MESSAGE_CONTEXT_DESTROYED$1,GW_MESSAGE_CONTEXT_UPDATED$1]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined((function(e){if(e)return n._reAnnounceKnownContexts?void n.reInitiateState().then((function(){return n._connection.setLibReAnnounced({name:"contexts"})})):n._connection.setLibReAnnounced({name:"contexts"})})),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(t=this._connection.replayer)||void 0===t||t.drain(ContextMessageReplaySpec$1.name,(function(e){var t=e.type;t&&(t===GW_MESSAGE_CONTEXT_CREATED$1||t===GW_MESSAGE_CONTEXT_ADDED$1||t===GW_MESSAGE_ACTIVITY_CREATED$1?n.handleContextCreatedMessage(e):t===GW_MESSAGE_SUBSCRIBED_CONTEXT$1||t===GW_MESSAGE_CONTEXT_UPDATED$1||t===GW_MESSAGE_JOINED_ACTIVITY$1?n.handleContextUpdatedMessage(e):t!==GW_MESSAGE_CONTEXT_DESTROYED$1&&t!==GW_MESSAGE_ACTIVITY_DESTROYED$1||n.handleContextDestroyedMessage(e))}))}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;if(!this._protocolVersion){var t=this._connection.availableDomains.find((function(e){return"context"===e.uri}));this._protocolVersion=null!==(e=null==t?void 0:t.version)&&void 0!==e?e:1}return this._protocolVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._gw3Subscriptions;e<t.length;e++){var n=t[e];this._connection.off(n)}for(var r in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},e.prototype.createContext=function(e,t){var n=this;return e in this._creationPromises||(this._creationPromises[e]=this._gw3Session.send({type:GW_MESSAGE_CREATE_CONTEXT$1,domain:"global",name:e,data:t,lifetime:"retained"}).then((function(r){n._contextNameToId[e]=r.context_id,n._contextIdToName[r.context_id]=e;var i=n._contextNameToData[e]||new GW3ContextData$1(r.context_id,e,!0,void 0);return i.isAnnounced=!0,i.name=e,i.contextId=r.context_id,i.context=r.data||deepClone$1(t),i.hasReceivedSnapshot=!0,n._contextNameToData[e]=i,delete n._creationPromises[e],r.context_id}))),this._creationPromises[e]},e.prototype.all=function(){var e=this;return Object.keys(this._contextNameToData).filter((function(t){return e._contextNameToData[t].isAnnounced}))},e.prototype.update=function(e,t){var n;return __awaiter$6(this,void 0,void 0,(function(){var r,i,o,l=this;return __generator$1(this,(function(s){switch(s.label){case 0:return t&&(t=deepClone$1(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:s.sent(),s.label=2;case 2:return(r=this._contextNameToData[e])&&r.isAnnounced?(i=r.context,r.hasCallbacks()?[3,4]:[4,this.get(r.name)]):[2,this.createContext(e,t)];case 3:i=s.sent(),s.label=4;case 4:return o=this.setPathSupported?this.calculateContextDeltaV2(i,t):this.calculateContextDeltaV1(i,t),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(n=o.commands)||void 0===n?void 0:n.length)?[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1,domain:"global",context_id:r.contextId,delta:o},{},{skipPeerId:!1}).then((function(e){l.handleUpdated(r,o,{updaterId:e.peer_id})}))]:[2,Promise.resolve()]}}))}))},e.prototype.set=function(e,t){return __awaiter$6(this,void 0,void 0,(function(){var n,r=this;return __generator$1(this,(function(i){switch(i.label){case 0:return t&&(t=deepClone$1(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:i.sent(),i.label=2;case 2:return(n=this._contextNameToData[e])&&n.isAnnounced?[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1,domain:"global",context_id:n.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then((function(e){r.handleUpdated(n,{reset:t,added:{},removed:[],updated:{}},{updaterId:e.peer_id})}))]:[2,this.createContext(e,t)]}}))}))},e.prototype.setPath=function(e,t,n){return this.setPathSupported?this.setPaths(e,[{path:t,value:n}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},e.prototype.setPaths=function(e,t){return __awaiter$6(this,void 0,void 0,(function(){var n,r,i,o,l,s,a,u,c=this;return __generator$1(this,(function(h){switch(h.label){case 0:return this.setPathSupported?(t&&(t=deepClone$1(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2]):[2,Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later")];case 1:h.sent(),h.label=2;case 2:if(!(n=this._contextNameToData[e])||!n.isAnnounced){for(r={},i=0,o=t;i<o.length;i++)u=o[i],setValueToPath$1(r,u.value,u.path);return[2,this.createContext(e,r)]}for(l=[],s=0,a=t;s<a.length;s++)null===(u=a[s]).value?l.push({type:"remove",path:u.path}):l.push({type:"set",path:u.path,value:u.value});return[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT$1,domain:"global",context_id:n.contextId,delta:{commands:l}},{},{skipPeerId:!1}).then((function(e){c.handleUpdated(n,{added:{},removed:[],updated:{},commands:l},{updaterId:e.peer_id})}))]}}))}))},e.prototype.get=function(e){var t;return __awaiter$6(this,void 0,void 0,(function(){var n,r,i=this;return __generator$1(this,(function(o){switch(o.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:o.sent(),o.label=2;case 2:return(n=this._contextNameToData[e])&&n.isAnnounced?!n||n.hasCallbacks()&&n.hasReceivedSnapshot?(r=null!==(t=null==n?void 0:n.context)&&void 0!==t?t:{},[2,Promise.resolve(deepClone$1(r))]):[2,new Promise((function(t){i.subscribe(e,(function(e,n,r,o){i.unsubscribe(o),t(e)}))}))]:[2,Promise.resolve({})]}}))}))},e.prototype.subscribe=function(e,t,n){return __awaiter$6(this,void 0,void 0,(function(){var r,i,o,l,s=this;return __generator$1(this,(function(a){switch(a.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:a.sent(),a.label=2;case 2:return r=void 0===n?this._nextCallbackSubscriptionNumber:n,void 0===n&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every((function(e){return e.subKey!==s._nextCallbackSubscriptionNumber}))&&this._contextsSubscriptionsCache.push({contextName:e,subKey:r,callback:t}),(i=this._contextNameToData[e])&&i.isAnnounced?(o=i.hasCallbacks(),i.updateCallbacks[r]=t,o||i.joinedActivity||i.context&&i.sentExplicitSubscription?(i.hasReceivedSnapshot&&(l=deepClone$1(i.context),t(l,l,[],r)),[2,Promise.resolve(r)]):[2,this.sendSubscribe(i).then((function(){return r}))]):(i=i||new GW3ContextData$1(void 0,e,!1,void 0),this._contextNameToData[e]=i,i.updateCallbacks[r]=t,[2,Promise.resolve(r)])}}))}))},e.prototype.unsubscribe=function(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter((function(t){return t.subKey!==e}));for(var t=0,n=Object.keys(this._contextNameToData);t<n.length;t++){var r=n[t],i=this._contextNameToData[r];if(!i)return;var o=i.hasCallbacks();delete i.updateCallbacks[e],i.isAnnounced&&o&&!i.hasCallbacks()&&i.sentExplicitSubscription&&this.sendUnsubscribe(i),i.isAnnounced||i.hasCallbacks()||delete this._contextNameToData[r]}},e.prototype.destroy=function(e){return __awaiter$6(this,void 0,void 0,(function(){var t;return __generator$1(this,(function(n){switch(n.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:n.sent(),n.label=2;case 2:return(t=this._contextNameToData[e])?[2,this._gw3Session.send({type:GW_MESSAGE_DESTROY_CONTEXT$1,domain:"global",context_id:t.contextId}).then((function(e){}))]:[2,Promise.reject("context with ".concat(e," does not exist"))]}}))}))},e.prototype.handleUpdated=function(e,t,n){var r=e.context;e.context=applyContextDelta$1(e.context,t,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]!==e||deepEqual$3(r,e.context)||this.invokeUpdateCallbacks(e,t,n)},e.prototype.subscribeToContextCreatedMessages=function(){for(var e=0,t=[GW_MESSAGE_CONTEXT_ADDED$1,GW_MESSAGE_CONTEXT_CREATED$1,GW_MESSAGE_ACTIVITY_CREATED$1];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextCreatedMessage=function(e){var t=this,n=e.type;n===GW_MESSAGE_ACTIVITY_CREATED$1?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):n===GW_MESSAGE_CONTEXT_ADDED$1&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);var r=this._contextIdToName[e.context_id];if(!r)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[r])throw new Error("Received created event for context with unknown id: "+e.context_id);var i=this._contextNameToData[r];if(i){if(i.isAnnounced)return;if(!i.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");i.isAnnounced=!0,i.contextId=e.context_id,i.activityId=e.activity_id,i.sentExplicitSubscription||this.sendSubscribe(i)}else this._contextNameToData[r]=i=new GW3ContextData$1(e.context_id,r,!0,e.activity_id),this._trackAllContexts&&this.subscribe(r,(function(){})).then((function(e){return t._systemContextsSubKey=e}))},e.prototype.subscribeToContextUpdatedMessages=function(){for(var e=0,t=[GW_MESSAGE_CONTEXT_UPDATED$1,GW_MESSAGE_SUBSCRIBED_CONTEXT$1,GW_MESSAGE_JOINED_ACTIVITY$1];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextUpdatedMessage=function(e){var t=e.type,n=e.context_id,r=this._contextNameToData[this._contextIdToName[n]],i=!r||!r.isAnnounced;if(t===GW_MESSAGE_JOINED_ACTIVITY$1)r||(r=this._contextNameToData[e.activity_id]||new GW3ContextData$1(n,e.activity_id,!0,e.activity_id)),this._contextNameToData[e.activity_id]=r,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n,r.contextId=n,r.isAnnounced=!0,r.activityId=e.activity_id,r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(t===GW_MESSAGE_SUBSCRIBED_CONTEXT$1?((r=r||new GW3ContextData$1(n,e.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[e.name]=r,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error("Received 'update' for unknown context: ".concat(n)));var o=r.context;if(r.hasReceivedSnapshot=!0,t===GW_MESSAGE_SUBSCRIBED_CONTEXT$1)r.context=e.data||{};else if(t===GW_MESSAGE_JOINED_ACTIVITY$1)r.context=e.context_snapshot||{};else{if(t!==GW_MESSAGE_CONTEXT_UPDATED$1)throw new Error("Unrecognized context update message "+t);r.context=applyContextDelta$1(r.context,e.delta,this._logger)}!i&&deepEqual$3(r.context,o)&&t!==GW_MESSAGE_SUBSCRIBED_CONTEXT$1||this.invokeUpdateCallbacks(r,e.delta,{updaterId:e.updater_id})},e.prototype.invokeUpdateCallbacks=function(e,t,n){if((t=t||{added:{},updated:{},reset:{},removed:[]}).commands){t.added=t.updated=t.reset={},t.removed=[];for(var r=0,i=t.commands;r<i.length;r++){var o=i[r];"remove"===o.type?(-1===o.path.indexOf(".")&&t.removed.push(o.path),setValueToPath$1(t.updated,null,o.path)):"set"===o.type&&setValueToPath$1(t.updated,o.value,o.path)}}for(var l in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(l))try{(0,e.updateCallbacks[l])(deepClone$1(e.context),deepClone$1(Object.assign({},t.added||{},t.updated||{},t.reset||{})),t.removed,parseInt(l,10),n)}catch(e){this._logger.debug("callback error: "+JSON.stringify(e))}},e.prototype.subscribeToContextDestroyedMessages=function(){for(var e=0,t=[GW_MESSAGE_CONTEXT_DESTROYED$1,GW_MESSAGE_ACTIVITY_DESTROYED$1];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextDestroyedMessage=function(e){var t,n;if(e.type===GW_MESSAGE_ACTIVITY_DESTROYED$1){if(n=e.activity_id,!(t=this._contextNameToId[n]))return void this._logger.error("Received 'destroyed' for unknown activity: ".concat(e.activity_id))}else if(t=e.context_id,!(n=this._contextIdToName[t]))return void this._logger.error("Received 'destroyed' for unknown context: ".concat(e.context_id));delete this._contextIdToName[t],delete this._contextNameToId[n];var r=this._contextNameToData[n];delete this._contextNameToData[n],r&&r.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: ".concat(t))},e.prototype.sendSubscribe=function(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:GW_MESSAGE_SUBSCRIBE_CONTEXT$1,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.sendUnsubscribe=function(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:GW_MESSAGE_UNSUBSCRIBE_CONTEXT$1,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.calculateContextDeltaV1=function(e,t){var n={added:{},updated:{},removed:[],reset:void 0};if(e)for(var r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];-1===Object.keys(t).indexOf(o)||null===t[o]||deepEqual$3(e[o],t[o])||(n.updated[o]=t[o])}for(var l=0,s=Object.keys(t);l<s.length;l++){o=s[l];e&&-1!==Object.keys(e).indexOf(o)?null===t[o]&&n.removed.push(o):null!==t[o]&&(n.added[o]=t[o])}return n},e.prototype.calculateContextDeltaV2=function(e,t){for(var n,r,i={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,l=Object.keys(t);o<l.length;o++){var s=l[o];if(null!==t[s])deepEqual$3(e?e[s]:null,t[s])||null===(n=i.commands)||void 0===n||n.push({type:"set",path:s,value:t[s]});else null===(r=i.commands)||void 0===r||r.push({type:"remove",path:s})}return i},e.prototype.resetState=function(){for(var e=this,t=0,n=this._gw3Subscriptions;t<n.length;t++){var r=n[t];this._connection.off(r)}this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((function(t,n){return t[n]=e._contextNameToData[n].context,t}),{}),this._contextNameToData={}},e.prototype.reInitiateState=function(){var e;return __awaiter$6(this,void 0,void 0,(function(){var t,n,r,i,o,l,s=this;return __generator$1(this,(function(a){switch(a.label){case 0:return this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(ContextMessageReplaySpec$1.name,(function(e){var t=e.type;t&&(t===GW_MESSAGE_CONTEXT_CREATED$1||t===GW_MESSAGE_CONTEXT_ADDED$1||t===GW_MESSAGE_ACTIVITY_CREATED$1?s.handleContextCreatedMessage(e):t===GW_MESSAGE_SUBSCRIBED_CONTEXT$1||t===GW_MESSAGE_CONTEXT_UPDATED$1||t===GW_MESSAGE_JOINED_ACTIVITY$1?s.handleContextUpdatedMessage(e):t!==GW_MESSAGE_CONTEXT_DESTROYED$1&&t!==GW_MESSAGE_ACTIVITY_DESTROYED$1||s.handleContextDestroyedMessage(e))})),[4,Promise.all(this._contextsSubscriptionsCache.map((function(e){return s.subscribe(e.contextName,e.callback,e.subKey)})))];case 1:return a.sent(),[4,this.flushQueue()];case 2:for(r in a.sent(),t=this._contextsTempCache,n=[],t)n.push(r);i=0,a.label=3;case 3:return i<n.length?(r=n[i])in t?(o=r,"object"!=typeof this._contextsTempCache[o]||0===Object.keys(this._contextsTempCache[o]).length?[3,6]:(l=this._contextsTempCache[o],this._logger.info("Re-announcing known context: ".concat(o)),[4,this.flushQueue()])):[3,6]:[3,7];case 4:return a.sent(),[4,this.update(o,l)];case 5:a.sent(),a.label=6;case 6:return i++,[3,3];case 7:return this._contextsTempCache={},this._logger.info("Contexts are re-announced"),[2]}}))}))},e.prototype.flushQueue=function(){return new Promise((function(e){return setTimeout((function(){return e()}),0)}))},e}(),ContextsModule$1=function(){function e(e){this._bridge=new GW3Bridge$1(e)}return e.prototype.all=function(){return this._bridge.all()},e.prototype.update=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.update(e,t)},e.prototype.set=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.set(e,t)},e.prototype.setPath=function(e,t,n){return this.checkName(e),this.checkPath(t),""===t?(this.checkData(n),this.set(e,n)):this._bridge.setPath(e,t,n)},e.prototype.setPaths=function(e,t){if(this.checkName(e),!Array.isArray(t))throw new Error("Please provide the paths as an array of PathValues!");for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i.path,l=i.value;this.checkPath(o),""===o&&this.checkData(l)}return this._bridge.setPaths(e,t)},e.prototype.subscribe=function(e,t){var n=this;if(this.checkName(e),"function"!=typeof t)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(function(e,r,i,o,l){return t(e,r,i,(function(){return n._bridge.unsubscribe(o)}),l)})).then((function(e){return function(){n._bridge.unsubscribe(e)}}))},e.prototype.get=function(e){return this.checkName(e),this._bridge.get(e)},e.prototype.ready=function(){return Promise.resolve(this)},e.prototype.destroy=function(e){return this.checkName(e),this._bridge.destroy(e)},Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!1,configurable:!0}),e.prototype.checkName=function(e){if("string"!=typeof e||""===e)throw new Error("Please provide the name as a non-empty string!")},e.prototype.checkPath=function(e){if("string"!=typeof e)throw new Error("Please provide the path as a dot delimited string!")},e.prototype.checkData=function(e){if("object"!=typeof e)throw new Error("Please provide the data as an object!")},e}(),InvokeStatus$1;function promisify$1(e,t,n){return"function"!=typeof t&&"function"!=typeof n?e:("function"!=typeof t?t=function(){}:"function"!=typeof n&&(n=function(){}),e.then(t,n))}function rejectAfter$1(e,t,n){var r;void 0===e&&(e=0);var i=function(){r&&clearTimeout(r)};return t.then((function(){i()})).catch((function(){i()})),new Promise((function(t,i){r=setTimeout((function(){return i(n)}),e)}))}!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(InvokeStatus$1||(InvokeStatus$1={}));var Client$1=function(){function e(e,t,n,r){this.protocol=e,this.repo=t,this.instance=n,this.configuration=r}return e.prototype.subscribe=function(e,t,n,r,i){var o=this,l=function(e,n,r,l){var s;t.methodResponseTimeout=null!==(s=t.methodResponseTimeout)&&void 0!==s?s:t.waitTimeoutMs,o.protocol.client.subscribe(n,t,e,r,l,i)},s=new Promise((function(n,r){var i,s=function(e){n(e)},a=function(e){r(e)};if(e)if((i="string"==typeof e?{name:e}:e).name){void 0===t&&(t={});var u=t.target;if(void 0===u&&(u="best"),"string"!=typeof u||"all"===u||"best"===u){void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=t.method_response_timeout,void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=t.wait_for_method_timeout,void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=o.configuration.waitTimeoutMs));var c=0,h=o.getServerMethodsByFilterAndTarget(i,u);if(h.length>0)l(h,h[0].methods[0],s,a);else{var d=function(){if(u&&t.waitTimeoutMs)if(c+=500,(h=o.getServerMethodsByFilterAndTarget(i,u)).length>0){var n=h[0].methods[0];l(h,n,s,a)}else if(c>=t.waitTimeoutMs){l(h,"string"==typeof e?{name:e}:e,s,a)}else setTimeout(d,500)};setTimeout(d,500)}}else r(new Error('"'.concat(u,'" is not a valid target. Valid targets are "all", "best", or an instance.')))}else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")}));return promisify$1(s,n,r)},e.prototype.servers=function(e){var t=void 0===e?void 0:__assign$4({},e);return this.getServers(t).map((function(e){return e.server.instance}))},e.prototype.methods=function(e){return e="string"==typeof e?{name:e}:__assign$4({},e),this.getMethods(e)},e.prototype.methodsForInstance=function(e){return this.getMethodsForInstance(e)},e.prototype.methodAdded=function(e){return this.repo.onMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.repo.onMethodRemoved(e)},e.prototype.serverAdded=function(e){return this.repo.onServerAdded(e)},e.prototype.serverRemoved=function(e){return this.repo.onServerRemoved((function(t,n){e(t,n)}))},e.prototype.serverMethodAdded=function(e){return this.repo.onServerMethodAdded((function(t,n){e({server:t,method:n})}))},e.prototype.serverMethodRemoved=function(e){return this.repo.onServerMethodRemoved((function(t,n){e({server:t,method:n})}))},e.prototype.invoke=function(e,t,n,r,i,o){return __awaiter$6(this,void 0,void 0,(function(){var l,s=this;return __generator$1(this,(function(a){return l=function(){return __awaiter$6(s,void 0,void 0,(function(){var i,o,l,s,a,u,c,h,d,f,p,g,w=this;return __generator$1(this,(function(m){switch(m.label){case 0:if(!(i="string"==typeof e?{name:e}:__assign$4({},e)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")];if(t||(t={}),n||(n="best"),"string"==typeof n&&"all"!==n&&"best"!==n&&"skipMine"!==n)return[2,Promise.reject(new Error('"'.concat(n,'" is not a valid target. Valid targets are "all" and "best".')))];if(r||(r={}),void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=r.method_response_timeout,void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=r.wait_for_method_timeout,void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==r.waitTimeoutMs&&"number"!=typeof r.waitTimeoutMs)return[2,Promise.reject(new Error('"'.concat(r.waitTimeoutMs,'" is not a valid number for "waitTimeoutMs" ')))];if("object"!=typeof t)return[2,Promise.reject(new Error("The method arguments must be an object. method: ".concat(i.name)))];if(0!==(o=this.getServerMethodsByFilterAndTarget(i,n)).length)return[3,4];m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(i,n,r)];case 2:return o=m.sent(),[3,4];case 3:return m.sent(),l=__assign$4(__assign$4({},i),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(f=i.objectTypes)&&void 0!==f?f:[],flags:null!==(g=null===(p=i.flags)||void 0===p?void 0:p.metadata)&&void 0!==g?g:{}}),s={method:l,called_with:t,message:"Can not find a method matching ".concat(JSON.stringify(e)," with server filter ").concat(JSON.stringify(n)),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(s)];case 4:return a=r.methodResponseTimeoutMs,u=r,c=o.map((function(e){var n=shortid$4(),r=e.methods[0],i=e.server,o=w.protocol.client.invoke(n,r,t,i,u);return Promise.race([o,rejectAfter$1(a,o,{invocationId:n,message:"Invocation timeout (".concat(a," ms) reached for method name: ").concat(null==r?void 0:r.name,", target instance: ").concat(JSON.stringify(i.instance),", options: ").concat(JSON.stringify(u)),status:InvokeStatus$1.Error})])})),[4,Promise.all(c)];case 5:return h=m.sent(),d=this.getInvocationResultObj(h,i,t),h.every((function(e){return e.status===InvokeStatus$1.Error}))?[2,Promise.reject(d)]:[2,d]}}))}))},[2,promisify$1(l(),i,o)]}))}))},e.prototype.getInvocationResultObj=function(e,t,n){var r=e.filter((function(e){return e.status===InvokeStatus$1.Success})).reduce((function(e,r){return e=__spreadArray$1(__spreadArray$1([],e,!0),[{executed_by:r.instance,returned:r.result,called_with:n,method:t,message:r.message,status:r.status}],!1)}),[]),i=e.filter((function(e){return e.status===InvokeStatus$1.Error})).reduce((function(e,r){return e=__spreadArray$1(__spreadArray$1([],e,!0),[{executed_by:r.instance,called_with:n,name:t.name,message:r.message}],!1)}),[]),o=e[0];return{method:t,called_with:n,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:i,message:o.message,status:o.status}},e.prototype.tryToAwaitForMethods=function(e,t,n){var r=this;return new Promise((function(i,o){if(0!==n.waitTimeoutMs)var l=0,s=setInterval((function(){l+=500;var a=r.getServerMethodsByFilterAndTarget(e,t);if(a.length>0)clearInterval(s),i(a);else if(l>=(n.waitTimeoutMs||1e4))return clearInterval(s),void o()}),500);else o()}))},e.prototype.filterByTarget=function(e,t){var n=this;if("string"!=typeof e){return(Array.isArray(e)?e:[e]).reduce((function(e,r){var i=t.filter((function(e){return n.instanceMatch(r,e.server.instance)}));return e.concat(i)}),[])}if("all"===e)return __spreadArray$1([],t,!0);if("best"===e){var r=t.find((function(e){return e.server.instance.isLocal}));if(r)return[r];if(void 0!==t[0])return[t[0]]}else if("skipMine"===e)return t.filter((function(e){return e.server.instance.peerId!==n.instance.peerId}));return[]},e.prototype.instanceMatch=function(e,t){return this.containsProps(e,t)},e.prototype.methodMatch=function(e,t){return this.containsProps(e,t)},e.prototype.containsProps=function(e,t){return Object.keys(e).filter((function(t){return void 0!==e[t]&&null!==e[t]&&"function"!=typeof e[t]&&"object_types"!==t&&"display_name"!==t&&"id"!==t&&"gatewayId"!==t&&"identifier"!==t&&"_"!==t[0]})).every((function(n){var r,i=e[n],o=t[n];switch(n){case"objectTypes":r=(i||[]).every((function(e){return(o||[]).includes(e)}));break;case"flags":r=isSubset$1(o||{},i||{});break;default:r=String(i).toLowerCase()===String(o).toLowerCase()}return r}))},e.prototype.getMethods=function(e){var t=this;return void 0===e?this.repo.getMethods():this.repo.getMethods().filter((function(n){return t.methodMatch(e,n)}))},e.prototype.getMethodsForInstance=function(e){var t=this,n=this.repo.getServers().filter((function(n){return t.instanceMatch(e,n.instance)}));if(0===n.length)return[];var r={};return 1===n.length?r=n[0].methods:n.forEach((function(e){Object.keys(e.methods).forEach((function(t){var n=e.methods[t];r[n.identifier]=n}))})),Object.keys(r).map((function(e){return r[e]}))},e.prototype.getServers=function(e){var t=this,n=this.repo.getServers();return void 0===e?n.map((function(e){return{server:e,methods:[]}})):n.reduce((function(n,r){var i=Object.values(r.methods).filter((function(n){return t.methodMatch(e,n)}));return i.length>0&&n.push({server:r,methods:i}),n}),[])},e.prototype.getServerMethodsByFilterAndTarget=function(e,t){var n=this.getServers(e);return this.filterByTarget(t,n)},e}(),ServerSubscription$1=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.subscription=n}return Object.defineProperty(e.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!1,configurable:!0}),e.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},e.prototype.push=function(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)},e}(),Request$2=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}return e.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},e.prototype.acceptOnBranch=function(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)},e.prototype.reject=function(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)},e}(),ServerStreaming$1$1=function(){function e(e,t){var n=this;this.protocol=e,this.server=t,e.server.onSubRequest((function(e,t){return n.handleSubRequest(e,t)})),e.server.onSubAdded((function(e,t){return n.handleSubAdded(e,t)})),e.server.onSubRemoved((function(e,t){return n.handleSubRemoved(e,t)}))}return e.prototype.handleSubRequest=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRequestHandler){var n=new Request$2(this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}},e.prototype.handleSubAdded=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionAddedHandler){var n=new ServerSubscription$1(this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}},e.prototype.handleSubRemoved=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRemovedHandler){var n=new ServerSubscription$1(this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},e}(),ServerBranch$1=function(){function e(e,t,n){this.key=e,this.protocol=t,this.repoMethod=n}return e.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(t){return new ServerSubscription$1(e.protocol,e.repoMethod,t)}))},e.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},e.prototype.push=function(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])},e}(),ServerStream$1=function(){function e(e,t,n){this._protocol=e,this._repoMethod=t,this._server=n,this.name=this._repoMethod.definition.name}return e.prototype.branches=function(e){var t=this,n=this._protocol.server.getBranchList(this._repoMethod);return e?n.indexOf(e)>-1?new ServerBranch$1(e,this._protocol,this._repoMethod):void 0:n.map((function(e){return new ServerBranch$1(e,t._protocol,t._repoMethod)}))},e.prototype.branch=function(e){return this.branches(e)},e.prototype.subscriptions=function(){var e=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(t){return new ServerSubscription$1(e._protocol,e._repoMethod,t)}))},Object.defineProperty(e.prototype,"definition",{get:function(){var e,t=this._repoMethod.definition;return{accepts:t.accepts,description:t.description,displayName:t.displayName,name:t.name,objectTypes:t.objectTypes,returns:t.returns,supportsStreaming:t.supportsStreaming,flags:null===(e=t.flags)||void 0===e?void 0:e.metadata}},enumerable:!1,configurable:!0}),e.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},e.prototype.push=function(e,t){if("string"!=typeof t&&!Array.isArray(t)&&void 0!==t)throw new Error("invalid branches should be string or string array");if("object"!=typeof e)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,t)},e.prototype.updateRepoMethod=function(e){this._repoMethod=e},e}(),Server$1=function(){function e(e,t){this.protocol=e,this.serverRepository=t,this.invocations=0,this.currentlyUnregistering={},this.streaming=new ServerStreaming$1$1(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return e.prototype.createStream=function(e,t,n,r,i){var o=this,l=new Promise((function(n,r){if(e){var l;if(!(l="string"==typeof e?{name:""+e}:__assign$4({},e)).name)return r("The name property is required for the streamDefinition object and must be unique. Stream definition: ".concat(JSON.stringify(l)));if(o.serverRepository.getList().some((function(e){return e.definition.name===l.name})))return r('A stream with the name "'.concat(l.name,'" already exists! Please, provide a unique name for the stream.'));l.supportsStreaming=!0,t||(t={}),"function"!=typeof t.subscriptionRequestHandler&&(t.subscriptionRequestHandler=function(e){e.accept()});var s=o.serverRepository.add({definition:l,streamCallbacks:t,protocolState:{}});o.protocol.server.createStream(s).then((function(){var e;i?(e=i,i.updateRepoMethod(s)):e=new ServerStream$1(o.protocol,s,o),s.stream=e,n(e)})).catch((function(e){s.repoId&&o.serverRepository.remove(s.repoId),r(e)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to glue.interop.createStream() or a methodDefinition object with a unique name property for the stream.")}));return promisify$1(l,n,r)},e.prototype.register=function(e,t){var n=this;if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof t)return Promise.reject("The second parameter must be a callback function. Method: ".concat("string"==typeof e?e:e.name));var r=function(e,r){return __awaiter$6(n,void 0,void 0,(function(){var n,i,o;return __generator$1(this,(function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),(n=t(e.args,e.instance))&&"function"==typeof n.then?[4,n]:[3,2];case 1:return i=l.sent(),r(void 0,i),[3,3];case 2:r(void 0,n),l.label=3;case 3:return[3,5];case 4:return o=l.sent(),r(null!=o?o:"",null!=o?o:""),[3,5];case 5:return[2]}}))}))};return r.userCallback=t,this.registerCore(e,r)},e.prototype.registerAsync=function(e,t){var n=this;if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof t)return Promise.reject("The second parameter must be a callback function. Method: ".concat("string"==typeof e?e:e.name));var r=function(e,r){return __awaiter$6(n,void 0,void 0,(function(){var n,i,o,l;return __generator$1(this,(function(s){try{n=!1,i=function(e){n||r(void 0,e),n=!0},o=function(e){n||(e||(e=""),r(e,e)),n=!0},(l=t(e.args,e.instance,i,o))&&"function"==typeof l.then&&l.then(i).catch(o)}catch(e){r(e,void 0)}return[2]}))}))};return r.userCallbackAsync=t,this.registerCore(e,r)},e.prototype.unregister=function(e,t){return void 0===t&&(t=!1),__awaiter$6(this,void 0,void 0,(function(){var n,r;return __generator$1(this,(function(i){switch(i.label){case 0:return void 0===e?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a name property.")]:"function"!=typeof e?[3,2]:[4,this.unregisterWithPredicate(e,t)];case 1:case 3:return i.sent(),[2];case 2:return void 0===(n="string"==typeof e?{name:e}:e).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(r=this.serverRepository.getList().find((function(e){return e.definition.name===n.name&&(e.definition.supportsStreaming||!1)===t})))?[4,this.removeMethodsOrStreams([r])]:[2,Promise.reject('Method with a name "'.concat(n.name,'" does not exist or is not registered by your application!'))]}}))}))},e.prototype.unregisterWithPredicate=function(e,t){return __awaiter$6(this,void 0,void 0,(function(){var n;return __generator$1(this,(function(r){switch(r.label){case 0:return(n=this.serverRepository.getList().filter((function(t){return e(t.definition)})).filter((function(e){return(e.definition.supportsStreaming||!1)===t})))&&0!==n.length?[4,this.removeMethodsOrStreams(n)]:[2,Promise.reject("Could not find a ".concat(t?"stream":"method"," matching the specified condition!"))];case 1:return r.sent(),[2]}}))}))},e.prototype.removeMethodsOrStreams=function(e){var t=this,n=[];return e.forEach((function(e){var r=t.protocol.server.unregister(e).then((function(){e.repoId&&t.serverRepository.remove(e.repoId)}));n.push(r),t.addAsCurrentlyUnregistering(e.definition.name,r)})),Promise.all(n)},e.prototype.addAsCurrentlyUnregistering=function(e,t){return __awaiter$6(this,void 0,void 0,(function(){var n,r=this;return __generator$1(this,(function(i){return n=new Promise((function(e){return setTimeout(e,5e3)})),this.currentlyUnregistering[e]=Promise.race([t,n]).then((function(){delete r.currentlyUnregistering[e]})),[2]}))}))},e.prototype.registerCore=function(e,t){return __awaiter$6(this,void 0,void 0,(function(){var n,r,i,o=this;return __generator$1(this,(function(l){switch(l.label){case 0:return(n="string"==typeof e?{name:""+e}:__assign$4({},e)).name?void 0===(r=this.currentlyUnregistering[n.name])?[3,2]:[4,r]:[2,Promise.reject("Please, provide a (unique) string value for the name property in the methodDefinition object: ".concat(JSON.stringify(e)))];case 1:l.sent(),l.label=2;case 2:return this.serverRepository.getList().some((function(e){return e.definition.name===n.name}))?[2,Promise.reject('A method with the name "'.concat(n.name,'" already exists! Please, provide a unique name for the method.'))]:n.supportsStreaming?[2,Promise.reject("When you create methods with glue.interop.register() or glue.interop.registerAsync() the property supportsStreaming cannot be true. If you want ".concat(n.name," to be a stream, please use the glue.interop.createStream() method."))]:(i=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}}),[2,this.protocol.server.register(i).catch((function(e){throw(null==i?void 0:i.repoId)&&o.serverRepository.remove(i.repoId),e}))])}}))}))},e.prototype.onMethodInvoked=function(e,t,n){var r=this;e&&e.theFunction&&e.theFunction(n,(function(n,i){if(null!=n)if(n.message&&"string"==typeof n.message)n=n.message;else if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n="un-stringifyable error in onMethodInvoked! Top level prop names: ".concat(Object.keys(n))}i?("object"!=typeof i||Array.isArray(i))&&(i={_value:i}):i={},r.protocol.server.methodInvocationResult(e,t,n,i)}))},e}(),InstanceWrapper$1=function(){function e(e,t,n){var r=this;this.wrapped={},this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter((function(e){return e.supportsStreaming}))},t&&this.refreshWrappedObject(t),n&&(n.loggedIn((function(){r.refresh(n)})),this.refresh(n))}return e.prototype.unwrap=function(){return this.wrapped},e.prototype.refresh=function(e){if(e){var t=null==e?void 0:e.resolvedIdentity,n=Object.assign({},null!=t?t:{},{peerId:null==e?void 0:e.peerId});this.refreshWrappedObject(n)}},e.prototype.refreshWrappedObject=function(e){var t,n,r,i,o=this;Object.keys(e).forEach((function(t){o.wrapped[t]=e[t]})),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=null!==(t=e.application)&&void 0!==t?t:shortid$4(),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=null!==(r=null!==(n=e.pid)&&void 0!==n?n:e.process)&&void 0!==r?r:Math.floor(1e10*Math.random()),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=null===(i=e.isLocal)||void 0===i||i,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId},e}(),hideMethodSystemFlags$1=function(e){return __assign$4(__assign$4({},e),{flags:e.flags.metadata||{}})},ClientRepository$1=function(){function e(e,t){this.logger=e,this.API=t,this.servers={},this.methodsCount={},this.callbacks=lib$1$1();var n=this.API.instance.peerId;this.myServer={id:n,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[n]=this.myServer}return e.prototype.addServer=function(e,t){this.logger.debug("adding server ".concat(t));var n=this.servers[t];if(n)return n.id;var r=new InstanceWrapper$1(this.API,e),i={id:t,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[t]=i,this.callbacks.execute("onServerAdded",i.instance),t},e.prototype.removeServerById=function(e,t){var n=this,r=this.servers[e];r?(this.logger.debug("removing server ".concat(e)),Object.keys(r.methods).forEach((function(t){n.removeServerMethod(e,t)})),delete this.servers[e],this.callbacks.execute("onServerRemoved",r.instance,t)):this.logger.warn("not aware of server ".concat(e,", my state ").concat(JSON.stringify(Object.keys(this.servers))))},e.prototype.addServerMethod=function(e,t){var n,r=this.servers[e];if(!r)throw new Error("server does not exists");if(!r.methods[t.id]){var i=this.createMethodIdentifier(t),o=this,l={identifier:i,gatewayId:t.id,name:t.name,displayName:t.display_name,description:t.description,version:t.version,objectTypes:t.object_types||[],accepts:t.input_signature,returns:t.result_signature,supportsStreaming:void 0!==t.flags&&t.flags.streaming,flags:null!==(n=t.flags)&&void 0!==n?n:{},getServers:function(){return o.getServersByMethod(i)}};l.object_types=l.objectTypes,l.display_name=l.displayName,l.version=l.version,r.methods[t.id]=l;var s=hideMethodSystemFlags$1(l);return this.methodsCount[i]||(this.methodsCount[i]=0,this.callbacks.execute("onMethodAdded",s)),this.methodsCount[i]=this.methodsCount[i]+1,this.callbacks.execute("onServerMethodAdded",r.instance,s),l}},e.prototype.removeServerMethod=function(e,t){var n=this.servers[e];if(!n)throw new Error("server does not exists");var r=n.methods[t];delete n.methods[t];var i=hideMethodSystemFlags$1(r);this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,0===this.methodsCount[r.identifier]&&this.callbacks.execute("onMethodRemoved",i),this.callbacks.execute("onServerMethodRemoved",n.instance,i)},e.prototype.getMethods=function(){return this.extractMethodsFromServers(Object.values(this.servers)).map(hideMethodSystemFlags$1)},e.prototype.getServers=function(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)},e.prototype.onServerAdded=function(e){var t=this.callbacks.add("onServerAdded",e),n=this.getServers().map((function(e){return e.instance}));return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onMethodAdded=function(e){var t=this.callbacks.add("onMethodAdded",e),n=this.getMethods();return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onServerMethodAdded=function(e){var t=this.callbacks.add("onServerMethodAdded",e),n=!1,r=this.getServers();return setTimeout((function(){r.forEach((function(t){var r=t.methods;Object.keys(r).forEach((function(i){n||e(t.instance,r[i])}))}))}),0),function(){n=!0,t()}},e.prototype.onMethodRemoved=function(e){return this.callbacks.add("onMethodRemoved",e)},e.prototype.onServerRemoved=function(e){return this.callbacks.add("onServerRemoved",e)},e.prototype.onServerMethodRemoved=function(e){return this.callbacks.add("onServerMethodRemoved",e)},e.prototype.getServerById=function(e){return this.hideServerMethodSystemFlags(this.servers[e])},e.prototype.reset=function(){var e,t=this;Object.keys(this.servers).forEach((function(e){t.removeServerById(e,"reset")})),this.servers=((e={})[this.myServer.id]=this.myServer,e),this.methodsCount={}},e.prototype.createMethodIdentifier=function(e){var t,n,r=null!==(t=e.input_signature)&&void 0!==t?t:"",i=null!==(n=e.result_signature)&&void 0!==n?n:"";return(e.name+r+i).toLowerCase()},e.prototype.getServersByMethod=function(e){var t=[];return Object.values(this.servers).forEach((function(n){Object.values(n.methods).forEach((function(r){r.identifier===e&&t.push(n.instance)}))})),t},e.prototype.returnUnsubWithDelayedReplay=function(e,t,n){var r=!1;return setTimeout((function(){t.forEach((function(e){r||n(e)}))}),0),function(){r=!0,e()}},e.prototype.hideServerMethodSystemFlags=function(e){var t={};return Object.entries(e.methods).forEach((function(e){var n=e[0],r=e[1];t[n]=hideMethodSystemFlags$1(r)})),__assign$4(__assign$4({},e),{methods:t})},e.prototype.extractMethodsFromServers=function(e){return Object.values(e).reduce((function(e,t){return __spreadArray$1(__spreadArray$1([],e,!0),Object.values(t.methods),!0)}),[])},e}(),ServerRepository$1=function(){function e(){this.nextId=0,this.methods=[]}return e.prototype.add=function(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e},e.prototype.remove=function(e){if("string"!=typeof e)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(t){return t.repoId!==e}))},e.prototype.getById=function(e){if("string"==typeof e)return this.methods.find((function(t){return t.repoId===e}))},e.prototype.getList=function(){return this.methods.map((function(e){return e}))},e.prototype.length=function(){return this.methods.length},e.prototype.reset=function(){this.methods=[]},e}(),SUBSCRIPTION_REQUEST$1="onSubscriptionRequest",SUBSCRIPTION_ADDED$1="onSubscriptionAdded",SUBSCRIPTION_REMOVED$1="onSubscriptionRemoved",ServerStreaming$2=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.serverRepository=n,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=lib$1$1(),this.nextStreamId=0,e.on("add-interest",(function(e){r.handleAddInterest(e)})),e.on("remove-interest",(function(e){r.handleRemoveInterest(e)}))}return e.prototype.acceptRequestOnBranch=function(e,t,n){if("string"!=typeof n&&(n=""),"object"!=typeof t.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(t,n),i=e.msg.subscription_id,o={id:i,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:r,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[i]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:r}),this.callbacks.execute(SUBSCRIPTION_ADDED$1,o,t)},e.prototype.rejectRequest=function(e,t,n){"string"!=typeof n&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)},e.prototype.pushData=function(e,t,n){var r=this;if("object"==typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=[]),e.protocolState.branchKeyToStreamIdMap.filter((function(e){return!n||0===n.length||n.indexOf(e.key)>=0})).map((function(e){return e.streamId})).forEach((function(e){var n={type:"publish",stream_id:e,data:t};r.session.sendFireAndForget(n)}))}},e.prototype.pushDataToSingle=function(e,t,n){if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(r)},e.prototype.closeSingleSubscription=function(e,t){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[t.id];var n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n),t.instance,this.callbacks.execute(SUBSCRIPTION_REMOVED$1,t,e)},e.prototype.closeMultipleSubscriptions=function(e,t){var n=this;if("object"==typeof e&&"object"==typeof e.protocolState.subscriptionsMap&&e.protocolState.subscriptionsMap){var r=e.protocolState.subscriptionsMap,i=Object.keys(r).map((function(e){return r[e]}));"string"==typeof t&&(i=i.filter((function(e){return e.branchKey===t}))),i.forEach((function(e){delete r[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping all subscriptions on stream_id: "+e.streamId};n.session.sendFireAndForget(t)}))}},e.prototype.getSubscriptionList=function(e,t){if("object"!=typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var n=e.protocolState.subscriptionsMap,r=Object.keys(n).map((function(e){return n[e]}));return"string"!=typeof t?r:r.filter((function(e){return e.branchKey===t}))},e.prototype.getBranchList=function(e){if("object"!=typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var t=e.protocolState.subscriptionsMap,n=Object.keys(t).map((function(e){return t[e]})),r=[];return n.forEach((function(e){var t="";"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),-1===r.indexOf(t)&&r.push(t)})),r},e.prototype.onSubAdded=function(e){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED$1,e)},e.prototype.onSubRequest=function(e){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST$1,e)},e.prototype.onSubRemoved=function(e){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED$1,e)},e.prototype.handleRemoveInterest=function(e){var t=this.serverRepository.getById(e.method_id);if("string"==typeof e.subscription_id&&"object"==typeof t&&t.protocolState.subscriptionsMap&&"object"==typeof t.protocolState.subscriptionsMap[e.subscription_id]){var n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute(SUBSCRIPTION_REMOVED$1,n,t)}},e.prototype.onSubscriptionLifetimeEvent=function(e,t){this.callbacks.add(e,t)},e.prototype.getNextStreamId=function(){return this.nextStreamId+++""},e.prototype.handleAddInterest=function(e){var t=this.repository.getServerById(e.caller_id).instance,n={msg:e,arguments:e.arguments_kv||{},instance:t},r=this.serverRepository.getById(e.method_id);if(void 0!==r)r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[e.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id):this.callbacks.execute(SUBSCRIPTION_REQUEST$1,n,r);else{var i="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(i,e.subscription_id)}},e.prototype.sendSubscriptionFailed=function(e,t){var n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)},e.prototype.getStreamId=function(e,t){if("string"!=typeof t&&(t=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error("streaming ".concat(e.definition.name," method without protocol state"));var n=e.protocolState.branchKeyToStreamIdMap.filter((function(e){return e.key===t}))[0],r=n?n.streamId:void 0;return"string"==typeof r&&""!==r||(r=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:r})),r},e}(),ServerProtocol$1=function(){function e(e,t,n,r){var i=this;this.session=e,this.clientRepository=t,this.serverRepository=n,this.logger=r,this.callbacks=lib$1$1(),this.streaming=new ServerStreaming$2(e,t,n),this.session.on("invoke",(function(e){return i.handleInvokeMessage(e)}))}return e.prototype.createStream=function(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)},e.prototype.register=function(e,t){var n,r=this,i=e.definition,o=Object.assign({},{metadata:null!==(n=i.flags)&&void 0!==n?n:{}},{streaming:t||!1}),l={type:"register",methods:[{id:e.repoId,name:i.name,display_name:i.displayName,description:i.description,version:i.version,flags:o,object_types:i.objectTypes||i.object_types,input_signature:i.accepts,result_signature:i.returns,restrictions:void 0}]};return this.session.send(l,{methodId:e.repoId}).then((function(){r.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)})).catch((function(t){throw r.logger.warn("failed to register method ".concat(e.definition.name," with id ").concat(e.repoId," - ").concat(JSON.stringify(t))),t}))},e.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},e.prototype.methodInvocationResult=function(e,t,n,r){var i;i=n||""===n?{type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:r,peer_id:void 0}:{type:"yield",invocation_id:t,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(i)},e.prototype.unregister=function(e){return __awaiter$6(this,void 0,void 0,(function(){var t;return __generator$1(this,(function(n){switch(n.label){case 0:return t={type:"unregister",methods:[e.repoId]},[4,this.session.send(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.getBranchList=function(e){return this.streaming.getBranchList(e)},e.prototype.getSubscriptionList=function(e,t){return this.streaming.getSubscriptionList(e,t)},e.prototype.closeAllSubscriptions=function(e,t){this.streaming.closeMultipleSubscriptions(e,t)},e.prototype.pushData=function(e,t,n){this.streaming.pushData(e,t,n)},e.prototype.pushDataToSingle=function(e,t,n){this.streaming.pushDataToSingle(e,t,n)},e.prototype.closeSingleSubscription=function(e,t){this.streaming.closeSingleSubscription(e,t)},e.prototype.acceptRequestOnBranch=function(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)},e.prototype.rejectRequest=function(e,t,n){this.streaming.rejectRequest(e,t,n)},e.prototype.onSubRequest=function(e){this.streaming.onSubRequest(e)},e.prototype.onSubAdded=function(e){this.streaming.onSubAdded(e)},e.prototype.onSubRemoved=function(e){this.streaming.onSubRemoved(e)},e.prototype.handleInvokeMessage=function(e){var t=e.invocation_id,n=e.caller_id,r=e.method_id,i=e.arguments_kv,o=this.serverRepository.getList().filter((function(e){return e.repoId===r}))[0];if(void 0!==o){var l={args:i,instance:this.clientRepository.getServerById(n).instance};this.callbacks.execute("onInvoked",o,t,l)}},e}(),UserSubscription$1=function(){function e(e,t){this.repository=e,this.subscriptionData=t}return Object.defineProperty(e.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"servers",{get:function(){var e=this;return this.subscriptionData.trackedServers.filter((function(e){return e.subscriptionId})).map((function(t){return e.repository.getServerById(t.serverId).instance}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!1,configurable:!0}),e.prototype.onData=function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(t){e(t)}))},e.prototype.onClosed=function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)},e.prototype.onFailed=function(e){},e.prototype.onConnected=function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)},e.prototype.close=function(){this.subscriptionData.close()},e.prototype.setNewSubscription=function(e){this.subscriptionData=e},e}(),TimedCache$1=function(){function e(e){this.config=e,this.cache=[],this.timeoutIds=[]}return e.prototype.add=function(e){var t=this,n=shortid$4();this.cache.push({id:n,element:e});var r=setTimeout((function(){var e=t.cache.findIndex((function(e){return e.id===n}));e<0||t.cache.splice(e,1)}),this.config.ELEMENT_TTL_MS);this.timeoutIds.push(r)},e.prototype.flush=function(){var e=this.cache.map((function(e){return e.element}));return this.timeoutIds.forEach((function(e){return clearInterval(e)})),this.cache=[],this.timeoutIds=[],e},e}(),STATUS_AWAITING_ACCEPT$1="awaitingAccept",STATUS_SUBSCRIBED$1="subscribed",ERR_MSG_SUB_FAILED$1="Subscription failed.",ERR_MSG_SUB_REJECTED$1="Subscription rejected.",ON_CLOSE_MSG_SERVER_INIT$1="ServerInitiated",ON_CLOSE_MSG_CLIENT_INIT$1="ClientInitiated",ClientStreaming$1=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.logger=n,this.subscriptionsList={},this.timedCache=new TimedCache$1({ELEMENT_TTL_MS:1e4}),this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(e){var t=e._tag,n=t.subLocalKey,i=r.subscriptionsList[n];if("object"==typeof i&&(i.trackedServers=i.trackedServers.filter((function(e){return e.serverId!==t.serverId})),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===STATUS_AWAITING_ACCEPT$1){var o="string"==typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",l="object"==typeof i.params.arguments?JSON.stringify(i.params.arguments):"{}";i.error({message:ERR_MSG_SUB_REJECTED$1+o+" Called with:"+l,called_with:i.params.arguments,method:i.method})}else i.status===STATUS_SUBSCRIBED$1&&r.callOnClosedHandlers(i);delete r.subscriptionsList[n]}},this.handleSubscribed=function(e){var t=e._tag.subLocalKey,n=r.subscriptionsList[t];if("object"==typeof n){var i=e._tag.serverId,o=n.trackedServers.filter((function(e){return e.serverId===i}))[0];if("object"==typeof o){o.subscriptionId=e.subscription_id,r.subscriptionIdToLocalKeyMap[e.subscription_id]=t;var l=n.status===STATUS_AWAITING_ACCEPT$1;if(n.status=STATUS_SUBSCRIBED$1,l){var s=!1,a=n.subscription;a?(a.setNewSubscription(n),n.success(a),s=!0):(a=new UserSubscription$1(r.repository,n),n.subscription=a,n.success(a));for(var u=0,c=n.handlers.onConnected;u<c.length;u++){var h=c[u];try{h(a.serverInstance,s)}catch(e){}}}}}},this.handleEventData=function(e){var t=r.subscriptionIdToLocalKeyMap[e.subscription_id];if(void 0!==t){var n=r.subscriptionsList[t];if("object"==typeof n){var i=n.trackedServers.filter((function(t){return t.subscriptionId===e.subscription_id}));if(1===i.length){var o=e.oob,l=i[0].serverId,s=function(){return{data:e.data,server:r.repository.getServerById(l).instance,requestArguments:n.params.arguments,message:void 0,private:o}},a=n.handlers.onData,u=n.queued.data;a.length>0?a.forEach((function(e){"function"==typeof e&&e(s())})):u.push(s())}}}},this.handleSubscriptionCancelled=function(e){var t=r.subscriptionIdToLocalKeyMap[e.subscription_id];if(void 0!==t){var n=r.subscriptionsList[t];if("object"==typeof n){var i=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter((function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)})),n.trackedServers.length===i&&(n.trackedServers.length<=0&&(r.timedCache.add(n),clearTimeout(n.timeoutId),r.callOnClosedHandlers(n),delete r.subscriptionsList[t]),delete r.subscriptionIdToLocalKeyMap[e.subscription_id])}}},e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}return e.prototype.subscribe=function(e,t,n,r,i,o){var l=this;if(0!==n.length){var s=this.getNextSubscriptionLocalKey(),a=this.registerSubscription(s,e,t,r,i,t.methodResponseTimeout||1e4,o);"object"==typeof a?n.forEach((function(n){var r=n.server.id,i=n.methods.find((function(t){return t.name===e.name}));if(i){a.trackedServers.push({serverId:r,subscriptionId:void 0});var o={type:"subscribe",server_id:r,method_id:i.gatewayId,arguments_kv:t.arguments};l.session.send(o,{serverId:r,subLocalKey:s}).then((function(e){return l.handleSubscribed(e)})).catch((function(e){return l.handleErrorSubscribing(e)}))}else l.logger.error("can not find method ".concat(e.name," for target ").concat(n.server.id))})):i({method:e,called_with:t.arguments,message:ERR_MSG_SUB_FAILED$1+" Unable to register the user callbacks."})}else i({method:e,called_with:t.arguments,message:ERR_MSG_SUB_FAILED$1+" No available servers matched the target params."})},e.prototype.drainSubscriptions=function(){var e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e},e.prototype.drainSubscriptionsCache=function(){return this.timedCache.flush()},e.prototype.getNextSubscriptionLocalKey=function(){var e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e},e.prototype.registerSubscription=function(e,t,n,r,i,o,l){var s=this,a={localKey:e,status:STATUS_AWAITING_ACCEPT$1,method:t,params:n,success:r,error:i,trackedServers:[],handlers:{onData:(null==l?void 0:l.handlers.onData)||[],onClosed:(null==l?void 0:l.handlers.onClosed)||[],onConnected:(null==l?void 0:l.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return s.closeSubscription(e)},subscription:null==l?void 0:l.subscription};return l||(n.onData&&a.handlers.onData.push(n.onData),n.onClosed&&a.handlers.onClosed.push(n.onClosed),n.onConnected&&a.handlers.onConnected.push(n.onConnected)),this.subscriptionsList[e]=a,a.timeoutId=setTimeout((function(){if(void 0!==s.subscriptionsList[e]){var r=s.subscriptionsList[e];r.status===STATUS_AWAITING_ACCEPT$1?(i({method:t,called_with:n.arguments,message:ERR_MSG_SUB_FAILED$1+" Subscription attempt timed out after "+o+" ms."}),delete s.subscriptionsList[e]):r.status===STATUS_SUBSCRIBED$1&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter((function(e){return void 0!==e.subscriptionId})),delete r.timeoutId,r.trackedServers.length<=0&&(s.callOnClosedHandlers(r),delete s.subscriptionsList[e]))}}),o),a},e.prototype.callOnClosedHandlers=function(e,t){var n,r=e.queued.closers.length,i=r>0?e.queued.closers[r-1]:null;void 0!==i&&"string"==typeof i&&(n=this.repository.getServerById(i).instance),e.handlers.onClosed.forEach((function(r){"function"==typeof r&&r({message:t||ON_CLOSE_MSG_SERVER_INIT$1,requestArguments:e.params.arguments||{},server:n,stream:e.method})}))},e.prototype.closeSubscription=function(e){var t=this,n=this.subscriptionsList[e];"object"==typeof n&&(n.trackedServers.forEach((function(e){void 0!==e.subscriptionId&&(n.queued.closers.push(e.serverId),t.session.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:ON_CLOSE_MSG_CLIENT_INIT$1}),delete t.subscriptionIdToLocalKeyMap[e.subscriptionId])})),n.trackedServers=[],this.callOnClosedHandlers(n,ON_CLOSE_MSG_CLIENT_INIT$1),delete this.subscriptionsList[e])},e}(),ClientProtocol$1=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.logger=n,e.on("peer-added",(function(e){return r.handlePeerAdded(e)})),e.on("peer-removed",(function(e){return r.handlePeerRemoved(e)})),e.on("methods-added",(function(e){return r.handleMethodsAddedMessage(e)})),e.on("methods-removed",(function(e){return r.handleMethodsRemovedMessage(e)})),this.streaming=new ClientStreaming$1(e,t,n)}return e.prototype.subscribe=function(e,t,n,r,i,o){this.streaming.subscribe(e,t,n,r,i,o)},e.prototype.invoke=function(e,t,n,r){var i=this,o=r.id,l={type:"call",server_id:o,method_id:t.gatewayId,arguments_kv:n};return this.session.send(l,{invocationId:e,serverId:o}).then((function(e){return i.handleResultMessage(e)})).catch((function(e){return i.handleInvocationError(e)}))},e.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},e.prototype.drainSubscriptionsCache=function(){return this.streaming.drainSubscriptionsCache()},e.prototype.handlePeerAdded=function(e){var t=e.new_peer_id,n=e.identity,r=!e.meta||e.meta.local,i=Number(n.process),o={machine:n.machine,pid:isNaN(i)?n.process:i,instance:n.instance,application:n.application,applicationName:n.applicationName,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t,api:n.api,isLocal:r};this.repository.addServer(o,t)},e.prototype.handlePeerRemoved=function(e){var t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)},e.prototype.handleMethodsAddedMessage=function(e){var t=this,n=e.server_id;e.methods.forEach((function(e){t.repository.addServerMethod(n,e)}))},e.prototype.handleMethodsRemovedMessage=function(e){var t=this,n=e.server_id,r=e.methods,i=this.repository.getServerById(n);Object.keys(i.methods).forEach((function(e){var o=i.methods[e];r.indexOf(o.gatewayId)>-1&&t.repository.removeServerMethod(n,e)}))},e.prototype.handleResultMessage=function(e){var t=e._tag.invocationId,n=e.result,r=e._tag.serverId;return{invocationId:t,result:n,instance:this.repository.getServerById(r).instance,status:InvokeStatus$1.Success,message:""}},e.prototype.handleInvocationError=function(e){if(this.logger.debug("handle invocation error ".concat(JSON.stringify(e))),"_tag"in e){var t=e._tag.invocationId,n=e._tag.serverId,r=this.repository.getServerById(n),i=e.reason;return{invocationId:t,result:e.context,instance:r.instance,status:InvokeStatus$1.Error,message:i}}return{invocationId:"",message:e.message,status:InvokeStatus$1.Error,error:e}},e}();function gW3ProtocolFactory$1(e,t,n,r,i,o){var l,s=i.logger.subLogger("gw3-protocol"),a=new Promise((function(e){l=e})),u=t.domain("agm",["subscribed"]),c=new ServerProtocol$1(u,n,r,s.subLogger("server")),h=new ClientProtocol$1(u,n,s.subLogger("client"));return u.onJoined((function(i){n.addServer(e,t.peerId),i?function(){return __awaiter$6(this,void 0,void 0,(function(){var e,t,n,i,l,a,u,c,d,f,p;return __generator$1(this,(function(g){switch(g.label){case 0:for(s.info("reconnected - will replay registered methods and subscriptions"),h.drainSubscriptionsCache().forEach((function(e){var t=e.method,n=Object.assign({},e.params);s.info("trying to soft-re-subscribe to method ".concat(t.name,", with params: ").concat(JSON.stringify(n))),o.client.subscribe(t,n,void 0,void 0,e).then((function(){return s.info("soft-subscribing to method ".concat(t.name," DONE"))})).catch((function(e){return s.warn("subscribing to method ".concat(t.name," failed: ").concat(JSON.stringify(e),"}"))}))})),e=[],t=h.drainSubscriptions(),n=function(t){var n=t.method,r=Object.assign({},t.params);s.info("trying to re-subscribe to method ".concat(n.name,", with params: ").concat(JSON.stringify(r))),e.push(o.client.subscribe(n,r,void 0,void 0,t).then((function(){return s.info("subscribing to method ".concat(n.name," DONE"))})))},i=0,l=t;i<l.length;i++)a=l[i],n(a);for(u=r.getList(),r.reset(),c=function(t){var n=t.definition;s.info("re-publishing method ".concat(n.name)),t.stream?e.push(o.server.createStream(n,t.streamCallbacks,void 0,void 0,t.stream).then((function(){return s.info("subscribing to method ".concat(n.name," DONE"))}))):t.theFunction&&t.theFunction.userCallback?e.push(o.register(n,t.theFunction.userCallback).then((function(){return s.info("subscribing to method ".concat(n.name," DONE"))}))):t.theFunction&&t.theFunction.userCallbackAsync&&e.push(o.registerAsync(n,t.theFunction.userCallbackAsync).then((function(){return s.info("subscribing to method ".concat(n.name," DONE"))}))),s.info("re-publishing method ".concat(n.name," DONE"))},d=0,f=u;d<f.length;d++)p=f[d],c(p);return[4,Promise.all(e)];case 1:return g.sent(),s.info("Interop is re-announced"),[2]}}))}))}().then((function(){return t.setLibReAnnounced({name:"interop"})})).catch((function(e){return s.warn("Error while re-announcing interop: ".concat(JSON.stringify(e)))})):l&&(l({client:h,server:c}),l=void 0)})),u.onLeft((function(){n.reset()})),u.join(),a}var Interop$1=function(){function e(e){var t=this;if(void 0===e)throw new Error("configuration is required");if(void 0===e.connection)throw new Error("configuration.connections is required");var n,r=e.connection;if("number"!=typeof e.methodResponseTimeout&&(e.methodResponseTimeout=3e4),"number"!=typeof e.waitTimeoutMs&&(e.waitTimeoutMs=3e4),this.unwrappedInstance=new InstanceWrapper$1(this,void 0,r),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new ClientRepository$1(e.logger.subLogger("cRep"),this),this.serverRepository=new ServerRepository$1,3!==r.protocolVersion)throw new Error("protocol ".concat(r.protocolVersion," not supported"));n=gW3ProtocolFactory$1(this.instance,r,this.clientRepository,this.serverRepository,e,this),this.readyPromise=n.then((function(n){return t.protocol=n,t.client=new Client$1(t.protocol,t.clientRepository,t.instance,e),t.server=new Server$1(t.protocol,t.serverRepository),t}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.serverRemoved=function(e){return this.client.serverRemoved(e)},e.prototype.serverAdded=function(e){return this.client.serverAdded(e)},e.prototype.serverMethodRemoved=function(e){return this.client.serverMethodRemoved(e)},e.prototype.serverMethodAdded=function(e){return this.client.serverMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.client.methodRemoved(e)},e.prototype.methodAdded=function(e){return this.client.methodAdded(e)},e.prototype.methodsForInstance=function(e){return this.client.methodsForInstance(e)},e.prototype.methods=function(e){return this.client.methods(e)},e.prototype.servers=function(e){return this.client.servers(e)},e.prototype.subscribe=function(e,t,n,r){return this.client.subscribe(e,t,n,r)},e.prototype.createStream=function(e,t,n,r){return this.server.createStream(e,t,n,r)},e.prototype.unregister=function(e){return this.server.unregister(e)},e.prototype.registerAsync=function(e,t){return this.server.registerAsync(e,t)},e.prototype.register=function(e,t){return this.server.register(e,t)},e.prototype.invoke=function(e,t,n,r,i,o){return this.client.invoke(e,t,n,r,i,o)},e.prototype.waitForMethod=function(e){var t=new PromiseWrapper$2,n=this.client.methodAdded((function(r){r.name===e&&(n(),t.resolve(r))}));return t.promise},e}(),successMessages$1=["subscribed","success"],MessageBus$1=function(){function e(e,t){var n=this;this.publish=function(e,t,r){var i=r||{},o=i.routingKey,l=i.target,s=n.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:n.peerId,routing_key:o,target_identity:l});n.session.send(s)},this.subscribe=function(e,t,r){return new Promise((function(i,o){var l=r||{},s=l.routingKey,a=l.target,u=n.removeEmptyValues({type:"subscribe",topic:e,peer_id:n.peerId,routing_key:s,source:a});n.session.send(u).then((function(r){var o=r.subscription_id;n.subscriptions.push({subscription_id:o,topic:e,callback:t,source:a}),i({unsubscribe:function(){return n.session.send({type:"unsubscribe",subscription_id:o,peer_id:n.peerId}),n.subscriptions=n.subscriptions.filter((function(e){return e.subscription_id!==o})),Promise.resolve()}})})).catch((function(e){return o(e)}))}))},this.watchOnEvent=function(){n.session.on("event",(function(e){var t=e.data,r=e.subscription_id,i=e["publisher-identity"],o=n.subscriptions.find((function(e){return e.subscription_id===r}));o&&(o.source?n.keysMatch(o.source,i)&&o.callback(t,o.topic,i):o.callback(t,o.topic,i))}))},this.connection=e,this.logger=t,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",successMessages$1),this.readyPromise=this.session.join(),this.readyPromise.then((function(){n.watchOnEvent()}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.removeEmptyValues=function(e){var t={};return Object.keys(e).forEach((function(n){void 0!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t},e.prototype.keysMatch=function(e,t){var n=Object.keys(e),r=!0;return n.forEach((function(n){e[n]!==t[n]&&(r=!1)})),r},e}(),IOConnectCoreFactory$1=function(e,t){var n,r,i,o,l,s,a,u,c,h="object"==typeof window?null!==(n=window.iodesktop)&&void 0!==n?n:window.glue42gd:void 0,d="object"==typeof window&&null!==(r=window.gdPreloadPromise)&&void 0!==r?r:Promise.resolve(),f=timer$1("glue"),p=prepareConfig$1(e=e||{},t=t||{},h),g={};function w(e,t,n){(c=l.canPublish("trace"))&&l.trace("registering ".concat(e," module"));var r=function(){t.initTime=n.stop(),t.initEndTime=n.endTime,t.marks=n.marks,c&&l.trace("".concat(e," is ready - ").concat(n.endTime-n.startTime))};t.initStartTime=n.startTime,t.ready?t.ready().then((function(){r()})):r(),Array.isArray(e)||(e=[e]),e.forEach((function(e){g[e]=t,IOConnectCoreFactory$1[e]=t}))}function m(){var e,t,n,r,o,a=timer$1("metrics"),u=p.metrics,c=null==h?void 0:h.getMetricsPublishingEnabled,d=p.connection.identity,f=c||function(){return!0},g=null!==(e="boolean"!=typeof u&&u.disableAutoAppSystem)&&void 0!==e&&e;return w("metrics",s=metrics$1({connection:u?i:void 0,logger:l.subLogger("metrics"),canUpdateMetric:f,system:"Glue42",service:null!==(n=null!==(t=null==d?void 0:d.service)&&void 0!==t?t:null==h?void 0:h.applicationName)&&void 0!==n?n:p.application,instance:null!==(o=null!==(r=null==d?void 0:d.instance)&&void 0!==r?r:null==d?void 0:d.windowId)&&void 0!==o?o:shortid$4(),disableAutoAppSystem:g,pagePerformanceMetrics:"boolean"!=typeof u?null==u?void 0:u.pagePerformanceMetrics:void 0}),a),Promise.resolve()}function v(){var e=p.activities&&3===i.protocolVersion;if(p.contexts||e){var t=timer$1("contexts");return w("contexts",a=new ContextsModule$1({connection:i,logger:l.subLogger("contexts"),trackAllContexts:"object"==typeof p.contexts&&p.contexts.trackAllContexts,reAnnounceKnownContexts:"object"==typeof p.contexts&&p.contexts.reAnnounceKnownContexts}),t),a}var n=i.replayer;n&&n.drain(ContextMessageReplaySpec$1.name)}function y(){return __awaiter$6(this,void 0,void 0,(function(){var e;return __generator$1(this,(function(t){return p.bus?(e=timer$1("bus"),w("bus",u=new MessageBus$1(i,l.subLogger("bus")),e),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function b(e){try{return e.forEach((function(e){!function(e,t){var n=timer$1(e),r=t(g);r&&w(e,r,n)}(e.name,e.create)})),Promise.resolve()}catch(e){return Promise.reject(e)}}return d.then((function(){var e,t=timer$1("logger");return(l=new Logger$1("".concat(null===(e=p.connection.identity)||void 0===e?void 0:e.application),void 0,p.customLogger)).consoleLevel(p.logger.console),l.publishLevel(p.logger.publish),l.canPublish("debug")&&l.debug("initializing glue..."),w("logger",l,t),Promise.resolve(void 0)})).then((function(){var e=timer$1("connection");i=new Connection$1(p.connection,l.subLogger("connection"));var t=Promise.resolve(p.auth);return p.connection&&!p.auth&&(h?t=h.getGWToken().then((function(e){return{gatewayToken:e}})):"undefined"!=typeof window&&(null===window||void 0===window?void 0:window.glue42electron)?"string"==typeof window.glue42electron.gwToken&&(t=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):t=Promise.reject("You need to provide auth information")),t.then((function(t){var n;if(e.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(t))throw new Error("Invalid auth object - "+JSON.stringify(t));return n=t,i.login(n)})).then((function(){return w("connection",i,e),p})).catch((function(e){throw i&&i.logout(),e}))})).then((function(){return Promise.all([m(),(e=timer$1("interop"),t={connection:i,logger:l.subLogger("interop")},o=new Interop$1(t),Logger$1.Interop=o,w(["interop","agm"],o,e),Promise.resolve()),v(),y()]);var e,t})).then((function(){return o.readyPromise})).then((function(){return function(){return __awaiter$6(this,void 0,void 0,(function(){var t,n,r;return __generator$1(this,(function(i){switch(i.label){case 0:if(t="T42.ACS.RegisterInstance",!Utils$1.isNode()||void 0!==process.env._GD_STARTING_CONTEXT_||void 0===(null==e?void 0:e.application))return[3,4];if(!(o.methods({name:t}).length>0))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o.invoke(t,{appName:null==e?void 0:e.application,pid:process.pid})];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),r=n,l.error("Cannot register as an instance: ".concat(JSON.stringify(r.message))),[3,4];case 4:return[2]}}))}))}()})).then((function(){return b(p.libs||[])})).then((function(){var e=Object.keys(g).map((function(e){var t=g[e];return t.ready?t.ready():Promise.resolve()}));return Promise.all(e)})).then((function(){var n={coreVersion:version$5,version:p.version};f.stop();var r={feedback:function(e){o&&o.invoke("T42.ACS.Feedback",e,"best")},info:n,logger:l,interop:o,agm:o,connection:i,metrics:s,contexts:a,bus:u,version:p.version,userConfig:e,done:function(){return null==l||l.info("done called by user..."),i.logout()}};if(r.performance={get glueVer(){return p.version},get glueConfig(){return JSON.stringify(e)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var e=getAllTimers$1();return Object.keys(e).map((function(t){var n=e[t];return{name:t,duration:n.endTime-n.startTime,marks:n.marks,startTime:n.startTime,endTime:n.endTime}}))}},Object.keys(g).forEach((function(e){var t=g[e];r[e]=t})),r.config={},Object.keys(p).forEach((function(e){r.config[e]=p[e]})),t&&t.extOptions&&Object.keys(t.extOptions).forEach((function(e){r.config[e]=null==t?void 0:t.extOptions[e]})),(null==t?void 0:t.enrichGlue)&&t.enrichGlue(r),h&&h.updatePerfData&&h.updatePerfData(r.performance),r.agm){var c=function(e,t,n){return function(){return r.logger.warn("glue.js - 'glue.agm.".concat(t,"' method is deprecated, use 'glue.interop.").concat(n,"' instead.")),e.apply(r.agm,arguments)}},d=r.agm;d.method_added=c(r.agm.methodAdded,"method_added","methodAdded"),d.method_removed=c(r.agm.methodRemoved,"method_removed","methodRemoved"),d.server_added=c(r.agm.serverAdded,"server_added","serverAdded"),d.server_method_aded=c(r.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),d.server_method_removed=c(r.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return r})).catch((function(e){return Promise.reject({err:e,libs:g})}))};"undefined"!=typeof window&&(window.IOConnectCore=IOConnectCoreFactory$1),IOConnectCoreFactory$1.version=version$5,IOConnectCoreFactory$1.default=IOConnectCoreFactory$1;const iOConnectBrowserFactory=createFactoryFunction(IOConnectCoreFactory$1);if("undefined"!=typeof window){const e=window;e.IOBrowser=iOConnectBrowserFactory,delete e.GlueCore,delete e.IOConnectCore}const legacyGlobal$1=window.glue42gd||window.glue42core,ioGlobal$1=window.iodesktop||window.iobrowser;legacyGlobal$1||ioGlobal$1||(window.iobrowser={webStarted:!1}),iOConnectBrowserFactory.version=version$2$1;const Glue42CoreMessageTypes={connectionRequest:{name:"connectionRequest"},connectionAccepted:{name:"connectionAccepted"},platformPing:{name:"platformPing"},platformReady:{name:"platformReady"},platformUnload:{name:"platformUnload"},clientUnload:{name:"clientUnload"},parentPing:{name:"parentPing"},parentReady:{name:"parentReady"},gatewayDisconnect:{name:"gatewayDisconnect"},gatewayInternalConnect:{name:"gatewayInternalConnect"},transportSwitchRequest:{name:"transportSwitchRequest"},transportSwitchResponse:{name:"transportSwitchResponse"},getCurrentTransport:{name:"getCurrentTransport"},getCurrentTransportResponse:{name:"getCurrentTransportResponse"},checkPreferredLogic:{name:"checkPreferredLogic"},checkPreferredConnection:{name:"checkPreferredConnection"},checkPreferredLogicResponse:{name:"checkPreferredLogicResponse"},checkPreferredConnectionResponse:{name:"checkPreferredConnectionResponse"}},GlueWebPlatformControlName="T42.Web.Platform.Control",GlueWebPlatformStreamName="T42.Web.Platform.Stream",GlueClientControlName="T42.Web.Client.Control",GlueWebPlatformWorkspacesStreamName="T42.Web.Platform.WSP.Stream",GlueWorkspaceFrameClientControlName="T42.Workspaces.Control",GlueWorkspacesEventsReceiverName="T42.Workspaces.Events",GlueWebIntentsPrefix="Tick42.FDC3.Intents.",ChannelContextPrefix="___channel___",serviceWorkerBroadcastChannelName="glue42-core-worker",webPlatformTransportName="web-platform",defaultNoAppWindowComponentAppName$1="no-app-window",defaultPlatformConfig={windows:{windowResponseTimeoutMs:1e4,defaultWindowOpenBounds:{top:0,left:0,width:800,height:600}},applications:{local:[]},layouts:{mode:"idb",local:[]},channels:{definitions:[]},plugins:{definitions:[]},licenseKey:"",gateway:{logging:{level:"info"}},themes:{defaultTheme:"dark"},connection:{},browser:{},environment:{},workspacesFrameCache:!0},defaultNotificationsConfig={enable:!0,enableToasts:!0,sourceFilter:{allowed:["*"],blocked:[]},clearNotificationOnClick:!0},defaultTargetString="*",defaultFetchTimeoutMs=3e3,defaultOpenerTimeoutMs=1e3,defaultPreferredDiscoveryIntervalMS=15e3,defaultClientPortRequestTimeoutMS=15e3,defaultClientPreferredLogicTestTimeoutMS=5e3,checkIsOpenerIOConnect=e=>{if(!window.opener)return Promise.resolve(!1);if(window.name.includes("g42-"))return Promise.resolve(!0);const t=(null==e?void 0:e.allowedClientFallbackOrigin)||defaultTargetString;return new Promise((e=>{const n=t=>{var r;const i=null===(r=t.data)||void 0===r?void 0:r.glue42core;i&&i.type===Glue42CoreMessageTypes.platformReady.name&&(window.removeEventListener("message",n),e(!0))};window.addEventListener("message",n);const r={glue42core:{type:Glue42CoreMessageTypes.platformPing.name}};window.opener.postMessage(r,t),setTimeout((()=>e(!1)),defaultOpenerTimeoutMs)}))},checkIfPlacedInWorkspace=()=>-1!==window.name.indexOf("#wsp"),fallbackToEnterprise=e=>__awaiter$7(void 0,void 0,void 0,(function*(){var t,n,r,i;const o=(null==e?void 0:e.browserFactory)?yield null==e?void 0:e.browserFactory(null==e?void 0:e.browser):yield iOConnectBrowserFactory(null==e?void 0:e.browser);return(null===(n=null===(t=null==e?void 0:e.applications)||void 0===t?void 0:t.local)||void 0===n?void 0:n.length)&&(yield o.appManager.inMemory.import(e.applications.local,"merge")),(null===(i=null===(r=null==e?void 0:e.layouts)||void 0===r?void 0:r.local)||void 0===i?void 0:i.length)&&(yield o.layouts.import(e.layouts.local,"merge")),{io:o}}));var commonjsGlobal$1="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs$1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}function createRegistry$2(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};function r(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,i){var o=n[e];return o||(o=[],n[e]=o),o.push(t),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(t){r(t,e)}}))}),0),function(){var r=n[e];r&&(0===(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[])).length?delete n[e]:n[e]=r)}},execute:function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=n[e];if(!o||0===o.length)return[];var l=[];return o.forEach((function(n){try{var i=n.apply(void 0,t);l.push(i)}catch(t){l.push(void 0),r(t,e)}})),l},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}createRegistry$2.default=createRegistry$2;var lib$4=createRegistry$2,CallbackRegistryFactory=getDefaultExportFromCjs$1(lib$4),client$1={},client={};function e(e){this.message=e}e.prototype=new Error,e.prototype.name="InvalidCharacterError";var r="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(t){var n=String(t).replace(/=+$/,"");if(n.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,i,o=0,l=0,s="";i=n.charAt(l++);~i&&(r=o%4?64*r+i:i,o++%4)?s+=String.fromCharCode(255&r>>(-2*o&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return s};function t$1(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return r(t)}}function n(e){this.message=e}function o(e,t){if("string"!=typeof e)throw new n("Invalid token specified");var r=!0===(t=t||{}).header?0:1;try{return JSON.parse(t$1(e.split(".")[r]))}catch(e){throw new n("Invalid token specified: "+e.message)}}n.prototype=new Error,n.prototype.name="InvalidTokenError";var jwtDecode_esm=Object.freeze({__proto__:null,InvalidTokenError:n,default:o}),require$$0$1=getAugmentedNamespace(jwtDecode_esm),browser="object"==typeof self?self.FormData:window.FormData,base={};function bind$2(e,t){return function(){return e.apply(t,arguments)}}const{toString:toString$1}=Object.prototype,{getPrototypeOf:getPrototypeOf$1}=Object,kindOf=(e=>t=>{const n=toString$1.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=e=>(e=e.toLowerCase(),t=>kindOf(t)===e),typeOfTest=e=>t=>typeof t===e,{isArray:isArray$3}=Array,isUndefined=typeOfTest("undefined");function isBuffer$1(e){return null!==e&&!isUndefined(e)&&null!==e.constructor&&!isUndefined(e.constructor)&&isFunction$1(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const isArrayBuffer$3=kindOfTest("ArrayBuffer");function isArrayBufferView(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&isArrayBuffer$3(e.buffer),t}const isString$4=typeOfTest("string"),isFunction$1=typeOfTest("function"),isNumber$2=typeOfTest("number"),isObject=e=>null!==e&&"object"==typeof e,isBoolean$2=e=>!0===e||!1===e,isPlainObject=e=>{if("object"!==kindOf(e))return!1;const t=getPrototypeOf$1(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},isDate$2=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=e=>isObject(e)&&isFunction$1(e.pipe),isFormData=e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||isFunction$1(e.append)&&("formdata"===(t=kindOf(e))||"object"===t&&isFunction$1(e.toString)&&"[object FormData]"===e.toString()))},isURLSearchParams=kindOfTest("URLSearchParams"),trim=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach$2(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,i;if("object"!=typeof e&&(e=[e]),isArray$3(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{const i=n?Object.getOwnPropertyNames(e):Object.keys(e),o=i.length;let l;for(r=0;r<o;r++)l=i[r],t.call(null,e[l],l,e)}}function findKey(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const _global="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:commonjsGlobal$1,isContextDefined=e=>!isUndefined(e)&&e!==_global;function merge(){const{caseless:e}=isContextDefined(this)&&this||{},t={},n=(n,r)=>{const i=e&&findKey(t,r)||r;isPlainObject(t[i])&&isPlainObject(n)?t[i]=merge(t[i],n):isPlainObject(n)?t[i]=merge({},n):isArray$3(n)?t[i]=n.slice():t[i]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&forEach$2(arguments[e],n);return t}const extend=(e,t,n,{allOwnKeys:r}={})=>(forEach$2(t,((t,r)=>{n&&isFunction$1(t)?e[r]=bind$2(t,n):e[r]=t}),{allOwnKeys:r}),e),stripBOM=e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject=(e,t,n,r)=>{let i,o,l;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)l=i[o],r&&!r(l,e,t)||s[l]||(t[l]=e[l],s[l]=!0);e=!1!==n&&getPrototypeOf$1(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},endsWith=(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray=e=>{if(!e)return null;if(isArray$3(e))return e;let t=e.length;if(!isNumber$2(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},isTypedArray$2=(e=>t=>e&&t instanceof e)("undefined"!=typeof Uint8Array&&getPrototypeOf$1(Uint8Array)),forEachEntry=(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll=(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),hasOwnProperty$1=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),isRegExp$1=kindOfTest("RegExp"),reduceDescriptors=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};forEach$2(n,((n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)})),Object.defineProperties(e,r)},freezeMethods=e=>{reduceDescriptors(e,((t,n)=>{if(isFunction$1(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];isFunction$1(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet=(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return isArray$3(e)?r(e):r(String(e).split(t)),n},noop=()=>{},toFiniteNumber=(e,t)=>(e=+e,Number.isFinite(e)?e:t),ALPHA="abcdefghijklmnopqrstuvwxyz",DIGIT="0123456789",ALPHABET={DIGIT:DIGIT,ALPHA:ALPHA,ALPHA_DIGIT:ALPHA+ALPHA.toUpperCase()+DIGIT},generateString=(e=16,t=ALPHABET.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n};function isSpecCompliantForm(e){return!!(e&&isFunction$1(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])}const toJSONObject=e=>{const t=new Array(10),n=(e,r)=>{if(isObject(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=isArray$3(e)?[]:{};return forEach$2(e,((e,t)=>{const o=n(e,r+1);!isUndefined(o)&&(i[t]=o)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=e=>e&&(isObject(e)||isFunction$1(e))&&isFunction$1(e.then)&&isFunction$1(e.catch);var utils$1={isArray:isArray$3,isArrayBuffer:isArrayBuffer$3,isBuffer:isBuffer$1,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString$4,isNumber:isNumber$2,isBoolean:isBoolean$2,isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate$2,isFile:isFile,isBlob:isBlob,isRegExp:isRegExp$1,isFunction:isFunction$1,isStream:isStream,isURLSearchParams:isURLSearchParams,isTypedArray:isTypedArray$2,isFileList:isFileList,forEach:forEach$2,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM,inherits:inherits,toFlatObject:toFlatObject,kindOf:kindOf,kindOfTest:kindOfTest,endsWith:endsWith,toArray:toArray,forEachEntry:forEachEntry,matchAll:matchAll,isHTMLForm:isHTMLForm,hasOwnProperty:hasOwnProperty$1,hasOwnProp:hasOwnProperty$1,reduceDescriptors:reduceDescriptors,freezeMethods:freezeMethods,toObjectSet:toObjectSet,toCamelCase:toCamelCase,noop:noop,toFiniteNumber:toFiniteNumber,findKey:findKey,global:_global,isContextDefined:isContextDefined,ALPHABET:ALPHABET,generateString:generateString,isSpecCompliantForm:isSpecCompliantForm,toJSONObject:toJSONObject,isAsyncFn:isAsyncFn,isThenable:isThenable};function AxiosError(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}utils$1.inherits(AxiosError,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const prototype$1=AxiosError.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{descriptors[e]={value:e}})),Object.defineProperties(AxiosError,descriptors),Object.defineProperty(prototype$1,"isAxiosError",{value:!0}),AxiosError.from=(e,t,n,r,i,o)=>{const l=Object.create(prototype$1);return utils$1.toFlatObject(e,l,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),AxiosError.call(l,e.message,t,n,r,i),l.cause=e,l.name=e.name,o&&Object.assign(l,o),l};var httpAdapter=null;function isVisitable(e){return utils$1.isPlainObject(e)||utils$1.isArray(e)}function removeBrackets(e){return utils$1.endsWith(e,"[]")?e.slice(0,-2):e}function renderKey(e,t,n){return e?e.concat(t).map((function(e,t){return e=removeBrackets(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}function isFlatArray(e){return utils$1.isArray(e)&&!e.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,(function(e){return/^is[A-Z]/.test(e)}));function toFormData(e,t,n){if(!utils$1.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=utils$1.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!utils$1.isUndefined(t[e])}))).metaTokens,i=n.visitor||u,o=n.dots,l=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&utils$1.isSpecCompliantForm(t);if(!utils$1.isFunction(i))throw new TypeError("visitor must be a function");function a(e){if(null===e)return"";if(utils$1.isDate(e))return e.toISOString();if(!s&&utils$1.isBlob(e))throw new AxiosError("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(e)||utils$1.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,i){let s=e;if(e&&!i&&"object"==typeof e)if(utils$1.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(utils$1.isArray(e)&&isFlatArray(e)||(utils$1.isFileList(e)||utils$1.endsWith(n,"[]"))&&(s=utils$1.toArray(e)))return n=removeBrackets(n),s.forEach((function(e,r){!utils$1.isUndefined(e)&&null!==e&&t.append(!0===l?renderKey([n],r,o):null===l?n:n+"[]",a(e))})),!1;return!!isVisitable(e)||(t.append(renderKey(i,n,o),a(e)),!1)}const c=[],h=Object.assign(predicates,{defaultVisitor:u,convertValue:a,isVisitable:isVisitable});if(!utils$1.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!utils$1.isUndefined(n)){if(-1!==c.indexOf(n))throw Error("Circular reference detected in "+r.join("."));c.push(n),utils$1.forEach(n,(function(n,o){!0===(!(utils$1.isUndefined(n)||null===n)&&i.call(t,n,utils$1.isString(o)?o.trim():o,r,h))&&e(n,r?r.concat(o):[o])})),c.pop()}}(e),t}function encode$1(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function AxiosURLSearchParams(e,t){this._pairs=[],e&&toFormData(e,this,t)}const prototype=AxiosURLSearchParams.prototype;function encode(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(e,t,n){if(!t)return e;const r=n&&n.encode||encode,i=n&&n.serialize;let o;if(o=i?i(t,n):utils$1.isURLSearchParams(t)?t.toString():new AxiosURLSearchParams(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}prototype.append=function(e,t){this._pairs.push([e,t])},prototype.toString=function(e){const t=e?function(t){return e.call(this,t,encode$1)}:encode$1;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};class InterceptorManager{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){utils$1.forEach(this.handlers,(function(t){null!==t&&e(t)}))}}var InterceptorManager$1=InterceptorManager,transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1="undefined"!=typeof URLSearchParams?URLSearchParams:AxiosURLSearchParams,FormData$1="undefined"!=typeof FormData?FormData:null,Blob$1="undefined"!=typeof Blob?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]};const hasBrowserEnv="undefined"!=typeof window&&"undefined"!=typeof document,hasStandardBrowserEnv=(product="undefined"!=typeof navigator&&navigator.product,hasBrowserEnv&&["ReactNative","NativeScript","NS"].indexOf(product)<0);var product;const hasStandardBrowserWebWorkerEnv="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;var utils=Object.freeze({__proto__:null,hasBrowserEnv:hasBrowserEnv,hasStandardBrowserWebWorkerEnv:hasStandardBrowserWebWorkerEnv,hasStandardBrowserEnv:hasStandardBrowserEnv}),platform={...utils,...platform$1};function toURLEncodedForm(e,t){return toFormData(e,new platform.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return platform.isNode&&utils$1.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}function parsePropPath(e){return utils$1.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}function arrayToObject(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}function formDataToJSON(e){function t(e,n,r,i){let o=e[i++];const l=Number.isFinite(+o),s=i>=e.length;if(o=!o&&utils$1.isArray(r)?r.length:o,s)return utils$1.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!l;r[o]&&utils$1.isObject(r[o])||(r[o]=[]);return t(e,n,r[o],i)&&utils$1.isArray(r[o])&&(r[o]=arrayToObject(r[o])),!l}if(utils$1.isFormData(e)&&utils$1.isFunction(e.entries)){const n={};return utils$1.forEachEntry(e,((e,r)=>{t(parsePropPath(e),r,n,0)})),n}return null}function stringifySafely(e,t,n){if(utils$1.isString(e))try{return(t||JSON.parse)(e),utils$1.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=utils$1.isObject(e);i&&utils$1.isHTMLForm(e)&&(e=new FormData(e));if(utils$1.isFormData(e))return r&&r?JSON.stringify(formDataToJSON(e)):e;if(utils$1.isArrayBuffer(e)||utils$1.isBuffer(e)||utils$1.isStream(e)||utils$1.isFile(e)||utils$1.isBlob(e))return e;if(utils$1.isArrayBufferView(e))return e.buffer;if(utils$1.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(e,this.formSerializer).toString();if((o=utils$1.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return toFormData(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),stringifySafely(e)):e}],transformResponse:[function(e){const t=this.transitional||defaults.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&utils$1.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw AxiosError.from(e,AxiosError.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],(e=>{defaults.headers[e]={}}));var defaults$1=defaults;const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);var parseHeaders=e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&ignoreDuplicateOf[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t};const $internals=Symbol("internals");function normalizeHeader(e){return e&&String(e).trim().toLowerCase()}function normalizeValue(e){return!1===e||null==e?e:utils$1.isArray(e)?e.map(normalizeValue):String(e)}function parseTokens(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}const isValidHeaderName=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function matchHeaderValue(e,t,n,r,i){return utils$1.isFunction(r)?r.call(this,t,n):(i&&(t=n),utils$1.isString(t)?utils$1.isString(r)?-1!==t.indexOf(r):utils$1.isRegExp(r)?r.test(t):void 0:void 0)}function formatHeader(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}function buildAccessors(e,t){const n=utils$1.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}class AxiosHeaders{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=normalizeHeader(t);if(!i)throw new Error("header name must be a non-empty string");const o=utils$1.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=normalizeValue(e))}const o=(e,t)=>utils$1.forEach(e,((e,n)=>i(e,n,t)));return utils$1.isPlainObject(e)||e instanceof this.constructor?o(e,t):utils$1.isString(e)&&(e=e.trim())&&!isValidHeaderName(e)?o(parseHeaders(e),t):null!=e&&i(t,e,n),this}get(e,t){if(e=normalizeHeader(e)){const n=utils$1.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return parseTokens(e);if(utils$1.isFunction(t))return t.call(this,e,n);if(utils$1.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=normalizeHeader(e)){const n=utils$1.findKey(this,e);return!(!n||void 0===this[n]||t&&!matchHeaderValue(this,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=normalizeHeader(e)){const i=utils$1.findKey(n,e);!i||t&&!matchHeaderValue(n,n[i],i,t)||(delete n[i],r=!0)}}return utils$1.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!matchHeaderValue(this,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return utils$1.forEach(this,((r,i)=>{const o=utils$1.findKey(n,i);if(o)return t[o]=normalizeValue(r),void delete t[i];const l=e?formatHeader(i):String(i).trim();l!==i&&delete t[i],t[l]=normalizeValue(r),n[l]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return utils$1.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&utils$1.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[$internals]=this[$internals]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=normalizeHeader(e);t[r]||(buildAccessors(n,e),t[r]=!0)}return utils$1.isArray(e)?e.forEach(r):r(e),this}}AxiosHeaders.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),utils$1.reduceDescriptors(AxiosHeaders.prototype,(({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(e){this[n]=e}}})),utils$1.freezeMethods(AxiosHeaders);var AxiosHeaders$1=AxiosHeaders;function transformData(e,t){const n=this||defaults$1,r=t||n,i=AxiosHeaders$1.from(r.headers);let o=r.data;return utils$1.forEach(e,(function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function isCancel(e){return!(!e||!e.__CANCEL__)}function CanceledError(e,t,n){AxiosError.call(this,null==e?"canceled":e,AxiosError.ERR_CANCELED,t,n),this.name="CanceledError"}function settle(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new AxiosError("Request failed with status code "+n.status,[AxiosError.ERR_BAD_REQUEST,AxiosError.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}utils$1.inherits(CanceledError,AxiosError,{__CANCEL__:!0});var cookies=platform.hasStandardBrowserEnv?{write(e,t,n,r,i,o){const l=[e+"="+encodeURIComponent(t)];utils$1.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),utils$1.isString(r)&&l.push("path="+r),utils$1.isString(i)&&l.push("domain="+i),!0===o&&l.push("secure"),document.cookie=l.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function isAbsoluteURL(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function combineURLs(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function buildFullPath(e,t){return e&&!isAbsoluteURL(t)?combineURLs(e,t):t}var isURLSameOrigin=platform.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=utils$1.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function parseProtocol(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function speedometer(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,l=0;return t=void 0!==t?t:1e3,function(s){const a=Date.now(),u=r[l];i||(i=a),n[o]=s,r[o]=a;let c=l,h=0;for(;c!==o;)h+=n[c++],c%=e;if(o=(o+1)%e,o===l&&(l=(l+1)%e),a-i<t)return;const d=u&&a-u;return d?Math.round(1e3*h/d):void 0}}function progressEventReducer(e,t){let n=0;const r=speedometer(50,250);return i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,s=o-n,a=r(s);n=o;const u={loaded:o,total:l,progress:l?o/l:void 0,bytes:s,rate:a||void 0,estimated:a&&l&&o<=l?(l-o)/a:void 0,event:i};u[t?"download":"upload"]=!0,e(u)}}const isXHRAdapterSupported="undefined"!=typeof XMLHttpRequest;var xhrAdapter=isXHRAdapterSupported&&function(e){return new Promise((function(t,n){let r=e.data;const i=AxiosHeaders$1.from(e.headers).normalize();let o,l,{responseType:s,withXSRFToken:a}=e;function u(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}if(utils$1.isFormData(r))if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if(!1!==(l=i.getContentType())){const[e,...t]=l?l.split(";").map((e=>e.trim())).filter(Boolean):[];i.setContentType([e||"multipart/form-data",...t].join("; "))}let c=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(t+":"+n))}const h=buildFullPath(e.baseURL,e.url);function d(){if(!c)return;const r=AxiosHeaders$1.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());settle((function(e){t(e),u()}),(function(e){n(e),u()}),{data:s&&"text"!==s&&"json"!==s?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:r,config:e,request:c}),c=null}if(c.open(e.method.toUpperCase(),buildURL(h,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(d)},c.onabort=function(){c&&(n(new AxiosError("Request aborted",AxiosError.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new AxiosError("Network Error",AxiosError.ERR_NETWORK,e,c)),c=null},c.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||transitionalDefaults;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new AxiosError(t,r.clarifyTimeoutError?AxiosError.ETIMEDOUT:AxiosError.ECONNABORTED,e,c)),c=null},platform.hasStandardBrowserEnv&&(a&&utils$1.isFunction(a)&&(a=a(e)),a||!1!==a&&isURLSameOrigin(h))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&cookies.read(e.xsrfCookieName);t&&i.set(e.xsrfHeaderName,t)}void 0===r&&i.setContentType(null),"setRequestHeader"in c&&utils$1.forEach(i.toJSON(),(function(e,t){c.setRequestHeader(t,e)})),utils$1.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),s&&"json"!==s&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",progressEventReducer(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",progressEventReducer(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=t=>{c&&(n(!t||t.type?new CanceledError(null,e,c):t),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const f=parseProtocol(h);f&&-1===platform.protocols.indexOf(f)?n(new AxiosError("Unsupported protocol "+f+":",AxiosError.ERR_BAD_REQUEST,e)):c.send(r||null)}))};const knownAdapters={http:httpAdapter,xhr:xhrAdapter};utils$1.forEach(knownAdapters,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const renderReason=e=>`- ${e}`,isResolvedHandle=e=>utils$1.isFunction(e)||null===e||!1===e;var adapters={getAdapter:e=>{e=utils$1.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let o=0;o<t;o++){let t;if(n=e[o],r=n,!isResolvedHandle(n)&&(r=knownAdapters[(t=String(n)).toLowerCase()],void 0===r))throw new AxiosError(`Unknown adapter '${t}'`);if(r)break;i[t||"#"+o]=r}if(!r){const e=Object.entries(i).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));throw new AxiosError("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(renderReason).join("\n"):" "+renderReason(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:knownAdapters};function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new CanceledError(null,e)}function dispatchRequest(e){throwIfCancellationRequested(e),e.headers=AxiosHeaders$1.from(e.headers),e.data=transformData.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return adapters.getAdapter(e.adapter||defaults$1.adapter)(e).then((function(t){return throwIfCancellationRequested(e),t.data=transformData.call(e,e.transformResponse,t),t.headers=AxiosHeaders$1.from(t.headers),t}),(function(t){return isCancel(t)||(throwIfCancellationRequested(e),t&&t.response&&(t.response.data=transformData.call(e,e.transformResponse,t.response),t.response.headers=AxiosHeaders$1.from(t.response.headers))),Promise.reject(t)}))}const headersToObject=e=>e instanceof AxiosHeaders$1?e.toJSON():e;function mergeConfig(e,t){t=t||{};const n={};function r(e,t,n){return utils$1.isPlainObject(e)&&utils$1.isPlainObject(t)?utils$1.merge.call({caseless:n},e,t):utils$1.isPlainObject(t)?utils$1.merge({},t):utils$1.isArray(t)?t.slice():t}function i(e,t,n){return utils$1.isUndefined(t)?utils$1.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function o(e,t){if(!utils$1.isUndefined(t))return r(void 0,t)}function l(e,t){return utils$1.isUndefined(t)?utils$1.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const a={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:s,headers:(e,t)=>i(headersToObject(e),headersToObject(t),!0)};return utils$1.forEach(Object.keys(Object.assign({},e,t)),(function(r){const o=a[r]||i,l=o(e[r],t[r],r);utils$1.isUndefined(l)&&o!==s||(n[r]=l)})),n}const VERSION="1.6.3",validators$1={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{validators$1[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const deprecatedWarnings={};function assertOptions(e,t,n){if("object"!=typeof e)throw new AxiosError("options must be an object",AxiosError.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],l=t[o];if(l){const t=e[o],n=void 0===t||l(t,o,e);if(!0!==n)throw new AxiosError("option "+o+" must be "+n,AxiosError.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new AxiosError("Unknown option "+o,AxiosError.ERR_BAD_OPTION)}}validators$1.transitional=function(e,t,n){function r(e,t){return"[Axios v"+VERSION+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new AxiosError(r(i," has been removed"+(t?" in "+t:"")),AxiosError.ERR_DEPRECATED);return t&&!deprecatedWarnings[i]&&(deprecatedWarnings[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var validator={assertOptions:assertOptions,validators:validators$1};const validators=validator.validators;class Axios{constructor(e){this.defaults=e,this.interceptors={request:new InterceptorManager$1,response:new InterceptorManager$1}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=mergeConfig(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&validator.assertOptions(n,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),null!=r&&(utils$1.isFunction(r)?t.paramsSerializer={serialize:r}:validator.assertOptions(r,{encode:validators.function,serialize:validators.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&utils$1.merge(i.common,i[t.method]);i&&utils$1.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=AxiosHeaders$1.concat(o,i);const l=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,l.unshift(e.fulfilled,e.rejected))}));const a=[];let u;this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)}));let c,h=0;if(!s){const e=[dispatchRequest.bind(this),void 0];for(e.unshift.apply(e,l),e.push.apply(e,a),c=e.length,u=Promise.resolve(t);h<c;)u=u.then(e[h++],e[h++]);return u}c=l.length;let d=t;for(h=0;h<c;){const e=l[h++],t=l[h++];try{d=e(d)}catch(e){t.call(this,e);break}}try{u=dispatchRequest.call(this,d)}catch(e){return Promise.reject(e)}for(h=0,c=a.length;h<c;)u=u.then(a[h++],a[h++]);return u}getUri(e){return buildURL(buildFullPath((e=mergeConfig(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}utils$1.forEach(["delete","get","head","options"],(function(e){Axios.prototype[e]=function(t,n){return this.request(mergeConfig(n||{},{method:e,url:t,data:(n||{}).data}))}})),utils$1.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(mergeConfig(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Axios.prototype[e]=t(),Axios.prototype[e+"Form"]=t(!0)}));var Axios$1=Axios;class CancelToken{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new CanceledError(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new CancelToken((function(t){e=t})),cancel:e}}}var CancelToken$1=CancelToken;function spread(e){return function(t){return e.apply(null,t)}}function isAxiosError(e){return utils$1.isObject(e)&&!0===e.isAxiosError}const HttpStatusCode={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode).forEach((([e,t])=>{HttpStatusCode[t]=e}));var HttpStatusCode$1=HttpStatusCode;function createInstance(e){const t=new Axios$1(e),n=bind$2(Axios$1.prototype.request,t);return utils$1.extend(n,Axios$1.prototype,t,{allOwnKeys:!0}),utils$1.extend(n,t,null,{allOwnKeys:!0}),n.create=function(t){return createInstance(mergeConfig(e,t))},n}const axios=createInstance(defaults$1);axios.Axios=Axios$1,axios.CanceledError=CanceledError,axios.CancelToken=CancelToken$1,axios.isCancel=isCancel,axios.VERSION=VERSION,axios.toFormData=toFormData,axios.AxiosError=AxiosError,axios.Cancel=axios.CanceledError,axios.all=function(e){return Promise.all(e)},axios.spread=spread,axios.isAxiosError=isAxiosError,axios.mergeConfig=mergeConfig,axios.AxiosHeaders=AxiosHeaders$1,axios.formToJSON=e=>formDataToJSON(utils$1.isHTMLForm(e)?new FormData(e):e),axios.getAdapter=adapters.getAdapter,axios.HttpStatusCode=HttpStatusCode$1,axios.default=axios;var axios_1$1=axios,__awaiter$5=commonjsGlobal$1&&commonjsGlobal$1.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))},__importDefault$1=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(base,"__esModule",{value:!0}),base.BaseAPI=void 0;const axios_1=__importDefault$1(axios_1$1);class BaseAPI{constructor(e){this.options=e,this.setOptions(e)}setOptions(e){var t,n;if(this.options=e,!e.auth)throw new Error("please provide auth info");this.eject(this.currentInterceptorsId,this.axiosInstance);const r=this.getHeaders(e);this.axiosInstance=axios_1.default.create({transformResponse:e.transformResponse,baseURL:e.baseUrl,headers:r,auth:(null===(t=e.auth)||void 0===t?void 0:t.basic)?e.auth.basic:void 0,withCredentials:null===(n=null==e?void 0:e.auth)||void 0===n?void 0:n.includeCredentials}),this.currentInterceptorsId=this.intercept(this.axiosInstance)}whoAmI(){return __awaiter$5(this,void 0,void 0,(function*(){return(yield this.axiosInstance.get("/whoami")).data}))}onResponseSuccessCallback(e){this.responseSuccessCallback=e}onResponseErrorCallback(e){this.responseErrorCallback=e}unloadClient(e,t){var n;if(!e||!t)return;const r=this.options.auth.basic?`Basic ${window.btoa(this.options.auth.basic.username+":"+this.options.auth.basic.password)}`:`Bearer ${null===(n=this.options.auth.token)||void 0===n?void 0:n.bearer}`,i=new Headers(Object.assign({"Content-Type":"application/json","serverx-token":t,Authorization:r},this.options.headers)),o=new Request(`${this.options.baseUrl}/user/goodbye`,{method:"POST",headers:i,mode:"cors",cache:"default",keepalive:!0,body:JSON.stringify({session:e})});window.fetch(o)}getHeaders(e){const t={};if(e.auth.username&&(t.user=e.auth.username),e.auth.token&&e.auth.token.bearer&&(t.Authorization=`Bearer ${e.auth.token.bearer}`),e.headers)for(const n of Object.keys(e.headers))t[n]=e.headers[n];return t}intercept(e){var t,n;try{return null===(n=null===(t=null==e?void 0:e.interceptors)||void 0===t?void 0:t.response)||void 0===n?void 0:n.use((e=>{var t;try{null===(t=this.responseSuccessCallback)||void 0===t||t.call(this,e)}catch(e){}return e}),(e=>{var t;try{null===(t=this.responseErrorCallback)||void 0===t||t.call(this,e)}catch(e){}return Promise.reject(e)}))}catch(e){return}}eject(e,t){var n,r;try{e&&(null===(r=null===(n=null==t?void 0:t.interceptors)||void 0===n?void 0:n.response)||void 0===r||r.eject(e))}catch(e){}}}base.BaseAPI=BaseAPI;var systemConfig={},__awaiter$4=commonjsGlobal$1&&commonjsGlobal$1.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(systemConfig,"__esModule",{value:!0}),systemConfig.SystemConfigAPI=void 0;class SystemConfigAPI{constructor(e){this.axios=e}getAll(e){return __awaiter$4(this,void 0,void 0,(function*(){let t="/systemConfig";if(e){t+=`?params=${encodeURIComponent(JSON.stringify(e))}`}return(yield this.axios.get(t)).data}))}getExactEntry(e){return __awaiter$4(this,void 0,void 0,(function*(){return(yield this.axios.post("/systemConfig/get",{identifier:e,exact:!0})).data}))}getComputed(e){return __awaiter$4(this,void 0,void 0,(function*(){return(yield this.axios.post("/systemConfig/get",{identifier:e,exact:!1})).data}))}addOrReplace(e){return __awaiter$4(this,void 0,void 0,(function*(){yield this.axios.post("/systemConfig/",e)}))}remove(e){return __awaiter$4(this,void 0,void 0,(function*(){yield this.axios.post("/systemConfig/delete",e)}))}removeConfigForIdentifier(e,t){return __awaiter$4(this,void 0,void 0,(function*(){yield this.axios.post("/systemConfig/deleteConfig",{identifier:e,config:t})}))}}systemConfig.SystemConfigAPI=SystemConfigAPI;var promise={},__awaiter$3=commonjsGlobal$1&&commonjsGlobal$1.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(promise,"__esModule",{value:!0}),promise.PromiseWrapper=void 0;let PromiseWrapper$1=class{constructor(){this.resolve=()=>{},this.reject=()=>{},this.rejected=!1,this.resolved=!1,this.promise=new Promise(((e,t)=>{this.resolve=t=>{this.resolved=!0,e(t)},this.reject=e=>{this.rejected=!0,t(e)}}))}static delay(e){return new Promise((t=>setTimeout(t,e)))}static delayForever(){return __awaiter$3(this,void 0,void 0,(function*(){for(;;)yield this.delay(2147483647)}))}get ended(){return this.rejected||this.resolved}};promise.PromiseWrapper=PromiseWrapper$1;var __awaiter$2=commonjsGlobal$1&&commonjsGlobal$1.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))},__importDefault=commonjsGlobal$1&&commonjsGlobal$1.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(client,"__esModule",{value:!0}),client.ClientAPI=void 0;const jwt_decode_1=__importDefault(require$$0$1),form_data_1=__importDefault(browser),base_1=base,systemConfig_1=systemConfig,promise_1=promise;class ClientAPI extends base_1.BaseAPI{constructor(e){super(e),this.customRequest=e.req,this.systemConfig=new systemConfig_1.SystemConfigAPI(this.axiosInstance)}unload(){this.unloadClient(this.sessionToken.session,this.sessionTokenString)}refreshData(e){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.post("/user",e)).data}))}getApps(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.get("/user/apps")).data}))}getLayouts(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.get("/user/layouts")).data}))}saveLayout(e){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.post("/user/layouts",e)).data}))}deleteUserLayout(e){return __awaiter$2(this,void 0,void 0,(function*(){yield this.delete(`/user/layouts/${e}`)}))}deleteAllUserLayouts(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.delete("/user/layouts/")).data}))}renameLayout(e,t){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.post(`/user/layouts/${e}/rename`,{newName:t})).data}))}getDefaultLayout(){return __awaiter$2(this,void 0,void 0,(function*(){const e=yield this.get("/user/layouts/default");if(204!==e.status)return e.data}))}setDefaultLayout(e){return __awaiter$2(this,void 0,void 0,(function*(){const t=yield this.post("/user/layouts/default",{id:e});if(204!==t.status)return t.data}))}openSession(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const n=yield this.post("/user/hello",{machine:e,glue:t});return{token:this.updateToken(n.data.token),data:n.data.data}}))}closeSession(e){return __awaiter$2(this,void 0,void 0,(function*(){if(!(e=null!=e?e:this.sessionToken.session))throw new Error("no active session");const t={session:e};yield this.post("/user/goodbye",t)}))}refreshToken(){return __awaiter$2(this,void 0,void 0,(function*(){const e={token:this.sessionTokenString},t=yield this.post("/user/refresh",e);return this.updateToken(t.data.token)}))}getCommands(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.get(`/user/commands/${this.sessionToken.session}`)).data}))}setCommandResult(e,t){return __awaiter$2(this,void 0,void 0,(function*(){yield this.post(`/user/commands/${e}`,t)}))}setCommandFileResult(e,t,n){return __awaiter$2(this,void 0,void 0,(function*(){const r={fileName:t,contents:n};yield this.post(`/user/commands/${e}/file`,r)}))}getPrefs(e,t){return __awaiter$2(this,void 0,void 0,(function*(){try{let n=`/user/prefs/${e}`;if(t){n+=`?last=${t.getTime()}`}return(yield this.get(n)).data}catch(e){return}}))}getAllPrefs(){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.get("/user/prefs/")).data}))}setPrefs(e){return __awaiter$2(this,void 0,void 0,(function*(){return(yield this.post("/user/prefs/",e)).data}))}deletePrefs(e){return __awaiter$2(this,void 0,void 0,(function*(){yield this.delete(`/user/prefs/${e}`)}))}deleteAllPrefs(){return __awaiter$2(this,void 0,void 0,(function*(){yield this.delete("/user/prefs/")}))}addFeedback(e,t){return __awaiter$2(this,void 0,void 0,(function*(){const n=new form_data_1.default;n.append("description",e),n.append("attachment",t);try{return(yield this.post("/user/feedbacks",n,n.getHeaders())).data}catch(e){throw e}}))}setOptions(e){super.setOptions(e),this.sessionTokenString&&this.updateToken(this.sessionTokenString)}updateToken(e){var t;return this.sessionTokenString=e,this.axiosInstance.defaults.headers.common["serverx-token"]=e,this.options.headers=null!==(t=this.options.headers)&&void 0!==t?t:{},this.options.headers["serverx-token"]=e,this.sessionToken=jwt_decode_1.default(e),this.sessionToken}get(e,t){return __awaiter$2(this,void 0,void 0,(function*(){return this.customRequest?this.withRequest(e,"GET",t):this.axiosInstance.get(e,t)}))}post(e,t,n){return __awaiter$2(this,void 0,void 0,(function*(){return this.customRequest?this.withRequest(e,"POST",t,n):this.axiosInstance.post(e,t,{headers:n})}))}delete(e,t){return __awaiter$2(this,void 0,void 0,(function*(){return this.customRequest?this.withRequest(e,"DELETE",t):this.axiosInstance.delete(e,t)}))}withRequest(e,t,n,r){return __awaiter$2(this,void 0,void 0,(function*(){if(!this.customRequest)throw new Error("invalid call");const i=new promise_1.PromiseWrapper;let o=this.getHeaders(this.options);r&&(o=Object.assign(Object.assign({},o),{extraHeaders:r})),e.startsWith("/")&&(e=e.substring(1));let l=this.options.baseUrl;l.endsWith("/")||(l+="/");const s=new URL(e,l).href,a={method:t,url:s,headers:o,json:null==n||n};return this.customRequest(a,((e,t)=>{if(e)return void i.reject(e);if(t.statusCode>=400)return void i.reject(`received error with code ${t.statusCode}`);let n={};if(t.body)try{n=t.body}catch(e){}i.resolve({data:n,status:t.statusCode})})),i.promise}))}}client.ClientAPI=ClientAPI,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ClientAPI=void 0;var t=client;Object.defineProperty(e,"ClientAPI",{enumerable:!0,get:function(){return t.ClientAPI}})}(client$1);var uaParser={exports:{}};!function(e,t){!function(n,r){var i="function",o="undefined",l="object",s="string",a="major",u="model",c="name",h="type",d="vendor",f="version",p="architecture",g="console",w="mobile",m="tablet",v="smarttv",y="wearable",b="embedded",S="Amazon",$="Apple",C="ASUS",I="BlackBerry",x="Browser",E="Chrome",D="Firefox",A="Google",k="Huawei",_="LG",j="Microsoft",N="Motorola",R="Opera",T="Samsung",P="Sharp",O="Sony",F="Xiaomi",B="Zebra",M="Facebook",Q="Chromium OS",G="Mac OS",U=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},J=function(e,t){return typeof e===s&&-1!==W(t).indexOf(W(e))},W=function(e){return e.toLowerCase()},q=function(e,t){if(typeof e===s)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},L=function(e,t){for(var n,o,s,a,u,c,h=0;h<t.length&&!u;){var d=t[h],f=t[h+1];for(n=o=0;n<d.length&&!u&&d[n];)if(u=d[n++].exec(e))for(s=0;s<f.length;s++)c=u[++o],typeof(a=f[s])===l&&a.length>0?2===a.length?typeof a[1]==i?this[a[0]]=a[1].call(this,c):this[a[0]]=a[1]:3===a.length?typeof a[1]!==i||a[1].exec&&a[1].test?this[a[0]]=c?c.replace(a[1],a[2]):r:this[a[0]]=c?a[1].call(this,c,a[2]):r:4===a.length&&(this[a[0]]=c?a[3].call(this,c.replace(a[1],a[2])):r):this[a]=c||r;h+=2}},K=function(e,t){for(var n in t)if(typeof t[n]===l&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(J(t[n][i],e))return"?"===n?r:n}else if(J(t[n],e))return"?"===n?r:n;return e},H={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,f],[/opios[\/ ]+([\w\.]+)/i],[f,[c,R+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[c,R]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[c,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[c,"UC"+x]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[f,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[c,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+x],f],[/\bfocus\/([\w\.]+)/i],[f,[c,D+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[c,R+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[c,R+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[c,"MIUI "+x]],[/fxios\/([-\w\.]+)/i],[f,[c,D]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+x]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+x],f],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,M],f],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[c,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[c,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[c,E+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,E+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[c,"Android "+x]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[f,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[c,D+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,f],[/(cobalt)\/([\w\.]+)/i],[c,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,W]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",W]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,W]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[d,T],[h,m]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[d,T],[h,w]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[d,$],[h,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[d,$],[h,m]],[/(macintosh);/i],[u,[d,$]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[d,P],[h,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[d,k],[h,m]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[d,k],[h,w]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[d,F],[h,w]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[d,F],[h,m]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[d,"OPPO"],[h,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[d,"Vivo"],[h,w]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[d,"Realme"],[h,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[d,N],[h,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[d,N],[h,m]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[d,_],[h,m]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[d,_],[h,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[d,"Lenovo"],[h,m]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[d,"Nokia"],[h,w]],[/(pixel c)\b/i],[u,[d,A],[h,m]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[d,A],[h,w]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[d,O],[h,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[d,O],[h,m]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[d,"OnePlus"],[h,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[d,S],[h,m]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[d,S],[h,w]],[/(playbook);[-\w\),; ]+(rim)/i],[u,d,[h,m]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[d,I],[h,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[d,C],[h,m]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[d,C],[h,w]],[/(nexus 9)/i],[u,[d,"HTC"],[h,m]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[u,/_/g," "],[h,w]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[d,"Acer"],[h,m]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[d,"Meizu"],[h,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,u,[h,w]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,u,[h,m]],[/(surface duo)/i],[u,[d,j],[h,m]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[d,"Fairphone"],[h,w]],[/(u304aa)/i],[u,[d,"AT&T"],[h,w]],[/\bsie-(\w*)/i],[u,[d,"Siemens"],[h,w]],[/\b(rct\w+) b/i],[u,[d,"RCA"],[h,m]],[/\b(venue[\d ]{2,7}) b/i],[u,[d,"Dell"],[h,m]],[/\b(q(?:mv|ta)\w+) b/i],[u,[d,"Verizon"],[h,m]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[d,"Barnes & Noble"],[h,m]],[/\b(tm\d{3}\w+) b/i],[u,[d,"NuVision"],[h,m]],[/\b(k88) b/i],[u,[d,"ZTE"],[h,m]],[/\b(nx\d{3}j) b/i],[u,[d,"ZTE"],[h,w]],[/\b(gen\d{3}) b.+49h/i],[u,[d,"Swiss"],[h,w]],[/\b(zur\d{3}) b/i],[u,[d,"Swiss"],[h,m]],[/\b((zeki)?tb.*\b) b/i],[u,[d,"Zeki"],[h,m]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],u,[h,m]],[/\b(ns-?\w{0,9}) b/i],[u,[d,"Insignia"],[h,m]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[d,"NextBook"],[h,m]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],u,[h,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],u,[h,w]],[/\b(ph-1) /i],[u,[d,"Essential"],[h,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[d,"Envizen"],[h,m]],[/\b(trio[-\w\. ]+) b/i],[u,[d,"MachSpeed"],[h,m]],[/\btu_(1491) b/i],[u,[d,"Rotor"],[h,m]],[/(shield[\w ]+) b/i],[u,[d,"Nvidia"],[h,m]],[/(sprint) (\w+)/i],[d,u,[h,w]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[d,j],[h,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[d,B],[h,m]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[d,B],[h,w]],[/smart-tv.+(samsung)/i],[d,[h,v]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[d,T],[h,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,_],[h,v]],[/(apple) ?tv/i],[d,[u,$+" TV"],[h,v]],[/crkey/i],[[u,E+"cast"],[d,A],[h,v]],[/droid.+aft(\w)( bui|\))/i],[u,[d,S],[h,v]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[d,P],[h,v]],[/(bravia[\w ]+)( bui|\))/i],[u,[d,O],[h,v]],[/(mitv-\w{5}) bui/i],[u,[d,F],[h,v]],[/Hbbtv.*(technisat) (.*);/i],[d,u,[h,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,q],[u,q],[h,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,u,[h,g]],[/droid.+; (shield) bui/i],[u,[d,"Nvidia"],[h,g]],[/(playstation [345portablevi]+)/i],[u,[d,O],[h,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[d,j],[h,g]],[/((pebble))app/i],[d,u,[h,y]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[d,$],[h,y]],[/droid.+; (glass) \d/i],[u,[d,A],[h,y]],[/droid.+; (wt63?0{2,3})\)/i],[u,[d,B],[h,y]],[/(quest( 2| pro)?)/i],[u,[d,M],[h,y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[h,b]],[/(aeobc)\b/i],[u,[d,S],[h,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[h,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[h,m]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,m]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,w]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[c,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[f,K,H]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[f,K,H]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,G],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,f],[/\(bb(10);/i],[f,[c,I]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[c,D+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[c,E+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,Q],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,f],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[c,f]]},V=function(e,t){if(typeof e===l&&(t=e,e=r),!(this instanceof V))return new V(e,t).getResult();var g=typeof n!==o&&n.navigator?n.navigator:r,v=e||(g&&g.userAgent?g.userAgent:""),y=g&&g.userAgentData?g.userAgentData:r,b=t?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(z,t):z,S=g&&g.userAgent==v;return this.getBrowser=function(){var e={};return e[c]=r,e[f]=r,L.call(e,v,b.browser),e[a]=function(e){return typeof e===s?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[f]),S&&g&&g.brave&&typeof g.brave.isBrave==i&&(e[c]="Brave"),e},this.getCPU=function(){var e={};return e[p]=r,L.call(e,v,b.cpu),e},this.getDevice=function(){var e={};return e[d]=r,e[u]=r,e[h]=r,L.call(e,v,b.device),S&&!e[h]&&y&&y.mobile&&(e[h]=w),S&&"Macintosh"==e[u]&&g&&typeof g.standalone!==o&&g.maxTouchPoints&&g.maxTouchPoints>2&&(e[u]="iPad",e[h]=m),e},this.getEngine=function(){var e={};return e[c]=r,e[f]=r,L.call(e,v,b.engine),e},this.getOS=function(){var e={};return e[c]=r,e[f]=r,L.call(e,v,b.os),S&&!e[c]&&y&&"Unknown"!=y.platform&&(e[c]=y.platform.replace(/chrome os/i,Q).replace(/macos/i,G)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(e){return v=typeof e===s&&e.length>350?q(e,350):e,this},this.setUA(v),this};V.VERSION="1.0.35",V.BROWSER=U([c,f,a]),V.CPU=U([p]),V.DEVICE=U([u,d,h,g,w,v,m,y,b]),V.ENGINE=V.OS=U([c,f]),e.exports&&(t=e.exports=V),t.UAParser=V;var X=typeof n!==o&&(n.jQuery||n.Zepto);if(X&&!X.ua){var Z=new V;X.ua=Z.getResult(),X.ua.get=function(){return Z.getUA()},X.ua.set=function(e){Z.setUA(e);var t=Z.getResult();for(var n in t)X.ua[n]=t[n]}}}("object"==typeof window?window:commonjsGlobal$1)}(uaParser,uaParser.exports);var uaParserExports=uaParser.exports;(function(){var h,aa=this||self;function ba(e){var t=typeof e;return"object"!=t?t:e?Array.isArray(e)?"array":t:"null"}function ea(e){var t=ba(e);return"array"==t||"object"==t&&"number"==typeof e.length}function fa(e){return Object.prototype.hasOwnProperty.call(e,ha)&&e[ha]||(e[ha]=++ia)}var ha="closure_uid_"+(1e9*Math.random()>>>0),ia=0;function ja(e,t,n){return e.call.apply(e.bind,arguments)}function ka(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function la(e,t,n){return(la=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ja:ka).apply(null,arguments)}function ma(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function na(e,t){e=e.split(".");var n,r=aa;e[0]in r||void 0===r.execScript||r.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=t}function oa(e,t){function n(){}n.prototype=t.prototype,e.Bi=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wd=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}function pa(e,t){return new qa(e,t)}function ra(e){return 0<e?0x8000000000000000<=e?ta:new qa(e,e/4294967296):0>e?-0x8000000000000000>=e?ua:va(new qa(-e,-e/4294967296)):wa}function va(e){var t=1+~e.la|0;return pa(t,~e.ha+!t|0)}function xa(e){return 4294967296*e.ha+(e.la>>>0)}function ya(e,t){if(za(t))throw Error("division by zero");if(0>e.ha){if(Aa(e,ua)){if(Aa(t,Ba)||Aa(t,Ca))return ua;if(Aa(t,ua))return Ba;var n=1;if(0==n)n=e;else{var r=e.ha;n=32>n?pa(e.la>>>n|r<<32-n,r>>n):pa(r>>n-32,0<=r?0:-1)}return Aa(n=ya(n,t).shiftLeft(1),wa)?0>t.ha?Ba:Ca:(r=t.multiply(n),e=e.add(va(r)),n.add(ya(e,t)))}return 0>t.ha?ya(va(e),va(t)):va(ya(va(e),t))}if(za(e))return wa;if(0>t.ha)return Aa(t,ua)?wa:va(ya(e,va(t)));for(r=wa;0<=e.compare(t);){n=Math.max(1,Math.floor(xa(e)/xa(t)));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:Math.pow(2,i-48);for(var o=ra(n),l=o.multiply(t);0>l.ha||0<l.compare(e);)l=(o=ra(n-=i)).multiply(t);za(o)&&(o=Ba),r=r.add(o),e=e.add(va(l))}return r}function za(e){return 0==e.la&&0==e.ha}function Aa(e,t){return e.la==t.la&&e.ha==t.ha}class qa{constructor(e,t){this.la=0|e,this.ha=0|t}isSafeInteger(){var e=this.ha>>21;return 0==e||-1==e&&!(0==this.la&&-2097152==this.ha)}toString(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(this.isSafeInteger()){var t=xa(this);return 10==e?""+t:t.toString(e)}t=14-(e>>2);var n=Math.pow(e,t),r=pa(n,n/4294967296);n=ya(this,r);var i=Math,o=i.abs;return r=n.multiply(r),r=this.add(va(r)),i=o.call(i,xa(r)),(o=10==e?""+i:i.toString(e)).length<t&&(o="0000000000000".substr(o.length-t)+o),i=xa(n),(10==e?i:i.toString(e))+o}compare(e){return this.ha==e.ha?this.la==e.la?0:this.la>>>0>e.la>>>0?1:-1:this.ha>e.ha?1:-1}add(e){var t=this.ha>>>16,n=65535&this.ha,r=this.la>>>16,i=e.ha>>>16,o=65535&e.ha,l=e.la>>>16;return r=(l=((e=(65535&this.la)+(65535&e.la))>>>16)+(r+l))>>>16,pa((65535&l)<<16|65535&e,(t=((r+=n+o)>>>16)+(t+i)&65535)<<16|65535&r)}multiply(e){if(za(this))return this;if(za(e))return e;var t=this.ha>>>16,n=65535&this.ha,r=this.la>>>16,i=65535&this.la,o=e.ha>>>16,l=65535&e.ha,s=e.la>>>16,a=i*(e=65535&e.la),u=(a>>>16)+r*e,c=u>>>16;c+=(u=(65535&u)+i*s)>>>16;var h=(c+=n*e)>>>16;return pa((65535&u)<<16|65535&a,(h=(h+=(c=(65535&c)+r*s)>>>16)+((c=(65535&c)+i*l)>>>16)+(t*e+n*s+r*l+i*o)&65535)<<16|65535&c)}and(e){return pa(this.la&e.la,this.ha&e.ha)}or(e){return pa(this.la|e.la,this.ha|e.ha)}xor(e){return pa(this.la^e.la,this.ha^e.ha)}shiftLeft(e){if(0==(e&=63))return this;var t=this.la;return 32>e?pa(t<<e,this.ha<<e|t>>>32-e):pa(0,t<<e-32)}}const wa=pa(0,0),Ba=pa(1,0),Ca=pa(-1,-1),ta=pa(4294967295,2147483647),ua=pa(0,2147483648);function Ea(e,t){const n=e.length-t.length;return 0<=n&&e.indexOf(t,n)==n}function Fa(e){return/^[\s\xa0]*$/.test(e)}function Ga(e){const t=[];let n=0;for(const r in e)t[n++]=r;return t}function Ia(e,t,n){return null!==e&&t in e?e[t]:n}function Ja(e){return Array.prototype.concat.apply([],arguments)}function Ka(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function La(e,t,n,r){return Array.prototype.splice.apply(e,Ma(arguments,1))}function Ma(e,t,n){return 2>=arguments.length?Array.prototype.slice.call(e,t):Array.prototype.slice.call(e,t,n)}function Na(e,t){e.sort(t||Oa)}function Pa(e,t){const n=Array(e.length);for(let t=0;t<e.length;t++)n[t]={index:t,value:e[t]};const r=t||Oa;for(Na(n,(function(e,t){return r(e.value,t.value)||e.index-t.index})),t=0;t<e.length;t++)e[t]=n[t].value}function Oa(e,t){return e>t?1:e<t?-1:0}function Qa(e){const t=[];for(let n=0;n<e;n++)t[n]=0;return t}var Ra;e:{const e=aa.navigator;if(e){const t=e.userAgent;if(t){Ra=t;break e}}Ra=""}let Sa=Ra;function Ta(e){return-1!=Sa.indexOf(e)}function Ua(){return Ta("Firefox")||Ta("FxiOS")}function Va(){return(Ta("Chrome")||Ta("CriOS"))&&!Ta("Edge")}function Wa(e){return 1==e.length&&" "<=e&&"~">=e||""<=e&&"">=e}var Xa=String.prototype.repeat?function(e,t){return e.repeat(t)}:function(e,t){return Array(t+1).join(e)};function Ya(e,t){let n=(e=String(e)).indexOf(".");-1===n&&(n=e.length);const r="-"===e[0]?"-":"";return r&&(e=e.substring(1)),r+Xa("0",Math.max(0,t-n))+e}function Za(e,t){null!=e&&this.append.apply(this,arguments)}h=Za.prototype,h.Lc="",h.set=function(e){this.Lc=""+e},h.append=function(e,t,n){if(this.Lc+=String(e),null!=t)for(let e=1;e<arguments.length;e++)this.Lc+=arguments[e];return this},h.clear=function(){this.Lc=""},h.getLength=function(){return this.Lc.length},h.toString=function(){return this.Lc};var $a={},ab={},bb,cb={},db=null,eb=null,fb=!0,hb=!0,ib=null,jb=null;function kb(){return new k(null,5,[lb,!0,qb,hb,rb,!1,sb,!1,tb,ib],null)}function ub(){fb=!1,eb=function(){var e=arguments;return console.log.apply(console,Ka(e))}}function n(e){return null!=e&&!1!==e}function vb(e){return null==e}function wb(e){return e instanceof Array}function xb(e){return"number"==typeof e}function yb(e){return null==e||!1===e}function zb(e){return null!=e}function Ab(e){return"string"===ba(e)}function Bb(){return!0}function Cb(e,t){return!!e[ba(null==t?null:t)]||!!e._}function Db(e){return null==e?null:e.constructor}function Eb(e,t){var r=Db(t);return Error(["No protocol method ",e," defined for type ",n(n(r)?r.Na:r)?r.Ja:ba(t),": ",t].join(""))}function Fb(e){var t=e.Ja;return n(t)?t:p.g(e)}var Gb="undefined"!=typeof Symbol&&"function"===ba(Symbol)?Symbol.iterator:"@@iterator",Ib={"]":"_RBRACK_","'":"_SINGLEQUOTE_","=":"_EQ_",'"':"_DOUBLEQUOTE_","!":"_BANG_","*":"_STAR_","%":"_PERCENT_","|":"_BAR_","~":"_TILDE_","/":"_SLASH_","\\":"_BSLASH_","-":"_","?":"_QMARK_","&":"_AMPERSAND_",":":"_COLON_","<":"_LT_","{":"_LBRACE_","}":"_RBRACE_","[":"_LBRACK_","#":"_SHARP_","^":"_CARET_","+":"_PLUS_","@":"_CIRCA_",">":"_GT_"},Jb={_RBRACE_:"}",_COLON_:":",_BANG_:"!",_QMARK_:"?",_BSLASH_:"\\\\",_SLASH_:"/",_PERCENT_:"%",_PLUS_:"+",_SHARP_:"#",_LBRACE_:"{",_BAR_:"|",_LBRACK_:"[",_EQ_:"=",_:"-",_TILDE_:"~",_RBRACK_:"]",_GT_:">",_SINGLEQUOTE_:"'",_CIRCA_:"@",_AMPERSAND_:"&",_DOUBLEQUOTE_:'\\"',_CARET_:"^",_LT_:"<",_STAR_:"*"},Kb=null;function Lb(e){for(var t=e.length,n=Array(t),r=0;r<t;)n[r]=e[r],r+=1;return n}function Mb(e){function t(e,t){return e.push(t),e}var n=[];return Nb.j?Nb.j(t,n,e):Nb.call(null,t,n,e)}function Ob(){}function Pb(){}function Qb(){}function Tb(e){if(null!=e&&null!=e.da)e=e.da(e);else{var t=Tb[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Tb._))throw Eb("ICounted.-count",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Ub(){}function Vb(e){if(null!=e&&null!=e.sa)e=e.sa(e);else{var t=Vb[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Vb._))throw Eb("IEmptyableCollection.-empty",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Wb(){}function Xb(e,t){if(null!=e&&null!=e.ia)e=e.ia(e,t);else{var n=Xb[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=Xb._))throw Eb("ICollection.-conj",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function Yb(){}var $b=function(){function e(e,t,n){var r=Zb[ba(null==e?null:e)];if(null!=r)return r.j?r.j(e,t,n):r.call(null,e,t,n);if(null!=(r=Zb._))return r.j?r.j(e,t,n):r.call(null,e,t,n);throw Eb("IIndexed.-nth",e)}function t(e,t){var n=Zb[ba(null==e?null:e)];if(null!=n)return n.h?n.h(e,t):n.call(null,e,t);if(null!=(n=Zb._))return n.h?n.h(e,t):n.call(null,e,t);throw Eb("IIndexed.-nth",e)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),Zb=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function ac(){}function bc(e){if(null!=e&&null!=e.Ga)e=e.Ga(e);else{var t=bc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=bc._))throw Eb("ISeq.-first",e);e=t.g?t.g(e):t.call(null,e)}}return e}function cc(e){if(null!=e&&null!=e.Ia)e=e.Ia(e);else{var t=cc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=cc._))throw Eb("ISeq.-rest",e);e=t.g?t.g(e):t.call(null,e)}}return e}function dc(){}function fc(e){if(null!=e&&null!=e.Aa)e=e.Aa(e);else{var t=fc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=fc._))throw Eb("INext.-next",e);e=t.g?t.g(e):t.call(null,e)}}return e}function gc(){}Zb.h=function(e,t){return null!=e&&null!=e.$?e.$(e,t):$b(e,t)},Zb.j=function(e,t,n){return null!=e&&null!=e.Ba?e.Ba(e,t,n):$b(e,t,n)},Zb.I=3;var ic=function(){function e(e,t,n){var r=hc[ba(null==e?null:e)];if(null!=r)return r.j?r.j(e,t,n):r.call(null,e,t,n);if(null!=(r=hc._))return r.j?r.j(e,t,n):r.call(null,e,t,n);throw Eb("ILookup.-lookup",e)}function t(e,t){var n=hc[ba(null==e?null:e)];if(null!=n)return n.h?n.h(e,t):n.call(null,e,t);if(null!=(n=hc._))return n.h?n.h(e,t):n.call(null,e,t);throw Eb("ILookup.-lookup",e)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),hc=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function jc(){}function kc(e,t){if(null!=e&&null!=e.za)e=e.za(e,t);else{var n=kc[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=kc._))throw Eb("IAssociative.-contains-key?",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function lc(e,t,n){if(null!=e&&null!=e.ja)e=e.ja(e,t,n);else{var r=lc[ba(null==e?null:e)];if(null!=r)e=r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=lc._))throw Eb("IAssociative.-assoc",e);e=r.j?r.j(e,t,n):r.call(null,e,t,n)}}return e}function mc(e,t){if(null!=e&&null!=e.zc)e=e.zc(e,t);else{var n=mc[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=mc._))throw Eb("IFind.-find",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function nc(){}function oc(e,t){if(null!=e&&null!=e.bb)e=e.bb(e,t);else{var n=oc[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=oc._))throw Eb("IMap.-dissoc",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function pc(e){if(null!=e&&null!=e.He)e=e.key;else{var t=pc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=pc._))throw Eb("IMapEntry.-key",e);e=t.g?t.g(e):t.call(null,e)}}return e}function qc(e){if(null!=e&&null!=e.Ie)e=e.v;else{var t=qc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=qc._))throw Eb("IMapEntry.-val",e);e=t.g?t.g(e):t.call(null,e)}}return e}function rc(){}function sc(e,t){if(null!=e&&null!=e.Cf)e=e.Cf(e,t);else{var n=sc[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=sc._))throw Eb("ISet.-disjoin",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function tc(e){if(null!=e&&null!=e.Ub)e=e.Ub(e);else{var t=tc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=tc._))throw Eb("IStack.-peek",e);e=t.g?t.g(e):t.call(null,e)}}return e}function uc(e){if(null!=e&&null!=e.Vb)e=e.Vb(e);else{var t=uc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=uc._))throw Eb("IStack.-pop",e);e=t.g?t.g(e):t.call(null,e)}}return e}function vc(){}function wc(e,t,n){if(null!=e&&null!=e.Kb)e=e.Kb(e,t,n);else{var r=wc[ba(null==e?null:e)];if(null!=r)e=r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=wc._))throw Eb("IVector.-assoc-n",e);e=r.j?r.j(e,t,n):r.call(null,e,t,n)}}return e}function xc(){}function r(e){if(null!=e&&null!=e.Jb)e=e.Jb(e);else{var t=r[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=r._))throw Eb("IDeref.-deref",e);e=t.g?t.g(e):t.call(null,e)}}return e}function yc(){}function zc(e){if(null!=e&&null!=e.R)e=e.R(e);else{var t=zc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=zc._))throw Eb("IMeta.-meta",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Ac(){}function Bc(e,t){if(null!=e&&null!=e.S)e=e.S(e,t);else{var n=Bc[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=Bc._))throw Eb("IWithMeta.-with-meta",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function Cc(){}hc.h=function(e,t){return null!=e&&null!=e.na?e.na(e,t):ic(e,t)},hc.j=function(e,t,n){return null!=e&&null!=e.P?e.P(e,t,n):ic(e,t,n)},hc.I=3;var Ec=function(){function e(e,t,n){var r=Dc[ba(null==e?null:e)];if(null!=r)return r.j?r.j(e,t,n):r.call(null,e,t,n);if(null!=(r=Dc._))return r.j?r.j(e,t,n):r.call(null,e,t,n);throw Eb("IReduce.-reduce",e)}function t(e,t){var n=Dc[ba(null==e?null:e)];if(null!=n)return n.h?n.h(e,t):n.call(null,e,t);if(null!=(n=Dc._))return n.h?n.h(e,t):n.call(null,e,t);throw Eb("IReduce.-reduce",e)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),Dc=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function Fc(){}function Gc(e,t,n){if(null!=e&&null!=e.Ka)e=e.Ka(e,t,n);else{var r=Gc[ba(null==e?null:e)];if(null!=r)e=r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=Gc._))throw Eb("IKVReduce.-kv-reduce",e);e=r.j?r.j(e,t,n):r.call(null,e,t,n)}}return e}function Hc(e,t){if(null!=e&&null!=e.aa)e=e.aa(e,t);else{var n=Hc[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=Hc._))throw Eb("IEquiv.-equiv",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function Ic(e){if(null!=e&&null!=e.ba)e=e.ba(e);else{var t=Ic[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Ic._))throw Eb("IHash.-hash",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Jc(){}function Kc(e){if(null!=e&&null!=e.ca)e=e.ca(e);else{var t=Kc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Kc._))throw Eb("ISeqable.-seq",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Lc(){}function Mc(){}function Nc(){}function Oc(){}function Pc(e){if(null!=e&&null!=e.Ac)e=e.Ac(e);else{var t=Pc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Pc._))throw Eb("IReversible.-rseq",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Qc(e,t){if(null!=e&&null!=e.Oc)e=e.Oc(e,t);else{var n=Qc[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=Qc._))throw Eb("IWriter.-write",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function Rc(e){if(null!=e&&null!=e.oc)e=e.oc(e);else{var t=Rc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Rc._))throw Eb("IWriter.-flush",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Sc(){}function Tc(e,t,n){if(null!=e&&null!=e.U)e=e.U(e,t,n);else{var r=Tc[ba(null==e?null:e)];if(null!=r)e=r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=Tc._))throw Eb("IPrintWithWriter.-pr-writer",e);e=r.j?r.j(e,t,n):r.call(null,e,t,n)}}return e}function Uc(){}function Vc(e){if(null!=e&&null!=e.Dd)e=e.Dd(e);else{var t=Vc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Vc._))throw Eb("IPending.-realized?",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Wc(e,t,n){if(null!=e&&null!=e.Le)e.Le(e,t,n);else{var r=Wc[ba(null==e?null:e)];if(null!=r)r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=Wc._))throw Eb("IWatchable.-notify-watches",e);r.j?r.j(e,t,n):r.call(null,e,t,n)}}}function Xc(e){if(null!=e&&null!=e.gd)e=e.gd(e);else{var t=Xc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Xc._))throw Eb("IEditableCollection.-as-transient",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Yc(e,t){if(null!=e&&null!=e.kd)e=e.kd(e,t);else{var n=Yc[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=Yc._))throw Eb("ITransientCollection.-conj!",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function Zc(e){if(null!=e&&null!=e.Ed)e=e.Ed(e);else{var t=Zc[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Zc._))throw Eb("ITransientCollection.-persistent!",e);e=t.g?t.g(e):t.call(null,e)}}return e}function $c(e,t,n){if(null!=e&&null!=e.jd)e=e.jd(e,t,n);else{var r=$c[ba(null==e?null:e)];if(null!=r)e=r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=$c._))throw Eb("ITransientAssociative.-assoc!",e);e=r.j?r.j(e,t,n):r.call(null,e,t,n)}}return e}function ad(e,t){if(null!=e&&null!=e.Ke)e=e.Ke(e,t);else{var n=ad[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=ad._))throw Eb("ITransientMap.-dissoc!",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function bd(){}function cd(e,t){if(null!=e&&null!=e.Tb)e=e.Tb(e,t);else{var n=cd[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=cd._))throw Eb("IComparable.-compare",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function dd(e){if(null!=e&&null!=e.Fe)e=e.Fe(e);else{var t=dd[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=dd._))throw Eb("IChunk.-drop-first",e);e=t.g?t.g(e):t.call(null,e)}}return e}function ed(e){if(null!=e&&null!=e.yd)e=e.yd(e);else{var t=ed[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=ed._))throw Eb("IChunkedSeq.-chunked-first",e);e=t.g?t.g(e):t.call(null,e)}}return e}function fd(e){if(null!=e&&null!=e.Mc)e=e.Mc(e);else{var t=fd[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=fd._))throw Eb("IChunkedSeq.-chunked-rest",e);e=t.g?t.g(e):t.call(null,e)}}return e}function gd(e){if(null!=e&&null!=e.Ad)e=e.Ad(e);else{var t=gd[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=gd._))throw Eb("INamed.-name",e);e=t.g?t.g(e):t.call(null,e)}}return e}function hd(e){if(null!=e&&null!=e.Bd)e=e.Bd(e);else{var t=hd[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=hd._))throw Eb("INamed.-namespace",e);e=t.g?t.g(e):t.call(null,e)}}return e}function id(e,t){if(null!=e&&null!=e.Ng)e=e.Ng(e,t);else{var n=id[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=id._))throw Eb("IReset.-reset!",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}Dc.h=function(e,t){return null!=e&&null!=e.Ea?e.Ea(e,t):Ec(e,t)},Dc.j=function(e,t,n){return null!=e&&null!=e.Fa?e.Fa(e,t,n):Ec(e,t,n)},Dc.I=3;var kd=function(){function e(e,t,n,r,i){var o=jd[ba(null==e?null:e)];if(null!=o)return o.O?o.O(e,t,n,r,i):o.call(null,e,t,n,r,i);if(null!=(o=jd._))return o.O?o.O(e,t,n,r,i):o.call(null,e,t,n,r,i);throw Eb("ISwap.-swap!",e)}function t(e,t,n,r){var i=jd[ba(null==e?null:e)];if(null!=i)return i.F?i.F(e,t,n,r):i.call(null,e,t,n,r);if(null!=(i=jd._))return i.F?i.F(e,t,n,r):i.call(null,e,t,n,r);throw Eb("ISwap.-swap!",e)}function n(e,t,n){var r=jd[ba(null==e?null:e)];if(null!=r)return r.j?r.j(e,t,n):r.call(null,e,t,n);if(null!=(r=jd._))return r.j?r.j(e,t,n):r.call(null,e,t,n);throw Eb("ISwap.-swap!",e)}function r(e,t){var n=jd[ba(null==e?null:e)];if(null!=n)return n.h?n.h(e,t):n.call(null,e,t);if(null!=(n=jd._))return n.h?n.h(e,t):n.call(null,e,t);throw Eb("ISwap.-swap!",e)}var i;return i=function(i,o,l,s,a){switch(arguments.length){case 2:return r.call(this,i,o);case 3:return n.call(this,i,o,l);case 4:return t.call(this,i,o,l,s);case 5:return e.call(this,i,o,l,s,a)}throw Error("Invalid arity: "+arguments.length)},i.h=r,i.j=n,i.F=t,i.O=e,i}(),jd=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return e.O(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function ld(e,t){if(null!=e&&null!=e.ld)e.ld(e,t);else{var n=ld[ba(null==e?null:e)];if(null!=n)n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=ld._))throw Eb("IVolatile.-vreset!",e);n.h?n.h(e,t):n.call(null,e,t)}}}function md(){}function nd(e){if(null!=e&&null!=e.xa)e=e.xa(e);else{var t=nd[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=nd._))throw Eb("IIterable.-iterator",e);e=t.g?t.g(e):t.call(null,e)}}return e}function od(e){this.ei=e,this.B=1073741824,this.M=0}function pd(e){var t=new Za,n=new od(t);return e.U(null,n,kb()),n.oc(null),p.g(t)}jd.h=function(e,t){return null!=e&&null!=e.Og?e.Og(e,t):kd(e,t)},jd.j=function(e,t,n){return null!=e&&null!=e.Pg?e.Pg(e,t,n):kd(e,t,n)},jd.F=function(e,t,n,r){return null!=e&&null!=e.Qg?e.Qg(e,t,n,r):kd(e,t,n,r)},jd.O=function(e,t,n,r,i){return null!=e&&null!=e.Rg?e.Rg(e,t,n,r,i):kd(e,t,n,r,i)},jd.I=5,od.prototype.Oc=function(e,t){return this.ei.append(t)},od.prototype.oc=function(){return null};var qd="undefined"!=typeof Math&&void 0!==Math.imul?function(e,t){return Math.imul(e,t)}:function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0};function rd(e){return e=qd(0|e,-862048943),qd(e<<15|e>>>-15,461845907)}function sd(e,t){return qd((e=(0|e)^(0|t))<<13|e>>>-13,5)+-430675100|0}function td(e,t){return e=qd((e=(0|e)^t)^e>>>16,-2048144789),(e=qd(e^e>>>13,-1028477387))^e>>>16}var ud={},vd=0;function wd(e){if(255<vd&&(ud={},vd=0),null==e)return 0;var t=ud[e];if("number"==typeof t)e=t;else{e:if(null!=e)if(t=e.length,0<t)for(var n=0,r=0;;){if(!(n<t)){t=r;break e}r=qd(31,r)+e.charCodeAt(n),n+=1}else t=0;else t=0;ud[e]=t,vd+=1,e=t}return e}function xd(e){if(null!=e&&(4194304&e.B||cb===e.oi))return 0^e.ba(null);if("number"!=typeof e)return!0===e?e=1231:!1===e?e=1237:"string"==typeof e?e=0===(e=wd(e))?e:td(sd(0,rd(e)),4):e=e instanceof Date?0^e.valueOf():null==e?0:0^Ic(e),e;if(isFinite(e))return Math.floor(e)%2147483647;switch(e){case 1/0:return 2146435072;case-1/0:return-1048576;default:return 2146959360}}function yd(e){var t=e.name;e:for(var n=1,r=0;;){if(!(n<t.length)){n=r;break e}r=sd(r,rd(t.charCodeAt(n-1)|t.charCodeAt(n)<<16)),n+=2}return(t=td(1==(1&t.length)?n^rd(t.charCodeAt(t.length-1)):n,qd(2,t.length)))^(e=wd(e.yb))+2654435769+(t<<6)+(t>>2)}function zd(e,t){if(e.uc===t.uc)return 0;var r=yb(e.yb);return n(r?t.yb:r)?-1:n(e.yb)?yb(t.yb)?1:0===(r=Oa(e.yb,t.yb))?Oa(e.name,t.name):r:Oa(e.name,t.name)}function Ad(e,t,n,r,i){this.yb=e,this.name=t,this.uc=n,this.ed=r,this.Mb=i,this.B=2154168321,this.M=4096}h=Ad.prototype,h.toString=function(){return this.uc},h.aa=function(e,t){return t instanceof Ad&&this.uc===t.uc},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return u.h?u.h(e,this):u.call(null,e,this)},h.h=function(e,t){return u.j?u.j(e,this,t):u.call(null,e,this,t)},h.R=function(){return this.Mb},h.S=function(e,t){return new Ad(this.yb,this.name,this.uc,this.ed,t)},h.ba=function(){var e=this.ed;return null!=e?e:this.ed=e=yd(this)},h.Ad=function(){return this.name},h.Bd=function(){return this.yb},h.U=function(e,t){return Qc(t,this.uc)};var Bd=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function Cd(e,t,n){this.v=e,this.ad=t,this.Mb=n,this.B=6717441,this.M=0}function Ed(e){return null!=e?!!(131072&e.M||cb===e.pi)||!e.M&&Cb(md,e):Cb(md,e)}function z(e){if(null==e)return null;if(null!=e&&(8388608&e.B||cb===e.Bf))return e.ca(null);if(wb(e)||"string"==typeof e)return 0===e.length?null:new Fd(e,0,null);if(null!=e&&null!=e[Gb])return e=Ia(e,Gb).call(e),Gd.g?Gd.g(e):Gd.call(null,e);if(Cb(Jc,e))return Kc(e);throw Error([p.g(e)," is not ISeqable"].join(""))}function A(e){return null==e?null:null!=e&&(64&e.B||cb===e.hd)?e.Ga(null):null==(e=z(e))?null:bc(e)}function Hd(e){return null!=e&&(null!=e&&(64&e.B||cb===e.hd)||(e=z(e)))?e.Ia(null):Id}function B(e){return null==e?null:null!=e&&(128&e.B||cb===e.Cd)?e.Aa(null):z(Hd(e))}Bd.g=function(e){for(;;){if(e instanceof Ad)return e;if("string"==typeof e){var t=e.indexOf("/");return 1>t?Bd.h(null,e):Bd.h(e.substring(0,t),e.substring(t+1,e.length))}if(e instanceof Cd)return e.ad;if(!(e instanceof w))throw Error("no conversion to symbol");e=e.W}},Bd.h=function(e,t){return new Ad(e,t,null!=e?[p.g(e),"/",p.g(t)].join(""):t,null,null)},Bd.I=2,h=Cd.prototype,h.toString=function(){return["#'",p.g(this.ad)].join("")},h.Jb=function(){return this.v.A?this.v.A():this.v.call(null)},h.R=function(){return this.Mb},h.S=function(e,t){return new Cd(this.v,this.ad,t)},h.aa=function(e,t){return t instanceof Cd&&(e=this.ad,t=t.ad,x.h?x.h(e,t):x.call(null,e,t))},h.ba=function(){return yd(this.ad)},h.xf=cb,h.call=function(e){switch(arguments.length-1){case 0:return this.A();case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);case 3:return this.j(arguments[1],arguments[2],arguments[3]);case 4:return this.F(arguments[1],arguments[2],arguments[3],arguments[4]);case 5:return this.O(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 6:return this.oa(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);case 7:return this.lb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]);case 8:return this.Ma(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);case 9:return this.ab(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9]);case 10:return this.pb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10]);case 11:return this.gb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11]);case 12:return this.qb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12]);case 13:return this.hb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13]);case 14:return this.rb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14]);case 15:return this.ib(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15]);case 16:return this.sb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16]);case 17:return this.jb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17]);case 18:return this.tb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18]);case 19:return this.kb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19]);case 20:return this.ub(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19],arguments[20]);case 21:return this.Sc(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19],arguments[20],arguments[21]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.A=function(){var e=this.v.A?this.v.A():this.v.call(null);return e.A?e.A():e.call(null)},h.g=function(e){var t=this.v.A?this.v.A():this.v.call(null);return t.g?t.g(e):t.call(null,e)},h.h=function(e,t){var n=this.v.A?this.v.A():this.v.call(null);return n.h?n.h(e,t):n.call(null,e,t)},h.j=function(e,t,n){var r=this.v.A?this.v.A():this.v.call(null);return r.j?r.j(e,t,n):r.call(null,e,t,n)},h.F=function(e,t,n,r){var i=this.v.A?this.v.A():this.v.call(null);return i.F?i.F(e,t,n,r):i.call(null,e,t,n,r)},h.O=function(e,t,n,r,i){var o=this.v.A?this.v.A():this.v.call(null);return o.O?o.O(e,t,n,r,i):o.call(null,e,t,n,r,i)},h.oa=function(e,t,n,r,i,o){var l=this.v.A?this.v.A():this.v.call(null);return l.oa?l.oa(e,t,n,r,i,o):l.call(null,e,t,n,r,i,o)},h.lb=function(e,t,n,r,i,o,l){var s=this.v.A?this.v.A():this.v.call(null);return s.lb?s.lb(e,t,n,r,i,o,l):s.call(null,e,t,n,r,i,o,l)},h.Ma=function(e,t,n,r,i,o,l,s){var a=this.v.A?this.v.A():this.v.call(null);return a.Ma?a.Ma(e,t,n,r,i,o,l,s):a.call(null,e,t,n,r,i,o,l,s)},h.ab=function(e,t,n,r,i,o,l,s,a){var u=this.v.A?this.v.A():this.v.call(null);return u.ab?u.ab(e,t,n,r,i,o,l,s,a):u.call(null,e,t,n,r,i,o,l,s,a)},h.pb=function(e,t,n,r,i,o,l,s,a,u){var c=this.v.A?this.v.A():this.v.call(null);return c.pb?c.pb(e,t,n,r,i,o,l,s,a,u):c.call(null,e,t,n,r,i,o,l,s,a,u)},h.gb=function(e,t,n,r,i,o,l,s,a,u,c){var h=this.v.A?this.v.A():this.v.call(null);return h.gb?h.gb(e,t,n,r,i,o,l,s,a,u,c):h.call(null,e,t,n,r,i,o,l,s,a,u,c)},h.qb=function(e,t,n,r,i,o,l,s,a,u,c,h){var d=this.v.A?this.v.A():this.v.call(null);return d.qb?d.qb(e,t,n,r,i,o,l,s,a,u,c,h):d.call(null,e,t,n,r,i,o,l,s,a,u,c,h)},h.hb=function(e,t,n,r,i,o,l,s,a,u,c,h,d){var f=this.v.A?this.v.A():this.v.call(null);return f.hb?f.hb(e,t,n,r,i,o,l,s,a,u,c,h,d):f.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d)},h.rb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f){var p=this.v.A?this.v.A():this.v.call(null);return p.rb?p.rb(e,t,n,r,i,o,l,s,a,u,c,h,d,f):p.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f)},h.ib=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p){var g=this.v.A?this.v.A():this.v.call(null);return g.ib?g.ib(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p):g.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p)},h.sb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g){var w=this.v.A?this.v.A():this.v.call(null);return w.sb?w.sb(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g):w.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g)},h.jb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w){var m=this.v.A?this.v.A():this.v.call(null);return m.jb?m.jb(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w):m.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w)},h.tb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m){var v=this.v.A?this.v.A():this.v.call(null);return v.tb?v.tb(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m):v.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m)},h.kb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v){var y=this.v.A?this.v.A():this.v.call(null);return y.kb?y.kb(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v):y.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v)},h.ub=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y){var b=this.v.A?this.v.A():this.v.call(null);return b.ub?b.ub(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y):b.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y)},h.Sc=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b){var S=this.v.A?this.v.A():this.v.call(null);return Dd.Ge?Dd.Ge(S,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b):Dd.call(null,S,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b)};var x=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};function Jd(e){this.ka=e}function Kd(e){return new Jd(z(e))}function Ld(e,t){this.value=e,this.sd=t,this.Ae=null,this.B=8388672,this.M=0}function Gd(e){var t=e.next();return n(t.done)?null:new Ld(t.value,e)}function Md(e,t){return td(sd(0,rd(e)),t)}function Nd(e){var t=0,n=1;for(e=z(e);;){if(null==e)return Md(n,t);t+=1,n=qd(31,n)+xd(A(e))|0,e=B(e)}}x.g=function(){return!0},x.h=function(e,t){return null==e?null==t:e===t||Hc(e,t)},x.l=function(e,t,n){for(;;){if(!x.h(e,t))return!1;if(!B(n))return x.h(t,A(n));e=t,t=A(n),n=B(n)}},x.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},x.I=2,Jd.prototype.next=function(){if(null!=this.ka){var e=A(this.ka);return this.ka=B(this.ka),{value:e,done:!1}}return{value:null,done:!0}},Ld.prototype.ca=function(){return this},Ld.prototype.Ga=function(){return this.value},Ld.prototype.Ia=function(){return null==this.Ae&&(this.Ae=Gd.g?Gd.g(this.sd):Gd.call(null,this.sd)),this.Ae};var Od=Md(1,0);function Pd(e){var t=0,n=0;for(e=z(e);;){if(null==e)return Md(n,t);t+=1,n=n+xd(A(e))|0,e=B(e)}}var Qd=Md(0,0),a;function Rd(e){return e+1}function Sd(e){this.v=e,this.B=32768,this.M=0}function Td(e){return new Sd(e)}function Ud(e){return e instanceof Sd}function Vd(e){return Ud(e)?Wd.g?Wd.g(e):Wd.call(null,e):e}function Wd(e){return r(e)}function Xd(e,t){var n=e.da(null);if(0===n)return t.A?t.A():t.call(null);for(var i=e.$(null,0),o=1;;){if(!(o<n))return i;var l=e.$(null,o);if(Ud(i=t.h?t.h(i,l):t.call(null,i,l)))return r(i);o+=1}}function Yd(e,t,n){var i=e.da(null),o=n;for(n=0;;){if(!(n<i))return o;var l=e.$(null,n);if(Ud(o=t.h?t.h(o,l):t.call(null,o,l)))return r(o);n+=1}}function Zd(e,t){var n=e.length;if(0===e.length)return t.A?t.A():t.call(null);for(var i=e[0],o=1;;){if(!(o<n))return i;var l=e[o];if(Ud(i=t.h?t.h(i,l):t.call(null,i,l)))return r(i);o+=1}}function $d(e,t,n){var i=e.length,o=n;for(n=0;;){if(!(n<i))return o;var l=e[n];if(Ud(o=t.h?t.h(o,l):t.call(null,o,l)))return r(o);n+=1}}function ae(e,t,n,i){for(var o=e.length;;){if(!(i<o))return n;var l=e[i];if(Ud(n=t.h?t.h(n,l):t.call(null,n,l)))return r(n);i+=1}}function be(e){return null!=e?!!(2&e.B||cb===e.Cg)||!e.B&&Cb(Qb,e):Cb(Qb,e)}function ce(e){return null!=e?!!(16&e.B||cb===e.Af)||!e.B&&Cb(Yb,e):Cb(Yb,e)}function de(e,t,n){var r=C.g?C.g(e):C.call(null,e);if(n>=r)return-1;for(!(0<n)&&0>n&&(n=0>(n+=r)?0:n);;){if(!(n<r))return-1;if(x.h(ee?ee(e,n):fe.call(null,e,n),t))return n;n+=1}}function ge(e,t,n){var r=C.g?C.g(e):C.call(null,e);if(0===r)return-1;for(0<n?n=--r<n?r:n:n=0>n?r+n:n;;){if(!(0<=n))return-1;if(x.h(ee?ee(e,n):fe.call(null,e,n),t))return n;--n}}function he(e,t){this.o=e,this.N=t}function Fd(e,t,n){this.o=e,this.N=t,this.K=n,this.B=166592766,this.M=139264}function D(e){return 0<e.length?new Fd(e,0,null):null}function ie(e,t,n){this.ae=e,this.N=t,this.K=n,this.B=32374990,this.M=8192}function oe(e){return A(B(e))}function pe(e){return A(B(e))}function qe(e){for(;;){var t=B(e);if(null==t)return A(e);e=t}}Qb.null=!0,Tb.null=function(){return 0},Date.prototype.aa=function(e,t){return t instanceof Date&&this.valueOf()===t.valueOf()},Date.prototype.Nc=cb,Date.prototype.Tb=function(e,t){if(t instanceof Date)return Oa(this.valueOf(),t.valueOf());throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},Hc.number=function(e,t){return e===t},Ob.function=!0,yc.function=!0,zc.function=function(){return null},Ic._=function(e){return fa(e)},Sd.prototype.Jb=function(){return this.v},he.prototype.ua=function(){return this.N<this.o.length},he.prototype.next=function(){var e=this.o[this.N];return this.N+=1,e},h=Fd.prototype,h.toString=function(){return pd(this)},h.indexOf=(a=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},a.g=function(e){return de(this,e,0)},a.h=function(e,t){return de(this,e,t)},a),h.lastIndexOf=function(){function e(e){return ge(this,e,C.g?C.g(this):C.call(null,this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.$=function(e,t){if(0<=(e=t+this.N)&&e<this.o.length)return this.o[e];throw Error("Index out of bounds")},h.Ba=function(e,t,n){return 0<=(e=t+this.N)&&e<this.o.length?this.o[e]:n},h.xa=function(){return new he(this.o,this.N)},h.R=function(){return this.K},h.Aa=function(){return this.N+1<this.o.length?new Fd(this.o,this.N+1,null):null},h.da=function(){var e=this.o.length-this.N;return 0>e?0:e},h.Ac=function(){var e=this.da(null);return 0<e?new ie(this,e-1,null):null},h.ba=function(){return Nd(this)},h.aa=function(e,t){return je.h?je.h(this,t):je.call(null,this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return ae(this.o,t,this.o[this.N],this.N+1)},h.Fa=function(e,t,n){return ae(this.o,t,n,this.N)},h.Ga=function(){return this.o[this.N]},h.Ia=function(){return this.N+1<this.o.length?new Fd(this.o,this.N+1,null):Id},h.ca=function(){return this.N<this.o.length?this:null},h.S=function(e,t){return t===this.K?this:new Fd(this.o,this.N,t)},h.ia=function(e,t){return ke.h?ke.h(t,this):ke.call(null,t,this)},Fd.prototype[Gb]=function(){return Kd(this)},h=ie.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C.g?C.g(this):C.call(null,this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){return 0<this.N?new ie(this.ae,this.N-1,null):null},h.da=function(){return this.N+1},h.ba=function(){return Nd(this)},h.aa=function(e,t){return je.h?je.h(this,t):je.call(null,this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le?le(t,this):me.call(null,t,this)},h.Fa=function(e,t,n){return ne?ne(t,n,this):me.call(null,t,n,this)},h.Ga=function(){return Zb(this.ae,this.N)},h.Ia=function(){return 0<this.N?new ie(this.ae,this.N-1,null):Id},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new ie(this.ae,this.N,t)},h.ia=function(e,t){return ke.h?ke.h(t,this):ke.call(null,t,this)},ie.prototype[Gb]=function(){return Kd(this)},Hc._=function(e,t){return e===t};var re=function e(t){switch(arguments.length){case 0:return e.A();case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};function te(e){return null==e?null:null!=e&&(4&e.B||cb===e.Eg)?e.sa(null):(null!=e?4&e.B||cb===e.Eg||!e.B&&Cb(Ub,e):Cb(Ub,e))?Vb(e):null}function C(e){if(null!=e)if(null!=e&&(2&e.B||cb===e.Cg))e=e.da(null);else if(wb(e))e=e.length;else if("string"==typeof e)e=e.length;else if(null!=e&&(8388608&e.B||cb===e.Bf))e:{e=z(e);for(var t=0;;){if(be(e)){e=t+Tb(e);break e}e=B(e),t+=1}}else e=Tb(e);else e=0;return e}function ue(e,t,n){for(;;){if(null==e)return n;if(0===t)return z(e)?A(e):n;if(ce(e))return Zb(e,t,n);if(!z(e))return n;e=B(e),--t}}function fe(e){switch(arguments.length){case 2:return ee(arguments[0],arguments[1]);case 3:return G(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function ee(e,t){if("number"!=typeof t)throw Error("Index argument to nth must be a number");if(null==e)return e;if(null!=e&&(16&e.B||cb===e.Af))return e.$(null,t);if(wb(e)){if(-1<t&&t<e.length)return e[0|t];throw Error("Index out of bounds")}if("string"==typeof e){if(-1<t&&t<e.length)return e.charAt(0|t);throw Error("Index out of bounds")}if(null!=e&&(64&e.B||cb===e.hd)||null!=e&&(16777216&e.B||cb===e.Je)){if(0>t)throw Error("Index out of bounds");e:for(;;){if(null==e)throw Error("Index out of bounds");if(0===t){if(z(e)){e=A(e);break e}throw Error("Index out of bounds")}if(ce(e)){e=Zb(e,t);break e}if(!z(e))throw Error("Index out of bounds");e=B(e),--t}return e}if(Cb(Yb,e))return Zb(e,t);throw Error(["nth not supported on this type ",p.g(Fb(Db(e)))].join(""))}function G(e,t,n){if("number"!=typeof t)throw Error("Index argument to nth must be a number.");if(null==e)return n;if(null!=e&&(16&e.B||cb===e.Af))return e.Ba(null,t,n);if(wb(e))return-1<t&&t<e.length?e[0|t]:n;if("string"==typeof e)return-1<t&&t<e.length?e.charAt(0|t):n;if(null!=e&&(64&e.B||cb===e.hd)||null!=e&&(16777216&e.B||cb===e.Je))return 0>t?n:ue(e,t,n);if(Cb(Yb,e))return Zb(e,t,n);throw Error(["nth not supported on this type ",p.g(Fb(Db(e)))].join(""))}re.A=function(){return F},re.g=function(e){return e},re.h=function(e,t){return null!=e?Xb(e,t):new se(null,t,null,1,null)},re.l=function(e,t,r){for(;;){if(!n(r))return re.h(e,t);e=re.h(e,t),t=A(r),r=B(r)}},re.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},re.I=2;var u=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};u.h=function(e,t){return null==e?null:null!=e&&(256&e.B||cb===e.Ig)?e.na(null,t):wb(e)?null!=t&&t<e.length?e[0|t]:null:"string"==typeof e?null!=t&&-1<t&&t<e.length?e.charAt(0|t):null:Cb(gc,e)?hc(e,t):null},u.j=function(e,t,n){return null!=e?null!=e&&(256&e.B||cb===e.Ig)?e.P(null,t,n):wb(e)?null!=t&&-1<t&&t<e.length?e[0|t]:n:"string"==typeof e?null!=t&&-1<t&&t<e.length?e.charAt(0|t):n:Cb(gc,e)?hc(e,t,n):n:n},u.I=3;var I=function e(t){if(3===arguments.length)return e.j(arguments[0],arguments[1],arguments[2]);for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],arguments[2],new Fd(n.slice(3),0,null))};I.j=function(e,t,n){return null!=e&&(512&e.B||cb===e.yf)?e.ja(null,t,n):null!=e?lc(e,t,n):ve([t,n])},I.l=function(e,t,r,i){for(;;){if(e=I.j(e,t,r),!n(i))return e;t=A(i),r=oe(i),i=B(B(i))}},I.J=function(e){var t=A(e),n=B(e);e=A(n);var r=B(n);return n=A(r),r=B(r),this.l(t,e,n,r)},I.I=3;var we=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};function xe(e){var t="function"==typeof e;return t||(null!=e?cb===e.xf||!e.Pe&&Cb(Ob,e):Cb(Ob,e))}function ye(e,t){this.T=e,this.K=t,this.B=393217,this.M=0}function ze(e,t){return"function"==typeof e?new ye(e,t):null==e?null:Bc(e,t)}function Ae(e){var t=null!=e;return(t?null!=e?131072&e.B||cb===e.zd||!e.B&&Cb(yc,e):Cb(yc,e):t)?zc(e):null}function Be(e){return null==e?null:tc(e)}function Ce(e){return null==e?null:uc(e)}we.g=function(e){return e},we.h=function(e,t){return null==e?null:oc(e,t)},we.l=function(e,t,r){for(;;){if(null==e)return null;if(e=we.h(e,t),!n(r))return e;t=A(r),r=B(r)}},we.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},we.I=2,h=ye.prototype,h.R=function(){return this.K},h.S=function(e,t){return new ye(this.T,t)},h.xf=cb,h.call=function(e){switch(arguments.length-1){case 0:return this.A();case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);case 3:return this.j(arguments[1],arguments[2],arguments[3]);case 4:return this.F(arguments[1],arguments[2],arguments[3],arguments[4]);case 5:return this.O(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 6:return this.oa(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);case 7:return this.lb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]);case 8:return this.Ma(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);case 9:return this.ab(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9]);case 10:return this.pb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10]);case 11:return this.gb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11]);case 12:return this.qb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12]);case 13:return this.hb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13]);case 14:return this.rb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14]);case 15:return this.ib(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15]);case 16:return this.sb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16]);case 17:return this.jb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17]);case 18:return this.tb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18]);case 19:return this.kb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19]);case 20:return this.ub(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19],arguments[20]);case 21:return this.Sc(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19],arguments[20],arguments[21]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.A=function(){return this.T.A?this.T.A():this.T.call(null)},h.g=function(e){return this.T.g?this.T.g(e):this.T.call(null,e)},h.h=function(e,t){return this.T.h?this.T.h(e,t):this.T.call(null,e,t)},h.j=function(e,t,n){return this.T.j?this.T.j(e,t,n):this.T.call(null,e,t,n)},h.F=function(e,t,n,r){return this.T.F?this.T.F(e,t,n,r):this.T.call(null,e,t,n,r)},h.O=function(e,t,n,r,i){return this.T.O?this.T.O(e,t,n,r,i):this.T.call(null,e,t,n,r,i)},h.oa=function(e,t,n,r,i,o){return this.T.oa?this.T.oa(e,t,n,r,i,o):this.T.call(null,e,t,n,r,i,o)},h.lb=function(e,t,n,r,i,o,l){return this.T.lb?this.T.lb(e,t,n,r,i,o,l):this.T.call(null,e,t,n,r,i,o,l)},h.Ma=function(e,t,n,r,i,o,l,s){return this.T.Ma?this.T.Ma(e,t,n,r,i,o,l,s):this.T.call(null,e,t,n,r,i,o,l,s)},h.ab=function(e,t,n,r,i,o,l,s,a){return this.T.ab?this.T.ab(e,t,n,r,i,o,l,s,a):this.T.call(null,e,t,n,r,i,o,l,s,a)},h.pb=function(e,t,n,r,i,o,l,s,a,u){return this.T.pb?this.T.pb(e,t,n,r,i,o,l,s,a,u):this.T.call(null,e,t,n,r,i,o,l,s,a,u)},h.gb=function(e,t,n,r,i,o,l,s,a,u,c){return this.T.gb?this.T.gb(e,t,n,r,i,o,l,s,a,u,c):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c)},h.qb=function(e,t,n,r,i,o,l,s,a,u,c,h){return this.T.qb?this.T.qb(e,t,n,r,i,o,l,s,a,u,c,h):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h)},h.hb=function(e,t,n,r,i,o,l,s,a,u,c,h,d){return this.T.hb?this.T.hb(e,t,n,r,i,o,l,s,a,u,c,h,d):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d)},h.rb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f){return this.T.rb?this.T.rb(e,t,n,r,i,o,l,s,a,u,c,h,d,f):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f)},h.ib=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p){return this.T.ib?this.T.ib(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p)},h.sb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g){return this.T.sb?this.T.sb(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g)},h.jb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w){return this.T.jb?this.T.jb(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w)},h.tb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m){return this.T.tb?this.T.tb(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m)},h.kb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v){return this.T.kb?this.T.kb(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v)},h.ub=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y){return this.T.ub?this.T.ub(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y):this.T.call(null,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y)},h.Sc=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b){return Dd.Ge?Dd.Ge(this.T,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b):Dd.call(null,this.T,e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b)};var De=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};function Ee(e){return null==e||yb(z(e))}function Fe(e){return null!=e&&(null!=e?!!(8&e.B||cb===e.li)||!e.B&&Cb(Wb,e):Cb(Wb,e))}function Ge(e){return null!=e&&(null!=e?!!(4096&e.B||cb===e.xi)||!e.B&&Cb(rc,e):Cb(rc,e))}function He(e){return null!=e?!!(512&e.B||cb===e.yf)||!e.B&&Cb(jc,e):Cb(jc,e)}function Ie(e){return null!=e?!!(16777216&e.B||cb===e.Je)||!e.B&&Cb(Lc,e):Cb(Lc,e)}function J(e){return null!=e&&(null!=e?!!(1024&e.B||cb===e.ti)||!e.B&&Cb(nc,e):Cb(nc,e))}function Ke(e){return null!=e?!!(67108864&e.B||cb===e.Lg)||!e.B&&Cb(Nc,e):Cb(Nc,e)}function Le(e){return null!=e?!!(16384&e.B||cb===e.yi)||!e.B&&Cb(vc,e):Cb(vc,e)}function Me(e){return null!=e&&!!(512&e.M||cb===e.ki)}function Ne(e,t,n,r,i){for(;;){if(0===i)return n;n[r]=e[t],r+=1,--i,t+=1}}De.g=function(e){return e},De.h=function(e,t){return null==e?null:sc(e,t)},De.l=function(e,t,r){for(;;){if(null==e)return null;if(e=De.h(e,t),!n(r))return e;t=A(r),r=B(r)}},De.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},De.I=2;var Oe={};function Pe(e){return!0===e||!1===e}function Qe(e){return null!=e&&(null!=e?!!(64&e.B||cb===e.hd)||!e.B&&Cb(ac,e):Cb(ac,e))}function Re(e){return null!=e&&!1!==e}function Se(e){return"number"==typeof e&&!isNaN(e)&&1/0!==e&&parseFloat(e)===parseInt(e,10)}function Te(e){return Se(e)||e instanceof qa}function M(e,t){return null!=e&&(512&e.B||cb===e.yf)?e.za(null,t):Cb(jc,e)?kc(e,t):u.j(e,t,Oe)!==Oe}function Ue(e,t){if(e===t)return 0;if(null==e)return-1;if(null==t)return 1;if("number"==typeof e){if("number"==typeof t)return Oa(e,t);throw Error(["Cannot compare ",p.g(e)," to ",p.g(t)].join(""))}if(null!=e?2048&e.M||cb===e.Nc||!e.M&&Cb(bd,e):Cb(bd,e))return cd(e,t);if("string"!=typeof e&&!wb(e)&&!0!==e&&!1!==e||Db(e)!==Db(t))throw Error(["Cannot compare ",p.g(e)," to ",p.g(t)].join(""));return Oa(e,t)}function Ve(e,t){var n=C(e),r=C(t);if(n<r)e=-1;else if(n>r)e=1;else if(0===n)e=0;else e:for(r=0;;){var i=Ue(ee(e,r),ee(t,r));if(!(0===i&&r+1<n)){e=i;break e}r+=1}return e}function We(e){return x.h(e,Ue)?Ue:function(t,r){var i=e.h?e.h(t,r):e.call(null,t,r);return"number"==typeof i?i:n(i)?-1:n(e.h?e.h(r,t):e.call(null,r,t))?1:0}}function Xe(e){var t=Ga(Jb);if(z(t)){var n=Ye.g?Ye.g(t):Ye.call(null,t);return Pa(n,We(e)),ze(z(n),Ae(t))}return Id}function me(e){switch(arguments.length){case 2:return le(arguments[0],arguments[1]);case 3:return ne(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function le(e,t){var n=z(t);return n?(t=A(n),n=B(n),Nb.j?Nb.j(e,t,n):Nb.call(null,e,t,n)):e.A?e.A():e.call(null)}function ne(e,t,n){for(n=z(n);;){if(!n)return t;var i=A(n);if(Ud(t=e.h?e.h(t,i):e.call(null,t,i)))return r(t);n=B(n)}}function Ze(e,t){if(!n((e=nd(e)).ua()))return t.A?t.A():t.call(null);for(var i=e.next();;){if(!e.ua())return i;var o=e.next();if(Ud(i=t.h?t.h(i,o):t.call(null,i,o)))return r(i)}}function $e(e,t,n){for(e=nd(e);;){if(!e.ua())return n;var i=e.next();if(Ud(n=t.h?t.h(n,i):t.call(null,n,i)))return r(n)}}var Nb=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function af(e,t,n){return null!=n?Gc(n,e,t):t}function bf(e){return e}function cf(e,t){return function(){function n(t,n){return e.h?e.h(t,n):e.call(null,t,n)}function r(e){return t.g?t.g(e):t.call(null,e)}function i(){return e.A?e.A():e.call(null)}var o;return o=function(e,t){switch(arguments.length){case 0:return i.call(this);case 1:return r.call(this,e);case 2:return n.call(this,e,t)}throw Error("Invalid arity: "+arguments.length)},o.A=i,o.g=r,o.h=n,o}()}function df(e,t,n){return ef(e,t,t.A?t.A():t.call(null),n)}function ef(e,t,n,r){return e=e.g?e.g(t):e.call(null,t),n=Nb.j(e,n,r),e.g?e.g(n):e.call(null,n)}Nb.h=function(e,t){return null!=t&&(524288&t.B||cb===t.Mg)?t.Ea(null,e):wb(t)||"string"==typeof t?Zd(t,e):Cb(Cc,t)?Dc(t,e):Ed(t)?Ze(t,e):le(e,t)},Nb.j=function(e,t,n){return null!=n&&(524288&n.B||cb===n.Mg)?n.Fa(null,e,t):wb(n)||"string"==typeof n?$d(n,e,t):Cb(Cc,n)?Dc(n,e,t):Ed(n)?$e(n,e,t):ne(e,t,n)},Nb.I=3;var ff=function e(t){switch(arguments.length){case 0:return e.A();case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};ff.A=function(){return 0},ff.g=function(e){return e},ff.h=function(e,t){return e+t},ff.l=function(e,t,n){return Nb.j(ff,e+t,n)},ff.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},ff.I=2;var gf=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};function hf(e){if("number"==typeof e)return String.fromCharCode(e);if("string"==typeof e&&1===e.length)return e;throw Error("Argument to char must be a character or number")}function jf(e){return 0<=e?Math.floor(e):Math.ceil(e)}function kf(e,t){return jf((e-e%t)/t)}function lf(e,t){return e-t*kf(e,t)}function mf(e){return 16843009*((e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135)>>24}function nf(e){switch(arguments.length){case 1:return!0;case 2:return Hc(arguments[0],arguments[1]);default:for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;e:for(n=arguments[0],r=arguments[1],t=new Fd(t.slice(2),0,null);;){if(n!==r){n=!1;break e}if(!B(t)){n=r===A(t);break e}n=r,r=A(t),t=B(t)}return n}}function of(e,t){return Hc(e,t)}function pf(e){return 0<e}gf.g=function(){return!0},gf.h=function(e,t){return e>t},gf.l=function(e,t,n){for(;;){if(!(e>t))return!1;if(!B(n))return t>A(n);e=t,t=A(n),n=B(n)}},gf.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},gf.I=2;var p=function e(t){switch(arguments.length){case 0:return e.A();case 1:return e.g(arguments[0]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],new Fd(n.slice(1),0,null))}};function qf(e){switch(arguments.length){case 2:return arguments[0].substring(arguments[1]);case 3:return arguments[0].substring(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function rf(e,t){return e.substring(t)}function sf(e,t,n){return e.substring(t,n)}function je(e,t){if(Ie(t))if(be(e)&&be(t)&&C(e)!==C(t))e=!1;else e:for(e=z(e),t=z(t);;){if(null==e){e=null==t;break e}if(null==t||!x.h(A(e),A(t))){e=!1;break e}e=B(e),t=B(t)}else e=null;return Re(e)}function se(e,t,n,r,i){this.K=e,this.first=t,this.fb=n,this.count=r,this.G=i,this.B=65937646,this.M=8192}function tf(e){return null!=e?!!(33554432&e.B||cb===e.si)||!e.B&&Cb(Mc,e):Cb(Mc,e)}function uf(e){this.K=e,this.B=65937614,this.M=8192}p.A=function(){return""},p.g=function(e){return null==e?"":[e].join("")},p.l=function(e,t){for(e=new Za(p.g(e));;){if(!n(t))return e.toString();e=e.append(p.g(A(t))),t=B(t)}},p.J=function(e){var t=A(e);return e=B(e),this.l(t,e)},p.I=1,h=se.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,this.count)}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){return 1===this.count?null:this.fb},h.da=function(){return this.count},h.Ub=function(){return this.first},h.Vb=function(){return this.Ia(null)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Bc(Id,this.K)},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return this.first},h.Ia=function(){return 1===this.count?Id:this.fb},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new se(t,this.first,this.fb,this.count,this.G)},h.ia=function(e,t){return new se(this.K,t,this,this.count+1,null)},se.prototype[Gb]=function(){return Kd(this)},h=uf.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){return null},h.da=function(){return 0},h.Ub=function(){return null},h.Vb=function(){throw Error("Can't pop empty list")},h.ba=function(){return Od},h.aa=function(e,t){return!(!tf(t)&&!Ie(t))&&null==z(t)},h.sa=function(){return this},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return null},h.Ia=function(){return Id},h.ca=function(){return null},h.S=function(e,t){return t===this.K?this:new uf(t)},h.ia=function(e,t){return new se(this.K,t,null,1,null)};var Id=new uf(null);function vf(e){return(null!=e?134217728&e.B||cb===e.wi||!e.B&&Cb(Oc,e):Cb(Oc,e))?(e=Pc(e))?e:Id:Nb.j(re,Id,e)}uf.prototype[Gb]=function(){return Kd(this)};var N=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};function wf(e,t,n,r){this.K=e,this.first=t,this.fb=n,this.G=r,this.B=65929452,this.M=8192}function ke(e,t){return null==t?new se(null,e,null,1,null):null!=t&&(64&t.B||cb===t.hd)?new wf(null,e,t,null):new wf(null,e,z(t),null)}function xf(e,t){if(e.W===t.W)return 0;var r=yb(e.yb);return n(r?t.yb:r)?-1:n(e.yb)?yb(t.yb)?1:0===(r=Oa(e.yb,t.yb))?Oa(e.name,t.name):r:Oa(e.name,t.name)}function w(e,t,n,r){this.yb=e,this.name=t,this.W=n,this.ed=r,this.B=2153775105,this.M=4096}function yf(e){return e instanceof w}function O(e,t){return e===t||e instanceof w&&t instanceof w&&e.W===t.W}function zf(e){if(null!=e&&(4096&e.M||cb===e.Kg))return e.Bd(null);throw Error(["Doesn't support namespace: ",p.g(e)].join(""))}function Af(e){return e instanceof w||e instanceof Ad}N.l=function(e){if(e instanceof Fd&&0===e.N)var t=e.o;else e:for(t=[];null!=e;)t.push(bc(e)),e=fc(e);e=t.length;for(var n=Id;;){if(!(0<e))return n;var r=e-1;n=Xb(n,t[e-1]),e=r}},N.I=0,N.J=function(e){return this.l(z(e))},h=wf.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){return null==this.fb?null:z(this.fb)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return this.first},h.Ia=function(){return null==this.fb?Id:this.fb},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new wf(t,this.first,this.fb,this.G)},h.ia=function(e,t){return new wf(null,t,this,null)},wf.prototype[Gb]=function(){return Kd(this)},h=w.prototype,h.toString=function(){return[":",p.g(this.W)].join("")},h.aa=function(e,t){return t instanceof w&&this.W===t.W},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return u.h(e,this)},h.h=function(e,t){return u.j(e,this,t)},h.ba=function(){var e=this.ed;return null!=e?e:this.ed=e=yd(this)+2654435769|0},h.Ad=function(){return this.name},h.Bd=function(){return this.yb},h.U=function(e,t){return Qc(t,[":",p.g(this.W)].join(""))};var Bf=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function Df(e,t,n,r){this.K=e,this.od=t,this.ka=n,this.G=r,this.B=32374988,this.M=1}function Ef(e){return null!=e.od&&(e.ka=e.od.A?e.od.A():e.od.call(null),e.od=null),e.ka}function Ff(e){this.ga=e,this.end=0,this.B=2,this.M=0}function Hf(e){return new Ff(Array(e))}function Gf(e,t,n){this.o=e,this.eb=t,this.end=n,this.B=524306,this.M=0}function If(e,t,n,r){this.Oa=e,this.jc=t,this.K=n,this.G=r,this.B=31850732,this.M=1536}function Jf(e,t){return 0===Tb(e)?t:new If(e,t,null,null)}function Kf(e,t){e.add(t)}function Lf(e){return e.Oa()}function Ye(e){var t=[];for(e=z(e);;){if(null==e)return t;t.push(A(e)),e=B(e)}}function Mf(e,t){if(be(t))return C(t);var n=0;for(t=z(t);;){if(!(null!=t&&n<e))return n;n+=1,t=B(t)}}Bf.g=function(e){if(e instanceof w)return e;if(e instanceof Ad)return new w(zf(e),Cf.g?Cf.g(e):Cf.call(null,e),e.uc,null);if(x.h("/",e))return new w(null,e,e,null);if("string"==typeof e){var t=e.split("/");return 2===t.length?new w(t[0],t[1],e,null):new w(null,t[0],e,null)}return null},Bf.h=function(e,t){return new w(e=e instanceof w||e instanceof Ad?Cf.g?Cf.g(e):Cf.call(null,e):e,t=t instanceof w||t instanceof Ad?Cf.g?Cf.g(t):Cf.call(null,t):t,[n(e)?[p.g(e),"/"].join(""):null,p.g(t)].join(""),null)},Bf.I=2,h=Df.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){return this.ca(null),null==this.ka?null:B(this.ka)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Bc(Id,this.K)},h.Dd=function(){return yb(this.od)},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return this.ca(null),null==this.ka?null:A(this.ka)},h.Ia=function(){return this.ca(null),null!=this.ka?Hd(this.ka):Id},h.ca=function(){if(Ef(this),null==this.ka)return null;for(var e=this.ka;;){if(!(e instanceof Df))return this.ka=e,z(this.ka);e=Ef(e)}},h.S=function(e,t){var n=this;return t===this.K?n:new Df(t,(function(){return n.ca(null)}),null,this.G)},h.ia=function(e,t){return ke(t,this)},Df.prototype[Gb]=function(){return Kd(this)},Ff.prototype.add=function(e){return this.ga[this.end]=e,this.end+=1},Ff.prototype.Oa=function(){var e=new Gf(this.ga,0,this.end);return this.ga=null,e},Ff.prototype.da=function(){return this.end},h=Gf.prototype,h.da=function(){return this.end-this.eb},h.$=function(e,t){return this.o[this.eb+t]},h.Ba=function(e,t,n){return 0<=t&&t<this.end-this.eb?this.o[this.eb+t]:n},h.Fe=function(){if(this.eb===this.end)throw Error("-drop-first of empty chunk");return new Gf(this.o,this.eb+1,this.end)},h.Ea=function(e,t){return ae(this.o,t,this.o[this.eb],this.eb+1)},h.Fa=function(e,t,n){return ae(this.o,t,n,this.eb)},h=If.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){return 1<Tb(this.Oa)?new If(dd(this.Oa),this.jc,null,null):null==this.jc?null:Kc(this.jc)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ga=function(){return Zb(this.Oa,0)},h.Ia=function(){return 1<Tb(this.Oa)?new If(dd(this.Oa),this.jc,null,null):null==this.jc?Id:this.jc},h.ca=function(){return this},h.yd=function(){return this.Oa},h.Mc=function(){return null==this.jc?Id:this.jc},h.S=function(e,t){return t===this.K?this:new If(this.Oa,this.jc,t,this.G)},h.ia=function(e,t){return ke(t,this)},h.be=function(){return null==this.jc?null:this.jc},If.prototype[Gb]=function(){return Kd(this)};var Nf=function e(t){if(null==t)return null;var n=B(t);return null==n?z(A(t)):ke(A(t),e.g?e.g(n):e.call(null,n))},Of=function e(t){switch(arguments.length){case 0:return e.A();case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};Of.A=function(){return new Df(null,(function(){return null}),null,null)},Of.g=function(e){return new Df(null,(function(){return e}),null,null)},Of.h=function(e,t){return new Df(null,(function(){var n=z(e);return n?Me(n)?Jf(ed(n),Of.h(fd(n),t)):ke(A(n),Of.h(Hd(n),t)):t}),null,null)},Of.l=function(e,t,r){return function e(t,r){return new Df(null,(function(){var i=z(t);return i?Me(i)?Jf(ed(i),e(fd(i),r)):ke(A(i),e(Hd(i),r)):n(r)?e(A(r),B(r)):null}),null,null)}(Of.h(e,t),r)},Of.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},Of.I=2;var Pf=function e(t){switch(arguments.length){case 0:return e.A();case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};function Qf(e,t,n){return $c(e,t,n)}function Rf(e,t,n){var r=z(n);if(0===t)return e.A?e.A():e.call(null);n=bc(r);var i=cc(r);if(1===t)return e.g?e.g(n):e.call(null,n);r=bc(i);var o=cc(i);if(2===t)return e.h?e.h(n,r):e.call(null,n,r);i=bc(o);var l=cc(o);if(3===t)return e.j?e.j(n,r,i):e.call(null,n,r,i);o=bc(l);var s=cc(l);if(4===t)return e.F?e.F(n,r,i,o):e.call(null,n,r,i,o);l=bc(s);var a=cc(s);if(5===t)return e.O?e.O(n,r,i,o,l):e.call(null,n,r,i,o,l);s=bc(a);var u=cc(a);if(6===t)return e.oa?e.oa(n,r,i,o,l,s):e.call(null,n,r,i,o,l,s);a=bc(u);var c=cc(u);if(7===t)return e.lb?e.lb(n,r,i,o,l,s,a):e.call(null,n,r,i,o,l,s,a);u=bc(c);var h=cc(c);if(8===t)return e.Ma?e.Ma(n,r,i,o,l,s,a,u):e.call(null,n,r,i,o,l,s,a,u);c=bc(h);var d=cc(h);if(9===t)return e.ab?e.ab(n,r,i,o,l,s,a,u,c):e.call(null,n,r,i,o,l,s,a,u,c);h=bc(d);var f=cc(d);if(10===t)return e.pb?e.pb(n,r,i,o,l,s,a,u,c,h):e.call(null,n,r,i,o,l,s,a,u,c,h);d=bc(f);var p=cc(f);if(11===t)return e.gb?e.gb(n,r,i,o,l,s,a,u,c,h,d):e.call(null,n,r,i,o,l,s,a,u,c,h,d);f=bc(p);var g=cc(p);if(12===t)return e.qb?e.qb(n,r,i,o,l,s,a,u,c,h,d,f):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f);p=bc(g);var w=cc(g);if(13===t)return e.hb?e.hb(n,r,i,o,l,s,a,u,c,h,d,f,p):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f,p);g=bc(w);var m=cc(w);if(14===t)return e.rb?e.rb(n,r,i,o,l,s,a,u,c,h,d,f,p,g):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f,p,g);w=bc(m);var v=cc(m);if(15===t)return e.ib?e.ib(n,r,i,o,l,s,a,u,c,h,d,f,p,g,w):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w);m=bc(v);var y=cc(v);if(16===t)return e.sb?e.sb(n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m);v=bc(y);var b=cc(y);if(17===t)return e.jb?e.jb(n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v);y=bc(b);var S=cc(b);if(18===t)return e.tb?e.tb(n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y);if(b=bc(S),S=cc(S),19===t)return e.kb?e.kb(n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b);var $=bc(S);if(cc(S),20===t)return e.ub?e.ub(n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b,$):e.call(null,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b,$);throw Error("Only up to 20 arguments supported on functions")}function Sf(e){return null!=e&&(128&e.B||cb===e.Cd)?e.Aa(null):z(Hd(e))}function Tf(e,t,n){return null==n?e.g?e.g(t):e.call(e,t):Uf(e,t,bc(n),Sf(n))}function Uf(e,t,n,r){return null==r?e.h?e.h(t,n):e.call(e,t,n):Vf(e,t,n,bc(r),Sf(r))}function Vf(e,t,n,r,i){return null==i?e.j?e.j(t,n,r):e.call(e,t,n,r):Wf(e,t,n,r,bc(i),Sf(i))}function Wf(e,t,n,r,i,o){if(null==o)return e.F?e.F(t,n,r,i):e.call(e,t,n,r,i);var l=bc(o),s=B(o);if(null==s)return e.O?e.O(t,n,r,i,l):e.call(e,t,n,r,i,l);o=bc(s);var a=B(s);if(null==a)return e.oa?e.oa(t,n,r,i,l,o):e.call(e,t,n,r,i,l,o);s=bc(a);var u=B(a);if(null==u)return e.lb?e.lb(t,n,r,i,l,o,s):e.call(e,t,n,r,i,l,o,s);a=bc(u);var c=B(u);if(null==c)return e.Ma?e.Ma(t,n,r,i,l,o,s,a):e.call(e,t,n,r,i,l,o,s,a);u=bc(c);var h=B(c);if(null==h)return e.ab?e.ab(t,n,r,i,l,o,s,a,u):e.call(e,t,n,r,i,l,o,s,a,u);c=bc(h);var d=B(h);if(null==d)return e.pb?e.pb(t,n,r,i,l,o,s,a,u,c):e.call(e,t,n,r,i,l,o,s,a,u,c);h=bc(d);var f=B(d);if(null==f)return e.gb?e.gb(t,n,r,i,l,o,s,a,u,c,h):e.call(e,t,n,r,i,l,o,s,a,u,c,h);d=bc(f);var p=B(f);if(null==p)return e.qb?e.qb(t,n,r,i,l,o,s,a,u,c,h,d):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d);f=bc(p);var g=B(p);if(null==g)return e.hb?e.hb(t,n,r,i,l,o,s,a,u,c,h,d,f):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d,f);p=bc(g);var w=B(g);if(null==w)return e.rb?e.rb(t,n,r,i,l,o,s,a,u,c,h,d,f,p):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d,f,p);g=bc(w);var m=B(w);if(null==m)return e.ib?e.ib(t,n,r,i,l,o,s,a,u,c,h,d,f,p,g):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d,f,p,g);w=bc(m);var v=B(m);if(null==v)return e.sb?e.sb(t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w);m=bc(v);var y=B(v);if(null==y)return e.jb?e.jb(t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m);v=bc(y);var b=B(y);if(null==b)return e.tb?e.tb(t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m,v):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m,v);y=bc(b);var S=B(b);if(null==S)return e.kb?e.kb(t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m,v,y):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m,v,y);if(b=bc(S),null==(S=B(S)))return e.ub?e.ub(t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m,v,y,b):e.call(e,t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m,v,y,b);for(t=[t,n,r,i,l,o,s,a,u,c,h,d,f,p,g,w,m,v,y,b],n=S;n;)t.push(bc(n)),n=B(n);return e.apply(e,t)}function Dd(e){switch(arguments.length){case 2:return Xf(arguments[0],arguments[1]);case 3:return Yf(arguments[0],arguments[1],arguments[2]);case 4:return Zf(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return $f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;return ag(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],new Fd(t.slice(5),0,null))}}function Xf(e,t){if(e.J){var n=e.I,r=Mf(n+1,t);return r<=n?Rf(e,r,t):e.J(t)}return null==(t=z(t))?e.A?e.A():e.call(e):Tf(e,bc(t),Sf(t))}function Yf(e,t,n){if(e.J){t=ke(t,n);var r=e.I;return(n=Mf(r,n)+1)<=r?Rf(e,n,t):e.J(t)}return Tf(e,t,z(n))}function Zf(e,t,n,r){return e.J?(t=ke(t,ke(n,r)),(r=2+Mf((n=e.I)-1,r))<=n?Rf(e,r,t):e.J(t)):Uf(e,t,n,z(r))}function $f(e,t,n,r,i){return e.J?(t=ke(t,ke(n,ke(r,i))),(i=3+Mf((n=e.I)-2,i))<=n?Rf(e,i,t):e.J(t)):Vf(e,t,n,r,z(i))}function ag(e,t,n,r,i,o){return e.J?(t=ke(t,ke(n,ke(r,ke(i,o=Nf(o))))),(o=4+Mf((n=e.I)-3,o))<=n?Rf(e,o,t):e.J(t)):Wf(e,t,n,r,i,Nf(o))}function bg(e){return null!=e&&(64&e.B||cb===e.hd)?B(e)?ve(Ye(e)):z(e)?A(e):P:e}Pf.A=function(){return Xc(F)},Pf.g=function(e){return e},Pf.h=function(e,t){return Yc(e,t)},Pf.l=function(e,t,r){for(;;){if(e=Yc(e,t),!n(r))return e;t=A(r),r=B(r)}},Pf.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},Pf.I=2;var cg=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};function dg(e){return z(e)?e:null}function eg(){return void 0!==$a&&void 0!==ab&&void 0!==bb||(bb=function(e){this.Kh=e,this.B=393216,this.M=0},bb.prototype.S=function(e,t){return new bb(t)},bb.prototype.R=function(){return this.Kh},bb.prototype.ua=function(){return!1},bb.prototype.next=function(){return Error("No such element")},bb.prototype.remove=function(){return Error("Unsupported operation")},bb.Na=!0,bb.Ja="cljs.core/t_cljs$core6516",bb.Pa=function(e){return Qc(e,"cljs.core/t_cljs$core6516")}),new bb(P)}function fg(e){this.ka=e,this.N=0}function gg(e){this.o=e,this.N=0}cg.g=function(){return!1},cg.h=function(e,t){return!x.h(e,t)},cg.l=function(e,t,n){return yb(Zf(x,e,t,n))},cg.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},cg.I=2,fg.prototype.ua=function(){return this.N<this.ka.length},fg.prototype.next=function(){var e=this.ka.charAt(this.N);return this.N+=1,e},fg.prototype.remove=function(){return Error("Unsupported operation")},gg.prototype.ua=function(){return this.N<this.o.length},gg.prototype.next=function(){var e=this.o[this.N];return this.N+=1,e},gg.prototype.remove=function(){return Error("Unsupported operation")};var hg={},ig={};function jg(e){this.wd=hg,this.Ib=e}function kg(e){if(Ed(e))return nd(e);if(null==e)return eg();if("string"==typeof e)return new fg(e);if(wb(e))return new gg(e);var t=null==e;if(t||(t=(t=null!=e?!!(8388608&e.B||cb===e.Bf)||!e.B&&Cb(Jc,e):Cb(Jc,e))?t:wb(e)||"string"==typeof e),t)return new jg(e);throw Error(["Cannot create iterator from ",p.g(e)].join(""))}function lg(e){this.ye=e}jg.prototype.ua=function(){return this.wd===hg?(this.wd=ig,this.Ib=z(this.Ib)):this.wd===this.Ib&&(this.Ib=B(this.wd)),null!=this.Ib},jg.prototype.next=function(){if(this.ua())return this.wd=this.Ib,A(this.Ib);throw Error("No such element")},jg.prototype.remove=function(){return Error("Unsupported operation")},lg.prototype.add=function(e){return this.ye.push(e),this},lg.prototype.remove=function(){return this.ye.shift()},lg.prototype.Qd=function(){return 0===this.ye.length},lg.prototype.toString=function(){return["Many: ",p.g(this.ye)].join("")};var mg={};function ng(e){this.v=e}function og(){}ng.prototype.add=function(e){return this.v===mg?(this.v=e,this):new lg([this.v,e])},ng.prototype.remove=function(){if(this.v===mg)throw Error("Removing object from empty buffer");var e=this.v;return this.v=mg,e},ng.prototype.Qd=function(){return this.v===mg},ng.prototype.toString=function(){return["Single: ",p.g(this.v)].join("")},og.prototype.add=function(e){return new ng(e)},og.prototype.remove=function(){throw Error("Removing object from empty buffer")},og.prototype.Qd=function(){return!0},og.prototype.toString=function(){return"Empty"};var pg=new og,qg=function e(t){return new Df(null,(function(){if(!t.ua())return null;for(var r=[],i=0;;){var o=t.ua();if(!n(n(o)?32>i:o))return Jf(new Gf(r,0,i),e.g?e.g(t):e.call(null,t));r[i]=t.next(),i+=1}}),null,null)};function rg(e){this.buffer=pg,this.Ib=mg,this.Se=!1,this.nc=null,this.cf=e,this.Ph=!1}function sg(e,t){var n,r=new rg(t);return r.nc=(n=function(){function e(e,t){return r.buffer=r.buffer.add(t),e}var t;return t=function(t,n){switch(arguments.length){case 0:return null;case 1:return t;case 2:return e.call(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.A=function(){return null},t.g=function(e){return e},t.h=e,t}(),e.g?e.g(n):e.call(null,n)),r}function tg(e){return Qe(e)||(e=z(e))?e:Id}function ug(e,t){for(;;){if(null==z(t))return!0;var r=A(t);if(!n(r=e.g?e.g(r):e.call(null,r)))return!1;t=B(t)}}function vg(e,t){for(;;){if(!(t=z(t)))return null;var r=A(t);if(n(r=e.g?e.g(r):e.call(null,r)))return r;t=B(t)}}function wg(e){if(Se(e))return 0==(1&e);throw Error(["Argument must be an integer: ",p.g(e)].join(""))}function xg(e){return function(){function t(t,n){return yb(e.h?e.h(t,n):e.call(null,t,n))}function n(t){return yb(e.g?e.g(t):e.call(null,t))}function r(){return yb(e.A?e.A():e.call(null))}var i,o=function(){function t(e,t,r){var i=null;if(2<arguments.length){i=0;for(var o=Array(arguments.length-2);i<o.length;)o[i]=arguments[i+2],++i;i=new Fd(o,0,null)}return n.call(this,e,t,i)}function n(t,n,r){return yb(Zf(e,t,n,r))}return t.I=2,t.J=function(e){return n(A(e),A(e=B(e)),e=Hd(e))},t.l=n,t}();return i=function(e,i,l){switch(arguments.length){case 0:return r.call(this);case 1:return n.call(this,e);case 2:return t.call(this,e,i);default:var s=null;if(2<arguments.length){s=0;for(var a=Array(arguments.length-2);s<a.length;)a[s]=arguments[s+2],++s;s=new Fd(a,0,null)}return o.l(e,i,s)}},i.I=2,i.J=o.J,i.A=r,i.g=n,i.h=t,i.l=o.l,i}()}function yg(e){return function(){function t(t){if(0<arguments.length)for(var n=0,r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;return e}return t.I=0,t.J=function(t){return z(t),e},t.l=function(){return e},t}()}rg.prototype.step=function(){if(this.Ib!==mg)return!0;for(;;){if(this.Ib!==mg)return!0;if(this.buffer.Qd()){if(this.Se)return!1;if(this.cf.ua()){if(this.Ph)var e=Xf(this.nc,ke(null,this.cf.next()));else e=this.cf.next(),e=this.nc.h?this.nc.h(null,e):this.nc.call(null,null,e);Ud(e)&&(this.nc.g?this.nc.g(null):this.nc.call(null,null),this.Se=!0)}else this.nc.g?this.nc.g(null):this.nc.call(null,null),this.Se=!0}else this.Ib=this.buffer.remove()}},rg.prototype.ua=function(){return this.step()},rg.prototype.next=function(){if(this.ua()){var e=this.Ib;return this.Ib=mg,e}throw Error("No such element")},rg.prototype.remove=function(){return Error("Unsupported operation")},rg.prototype[Gb]=function(){return Kd(this)};var zg=function e(t){switch(arguments.length){case 0:return e.A();case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],arguments[2],new Fd(n.slice(3),0,null))}};function Ag(e,t){return function(){function n(n,r,i){return e.F?e.F(t,n,r,i):e.call(null,t,n,r,i)}function r(n,r){return e.j?e.j(t,n,r):e.call(null,t,n,r)}function i(n){return e.h?e.h(t,n):e.call(null,t,n)}function o(){return e.g?e.g(t):e.call(null,t)}var l,s=function(){function n(e,t,n,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return r.call(this,e,t,n,o)}function r(n,r,i,o){return ag(e,t,n,r,i,D([o]))}return n.I=3,n.J=function(e){return r(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},n.l=r,n}();return l=function(e,t,l,a){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,e);case 2:return r.call(this,e,t);case 3:return n.call(this,e,t,l);default:var u=null;if(3<arguments.length){u=0;for(var c=Array(arguments.length-3);u<c.length;)c[u]=arguments[u+3],++u;u=new Fd(c,0,null)}return s.l(e,t,l,u)}},l.I=3,l.J=s.J,l.A=o,l.g=i,l.h=r,l.j=n,l.l=s.l,l}()}function Bg(e,t,n){return function(){function r(r,i,o){return e.O?e.O(t,n,r,i,o):e.call(null,t,n,r,i,o)}function i(r,i){return e.F?e.F(t,n,r,i):e.call(null,t,n,r,i)}function o(r){return e.j?e.j(t,n,r):e.call(null,t,n,r)}function l(){return e.h?e.h(t,n):e.call(null,t,n)}var s,a=function(){function r(e,t,n,r){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return i.call(this,e,t,n,o)}function i(r,i,o,l){return ag(e,t,n,r,i,D([o,l]))}return r.I=3,r.J=function(e){return i(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},r.l=i,r}();return s=function(e,t,n,s){switch(arguments.length){case 0:return l.call(this);case 1:return o.call(this,e);case 2:return i.call(this,e,t);case 3:return r.call(this,e,t,n);default:var u=null;if(3<arguments.length){u=0;for(var c=Array(arguments.length-3);u<c.length;)c[u]=arguments[u+3],++u;u=new Fd(c,0,null)}return a.l(e,t,n,u)}},s.I=3,s.J=a.J,s.A=l,s.g=o,s.h=i,s.j=r,s.l=a.l,s}()}function Cg(e,t,n,r){return function(){function i(i,o,l){return e.oa?e.oa(t,n,r,i,o,l):e.call(null,t,n,r,i,o,l)}function o(i,o){return e.O?e.O(t,n,r,i,o):e.call(null,t,n,r,i,o)}function l(i){return e.F?e.F(t,n,r,i):e.call(null,t,n,r,i)}function s(){return e.j?e.j(t,n,r):e.call(null,t,n,r)}var a,u=function(){function i(e,t,n,r){var i=null;if(3<arguments.length){i=0;for(var l=Array(arguments.length-3);i<l.length;)l[i]=arguments[i+3],++i;i=new Fd(l,0,null)}return o.call(this,e,t,n,i)}function o(i,o,l,s){return ag(e,t,n,r,i,D([o,l,s]))}return i.I=3,i.J=function(e){return o(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},i.l=o,i}();return a=function(e,t,n,r){switch(arguments.length){case 0:return s.call(this);case 1:return l.call(this,e);case 2:return o.call(this,e,t);case 3:return i.call(this,e,t,n);default:var a=null;if(3<arguments.length){a=0;for(var c=Array(arguments.length-3);a<c.length;)c[a]=arguments[a+3],++a;a=new Fd(c,0,null)}return u.l(e,t,n,a)}},a.I=3,a.J=u.J,a.A=s,a.g=l,a.h=o,a.j=i,a.l=u.l,a}()}function Dg(e,t){return function(){function n(n,r,i){return n=null==n?t:n,e.j?e.j(n,r,i):e.call(null,n,r,i)}function r(n,r){return n=null==n?t:n,e.h?e.h(n,r):e.call(null,n,r)}function i(n){return n=null==n?t:n,e.g?e.g(n):e.call(null,n)}var o,l=function(){function n(e,t,n,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return r.call(this,e,t,n,o)}function r(n,r,i,o){return $f(e,null==n?t:n,r,i,o)}return n.I=3,n.J=function(e){return r(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},n.l=r,n}();return o=function(e,t,o,s){switch(arguments.length){case 1:return i.call(this,e);case 2:return r.call(this,e,t);case 3:return n.call(this,e,t,o);default:var a=null;if(3<arguments.length){a=0;for(var u=Array(arguments.length-3);a<u.length;)u[a]=arguments[a+3],++a;a=new Fd(u,0,null)}return l.l(e,t,o,a)}},o.I=3,o.J=l.J,o.g=i,o.h=r,o.j=n,o.l=l.l,o}()}function Eg(e){this.state=e,this.hf=this.eg=this.K=null,this.M=16386,this.B=6455296}function Fg(e){return new Eg(e)}function Gg(e,t){if(e instanceof Eg){var r=e.eg;if(null!=r&&!n(r.g?r.g(t):r.call(null,t)))throw Error("Validator rejected reference state");return r=e.state,e.state=t,null!=e.hf&&e.Le(null,r,t),t}return id(e,t)}function Hg(e,t){var r=e.eg;if(null!=r&&!n(r.g?r.g(t):r.call(null,t)))throw Error("Validator rejected reference state");return r=e.state,e.state=t,null!=e.hf&&Wc(e,r,t),new Q(null,2,5,S,[r,t],null)}zg.A=function(){return bf},zg.g=function(e){return e},zg.h=function(e,t){return function(){function n(n,r,i){return n=t.j?t.j(n,r,i):t.call(null,n,r,i),e.g?e.g(n):e.call(null,n)}function r(n,r){return n=t.h?t.h(n,r):t.call(null,n,r),e.g?e.g(n):e.call(null,n)}function i(n){return n=t.g?t.g(n):t.call(null,n),e.g?e.g(n):e.call(null,n)}function o(){var n=t.A?t.A():t.call(null);return e.g?e.g(n):e.call(null,n)}var l,s=function(){function n(e,t,n,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return r.call(this,e,t,n,o)}function r(n,r,i,o){return n=$f(t,n,r,i,o),e.g?e.g(n):e.call(null,n)}return n.I=3,n.J=function(e){return r(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},n.l=r,n}();return l=function(e,t,l,a){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,e);case 2:return r.call(this,e,t);case 3:return n.call(this,e,t,l);default:var u=null;if(3<arguments.length){u=0;for(var c=Array(arguments.length-3);u<c.length;)c[u]=arguments[u+3],++u;u=new Fd(c,0,null)}return s.l(e,t,l,u)}},l.I=3,l.J=s.J,l.A=o,l.g=i,l.h=r,l.j=n,l.l=s.l,l}()},zg.j=function(e,t,n){return function(){function r(r,i,o){return r=n.j?n.j(r,i,o):n.call(null,r,i,o),r=t.g?t.g(r):t.call(null,r),e.g?e.g(r):e.call(null,r)}function i(r,i){return r=n.h?n.h(r,i):n.call(null,r,i),r=t.g?t.g(r):t.call(null,r),e.g?e.g(r):e.call(null,r)}function o(r){return r=n.g?n.g(r):n.call(null,r),r=t.g?t.g(r):t.call(null,r),e.g?e.g(r):e.call(null,r)}function l(){var r=n.A?n.A():n.call(null);return r=t.g?t.g(r):t.call(null,r),e.g?e.g(r):e.call(null,r)}var s,a=function(){function r(e,t,n,r){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return i.call(this,e,t,n,o)}function i(r,i,o,l){return r=$f(n,r,i,o,l),r=t.g?t.g(r):t.call(null,r),e.g?e.g(r):e.call(null,r)}return r.I=3,r.J=function(e){return i(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},r.l=i,r}();return s=function(e,t,n,s){switch(arguments.length){case 0:return l.call(this);case 1:return o.call(this,e);case 2:return i.call(this,e,t);case 3:return r.call(this,e,t,n);default:var u=null;if(3<arguments.length){u=0;for(var c=Array(arguments.length-3);u<c.length;)c[u]=arguments[u+3],++u;u=new Fd(c,0,null)}return a.l(e,t,n,u)}},s.I=3,s.J=a.J,s.A=l,s.g=o,s.h=i,s.j=r,s.l=a.l,s}()},zg.l=function(e,t,n,r){var i=vf(ke(e,ke(t,ke(n,r))));return function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){e=Xf(A(i),e);for(var t=B(i);;){if(!t)return e;var n=A(t);e=n.g?n.g(e):n.call(null,e),t=B(t)}}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}()},zg.J=function(e){var t=A(e),n=B(e);e=A(n);var r=B(n);return n=A(r),r=B(r),this.l(t,e,n,r)},zg.I=3,h=Eg.prototype,h.aa=function(e,t){return this===t},h.Jb=function(){return this.state},h.R=function(){return this.K},h.Le=function(e,t,n){e=z(this.hf);for(var r=null,i=0,o=0;;)if(o<i){var l=r.$(null,o),s=G(l,0,null);(l=G(l,1,null)).F?l.F(s,this,t,n):l.call(null,s,this,t,n),o+=1}else{if(!(e=z(e)))return null;Me(e)?(r=ed(e),e=fd(e),s=r,i=C(r),r=s):(s=G(r=A(e),0,null),(l=G(r,1,null)).F?l.F(s,this,t,n):l.call(null,s,this,t,n),e=B(e),r=null,i=0),o=0}},h.ba=function(){return fa(this)};var Ig=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],arguments[2],arguments[3],new Fd(n.slice(4),0,null))}};function Jg(e,t){var n=e.state;return Hg(e,t=t.g?t.g(n):t.call(null,n))}function Kg(e,t){var n=e.state;return Hg(e,t=we.h?we.h(n,t):we.call(null,n,t))}function Lg(e){this.state=e,this.B=32768,this.M=0}function Mg(e,t){ld(e,t)}Ig.h=function(e,t){if(e instanceof Eg){var n=e.state;e=Gg(e,t=t.g?t.g(n):t.call(null,n))}else e=jd(e,t);return e},Ig.j=function(e,t,n){if(e instanceof Eg){var r=e.state;e=Gg(e,t=t.h?t.h(r,n):t.call(null,r,n))}else e=jd(e,t,n);return e},Ig.F=function(e,t,n,r){if(e instanceof Eg){var i=e.state;e=Gg(e,t=t.j?t.j(i,n,r):t.call(null,i,n,r))}else e=jd(e,t,n,r);return e},Ig.l=function(e,t,n,r,i){return e instanceof Eg?Gg(e,$f(t,e.state,n,r,i)):jd(e,t,n,r,i)},Ig.J=function(e){var t=A(e),n=B(e);e=A(n);var r=B(n);n=A(r);var i=B(r);return r=A(i),i=B(i),this.l(t,e,n,r,i)},Ig.I=4,Lg.prototype.ld=function(e,t){return this.state=t},Lg.prototype.Jb=function(){return this.state};var Ng=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],arguments[2],arguments[3],new Fd(n.slice(4),0,null))}};Ng.g=function(e){return function(t){return function(){function n(n,r){return r=e.g?e.g(r):e.call(null,r),t.h?t.h(n,r):t.call(null,n,r)}function r(e){return t.g?t.g(e):t.call(null,e)}function i(){return t.A?t.A():t.call(null)}var o,l=function(){function n(e,t,n){var i=null;if(2<arguments.length){i=0;for(var o=Array(arguments.length-2);i<o.length;)o[i]=arguments[i+2],++i;i=new Fd(o,0,null)}return r.call(this,e,t,i)}function r(n,r,i){return r=Yf(e,r,i),t.h?t.h(n,r):t.call(null,n,r)}return n.I=2,n.J=function(e){return r(A(e),A(e=B(e)),e=Hd(e))},n.l=r,n}();return o=function(e,t,o){switch(arguments.length){case 0:return i.call(this);case 1:return r.call(this,e);case 2:return n.call(this,e,t);default:var s=null;if(2<arguments.length){s=0;for(var a=Array(arguments.length-2);s<a.length;)a[s]=arguments[s+2],++s;s=new Fd(a,0,null)}return l.l(e,t,s)}},o.I=2,o.J=l.J,o.A=i,o.g=r,o.h=n,o.l=l.l,o}()}},Ng.h=function(e,t){return new Df(null,(function(){var n,r=z(t);if(r){if(Me(r)){for(var i=ed(r),o=C(i),l=Hf(o),s=0;s<o;)Kf(l,(n=void 0,n=Zb(i,s),e.g?e.g(n):e.call(null,n))),s+=1;return Jf(Lf(l),Ng.h(e,fd(r)))}return ke(function(){var t=A(r);return e.g?e.g(t):e.call(null,t)}(),Ng.h(e,Hd(r)))}return null}),null,null)},Ng.j=function(e,t,n){return new Df(null,(function(){var r=z(t),i=z(n);if(r&&i){var o=A(r),l=A(i);r=ke(o=e.h?e.h(o,l):e.call(null,o,l),Ng.j(e,Hd(r),Hd(i)))}else r=null;return r}),null,null)},Ng.F=function(e,t,n,r){return new Df(null,(function(){var i=z(t),o=z(n),l=z(r);if(i&&o&&l){var s=A(i),a=A(o),u=A(l);i=ke(s=e.j?e.j(s,a,u):e.call(null,s,a,u),Ng.F(e,Hd(i),Hd(o),Hd(l)))}else i=null;return i}),null,null)},Ng.l=function(e,t,n,r,i){return Ng.h((function(t){return Xf(e,t)}),function e(t){return new Df(null,(function(){var n=Ng.h(z,t);return ug(bf,n)?ke(Ng.h(A,n),e(Ng.h(Hd,n))):null}),null,null)}(re.l(i,r,D([n,t]))))},Ng.J=function(e){var t=A(e),n=B(e);e=A(n);var r=B(n);n=A(r);var i=B(r);return r=A(i),i=B(i),this.l(t,e,n,r,i)},Ng.I=4;var Og=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function Pg(e,t){return new Df(null,(function(){e:for(var n=e,r=t;r=z(r),0<n&&r;)--n,r=Hd(r);return r}),null,null)}function Qg(e,t){return Ng.j((function(e){return e}),t,Pg(e,t))}function Rg(e,t,n,r){this.K=e,this.count=t,this.v=n,this.next=r,this.G=null,this.B=32374988,this.M=1}function Sg(e){return new Rg(null,-1,e,null)}function Tg(e,t){return 0<e?new Rg(null,e,t,null):Id}Og.g=function(e){return function(t){var n=new Lg(e);return function(){function e(e,i){var o=r(n),l=n.ld(null,n.Jb(null)-1);return e=0<o?t.h?t.h(e,i):t.call(null,e,i):e,0<l||Ud(e)?e:Td(e)}function i(e){return t.g?t.g(e):t.call(null,e)}function o(){return t.A?t.A():t.call(null)}var l;return l=function(t,n){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,t);case 2:return e.call(this,t,n)}throw Error("Invalid arity: "+arguments.length)},l.A=o,l.g=i,l.h=e,l}()}},Og.h=function(e,t){return new Df(null,(function(){if(0<e){var n=z(t);return n?ke(A(n),Og.h(e-1,Hd(n))):null}return null}),null,null)},Og.I=2,h=Rg.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,this.count)}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){return null==this.next?1<this.count?this.next=new Rg(null,this.count-1,this.v,null):-1===this.count?this:null:this.next},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Dd=function(){return!1},h.Ea=function(e,t){if(-1===this.count)for(var n=t.h?t.h(this.v,this.v):t.call(null,this.v,this.v);;){if(Ud(n))return r(n);n=t.h?t.h(n,this.v):t.call(null,n,this.v)}else for(e=1,n=this.v;;){if(!(e<this.count))return n;if(Ud(n=t.h?t.h(n,this.v):t.call(null,n,this.v)))return r(n);e+=1}},h.Fa=function(e,t,n){if(-1===this.count)for(n=t.h?t.h(n,this.v):t.call(null,n,this.v);;){if(Ud(n))return r(n);n=t.h?t.h(n,this.v):t.call(null,n,this.v)}else for(e=0;;){if(!(e<this.count))return n;if(Ud(n=t.h?t.h(n,this.v):t.call(null,n,this.v)))return r(n);e+=1}},h.Ga=function(){return this.v},h.Ia=function(){return null==this.next?1<this.count?this.next=new Rg(null,this.count-1,this.v,null):-1===this.count?this:Id:this.next},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new Rg(t,this.count,this.v,this.next)},h.ia=function(e,t){return ke(t,this)};var yq={};function dt(e,t,n,r,i){this.K=e,this.f=t,this.Mi=n,this.seed=r,this.next=i,this.B=26083532,this.M=1}function tt(e,t){return new dt(null,e,null,t,null)}h=dt.prototype,h.toString=function(){return pd(this)},h.R=function(){return this.K},h.Aa=function(){return this.Ia(null)},h.sa=function(){return Id},h.Dd=function(){return this.seed!==yq},h.Ea=function(e,t){e=this.Ga(null);var n=this.f.g?this.f.g(e):this.f.call(null,e);for(e=t.h?t.h(e,n):t.call(null,e,n);;){if(Ud(e))return r(e);n=this.f.g?this.f.g(n):this.f.call(null,n),e=t.h?t.h(e,n):t.call(null,e,n)}},h.Fa=function(e,t,n){for(e=this.Ga(null),n=t.h?t.h(n,e):t.call(null,n,e);;){if(Ud(n))return r(n);e=this.f.g?this.f.g(e):this.f.call(null,e),n=t.h?t.h(n,e):t.call(null,n,e)}},h.Ga=function(){return yq===this.seed&&(this.seed=this.f.g?this.f.g(this.Mi):this.f.call(null,this.Mi)),this.seed},h.Ia=function(){return null==this.next&&(this.next=new dt(null,this.f,this.Ga(null),yq,null)),this.next},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new dt(t,this.f,this.Mi,this.seed,this.next)},h.ia=function(e,t){return ke(t,this)};var Ug=function e(t){switch(arguments.length){case 0:return e.A();case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],new Fd(n.slice(2),0,null))}};function Vg(){return function(e){var t=new Lg(!1);return function(){function i(i,o){return n(r(t))?Ud(i=e.h?e.h(i," "):e.call(null,i," "))?i:e.h?e.h(i,o):e.call(null,i,o):(ld(t,!0),e.h?e.h(i,o):e.call(null,i,o))}function o(t){return e.g?e.g(t):e.call(null,t)}function l(){return e.A?e.A():e.call(null)}var s;return s=function(e,t){switch(arguments.length){case 0:return l.call(this);case 1:return o.call(this,e);case 2:return i.call(this,e,t)}throw Error("Invalid arity: "+arguments.length)},s.A=l,s.g=o,s.h=i,s}()}}function Wg(e,t){return Xf(Of,Yf(Ng,e,t))}Ug.A=function(){return Id},Ug.g=function(e){return new Df(null,(function(){return e}),null,null)},Ug.h=function(e,t){return new Df(null,(function(){var n=z(e),r=z(t);return n&&r?ke(A(n),ke(A(r),Ug.h(Hd(n),Hd(r)))):null}),null,null)},Ug.l=function(e,t,n){return new Df(null,(function(){var r=Ng.h(z,re.l(n,t,D([e])));return ug(bf,r)?Of.h(Ng.h(A,r),Xf(Ug,Ng.h(Hd,r))):null}),null,null)},Ug.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},Ug.I=2;var Xg=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};Xg.g=function(e){return function(t){return function(){function r(r,i){return n(e.g?e.g(i):e.call(null,i))?t.h?t.h(r,i):t.call(null,r,i):r}function i(e){return t.g?t.g(e):t.call(null,e)}function o(){return t.A?t.A():t.call(null)}var l;return l=function(e,t){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,e);case 2:return r.call(this,e,t)}throw Error("Invalid arity: "+arguments.length)},l.A=o,l.g=i,l.h=r,l}()}},Xg.h=function(e,t){return new Df(null,(function(){var r=z(t);if(r){if(Me(r)){for(var i=ed(r),o=C(i),l=Hf(o),s=0;s<o;){var a=Zb(i,s);n(a=e.g?e.g(a):e.call(null,a))&&(a=Zb(i,s),l.add(a)),s+=1}return Jf(Lf(l),Xg.h(e,fd(r)))}return i=A(r),r=Hd(r),n(e.g?e.g(i):e.call(null,i))?ke(i,Xg.h(e,r)):Xg.h(e,r)}return null}),null,null)},Xg.I=2;var Yg=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function Zg(e){return function e(t){return new Df(null,(function(){return ke(t,n(Ie.g?Ie.g(t):Ie.call(null,t))?Wg(e,D([z.g?z.g(t):z.call(null,t)])):null)}),null,null)}(e)}function $g(e){return Xg.h((function(e){return!Ie(e)}),Hd(Zg(e)))}Yg.g=function(e){return Xg.g(xg(e))},Yg.h=function(e,t){return Xg.h(xg(e),t)},Yg.I=2;var ah=function e(t){switch(arguments.length){case 0:return e.A();case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};ah.A=function(){return F},ah.g=function(e){return e},ah.h=function(e,t){return null!=e?null!=e&&(4&e.M||cb===e.Dg)?Bc(Zc(Nb.j(Yc,Xc(e),t)),Ae(e)):Nb.j(Xb,e,t):Nb.j(re,e,t)},ah.j=function(e,t,n){if(null!=e&&(4&e.M||cb===e.Dg)){var r=Ae(e);return ef(t,function(){function e(e,t){return Pf.h(e,t)}function t(e){return Bc(Zc(e),r)}var n;return n=function(n,r){switch(arguments.length){case 1:return t.call(this,n);case 2:return e.call(this,n,r)}throw Error("Invalid arity: "+arguments.length)},n.g=t,n.h=e,n}(),Xc(e),n)}return ef(t,re,e,n)},ah.I=3;var bh=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],arguments[2],arguments[3],new Fd(n.slice(4),0,null))}};function ch(e,t){return Zc(Nb.j((function(t,r){return n(e.g?e.g(r):e.call(null,r))?Pf.h(t,r):t}),Xc(F),t))}bh.h=function(e,t){return Zc(Nb.j((function(t,n){return Pf.h(t,e.g?e.g(n):e.call(null,n))}),Xc(F),t))},bh.j=function(e,t,n){return ah.h(F,Ng.j(e,t,n))},bh.F=function(e,t,n,r){return ah.h(F,Ng.F(e,t,n,r))},bh.l=function(e,t,n,r,i){return ah.h(F,ag(Ng,e,t,n,r,D([i])))},bh.J=function(e){var t=A(e),n=B(e);e=A(n);var r=B(n);n=A(r);var i=B(r);return r=A(i),i=B(i),this.l(t,e,n,r,i)},bh.I=4;var dh=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};dh.h=function(e,t){return Nb.j(u,e,t)},dh.j=function(e,t,n){var r=Oe;for(t=z(t);;){if(null==t)return e;if(r===(e=u.j(e,A(t),r)))return n;t=B(t)}},dh.I=3;var eh=function e(t,n,r){var i=z(n);n=A(i);var o=B(i);if(o){i=I.j;var l=u.h(t,n);r=e.j?e.j(l,o,r):e.call(null,l,o,r),t=i.call(I,t,n,r)}else t=I.j(t,n,r);return t},fh=function e(t){switch(arguments.length){case 3:return e.j(arguments[0],arguments[1],arguments[2]);case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return e.O(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);case 6:return e.oa(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],new Fd(n.slice(6),0,null))}};function gh(e,t,n){var r=I.j,i=u.h(e,t);return n=n.g?n.g(i):n.call(null,i),r.call(I,e,t,n)}function hh(e,t,n,r){var i=I.j,o=u.h(e,t);return n=n.h?n.h(o,r):n.call(null,o,r),i.call(I,e,t,n)}function ih(e,t){this.ya=e,this.o=t}function jh(e){return new ih(e,[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null])}function kh(e){return new ih(e.ya,Lb(e.o))}function lh(e){return 32>(e=e.H)?0:e-1>>>5<<5}function mh(e,t,n){for(;;){if(0===t)return n;var r=jh(e);r.o[0]=n,n=r,t-=5}}fh.j=function(e,t,n){var r=z(t);if(t=A(r),r=B(r))e=I.j(e,t,fh.j(u.h(e,t),r,n));else{r=I.j;var i=u.h(e,t);n=n.g?n.g(i):n.call(null,i),e=r.call(I,e,t,n)}return e},fh.F=function(e,t,n,r){var i=z(t);if(t=A(i),i=B(i))e=I.j(e,t,fh.F(u.h(e,t),i,n,r));else{i=I.j;var o=u.h(e,t);n=n.h?n.h(o,r):n.call(null,o,r),e=i.call(I,e,t,n)}return e},fh.O=function(e,t,n,r,i){var o=z(t);if(t=A(o),o=B(o))e=I.j(e,t,fh.O(u.h(e,t),o,n,r,i));else{o=I.j;var l=u.h(e,t);n=n.j?n.j(l,r,i):n.call(null,l,r,i),e=o.call(I,e,t,n)}return e},fh.oa=function(e,t,n,r,i,o){var l=z(t);if(t=A(l),l=B(l))e=I.j(e,t,fh.oa(u.h(e,t),l,n,r,i,o));else{l=I.j;var s=u.h(e,t);n=n.F?n.F(s,r,i,o):n.call(null,s,r,i,o),e=l.call(I,e,t,n)}return e},fh.l=function(e,t,n,r,i,o,l){var s=z(t);return t=A(s),(s=B(s))?I.j(e,t,ag(fh,u.h(e,t),s,n,r,D([i,o,l]))):I.j(e,t,ag(n,u.h(e,t),r,i,o,D([l])))},fh.J=function(e){var t=A(e),n=B(e);e=A(n);var r=B(n);n=A(r);var i=B(r);r=A(i);var o=B(i);i=A(o);var l=B(o);return o=A(l),l=B(l),this.l(t,e,n,r,i,o,l)},fh.I=6;var nh=function e(t,n,r,i){var o=kh(r),l=t.H-1>>>n&31;return 5===n?o.o[l]=i:(null!=(r=r.o[l])?(n-=5,t=e.F?e.F(t,n,r,i):e.call(null,t,n,r,i)):t=mh(null,n-5,i),o.o[l]=t),o};function oh(e,t){throw Error(["No item ",p.g(e)," in vector of length ",p.g(t)].join(""))}function ph(e,t){if(t>=lh(e))return e.wa;var n=e.root;for(e=e.shift;;){if(!(0<e))return n.o;var r=e-5;n=n.o[t>>>e&31],e=r}}function qh(e,t){return 0<=t&&t<e.H?ph(e,t):oh(t,e.H)}var rh=function e(t,n,r,i,o){var l=kh(r);if(0===n)l.o[31&i]=o;else{var s=i>>>n&31;n-=5,r=r.o[s],t=e.O?e.O(t,n,r,i,o):e.call(null,t,n,r,i,o),l.o[s]=t}return l},sh=function e(t,n,r){var i=t.H-2>>>n&31;if(5<n){n-=5;var o=r.o[i];return null==(t=e.j?e.j(t,n,o):e.call(null,t,n,o))&&0===i?null:((r=kh(r)).o[i]=t,r)}return 0===i?null:((r=kh(r)).o[i]=null,r)};function th(e,t,n,r,i,o){this.N=e,this.Wd=t,this.o=n,this.ma=r,this.start=i,this.end=o}function uh(e,t,n){return new th(t,t-t%32,t<C(e)?ph(e,t):null,e,t,n)}function vh(e,t,n,r){return n<r?wh(e,t,ee(e,n),n+1,r):t.A?t.A():t.call(null)}function wh(e,t,n,i,o){var l=n;for(n=i,i=ph(e,i);;){if(!(n<o))return l;var s=31&n;if(s=(i=0===s?ph(e,n):i)[s],Ud(l=t.h?t.h(l,s):t.call(null,l,s)))return r(l);n+=1}}function Q(e,t,n,r,i,o){this.K=e,this.H=t,this.shift=n,this.root=r,this.wa=i,this.G=o,this.B=167666463,this.M=139268}th.prototype.ua=function(){return this.N<this.end},th.prototype.next=function(){32==this.N-this.Wd&&(this.o=ph(this.ma,this.N),this.Wd+=32);var e=this.o[31&this.N];return this.N+=1,e},h=Q.prototype,h.zc=function(e,t){return 0<=t&&t<this.H?new xh(t,ph(this,t)[31&t]):null},h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){return"number"==typeof t?this.Ba(null,t,n):n},h.Ka=function(e,t,n){e=0;for(var i=n;;){if(!(e<this.H))return i;var o=ph(this,e);n=o.length;e:for(var l=0;;){if(!(l<n)){o=i;break e}var s=l+e,a=o[l];if(Ud(i=t.j?t.j(i,s,a):t.call(null,i,s,a))){o=i;break e}l+=1}if(Ud(o))return r(o);e+=n,i=o}},h.Ee=cb,h.$=function(e,t){return qh(this,t)[31&t]},h.Ba=function(e,t,n){return 0<=t&&t<this.H?ph(this,t)[31&t]:n},h.Kb=function(e,t,n){if(0<=t&&t<this.H)return lh(this)<=t?((e=Lb(this.wa))[31&t]=n,new Q(this.K,this.H,this.shift,this.root,e,null)):new Q(this.K,this.H,this.shift,rh(this,this.shift,this.root,t,n),this.wa,null);if(t===this.H)return this.ia(null,n);throw Error(["Index ",p.g(t)," out of bounds  [0,",p.g(this.H),"]"].join(""))},h.xa=function(){return uh(this,0,this.H)},h.R=function(){return this.K},h.da=function(){return this.H},h.Ub=function(){return 0<this.H?this.$(null,this.H-1):null},h.Vb=function(){if(0===this.H)throw Error("Can't pop empty vector");if(1===this.H)return Bc(F,this.K);if(1<this.H-lh(this))return new Q(this.K,this.H-1,this.shift,this.root,this.wa.slice(0,-1),null);var e=ph(this,this.H-2),t=sh(this,this.shift,this.root);t=null==t?S:t;var n=this.H-1;return 5<this.shift&&null==t.o[1]?new Q(this.K,n,this.shift-5,t.o[0],e,null):new Q(this.K,n,this.shift,t,e,null)},h.Ac=function(){return 0<this.H?new ie(this,this.H-1,null):null},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){if(!(t instanceof Q))return je(this,t);if(this.H!==C(t))return!1;for(e=this.xa(null),t=t.xa(null);;){if(!e.ua())return!0;var n=e.next(),r=t.next();if(!x.h(n,r))return!1}},h.gd=function(){return new yh(this.H,this.shift,zh.g?zh.g(this.root):zh.call(null,this.root),Ah.g?Ah.g(this.wa):Ah.call(null,this.wa))},h.sa=function(){return Bc(F,this.K)},h.Ea=function(e,t){return vh(this,t,0,this.H)},h.Fa=function(e,t,n){e=0;for(var i=n;;){if(!(e<this.H))return i;var o=ph(this,e);n=o.length;e:for(var l=0;;){if(!(l<n)){o=i;break e}var s=o[l];if(Ud(i=t.h?t.h(i,s):t.call(null,i,s))){o=i;break e}l+=1}if(Ud(o))return r(o);e+=n,i=o}},h.ja=function(e,t,n){if("number"==typeof t)return this.Kb(null,t,n);throw Error("Vector's key for assoc must be a number.")},h.za=function(e,t){return!!Se(t)&&(0<=t&&t<this.H)},h.ca=function(){if(0===this.H)return null;if(32>=this.H)return new Fd(this.wa,0,null);e:for(var e=this.root,t=this.shift;;){if(!(0<t)){e=e.o;break e}t-=5,e=e.o[0]}return Bh?Bh(this,e,0,0):Ch.call(null,this,e,0,0)},h.S=function(e,t){return t===this.K?this:new Q(t,this.H,this.shift,this.root,this.wa,this.G)},h.ia=function(e,t){if(32>this.H-lh(this)){e=this.wa.length;for(var n=Array(e+1),r=0;r<e;)n[r]=this.wa[r],r+=1;return n[e]=t,new Q(this.K,this.H+1,this.shift,this.root,n,null)}return e=(n=this.H>>>5>1<<this.shift)?this.shift+5:this.shift,n?((n=jh(null)).o[0]=this.root,r=mh(null,this.shift,new ih(null,this.wa)),n.o[1]=r):n=nh(this,this.shift,this.root,new ih(null,this.wa)),new Q(this.K,this.H+1,e,n,[t],null)},h.call=function(e){if(arguments.length-1==1)return this.g(arguments[1]);throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){if("number"==typeof e)return this.$(null,e);throw Error("Key must be integer")};var S=new ih(null,[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),F=new Q(null,0,5,S,[],Od);function Dh(e,t){var n=e.length;if(e=t?e:Lb(e),32>n)return new Q(null,n,5,S,e,null);t=32;for(var r=new Q(null,32,5,S,e.slice(0,32),null).gd(null);;){if(!(t<n))return Zc(r);var i=t+1;r=Pf.h(r,e[t]),t=i}}function Eh(e){return n(Fh.g?Fh.g(e):Fh.call(null,e))?new Q(null,2,5,S,[Gh.g?Gh.g(e):Gh.call(null,e),Hh.g?Hh.g(e):Hh.call(null,e)],null):Le(e)?ze(e,null):wb(e)?Dh(e,!0):Zc(Nb.j(Yc,Xc(F),e))}Q.prototype[Gb]=function(){return Kd(this)};var Ih=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};function Jh(e,t,n,r,i){this.Hb=e,this.node=t,this.N=n,this.eb=r,this.K=i,this.G=null,this.B=32375020,this.M=1536}function Ch(e){switch(arguments.length){case 3:var t=arguments[0],n=arguments[1],r=arguments[2];return new Jh(t,qh(t,n),n,r,null);case 4:return Bh(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return Kh(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function Bh(e,t,n,r){return new Jh(e,t,n,r,null)}function Kh(e,t,n,r,i){return new Jh(e,t,n,r,i)}function Lh(e,t,n,r,i){this.K=e,this.ma=t,this.start=n,this.end=r,this.G=i,this.B=167666463,this.M=139264}function Mh(e,t,n,r,i){for(;;){if(!(t instanceof Lh)){if(!Le(t))throw Error("v must satisfy IVector");if(0>n||r<n||r>C(t))throw Error("Index out of bounds");return new Lh(e,t,n,r,i)}n=t.start+n,r=t.start+r,t=t.ma}}function Nh(e,t,n){return Mh(null,e,0|t,0|n,null)}function Oh(e,t){return e===t.ya?t:new ih(e,Lb(t.o))}function zh(e){return new ih({},Lb(e.o))}function Ah(e){var t=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];return Ne(e,0,t,0,e.length),t}Ih.l=function(e){return e instanceof Fd&&0===e.N?Dh(e.o,!wb(e.o)):Eh(e)},Ih.I=0,Ih.J=function(e){return this.l(z(e))},h=Jh.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){if(this.eb+1<this.node.length){var e=this.Hb,t=this.node,n=this.N,r=this.eb+1;return null==(e=Bh?Bh(e,t,n,r):Ch.call(null,e,t,n,r))?null:e}return this.be()},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return vh(this.Hb,t,this.N+this.eb,C(this.Hb))},h.Fa=function(e,t,n){return wh(this.Hb,t,n,this.N+this.eb,C(this.Hb))},h.Ga=function(){return this.node[this.eb]},h.Ia=function(){if(this.eb+1<this.node.length){var e=this.Hb,t=this.node,n=this.N,r=this.eb+1;return null==(e=Bh?Bh(e,t,n,r):Ch.call(null,e,t,n,r))?Id:e}return this.Mc(null)},h.ca=function(){return this},h.yd=function(){var e=this.node;return new Gf(e,this.eb,e.length)},h.Mc=function(){var e=this.N+this.node.length;if(e<Tb(this.Hb)){var t=this.Hb,n=ph(this.Hb,e);return Bh?Bh(t,n,e,0):Ch.call(null,t,n,e,0)}return Id},h.S=function(e,t){return t===this.K?this:Kh?Kh(this.Hb,this.node,this.N,this.eb,t):Ch.call(null,this.Hb,this.node,this.N,this.eb,t)},h.ia=function(e,t){return ke(t,this)},h.be=function(){var e=this.N+this.node.length;if(e<Tb(this.Hb)){var t=this.Hb,n=ph(this.Hb,e);return Bh?Bh(t,n,e,0):Ch.call(null,t,n,e,0)}return null},Jh.prototype[Gb]=function(){return Kd(this)},h=Lh.prototype,h.zc=function(e,t){return 0>t?null:(e=this.start+t)<this.end?new xh(t,hc(this.ma,e)):null},h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){return"number"==typeof t?this.Ba(null,t,n):n},h.Ka=function(e,t,n){e=this.start;for(var i=0;;){if(!(e<this.end))return n;var o=i,l=Zb(this.ma,e);if(Ud(n=t.j?t.j(n,o,l):t.call(null,n,o,l)))return r(n);i+=1,e+=1}},h.$=function(e,t){return 0>t||this.end<=this.start+t?oh(t,this.end-this.start):Zb(this.ma,this.start+t)},h.Ba=function(e,t,n){return 0>t||this.end<=this.start+t?n:Zb(this.ma,this.start+t,n)},h.Kb=function(e,t,n){if(e=this.start+t,0>t||this.end+1<=e)throw Error(["Index ",p.g(t)," out of bounds [0,",p.g(this.da(null)),"]"].join(""));t=this.K,n=I.j(this.ma,e,n);var r=this.start,i=this.end;return e=i>(e+=1)?i:e,Mh.O?Mh.O(t,n,r,e,null):Mh.call(null,t,n,r,e,null)},h.xa=function(){return null!=this.ma&&cb===this.ma.Ee?uh(this.ma,this.start,this.end):new jg(this)},h.R=function(){return this.K},h.da=function(){return this.end-this.start},h.Ub=function(){return this.start===this.end?null:Zb(this.ma,this.end-1)},h.Vb=function(){if(this.start===this.end)throw Error("Can't pop empty vector");var e=this.K,t=this.ma,n=this.start,r=this.end-1;return Mh.O?Mh.O(e,t,n,r,null):Mh.call(null,e,t,n,r,null)},h.Ac=function(){return this.start!==this.end?new ie(this,this.end-this.start-1,null):null},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Bc(F,this.K)},h.Ea=function(e,t){return null!=this.ma&&cb===this.ma.Ee?vh(this.ma,t,this.start,this.end):Xd(this,t)},h.Fa=function(e,t,n){return null!=this.ma&&cb===this.ma.Ee?wh(this.ma,t,n,this.start,this.end):Yd(this,t,n)},h.ja=function(e,t,n){if("number"==typeof t)return this.Kb(null,t,n);throw Error("Subvec's key for assoc must be a number.")},h.za=function(e,t){return!!Se(t)&&(0<=t&&t<this.end-this.start)},h.ca=function(){var e=this;return function t(n){return n===e.end?null:ke(Zb(e.ma,n),new Df(null,(function(){return t(n+1)}),null,null))}(e.start)},h.S=function(e,t){return t===this.K?this:Mh.O?Mh.O(t,this.ma,this.start,this.end,this.G):Mh.call(null,t,this.ma,this.start,this.end,this.G)},h.ia=function(e,t){e=this.K,t=wc(this.ma,this.end,t);var n=this.start,r=this.end+1;return Mh.O?Mh.O(e,t,n,r,null):Mh.call(null,e,t,n,r,null)},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.$(null,e)},h.h=function(e,t){return this.Ba(null,e,t)},Lh.prototype[Gb]=function(){return Kd(this)};var Ph=function e(t,n,r,i){r=Oh(t.root.ya,r);var o=t.H-1>>>n&31;if(5===n)t=i;else{var l=r.o[o];null!=l?(n-=5,t=e.F?e.F(t,n,l,i):e.call(null,t,n,l,i)):t=mh(t.root.ya,n-5,i)}return r.o[o]=t,r};function yh(e,t,n,r){this.H=e,this.shift=t,this.root=n,this.wa=r,this.M=88,this.B=275}function Qh(e,t,n){if(e.root.ya){if(0<=t&&t<e.H){if(lh(e)<=t)e.wa[31&t]=n;else{var r=function r(i,o){if(o=Oh(e.root.ya,o),0===i)o.o[31&t]=n;else{var l=t>>>i&31;i=r(i-5,o.o[l]),o.o[l]=i}return o}(e.shift,e.root);e.root=r}return e}if(t===e.H)return e.kd(null,n);throw Error(["Index ",p.g(t)," out of bounds for TransientVector of length",p.g(e.H)].join(""))}throw Error("assoc! after persistent!")}function Rh(e,t){this.pd=e,this.Ud=t}function Sh(e,t,n,r){this.K=e,this.Cb=t,this.Gb=n,this.G=r,this.B=31850700,this.M=0}function Th(e,t,n,r,i){this.K=e,this.count=t,this.Cb=n,this.Gb=r,this.G=i,this.M=139264,this.B=31858766}h=yh.prototype,h.kd=function(e,t){if(this.root.ya){if(32>this.H-lh(this))this.wa[31&this.H]=t;else{e=new ih(this.root.ya,this.wa);var n=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];n[0]=t,this.wa=n,this.H>>>5>1<<this.shift?(t=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],n=this.shift+5,t[0]=this.root,t[1]=mh(this.root.ya,this.shift,e),this.root=new ih(this.root.ya,t),this.shift=n):this.root=Ph(this,this.shift,this.root,e)}return this.H+=1,this}throw Error("conj! after persistent!")},h.Ed=function(){if(this.root.ya){this.root.ya=null;var e=this.H-lh(this),t=Array(e);return Ne(this.wa,0,t,0,e),new Q(null,this.H,this.shift,this.root,t,null)}throw Error("persistent! called twice")},h.jd=function(e,t,n){if("number"==typeof t)return Qh(this,t,n);throw Error("TransientVector's key for assoc! must be a number.")},h.da=function(){if(this.root.ya)return this.H;throw Error("count after persistent!")},h.$=function(e,t){if(this.root.ya)return qh(this,t)[31&t];throw Error("nth after persistent!")},h.Ba=function(e,t,n){return 0<=t&&t<this.H?this.$(null,t):n},h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){if(this.root.ya)return"number"==typeof t?this.Ba(null,t,n):n;throw Error("lookup after persistent!")},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.na(null,e)},h.h=function(e,t){return this.P(null,e,t)},Rh.prototype.ua=function(){var e=null!=this.pd&&z(this.pd);return e||((e=null!=this.Ud)?this.Ud.ua():e)},Rh.prototype.next=function(){if(null!=this.pd){var e=A(this.pd);return this.pd=B(this.pd),e}if(null!=this.Ud&&this.Ud.ua())return this.Ud.next();throw Error("No such element")},Rh.prototype.remove=function(){return Error("Unsupported operation")},h=Sh.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){var e=B(this.Cb);return e?new Sh(this.K,e,this.Gb,null):null!=this.Gb?new Sh(this.K,this.Gb,null,null):null},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Bc(Id,this.K)},h.Ga=function(){return A(this.Cb)},h.Ia=function(){var e=B(this.Cb);return e?new Sh(this.K,e,this.Gb,null):null==this.Gb?this.sa(null):new Sh(this.K,this.Gb,null,null)},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new Sh(t,this.Cb,this.Gb,this.G)},h.ia=function(e,t){return ke(t,this)},Sh.prototype[Gb]=function(){return Kd(this)},h=Th.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,this.count.g?this.count.g(this):this.count.call(null,this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.xa=function(){return new Rh(this.Cb,nd(this.Gb))},h.R=function(){return this.K},h.da=function(){return this.count},h.Ub=function(){return A(this.Cb)},h.Vb=function(){if(n(this.Cb)){var e=B(this.Cb);return e?new Th(this.K,this.count-1,e,this.Gb,null):new Th(this.K,this.count-1,z(this.Gb),F,null)}return this},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Bc(Uh,this.K)},h.Ga=function(){return A(this.Cb)},h.Ia=function(){return Hd(z(this))},h.ca=function(){var e=z(this.Gb),t=this.Cb;return n(n(t)?t:e)?new Sh(null,this.Cb,z(e),null):null},h.S=function(e,t){return t===this.K?this:new Th(t,this.count,this.Cb,this.Gb,this.G)},h.ia=function(e,t){return n(this.Cb)?(e=this.Gb,t=new Th(this.K,this.count+1,this.Cb,re.h(n(e)?e:F,t),null)):t=new Th(this.K,this.count+1,re.h(this.Cb,t),F,null),t};var Uh=new Th(null,0,null,F,Od);function Vh(){this.B=2097152,this.M=0}Th.prototype[Gb]=function(){return Kd(this)},Vh.prototype.aa=function(){return!1};var Wh=new Vh;function Xh(e,t){return Re(J(t)&&!Ke(t)&&C(e)===C(t)?(null!=e?1048576&e.B||cb===e.ri||!e.B&&Cb(Fc,e):Cb(Fc,e))?af((function(e,n,r){return!!x.h(u.j(t,n,Wh),r)||Td(!1)}),!0,e):ug((function(e){return x.h(u.j(t,A(e),Wh),oe(e))}),e):null)}function Yh(e,t,n,r){this.N=0,this.Zh=e,this.vf=t,this.Vc=n,this.Gf=r}function Zh(e){this.ka=e}function $h(e){this.ka=e}function ai(e,t){if(t instanceof w)e:{var n=e.length;t=t.W;for(var r=0;;){if(n<=r){e=-1;break e}if(e[r]instanceof w&&t===e[r].W){e=r;break e}r+=2}}else if("string"==typeof t||"number"==typeof t)e:for(n=e.length,r=0;;){if(n<=r){e=-1;break e}if(t===e[r]){e=r;break e}r+=2}else if(t instanceof Ad)e:for(n=e.length,t=t.uc,r=0;;){if(n<=r){e=-1;break e}if(e[r]instanceof Ad&&t===e[r].uc){e=r;break e}r+=2}else if(null==t)e:for(t=e.length,n=0;;){if(t<=n){e=-1;break e}if(null==e[n]){e=n;break e}n+=2}else e:for(n=e.length,r=0;;){if(n<=r){e=-1;break e}if(x.h(t,e[r])){e=r;break e}r+=2}return e}function xh(e,t){this.key=e,this.v=t,this.G=null,this.B=166619935,this.M=0}function Fh(e){return null!=e&&!!(2048&e.B||cb===e.ui)}function bi(e,t,n){this.o=e,this.N=t,this.Mb=n,this.B=32374990,this.M=0}function ci(e,t){this.o=e,this.N=0,this.H=t}function k(e,t,n,r){this.K=e,this.H=t,this.o=n,this.G=r,this.B=16647951,this.M=139268}Yh.prototype.ua=function(){var e=this.N<this.vf;return e||this.Gf.ua()},Yh.prototype.next=function(){if(this.N<this.vf){var e=ee(this.Vc,this.N);return this.N+=1,new xh(e,hc(this.Zh,e))}return this.Gf.next()},Yh.prototype.remove=function(){return Error("Unsupported operation")},Zh.prototype.next=function(){if(null!=this.ka){var e=A(this.ka),t=G(e,0,null);return e=G(e,1,null),this.ka=B(this.ka),{value:[t,e],done:!1}}return{value:null,done:!0}},$h.prototype.next=function(){if(null!=this.ka){var e=A(this.ka);return this.ka=B(this.ka),{value:[e,e],done:!1}}return{value:null,done:!0}},h=xh.prototype,h.zc=function(e,t){switch(t){case 0:return new xh(0,this.key);case 1:return new xh(1,this.v);default:return null}},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.na=function(e,t){return this.Ba(null,t,null)},h.P=function(e,t,n){return this.Ba(null,t,n)},h.$=function(e,t){if(0===t)return this.key;if(1===t)return this.v;throw Error("Index out of bounds")},h.Ba=function(e,t,n){return 0===t?this.key:1===t?this.v:n},h.Kb=function(e,t,n){return new Q(null,2,5,S,[this.key,this.v],null).Kb(null,t,n)},h.R=function(){return null},h.da=function(){return 2},h.He=function(){return this.key},h.Ie=function(){return this.v},h.Ub=function(){return this.v},h.Vb=function(){return new Q(null,1,5,S,[this.key],null)},h.Ac=function(){return new Fd([this.v,this.key],0,null)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return null},h.Ea=function(e,t){return Xd(this,t)},h.Fa=function(e,t,n){return Yd(this,t,n)},h.ja=function(e,t,n){return I.j(new Q(null,2,5,S,[this.key,this.v],null),t,n)},h.za=function(e,t){return 0===t||1===t},h.ca=function(){return new Fd([this.key,this.v],0,null)},h.S=function(e,t){return ze(new Q(null,2,5,S,[this.key,this.v],null),t)},h.ia=function(e,t){return new Q(null,3,5,S,[this.key,this.v,t],null)},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.$(null,e)},h.h=function(e,t){return this.Ba(null,e,t)},h=bi.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.Mb},h.Aa=function(){return this.N<this.o.length-2?new bi(this.o,this.N+2,null):null},h.da=function(){return(this.o.length-this.N)/2},h.ba=function(){return Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return new xh(this.o[this.N],this.o[this.N+1])},h.Ia=function(){return this.N<this.o.length-2?new bi(this.o,this.N+2,null):Id},h.ca=function(){return this},h.S=function(e,t){return t===this.Mb?this:new bi(this.o,this.N,t)},h.ia=function(e,t){return ke(t,this)},bi.prototype[Gb]=function(){return Kd(this)},ci.prototype.ua=function(){return this.N<this.H},ci.prototype.next=function(){var e=new xh(this.o[this.N],this.o[this.N+1]);return this.N+=2,e},h=k.prototype,h.zc=function(e,t){return-1===(e=ai(this.o,t))?null:new xh(this.o[e],this.o[e+1])},h.toString=function(){return pd(this)},h.keys=function(){return Kd(di.g?di.g(this):di.call(null,this))},h.entries=function(){return new Zh(z(z(this)))},h.values=function(){return Kd(ei.g?ei.g(this):ei.call(null,this))},h.has=function(e){return M(this,e)},h.get=function(e,t){return this.P(null,e,t)},h.forEach=function(e){for(var t=z(this),n=null,r=0,i=0;;)if(i<r){var o=n.$(null,i),l=G(o,0,null);o=G(o,1,null),e.h?e.h(o,l):e.call(null,o,l),i+=1}else{if(!(t=z(t)))return null;Me(t)?(n=ed(t),t=fd(t),l=n,r=C(n),n=l):(l=G(n=A(t),0,null),o=G(n,1,null),e.h?e.h(o,l):e.call(null,o,l),t=B(t),n=null,r=0),i=0}},h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){return-1===(e=ai(this.o,t))?n:this.o[e+1]},h.Ka=function(e,t,n){e=this.o.length;for(var i=0;;){if(!(i<e))return n;var o=this.o[i],l=this.o[i+1];if(Ud(n=t.j?t.j(n,o,l):t.call(null,n,o,l)))return r(n);i+=2}},h.xa=function(){return new ci(this.o,2*this.H)},h.R=function(){return this.K},h.da=function(){return this.H},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Pd(this)},h.aa=function(e,t){if(!J(t)||Ke(t))return!1;if(e=this.o.length,this.H!==t.da(null))return!1;for(var n=0;;){if(!(n<e))return!0;var r=t.P(null,this.o[n],Oe);if(r===Oe)return!1;if(!x.h(this.o[n+1],r))return!1;n+=2}},h.gd=function(){return new fi(this.o.length,Lb(this.o))},h.sa=function(){return Bc(P,this.K)},h.Ea=function(e,t){return Ze(this,t)},h.Fa=function(e,t,n){return $e(this,t,n)},h.bb=function(e,t){if(!(0<=ai(this.o,t)))return this;var n=(e=this.o.length)-2;if(0===n)return this.sa(null);n=Array(n);for(var r=0,i=0;;){if(r>=e)return new k(this.K,this.H-1,n,null);x.h(t,this.o[r])||(n[i]=this.o[r],n[i+1]=this.o[r+1],i+=2),r+=2}},h.ja=function(e,t,n){if(-1===(e=ai(this.o,t))){if(this.H<gi){for(var r=(e=this.o).length,i=Array(r+2),o=0;o<r;)i[o]=e[o],o+=1;return i[r]=t,i[r+1]=n,new k(this.K,this.H+1,i,null)}return Bc(lc(ah.h(hi,this),t,n),this.K)}return n===this.o[e+1]?this:((t=Lb(this.o))[e+1]=n,new k(this.K,this.H,t,null))},h.za=function(e,t){return-1!==ai(this.o,t)},h.ca=function(){var e=this.o;return 0<=e.length-2?new bi(e,0,null):null},h.S=function(e,t){return t===this.K?this:new k(t,this.H,this.o,this.G)},h.ia=function(e,t){if(Le(t))return this.ja(null,Zb(t,0),Zb(t,1));for(e=this,t=z(t);;){if(null==t)return e;var n=A(t);if(!Le(n))throw Error("conj on a map takes map entries or seqables of map entries");e=lc(e,Zb(n,0),Zb(n,1)),t=B(t)}},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.na(null,e)},h.h=function(e,t){return this.P(null,e,t)};var P=new k(null,0,[],Qd),gi=8;function ii(e){return new k(null,e.length/2,e,null)}function ji(e,t){return e===t||(!!O(e,t)||x.h(e,t))}function ki(e){for(var t=0,n=0;;){if(!(t<e.length))return n;var r;e:for(r=0;;){if(!(r<t)){r=!1;break e}var i=ji(e[t],e[r]);if(i){r=i;break e}r=2+r}n=r?n:n+2,t=2+t}}function li(e,t){var n=e.length-1,r=z(t);for(e=Ne(e,0,t=Array(n+2*C(r)),0,n),t=n;;){if(!r)return e;var i=A(r);e[t]=pc(i),e[t+1]=qc(i),t=2+n,r=B(r)}}function ve(e){var t,n=e.length,r=1==(1&n);if(!(t=r))e:for(t=0;;){if(!(t<e.length)){t=!1;break e}var i;t:for(i=0;;){if(!(i<t)){i=!1;break t}var o=ji(e[t],e[i]);if(o){i=o;break t}i=2+i}if(i){t=i;break e}t=2+t}return t?mi(e,r):new k(null,n/2,e,null)}function mi(e,t){var n=t?li(e,ah.h(P,e[e.length-1])):e;e=ki(n);var r=n.length;if(e<r){e=Array(e);for(var i=0,o=0;i<r;)!function(){for(var e=0;;){if(!(e<o))return!1;var t=ji(n[i],n[e]);if(t)return t;e=2+e}}()?(t=function(){for(var e=r-2;;){if(!(e>=i))return e;if(ji(n[i],n[e]))return e;e-=2}}(),e[o]=n[i],e[o+1]=n[t+1],i=2+i,o=t=2+o):(i=2+i,o=t=o);return new k(null,e.length/2,e,null)}return new k(null,n.length/2,n,null)}function fi(e,t){this.Uc={},this.hc=e,this.o=t,this.B=259,this.M=56}function ni(e,t){for(var n=Xc(hi),r=0;;){if(!(r<e))return n;n=$c(n,t[r],t[r+1]),r+=2}}function oi(){this.v=!1}function pi(e,t,n){return(e=Lb(e))[t]=n,e}function qi(e,t){var n=Array(e.length-2);return Ne(e,0,n,0,2*t),Ne(e,2*(t+1),n,2*t,n.length-2*t),n}function ri(e,t,n,r){return(e=e.Ec(t)).o[n]=r,e}function si(e,t,n){for(var r=e.length,i=0,o=n;;){if(!(i<r))return o;if(null!=(n=e[i])){var l=e[i+1];n=t.j?t.j(o,n,l):t.call(null,o,n,l)}else n=null!=(n=e[i+1])?n.$c(t,o):o;if(Ud(n))return n;i+=2,o=n}}function ti(e){this.o=e,this.N=0,this.kc=this.Sd=null}function ui(e,t,n){this.ya=e,this.ra=t,this.o=n,this.M=131072,this.B=0}function vi(e,t,n,r){if(e.ra===n)return null;var i=(t=(e=e.Ec(t)).o).length;return e.ra^=n,Ne(t,2*(r+1),t,2*r,i-2*(r+1)),t[i-2]=null,t[i-1]=null,e}k.prototype[Gb]=function(){return Kd(this)},h=fi.prototype,h.da=function(){if(this.Uc)return kf(this.hc,2);throw Error("count after persistent!")},h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){if(this.Uc)return-1===(e=ai(this.o,t))?n:this.o[e+1];throw Error("lookup after persistent!")},h.kd=function(e,t){if(!this.Uc)throw Error("conj! after persistent!");if(Fh(t))return this.jd(null,Gh.g?Gh.g(t):Gh.call(null,t),Hh.g?Hh.g(t):Hh.call(null,t));if(Le(t))return this.jd(null,t.g?t.g(0):t.call(null,0),t.g?t.g(1):t.call(null,1));for(e=z(t),t=this;;){var r=A(e);if(!n(r))return t;e=B(e),t=$c(t,Gh.g?Gh.g(r):Gh.call(null,r),Hh.g?Hh.g(r):Hh.call(null,r))}},h.Ed=function(){if(this.Uc)return this.Uc=!1,new k(null,kf(this.hc,2),this.o,null);throw Error("persistent! called twice")},h.jd=function(e,t,n){if(this.Uc)return-1===(e=ai(this.o,t))?this.hc+2<=2*gi?(this.hc+=2,this.o.push(t),this.o.push(n),this):Qf(ni.h?ni.h(this.hc,this.o):ni.call(null,this.hc,this.o),t,n):(n!==this.o[e+1]&&(this.o[e+1]=n),this);throw Error("assoc! after persistent!")},h.Ke=function(e,t){if(this.Uc)return 0<=(e=ai(this.o,t))&&(this.o[e]=this.o[this.hc-2],this.o[e+1]=this.o[this.hc-1],(e=this.o).pop(),e.pop(),this.hc-=2),this;throw Error("dissoc! after persistent!")},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.P(null,e,null)},h.h=function(e,t){return this.P(null,e,t)},ti.prototype.advance=function(){for(var e=this.o.length;;){if(!(this.N<e))return!1;var t=this.o[this.N],n=this.o[this.N+1];if(null!=t?t=this.Sd=new xh(t,n):null!=n?t=!!(t=nd(n)).ua()&&(this.kc=t):t=!1,this.N+=2,t)return!0}},ti.prototype.ua=function(){var e=null!=this.Sd;return e||((e=null!=this.kc)?e:this.advance())},ti.prototype.next=function(){if(null!=this.Sd){var e=this.Sd;return this.Sd=null,e}if(null!=this.kc)return e=this.kc.next(),this.kc.ua()||(this.kc=null),e;if(this.advance())return this.next();throw Error("No such element")},ti.prototype.remove=function(){return Error("Unsupported operation")},h=ui.prototype,h.Ec=function(e){if(e===this.ya)return this;var t=mf(this.ra),n=Array(0>t?4:2*(t+1));return Ne(this.o,0,n,0,2*t),new ui(e,this.ra,n)},h.Pd=function(e,t,n,r,i){var o=1<<(n>>>t&31);if(0==(this.ra&o))return this;var l=mf(this.ra&o-1),s=this.o[2*l],a=this.o[2*l+1];return null==s?(t=a.Pd(e,t+5,n,r,i))===a?this:null!=t?ri(this,e,2*l+1,t):this.ra===o?null:vi(this,e,o,l):ji(r,s)?(i.v=!0,vi(this,e,o,l)):this},h.Nd=function(){return wi?wi(this.o):xi.call(null,this.o)},h.$c=function(e,t){return si(this.o,e,t)},h.Pc=function(e,t,n,r){var i=1<<(t>>>e&31);if(0==(this.ra&i))return r;var o=mf(this.ra&i-1);return i=this.o[2*o],o=this.o[2*o+1],null==i?o.Pc(e+5,t,n,r):ji(n,i)?o:r},h.fc=function(e,t,n,r,i,o){var l=1<<(n>>>t&31),s=mf(this.ra&l-1);if(0==(this.ra&l)){var a=mf(this.ra);if(2*a<this.o.length){for(t=(e=this.Ec(e)).o,o.v=!0,o=2*s+((n=2*(a-s))-1),a=2*(s+1)+(n-1);0!==n;)t[a]=t[o],--a,--n,--o;return t[2*s]=r,t[2*s+1]=i,e.ra|=l,e}if(16<=a){for((s=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null])[n>>>t&31]=yi.fc(e,t+5,n,r,i,o),i=r=0;32>r;)0==(this.ra>>>r&1)||(s[r]=null!=this.o[i]?yi.fc(e,t+5,xd(this.o[i]),this.o[i],this.o[i+1],o):this.o[i+1],i+=2),r+=1;return new zi(e,a+1,s)}return t=Array(2*(a+4)),Ne(this.o,0,t,0,2*s),t[2*s]=r,t[2*s+1]=i,Ne(this.o,2*s,t,2*(s+1),2*(a-s)),o.v=!0,(e=this.Ec(e)).o=t,e.ra|=l,e}return a=this.o[2*s],l=this.o[2*s+1],null==a?(a=l.fc(e,t+5,n,r,i,o))===l?this:ri(this,e,2*s+1,a):ji(r,a)?i===l?this:ri(this,e,2*s+1,i):(o.v=!0,o=t+5,r=Ai?Ai(e,o,a,l,n,r,i):Bi.call(null,e,o,a,l,n,r,i),i=2*s,s=2*s+1,(e=this.Ec(e)).o[i]=null,e.o[s]=r,e)},h.ec=function(e,t,n,r,i){var o=1<<(t>>>e&31),l=mf(this.ra&o-1);if(0==(this.ra&o)){var s=mf(this.ra);if(16<=s){for((l=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null])[t>>>e&31]=yi.ec(e+5,t,n,r,i),r=n=0;32>n;)0==(this.ra>>>n&1)||(l[n]=null!=this.o[r]?yi.ec(e+5,xd(this.o[r]),this.o[r],this.o[r+1],i):this.o[r+1],r+=2),n+=1;return new zi(null,s+1,l)}return e=Array(2*(s+1)),Ne(this.o,0,e,0,2*l),e[2*l]=n,e[2*l+1]=r,Ne(this.o,2*l,e,2*(l+1),2*(s-l)),i.v=!0,new ui(null,this.ra|o,e)}var a=this.o[2*l];return o=this.o[2*l+1],null==a?(s=o.ec(e+5,t,n,r,i))===o?this:new ui(null,this.ra,pi(this.o,2*l+1,s)):ji(n,a)?r===o?this:new ui(null,this.ra,pi(this.o,2*l+1,r)):(i.v=!0,i=this.ra,s=this.o,e+=5,e=Ci?Ci(e,a,o,t,n,r):Bi.call(null,e,a,o,t,n,r),n=2*l,l=2*l+1,(r=Lb(s))[n]=null,r[l]=e,new ui(null,i,r))},h.Md=function(e,t,n,r){var i=1<<(t>>>e&31);if(0==(this.ra&i))return r;var o=mf(this.ra&i-1);return i=this.o[2*o],o=this.o[2*o+1],null==i?o.Md(e+5,t,n,r):ji(n,i)?new xh(i,o):r},h.Od=function(e,t,n){var r=1<<(t>>>e&31);if(0==(this.ra&r))return this;var i=mf(this.ra&r-1),o=this.o[2*i],l=this.o[2*i+1];return null==o?(e=l.Od(e+5,t,n))===l?this:null!=e?new ui(null,this.ra,pi(this.o,2*i+1,e)):this.ra===r?null:new ui(null,this.ra^r,qi(this.o,i)):ji(n,o)?this.ra===r?null:new ui(null,this.ra^r,qi(this.o,i)):this},h.xa=function(){return new ti(this.o)};var yi=new ui(null,0,[]);function Di(e,t,n){var r=e.o,i=r.length;e=Array(2*(e.H-1));for(var o=0,l=1,s=0;;){if(!(o<i))return new ui(t,s,e);o!==n&&null!=r[o]?(e[l]=r[o],l+=2,s|=1<<o,o+=1):o+=1}}function Ei(e){this.o=e,this.N=0,this.kc=null}function zi(e,t,n){this.ya=e,this.H=t,this.o=n,this.M=131072,this.B=0}function Hi(e,t,n){t*=2;for(var r=0;;){if(!(r<t))return-1;if(ji(n,e[r]))return r;r+=2}}function Ii(e,t,n,r){this.ya=e,this.Cc=t,this.H=n,this.o=r,this.M=131072,this.B=0}function Bi(e){switch(arguments.length){case 6:return Ci(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 7:return Ai(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function Ci(e,t,n,r,i,o){var l=xd(t);if(l===r)return new Ii(null,l,2,[t,n,i,o]);var s=new oi;return yi.ec(e,l,t,n,s).ec(e,r,i,o,s)}function Ai(e,t,n,r,i,o,l){var s=xd(n);if(s===i)return new Ii(null,s,2,[n,r,o,l]);var a=new oi;return yi.fc(e,t,s,n,r,a).fc(e,t,i,o,l,a)}function Ji(e,t,n,r,i){this.K=e,this.va=t,this.N=n,this.ka=r,this.G=i,this.B=32374988,this.M=0}function xi(e){switch(arguments.length){case 1:return wi(arguments[0]);case 3:return Ki(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function wi(e){return Ki(e,0,null)}function Ki(e,t,r){if(null!=r)return new Ji(null,e,t,r,null);for(r=e.length;;){if(!(t<r))return null;if(null!=e[t])return new Ji(null,e,t,null,null);var i=e[t+1];if(n(i)&&n(i=i.Nd()))return new Ji(null,e,t+2,i,null);t+=2}}function Li(e,t,n,r,i){this.K=e,this.va=t,this.N=n,this.ka=r,this.G=i,this.B=32374988,this.M=0}function Gi(e){switch(arguments.length){case 1:return Fi(arguments[0]);case 3:return Mi(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function Fi(e){return Mi(e,0,null)}function Mi(e,t,r){if(null!=r)return new Li(null,e,t,r,null);for(r=e.length;;){if(!(t<r))return null;var i=e[t];if(n(i)&&n(i=i.Nd()))return new Li(null,e,t+1,i,null);t+=1}}function Ni(e,t){this.cb=e,this.ag=t,this.bf=!1}function Oi(e,t,n,r,i,o){this.K=e,this.H=t,this.root=n,this.Ta=r,this.cb=i,this.G=o,this.B=16123663,this.M=139268}Ei.prototype.ua=function(){for(var e=this.o.length;;){if(null!=this.kc&&this.kc.ua())return!0;if(!(this.N<e))return!1;var t=this.o[this.N];this.N+=1,null!=t&&(this.kc=nd(t))}},Ei.prototype.next=function(){if(this.ua())return this.kc.next();throw Error("No such element")},Ei.prototype.remove=function(){return Error("Unsupported operation")},h=zi.prototype,h.Ec=function(e){return e===this.ya?this:new zi(e,this.H,Lb(this.o))},h.Pd=function(e,t,n,r,i){var o=n>>>t&31,l=this.o[o];return null==l||(t=l.Pd(e,t+5,n,r,i))===l?this:null==t?8>=this.H?Di(this,e,o):(--(e=ri(this,e,o,t)).H,e):ri(this,e,o,t)},h.Nd=function(){return Fi?Fi(this.o):Gi.call(null,this.o)},h.$c=function(e,t){for(var n=this.o.length,r=0;;){if(!(r<n))return t;var i=this.o[r];if(null!=i){if(Ud(t=i.$c(e,t)))return t;r+=1}else r+=1}},h.Pc=function(e,t,n,r){var i=this.o[t>>>e&31];return null!=i?i.Pc(e+5,t,n,r):r},h.fc=function(e,t,n,r,i,o){var l=n>>>t&31,s=this.o[l];return null==s?((e=ri(this,e,l,yi.fc(e,t+5,n,r,i,o))).H+=1,e):(t=s.fc(e,t+5,n,r,i,o))===s?this:ri(this,e,l,t)},h.ec=function(e,t,n,r,i){var o=t>>>e&31,l=this.o[o];return null==l?new zi(null,this.H+1,pi(this.o,o,yi.ec(e+5,t,n,r,i))):(e=l.ec(e+5,t,n,r,i))===l?this:new zi(null,this.H,pi(this.o,o,e))},h.Md=function(e,t,n,r){var i=this.o[t>>>e&31];return null!=i?i.Md(e+5,t,n,r):r},h.Od=function(e,t,n){var r=t>>>e&31,i=this.o[r];return null!=i?(e=i.Od(e+5,t,n))===i?this:null==e?8>=this.H?Di(this,null,r):new zi(null,this.H-1,pi(this.o,r,e)):new zi(null,this.H,pi(this.o,r,e)):this},h.xa=function(){return new Ei(this.o)},h=Ii.prototype,h.Ec=function(e){if(e===this.ya)return this;var t=Array(2*(this.H+1));return Ne(this.o,0,t,0,2*this.H),new Ii(e,this.Cc,this.H,t)},h.Pd=function(e,t,n,r,i){return-1===(t=Hi(this.o,this.H,r))?this:(i.v=!0,1===this.H?null:((i=(e=this.Ec(e)).o)[t]=i[2*this.H-2],i[t+1]=i[2*this.H-1],i[2*this.H-1]=null,i[2*this.H-2]=null,--e.H,e))},h.Nd=function(){return wi?wi(this.o):xi.call(null,this.o)},h.$c=function(e,t){return si(this.o,e,t)},h.Pc=function(e,t,n,r){return 0>(e=Hi(this.o,this.H,n))?r:ji(n,this.o[e])?this.o[e+1]:r},h.fc=function(e,t,n,r,i,o){return n===this.Cc?-1===(t=Hi(this.o,this.H,r))?this.o.length>2*this.H?(t=2*this.H,n=2*this.H+1,(e=this.Ec(e)).o[t]=r,e.o[n]=i,o.v=!0,e.H+=1,e):(n=this.o.length,t=Array(n+2),Ne(this.o,0,t,0,n),t[n]=r,t[n+1]=i,o.v=!0,r=this.H+1,e===this.ya?(this.o=t,this.H=r,e=this):e=new Ii(this.ya,this.Cc,r,t),e):this.o[t+1]===i?this:ri(this,e,t+1,i):new ui(e,1<<(this.Cc>>>t&31),[null,this,null,null]).fc(e,t,n,r,i,o)},h.ec=function(e,t,n,r,i){return t===this.Cc?-1===(e=Hi(this.o,this.H,n))?(e=2*this.H,t=Array(e+2),Ne(this.o,0,t,0,e),t[e]=n,t[e+1]=r,i.v=!0,new Ii(null,this.Cc,this.H+1,t)):x.h(this.o[e+1],r)?this:new Ii(null,this.Cc,this.H,pi(this.o,e+1,r)):new ui(null,1<<(this.Cc>>>e&31),[null,this]).ec(e,t,n,r,i)},h.Md=function(e,t,n,r){return 0>(e=Hi(this.o,this.H,n))?r:ji(n,this.o[e])?new xh(this.o[e],this.o[e+1]):r},h.Od=function(e,t,n){return-1===(e=Hi(this.o,this.H,n))?this:1===this.H?null:new Ii(null,this.Cc,this.H-1,qi(this.o,kf(e,2)))},h.xa=function(){return new ti(this.o)},h=Ji.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){if(null==this.ka){var e=this.va,t=this.N+2;return Ki?Ki(e,t,null):xi.call(null,e,t,null)}e=this.va,t=this.N;var n=B(this.ka);return Ki?Ki(e,t,n):xi.call(null,e,t,n)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return null==this.ka?new xh(this.va[this.N],this.va[this.N+1]):A(this.ka)},h.Ia=function(){var e,t,n=this,r=null==n.ka?(e=n.va,t=n.N+2,Ki?Ki(e,t,null):xi.call(null,e,t,null)):function(){var e=n.va,t=n.N,r=B(n.ka);return Ki?Ki(e,t,r):xi.call(null,e,t,r)}();return null!=r?r:Id},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new Ji(t,this.va,this.N,this.ka,this.G)},h.ia=function(e,t){return ke(t,this)},Ji.prototype[Gb]=function(){return Kd(this)},h=Li.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){var e=this.va,t=this.N,n=B(this.ka);return Mi?Mi(e,t,n):Gi.call(null,e,t,n)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return A(this.ka)},h.Ia=function(){var e=this.va,t=this.N,n=B(this.ka);return null!=(e=Mi?Mi(e,t,n):Gi.call(null,e,t,n))?e:Id},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new Li(t,this.va,this.N,this.ka,this.G)},h.ia=function(e,t){return ke(t,this)},Li.prototype[Gb]=function(){return Kd(this)},Ni.prototype.ua=function(){return!this.bf||this.ag.ua()},Ni.prototype.next=function(){return this.bf?this.ag.next():(this.bf=!0,new xh(null,this.cb))},Ni.prototype.remove=function(){return Error("Unsupported operation")},h=Oi.prototype,h.zc=function(e,t){return null==t?this.Ta?new xh(null,this.cb):null:null==this.root?null:this.root.Md(0,xd(t),t,null)},h.toString=function(){return pd(this)},h.keys=function(){return Kd(di.g?di.g(this):di.call(null,this))},h.entries=function(){return new Zh(z(z(this)))},h.values=function(){return Kd(ei.g?ei.g(this):ei.call(null,this))},h.has=function(e){return M(this,e)},h.get=function(e,t){return this.P(null,e,t)},h.forEach=function(e){for(var t=z(this),n=null,r=0,i=0;;)if(i<r){var o=n.$(null,i),l=G(o,0,null);o=G(o,1,null),e.h?e.h(o,l):e.call(null,o,l),i+=1}else{if(!(t=z(t)))return null;Me(t)?(n=ed(t),t=fd(t),l=n,r=C(n),n=l):(l=G(n=A(t),0,null),o=G(n,1,null),e.h?e.h(o,l):e.call(null,o,l),t=B(t),n=null,r=0),i=0}},h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){return null==t?this.Ta?this.cb:n:null==this.root?n:this.root.Pc(0,xd(t),t,n)},h.Ka=function(e,t,n){return Ud(e=this.Ta?t.j?t.j(n,null,this.cb):t.call(null,n,null,this.cb):n)?r(e):null!=this.root?Vd(this.root.$c(t,e)):e},h.xa=function(){var e=this.root?nd(this.root):eg();return this.Ta?new Ni(this.cb,e):e},h.R=function(){return this.K},h.da=function(){return this.H},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Pd(this)},h.aa=function(e,t){return Xh(this,t)},h.gd=function(){return new Pi(this.root,this.H,this.Ta,this.cb)},h.sa=function(){return Bc(hi,this.K)},h.bb=function(e,t){return null==t?this.Ta?new Oi(this.K,this.H-1,this.root,!1,null,null):this:null==this.root||(e=this.root.Od(0,xd(t),t))===this.root?this:new Oi(this.K,this.H-1,e,this.Ta,this.cb,null)},h.ja=function(e,t,n){return null==t?this.Ta&&n===this.cb?this:new Oi(this.K,this.Ta?this.H:this.H+1,this.root,!0,n,null):(e=new oi,(t=(null==this.root?yi:this.root).ec(0,xd(t),t,n,e))===this.root?this:new Oi(this.K,e.v?this.H+1:this.H,t,this.Ta,this.cb,null))},h.za=function(e,t){return null==t?this.Ta:null!=this.root&&this.root.Pc(0,xd(t),t,Oe)!==Oe},h.ca=function(){if(0<this.H){var e=null!=this.root?this.root.Nd():null;return this.Ta?ke(new xh(null,this.cb),e):e}return null},h.S=function(e,t){return t===this.K?this:new Oi(t,this.H,this.root,this.Ta,this.cb,this.G)},h.ia=function(e,t){if(Le(t))return this.ja(null,Zb(t,0),Zb(t,1));for(e=this,t=z(t);;){if(null==t)return e;var n=A(t);if(!Le(n))throw Error("conj on a map takes map entries or seqables of map entries");e=lc(e,Zb(n,0),Zb(n,1)),t=B(t)}},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.na(null,e)},h.h=function(e,t){return this.P(null,e,t)};var hi=new Oi(null,0,null,!1,null,Qd);function Qi(e){for(var t=e.length,n=0,r=Xc(hi);;){if(!(n<t))return Zc(r);var i=n+2;r=$c(r,e[n],e[n+1]),n=i}}function Ri(e,t){for(var n=e.length,r=0,i=Xc(hi);;){if(!(r<n))return Zc(i);if(t.length<=r)throw Error(["No value supplied for key: ",p.g(e[r])].join(""));var o=r+1;i=$c(i,e[r],t[r]),r=o}}function Pi(e,t,n,r){this.ya={},this.root=e,this.count=t,this.Ta=n,this.cb=r,this.B=259,this.M=56}function Si(e,t,n){if(e.ya){if(null==t)e.cb!==n&&(e.cb=n),e.Ta||(e.count+=1,e.Ta=!0);else{var r=new oi;(t=(null==e.root?yi:e.root).fc(e.ya,0,xd(t),t,n,r))!==e.root&&(e.root=t),r.v&&(e.count+=1)}return e}throw Error("assoc! after persistent!")}function Ti(e,t,n){for(var r=t;;){if(null==e)return r;t=n?e.left:e.right,r=re.h(r,e),e=t}}function Ui(e,t,n,r,i){this.K=e,this.stack=t,this.Rc=n,this.H=r,this.G=i,this.B=32374990,this.M=0}function Vi(e,t,n){return new Ui(null,Ti(e,null,t),t,n,null)}function Wi(e,t,n,r){return n instanceof Xi?n.left instanceof Xi?new Xi(n.key,n.v,n.left.vc(),new Yi(e,t,n.right,r)):n.right instanceof Xi?new Xi(n.right.key,n.right.v,new Yi(n.key,n.v,n.left,n.right.left),new Yi(e,t,n.right.right,r)):new Yi(e,t,n,r):new Yi(e,t,n,r)}function Zi(e,t,n,r){return r instanceof Xi?r.right instanceof Xi?new Xi(r.key,r.v,new Yi(e,t,n,r.left),r.right.vc()):r.left instanceof Xi?new Xi(r.left.key,r.left.v,new Yi(e,t,n,r.left.left),new Yi(r.key,r.v,r.left.right,r.right)):new Yi(e,t,n,r):new Yi(e,t,n,r)}function $i(e,t,n,r){if(n instanceof Xi)return new Xi(e,t,n.vc(),r);if(r instanceof Yi)return Zi(e,t,n,r.Td());if(r instanceof Xi&&r.left instanceof Yi)return new Xi(r.left.key,r.left.v,new Yi(e,t,n,r.left.left),Zi(r.key,r.v,r.left.right,r.right.Td()));throw Error("red-black tree invariant violation")}function aj(e,t,n,r){if(r instanceof Xi)return new Xi(e,t,n,r.vc());if(n instanceof Yi)return Wi(e,t,n.Td(),r);if(n instanceof Xi&&n.right instanceof Yi)return new Xi(n.right.key,n.right.v,Wi(n.key,n.v,n.left.Td(),n.right.left),new Yi(e,t,n.right.right,r));throw Error("red-black tree invariant violation")}Oi.prototype[Gb]=function(){return Kd(this)},h=Pi.prototype,h.da=function(){if(this.ya)return this.count;throw Error("count after persistent!")},h.na=function(e,t){return null==t?this.Ta?this.cb:null:null==this.root?null:this.root.Pc(0,xd(t),t)},h.P=function(e,t,n){return null==t?this.Ta?this.cb:n:null==this.root?n:this.root.Pc(0,xd(t),t,n)},h.kd=function(e,t){e:{if(!this.ya)throw Error("conj! after persistent");if(Fh(t))e=Si(this,Gh.g?Gh.g(t):Gh.call(null,t),Hh.g?Hh.g(t):Hh.call(null,t));else if(Le(t))e=Si(this,t.g?t.g(0):t.call(null,0),t.g?t.g(1):t.call(null,1));else for(e=z(t),t=this;;){var r=A(e);if(!n(r)){e=t;break e}e=B(e),t=Si(t,Gh.g?Gh.g(r):Gh.call(null,r),Hh.g?Hh.g(r):Hh.call(null,r))}}return e},h.Ed=function(){if(!this.ya)throw Error("persistent! called twice");return this.ya=null,new Oi(null,this.count,this.root,this.Ta,this.cb,null)},h.jd=function(e,t,n){return Si(this,t,n)},h.Ke=function(e,t){if(!this.ya)throw Error("dissoc! after persistent!");return null==t?this.Ta&&(this.Ta=!1,this.cb=null,--this.count):null!=this.root&&(e=new oi,(t=this.root.Pd(this.ya,0,xd(t),t,e))!==this.root&&(this.root=t),e.v&&--this.count),this},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.na(null,e)},h.h=function(e,t){return this.P(null,e,t)},h=Ui.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.K},h.Aa=function(){var e=A(this.stack);return null==(e=Ti(this.Rc?e.right:e.left,B(this.stack),this.Rc))?null:new Ui(null,e,this.Rc,this.H-1,null)},h.da=function(){return 0>this.H?C(B(this))+1:this.H},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return Be(this.stack)},h.Ia=function(){var e=A(this.stack);return null!=(e=Ti(this.Rc?e.right:e.left,B(this.stack),this.Rc))?new Ui(null,e,this.Rc,this.H-1,null):Id},h.ca=function(){return this},h.S=function(e,t){return t===this.K?this:new Ui(t,this.stack,this.Rc,this.H,this.G)},h.ia=function(e,t){return ke(t,this)},Ui.prototype[Gb]=function(){return Kd(this)};var bj=function e(t,n,r){var i,o=null!=t.left?(i=t.left,e.j?e.j(i,n,r):e.call(null,i,n,r)):r;if(Ud(o))return o;var l=function(){var e=t.key,r=t.v;return n.j?n.j(o,e,r):n.call(null,o,e,r)}();if(Ud(l))return l;if(null!=t.right){var s=t.right;return e.j?e.j(s,n,l):e.call(null,s,n,l)}return l};function Yi(e,t,n,r){this.key=e,this.v=t,this.left=n,this.right=r,this.G=null,this.B=166619935,this.M=0}function Xi(e,t,n,r){this.key=e,this.v=t,this.left=n,this.right=r,this.G=null,this.B=166619935,this.M=0}h=Yi.prototype,h.zc=function(e,t){switch(t){case 0:return new xh(0,this.key);case 1:return new xh(1,this.v);default:return null}},h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.rf=function(e){return e.uf(this)},h.Td=function(){return new Xi(this.key,this.v,this.left,this.right)},h.vc=function(){return this},h.qf=function(e){return e.tf(this)},h.replace=function(e,t,n,r){return new Yi(e,t,n,r)},h.tf=function(e){return new Yi(e.key,e.v,this,e.right)},h.uf=function(e){return new Yi(e.key,e.v,e.left,this)},h.$c=function(e,t){return bj(this,e,t)},h.na=function(e,t){return this.Ba(null,t,null)},h.P=function(e,t,n){return this.Ba(null,t,n)},h.$=function(e,t){if(0===t)return this.key;if(1===t)return this.v;throw Error("Index out of bounds")},h.Ba=function(e,t,n){return 0===t?this.key:1===t?this.v:n},h.Kb=function(e,t,n){return new Q(null,2,5,S,[this.key,this.v],null).Kb(null,t,n)},h.R=function(){return null},h.da=function(){return 2},h.He=function(){return this.key},h.Ie=function(){return this.v},h.Ub=function(){return this.v},h.Vb=function(){return new Q(null,1,5,S,[this.key],null)},h.Ac=function(){return new Fd([this.v,this.key],0,null)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return null},h.Ea=function(e,t){return Xd(this,t)},h.Fa=function(e,t,n){return Yd(this,t,n)},h.ja=function(e,t,n){return I.j(new Q(null,2,5,S,[this.key,this.v],null),t,n)},h.za=function(e,t){return 0===t||1===t},h.ca=function(){return new Fd([this.key,this.v],0,null)},h.S=function(e,t){return Bc(new Q(null,2,5,S,[this.key,this.v],null),t)},h.ia=function(e,t){return new Q(null,3,5,S,[this.key,this.v,t],null)},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.$(null,e)},h.h=function(e,t){return this.Ba(null,e,t)},Yi.prototype[Gb]=function(){return Kd(this)},h=Xi.prototype,h.zc=function(e,t){switch(t){case 0:return new xh(0,this.key);case 1:return new xh(1,this.v);default:return null}},h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.rf=function(e){return new Xi(this.key,this.v,this.left,e)},h.Td=function(){throw Error("red-black tree invariant violation")},h.vc=function(){return new Yi(this.key,this.v,this.left,this.right)},h.qf=function(e){return new Xi(this.key,this.v,e,this.right)},h.replace=function(e,t,n,r){return new Xi(e,t,n,r)},h.tf=function(e){return this.left instanceof Xi?new Xi(this.key,this.v,this.left.vc(),new Yi(e.key,e.v,this.right,e.right)):this.right instanceof Xi?new Xi(this.right.key,this.right.v,new Yi(this.key,this.v,this.left,this.right.left),new Yi(e.key,e.v,this.right.right,e.right)):new Yi(e.key,e.v,this,e.right)},h.uf=function(e){return this.right instanceof Xi?new Xi(this.key,this.v,new Yi(e.key,e.v,e.left,this.left),this.right.vc()):this.left instanceof Xi?new Xi(this.left.key,this.left.v,new Yi(e.key,e.v,e.left,this.left.left),new Yi(this.key,this.v,this.left.right,this.right)):new Yi(e.key,e.v,e.left,this)},h.$c=function(e,t){return bj(this,e,t)},h.na=function(e,t){return this.Ba(null,t,null)},h.P=function(e,t,n){return this.Ba(null,t,n)},h.$=function(e,t){if(0===t)return this.key;if(1===t)return this.v;throw Error("Index out of bounds")},h.Ba=function(e,t,n){return 0===t?this.key:1===t?this.v:n},h.Kb=function(e,t,n){return new Q(null,2,5,S,[this.key,this.v],null).Kb(null,t,n)},h.R=function(){return null},h.da=function(){return 2},h.He=function(){return this.key},h.Ie=function(){return this.v},h.Ub=function(){return this.v},h.Vb=function(){return new Q(null,1,5,S,[this.key],null)},h.Ac=function(){return new Fd([this.v,this.key],0,null)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return null},h.Ea=function(e,t){return Xd(this,t)},h.Fa=function(e,t,n){return Yd(this,t,n)},h.ja=function(e,t,n){return I.j(new Q(null,2,5,S,[this.key,this.v],null),t,n)},h.za=function(e,t){return 0===t||1===t},h.ca=function(){return new Fd([this.key,this.v],0,null)},h.S=function(e,t){return Bc(new Q(null,2,5,S,[this.key,this.v],null),t)},h.ia=function(e,t){return new Q(null,3,5,S,[this.key,this.v,t],null)},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.$(null,e)},h.h=function(e,t){return this.Ba(null,e,t)},Xi.prototype[Gb]=function(){return Kd(this)};var cj=function e(t,n,r,i,o){if(null==n)return new Xi(r,i,null,null);var l,s=(l=n.key,t.h?t.h(r,l):t.call(null,r,l));return 0===s?(o[0]=n,null):0>s?(s=function(){var l=n.left;return e.O?e.O(t,l,r,i,o):e.call(null,t,l,r,i,o)}(),null!=s?n.qf(s):null):(s=function(){var l=n.right;return e.O?e.O(t,l,r,i,o):e.call(null,t,l,r,i,o)}(),null!=s?n.rf(s):null)},dj=function e(t,n){if(null==t)return n;if(null==n)return t;if(t instanceof Xi){if(n instanceof Xi){var r=function(){var r=t.right,i=n.left;return e.h?e.h(r,i):e.call(null,r,i)}();return r instanceof Xi?new Xi(r.key,r.v,new Xi(t.key,t.v,t.left,r.left),new Xi(n.key,n.v,r.right,n.right)):new Xi(t.key,t.v,t.left,new Xi(n.key,n.v,r,n.right))}return new Xi(t.key,t.v,t.left,function(){var r=t.right;return e.h?e.h(r,n):e.call(null,r,n)}())}return n instanceof Xi?new Xi(n.key,n.v,function(){var r=n.left;return e.h?e.h(t,r):e.call(null,t,r)}(),n.right):(r=function(){var r=t.right,i=n.left;return e.h?e.h(r,i):e.call(null,r,i)}(),r instanceof Xi?new Xi(r.key,r.v,new Yi(t.key,t.v,t.left,r.left),new Yi(n.key,n.v,r.right,n.right)):$i(t.key,t.v,t.left,new Yi(n.key,n.v,r,n.right)))},ej=function e(t,n,r,i){if(null!=n){var o=function(){var e=n.key;return t.h?t.h(r,e):t.call(null,r,e)}();return 0===o?(i[0]=n,dj(n.left,n.right)):0>o?(o=function(){var o=n.left;return e.F?e.F(t,o,r,i):e.call(null,t,o,r,i)}(),null!=o||null!=i[0]?n.left instanceof Yi?$i(n.key,n.v,o,n.right):new Xi(n.key,n.v,o,n.right):null):(o=function(){var o=n.right;return e.F?e.F(t,o,r,i):e.call(null,t,o,r,i)}(),null!=o||null!=i[0]?n.right instanceof Yi?aj(n.key,n.v,n.left,o):new Xi(n.key,n.v,n.left,o):null)}return null},fj=function e(t,n,r,i){var o,l=n.key,s=t.h?t.h(r,l):t.call(null,r,l);return 0===s?n.replace(l,i,n.left,n.right):0>s?n.replace(l,n.v,(o=n.left,e.F?e.F(t,o,r,i):e.call(null,t,o,r,i)),n.right):n.replace(l,n.v,n.left,function(){var o=n.right;return e.F?e.F(t,o,r,i):e.call(null,t,o,r,i)}())};function gj(e,t,n,r,i){this.Ob=e,this.Kc=t,this.H=n,this.K=r,this.G=i,this.B=418776847,this.M=8192}function hj(e,t){for(var n=e.Kc;;){if(null==n)return null;var r=n.key;if(0===(r=e.Ob.h?e.Ob.h(t,r):e.Ob.call(null,t,r)))return n;n=0>r?n.left:n.right}}h=gj.prototype,h.zc=function(e,t){return hj(this,t)},h.forEach=function(e){for(var t=z(this),n=null,r=0,i=0;;)if(i<r){var o=n.$(null,i),l=G(o,0,null);o=G(o,1,null),e.h?e.h(o,l):e.call(null,o,l),i+=1}else{if(!(t=z(t)))return null;Me(t)?(n=ed(t),t=fd(t),l=n,r=C(n),n=l):(l=G(n=A(t),0,null),o=G(n,1,null),e.h?e.h(o,l):e.call(null,o,l),t=B(t),n=null,r=0),i=0}},h.get=function(e,t){return this.P(null,e,t)},h.entries=function(){return new Zh(z(z(this)))},h.toString=function(){return pd(this)},h.keys=function(){return Kd(di.g?di.g(this):di.call(null,this))},h.values=function(){return Kd(ei.g?ei.g(this):ei.call(null,this))},h.has=function(e){return M(this,e)},h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){return null!=(e=hj(this,t))?e.v:n},h.Ka=function(e,t,n){return null!=this.Kc?Vd(bj(this.Kc,t,n)):n},h.R=function(){return this.K},h.da=function(){return this.H},h.Ac=function(){return 0<this.H?Vi(this.Kc,!1,this.H):null},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Pd(this)},h.aa=function(e,t){return Xh(this,t)},h.sa=function(){return new gj(this.Ob,null,0,this.K,0)},h.bb=function(e,t){return e=[null],null==(t=ej(this.Ob,this.Kc,t,e))?null==ee(e,0)?this:new gj(this.Ob,null,0,this.K,null):new gj(this.Ob,t.vc(),this.H-1,this.K,null)},h.ja=function(e,t,n){e=[null];var r=cj(this.Ob,this.Kc,t,n,e);return null==r?(e=ee(e,0),x.h(n,e.v)?this:new gj(this.Ob,fj(this.Ob,this.Kc,t,n),this.H,this.K,null)):new gj(this.Ob,r.vc(),this.H+1,this.K,null)},h.za=function(e,t){return null!=hj(this,t)},h.ca=function(){return 0<this.H?Vi(this.Kc,!0,this.H):null},h.S=function(e,t){return t===this.K?this:new gj(this.Ob,this.Kc,this.H,t,this.G)},h.ia=function(e,t){if(Le(t))return this.ja(null,Zb(t,0),Zb(t,1));for(e=this,t=z(t);;){if(null==t)return e;var n=A(t);if(!Le(n))throw Error("conj on a map takes map entries or seqables of map entries");e=lc(e,Zb(n,0),Zb(n,1)),t=B(t)}},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.na(null,e)},h.h=function(e,t){return this.P(null,e,t)};var ij=new gj(Ue,null,0,null,Qd);gj.prototype[Gb]=function(){return Kd(this)};var jj=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};jj.l=function(e){e=z(e);for(var t=Xc(hi);;){if(!e)return Zc(t);var n=B(e);if(null==n)throw Error(["No value supplied for key: ",p.g(A(e))].join(""));var r=B(n);t=Qf(t,A(e),A(n)),e=r}},jj.I=0,jj.J=function(e){return this.l(z(e))};var kj=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};function lj(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;e:for(t=z(0<t.length?new Fd(t.slice(0),0,null):null),r=ij;t;)n=B(B(t)),r=I.j(r,A(t),oe(t)),t=n;return r}function mj(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;e:for(n=arguments[0],t=z(1<t.length?new Fd(t.slice(1),0,null):null),r=new gj(We(n),null,0,null,0);t;)n=B(B(t)),r=I.j(r,A(t),oe(t)),t=n;return r}function nj(e,t){this.qa=e,this.Mb=t,this.B=32374988,this.M=0}function di(e){return(e=z(e))?new nj(e,null):null}function Gh(e){return pc(e)}function oj(e,t){this.qa=e,this.Mb=t,this.B=32374988,this.M=0}function ei(e){return(e=z(e))?new oj(e,null):null}function Hh(e){return qc(e)}kj.l=function(e){if(!wg((e=e instanceof Fd&&0===e.N?e.o:Mb(e)).length))throw Error(["No value supplied for key: ",p.g(qe(e))].join(""));return ve(e)},kj.I=0,kj.J=function(e){return this.l(z(e))},h=nj.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.Mb},h.Aa=function(){var e=(null!=this.qa?128&this.qa.B||cb===this.qa.Cd||!this.qa.B&&Cb(dc,this.qa):Cb(dc,this.qa))?this.qa.Aa(null):B(this.qa);return null==e?null:new nj(e,null)},h.ba=function(){return Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return this.qa.Ga(null).key},h.Ia=function(){var e=(null!=this.qa?128&this.qa.B||cb===this.qa.Cd||!this.qa.B&&Cb(dc,this.qa):Cb(dc,this.qa))?this.qa.Aa(null):B(this.qa);return null!=e?new nj(e,null):Id},h.ca=function(){return this},h.S=function(e,t){return t===this.Mb?this:new nj(this.qa,t)},h.ia=function(e,t){return ke(t,this)},nj.prototype[Gb]=function(){return Kd(this)},h=oj.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.R=function(){return this.Mb},h.Aa=function(){var e=(null!=this.qa?128&this.qa.B||cb===this.qa.Cd||!this.qa.B&&Cb(dc,this.qa):Cb(dc,this.qa))?this.qa.Aa(null):B(this.qa);return null==e?null:new oj(e,null)},h.ba=function(){return Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){return ne(t,n,this)},h.Ga=function(){return this.qa.Ga(null).v},h.Ia=function(){var e=(null!=this.qa?128&this.qa.B||cb===this.qa.Cd||!this.qa.B&&Cb(dc,this.qa):Cb(dc,this.qa))?this.qa.Aa(null):B(this.qa);return null!=e?new oj(e,null):Id},h.ca=function(){return this},h.S=function(e,t){return t===this.Mb?this:new oj(this.qa,t)},h.ia=function(e,t){return ke(t,this)},oj.prototype[Gb]=function(){return Kd(this)};var pj=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};pj.l=function(e){return n(vg(bf,e))?Nb.h((function(e,t){return re.h(n(e)?e:P,t)}),e):null},pj.I=0,pj.J=function(e){return this.l(z(e))};var qj=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],1<n.length?new Fd(n.slice(1),0,null):null)};function rj(e,t){var n=P;for(t=z(t);;){if(!t)return Bc(n,Ae(e));var r=A(t),i=u.j(e,r,sj);n=cg.h(i,sj)?I.j(n,r,i):n,t=B(t)}}function tj(e){this.sd=e}function uj(e,t,n){this.K=e,this.Fc=t,this.G=n,this.B=15077647,this.M=139268}qj.l=function(e,t){if(n(vg(bf,t))){var r=function(t,n){var r=pc(n),i=qc(n);if(M(t,r)){n=I.j;var o=u.h(t,r);i=e.h?e.h(o,i):e.call(null,o,i),t=n.call(I,t,r,i)}else t=I.j(t,r,i);return t};return Nb.h((function(e,t){return Nb.j(r,n(e)?e:P,z(t))}),t)}return null},qj.I=1,qj.J=function(e){var t=A(e);return e=B(e),this.l(t,e)},tj.prototype.ua=function(){return this.sd.ua()},tj.prototype.next=function(){if(this.sd.ua())return this.sd.next().key;throw Error("No such element")},tj.prototype.remove=function(){return Error("Unsupported operation")},h=uj.prototype,h.toString=function(){return pd(this)},h.keys=function(){return Kd(z(this))},h.entries=function(){return new $h(z(z(this)))},h.values=function(){return Kd(z(this))},h.has=function(e){return M(this,e)},h.forEach=function(e){for(var t=z(this),n=null,r=0,i=0;;)if(i<r){var o=n.$(null,i),l=G(o,0,null);o=G(o,1,null),e.h?e.h(o,l):e.call(null,o,l),i+=1}else{if(!(t=z(t)))return null;Me(t)?(n=ed(t),t=fd(t),l=n,r=C(n),n=l):(l=G(n=A(t),0,null),o=G(n,1,null),e.h?e.h(o,l):e.call(null,o,l),t=B(t),n=null,r=0),i=0}},h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,r){return n(e=mc(this.Fc,t))?pc(e):r},h.xa=function(){return new tj(nd(this.Fc))},h.R=function(){return this.K},h.da=function(){return Tb(this.Fc)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Pd(this)},h.aa=function(e,t){if(!(e=Ge(t)))return e;if(!(e=C(this)===C(t)))return e;try{return af((function(e,n){return(e=M(t,n))?e:Td(!1)}),!0,this.Fc)}catch(e){if(e instanceof Error)return!1;throw e}},h.gd=function(){return new vj(Xc(this.Fc))},h.sa=function(){return Bc(wj,this.K)},h.Cf=function(e,t){return new uj(this.K,oc(this.Fc,t),null)},h.ca=function(){return di(this.Fc)},h.S=function(e,t){return t===this.K?this:new uj(t,this.Fc,this.G)},h.ia=function(e,t){return new uj(this.K,I.j(this.Fc,t,null),null)},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return this.na(null,e)},h.h=function(e,t){return this.P(null,e,t)};var wj=new uj(null,P,Qd);function xj(e){for(var t=e.length,n=Xc(wj),r=0;r<t;)Yc(n,e[r]),r+=1;return Zc(n)}function vj(e){this.bd=e,this.M=136,this.B=259}function yj(e){if(Ge(e))return ze(e,null);if(null==(e=z(e)))return wj;if(e instanceof Fd&&0===e.N)return xj(e.o);for(var t=Xc(wj);;){if(null==e)return Zc(t);var n=B(e);t=Yc(t,bc(e)),e=n}}function zj(e){return function e(t,n){return new Df(null,(function(){var r;e:{var i=t;for(r=n;;){var o=i;if(i=G(o,0,null),!(o=z(o))){r=null;break e}if(!M(r,i)){r=ke(i,e(Hd(o),re.h(r,i)));break e}i=Hd(o)}}return r}),null,null)}(e,wj)}function Aj(e){for(var t=F;;){if(!B(e))return z(t);t=re.h(t,A(e)),e=B(e)}}function Cf(e){if(null!=e&&(4096&e.M||cb===e.Kg))return e.Ad(null);if("string"==typeof e)return e;throw Error(["Doesn't support name: ",p.g(e)].join(""))}function Bj(e,t){var n=Xc(P);for(e=z(e),t=z(t);;){if(!e||!t)return Zc(n);n=Qf(n,A(e),A(t)),e=B(e),t=B(t)}}uj.prototype[Gb]=function(){return Kd(this)},h=vj.prototype,h.kd=function(e,t){return this.bd=$c(this.bd,t,null),this},h.Ed=function(){return new uj(null,Zc(this.bd),null)},h.da=function(){return C(this.bd)},h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){return hc(this.bd,t,Oe)===Oe?n:t},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return hc(this.bd,e,Oe)===Oe?null:e},h.h=function(e,t){return hc(this.bd,e,Oe)===Oe?t:e};var Cj=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],arguments[2],new Fd(n.slice(3),0,null))}};function Dj(){this.o=[]}function Ej(){return function(e){var t=new Dj;return function(){function r(n,r){return t.add(r),2===t.size()?(r=Eh(t.o),t.clear(),e.h?e.h(n,r):e.call(null,n,r)):n}function i(r){if(!n(t.Qd())){var i=Eh(t.o);t.clear(),r=Vd(e.h?e.h(r,i):e.call(null,r,i))}return e.g?e.g(r):e.call(null,r)}function o(){return e.A?e.A():e.call(null)}var l;return l=function(e,t){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,e);case 2:return r.call(this,e,t)}throw Error("Invalid arity: "+arguments.length)},l.A=o,l.g=i,l.h=r,l}()}}function Yt(e,t,n){return new Df(null,(function(){var r=z(n);return r?ke(Og.h(e,r),Yt(e,t,Pg(t,r))):null}),null,null)}function Fj(e,t){return new Df(null,(function(){var r=z(t);if(r){var i=A(r);r=n(i=e.g?e.g(i):e.call(null,i))?ke(A(r),Fj(e,Hd(r))):null}else r=null;return r}),null,null)}function Gj(e,t,n){this.start=e,this.step=t,this.count=n,this.B=82,this.M=0}function Hj(e,t,n){this.N=e,this.end=t,this.step=n}function Ij(e,t,n,r,i,o,l){this.K=e,this.start=t,this.end=n,this.step=r,this.Oa=i,this.yc=o,this.G=l,this.B=32375006,this.M=140800}function Jj(e,t,n,r,i,o,l){this.K=e,this.start=t,this.end=n,this.step=r,this.Oa=i,this.yc=o,this.G=l,this.M=140800,this.B=32374988}function Kj(e){return 1>=e?Id:Se(1)&&Se(e)&&Se(1)?new Ij(null,1,e,1,null,null,null):new Jj(null,1,e,1,null,null,null)}function Lj(e,t){return new Df(null,(function(){var n=z(t);return n?ke(A(n),Lj(e,Pg(e,n))):null}),null,null)}function Mj(e){return Zc(Nb.j((function(e,t){return Qf(e,t,u.j(e,t,0)+1)}),Xc(P),e))}function Nj(e,t){return function(){function n(n,r,i){return new Q(null,2,5,S,[e.j?e.j(n,r,i):e.call(null,n,r,i),t.j?t.j(n,r,i):t.call(null,n,r,i)],null)}function r(n,r){return new Q(null,2,5,S,[e.h?e.h(n,r):e.call(null,n,r),t.h?t.h(n,r):t.call(null,n,r)],null)}function i(n){return new Q(null,2,5,S,[e.g?e.g(n):e.call(null,n),t.g?t.g(n):t.call(null,n)],null)}function o(){return new Q(null,2,5,S,[e.A?e.A():e.call(null),t.A?t.A():t.call(null)],null)}var l,s=function(){function n(e,t,n,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return r.call(this,e,t,n,o)}function r(n,r,i,o){return new Q(null,2,5,S,[$f(e,n,r,i,o),$f(t,n,r,i,o)],null)}return n.I=3,n.J=function(e){return r(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},n.l=r,n}();return l=function(e,t,l,a){switch(arguments.length){case 0:return o.call(this);case 1:return i.call(this,e);case 2:return r.call(this,e,t);case 3:return n.call(this,e,t,l);default:var u=null;if(3<arguments.length){u=0;for(var c=Array(arguments.length-3);u<c.length;)c[u]=arguments[u+3],++u;u=new Fd(c,0,null)}return s.l(e,t,l,u)}},l.I=3,l.J=s.J,l.A=o,l.g=i,l.h=r,l.j=n,l.l=s.l,l}()}function Oj(e){e:for(var t=e;t=z(t);)t=B(t);return e}function Pj(e,t){if("string"==typeof t)return null!=(e=e.exec(t))&&x.h(e[0],t)?1===e.length?e[0]:Eh(e):null;throw new TypeError("re-matches must match against a string.")}function Qj(e,t){if("string"==typeof t)return null==(e=e.exec(t))?null:1===e.length?e[0]:Eh(e);throw new TypeError("re-find must match against a string.")}Cj.h=function(e,t){return t},Cj.j=function(e,t,n){return(e.g?e.g(t):e.call(null,t))>(e.g?e.g(n):e.call(null,n))?t:n},Cj.l=function(e,t,n,r){return Nb.j((function(t,n){return Cj.j(e,t,n)}),Cj.j(e,t,n),r)},Cj.J=function(e){var t=A(e),n=B(e);e=A(n);var r=B(n);return n=A(r),r=B(r),this.l(t,e,n,r)},Cj.I=3,Dj.prototype.add=function(e){return this.o.push(e)},Dj.prototype.size=function(){return this.o.length},Dj.prototype.clear=function(){return this.o=[]},Dj.prototype.Qd=function(){return 0===this.o.length},h=Gj.prototype,h.da=function(){return this.count},h.Ga=function(){return this.start},h.$=function(e,t){return this.start+t*this.step},h.Ba=function(e,t,n){return 0<=t&&t<this.count?this.start+t*this.step:n},h.Fe=function(){if(1>=this.count)throw Error("-drop-first of empty chunk");return new Gj(this.start+this.step,this.step,this.count-1)},Hj.prototype.ua=function(){return 0<this.step?this.N<this.end:this.N>this.end},Hj.prototype.next=function(){var e=this.N;return this.N+=this.step,e},h=Ij.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.Kd=function(){if(null==this.Oa){var e=this.da(null);32<e?(this.yc=new Ij(null,this.start+32*this.step,this.end,this.step,null,null,null),this.Oa=new Gj(this.start,this.step,32)):this.Oa=new Gj(this.start,this.step,e)}},h.$=function(e,t){if(0<=t&&t<this.da(null))return this.start+t*this.step;if(0<=t&&this.start>this.end&&0===this.step)return this.start;throw Error("Index out of bounds")},h.Ba=function(e,t,n){return 0<=t&&t<this.da(null)?this.start+t*this.step:0<=t&&this.start>this.end&&0===this.step?this.start:n},h.xa=function(){return new Hj(this.start,this.end,this.step)},h.R=function(){return this.K},h.Aa=function(){return 0<this.step?this.start+this.step<this.end?new Ij(null,this.start+this.step,this.end,this.step,null,null,null):null:this.start+this.step>this.end?new Ij(null,this.start+this.step,this.end,this.step,null,null,null):null},h.da=function(){return Math.ceil((this.end-this.start)/this.step)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return Xd(this,t)},h.Fa=function(e,t,n){for(e=this.start;;){if(!(0<this.step?e<this.end:e>this.end))return n;if(Ud(n=t.h?t.h(n,e):t.call(null,n,e)))return r(n);e+=this.step}},h.Ga=function(){return this.start},h.Ia=function(){var e=this.Aa(null);return null==e?Id:e},h.ca=function(){return this},h.yd=function(){return this.Kd(),this.Oa},h.Mc=function(){return this.Kd(),null==this.yc?Id:this.yc},h.S=function(e,t){return t===this.K?this:new Ij(t,this.start,this.end,this.step,this.Oa,this.yc,this.G)},h.ia=function(e,t){return ke(t,this)},h.be=function(){return z(this.Mc(null))},Ij.prototype[Gb]=function(){return Kd(this)},h=Jj.prototype,h.toString=function(){return pd(this)},h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.Kd=function(){if(null==this.Oa){var e=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];e:for(var t=0,n=this.start;;){if(!(32>t)){t=n;break e}if(e[t]=n,t+=1,n+=this.step,!(0<this.step?n<this.end:n>this.end)){t=this.Oa=new Gf(e,0,t);break e}}null==this.Oa&&(this.Oa=new Gf(e,0,32),(0<this.step?t<this.end:t>this.end)&&(this.yc=new Jj(null,t,this.end,this.step,null,null,null)))}},h.xa=function(){return new Hj(this.start,this.end,this.step)},h.R=function(){return this.K},h.Aa=function(){return 0<this.step?this.start+this.step<this.end?new Jj(null,this.start+this.step,this.end,this.step,null,null,null):null:this.start+this.step>this.end?new Jj(null,this.start+this.step,this.end,this.step,null,null,null):null},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=Nd(this)},h.aa=function(e,t){return je(this,t)},h.sa=function(){return Id},h.Ea=function(e,t){return le(t,this)},h.Fa=function(e,t,n){for(e=this.start;;){if(!(0<this.step?e<this.end:e>this.end))return n;if(Ud(n=t.h?t.h(n,e):t.call(null,n,e)))return r(n);e+=this.step}},h.Ga=function(){return this.start},h.Ia=function(){var e=this.Aa(null);return null==e?Id:e},h.ca=function(){return this},h.yd=function(){return this.Kd(),this.Oa},h.Mc=function(){return this.Kd(),null==this.yc?Id:this.yc},h.S=function(e,t){return t===this.K?this:new Jj(t,this.start,this.end,this.step,this.Oa,this.yc,this.G)},h.ia=function(e,t){return ke(t,this)},h.be=function(){return z(this.Mc(null))},Jj.prototype[Gb]=function(){return Kd(this)};var Rj=function e(t,n){var r=t.exec(n);if(null==r)return null;var i=r[0];return ke(1===r.length?i:Eh(r),new Df(null,(function(){var o=i.length;return(o=r.index+(1>o?1:o))<=n.length?(o=n.substring(o),e.h?e.h(t,o):e.call(null,t,o)):null}),null,null))};function Sj(e){if(e instanceof RegExp)return e;var t=Qj(/^\(\?([idmsux]*)\)/,e),r=G(t,0,null);return t=G(t,1,null),new RegExp(e.substring(null==r?0:r.length),n(t)?t:"")}function Tj(e,t,r,i,o,l,s){var a,u=jb;jb=null==jb?null:jb-1;try{if(null!=jb&&0>jb)return Qc(e,"#");if(Qc(e,r),0===tb.g(l))z(s)&&Qc(e,n(a=Uj.g(l))?a:"...");else{if(z(s)){var c=A(s);t.j?t.j(c,e,l):t.call(null,c,e,l)}for(var h=B(s),d=tb.g(l)-1;;){if(!h||null!=d&&0===d){z(h)&&0===d&&(Qc(e,i),Qc(e,function(){var e=Uj.g(l);return n(e)?e:"..."}()));break}Qc(e,i);var f=A(h);r=e,s=l,t.j?t.j(f,r,s):t.call(null,f,r,s),h=B(h),d=r=d-1}}return Qc(e,o)}finally{jb=u}}function Vj(e,t){t=z(t);for(var n=null,r=0,i=0;;)if(i<r){var o=n.$(null,i);Qc(e,o),i+=1}else{if(!(t=z(t)))return null;Me(n=t)?(t=ed(n),r=fd(n),n=t,o=C(t),t=r,r=o):(Qc(e,o=A(n)),t=B(n),n=null,r=0),i=0}}function Wj(e){if(null==eb)throw Error("No *print-fn* fn set for evaluation environment");return eb.call(null,e),null}var Xj={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"};function Yj(e){return['"',p.g(e.replace(RegExp('[\\\\"\b\f\n\r\t]',"g"),(function(e){return Xj[e]}))),'"'].join("")}function Zj(e,t){return(e=Re(u.h(e,rb)))&&(e=null!=t&&!!(131072&t.B||cb===t.zd))?null!=Ae(t):e}function ak(e,t,r){if(null==e)return Qc(t,"nil");if(Zj(r,e)){Qc(t,"^");var i=Ae(e);bk.j?bk.j(i,t,r):bk.call(null,i,t,r),Qc(t," ")}if(e.Na)return e.Pa(t);if(null!=e?2147483648&e.B||cb===e.pa||!e.B&&Cb(Sc,e):Cb(Sc,e))return Tc(e,t,r);if(!0===e||!1===e)return Qc(t,p.g(e));if("number"==typeof e)return Qc(t,isNaN(e)?"##NaN":e===Number.POSITIVE_INFINITY?"##Inf":e===Number.NEGATIVE_INFINITY?"##-Inf":p.g(e));if(null!=e&&e.constructor===Object)return Qc(t,"#js "),i=Ng.h((function(t){return new xh(null!=Pj(/[A-Za-z_\*\+\?!\-'][\w\*\+\?!\-']*/,t)?Bf.g(t):t,e[t])}),Ga(e)),ck.F?ck.F(i,bk,t,r):ck.call(null,i,bk,t,r);if(wb(e))return Tj(t,bk,"#js ["," ","]",r,e);if("string"==typeof e)return n(qb.g(r))?Qc(t,Yj(e)):Qc(t,e);if("function"==typeof e){var o=e.name;return Vj(t,D(["#object[",r=n(null==o||Fa(o))?"Function":o,n(!1)?[' "',p.g(e),'"'].join(""):"","]"]))}return e instanceof Date?(r=function(e,t){for(e=p.g(e);;){if(!(e.length<t))return e;e=["0",e].join("")}},Vj(t,D(['#inst "',r(e.getUTCFullYear(),4),"-",r(e.getUTCMonth()+1,2),"-",r(e.getUTCDate(),2),"T",r(e.getUTCHours(),2),":",r(e.getUTCMinutes(),2),":",r(e.getUTCSeconds(),2),".",r(e.getUTCMilliseconds(),3),"-",'00:00"']))):e instanceof RegExp?Vj(t,D(['#"',e.source,'"'])):"symbol"===ba(e)||"undefined"!=typeof Symbol&&e instanceof Symbol?Vj(t,D(["#object[",e.toString(),"]"])):n(function(){var t=null==e?null:e.constructor;return null==t?null:t.Ja}())?Vj(t,D(["#object[",e.constructor.Ja.replace(RegExp("/","g"),"."),"]"])):(o=function(){var t=null==e?null:e.constructor;return null==t?null:t.name}(),r=n(function(){var e=null==o;return e||Fa(o)}())?"Object":o,null==e.constructor?Vj(t,D(["#object[",r,"]"])):Vj(t,D(["#object[",r," ",p.g(e),"]"])))}function bk(e,t,r){var i=dk.g(r);return n(i)?(r=I.j(r,ek,ak),i.j?i.j(e,t,r):i.call(null,e,t,r)):ak(e,t,r)}function fk(e,t){if(Ee(e))t="";else{var n=p,r=n.g,i=new Za,o=new od(i);bk(A(e),o,t),e=z(B(e));for(var l=null,s=0,a=0;;)if(a<s){var u=l.$(null,a);Qc(o," "),bk(u,o,t),a+=1}else{if(!(e=z(e)))break;Me(l=e)?(e=ed(l),s=fd(l),l=e,u=C(e),e=s,s=u):(u=A(l),Qc(o," "),bk(u,o,t),e=B(l),l=null,s=0),a=0}o.oc(null),t=r.call(n,i)}return t}function gk(e,t){return Wj(fk(e,t))}var hk=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};hk.l=function(e){return fk(e,kb())},hk.I=0,hk.J=function(e){return this.l(z(e))};var ik=function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return gk(e,I.j(kb(),qb,!1))}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}(),jk=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};function kk(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;lk(0<t.length?new Fd(t.slice(0),0,null):null)}function lk(e){return gk(e,I.j(kb(),qb,!1)),n(fb)?(e=kb(),Wj("\n"),u.h(e,lb),e=null):e=null,e}function mk(e){return e instanceof Ad?Bd.h(null,Cf(e)):Bf.h(null,Cf(e))}function nk(e){if(!n(!1))return null;var t=z(e),r=z(t),i=A(r);for(B(r),G(i,0,null),G(i,1,null),r=te(e),e=null;;){i=e,e=A(t=z(t));var o=B(t),l=e;if(e=G(l,0,null),t=G(l,1,null),!n(l))return new Q(null,2,5,S,[i,r],null);if(!(e instanceof w||e instanceof Ad))return null;if(n(i)){if(!x.h(i,zf(e)))return null;r=I.j(r,mk(e),t),e=i,t=o}else{if(!n(i=zf(e)))return null;r=I.j(r,mk(e),t),e=i,t=o}}}function ok(e,t,n,r,i){return Tj(r,(function(e,t,r){var i=pc(e);return n.j?n.j(i,t,r):n.call(null,i,t,r),Qc(t," "),e=qc(e),n.j?n.j(e,t,r):n.call(null,e,t,r)}),[p.g(e),"{"].join(""),", ","}",i,z(t))}function ck(e,t,r,i){var o=J(e)?nk(e):null,l=G(o,0,null);return o=G(o,1,null),n(l)?ok(["#:",p.g(l)].join(""),o,t,r,i):ok(null,e,t,r,i)}function qk(e){this.f=e,this.value=null,this.B=2147516416,this.M=1}function uk(e){return e instanceof qk?r(e):e}function vk(e,t){this.ze=e,this.de=t,this.B=2173173760,this.M=131072}function wk(e){return new vk(Xf(zg,Aj(e)),qe(e))}function xk(){}function yk(e){if(null!=e&&null!=e.Hg)e=e.Hg(e);else{var t=yk[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=yk._))throw Eb("IEncodeJS.-clj->js",e);e=t.g?t.g(e):t.call(null,e)}}return e}function zk(e,t){return(null!=e?cb===e.Gg||!e.Pe&&Cb(xk,e):Cb(xk,e))?yk(e):"string"==typeof e||"number"==typeof e||e instanceof w||e instanceof Ad?t.g?t.g(e):t.call(null,e):hk.l(D([e]))}jk.l=function(e){return fk(e,I.j(kb(),qb,!1))},jk.I=0,jk.J=function(e){return this.l(z(e))},Lg.prototype.pa=cb,Lg.prototype.U=function(e,t,n){return Qc(t,"#object[cljs.core.Volatile "),bk(new k(null,1,[pk,this.state],null),t,n),Qc(t,"]")},Cd.prototype.pa=cb,Cd.prototype.U=function(e,t,n){return Qc(t,"#'"),bk(this.ad,t,n)},Fd.prototype.pa=cb,Fd.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Df.prototype.pa=cb,Df.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},xh.prototype.pa=cb,xh.prototype.U=function(e,t,n){return Tj(t,bk,"["," ","]",n,this)},Ui.prototype.pa=cb,Ui.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Ji.prototype.pa=cb,Ji.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Yi.prototype.pa=cb,Yi.prototype.U=function(e,t,n){return Tj(t,bk,"["," ","]",n,this)},bi.prototype.pa=cb,bi.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Ld.prototype.pa=cb,Ld.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Jh.prototype.pa=cb,Jh.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},wf.prototype.pa=cb,wf.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},dt.prototype.pa=cb,dt.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},ie.prototype.pa=cb,ie.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Ij.prototype.pa=cb,Ij.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Oi.prototype.pa=cb,Oi.prototype.U=function(e,t,n){return ck(this,bk,t,n)},Li.prototype.pa=cb,Li.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Lh.prototype.pa=cb,Lh.prototype.U=function(e,t,n){return Tj(t,bk,"["," ","]",n,this)},gj.prototype.pa=cb,gj.prototype.U=function(e,t,n){return ck(this,bk,t,n)},uj.prototype.pa=cb,uj.prototype.U=function(e,t,n){return Tj(t,bk,"#{"," ","}",n,this)},If.prototype.pa=cb,If.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Eg.prototype.pa=cb,Eg.prototype.U=function(e,t,n){return Qc(t,"#object[cljs.core.Atom "),bk(new k(null,1,[pk,this.state],null),t,n),Qc(t,"]")},oj.prototype.pa=cb,oj.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Xi.prototype.pa=cb,Xi.prototype.U=function(e,t,n){return Tj(t,bk,"["," ","]",n,this)},Rg.prototype.pa=cb,Rg.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Q.prototype.pa=cb,Q.prototype.U=function(e,t,n){return Tj(t,bk,"["," ","]",n,this)},Sh.prototype.pa=cb,Sh.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},uf.prototype.pa=cb,uf.prototype.U=function(e,t){return Qc(t,"()")},Th.prototype.pa=cb,Th.prototype.U=function(e,t,n){return Tj(t,bk,"#queue ["," ","]",n,z(this))},k.prototype.pa=cb,k.prototype.U=function(e,t,n){return ck(this,bk,t,n)},Jj.prototype.pa=cb,Jj.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},rg.prototype.pa=cb,rg.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},nj.prototype.pa=cb,nj.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},se.prototype.pa=cb,se.prototype.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},Ad.prototype.Nc=cb,Ad.prototype.Tb=function(e,t){if(t instanceof Ad)return zd(this,t);throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},w.prototype.Nc=cb,w.prototype.Tb=function(e,t){if(t instanceof w)return xf(this,t);throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},Lh.prototype.Nc=cb,Lh.prototype.Tb=function(e,t){if(Le(t))return Ve(this,t);throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},Q.prototype.Nc=cb,Q.prototype.Tb=function(e,t){if(Le(t))return Ve(this,t);throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},xh.prototype.Nc=cb,xh.prototype.Tb=function(e,t){if(Le(t))return Ve(this,t);throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},Yi.prototype.Nc=cb,Yi.prototype.Tb=function(e,t){if(Le(t))return Ve(this,t);throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},Xi.prototype.Nc=cb,Xi.prototype.Tb=function(e,t){if(Le(t))return Ve(this,t);throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},qk.prototype.Jb=function(){return n(this.f)&&(this.value=this.f.A?this.f.A():this.f.call(null),this.f=null),this.value},qk.prototype.Dd=function(){return yb(this.f)},qk.prototype.U=function(e,t,n){return Qc(t,"#object[cljs.core.Delay "),bk(new k(null,2,[rk,null==this.f?sk:tk,pk,this.value],null),t,n),Qc(t,"]")},h=vk.prototype,h.indexOf=function(){var e;return e=function(e,t){switch(arguments.length){case 1:return de(this,e,0);case 2:return de(this,e,t)}throw Error("Invalid arity: "+arguments.length)},e.g=function(e){return de(this,e,0)},e.h=function(e,t){return de(this,e,t)},e}(),h.lastIndexOf=function(){function e(e){return ge(this,e,C(this))}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return ge(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return ge(this,e,t)},t}(),h.xa=function(){var e=kg(this.de);return sg(this.ze,e)},h.ca=function(){var e=kg(this.de);return e=sg(this.ze,e),z(n(e=qg(e))?e:Id)},h.Ea=function(e,t){return df(this.ze,cf(t,bf),this.de)},h.Fa=function(e,t,n){return ef(this.ze,cf(t,bf),n,this.de)},h.U=function(e,t,n){return Tj(t,bk,"("," ",")",n,this)},vk.prototype[Gb]=function(){return Kd(this)};var Ak=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],1<n.length?new Fd(n.slice(1),0,null):null)};function Ck(){}function Dk(e,t){if(null!=e&&null!=e.Fg)e=e.Fg(e,t);else{var n=Dk[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=Dk._))throw Eb("IEncodeClojure.-js->clj",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function Ek(e){return Fk(e,D([Gk,!1]))}function Fk(e,t){var r=bg(t),i=n(r=u.h(r,Gk))?Bf:p;return function e(n){return(null!=n?cb===n.mi||!n.Pe&&Cb(Ck,n):Cb(Ck,n))?Dk(n,Xf(kj,t)):Qe(n)?Oj(Ng.h(e,n)):Fh(n)?new xh(e(pc(n)),e(qc(n))):Fe(n)?ah.j(te(n),Ng.g(e),n):wb(n)?Zc(Nb.j((function(t,n){return Pf.h(t,e(n))}),Xc(F),n)):Db(n)===Object?Zc(Nb.j((function(t,r){return Qf(t,i.g?i.g(r):i.call(null,r),e(Ia(n,r)))}),Xc(P),Ga(n))):n}(e)}function Hk(e){var t=Fg(P);return function(){function n(e){var t=null;if(0<arguments.length){t=0;for(var n=Array(arguments.length-0);t<n.length;)n[t]=arguments[t+0],++t;t=new Fd(n,0,null)}return i.call(this,t)}function i(n){var i=u.j(r(t),n,Oe);return i===Oe?(i=Xf(e,n),Ig.F(t,I,n,i),i):i}return n.I=0,n.J=function(e){return i(e=z(e))},n.l=i,n}()}function Ik(e,t){return Zc(Nb.j((function(t,n){var r=e.g?e.g(n):e.call(null,n);return Qf(t,r,re.h(u.j(t,r,F),n))}),Xc(P),t))}Ak.l=function(e,t){t=bg(t);var n=u.j(t,Bk,Cf),r=function e(t){if(null==t)return null;if(null!=t?cb===t.Gg||!t.Pe&&Cb(xk,t):Cb(xk,t))return yk(t);if(t instanceof w)return n.g?n.g(t):n.call(null,t);if(t instanceof Ad)return p.g(t);if(J(t)){var i={};t=z(t);for(var o=null,l=0,s=0;;)if(s<l){var a=o.$(null,s),u=G(a,0,null);a=G(a,1,null),u=zk(u,r),a=e(a),i[u]=a,s+=1}else{if(!(t=z(t)))break;Me(t)?(l=ed(t),t=fd(t),o=l,l=C(l)):(o=G(l=A(t),0,null),l=G(l,1,null),o=zk(o,r),l=e(l),i[o]=l,t=B(t),o=null,l=0),s=0}return i}if(Fe(t)){for(i=[],t=z(Ng.h(e,t)),o=null,s=l=0;;)if(s<l)u=o.$(null,s),i.push(u),s+=1;else{if(!(t=z(t)))break;Me(o=t)?(t=ed(o),s=fd(o),o=t,l=C(t),t=s):(t=A(o),i.push(t),t=B(o),o=null,l=0),s=0}return i}return t};return r(e)},Ak.I=1,Ak.J=function(e){var t=A(e);return e=B(e),this.l(t,e)};var Jk=null;function Kk(){return null==Jk&&(Jk=Fg(new k(null,3,[Lk,P,Mk,P,Nk,P],null))),Jk}function Ok(e,t,n){var r=x.h(t,n);if(r)return r;if((r=M(r=(r=Nk.g(e)).g?r.g(t):r.call(null,t),n))||!(r=Le(n)))return r;if(!(r=Le(t)))return r;if(!(r=C(n)===C(t)))return r;r=!0;for(var i=0;;){if(!r||i===C(n))return r;r=Ok(e,t.g?t.g(i):t.call(null,i),n.g?n.g(i):n.call(null,i)),i+=1}}function Pk(e){var t=r(Kk());return dg(u.h(Lk.g(t),e))}function Qk(e,t,n,i){Ig.h(e,(function(){return r(t)})),Ig.h(n,(function(){return r(i)}))}var Rk=function e(t,i,o){var l,s=(l=r(o)).g?l.g(t):l.call(null,t);return s=!!n(n(s)?s.g?s.g(i):s.call(null,i):s)||null,n(s)?s:(s=function(){for(var n=Pk(i);;){if(!(0<C(n)))return null;var r=A(n);e.j?e.j(t,r,o):e.call(null,t,r,o),n=Hd(n)}}(),n(s)?s:(s=function(){for(var n=Pk(t);;){if(!(0<C(n)))return null;var r=A(n);e.j?e.j(r,i,o):e.call(null,r,i,o),n=Hd(n)}}(),!!n(s)&&s))};function Sk(e,t,r,i){return n(r=Rk(e,t,r))?r:Ok(i,e,t)}var Tk=function e(t,i,o,l,s,a,u,c){var h,d=Nb.j((function(e,n){var l=G(n,0,null);if(G(n,1,null),Ok(r(o),i,l)){if(e=null==e||Sk(l,A(e),s,r(o))?n:e,!Sk(A(e),l,s,r(o)))throw Error(["Multiple methods in multimethod '",p.g(t),"' match dispatch value: ",p.g(i)," -> ",p.g(l)," and ",p.g(A(e)),", and neither is preferred"].join(""));return e}return e}),null,r(l)),f=((h=null==d)&&(h=(h=r(l)).g?h.g(c):h.call(null,c)),n(h)?new Q(null,2,5,S,[c,h],null):d);return n(f)?x.h(r(u),r(o))?(Ig.F(a,I,i,oe(f)),oe(f)):(Qk(a,l,u,o),e.Ma?e.Ma(t,i,o,l,s,a,u,c):e.call(null,t,i,o,l,s,a,u,c)):null};function Uk(e,t,n){if(null!=e&&null!=e.C)e.C(e,t,n);else{var r=Uk[ba(null==e?null:e)];if(null!=r)r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=Uk._))throw Eb("IMultiFn.-add-method",e);r.j?r.j(e,t,n):r.call(null,e,t,n)}}}function Vk(e,t){if(null!=e&&null!=e.La)e=e.La(e,t);else{var n=Vk[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=Vk._))throw Eb("IMultiFn.-get-method",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function Wk(e){if(null!=e&&null!=e.Jg)e=e.V;else{var t=Wk[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=Wk._))throw Eb("IMultiFn.-dispatch-fn",e);e=t.g?t.g(e):t.call(null,e)}}return e}function Xk(e,t){throw Error(["No method in multimethod '",p.g(e),"' for dispatch value: ",p.g(t)].join(""))}function Yk(e,t,n,r,i,o,l){var s=Zk;this.name=e,this.V=t,this.Wg=s,this.he=n,this.me=r,this.Yh=i,this.le=o,this.Xd=l,this.B=4194305,this.M=4352}function $k(e){this.dd=e,this.G=null,this.B=2153775104,this.M=2048}function al(){function e(){return Math.floor(16*Math.random()).toString(16)}var t=(8|3&Math.floor(16*Math.random())).toString(16);return new $k([p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),"-",p.g(e()),p.g(e()),p.g(e()),p.g(e()),"-4",p.g(e()),p.g(e()),p.g(e()),"-",p.g(t),p.g(e()),p.g(e()),p.g(e()),"-",p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e()),p.g(e())].join("").toLowerCase())}function bl(e,t,n){var r=Error(e);return this.message=e,this.data=t,this.cause=n,this.name=r.name,this.description=r.description,this.number=r.number,this.fileName=r.fileName,this.lineNumber=r.lineNumber,this.columnNumber=r.columnNumber,this.stack=r.stack,this}function cl(e,t){return dl(e,t,null)}function dl(e,t,n){return new bl(e,t,n)}function el(e){return e instanceof bl?e.data:null}function fl(e){return e instanceof Error?e.message:null}function gl(e){return M(new uj(null,new k(null,24,[hl,"null",il,"null",jl,"null",kl,"null",ll,"null",ml,"null",nl,"null",ol,"null",pl,"null",ql,"null",rl,"null",sl,"null",tl,"null",ul,"null",vl,"null",wl,"null",xl,"null",yl,"null",zl,"null",Al,"null",Bl,"null",Cl,"null",Dl,"null",El,"null"],null),null),e)}function Fl(e,t){this.tag=e,this.form=t,this.B=2153775360,this.M=0}h=Yk.prototype,h.call=function(e){switch(arguments.length-1){case 0:return this.A();case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);case 3:return this.j(arguments[1],arguments[2],arguments[3]);case 4:return this.F(arguments[1],arguments[2],arguments[3],arguments[4]);case 5:return this.O(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 6:return this.oa(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]);case 7:return this.lb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]);case 8:return this.Ma(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);case 9:return this.ab(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9]);case 10:return this.pb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10]);case 11:return this.gb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11]);case 12:return this.qb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12]);case 13:return this.hb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13]);case 14:return this.rb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14]);case 15:return this.ib(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15]);case 16:return this.sb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16]);case 17:return this.jb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17]);case 18:return this.tb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18]);case 19:return this.kb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19]);case 20:return this.ub(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19],arguments[20]);case 21:return this.Sc(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19],arguments[20],arguments[21]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.A=function(){var e=this.V.A?this.V.A():this.V.call(null),t=this.La(null,e);return n(t)||Xk(this.name,e),t.A?t.A():t.call(null)},h.g=function(e){var t=this.V.g?this.V.g(e):this.V.call(null,e),r=this.La(null,t);return n(r)||Xk(this.name,t),r.g?r.g(e):r.call(null,e)},h.h=function(e,t){var r=this.V.h?this.V.h(e,t):this.V.call(null,e,t),i=this.La(null,r);return n(i)||Xk(this.name,r),i.h?i.h(e,t):i.call(null,e,t)},h.j=function(e,t,r){var i=this.V.j?this.V.j(e,t,r):this.V.call(null,e,t,r),o=this.La(null,i);return n(o)||Xk(this.name,i),o.j?o.j(e,t,r):o.call(null,e,t,r)},h.F=function(e,t,r,i){var o=this.V.F?this.V.F(e,t,r,i):this.V.call(null,e,t,r,i),l=this.La(null,o);return n(l)||Xk(this.name,o),l.F?l.F(e,t,r,i):l.call(null,e,t,r,i)},h.O=function(e,t,r,i,o){var l=this.V.O?this.V.O(e,t,r,i,o):this.V.call(null,e,t,r,i,o),s=this.La(null,l);return n(s)||Xk(this.name,l),s.O?s.O(e,t,r,i,o):s.call(null,e,t,r,i,o)},h.oa=function(e,t,r,i,o,l){var s=this.V.oa?this.V.oa(e,t,r,i,o,l):this.V.call(null,e,t,r,i,o,l),a=this.La(null,s);return n(a)||Xk(this.name,s),a.oa?a.oa(e,t,r,i,o,l):a.call(null,e,t,r,i,o,l)},h.lb=function(e,t,r,i,o,l,s){var a=this.V.lb?this.V.lb(e,t,r,i,o,l,s):this.V.call(null,e,t,r,i,o,l,s),u=this.La(null,a);return n(u)||Xk(this.name,a),u.lb?u.lb(e,t,r,i,o,l,s):u.call(null,e,t,r,i,o,l,s)},h.Ma=function(e,t,r,i,o,l,s,a){var u=this.V.Ma?this.V.Ma(e,t,r,i,o,l,s,a):this.V.call(null,e,t,r,i,o,l,s,a),c=this.La(null,u);return n(c)||Xk(this.name,u),c.Ma?c.Ma(e,t,r,i,o,l,s,a):c.call(null,e,t,r,i,o,l,s,a)},h.ab=function(e,t,r,i,o,l,s,a,u){var c=this.V.ab?this.V.ab(e,t,r,i,o,l,s,a,u):this.V.call(null,e,t,r,i,o,l,s,a,u),h=this.La(null,c);return n(h)||Xk(this.name,c),h.ab?h.ab(e,t,r,i,o,l,s,a,u):h.call(null,e,t,r,i,o,l,s,a,u)},h.pb=function(e,t,r,i,o,l,s,a,u,c){var h=this.V.pb?this.V.pb(e,t,r,i,o,l,s,a,u,c):this.V.call(null,e,t,r,i,o,l,s,a,u,c),d=this.La(null,h);return n(d)||Xk(this.name,h),d.pb?d.pb(e,t,r,i,o,l,s,a,u,c):d.call(null,e,t,r,i,o,l,s,a,u,c)},h.gb=function(e,t,r,i,o,l,s,a,u,c,h){var d=this.V.gb?this.V.gb(e,t,r,i,o,l,s,a,u,c,h):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h),f=this.La(null,d);return n(f)||Xk(this.name,d),f.gb?f.gb(e,t,r,i,o,l,s,a,u,c,h):f.call(null,e,t,r,i,o,l,s,a,u,c,h)},h.qb=function(e,t,r,i,o,l,s,a,u,c,h,d){var f=this.V.qb?this.V.qb(e,t,r,i,o,l,s,a,u,c,h,d):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d),p=this.La(null,f);return n(p)||Xk(this.name,f),p.qb?p.qb(e,t,r,i,o,l,s,a,u,c,h,d):p.call(null,e,t,r,i,o,l,s,a,u,c,h,d)},h.hb=function(e,t,r,i,o,l,s,a,u,c,h,d,f){var p=this.V.hb?this.V.hb(e,t,r,i,o,l,s,a,u,c,h,d,f):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f),g=this.La(null,p);return n(g)||Xk(this.name,p),g.hb?g.hb(e,t,r,i,o,l,s,a,u,c,h,d,f):g.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f)},h.rb=function(e,t,r,i,o,l,s,a,u,c,h,d,f,p){var g=this.V.rb?this.V.rb(e,t,r,i,o,l,s,a,u,c,h,d,f,p):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p),w=this.La(null,g);return n(w)||Xk(this.name,g),w.rb?w.rb(e,t,r,i,o,l,s,a,u,c,h,d,f,p):w.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p)},h.ib=function(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g){var w=this.V.ib?this.V.ib(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g),m=this.La(null,w);return n(m)||Xk(this.name,w),m.ib?m.ib(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g):m.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g)},h.sb=function(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w){var m=this.V.sb?this.V.sb(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w),v=this.La(null,m);return n(v)||Xk(this.name,m),v.sb?v.sb(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w):v.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w)},h.jb=function(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m){var v=this.V.jb?this.V.jb(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m),y=this.La(null,v);return n(y)||Xk(this.name,v),y.jb?y.jb(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m):y.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m)},h.tb=function(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v){var y=this.V.tb?this.V.tb(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v),b=this.La(null,y);return n(b)||Xk(this.name,y),b.tb?b.tb(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v):b.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v)},h.kb=function(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y){var b=this.V.kb?this.V.kb(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y),S=this.La(null,b);return n(S)||Xk(this.name,b),S.kb?S.kb(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y):S.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y)},h.ub=function(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b){var S=this.V.ub?this.V.ub(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b):this.V.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b),$=this.La(null,S);return n($)||Xk(this.name,S),$.ub?$.ub(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b):$.call(null,e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b)},h.Sc=function(e,t,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b,S){var $=ag(this.V,e,t,r,i,D([o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b,S])),C=this.La(null,$);return n(C)||Xk(this.name,$),ag(C,e,t,r,i,D([o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b,S]))},h.Jg=function(){return this.V},h.C=function(e,t,n){return Ig.F(this.me,I,t,n),Qk(this.le,this.me,this.Xd,this.he),this},h.La=function(e,t){return x.h(r(this.Xd),r(this.he))||Qk(this.le,this.me,this.Xd,this.he),n(e=(e=r(this.le)).g?e.g(t):e.call(null,t))?e:Tk(this.name,t,this.he,this.me,this.Yh,this.le,this.Xd,this.Wg)},h.Ad=function(){return gd(this.name)},h.Bd=function(){return hd(this.name)},h.ba=function(){return fa(this)},h=$k.prototype,h.Sg=cb,h.toString=function(){return this.dd},h.aa=function(e,t){return(e=null!=t&&cb===t.Sg)?this.dd===t.dd:e},h.U=function(e,t){return Qc(t,['#uuid "',p.g(this.dd),'"'].join(""))},h.ba=function(){return null==this.G&&(this.G=xd(this.dd)),this.G},h.Tb=function(e,t){if(t instanceof $k)return Oa(this.dd,t.dd);throw Error(["Cannot compare ",p.g(this)," to ",p.g(t)].join(""))},bl.prototype.__proto__=Error.prototype,bl.prototype.pa=cb,bl.prototype.U=function(e,t,r){return Qc(t,"#error {:message "),bk(this.message,t,r),n(this.data)&&(Qc(t,", :data "),bk(this.data,t,r)),n(this.cause)&&(Qc(t,", :cause "),bk(this.cause,t,r)),Qc(t,"}")},bl.prototype.toString=function(){return pd(this)},h=Fl.prototype,h.toString=function(){return pd(this)},h.aa=function(e,t){return t instanceof Fl&&x.h(this.tag,t.tag)&&x.h(this.form,t.form)},h.ba=function(){return 31*xd(this.tag)+xd(this.form)},h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"tag":return this.tag;case"form":return this.form;default:return n}},h.U=function(e,t,n){return Qc(t,["#",p.g(this.tag)," "].join("")),bk(this.form,t,n)};var Gl="arguments abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends final finally float for function goto if implements import in instanceof int interface let long native new package private protected public return short static super switch synchronized this throw throws transient try typeof var void volatile while with yield methods null constructor".split(" "),Hl=null;function Il(e){return null==Hl&&(Hl=Nb.j((function(e,t){return e[t]=!0,e}),{},Gl)),Hl.hasOwnProperty(e)}function Jl(){return n(Kb)||(Kb=function(){for(var e=Xe((function(e,t){return t.length-e.length})),t="";;){if(!z(e))return[t,"|\\$"].join("");var n=B(e),r=[function(){var e=t;return""!==t?[e,"|"].join(""):e}(),p.g(A(e))].join("");e=n,t=r}}()),Kb}function Kl(e){var t=p.g(e);if("_DOT__DOT_"===t)var r="..";else e:{r=new RegExp(Jl(),"g"),t=n(Ea(t,"$"))?t.substring(0,t.length-1):t;for(var i="",o=0;;){var l=r.exec(t);if(!n(l)){r=[i,p.g(t.substring(o,t.length))].join("");break e}l=G(l,0,null),i=[i,p.g(t.substring(o,r.lastIndex-l.length)),p.g("$"===l?"/":Ia(Jb,l))].join(""),o=r.lastIndex}}return(e=e instanceof Ad?Bd:p).g?e.g(r):e.call(null,r)}function Ll(e){this.name=e,this.B=6291456,this.M=0}Ll.prototype.toString=function(){return p.g(this.name)},Ll.prototype.aa=function(e,t){return t instanceof Ll&&x.h(this.name,t.name)},Ll.prototype.ba=function(){return xd(this.name)};var Ml=null;"undefined"!=typeof console&&ub(),ub();var Nl=new w(null,"nil","nil",99600501),Ol=new w(null,"token","token",-1211463215),Pl=new w("gateway.state.spec.common","keyword","gateway.state.spec.common/keyword",-1409778786),Ql=new w("gateway.common.spec.messages","response","gateway.common.spec.messages/response",69665082),Rl=new w(null,"exp","exp",-261706262),Kv=new w(null,"stop","stop",-2140911342),Sl=new w(null,"subscribe","subscribe",416253756),Tl=new w(null,"bin-char","bin-char",-1662780697),Ul=new w("gateway.state.spec.activity","children","gateway.state.spec.activity/children",651398237),Vl=new w(null,"pattern","pattern",242135423),Wl=new w(null,"spying?","spying?",1753444487),Xl=new w("gateway.domains.global.spec.requests","updated","gateway.domains.global.spec.requests/updated",-1219870803),Yl=new w(null,"reader-exception","reader-exception",-1938323098),Zl=new w(null,"trailing-white-space","trailing-white-space",1496006996),$l=new w("gateway.domains.agm.spec.requests","server_id","gateway.domains.agm.spec.requests/server_id",172340651),am=new w(null,"relative-to","relative-to",-470100051),bm=new w("gateway.state.spec.agm","stream-id","gateway.state.spec.agm/stream-id",-1404324586),cm=new w("gateway.common.context.spec.requests","path","gateway.common.context.spec.requests/path",614939647),dm=new w(null,"intra-block-nl","intra-block-nl",1808826875),em=new w(null,"peer-id","peer-id",387144350),fm=new w(null,"exponentchar","exponentchar",1986664222),gm=new w("gateway.domains.global.spec.requests","delta","gateway.domains.global.spec.requests/delta",299143136),hm=new w(null,"and","and",-971899817),im=new w("gateway.state.spec.state","activity-types","gateway.state.spec.state/activity-types",1532142687),jm=new w(null,"number","number",1570378438),km=new w("gateway.state.spec.activity","context","gateway.state.spec.activity/context",798551178),lm=new w(null,"any","any",1705907423),mm=new w(null,"req-specs","req-specs",553962313),nm=new w("gateway.state.spec.state","options","gateway.state.spec.state/options",-722288524),om=new Ad("cljs.core","map","cljs.core/map",-338988913,null),pm=new w("gateway.state.spec.domain-registry","info","gateway.state.spec.domain-registry/info",754617108),qm=new w("gateway.state.spec.restrictions","string-restrictions","gateway.state.spec.restrictions/string-restrictions",-382592371),rm=new Ad(null,"when-let","when-let",-1383043480,null),sm=new Ad(null,"cljs.core","cljs.core",770546058,null),tm=new w(null,"miser","miser",-556060186),Hw=new w(null,"priority","priority",1431093715),um=new w(null,"amp","amp",271690571),vm=new Ad("s","coll-of","s/coll-of",-1705285349,null),wm=new w(null,"publish","publish",-1178026850),xm=new w(null,"neg","neg",1800032960),ym=new w("gateway.auth.spec","access_token","gateway.auth.spec/access_token",-1170576318),zm=new w(null,"current","current",-1088038603),Am=new w(null,"alg","alg",-830920638),Bm=new w(null,"neq","neq",1883246164),Cm=new Ad(null,"->","->",-2139605430,null),Dm=new w("gateway.domains.agm.spec.messages","oob","gateway.domains.agm.spec.messages/oob",-285361976),Em=new Ad(null,"Inf","Inf",647172781,null),Fm=new w(null,"all","all",892129742),Gm=new w(null,"index","index",-1531685915),Uy=new w(null,"expires-at","expires-at",1654982210),Hm=new w(null,"alt","alt",-3214426),Im=new Ad(null,"..","..",-300507420,null),Zk=new w(null,"default","default",-1987822328),Jm=new w(null,"fail-index","fail-index",248726923),Km=new w(null,"timestamp_","timestamp_",-954533417),Lm=new w(null,"ex-kind","ex-kind",1581199296),Mm=new w(null,"request-id","request-id",-985684093),Nm=new w(null,"hello","hello",-245025397),Om=new Ad(null,"opts","opts",1795607228,null),Pm=new w(null,"err","err",-2089457205),Qm=new w("gateway.state.spec.agm","invocation_id","gateway.state.spec.agm/invocation_id",-822050570),Rm=new w(null,"define","define",-2006590705),Sm=new w(null,"reload","reload",863702807),Tm=new w(null,"optional","optional",2053951509),Um=new w("cljs.spec.alpha","kfn","cljs.spec.alpha/kfn",672643897),Vm=new w(null,"nbf","nbf",-1785694926),Wm=new w(null,"callee","callee",-156445786),Xm=new w(null,"peer_name","peer_name",-245526270),Ym=new w(null,"negative-lookahead","negative-lookahead",874382387),Zm=new w(null,"method-filter-fn","method-filter-fn",-283131748),$m=new w(null,"end-pos","end-pos",-1643883926),an=new w("gateway.domains.global.internal","authenticated","gateway.domains.global.internal/authenticated",-1621463770),bn=new w(null,"caller","caller",-1275362879),cn=new Ad("gateway.state.spec.common","address-type","gateway.state.spec.common/address-type",-283204142,null),dn=new w(null,"per-line-prefix","per-line-prefix",846941813),en=new w(null,"content","content",15833224),fn=new w(null,"source_type","source_type",-144028049),gn=new w("gateway.state.spec.activity","context_id","gateway.state.spec.activity/context_id",1100878008),hn=new w(null,"msg_","msg_",-1925147e3),jn=new w(null,"create-peer","create-peer",631977540),kn=new Ad("cljs.core","nil?","cljs.core/nil?",945071861,null),ln=new w(null,"continue","continue",-207346553),mn=new w(null,"println","println",1920840330),nn=new w(null,"gateway-requests","gateway-requests",2114123587),on=new w(null,"rules-or-parser","rules-or-parser",-314380386),pn=new w(null,"routing-key","routing-key",238118868),qn=new w(null,"eof","eof",-489063237),rn=new w(null,"ready-members","ready-members",757058983),sn=new w(null,"initiated","initiated",2096076574),tn=new w("gateway.state.spec.activity","activity-domain","gateway.state.spec.activity/activity-domain",292185460),un=new Ad("cljs.core","pos?","cljs.core/pos?",-652182749,null),vn=new w("gateway.state.spec.context","creator","gateway.state.spec.context/creator",-11360985),wn=new w(null,"queue","queue",1455835879),xn=new w("gateway.state.spec.tokens","impersonate-peer","gateway.state.spec.tokens/impersonate-peer",1018065912),yn=new Ad(null,"if-let","if-let",1803593690,null),zn=new w(null,"segment","segment",-964921196),An=new w("cljs.spec.alpha","name","cljs.spec.alpha/name",205233570),T=new w(null,"req-un","req-un",1074571008),Bn=new w(null,"end","end",-268185958),Cn=new w(null,"paren","paren",-294107600),Dn=new w(null,"subscriber_id","subscriber_id",972810975),En=new w("gateway.domains.agm.spec.messages","reason","gateway.domains.agm.spec.messages/reason",-1483891292),Fn=new Ad(null,"gateway.common.spec.messages","gateway.common.spec.messages",-1797487288,null),Gn=new Ad(null,"not-native","not-native",-236392494,null),Hn=new w(null,"provider","provider",-302056900),In=new w(null,"reason","reason",-2070751759),Jn=new w(null,"num-val","num-val",1497434478),Kn=new w("gateway.common.spec.messages","domain","gateway.common.spec.messages/domain",755510455),Ln=new w(null,"properties","properties",685819552),Mn=new w(null,"post","post",269697687),Nn=new w(null,"rules","rules",1198912366),pl=new Ad(null,"letfn*","letfn*",-110097810,null),On=new Ad("cljs.core","empty?","cljs.core/empty?",1866613644,null),Pn=new w(null,"unregister","unregister",2105339971),Qn=new w(null,"red","red",-969428204),Lk=new w(null,"parents","parents",-2027538891),Rn=new w(null,"arg-filter-fn","arg-filter-fn",1576945932),Sn=new w(null,"context-created","context-created",-436520594),Tn=new w(null,"rep","rep",-1226820564),Un=new w("gateway.state.spec.domain-registry","domain","gateway.state.spec.domain-registry/domain",-1376202493),Vn=new w(null,"remaining-arg-count","remaining-arg-count",-1216589335),Wn=new w(null,"logical-blocks","logical-blocks",-1466339776),Xn=new w(null,"process-id","process-id",-2118975265),Yn=new w(null,"ret","ret",-468222814),Zn=new w(null,"req","req",-326448303),$n=new w(null,"appender-id","appender-id",-1917983538),ao=new Ad(null,"defmacro","defmacro",2054157304,null),bo=new Ad(null,"NaN","NaN",666918153,null),Tz=new w("zip","make-node","zip/make-node",1103800591),co=new w("gateway.common.context.spec.requests","updated","gateway.common.context.spec.requests/updated",-286888249),eo=new w(null,"runtime-exception","runtime-exception",-1495664514),fo=new w(null,"iss","iss",1130086696),go=new w("gateway.state.spec.mthds","version","gateway.state.spec.mthds/version",1762403198),ho=new w(null,"signature-key","signature-key",-1652526996),io=new w(null,"results","results",-1134170113),jo=new w("gateway.state.spec.activity","types","gateway.state.spec.activity/types",-2083568052),ko=new w(null,"updater_id","updater_id",-2125909548),lo=new w("gateway.state.spec.state","state","gateway.state.spec.state/state",-1032276972),sk=new w(null,"ready","ready",1086465795),mo=new w(null,"peer-created","peer-created",-1509421151),no=new w(null,"output_","output_",-36797880),oo=new w(null,"arglists","arglists",1661989754),po=new w(null,"match","match",1220059550),qo=new w(null,"output-fn","output-fn",1600951539),ro=new Ad(null,"when-first","when-first",821699168,null),so=new w(null,"end-column","end-column",1425389514),to=new w(null,"accepted","accepted",-1953464374),uo=new w(null,"peer-factories-removed","peer-factories-removed",-1429529592),vo=new w("gateway.state.spec.restrictions","restrictions","gateway.state.spec.restrictions/restrictions",181113171),wo=new w(null,"interests","interests",1200294902),xo=new w("gateway.common.spec.messages","outgoing-messages","gateway.common.spec.messages/outgoing-messages",-924999491),yo=new w(null,"remove-interest","remove-interest",-1017752998),zo=new w(null,"expr","expr",745722291),Ao=new w("gateway.auth.spec","request","gateway.auth.spec/request",-1915554438),Bo=new w(null,"dump","dump",-356261477),Co=new w(null,"raw","raw",1604651272),Do=new w(null,"start-block-t","start-block-t",-373430594),Eo=new Ad(null,"binding","binding",-2114503176,null),Fo=new w("cljs.spec.alpha","kind-form","cljs.spec.alpha/kind-form",-1047104697),Go=new w(null,"OCTET","OCTET",-743420682),Ho=new w(null,"destroy-context","destroy-context",-1305625710),Io=new w("gateway.state.spec.common","node","gateway.state.spec.common/node",-570411717),Jo=new w("gateway.domains.agm.spec.requests","stream_id","gateway.domains.agm.spec.requests/stream_id",-1290121066),Ko=new w("gateway.common.spec.messages","broadcast","gateway.common.spec.messages/broadcast",-1460237246),Lo=new w(null,"activities","activities",1654844313),Mo=new w(null,"bracket-info","bracket-info",-1600092774),No=new w("gateway.state.spec.activity","owner_type","gateway.state.spec.activity/owner_type",-1823895667),Oo=new w(null,"member","member",-2012020816),Po=new w(null,"given","given",716253602),Qo=new w(null,"?line","?line",-631853385),Ro=new w(null,"body","body",-2049205669),So=new w(null,"mode","mode",654403691),To=new w("gateway.common.spec.messages","reason_uri","gateway.common.spec.messages/reason_uri",-14574488),Uo=new w(null,"console","console",1228072057),Vo=new w(null,"method_id","method_id",1349548671),Wo=new w(null,"distinct","distinct",-1788879121),Xo=new w(null,"parsed-restrictions","parsed-restrictions",-1665101931),ek=new w(null,"fallback-impl","fallback-impl",-1501286995),Yo=new w(null,"name","name",1843675177),Zo=new w(null,"subscribed","subscribed",1012088257),$o=new w("gateway.common.context.spec.requests","commands","gateway.common.context.spec.requests/commands",1656863185),ap=new Ad("s","map-of","s/map-of",-1464752791,null),bp=new w(null,"initiator","initiator",217480362),cp=new w(null,"service?","service?",-2064761863),dp=new w("cljs.spec.alpha","pcat","cljs.spec.alpha/pcat",26406623),ep=new w("gateway.state.spec.domain-registry","version","gateway.state.spec.domain-registry/version",-650577592),fp=new w(null,"illegal-argument","illegal-argument",-1845493170),gp=new w(null,"factory_ids","factory_ids",1173653523),hp=new w(null,"types","types",590030639),ip=new w(null,"subscriber","subscriber",-2064338413),jp=new w(null,"writing","writing",-1486865108),kp=new w("gateway.state.spec.restrictions","parsed-restrictions","gateway.state.spec.restrictions/parsed-restrictions",1374812996),lp=new w("gateway.state.spec.mthds","description","gateway.state.spec.mthds/description",-129583756),mp=new w(null,"deny-spec","deny-spec",-1074984268),np=new w(null,"parameter-from-args","parameter-from-args",-758446196),op=new w("gateway.common.context.spec.requests","lifetime","gateway.common.context.spec.requests/lifetime",-228133926),pp=new w("gateway.domains.global.spec.messages","remote-identity","gateway.domains.global.spec.messages/remote-identity",1498525882),Gk=new w(null,"keywordize-keys","keywordize-keys",1310784252),qp=new w("gateway.state.spec.bus","topic","gateway.state.spec.bus/topic",-1241703207),rp=new w(null,"logical-block-callback","logical-block-callback",1612691194),sp=new Ad(null,"inst","inst",-2008473268,null),tp=new w("gateway.common.spec.messages","receiver","gateway.common.spec.messages/receiver",679023931),up=new w(null,"selector","selector",762528866),vp=new Ad(null,"struct","struct",325972931,null),wp=new w(null,"participants","participants",673603367),xp=new w(null,"topic-repattern","topic-repattern",1187945138),yp=new w(null,"call","call",-519999866),zp=new Ad("cljs.core","partial","cljs.core/partial",1483172485,null),Ap=new w(null,"hours","hours",58380855),Bp=new w(null,"start-production","start-production",687546537),Cp=new w(null,"buffer","buffer",617295198),Dp=new w(null,"repo-id","repo-id",-402847325),Ep=new Ad("cljs.core","sequence","cljs.core/sequence",1908459032,null),Fp=new w(null,"context","context",-830191113),Gp=new w(null,"restrictions","restrictions",1874752994),Hp=new Ad("cljs.spec.alpha","or","cljs.spec.alpha/or",-831679639,null),Ip=new w(null,"services","services",970478783),Jp=new w(null,"access_token","access_token",1591156073),Kp=new w(null,"input-format","input-format",-422703481),Lp=new w(null,"invocations","invocations",-1981777494),Mp=new w("gateway.state.spec.agm","stream-peer-info","gateway.state.spec.agm/stream-peer-info",1892226854),Np=new w(null,"opt-keys","opt-keys",1262688261),Op=new w(null,"raw-console?","raw-console?",-2061489061),Pp=new w(null,"ref-counted","ref-counted",-1035328654),Qp=new Ad(null,"reader","reader",1810192380,null),Rp=new w(null,"indent","indent",-148200125),Mk=new w(null,"descendants","descendants",1824886031),Sp=new w(null,"context-compatibility-mode?","context-compatibility-mode?",564867301),Tp=new w("gateway.domains.global.spec.requests","reset","gateway.domains.global.spec.requests/reset",-116815601),Up=new w(null,"types-added","types-added",1274011029),Vp=new w(null,"publisher-identity","publisher-identity",1716891391),Wp=new w("gateway.state.spec.mthds","peer-methods","gateway.state.spec.mthds/peer-methods",-639609469),Xp=new w(null,"ALPHA","ALPHA",-1463859144),Yp=new w(null,"context-domain","context-domain",-563887528),Zp=new w("gateway.domains.global.spec.requests","context-destroy","gateway.domains.global.spec.requests/context-destroy",1322892186),$p=new w(null,"pred-forms","pred-forms",172611832),aq=new w(null,"location","location",1815599388),pk=new w(null,"val","val",128701612),bq=new w("gateway.state.spec.context","data","gateway.state.spec.context/data",790358174),cq=new w("gateway.state.spec.pending-requests","client-request","gateway.state.spec.pending-requests/client-request",1663875818),U=new Ad("cljs.core","contains?","cljs.core/contains?",-976526835,null),dq=new w(null,"destroyed","destroyed",-427566535),eq=new w(null,"subscribed-context","subscribed-context",-451582146),fq=new w(null,"DQUOTE","DQUOTE",-571169808),lb=new w(null,"flush-on-newline","flush-on-newline",-151457939),gq=new Ad("cljs.spec.alpha","and","cljs.spec.alpha/and",-2060279705,null),gE=new w(null,"changed?","changed?",-437828330),hq=new Ad(null,"loop","loop",1244978678,null),iq=new w("gateway.state.spec.context","timestamp","gateway.state.spec.context/timestamp",1704984480),jq=new w(null,"dispose-peer","dispose-peer",68303444),kq=new w("gateway.state.spec.tokens","gateway-token","gateway.state.spec.tokens/gateway-token",1169641187),lq=new w(null,"timeout","timeout",-318625318),mq=new w(null,"joined_name","joined_name",-1159730335),nq=new w(null,"illegal-state","illegal-state",-1519851182),oq=new w(null,"max-columns","max-columns",1742323262),pq=new w(null,"ids","ids",-998535796),qq=new w("gateway.domains.global.spec.requests","context-create","gateway.domains.global.spec.requests/context-create",-1370416261),rq=new w(null,"peer-factories-added","peer-factories-added",-2010470480),sq=new w(null,"reader-error","reader-error",1610253121),tq=new w("gateway.state.spec.common","string","gateway.state.spec.common/string",885967163),uq=new w(null,"result_signature","result_signature",-1204398780),vq=new w(null,"keep","keep",-2133338530),wq=new w("gateway.domains.agm.spec.requests","arguments","gateway.domains.agm.spec.requests/arguments",-1906298417),xq=new w(null,"both","both",-393648840),jH=new w(null,"blacklist-ns","blacklist-ns",1200193567),zq=new w(null,"symbol","symbol",-1038572696),Aq=new w(null,"CHAR","CHAR",-1280338086),Bq=new w(null,"context-updated","context-updated",744419706),Cq=new w("gateway.common.spec.requests","join","gateway.common.spec.requests/join",-1713603460),Dq=new w(null,"msg-cache","msg-cache",-733775070),Eq=new w(null,"parser","parser",-1543495310),Fq=new w(null,"colnum","colnum",2023796854),Gq=new Ad(null,"doseq","doseq",221164135,null),Hq=new w(null,"req-id","req-id",-471642231),Iq=new w(null,"char-val","char-val",1408617933),Jq=new w(null,"min","min",444991522),Kq=new Ad("clojure.core","list","clojure.core/list",-1119203325,null),Lq=new w(null,"timestamp-opts","timestamp-opts",-1359534807),Dl=new Ad(null,"throw","throw",595905694,null),Mq=new w(null,"iat","iat",-353315170),Nq=new w(null,"splice","splice",449588165),Oq=new Ad(null,"gateway.domains.agm.subscriptions","gateway.domains.agm.subscriptions",-340272132,null),Pq=new w(null,"length","length",588987862),Qq=new w(null,"error-level?","error-level?",778415885),Rq=new w("gateway.state.spec.pending-requests","gw-request-id","gateway.state.spec.pending-requests/gw-request-id",-996681140),Sq=new w(null,"char-format","char-format",-1016499218),Tq=new w(null,"rep+","rep+",-281382396),Uq=new w("gateway.domains.global.spec.messages","resolved_identity","gateway.domains.global.spec.messages/resolved_identity",-685850501),Vq=new w("gateway.domains.agm.spec.requests","methods","gateway.domains.agm.spec.requests/methods",-366393681),Wq=new w("gateway.domains.global.spec.messages","available_domains","gateway.domains.global.spec.messages/available_domains",-1472037229),Xq=new w("gateway.state.spec.tokens","gw-request-id","gateway.state.spec.tokens/gw-request-id",146927020),Yq=new w("gateway.domains.global.spec.requests","leave","gateway.domains.global.spec.requests/leave",101292368),Zq=new Ad("cljs.spec.alpha","map-of","cljs.spec.alpha/map-of",153715093,null),$q=new w("gateway.state.spec.tokens","token-data","gateway.state.spec.tokens/token-data",-481150767),ar=new w("gateway.domains.agm.spec.messages","new_peer_id","gateway.domains.agm.spec.messages/new_peer_id",-2026004018),br=new w("gateway.domains.agm.spec.register","register","gateway.domains.agm.spec.register/register",-572048018),cr=new w("gateway.common.context.spec.messages","context_id","gateway.common.context.spec.messages/context_id",745790948),dr=new w(null,"req-in","req-in",960021885),er=new w("gateway.state.spec.agm","call","gateway.state.spec.agm/call",399063183),fr=new w(null,"context-added","context-added",-639543900),gr=new w("gateway.common.spec.messages","body","gateway.common.spec.messages/body",-1028765771),hr=new w(null,"grammar","grammar",1881328267),ir=new w(null,"epsilon","epsilon",-730158570),jr=new w(null,"prefix","prefix",-265908465),kr=new w(null,"arguments","arguments",-1182834456),lr=new w("gateway.state.spec.state","id","gateway.state.spec.state/id",2050905551),mr=new w(null,"hi","hi",-1821422114),nr=new w("gateway.state.spec.agm","interest","gateway.state.spec.agm/interest",1248511583),or=new w("gateway.common.spec.messages","peer_id","gateway.common.spec.messages/peer_id",-1253667286),wl=new Ad(null,"fn*","fn*",-752876845,null),pr=new w(null,"description","description",-1428560544),qr=new w(null,"visibility","visibility",1338380893),rr=new w("gateway.domains.agm.spec.requests","invocation_id","gateway.domains.agm.spec.requests/invocation_id",-621605438),sr=new w(null,"peer_factory","peer_factory",1685625260),tr=new w(null,"dispatch","dispatch",1319337009),ur=new w(null,"rest","rest",-1241696419),vr=new w(null,"sqn","sqn",2076851999),wr=new w("rl","reset","rl/reset",-800926172),xr=new w(null,"user","user",1532431356),yr=new w(null,"colon-up-arrow","colon-up-arrow",244853007),zr=new w(null,"activity-domain","activity-domain",1896268503),Ar=new w(null,"message","message",-406056002),Br=new w(null,"alternation","alternation",-1162147630),Cr=new w(null,"eq","eq",-618539067),Dr=new w(null,"required","required",1807647006),Er=new w("gateway.state.spec.state","no-user","gateway.state.spec.state/no-user",-565346809),Fr=new w(null,"new_peer_id","new_peer_id",1380469887),Gr=new w("gateway.domains.agm.spec.requests","remove-interest","gateway.domains.agm.spec.requests/remove-interest",-328528457),V=new Ad("cljs.core","fn","cljs.core/fn",-1065745098,null),Hr=new w(null,"string-ci","string-ci",374631805),Ir=new w(null,"fn","fn",-1175266204),Jr=new w(null,"kind","kind",-717265803),Kr=new w(null,"types_override","types_override",391099757),Lr=new w(null,"histo","histo",-821552278),Mr=new w("gateway.state.spec.mthds","no-methods","gateway.state.spec.mthds/no-methods",658181793),Nr=new w(null,"hide-tag-rule","hide-tag-rule",150267589),Or=new w("gateway.state.spec.mthds","id","gateway.state.spec.mthds/id",2078923376),Pr=new w("gateway.state.spec.pending-requests","gateway-requests","gateway.state.spec.pending-requests/gateway-requests",-1212651271),Qr=new w(null,"parser1","parser1",-439601422),Rr=new w(null,"parser2","parser2",1013754688),Sr=new w(null,"types-removed","types-removed",-1458332519),Tr=new w(null,"target_identity","target_identity",-786887198),Ur=new w(null,"joined_type","joined_type",973647374),Vr=new Ad("cljs.spec.alpha","conform","cljs.spec.alpha/conform",763100824,null),Wr=new w(null,"generation","generation",-2132542044),Xr=new w("gateway.common.context.spec.messages","reason","gateway.common.context.spec.messages/reason",-795974116),Yr=new Ad(null,"pending-forms","pending-forms",-1225172071,null),Zr=new Ad("clojure.walk","keywordize-keys","clojure.walk/keywordize-keys",-1055520580,null),$r=new w(null,"vargs","vargs",-966597273),vl=new Ad(null,"js*","js*",-1134233646,null),as=new w(null,"repeat","repeat",832692087),bs=new w(null,"suffix","suffix",367373057),cs=new w(null,"whitelist","whitelist",-979294437),ds=new w(null,"fatal","fatal",1874419888),es=new Ad("s","keys","s/keys",-1586011188,null),fs=new w("gateway.common.context.spec.requests","context-update","gateway.common.context.spec.requests/context-update",562123698),gs=new w(null,"rulename-right","rulename-right",1125609193),hs=new w(null,"at","at",1476951349),is=new w(null,"created_id","created_id",-1653142250),js=new w(null,"nl-t","nl-t",-1608382114),ks=new w(null,"activity_types","activity_types",-1792673047),ls=new Ad("cljs.tools.reader","read-string*","cljs.tools.reader/read-string*",1492661621,null),AH=new w(null,"interval","interval",1708495417),ms=new w(null,"remaining","remaining",-138926777),ns=new w("gateway.state.spec.state","handler-ch","gateway.state.spec.state/handler-ch",-891933338),os=new w(null,"read-cond","read-cond",1056899244),ps=new w("gateway.auth.spec","message","gateway.auth.spec/message",212934373),qs=new w(null,"gen-max","gen-max",-793680445),rs=new w(null,"column","column",2078222095),ss=new w(null,"metrics","metrics",394093469),ts=new w(null,"joined","joined",-231861661),us=new w(null,"or","or",235744169),vs=new w(null,"os","os",795021913),ws=new w(null,"directive","directive",793559132),xs=new w(null,"unsubscribe-context","unsubscribe-context",-1695207834),ys=new w(null,"buffer-level","buffer-level",928864731),zs=new w(null,"ps","ps",292358046),As=new Ad(null,"keyword?","keyword?",1917797069,null),Bs=new w("gateway.state.spec.activity","context-id","gateway.state.spec.activity/context-id",341891962),Cs=new w("gateway.domains.global.spec.requests","authentication","gateway.domains.global.spec.requests/authentication",2133771245),Ds=new w(null,"form","form",-1624062471),Es=new w(null,"group","group",582596132),Fs=new w(null,"ms","ms",-1152709733),Gs=new w(null,"?err","?err",549653299),DL=new w(null,"non_matched","non_matched",1326798534),Hs=new Ad("cljs.core","any?","cljs.core/any?",-2068111842,null),Is=new w(null,"mandatory","mandatory",542802336),Js=new w(null,"rulelist","rulelist",-1871218473),Ks=new w("gateway.state.spec.mthds","flags","gateway.state.spec.mthds/flags",408816343),Ls=new w(null,"parsers","parsers",-804353827),Ms=new w(null,"p1","p1",-936759954),Ns=new w(null,"pretty-writer","pretty-writer",-1222834267),Os=new w(null,"nt","nt",-835425781),Ps=new w("gateway.domains.global.spec.messages","context_id","gateway.domains.global.spec.messages/context_id",-1799893258),Qs=new w(null,"p2","p2",905500641),Rs=new w(null,"ns","ns",441598760),Ss=new w("gateway.state.spec.common","type","gateway.state.spec.common/type",-877512429),Ts=new w(null,"config","config",994861415),Us=new w(null,"done-nl","done-nl",-381024340),Vs=new w(null,"initial_context","initial_context",-797433349),Ws=new w(null,"removed","removed",609626430),Xs=new Ad(null,"address-type","address-type",-1732576165,null),Ys=new w("gateway.domains.agm.spec.unregister","methods","gateway.domains.agm.spec.unregister/methods",1593198071),Zs=new w(null,"ks","ks",1900203942),$s=new w(null,"source","source",-433931539),at=new Ad(null,"condp","condp",1054325175,null),bt=new w(null,"keyword","keyword",811389747),ct=new w("gateway.domains.agm.spec.requests","context","gateway.domains.agm.spec.requests/context",-1915055426),EL=new w(null,"authenticator","authenticator",728866366),et=new w(null,"vargs_","vargs_",552132148),ft=new w(null,"lo","lo",-931799889),gt=new w("gateway.state.spec.activity","ready-members","gateway.state.spec.activity/ready-members",-939559218),ht=new w("gateway.domains.global.spec.requests","added","gateway.domains.global.spec.requests/added",-1820753011),it=new w(null,"debug","debug",-1608172596),jt=new w(null,"hide","hide",-596913169),kt=new w(null,"id","id",-1388402092),lt=new w(null,"else","else",-1508377146),mt=new w(null,"seq","seq",-1817803783),nt=new Ad(null,"defn","defn",-126010802,null),ot=new w("gateway.state.spec.agm","calls","gateway.state.spec.agm/calls",16611731),pt=new w(null,"set","set",304602554),qt=new w(null,"join","join",-758861890),rt=new w("gateway.state.spec.context","owner","gateway.state.spec.context/owner",-1445790718),st=new w("gateway.domains.agm.spec.requests","accepted","gateway.domains.agm.spec.requests/accepted",1383451047),FL=new w(null,"js","js",1768080579),ut=new w(null,"origin","origin",1037372088),vt=new w(null,"LWSP","LWSP",782998598),wt=new w("instaparse.gll","end-index","instaparse.gll/end-index",-1851404441),xt=new w(null,"colinc","colinc",-584873385),yt=new w("gateway.domains.agm.spec.register","methods","gateway.domains.agm.spec.register/methods",-209946928),zt=new w(null,"node","node",581201198),hl=new Ad(null,"&","&",-2144855648,null),At=new w(null,"deny","deny",1589338523),W=new Ad(null,"%","%",-950237169,null),tb=new w(null,"print-length","print-length",1931866356),Bt=new w(null,"up-arrow","up-arrow",1705310333),zl=new Ad(null,".",".",1975675962,null),Ct=new Ad(null,"/","/",-1371932971,null),Dt=new w(null,"ns-filter","ns-filter",108598448),Et=new w("gateway.state.spec.factory","factories","gateway.state.spec.factory/factories",-1725265010),Ft=new w("gateway.domains.global.internal","authentication-failed","gateway.domains.global.internal/authentication-failed",1518002013),Gt=new w(null,"input_signature","input_signature",158735218),Ht=new w("gateway.common.context.spec.messages","creator_id","gateway.common.context.spec.messages/creator_id",2137586424),It=new w(null,"partial","partial",241141745),Jt=new w(null,"hostname_","hostname_",-2091647379),Kt=new w(null,"char-range","char-range",1443391389),Lt=new w("cljs.spec.alpha","kvs->map","cljs.spec.alpha/kvs->map",579713455),Mt=new w(null,"large-msg","large-msg",2140041016),Nt=new w("gateway.state.spec.context","contexts","gateway.state.spec.context/contexts",-1052863269),Ot=new w(null,"right-bracket","right-bracket",951856080),Pt=new w("gateway.domains.agm.spec.requests","publish","gateway.domains.agm.spec.requests/publish",-1020033829),Qt=new Ad(null,"_","_",-1201019570,null),Rt=new w(null,"context_id","context_id",1618636315),GL=new w(null,"definition","definition",-1198729982),St=new w("gateway.state.spec.activity","helper_types","gateway.state.spec.activity/helper_types",-920321960),Tt=new Ad(null,"k","k",-505765866,null),Ut=new Ad(null,"m","m",-1021758608,null),Vt=new w(null,"options","options",99638489),Wt=new Ad(null,"v","v",1661996586,null),Xt=new w(null,"service","service",-1963054559),HL=new w(null,"auth","auth",1389754926),Zt=new Ad(null,"=","=",-1501502141,null),$t=new w(null,"high","high",2027297808),au=new w(null,"auto","auto",-566279492),bu=new w(null,"whitespace","whitespace",-1340035483),pQ=new w(null,"function","function",-2127255473),cu=new w("gateway.state.spec.pending-requests","gateway-request","gateway.state.spec.pending-requests/gateway-request",796467142),du=new w(null,"authentication","authentication",1746273042),eu=new Ad("cljs.core","number?","cljs.core/number?",-811857295,null),fu=new w(null,"hierarchy","hierarchy",-1053470341),gu=new w(null,"plus","plus",211540661),hu=new w("gateway.state.spec.tokens","lifetime","gateway.state.spec.tokens/lifetime",887565809),iu=new w(null,"hex-val","hex-val",1267737401),ju=new w(null,"comma","comma",1699024745),ku=new w(null,"radix","radix",857016463),lu=new w(null,"subscribe-context","subscribe-context",1009129400),mu=new w(null,"first","first",-644103046),nu=new w(null,"add-peer-factories","add-peer-factories",-1612194889),ou=new w(null,"methods-added","methods-added",2044022595),pu=new w(null,"stream_id","stream_id",-871396659),qu=new w(null,"middleware-fn","middleware-fn",-61585752),ru=new Ad("cljs.core","vec","cljs.core/vec",307622519,null),su=new w(null,"state","state",-1988618099),tu=new w(null,"enlive","enlive",1679023921),uu=new w(null,"allow","allow",-1857325745),wu=new w(null,"domain","domain",1847214937),xu=new w("gateway.domain","operation-result","gateway.domain/operation-result",-1509018323),yu=new w(null,"sections","sections",-886710106),zu=new w(null,"activity-subscribers","activity-subscribers",12051372),qQ=new w(null,"split_size","split_size",-1272219234),Au=new w(null,"secs","secs",1532330091),Bu=new w(null,"drop-subscription","drop-subscription",-1853238873),Cu=new Ad(null,"partial","partial",1881673272,null),Du=new w(null,"identities","identities",-2100677764),Eu=new w(null,"instant","instant",655498374),Fu=new w(null,"min-count","min-count",1594709013),Gu=new w(null,"snapshot","snapshot",-1274785710),Hu=new w(null,"hide-tag","hide-tag",1347642501),Iu=new w(null,"alt-or-ord","alt-or-ord",310249425),Ju=new w(null,"HTAB","HTAB",11392612),Ku=new w(null,"start","start",-355208981),Lu=new w("gateway.state.spec.state","peer","gateway.state.spec.state/peer",-2119577277),Mu=new w(null,"nodes","nodes",-2099585805),Nu=new w(null,"trace?","trace?",1730690679),Ou=new w(null,"metrics-domain","metrics-domain",-1136423917),Pu=new w(null,"commands","commands",161008658),Qu=new w(null,"create-context","create-context",-1362772644),Ru=new w(null,"owner","owner",-392611939),Su=new w(null,"non-matched","non-matched",-624651186),Tu=new w("gateway.common.context.spec.requests","context-unsubscribe","gateway.common.context.spec.requests/context-unsubscribe",46104946),Uu=new w(null,"owner-changed","owner-changed",-1569176886),Vu=new w(null,"allowed","allowed",1436019743),Wu=new Ad("cljs.core","map?","cljs.core/map?",-1390345523,null),Xu=new w(null,"min-version","min-version",-1697197126),xl=new Ad(null,"recur","recur",1202958259,null),Yu=new w("gateway.state.spec.common","activity-id","gateway.state.spec.common/activity-id",245315645),Zu=new w(null,"current-id","current-id",210783650),$u=new w(null,"created","created",-704993748),av=new w(null,"element","element",1974019749),bv=new w(null,"now","now",-1650525531),rQ=new w(null,"metric","metric",408798077),cv=new w(null,"middleware","middleware",1462115504),dv=new w("gateway.domains.global.spec.requests","removed","gateway.domains.global.spec.requests/removed",-1641157465),ev=new w(null,"skip-validation","skip-validation",-195677600),fv=new w(null,"recur","recur",-437573268),gv=new w("gateway.state.spec.agm","method_id","gateway.state.spec.agm/method_id",1007252604),hv=new Ad(null,"message-body","message-body",-554118051,null),iv=new w(null,"available_domains","available_domains",-981328192),jv=new w(null,"invocation_id","invocation_id",1947784937),kv=new w(null,"aud","aud",357659490),lv=new Ad("cljs.core","unquote","cljs.core/unquote",1013085760,null),mv=new w("gateway.domain","leave","gateway.domain/leave",-1366936831),nv=new Ad("cljs.core","hash-set","cljs.core/hash-set",1130426749,null),ov=new w(null,"allow-spec","allow-spec",448749872),pv=new Ad(null,"defn-","defn-",1097765044,null),qv=new w(null,"no-user","no-user",793713538),rv=new w(null,"output-format","output-format",-1826382676),sv=new Ad("cljs.core","deref","cljs.core/deref",1901963335,null),tv=new w(null,"measurements","measurements",82224007),uv=new w("gateway.common.spec.messages","meta","gateway.common.spec.messages/meta",-2108831238),vv=new w(null,"block","block",664686210),wv=new w(null,"context_snapshot","context_snapshot",-703318056),xv=new w(null,"enabled","enabled",1195909756),yv=new w(null,"endpoint","endpoint",447890044),zv=new Ad(null,"when","when",1064114221,null),Av=new w("gateway.auth.spec","login","gateway.auth.spec/login",532129350),Bv=new w(null,"register","register",1968522516),Cv=new w(null,"handler-ch","handler-ch",2044105199),Dv=new w(null,"unhide","unhide",-413983695),Uj=new w(null,"more-marker","more-marker",-14717935),Ev=new w(null,"default_context","default_context",-1148569539),Fv=new w(null,"stacktrace-fonts","stacktrace-fonts",830799382),Gv=new w(null,"repos","repos",647483789),Hv=new w(null,"context-destroyed","context-destroyed",-1281742589),Iv=new w("gateway.domains.agm.spec.requests","data","gateway.domains.agm.spec.requests/data",688691322),Jv=new w("gateway.state.spec.activity","ready?","gateway.state.spec.activity/ready?",-1768127396),vQ=new w(null,"basic","basic",1043717368),ll=new Ad(null,"ns*","ns*",1840949383,null),Lv=new w("gateway.state.spec.activity","type","gateway.state.spec.activity/type",-462200009),wQ=new w(null,"initial","initial",1854648214),X=new w(null,"type","type",1174270348),Mv=new w(null,"none","none",1333468478),Nv=new w("cljs.spec.alpha","gfn","cljs.spec.alpha/gfn",-593120375),Ov=new w(null,"activity_id","activity_id",-240070853),sQ=new w(null,"hidden","hidden",-312506092),Pv=new w(null,"messages","messages",345434482),Qv=new w(null,"cause","cause",231901252),Rv=new w("cljs.spec.alpha","conform-all","cljs.spec.alpha/conform-all",45201917),Sv=new w(null,"creation-request","creation-request",1261647120),tQ=new w(null,"conflation","conflation",-1145614586),Tv=new w("gateway.domains.global.spec.requests","write_permissions","gateway.domains.global.spec.requests/write_permissions",774911915),Uv=new w(null,"else-params","else-params",-832171646),Vv=new w("gateway.state.spec.state","node-id","gateway.state.spec.state/node-id",-982277841),Wv=new w(null,"instance","instance",-2121349050),Xv=new w(null,"reduction-type","reduction-type",-488293450),Yv=new Ad("cljs.core","int?","cljs.core/int?",50730120,null),Zv=new w(null,"creator","creator",-1069241724),$v=new w(null,"left","left",-399115937),aw=new w(null,"async?","async?",1523057758),bw=new w(null,"publishers","publishers",1474752298),cw=new w(null,"line","line",212345235),dw=new w(null,"subscription-cancelled","subscription-cancelled",1868207049),ew=new w(null,"methods","methods",453930866),fw=new w(null,"method","method",55703592),gw=new Ad(null,"js","js",-886355190,null),hw=new w("gateway.state.spec.state","creation-request","gateway.state.spec.state/creation-request",473028997),iw=new Ad(null,"gateway.state.spec.common","gateway.state.spec.common",27478502,null),il=new Ad(null,"case*","case*",-1938255072,null),jw=new w(null,"node-id","node-id",779482292),kw=new w(null,"clients","clients",1436018090),lw=new w("gateway.state.spec.context","name","gateway.state.spec.context/name",-1494107954),mw=new w(null,"count","count",2139924085),nw=new w(null,"available","available",-1470697127),ow=new w(null,"right","right",-452581833),pw=new w("gateway.state.spec.state","peers","gateway.state.spec.state/peers",75810773),qw=new w(null,"linear","linear",872268697),rw=new w(null,"removed_id","removed_id",1940625745),yQ=new w(null,"heartbeats","heartbeats",-577028371),sw=new w("gateway.state.spec.common","identity","gateway.state.spec.common/identity",-343306948),tw=new w(null,"next-stack","next-stack",-481930728),uw=new w(null,"add-interest","add-interest",-1148631141),qb=new w(null,"readably","readably",1129599760),vw=new w(null,"ttl","ttl",-1115275118),ww=new w("gateway.common.context.spec.requests","read_permissions","gateway.common.context.spec.requests/read_permissions",-45173714),xw=new w(null,"sequence","sequence",926807414),yw=new w("gateway.state.spec.activity","user","gateway.state.spec.activity/user",-93065379),zw=new w("gateway.state.spec.domain-registry","uri","gateway.state.spec.domain-registry/uri",301088755),Aw=new w("gateway.state.spec.bus","subscription-id","gateway.state.spec.bus/subscription-id",-1920104157),Bw=new w("gateway.state.spec.bus","subscription","gateway.state.spec.bus/subscription",1556343370),Cw=new w(null,"added","added",2057651688),Dw=new w(null,"environment","environment",-666037640),Ew=new w(null,"optimize","optimize",-1912349448),Fw=new w(null,"data","data",-232669377),Gw=new w(null,"VCHAR","VCHAR",1962437706),zQ=new w(null,"whitelist-ns","whitelist-ns",868974100),Iw=new w(null,"?meta","?meta",-793560773),Jw=new w("gateway.state.spec.agm","subscription","gateway.state.spec.agm/subscription",1556334291),Kw=new w("gateway.common.context.spec.requests","command","gateway.common.context.spec.requests/command",-1702281587),Lw=new w(null,"appender","appender",1267426510),Mw=new Ad("cljs.core","boolean?","cljs.core/boolean?",1400713761,null),Nw=new w(null,"gw-request-id","gw-request-id",2114687330),Ow=new w(null,"lookahead","lookahead",-400102393),Pw=new w(null,"client-request","client-request",-1402967032),Qw=new w(null,"validation","validation",-2141396518),Rw=new Ad(null,"when-not","when-not",-1223136340,null),Sw=new w(null,"CR","CR",-1654295403),Tw=new w(null,"create","create",-1301499256),sl=new Ad(null,"ns","ns",2082130287,null),Uw=new w(null,"stack","stack",-793405930),Vw=new w("gateway.common.spec.messages","reason","gateway.common.spec.messages/reason",1129095963),tk=new w(null,"pending","pending",-220036727),Ww=new w("gateway.state.spec.mthds","input_signature","gateway.state.spec.mthds/input_signature",2082802494),Xw=new w(null,"subscription","subscription",1949009182),Yw=new w(null,"padchar","padchar",2018584530),Zw=new w(null,"strable","strable",1877668047),$w=new w(null,"peer-removed","peer-removed",1752359546),ax=new w(null,"defined-as","defined-as",-474679152),bx=new w(null,"col","col",-1959363084),cx=new w(null,"days","days",-1394072564),dx=new w("gateway.common.context.spec.requests","context-destroy","gateway.common.context.spec.requests/context-destroy",-2019226956),ex=new w("gateway.state.spec.restrictions","empty-restrictions","gateway.state.spec.restrictions/empty-restrictions",1011650447),fx=new w(null,"destroy","destroy",-843660405),gx=new w(null,"failure","failure",720415879),hx=new w(null,"factories","factories",1443149712),ix=new w("gateway.state.spec.activity","configuration","gateway.state.spec.activity/configuration",1853083827),jx=new w(null,"offset","offset",296498311),kx=new w(null,"conform-keys","conform-keys",-1800041814),lx=new Ad(null,"set?","set?",1636014792,null),mx=new w(null,"resolved_identity","resolved_identity",-874947112),nx=new w(null,"mincol","mincol",1230695445),ox=new w("gateway.domains.agm.spec.requests","data-message","gateway.domains.agm.spec.requests/data-message",-153411654),px=new w(null,"dec-val","dec-val",-1263870894),yl=new Ad(null,"set!","set!",250714521,null),qx=new w("gateway.state.spec.mthds","method-def","gateway.state.spec.mthds/method-def",858475302),rx=new w(null,"not-delivered","not-delivered",1599158697),sx=new w("gateway.common.context.spec.requests","removed","gateway.common.context.spec.requests/removed",-732316803),tx=new w(null,"hash_","hash_",-827203612),ux=new w(null,"miser-width","miser-width",-1310049437),vx=new w(null,"hash","hash",-13781596),wx=new w(null,"hide-nt","hide-nt",-228813845),xx=new w(null,"hiccup","hiccup",1218876238),yx=new w(null,"welcome","welcome",-578152123),zx=new Ad("cljs.spec.alpha","tuple","cljs.spec.alpha/tuple",-415901908,null),Ax=new w("gateway.domains.agm.spec.requests","method_id","gateway.domains.agm.spec.requests/method_id",926663112),Bx=new w("gateway.state.spec.factory","flags","gateway.state.spec.factory/flags",-1898127651),Cx=new w(null,"error","error",-978969032),Dx=new w(null,"WSP","WSP",-1046948716),Ex=new w(null,"rule-separator","rule-separator",1539322213),Fx=new Ad(null,"with-local-vars","with-local-vars",837642072,null),Gx=new Ad("cljs.spec.alpha","multi-spec","cljs.spec.alpha/multi-spec",175821274,null),Hx=new w("gateway.common.context.spec.requests","join","gateway.common.context.spec.requests/join",94453629),Ix=new w("gateway.common.spec.messages","request","gateway.common.spec.messages/request",712202569),Jx=new w(null,"args","args",1315556576),Kx=new w("gateway.state.spec.agm","interests","gateway.state.spec.agm/interests",1622331889),xQ=new w("zip","children","zip/children",-940194589),Lx=new w("gateway.state.spec.agm","caller","gateway.state.spec.agm/caller",-1898628116),Mx=new w("gateway.domains.agm.core","peer-methods","gateway.domains.agm.core/peer-methods",639951360),Nx=new w(null,"display_name","display_name",-1494335013),Ox=new w("gateway.domains.global.spec.requests","lifetime","gateway.domains.global.spec.requests/lifetime",-1145821948),Px=new w("gateway.state.spec.agm","callee","gateway.state.spec.agm/callee",1100257697),Qx=new w(null,"BIT","BIT",-1854474115),rl=new Ad(null,"new","new",-444906321,null),Rx=new Ad("cljs.core","with-meta","cljs.core/with-meta",749126446,null),Sx=new w(null,"cache?","cache?",-1601953949),Tx=new Ad("cljs.core","list","cljs.core/list",-1331406371,null),Ux=new w(null,"calls","calls",-433802344),Vx=new Ad(null,"lift-ns","lift-ns",602311926,null),Wx=new w(null,"allows-separator","allows-separator",-818967742),Xx=new w(null,"list","list",765357683),Yx=new Ad("cljs.core","seq","cljs.core/seq",-1649497689,null),Zx=new w(null,"node-builder","node-builder",-1956562605),$x=new w(null,"buffering","buffering",-876713613),UR=new w(null,"supports-clojure-structures?","supports-clojure-structures?",1492573457),ay=new w(null,"arg1","arg1",951899358),by=new w(null,"base-args","base-args",-1268706822),cy=new w(null,"arg3","arg3",-1486822496),dy=new w(null,"arg2","arg2",1729550917),ey=new w(null,"owner_type","owner_type",846064882),fy=new w("gateway.state.spec.activity","activity-peer","gateway.state.spec.activity/activity-peer",-1499406427),gy=new w(null,"event","event",301435442),hy=new Ad("gateway.domains.agm.subscriptions","drop-interest-rq","gateway.domains.agm.subscriptions/drop-interest-rq",1736302176,null),iy=new w(null,"rate-limit","rate-limit",1748082022),jy=new w(null,"?ns-str","?ns-str",2012733966),ky=new w(null,"commainterval","commainterval",-1980061083),ly=new w("gateway.state.spec.activity","default_context","gateway.state.spec.activity/default_context",1517722536),my=new w(null,"ping","ping",-1670114784),ny=new w(null,"min-level","min-level",1634684919),oy=new w(null,"value","value",305978217),py=new w("gateway.domains.agm.spec.requests","flags","gateway.domains.agm.spec.requests/flags",989202486),qy=new w(null,"peer","peer",1319662792),ry=new w("gateway.state.spec.activity","activities","gateway.state.spec.activity/activities",1132481734),sy=new w(null,"LF","LF",1177033158),ty=new w("gateway.state.spec.state","ids","gateway.state.spec.state/ids",259664151),uy=new w(null,"ns-blacklist","ns-blacklist",1957763142),vy=new w(null,"composite","composite",-257118970),wy=new Ad("cljs.core","concat","cljs.core/concat",-1133584918,null),xy=new Ad("cljs.spec.alpha","coll-of","cljs.spec.alpha/coll-of",1019430407,null),yy=new w("gateway.auth.spec","type","gateway.auth.spec/type",552402611),zy=new w(null,"ready?","ready?",-105765697),VR=new w(null,"startup","startup",1974425703),WR=new w(null,"cleanup","cleanup",1045776959),Ay=new w(null,"machine","machine",-1389886154),BT=new w(null,"stopped","stopped",-1490414640),By=new w("gateway.state.spec.activity","activity-subscribers","gateway.state.spec.activity/activity-subscribers",-1579465715),Cy=new w(null,"trace","trace",-1082747415),Dy=new w("instaparse.gll","start-index","instaparse.gll/start-index",404653620),Ey=new w(null,"subscriptions","subscriptions",1250949776),Fy=new w(null,"right-margin","right-margin",-810413306),Gy=new w("gateway.state.spec.state","user-name","gateway.state.spec.state/user-name",-1129365610),Hy=new w("gateway.auth.spec","remote_identity","gateway.auth.spec/remote_identity",-1701598746),Iy=new w(null,"ident","ident",-742346),Jy=new Ad("cljs.core","set?","cljs.core/set?",-1176684971,null),Ky=new Ad("cljs.core","keyword","cljs.core/keyword",-337316415,null),Ly=new w("gateway.state.spec.activity","properties","gateway.state.spec.activity/properties",-914053381),My=new w("gateway.domains.global.spec.requests","context-update","gateway.domains.global.spec.requests/context-update",-1728804708),Ny=new w("gateway.state.spec.domain-registry","registered-domains","gateway.state.spec.domain-registry/registered-domains",511803772),Oy=new Ad("cljs.core","list?","cljs.core/list?",-684796618,null),Py=new w("gateway.auth.spec","authentication","gateway.auth.spec/authentication",-2005184469),Qy=new w(null,"buffer-blob","buffer-blob",-1830112173),Ry=new w("gateway.domains.global.spec.requests","read_permissions","gateway.domains.global.spec.requests/read_permissions",75711320),Sy=new w(null,"features","features",-1146962336),Ty=new w(null,"context-id","context-id",1979873501),DT=new w(null,"inactive_seconds","inactive_seconds",-1714688448),Vy=new w(null,"full-listeners","full-listeners",50621827),Wy=new Ad(null,"with-open","with-open",172119667,null),Xy=new Ad("cljs.spec.alpha","merge","cljs.spec.alpha/merge",1420080689,null),Yy=new w("gateway.state.spec.state","activity-subscribers","gateway.state.spec.state/activity-subscribers",-776389065),Zy=new Ad(null,"p1__14969#","p1__14969#",-962076966,null),$y=new Ad(null,"response-type","response-type",146761069,null),ET=new w(null,"max-size","max-size",-874966132),az=new w(null,"cat","cat",-1457810207),bz=new w("gateway.state.spec.state","users","gateway.state.spec.state/users",-2072351172),cz=new w(null,"activity","activity",-1179221455),dz=new w("gateway.common.spec.messages","new_peer_id","gateway.common.spec.messages/new_peer_id",326805829),SS=new w(null,"max_size","max_size",1259311709),ez=new Ad("cljs.spec.alpha","conformer","cljs.spec.alpha/conformer",2140085535,null),FT=new w(null,"datapoint","datapoint",-1083555577),fz=new w(null,"gw-request","gw-request",1009584674),gz=new w(null,"local","local",-1497766724),hz=new w("gateway.state.spec.domain-registry","description","gateway.state.spec.domain-registry/description",-350920838),iz=new w(null,"login","login",55217519),jz=new Ad("cljs.spec.alpha","nilable","cljs.spec.alpha/nilable",1628308748,null),kz=new Ad("cljs.core","lift-ns","cljs.core/lift-ns",463499081,null),lz=new w("gateway.domains.agm.spec.requests","add-interest","gateway.domains.agm.spec.requests/add-interest",1660124918),mz=new w("gateway.state.spec.agm","subscription-id","gateway.state.spec.agm/subscription-id",-1920105558),nz=new w("gateway.domains.global.spec.requests","context-unsubscribe","gateway.domains.global.spec.requests/context-unsubscribe",-602451908),oz=new w(null,"channel","channel",734187692),pz=new w(null,"caller_id","caller_id",5404558),qz=new w(null,"remote-identity","remote-identity",1289489893),rz=new w(null,"full","full",436801220),sz=new w(null,"lines","lines",-700165781),tz=new w(null,"warn","warn",-436710552),uz=new w(null,"SP","SP",124290284),vz=new w("gateway.common.context.spec.requests","value","gateway.common.context.spec.requests/value",1114622378),Y=new w(null,"tag","tag",-1290361223),wz=new w(null,"indent-t","indent-t",528318969),xz=new w(null,"destination","destination",-253872483),CT=new w(null,"metadata","metadata",1799301597),yz=new w(null,"routing_key","routing_key",1236069137),zz=new w(null,"rulename","rulename",948914160),Az=new Ad(null,"p1__15595#","p1__15595#",-858324958,null),Bz=new w("gateway.state.spec.activity","name","gateway.state.spec.activity/name",113237718),Cz=new w(null,"gfn","gfn",791517474),Dz=new w(null,"activity-types","activity-types",-397260556),Ez=new w("gateway.state.spec.bus","subscriptions","gateway.state.spec.bus/subscriptions",359149340),Fz=new w(null,"years","years",-1298579689),Gz=new w("gateway.state.spec.agm","subscriptions","gateway.state.spec.agm/subscriptions",359122069),Hz=new w(null,"regex","regex",939488856),Iz=new w(null,"streams","streams",1465783789),nl=new Ad(null,"loop*","loop*",615029416,null),Jz=new w("cljs.spec.alpha","cpred","cljs.spec.alpha/cpred",-693471218),Kz=new w("gateway.state.spec.context","lifetime","gateway.state.spec.context/lifetime",-510268810),Lz=new w(null,"DIGIT","DIGIT",341251338),Mz=new w(null,"activity_type","activity_type",-194821832),Nz=new w("gateway.domains.global.spec.messages","creator_id","gateway.domains.global.spec.messages/creator_id",2015161290),Oz=new w(null,"NUM","NUM",-218662260),Pz=new w(null,"leave","leave",1022579443),Qz=new w("gateway.domains.agm.spec.requests","snapshot","gateway.domains.agm.spec.requests/snapshot",476154767),Rz=new Ad("cljs.core","apply","cljs.core/apply",1757277831,null),Sz=new w(null,"right-params","right-params",-1790676237),zX=new w(null,"scavenger","scavenger",107984617),Uz=new w(null,"identity","identity",1647396035),Vz=new w("gateway.state.spec.common","endpoint","gateway.state.spec.common/endpoint",-2063041997),Wz=new w(null,"colon","colon",-965200945),Xz=new w(null,"owner?","owner?",-839891990),Yz=new w("gateway.state.spec.state","contexts","gateway.state.spec.state/contexts",-1321025323),Zz=new w("gateway.state.spec.agm","server","gateway.state.spec.agm/server",1918098797),$z=new w(null,"CRLF","CRLF",11418756),aA=new Ad(null,"if-not","if-not",-265415609,null),bA=new w("gateway.state.spec.activity","participants","gateway.state.spec.activity/participants",-1995832242),cA=new w("gateway.domains.agm.spec.requests","unsubscribe","gateway.domains.agm.spec.requests/unsubscribe",-1898794870),sj=new w("cljs.core","not-found","cljs.core/not-found",-1572889185),dA=new w(null,"appenders","appenders",1245583998),eA=new w("gateway.state.spec.context","updates","gateway.state.spec.context/updates",-1191134395),fA=new w(null,"concatenation","concatenation",-951369614),gA=new w("gateway.state.spec.pending-requests","activity","gateway.state.spec.pending-requests/activity",1935677687),hA=new w(null,"vector","vector",1902966158),iA=new Ad(null,"drop-interest-rq","drop-interest-rq",-842860790,null),jA=new w("gateway.common.context.spec.requests","context-subscribe","gateway.common.context.spec.requests/context-subscribe",-318176635),kA=new w(null,"weeks","weeks",1844596125),lA=new w("gateway.domains.agm.spec.requests","arguments_kv","gateway.domains.agm.spec.requests/arguments_kv",-220182488),mA=new w(null,"remove","remove",-131428414),nA=new w(null,"token-ttl","token-ttl",-103977687),oA=new w(null,"last-access","last-access",1110221580),pA=new w(null,"peer_type","peer_type",371163309),qA=new w("gateway.state.spec.factory","peer_type","gateway.state.spec.factory/peer_type",-885367633),rA=new w(null,"bin-val","bin-val",1705209105),sA=new w("cljs.spec.alpha","accept","cljs.spec.alpha/accept",370988198),tA=new Ad("cljs.core","keyword?","cljs.core/keyword?",713156450,null),uA=new w(null,"timestamp","timestamp",579478971),ml=new Ad(null,"finally","finally",-1065347064,null),vA=new w(null,"func","func",-238706040),wA=new w(null,"yield","yield",177875009),xA=new w(null,"result","result",1415092211),yA=new w(null,"ord","ord",1142548323),zA=new w("gateway.state.spec.mthds","methods","gateway.state.spec.mthds/methods",-868139122),ol=new Ad(null,"do","do",1686842252,null),AA=new w(null,"NOT","NOT",-1689245341),BA=new w(null,"opt","opt",-794706369),CA=new w(null,"msecs","msecs",1711980553),DA=new w("gateway.state.spec.common","source","gateway.state.spec.common/source",1883706108),EA=new w(null,"comment","comment",532206069),FA=new w(null,"requestor_id","requestor_id",-1253857801),GA=new w(null,"sym","sym",-1444860305),HA=new w(null,"auto-whitespace","auto-whitespace",741152317),Bl=new Ad(null,"quote","quote",1377916282,null),IA=new w(null,"last","last",1105735132),JA=new w(null,"preserve","preserve",1276846509),KA=new w("gateway.state.spec.pending-requests","owner?","gateway.state.spec.pending-requests/owner?",346289860),LA=new w(null,"join-activity","join-activity",1683531460),MA=new w(null,"buffer-size","buffer-size",1047120420),NA=new w(null,"secret","secret",618547054),AX=new w(null,"updated-at","updated-at",-1592622336),OA=new w(null,"joined_id","joined_id",35485948),PA=new w(null,"read_permissions","read_permissions",766082539),QA=new w("gateway.domains.global.spec.requests","join","gateway.domains.global.spec.requests/join",-837980557),RA=new w(null,"regexp","regexp",-541372782),SA=new w("gateway.state.spec.activity","initiator","gateway.state.spec.activity/initiator",735796495),TA=new w("gateway.common.spec.messages","peer-message","gateway.common.spec.messages/peer-message",823378764),UA=new w(null,"deref","deref",-145586795),VA=new w("rl","all","rl/all",892118056),WA=new Ad(null,"fn","fn",465265323,null),XA=new w("gateway.state.spec.state","current-id","gateway.state.spec.state/current-id",798109991),YA=new w("gateway.state.spec.pending-requests","type","gateway.state.spec.pending-requests/type",-1681171358),ZA=new Ad(null,"dotimes","dotimes",-818708397,null),$A=new w("gateway.domains.agm.spec.requests","yield","gateway.domains.agm.spec.requests/yield",1398099968),aB=new w(null,"max-iterations","max-iterations",2021275563),bB=new w(null,"char","char",-641587586),cB=new w(null,"oob","oob",707302005),dB=new w(null,"start-time","start-time",814801386),eB=new Ad(null,"cond","cond",1606708055,null),fB=new w(null,"unsubscribe","unsubscribe",632650147),gB=new w(null,"key","key",-1516042587),hB=new w(null,"opt-whitespace","opt-whitespace",1115207927),iB=new Ad("cljs.core","vector?","cljs.core/vector?",-1550392028,null),jB=new w("gateway.state.spec.common","peer_id","gateway.state.spec.common/peer_id",1217199451),kB=new w(null,"your-version","your-version",-351781765),lB=new Ad("clojure.core","deref","clojure.core/deref",188719157,null),dk=new w(null,"alt-impl","alt-impl",670969595),mB=new w(null,"str","str",1089608819),nB=new w("gateway.state.spec.state","identities","gateway.state.spec.state/identities",-204237049),Al=new Ad(null,"var","var",870848730,null),oB=new w(null,"minpad","minpad",323570901),pB=new w("cljs.spec.alpha","invalid","cljs.spec.alpha/invalid",-1220295119),qB=new w("gateway.state.spec.mthds","display_name","gateway.state.spec.mthds/display_name",1469788607),rB=new w(null,"logical-block","logical-block",-581022564),ql=new Ad(null,"if","if",1181717262,null),sB=new w(null,"initial-context","initial-context",-32910095),tB=new w(null,"receiver","receiver",1768630781),uB=new w("gateway.domains.global.spec.messages","reason","gateway.domains.global.spec.messages/reason",-1756219178),vB=new w("gateway.domains.agm.spec.messages","meta","gateway.domains.agm.spec.messages/meta",520804499),wB=new Ad("cljs.core","some?","cljs.core/some?",-440439360,null),xB=new w(null,"users","users",-713552705),yB=new w(null,"max-age","max-age",-270129271),zB=new w("gateway.common.commands","source-removed","gateway.common.commands/source-removed",701959101),AB=new w(null,"pred-exprs","pred-exprs",1792271395),BB=new Ad(null,"any?","any?",-318999933,null),CB=new w(null,"string","string",-1989541586),DB=new w(null,"configuration","configuration",1431842520),EB=new w("gateway.common.context.spec.messages","updater_id","gateway.common.context.spec.messages/updater_id",-850230629),FB=new w(null,"repetition","repetition",1938392115),GB=new w("gateway.domains.global.spec.messages","updater_id","gateway.domains.global.spec.messages/updater_id",-1794190419),HB=new w(null,"updated","updated",-1627192056),IB=new w("gateway.state.spec.common","peer-id","gateway.state.spec.common/peer-id",-1398853323),JB=new w(null,"domains","domains",1410387719),RX=new w(null,"datapoints","datapoints",-1250577876),KB=new Ad(null,"uuid","uuid",-504564192,null),LB=new w(null,"repository-factories","repository-factories",-545628132),MB=new w(null,"CTL","CTL",-9995632),sb=new w(null,"dup","dup",556298533),NB=new w(null,"enabled?","enabled?",-1376075057),OB=new w(null,"updates","updates",2013983452),PB=new w("gateway.domains.global.spec.requests","context_id","gateway.domains.global.spec.requests/context_id",-1750912658),rk=new w(null,"status","status",-1997798413),QB=new w(null,"server","server",1499190120),RB=new w(null,"memory","memory",-1449401430),SB=new w(null,"ownership","ownership",892314581),TB=new w("cljs.spec.alpha","nil","cljs.spec.alpha/nil",1733813950),UB=new w(null,"creator_id","creator_id",1398967087),VB=new w("cljs.spec.alpha","k","cljs.spec.alpha/k",-1602615178),WB=new w("gateway.common.spec.messages","removed_id","gateway.common.spec.messages/removed_id",-1304577413),XB=new w("gateway.domains.global.spec.messages","reason_uri","gateway.domains.global.spec.messages/reason_uri",1393708653),YB=new w("gateway.state.spec.activity","child","gateway.state.spec.activity/child",-942548506),ZB=new w(null,"destroy-peer","destroy-peer",-1747489061),$B=new Ad(null,"struct-map","struct-map",-1387540878,null),aC=new w(null,"end-block-t","end-block-t",1544648735),bC=new w(null,"owner_id","owner_id",1001956033),cC=new w("gateway.state.spec.context","version","gateway.state.spec.context/version",-664315203),dC=new w("cljs.spec.alpha","v","cljs.spec.alpha/v",552625740),tl=new Ad(null,"deftype*","deftype*",962659890,null),eC=new w(null,"filters","filters",974726919),fC=new w(null,"report","report",1394055010),gC=new w(null,"qualifier","qualifier",125841738),hC=new w("gateway.state.spec.bus","routing-key","gateway.state.spec.bus/routing-key",554216520),iC=new w(null,"negative-listeners","negative-listeners",55241092),jC=new w(null,"success","success",1890645906),kC=new w(null,"stream","stream",1534941648),lC=new w(null,"target_id","target_id",-124012080),mC=new w(null,"retained","retained",630238157),nC=new w(null,"children","children",-940561982),oC=new Ad(null,"string?","string?",-1129175764,null),pC=new w("gateway.common.spec.requests","restrictions","gateway.common.spec.requests/restrictions",-1264539352),qC=new w(null,"HEXDIG","HEXDIG",-200221072),rC=new w(null,"listeners","listeners",394544445),sC=new w("gateway.state.spec.common","request_id","gateway.state.spec.common/request_id",2099278405),tC=new w("gateway.domains.agm.spec.requests","call","gateway.domains.agm.spec.requests/call",442214083),uC=new w(null,"mins","mins",467369676),vC=new w(null,"option","option",65132272),wC=new w(null,"months","months",-45571637),xC=new w("gateway.domains.agm.spec.requests","drop-subscription","gateway.domains.agm.spec.requests/drop-subscription",938907886),yC=new w("gateway.common.context.spec.requests","added","gateway.common.context.spec.requests/added",-1410443097),zC=new w("gateway.state.spec.context","id","gateway.state.spec.context/id",1782620593),AC=new w("gateway.common.context.spec.requests","write_permissions","gateway.common.context.spec.requests/write_permissions",-194247007),El=new Ad(null,"def","def",597100991,null),BC=new w(null,"map","map",1371690461),CC=new w(null,"params","params",710516235),DC=new w(null,"iso8601","iso8601",609352650),EC=new w(null,"max","max",61366548),FC=new w(null,"interop","interop",-1183783726),GC=new w(null,"uri","uri",-774711847),HC=new w("gateway.state.spec.factory","id","gateway.state.spec.factory/id",-395012522),IC=new w(null,"arguments_kv","arguments_kv",739148125),JC=new w(null,"activity-joined","activity-joined",-1584889318),KC=new w(null,"doc","doc",1913296891),LC=new w(null,"readers","readers",-2118263030),Cl=new Ad(null,"catch","catch",-1616370245,null),MC=new w(null,"dec-char","dec-char",-646625154),NC=new w(null,"path","path",-188191168),OC=new w(null,"server_id","server_id",-518165566),PC=new w(null,"tags","tags",1771418977),QC=new w("gateway.state.spec.agm","subscriber","gateway.state.spec.agm/subscriber",2009954326),RC=new w("gateway.state.spec.activity","visibility","gateway.state.spec.activity/visibility",-1264422156),SC=new Ad("cljs.core","string?","cljs.core/string?",-2072921719,null),TC=new w(null,"max-count","max-count",1539185305),UC=new w(null,"request_id","request_id",-208950594),VC=new w("gateway.state.spec.domain-registry","domain-uri","gateway.state.spec.domain-registry/domain-uri",636341057),WC=new w("gateway.domains.global.spec.requests","context-subscribe","gateway.domains.global.spec.requests/context-subscribe",614257563),XC=new w(null,"separator","separator",-1628749125),YC=new w(null,"contexts","contexts",4351546),ZC=new w(null,"create-token","create-token",-1564000484),$C=new w("gateway.auth.spec","user","gateway.auth.spec/user",803364081),aD=new w("gateway.state.spec.agm","request_id","gateway.state.spec.agm/request_id",-1401687879),bD=new w(null,"version","version",425292698),cD=new Ad("clojure.core","unquote","clojure.core/unquote",843087510,null),dD=new w(null,"opt-un","opt-un",883442496),eD=new Ad("cljs.spec.alpha","keys","cljs.spec.alpha/keys",1109346032,null),fD=new w(null,"circle","circle",1903212362),gD=new Ad(null,"gateway.auth.spec","gateway.auth.spec",1721169563,null),hD=new w("gateway.state.spec.context","members","gateway.state.spec.context/members",1219498589),iD=new w(null,"impersonate-peer","impersonate-peer",-1409232482),jD=new w(null,"cluster","cluster",535175621),kD=new Ad(null,"-Inf","-Inf",-2123243689,null),lD=new w("gateway.state.spec.agm","streams","gateway.state.spec.agm/streams",-460960790),mD=new w(null,"limits","limits",-2101003399),nD=new w(null,"start-pos","start-pos",668789086),oD=new w(null,"flags","flags",1775418075),pD=new w(null,"info","info",-317069002),qD=new w(null,"subscription_id","subscription_id",1241304848),rD=new w(null,"splicing?","splicing?",-428596366),sD=new w(null,"write_permissions","write_permissions",-2075461534),tD=new w("cljs.spec.alpha","describe","cljs.spec.alpha/describe",1883026911),uD=new w("gateway.state.spec.context","read_permissions","gateway.state.spec.context/read_permissions",-559958390),vD=new w("gateway.domains.agm.spec.requests","sequence","gateway.domains.agm.spec.requests/sequence",1051925549),wD=new w(null,"test","test",577538877),xD=new w("gateway.common.context.spec.requests","context-create","gateway.common.context.spec.requests/context-create",-947794767),yD=new w(null,"fill","fill",883462889),SX=new w(null,"heartbeat-interval","heartbeat-interval",-1509739653),zD=new w(null,"end-of-string","end-of-string",1567354241),AD=new w(null,"reset","reset",-800929946),BD=new w("cljs.spec.alpha","amp","cljs.spec.alpha/amp",831147508),CD=new w(null,"file","file",-1269645878),DD=new w("rl","peek","rl/peek",-291391771),ED=new w(null,"buffer-block","buffer-block",-10937307),FD=new Ad(null,"p1__14968#","p1__14968#",-1002975068,null),GD=new w("cljs.spec.alpha","alt","cljs.spec.alpha/alt",523685437),HD=new w("gateway.state.spec.activity","activity","gateway.state.spec.activity/activity",449324238),ID=new w("gateway.state.spec.state","signature-key","gateway.state.spec.state/signature-key",1283598087),JD=new w(null,"generator-fn","generator-fn",811851656),KD=new w(null,"keys-pred","keys-pred",858984739),LD=new w("gateway.domains.agm.spec.messages","reason_uri","gateway.domains.agm.spec.messages/reason_uri",577151711),MD=new Ad("cljs.core","array-map","cljs.core/array-map",-1519210683,null),ND=new w(null,"topic","topic",-1960480691),OD=new w("gateway.common.context.spec.requests","delta","gateway.common.context.spec.requests/delta",-694068490),PD=new w("gateway.domains.agm.spec.requests","invoke","gateway.domains.agm.spec.requests/invoke",1837084336),QD=new w(null,"members","members",159001018),RD=new w(null,"?msg-fmt","?msg-fmt",-852453891),UD=new w(null,"buffer_size","buffer_size",-2122723051),SD=new Ad(null,"queue","queue",-1198599890,null),TD=new w(null,"text","text",-1790561697),YD=new w("gateway.domains.global.spec.requests","hello","gateway.domains.global.spec.requests/hello",-398737422),VD=new w("gateway.state.spec.mthds","result_signature","gateway.state.spec.mthds/result_signature",-1987803736),WD=new Ad("s","or","s/or",1876282981,null),XD=new w("gateway.state.spec.activity","parent","gateway.state.spec.activity/parent",-359694046),$D=new w("gateway.common.context.spec.messages","reason_uri","gateway.common.context.spec.messages/reason_uri",-1687789209),ZD=new w(null,"?err_","?err_",789480858),cE=new w("gateway.domains.agm.spec.unregister","unregister","gateway.domains.agm.spec.unregister/unregister",388278210),aE=new w("gateway.state.spec.agm","stream","gateway.state.spec.agm/stream",1961075649),bE=new w(null,"level","level",1290497552),fE=new w(null,"start-col","start-col",668080143),dE=new w("gateway.common.spec.messages","outgoing-message","gateway.common.spec.messages/outgoing-message",1952031218),rb=new w(null,"meta","meta",1499536964),eE=new w("gateway.state.spec.pending-requests","id","gateway.state.spec.pending-requests/id",-199997554),eY=new w(null,"started?","started?",-1301062863),iE=new w(null,"invoke","invoke",1145927159),hE=new w(null,"local-ip","local-ip",302001740),kE=new w(null,"w","w",354169001),jE=new w(null,"rulename-left","rulename-left",-1824251564),BX=new w(null,"r","r",-471384190),Nk=new w(null,"ancestors","ancestors",-776045424),nE=new w(null,"n","n",562130025),lE=new w(null,"p","p",151049309),mE=new w(null,"helper_types","helper_types",1747427755),oE=new w(null,"system","system",-29381724),qE=new w(null,"def","def",-1043430536),CX=new w(null,"pnodes","pnodes",1739080565),pE=new w(null,"reason_uri","reason_uri",1062203786),sE=new w(null,"leeway","leeway",-355669977),rE=new w(null,"req-keys","req-keys",514319221),jl=new Ad(null,"defrecord*","defrecord*",-1936366207,null),tE=new w("gateway.domains.global.internal","authentication-request","gateway.domains.global.internal/authentication-request",502904463),vE=new w(null,"k","k",-2146297393),DX=new w(null,"l","l",1395893423),uE=new w(null,"f","f",-1597136552),wE=new w(null,"e","e",1381269198),zE=new w(null,"d","d",1972142424),xE=new Ad(null,"cljs.tools.reader","cljs.tools.reader",-831293977,null),yE=new w("gateway.state.spec.common","address","gateway.state.spec.common/address",394563279),BE=new w(null,"overflowchar","overflowchar",-1620088106),AE=new w(null,"opt-specs","opt-specs",-384905450),CE=new w(null,"min-remaining","min-remaining",962687677),FE=new w(null,"application","application",551185447),DE=new w("gateway.state.spec.factory","factory","gateway.state.spec.factory/factory",1055781172),EE=new w("gateway.common.spec.messages","incoming-message","gateway.common.spec.messages/incoming-message",-528171747),GE=new w(null,"max-connections-per-user","max-connections-per-user",-1995174555),HE=new w("gateway.common.context.spec.requests","restrictions","gateway.common.context.spec.requests/restrictions",-1766361),LE=new w(null,"commachar","commachar",652859327),ul=new Ad(null,"let*","let*",1920721458,null),IE=new w(null,"inherit","inherit",-1840815422),JE=new Ad("cljs.core","hash-map","cljs.core/hash-map",303385767,null),KE=new w("gateway.state.spec.factory","configuration","gateway.state.spec.factory/configuration",154272470),OE=new w("gateway.domains.global.spec.requests","destination","gateway.domains.global.spec.requests/destination",165081940),P2=new w(null,"running","running",1554969103),ME=new w("gateway.state.spec.common","channel","gateway.state.spec.common/channel",426185507),NE=new w("gateway.common.spec.messages","local","gateway.common.spec.messages/local",1736687122),TE=new w(null,"add-types","add-types",-711550002),PE=new w(null,"registered-domains","registered-domains",-559729182),kl=new Ad(null,"try","try",-1273693247,null),QE=new w(null,"ns-whitelist","ns-whitelist",-1717299774),RE=new Ad("clojure.core","unquote-splicing","clojure.core/unquote-splicing",-552003150,null),SE=new w("gateway.state.spec.pending-requests","gateway_token","gateway.state.spec.pending-requests/gateway_token",-1747123785),UE=new w("gateway.auth.spec","response","gateway.auth.spec/response",1690727657),VE=new w("gateway.domains.global.spec.messages","type","gateway.domains.global.spec.messages/type",708595817),Bk=new w(null,"keyword-fn","keyword-fn",-64566675),eF=new w(null,"section","section",-300141526),WE=new w("gateway.state.spec.mthds","method","gateway.state.spec.mthds/method",1887447044),XE=new w("gateway.common.spec.messages","type","gateway.common.spec.messages/type",2118883938),YE=new w(null,"hex-char","hex-char",764443568),ZE=new w(null,"private","private",-558947994),$E=new w("gateway.state.spec.context","write_permissions","gateway.state.spec.context/write_permissions",1195182789),aF=new w(null,"into","into",-150836029),bF=new w("cljs.spec.alpha","rep","cljs.spec.alpha/rep",1483217317),cF=new w(null,"star","star",279424429),dF=new w("cljs.spec.alpha","op","cljs.spec.alpha/op",-1269055252),Q2=new w(null,"split-size","split-size",-1210797067),iF=new w(null,"reloading","reloading",961158984),fF=new w(null,"full-results","full-results",-1500225407),gF=new w(null,"low","low",-1601362409),hF=new Ad(null,"some?","some?",234752293,null),kF=new w(null,"pretty","pretty",-1916372486),jF=new w("gateway.state.spec.context","context","gateway.state.spec.context/context",-1884667246),nF=new w("gateway.domains.agm.spec.messages","removed_id","gateway.domains.agm.spec.messages/removed_id",-1904544764),lF=new w(null,"own-ident","own-ident",1422237852),mF=new w("gateway.state.spec.mthds","name","gateway.state.spec.mthds/name",393834509),oF=new w(null,"authentication-request","authentication-request",-2091151542),pF=new Ad("gateway.auth.spec","response-type","gateway.auth.spec/response-type",724325508,null),qF=new w(null,"remove-peer-factories","remove-peer-factories",-316522514),sF=new w(null,"values","values",372645556),rF=new w(null,"unsupported-operation","unsupported-operation",1890540953),vF=new Ad(null,"let","let",358118826,null),tF=new w(null,"bus-domain","bus-domain",1136396472),uF=new w("gateway.state.spec.bus","bus-domain","gateway.state.spec.bus/bus-domain",1755593660),TX=new w(null,"ppath","ppath",-1758182784),wF=new w(null,"leave-activity","leave-activity",-484899731),xF=new w(null,"peer-requested","peer-requested",1452118887),AF=new w("gateway.domains.agm.spec.requests","post","gateway.domains.agm.spec.requests/post",-1221170496),yF=new Ad("gateway.common.spec.messages","message-body","gateway.common.spec.messages/message-body",-1647648637,null),zF=new w(null,"forms","forms",2045992350),BF=new w("gateway.domains.agm.spec.requests","result","gateway.domains.agm.spec.requests/result",1027857196),DF=new w("gateway.domains.agm.spec.messages","source_type","gateway.domains.agm.spec.messages/source_type",276727970),CF=new w(null,"agm-domain","agm-domain",1137239322),GF=new w(null,"destroy_peer_id","destroy_peer_id",388079342),EF=new w(null,"expecting","expecting",-57706705),FF=new w(null,"rule","rule",729973257),HF=new w("gateway.domains.agm.spec.requests","caller_id","gateway.domains.agm.spec.requests/caller_id",-211861801),IF=new w(null,"parent","parent",-878878779),KF=new w("gateway.common.context.spec.requests","type","gateway.common.context.spec.requests/type",372560587),JF=new w(null,"lifetime","lifetime",-1568939561),MF=new w(null,"update-context","update-context",1410241659),LF=new w(null,"standard","standard",-1769206695),OF=new w(null,"clauses","clauses",1454841241),NF=new w(null,"blacklist","blacklist",1248093170),SF=new Ad(null,"defonce","defonce",-1681484013,null),R2=new w(null,"latest-status","latest-status",875691533),PF=new w("gateway.state.spec.agm","agm-domain","gateway.state.spec.agm/agm-domain",686860067),QF=new w("gateway.state.spec.state","services","gateway.state.spec.state/services",-925305284),RF=new w(null,"Epsilon","Epsilon",133418452),XF=new w(null,"base","base",185279322),WF=new Ad(null,"read-string*","read-string*",1046768315,null),bG=new w(null,"remove-types","remove-types",-1777229898),YF=new w(null,"inside-comment","inside-comment",1258069708),ZF=new w(null,"no-stacktrace?","no-stacktrace?",1701072694),$F=new w("gateway.state.spec.agm","invocations","gateway.state.spec.agm/invocations",-1391969355),aG=new w(null,"character","character",380652989),cG=new w(null,"publisher","publisher",-153364540),eG=new w("gateway.domains.agm.subscriptions","drop-interest","gateway.domains.agm.subscriptions/drop-interest",-1584375112),dG=new w("gateway.state.spec.bus","topic-repattern","gateway.state.spec.bus/topic-repattern",736554526),fG=new w(null,"delta","delta",108939957),jG=new w("promesa.core","default","promesa.core/default",1773193826),gG=new w("gateway.state.spec.agm","invocation","gateway.state.spec.agm/invocation",-928333769),hG=new Ad("cljs.core","=","cljs.core/=",-1891498332,null),iG=new w(null,"look","look",-539441433),kG=new w(null,"methods-removed","methods-removed",-724408194),mG=new w(null,"local?","local?",-1422786101),fY=new w("zip","branch?","zip/branch?",-998880862),lG=new w("cljs.spec.alpha","unknown","cljs.spec.alpha/unknown",651034818),qG=new w(null,"type-tag","type-tag",-1873863267),nG=new w(null,"peer-added","peer-added",322139575),oG=new w(null,"namespaced-map","namespaced-map",1235665380),pG=new w(null,"peer_id","peer_id",1920005364),sG=new Ad(null,"locking","locking",1542862874,null),rG=new w("gateway.state.spec.activity","id","gateway.state.spec.activity/id",1251756953),vG=new w("gateway.common.context.spec.requests","context_id","gateway.common.context.spec.requests/context_id",1348419676),tG=new w(null,"factor","factor",-2103172748),uG=new w("gateway.state.spec.activity","activity-type","gateway.state.spec.activity/activity-type",1221900323),xG=new w("gateway.common.context.spec.requests","reset","gateway.common.context.spec.requests/reset",6157861),wG=new w(null,"peers","peers",2005345354),yG=new w("gateway.domains.agm.spec.requests","subscribe","gateway.domains.agm.spec.requests/subscribe",1050374291),zG=new w("gateway.domains.agm.spec.requests","subscription_id","gateway.domains.agm.spec.requests/subscription_id",1666574151),AG=new w("gateway.domains.agm.spec.messages","local","gateway.domains.agm.spec.messages/local",63355787),CG=new w(null,"typ","typ",-1304536900),BG=new w("gateway.state.spec.activity","owner","gateway.state.spec.activity/owner",-1983556102),DG=new w(null,"pos","pos",-864607220),EG=new w(null,"remote_identity","remote_identity",1864550587),HG=new w(null,"max-pending-requests","max-pending-requests",-1862384536),FG=new w(null,"?file","?file",1533429675),GG=new Ad("cljs.core","zipmap","cljs.core/zipmap",-1902130674,null),JG=new w(null,"left_id","left_id",730267975),IG=new w(null,"total","total",1916810418),NG=new w(null,"suppress-namespaces","suppress-namespaces",2130686956),KG=new w("gateway.common.spec.messages","message-type","gateway.common.spec.messages/message-type",929650450),LG=new w("instaparse","failure","instaparse/failure",1422918607),MG=new w(null,"end-line","end-line",1837326455),OG=new w("gateway.domain","join","gateway.domain/join",1465372684),PG=new w(null,"gateway_token","gateway_token",1638490713),TR=new w(null,"cur","cur",1153190599),QG=new w(null,"ebnf","ebnf",31967825),RG={},SG,aZ,bZ,TG={};function cZ(e,t){if(null!=e&&null!=e.Li)e=e.Li(e,t);else{var n=cZ[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=cZ._))throw Eb("ReadPort.take!",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function UG(e,t,n){if(null!=e&&null!=e.Oe)e=e.Oe(e,t,n);else{var r=UG[ba(null==e?null:e)];if(null!=r)e=r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=UG._))throw Eb("WritePort.put!",e);e=r.j?r.j(e,t,n):r.call(null,e,t,n)}}return e}function WG(e){if(null!=e&&null!=e.Gd)e=e.Gd(e);else{var t=WG[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=WG._))throw Eb("Channel.close!",e);e=t.g?t.g(e):t.call(null,e)}}return e}function XG(e){if(null!=e&&null!=e.Df)e=e.Df(e);else{var t=XG[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=XG._))throw Eb("Handler.active?",e);e=t.g?t.g(e):t.call(null,e)}}return e}function YG(e){if(null!=e&&null!=e.Ef)e=e.Ef(e);else{var t=YG[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=YG._))throw Eb("Handler.commit",e);e=t.g?t.g(e):t.call(null,e)}}return e}function ZG(e,t){if(null!=e&&null!=e.ce)e=e.ce(e,t);else{var n=ZG[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=ZG._))throw Eb("Buffer.add!*",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}var $G=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function aH(e,t,n,r,i){for(var o=0;o<i;)n[r+o]=e[t+o],o+=1}function bH(e){this.length=this.wa=this.head=0,this.o=e}function cH(e){return new bH(Array(e))}function dH(e,t){this.ga=e,this.n=t,this.B=2,this.M=0}function eH(e,t){this.ga=e,this.n=t,this.B=2,this.M=0}function dZ(e,t){this.ga=e,this.n=t,this.B=2,this.M=0}function fH(){return Ta("iPhone")&&!Ta("iPod")&&!Ta("iPad")}$G.g=function(e){return e},$G.h=function(e,t){return ZG(e,t)},$G.I=2,h=bH.prototype,h.pop=function(){if(0===this.length)return null;var e=this.o[this.wa];return this.o[this.wa]=null,this.wa=(this.wa+1)%this.o.length,--this.length,e},h.unshift=function(e){return this.o[this.head]=e,this.head=(this.head+1)%this.o.length,this.length+=1,null},h.unbounded_unshift=function(e){return this.length+1===this.o.length&&this.resize(),this.unshift(e)},h.resize=function(){var e=Array(2*this.o.length);return this.wa<this.head?(aH(this.o,this.wa,e,0,this.length),this.wa=0,this.head=this.length,this.o=e):this.wa>this.head?(aH(this.o,this.wa,e,0,this.o.length-this.wa),aH(this.o,0,e,this.o.length-this.wa,this.head),this.wa=0,this.head=this.length,this.o=e):this.wa===this.head?(this.head=this.wa=0,this.o=e):null},h.cleanup=function(e){for(var t=this.length,n=0;;){if(!(n<t))return null;var r=this.pop();(e.g?e.g(r):e.call(null,r))&&this.unshift(r),n+=1}},dH.prototype.Fd=function(){return this.ga.length>=this.n},dH.prototype.ce=function(e,t){return this.ga.unbounded_unshift(t),this},dH.prototype.da=function(){return this.ga.length},eH.prototype.Fd=function(){return!1},eH.prototype.ce=function(e,t){return this.ga.length!==this.n&&this.ga.unshift(t),this},eH.prototype.da=function(){return this.ga.length},dZ.prototype.Fd=function(){return!1},dZ.prototype.ce=function(e,t){return this.ga.length===this.n&&this.ga.pop(),this.ga.unshift(t),this},dZ.prototype.da=function(){return this.ga.length},Ta("Opera");var gH=Ta("Trident")||Ta("MSIE");Ta("Edge");var hH=Ta("Gecko")&&!(-1!=Sa.toLowerCase().indexOf("webkit")&&!Ta("Edge"))&&!(Ta("Trident")||Ta("MSIE"))&&!Ta("Edge"),iH=-1!=Sa.toLowerCase().indexOf("webkit")&&!Ta("Edge");iH&&Ta("Mobile"),Ta("Macintosh"),Ta("Windows"),Ta("Linux")||Ta("CrOS");var eZ=aa.navigator||null,lH;function kH(){var e=document,t="IFRAME";return"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)}function mH(){var e=aa.MessageChannel;if(void 0===e&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ta("Presto")&&(e=function(){var e=kH();e.style.display="none",document.documentElement.appendChild(e);var t=e.contentWindow;(e=t.document).open(),e.close();var n="callImmediate"+Math.random(),r="file:"==t.location.protocol?"*":t.location.protocol+"//"+t.location.host;e=la((function(e){"*"!=r&&e.origin!=r||e.data!=n||this.port1.onmessage()}),this),t.addEventListener("message",e,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(n,r)}}}),void 0!==e&&!Ta("Trident")&&!Ta("MSIE")){var t=new e,n={},r=n;return t.port1.onmessage=function(){if(void 0!==n.next){var e=(n=n.next).Zd;n.Zd=null,e()}},function(e){r.next={Zd:e},r=r.next,t.port2.postMessage(0)}}return function(e){aa.setTimeout(e,0)}}eZ&&(eZ.appVersion||"").indexOf("X11"),Ta("Android"),fH(),Ta("iPad"),Ta("iPod"),fH()||Ta("iPad")||Ta("iPod"),Sa.toLowerCase().indexOf("kaios");var nH=cH(32),oH=!1,pH=!1;function qH(){oH=!0,pH=!1;for(var e=0;;){var t=nH.pop();if(!(null!=t&&(t.A?t.A():t.call(null),1024>e)))break;e+=1}return oH=!1,0<nH.length?rH.A?rH.A():rH.call(null):null}function rH(){if(pH&&oH)return null;pH=!0,"function"!=typeof aa.setImmediate||aa.Window&&aa.Window.prototype&&!Ta("Edge")&&aa.Window.prototype.setImmediate==aa.setImmediate?(lH||(lH=mH()),lH(qH)):aa.setImmediate(qH)}function sH(e){nH.unbounded_unshift(e),rH()}function k2(e,t){setTimeout(e,t)}var tH={},uH;function vH(e){return void 0!==$a&&void 0!==ab&&void 0!==RG&&void 0!==TG&&void 0!==tH&&void 0!==uH||((uH=function(e,t){this.v=e,this.Mh=t,this.B=425984,this.M=0}).prototype.S=function(e,t){return new uH(this.v,t)},uH.prototype.R=function(){return this.Mh},uH.prototype.Jb=function(){return this.v},uH.Na=!0,uH.Ja="cljs.core.async.impl.channels/t_cljs$core$async$impl$channels9705",uH.Pa=function(e){return Qc(e,"cljs.core.async.impl.channels/t_cljs$core$async$impl$channels9705")}),new uH(e,P)}function wH(e,t){this.Ld=e,this.v=t}function xH(e){return XG(e.Ld)}function yH(e,t,n,r){this.vd=e,this.ge=0,this.Ic=t,this.fe=0,this.ga=n,this.closed=!1,this.Nb=r}function zH(e){for(;;){var t=e.Ic.pop();if(null!=t){var n=t.Ld;if(t.v,!n.Df(null))continue;sH(function(e){return function(){return e.g?e.g(!0):e.call(null,!0)}}(n.Ef(null)))}break}e.Ic.cleanup(yg(!1)),e.Gd(null)}function BH(e){return console.log(e),null}function CH(e,t){var r=n(null)?null:BH;return null==(t=r.g?r.g(t):r.call(null,t))?e:$G.h(e,t)}function DH(e){return new yH(cH(32),cH(32),e,(t=n(null)?null.g?null.g($G):null.call(null,$G):$G,function(){function e(e,n){try{return t.h?t.h(e,n):t.call(null,e,n)}catch(t){return CH(e,t)}}function n(e){try{return t.g?t.g(e):t.call(null,e)}catch(t){return CH(e,t)}}var r;return r=function(t,r){switch(arguments.length){case 1:return n.call(this,t);case 2:return e.call(this,t,r)}throw Error("Invalid arity: "+arguments.length)},r.g=n,r.h=e,r}()));var t}function EH(e,t,n){this.key=e,this.v=t,this.forward=n,this.B=2155872256,this.M=0}function FH(e,t,n){n=Array(n+1);for(var r=0;r<n.length;)n[r]=null,r+=1;return new EH(e,t,n)}function GH(e,t,r,i){for(;;){if(0>r)return e;e:for(;;){var o=r<e.forward.length?e.forward[r]:null;if(!n(o))break e;if(!(o.key<t))break e;e=o}null!=i&&(i[r]=e),--r}}function HH(){this.Hc=FH(null,null,0),this.level=0,this.B=2155872256,this.M=0}yH.prototype.Oe=function(e,t,r){var i,o=this,l=o.closed;if(r.Df(null)){if(l)return r.Ef(null),vH(!1);if(n(n(i=o.ga)?yb(o.ga.Fd()):i)){r.Ef(null);var s=Ud(o.Nb.h?o.Nb.h(o.ga,t):o.Nb.call(null,o.ga,t));if(r=function(){for(var e=F;;){if(!(0<o.vd.length&&0<C(o.ga)))return e;var t=o.vd.pop();if(t.Df(null)){var n=t.Ef(null),r=o.ga.ga.pop();e=re.h(e,function(e,t,n){return function(){return t.g?t.g(n):t.call(null,n)}}(0,n,r))}}}(),s&&zH(this),z(r)){r=z(r),e=null;for(var a=0,u=0;;)if(u<a){sH(e.$(null,u)),u+=1}else{if(!(r=z(r)))break;Me(e=r)?(r=ed(e),u=fd(e),e=r,a=C(r),r=u):(sH(r=A(e)),r=B(e),e=null,a=0),u=0}}return vH(!0)}if(e=function(){for(;;){var e=o.vd.pop();if(!n(e))return null;if(n(e.Df(null)))return e}}(),n(e)){var c=e.Ef(null);return r.Ef(null),sH((function(){return c.g?c.g(t):c.call(null,t)})),vH(!0)}return 64<o.fe?(o.fe=0,o.Ic.cleanup(xH)):o.fe+=1,n(r.Ne())&&o.Ic.unbounded_unshift(new wH(r,t)),null}return vH(!l)},yH.prototype.Li=function(e,t){var r,i=this;if(t.Df(null)){if(null!=i.ga&&0<C(i.ga)){if(n(e=t.Ef(null))){var o=i.ga.ga.pop(),l=yb(i.ga.Fd())&&0<i.Ic.length?function(){for(var e=F;;){var t=i.Ic.pop(),r=t.Ld;t=t.v;var o=r.Df(null);if(e=n(r=o?r.Ef(null):o)?re.h(e,r):e,!(yb(t=n(r)?Ud(i.Nb.h?i.Nb.h(i.ga,t):i.Nb.call(null,i.ga,t)):null)&&yb(i.ga.Fd())&&0<i.Ic.length))return new Q(null,2,5,S,[t,e],null)}}():null,s=G(l,0,null),a=G(l,1,null);n(s)&&zH(this);for(var u=z(a),c=null,h=0,d=0;;)if(d<h){var f=c.$(null,d);sH(function(e,t,n,r,i){return function(){return i.g?i.g(!0):i.call(null,!0)}}(0,0,0,0,f)),d+=1}else{var p=z(u);if(!p)break;Me(f=p)?(u=ed(f),d=fd(f),c=u,h=C(u),u=d):(sH(function(e,t,n,r,i){return function(){return i.g?i.g(!0):i.call(null,!0)}}(0,0,0,0,A(f))),u=B(f),c=null,h=0),d=0}return vH(o)}return null}if(e=function(){for(;;){var e=i.Ic.pop();if(!n(e))return null;if(XG(e.Ld))return e}}(),n(e)){var g=YG(e.Ld);return t.Ef(null),sH((function(){return g.g?g.g(!0):g.call(null,!0)})),vH(e.v)}if(n(i.closed))return n(i.ga)&&(i.Nb.g?i.Nb.g(i.ga):i.Nb.call(null,i.ga)),n(n(r=t.Df(null))?t.Ef(null):r)?(e=function(){var e=i.ga;return n(e)?0<C(i.ga):e}(),vH(o=n(e)?i.ga.ga.pop():null)):null;64<i.ge?(i.ge=0,i.vd.cleanup(XG)):i.ge+=1,n(t.Ne())&&i.vd.unbounded_unshift(t)}return null},yH.prototype.Gd=function(){var e=this;if(!e.closed)for(e.closed=!0,n(function(){var t=e.ga;return n(t)?0===e.Ic.length:t}())&&(e.Nb.g?e.Nb.g(e.ga):e.Nb.call(null,e.ga));;){var t=e.vd.pop();if(null==t)break;if(t.Df(null)){var r=t.Ef(null),i=n(function(){var t=e.ga;return n(t)?0<C(e.ga):t}())?e.ga.ga.pop():null;sH(function(e,t){return function(){return e.g?e.g(t):e.call(null,t)}}(r,i))}}return null},EH.prototype.ca=function(){return new se(null,this.key,new se(null,this.v,null,1,null),2,null)},EH.prototype.U=function(e,t,n){return Tj(t,bk,"["," ","]",n,this)},h=HH.prototype,h.put=function(e,t){var n=Array(15),r=GH(this.Hc,e,this.level,n).forward[0];if(null!=r&&r.key===e)return r.v=t;e:for(r=0;.5>Math.random()&&15>r;)r+=1;if(r>this.level){for(var i=this.level+1;i<=r+1;)n[i]=this.Hc,i+=1;this.level=r}for(e=FH(e,t,Array(r)),t=0;;){if(!(t<=this.level))return null;r=n[t].forward,t<e.forward.length?e.forward[t]=r[t]:e.forward.push(t<r.length?r[t]:null),t<r.length?r[t]=e:r.push(e),t+=1}},h.remove=function(e){var t=Array(15),n=GH(this.Hc,e,this.level,t);if(null==(n=0===n.forward.length?null:n.forward[0])||n.key!==e)return null;for(e=0;e<=this.level;){var r=t[e].forward;n===(e<r.length?r[e]:null)&&(r[e]=n.forward[e]),e+=1}for(;;){if(!(0<this.level&&this.level<this.Hc.forward.length&&null==this.Hc.forward[this.level]))return null;--this.level}},h.ceilingEntry=function(e){for(var t=this.Hc,r=this.level;;){if(0>r)return x.h(t.key,e)?t:t.forward[0];var i;e:for(i=t;;){var o=r<i.forward.length?i.forward[r]:null;if(null==o){i=0===r?i:null;break e}if(o.key>e)break e;i=o}n(i)?(--r,t=i):--r}},h.floorEntry=function(e){for(var t=this.Hc,r=this.level;;){if(0>r)return t===this.Hc?null:t;var i;e:for(i=t;;){var o=r<i.forward.length?i.forward[r]:null;if(null==o){i=0===r?i:null;break e}if(o.key>e)break e;i=o}n(i)?(--r,t=i):--r}},h.ca=function(){return function e(t){return new Df(null,(function(){return null==t?null:ke(new Q(null,2,5,S,[t.key,t.v],null),e(t.forward[0]))}),null,null)}(this.Hc.forward[0])},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"{",", ","}",n,this)};var r2=new HH;function s2(e){var t=(new Date).valueOf()+e,r=r2.ceilingEntry(t);if(r=n(n(r)?r.key<t+10:r)?r.v:null,n(r))return r;var i=DH(null);return r2.put(t,i),k2((function(){return r2.remove(t),WG(i)}),e),i}var IH={},JH;function KH(e){return void 0!==$a&&void 0!==ab&&void 0!==RG&&void 0!==TG&&void 0!==IH&&void 0!==JH||((JH=function(e,t){this.f=e,this.Lh=t,this.B=393216,this.M=0}).prototype.S=function(e,t){return new JH(this.f,t)},JH.prototype.R=function(){return this.Lh},JH.prototype.Df=function(){return!0},JH.prototype.Ne=function(){return!0},JH.prototype.Ef=function(){return this.f},JH.Na=!0,JH.Ja="cljs.core.async.impl.ioc-helpers/t_cljs$core$async$impl$ioc_helpers9658",JH.Pa=function(e){return Qc(e,"cljs.core.async.impl.ioc-helpers/t_cljs$core$async$impl$ioc_helpers9658")}),new JH(e,P)}function LH(e){try{var t=e[0];return t.g?t.g(e):t.call(null,e)}catch(n){if(n instanceof Object)throw t=n,e[6].Gd(null),t;throw n}}function MH(e,t,i){return n(i=i.Li(null,KH((function(n){return e[2]=n,e[1]=t,LH(e)}))))?(e[2]=r(i),e[1]=t,fv):null}function t2(e,t,i,o){return i=i.Oe(null,o,KH((function(n){return e[2]=n,e[1]=t,LH(e)}))),n(i)?(e[2]=r(i),e[1]=t,fv):null}function NH(e,t){return e=e[6],null!=t&&e.Oe(null,t,KH((function(){return null}))),e.Gd(null),e}function OH(e){return DH("number"==typeof(e=x.h(e,0)?null:e)?new dH(cH(e),e):e)}var VG=(void 0!==$a&&void 0!==ab&&void 0!==RG&&void 0!==SG||((SG=function(e,t,n){this.f=e,this.wf=t,this.rh=n,this.B=393216,this.M=0}).prototype.S=function(e,t){return new SG(this.f,this.wf,t)},SG.prototype.R=function(){return this.rh},SG.prototype.Df=function(){return!0},SG.prototype.Ne=function(){return this.wf},SG.prototype.Ef=function(){return this.f},SG.Na=!0,SG.Ja="cljs.core.async/t_cljs$core$async11612",SG.Pa=function(e){return Qc(e,"cljs.core.async/t_cljs$core$async11612")}),new SG((function(){return null}),!0,P));function PH(e,t){return!n(e=UG(e,t,VG))||r(e)}function u2(e){for(var t=Array(e),n=0;n<e;)t[n]=n,n+=1;for(e=Math.random,n=t.length-1;0<n;n--){const r=Math.floor(e()*(n+1)),i=t[n];t[n]=t[r],t[r]=i}return t}function v2(){var e=Fg(!0);return void 0!==$a&&void 0!==ab&&void 0!==RG&&void 0!==aZ||((aZ=function(e,t){this.Ji=e,this.Ni=t,this.B=393216,this.M=0}).prototype.S=function(e,t){return new aZ(this.Ji,t)},aZ.prototype.R=function(){return this.Ni},aZ.prototype.Df=function(){return r(this.Ji)},aZ.prototype.Ne=function(){return!0},aZ.prototype.Ef=function(){return Gg(this.Ji,null),!0},aZ.Na=!0,aZ.Ja="cljs.core.async/t_cljs$core$async11665",aZ.Pa=function(e){return Qc(e,"cljs.core.async/t_cljs$core$async11665")}),new aZ(e,P)}function w2(e,t){return void 0!==$a&&void 0!==ab&&void 0!==RG&&void 0!==bZ||(bZ=function(e,t,n){this.Ji=e,this.Zd=t,this.Oi=n,this.B=393216,this.M=0},bZ.prototype.S=function(e,t){return new bZ(this.Ji,this.Zd,t)},bZ.prototype.R=function(){return this.Oi},bZ.prototype.Df=function(){return XG(this.Ji)},bZ.prototype.Ne=function(){return!0},bZ.prototype.Ef=function(){return YG(this.Ji),this.Zd},bZ.Na=!0,bZ.Ja="cljs.core.async/t_cljs$core$async11677",bZ.Pa=function(e){return Qc(e,"cljs.core.async/t_cljs$core$async11677")}),new bZ(e,t,P)}function x2(e,t,i){var o,l=v2(),s=C(t),a=u2(s),u=Hw.g(i),c=function(){for(var i=0;;){if(!(i<s))return null;var o=n(u)?i:a[i],c=ee(t,o),h=Le(c)?c.g?c.g(0):c.call(null,0):null,d=n(h)?function(){var t,n=c.g?c.g(1):c.call(null,1);return UG(h,n,w2(l,(t=h,function(n){return n=new Q(null,2,5,S,[n,t],null),e.g?e.g(n):e.call(null,n)})))}():cZ(c,w2(l,function(t,n,r){return function(t){return t=new Q(null,2,5,S,[t,r],null),e.g?e.g(t):e.call(null,t)}}(0,0,c)));if(n(d))return vH(new Q(null,2,5,S,[r(d),(f=void 0,f=h,n(f)?f:c)],null));i+=1}var f}();return n(c)?c:M(i,Zk)?(c=n(o=l.Df(null))?l.Ef(null):o,n(c)?vH(new Q(null,2,5,S,[Zk.g(i),Zk],null)):null):null}function QH(e,t){var i=F,o=OH(1);return sH((function(){var l=function(){function o(o){var l=o[1];if(7===l)return o[2]=o[2],o[1]=3,fv;if(1===l)return l=i,o[7]=l,o[2]=null,o[1]=2,fv;if(4===l)return l=o[2],o[8]=l,o[1]=n(null==l)?5:6,fv;if(6===l){var s=o[8];return l=o[7],s=Ud(l=e.h?e.h(l,s):e.call(null,l,s)),o[9]=l,o[1]=s?8:9,fv}return 3===l?NH(o,o[2]):2===l?MH(o,4,t):9===l?(l=o[9],o[7]=l,o[2]=null,o[1]=2,fv):5===l?(l=o[7],o[2]=l,o[1]=7,fv):10===l?(o[2]=o[2],o[1]=7,fv):8===l?(l=r(l=o[9]),o[2]=l,o[1]=10,fv):null}return function(){function e(e){for(;;){e:try{for(;;){var t=o(e);if(!O(t,fv)){var n=t;break e}}}catch(t){if(n=t,e[2]=n,!z(e[4]))throw n;e[1]=A(e[4]),n=fv}if(!O(n,fv))return n}}function t(){var e=[null,null,null,null,null,null,null,null,null,null];return e[0]=n,e[1]=1,e}var n=null;return n=function(n){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,n)}throw Error("Invalid arity: "+arguments.length)},n.A=t,n.g=e,n}()}(),s=function(){var e=l();return e[6]=o,e}();return LH(s)})),o}function y2(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;return z2(arguments[0],arguments[1],arguments[2],3<t.length?new Fd(t.slice(3),0,null):null)}function z2(e,t,i,o){return o=bg(o),e[1]=t,t=x2((function(t){return e[2]=t,LH(e)}),i,o),n(t)?(e[2]=r(t),fv):null}var RH={};function SH(){return(new Date).getTime()}var TH=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],2<n.length?new Fd(n.slice(2),0,null):null)};function UH(e,t,n){return $f(fh,e,t,Dg(re,wj),n)}function VH(e,t,n){return fh.F(e,t,ah,n)}TH.l=function(e,t,n){if(n=G(n,0,null),J(e)&&(t=z(t))){var r=z(t);return t=A(r),z(r=B(r))?0===C(r=TH.l(u.h(e,t),r,D([n])))&&yb(vq.g(n))?we.h(e,t):I.j(e,t,r):we.h(e,t)}return e},TH.I=2,TH.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)};var WH=function e(t,r,i){if(n(r)){var o=z(r);if(r=A(o),yb(z(o=B(o))))i=De.h(u.h(t,r),i);else{var l=u.h(t,r);i=e.j?e.j(l,o,i):e.call(null,l,o,i)}return 0===C(i)?we.h(t,r):I.j(t,r,i)}return t};function XH(e){return n(e)?(WG(e),QH((function(){return null}),e)):null}function YH(e,t){return Nb.j((function(t,n){return x.h(n,e)?t:re.h(t,n)}),F,t)}function ZH(e,t){return Nb.h((function(t,r){return n(e.g?e.g(r):e.call(null,r))?Td(r):null}),t)}function $H(e,t){return yb(u.h(e,t))?I.j(e,t,P):e}function aI(e){return af((function(e,t,n){return I.j(e,Bf.g(t),n)}),P,e)}function bI(){return Xf(p,Yg.h(new uj(null,new k(null,1,["-",null],null),null),p.g(al())))}function cI(e){return jw.g(e)}function dI(e){var t=Zu.h(e,1),n=["r-",p.g(jw.g(e)),"-",p.g(t)].join("");return new Q(null,2,5,S,[I.j(e,Zu,t+1),n],null)}function eI(e){var t=Zu.h(e,1),n=["c-",p.g(jw.g(e)),"-",p.g(t)].join("");return new Q(null,2,5,S,[I.j(e,Zu,t+1),n],null)}function fI(e){var t=Zu.h(e,1),n=["p-",p.g(jw.g(e)),"-",p.g(t)].join("");return new Q(null,2,5,S,[I.j(e,Zu,t+1),n],null)}function gI(e,t,n,r,i){this.uri=e,this.message=t,this.D=n,this.m=r,this.G=i,this.B=2230716170,this.M=139264}function hI(e,t){return new gI(e,t,null,null,null)}function iI(e,t){var r=el(e);return new gI(t=GC.h(r,t),n(r=Ar.g(r))?r:fl(e),null,null,null)}function jI(e,t){throw cl(t,hI(e,t))}function kI(e){return hI(pE.g(e),In.g(e))}function lI(e,t){return hI(e,t)}function mI(e){var t=bI();return new k(null,2,[pq,new k(null,2,[jw,e,Zu,1],null),ho,t],null)}function nI(e,t,r,i){return fh.F(eh(e,new Q(null,3,5,S,[wG,t,r],null),n(i)?new k(null,1,[Gp,i],null):P),new Q(null,2,5,S,[JB,r],null),Dg(re,wj),t)}function oI(e,t,n){return WH(fh.F(e,new Q(null,2,5,S,[wG,t],null),we,n),new Q(null,2,5,S,[JB,n],null),t)}function pI(e,t,n){return dh.h(e,new Q(null,3,5,S,[JB,n,t],null))}function qI(e,t,r){return n(t)?eh(e,new Q(null,2,5,S,[nn,t],null),r):e}function rI(e,t){return Nj(TH,dh)(e,new Q(null,2,5,S,[nn,t],null))}function sI(e,t){return dh.h(e,new Q(null,3,5,S,[PE,t,wu],null))}function tI(e,t){return new k(null,2,[tB,e,Ro,t],null)}function uI(e,t){return I.j(tI(new k(null,1,[X,jD],null),t),$s,e)}function vI(e,t,n){return I.j(tI(t,n),$s,e)}h=gI.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"uri":return this.uri;case"message":return this.message;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#gateway.reason.Reason{",", ","}",n,Of.h(new Q(null,2,5,S,[new Q(null,2,5,S,[GC,this.uri],null),new Q(null,2,5,S,[Ar,this.message],null)],null),this.m))},h.xa=function(){return new Yh(this,2,new Q(null,2,5,S,[GC,Ar],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 2+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=57548305^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.uri,t.uri)&&x.h(this.message,t.message)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,2,[GC,null,Ar,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new gI(this.uri,this.message,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"uri":case"message":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(GC,t):O.call(null,GC,t))?new gI(r,this.message,this.D,this.m,null):n(O.h?O.h(Ar,t):O.call(null,Ar,t))?new gI(this.uri,r,this.D,this.m,null):new gI(this.uri,this.message,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,2,5,S,[new xh(GC,this.uri),new xh(Ar,this.message)],null),this.m))},h.S=function(e,t){return new gI(this.uri,this.message,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)};var wI=function e(t){switch(arguments.length){case 6:return e.oa(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 5:return e.O(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};wI.oa=function(e,t,r,i,o,l){return e=new k(null,6,[wu,e,X,Cx,UC,r,pG,i,pE,GC.g(o),In,Ar.g(o)],null),tI(t,l=n(l)?I.j(e,Fp,l):e)},wI.O=function(e,t,n,r,i){return wI.oa(e,t,n,r,i,null)},wI.I=6;var xI=function e(t){switch(arguments.length){case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function yI(e){return x.h(X.g(e),gz)}xI.F=function(e,t,n,r){return tI(t,xI.j(e,n,r))},xI.j=function(e,t,n){return new k(null,4,[wu,e,X,jC,UC,t,pG,n],null)},xI.I=4;var zI=function e(t){switch(arguments.length){case 6:return e.oa(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 5:return e.O(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};zI.oa=function(e,t,n,r,i,o){return tI(t,zI.O(e,n,r,i,o))},zI.O=function(e,t,n,r,i){return new k(null,6,[wu,e,X,nG,pG,t,Fr,n,Uz,r,rb,i],null)},zI.I=6;var AI=function e(t){switch(arguments.length){case 5:return e.O(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function BI(e,t){if(null!=e&&null!=e.Qc)e=e.Qc(e,t);else{var n=BI[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=BI._))throw Eb("ConjFlat.conj-flat",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function CI(e,t){for(e=dh.h(e,t);;){if(!n(DI.g?DI.g(e):DI.call(null,e)))return t;e=u.h(e,0),t=re.h(t,0)}}function EI(e,t){return new Df(null,(function(){var r=dh.h(e,t);e:for(var i=e,o=t;;){if(x.h(C(o),1)){i=Be(o)<(FI.g?FI.g(i):FI.call(null,i))-1?CI(i,new Q(null,1,5,S,[Be(o)+1],null)):null;break e}var l=Be(o),s=dh.h(i,Ce(o));if(l<(s=FI.g?FI.g(s):FI.call(null,s))-1){i=CI(i,re.h(Ce(o),Be(o)+1));break e}o=Ce(o)}return ke(r,n(i)?EI(e,i):null)}),null,null)}function GI(e,t,n,r,i){this.ma=e,this.se=t,this.Gc=n,this.H=r,this.nd=i,this.Yd=null,this.B=31850958,this.M=0}function II(e,t){var n=C(t);e:if(0===n)n=1;else{n|=0;for(var r=1,i=31;;){var o=wg(n);if(n=kf(n,2),o)i=qd(i,i);else{if(0===n){n=qd(i,r);break e}r=qd(i,r),i=qd(i,i)}}}return qd(n|=0,e.se)+(t.se-n)}function JI(e){e:for(var t=1,n=z(e=Eh(e));null!=n;)t=qd(31,t)+xd(A(n))|0,n=B(n);return new GI(e,t,xd(e),C(e),!1)}AI.O=function(e,t,n,r,i){return tI(t,AI.F(e,n,r,i))},AI.F=function(e,t,n,r){return new k(null,6,[wu,e,X,$w,pG,t,rw,n,pE,GC.g(r),In,Ar.g(r)],null)},AI.I=5,h=GI.prototype,h.toString=function(){return pd(z(this))},h.na=function(e,t){return this.ma.na(null,t)},h.P=function(e,t,n){return this.ma.P(null,t,n)},h.R=function(){return Ae(this.ma)},h.Aa=function(){return B(z(this))},h.da=function(){return this.H},h.ba=function(){return this.Gc},h.aa=function(e,t){return x.h(this.Gc,xd(t))&&x.h(this.H,C(t))&&(x.h(this.H,0)||x.h(z(this),t))},h.sa=function(){return ze(HI,Ae(this))},h.Ga=function(){return A(z(this))},h.Ia=function(){return Hd(z(this))},h.ca=function(){if(!n(this.Yd)){if(this.nd){var e=this.ma;e=0<C(e)?EI(e,CI(e,new Q(null,1,5,S,[0],null))):null}else e=z(this.ma);this.Yd=e}return this.Yd},h.S=function(e,t){return new GI(ze(this.ma,t),this.se,this.Gc,this.H,this.nd)},h.ia=function(e,t){return ke(t,this)},h.Qc=function(e,t){if(null==t)return this;if(n(DI.g?DI.g(t):DI.call(null,t))){if(0===this.H)return t;if(32>=C(t)){e=II.h?II.h(this,t):II.call(null,this,t);var r=this.H+C(t),i=ah.h(this.ma,t),o=this.nd;return new GI(i,e,Md(e,r),r,o||t.nd)}return e=II.h?II.h(this,t):II.call(null,this,t),r=this.H+C(t),new GI(re.h(this.ma,t),e,Md(e,r),r,!0)}return e=qd(31,this.se)+xd(t),r=this.H+1,new GI(re.h(this.ma,t),e,Md(e,r),r,this.nd)},h.pa=cb,h.U=function(e,t,n){return Tc(z(this),t,n)};var HI=JI(F);function DI(e){return e instanceof GI}function FI(e){return DI(e)?C(e.ma):C(e)}var KI=function e(t,n){for(;;){if(!z(n))return t;var r=A(n);DI(r)?(t=e.h?e.h(t,r):e.call(null,t,r),n=B(n)):(t=Pf.h(t,r),n=B(n))}};function LI(e,t,n,r){this.ma=e,this.Gc=t,this.H=n,this.flat=r,this.B=167142175,this.M=2048}function MI(e){return yb(r(e.flat))&&(Ig.h(e.flat,(function(){var t=r(e.ma);return ze(t=Zc(KI(Xc(F),t)),Ae(r(e.ma)))})),Ig.h(e.ma,(function(){return null}))),r(e.flat)}function NI(e){return n(e.nd)?n(e.Yd)?Eh(z(e)):new LI(Fg(e.ma),e.Gc,e.H,Fg(null)):e.ma}function OI(e,t,r){var i=n(t.ignoreCase)?"gi":"g";return i=n(t.multiline)?[i,"m"].join(""):i,e.replace(new RegExp(t.source,n(t.unicode)?[i,"u"].join(""):i),r)}function PI(e){return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=Qg(2,t),x.h(C(t),1)?(t=A(t),e.g?e.g(t):e.call(null,t)):(t=Eh(t),e.g?e.g(t):e.call(null,t))}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}function QI(e,t,n){if("string"==typeof t)return e.replace(new RegExp(String(t).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"g"),n);if(t instanceof RegExp)return OI(e,t,"string"==typeof n?n:PI(n));throw["Invalid match arg: ",p.g(t)].join("")}function RI(e,t){var n=new Za;for(t=z(t);;){if(null==t)return n.toString();n.append(p.g(A(t))),null!=(t=B(t))&&n.append(e)}}function SI(e,t){return 0>=t||t>=2+C(e)?re.h(Eh(ke("",Ng.h(p,z(e)))),""):n(of?Hc(1,t):nf.call(null,1,t))?new Q(null,1,5,S,[e],null):n(of?Hc(2,t):nf.call(null,2,t))?new Q(null,2,5,S,["",e],null):(t-=2,re.h(Eh(ke("",Nh(Eh(Ng.h(p,z(e))),0,t))),e.substring(t)))}function TI(e,t,n){if("/(?:)/"===p.g(t))t=SI(e,n);else if(1>n)t=Eh(p.g(e).split(t));else e:for(var r=n,i=F;;){if(1===r){t=re.h(i,e);break e}var o=Qj(t,e);if(null==o){t=re.h(i,e);break e}var l=e.indexOf(o);o=e.substring(l+C(o)),--r,i=re.h(i,e.substring(0,l)),e=o}if(0===n&&1<C(t))e:for(n=t;""===Be(n);)n=Ce(n);else n=t;return n}function UI(e,t,r){return(t=yb(t))?(t=r.g?r.g(Y):r.call(null,Y),e=e.g?e.g(t):e.call(null,t)):e=t,n(e)?["(",p.g(VI?VI(r,!1):WI.call(null,r,!1)),")"].join(""):VI?VI(r,!1):WI.call(null,r,!1)}h=LI.prototype,h.toString=function(){return pd(MI(this))},h.na=function(e,t){return MI(this).na(null,t)},h.P=function(e,t,n){return MI(this).P(null,t,n)},h.Ka=function(e,t,n){return MI(this).Ka(null,t,n)},h.$=function(e,t){return MI(this).$(null,t)},h.Ba=function(e,t,n){return MI(this).Ba(null,t,n)},h.Kb=function(e,t,n){return MI(this).Kb(null,t,n)},h.R=function(){return n(r(this.flat))?Ae(r(this.flat)):Ae(r(this.ma))},h.da=function(){return this.H},h.Ub=function(){return MI(this).Ub(null)},h.Vb=function(){return MI(this).Vb(null)},h.Ac=function(){return 0<this.H?Pc(MI(this)):null},h.ba=function(){return this.Gc},h.aa=function(e,t){return x.h(this.Gc,xd(t))&&x.h(this.H,C(t))&&x.h(MI(this),t)},h.sa=function(){return ze(F,Ae(this))},h.ja=function(e,t,n){return I.j(MI(this),t,n)},h.za=function(e,t){return MI(this).za(null,t)},h.ca=function(){return z(MI(this))},h.S=function(e,t){return n(r(this.flat))?new LI(Fg(r(this.ma)),this.Gc,this.H,Fg(ze(r(this.flat),t))):new LI(Fg(ze(r(this.ma),t)),this.Gc,this.H,Fg(r(this.flat)))},h.ia=function(e,t){return re.h(MI(this),t)},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 2:return this.h(arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return MI(this).h(null,e)},h.h=function(e,t){return MI(this).j(null,e,t)},h.Tb=function(e,t){return cd(MI(this),t)},h.pa=cb,h.U=function(e,t,n){return Tc(MI(this),t,n)};var XI=Ag(UI,new uj(null,new k(null,3,[az,null,yA,null,Hm,null],null),null));function YI(e){switch(e){case"\n":return"\\n";case"\b":return"\\b";case"\f":return"\\f";case"\r":return"\\r";case"\t":return"\\t";default:return e}}function ZI(e){return QI(['#"',e.source.substring(1),'"'].join(""),/[\s]/,YI)}function $I(e){return 4095>=e?["0000",p.g(e.toString(16))].join("").substr(-4):e.toString(16)}function aJ(e){var t=bg(e);return e=u.h(t,ft),t=u.h(t,mr),x.h(e,t)?["%x",p.g($I(e))].join(""):["%x",p.g($I(e)),"-",p.g($I(t))].join("")}function WI(e){switch(arguments.length){case 1:return VI(arguments[0],!1);case 2:return VI(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function VI(e,t){var r=bg(e);e=u.h(r,Eq);var i,o=u.h(r,Qr),l=u.h(r,Rr),s=u.h(r,Ls),a=u.h(r,Y);if(n((i=yb(t))?jt.g(r):i))return["<",p.g(VI(r,!0)),">"].join("");switch(a=a instanceof w?a.W:null){case"epsilon":return"";case"opt":return[p.g(XI(t,e)),"?"].join("");case"plus":return[p.g(XI(t,e)),"+"].join("");case"star":return[p.g(XI(t,e)),"*"].join("");case"rep":return cg.h(Jq.g(r),EC.g(r))?[p.g(XI(t,e)),"{",p.g(Jq.g(r)),",",p.g(EC.g(r)),"}"].join(""):[p.g(XI(t,e)),"{",p.g(Jq.g(r)),"}"].join("");case"alt":return RI(" | ",Ng.h(Bg(UI,new uj(null,new k(null,1,[yA,null],null),null),t),s));case"ord":return[p.g(UI(new uj(null,new k(null,1,[Hm,null],null),null),t,o))," / ",p.g(UI(new uj(null,new k(null,1,[Hm,null],null),null),t,l))].join("");case"cat":return RI(" ",Ng.h(Bg(UI,new uj(null,new k(null,2,[yA,null,Hm,null],null),null),t),s));case"string":var c=new Za;e=fb,o=eb,fb=!0,eb=function(e){return c.append(e)};try{gk(D([CB.g(r)]),kb())}finally{eb=o,fb=e}return p.g(c);case"string-ci":c=new Za,e=fb,o=eb,fb=!0,eb=function(e){return c.append(e)};try{gk(D([CB.g(r)]),kb())}finally{eb=o,fb=e}return p.g(c);case"char":return aJ(r);case"regexp":return ZI(RA.g(r));case"nt":return rf(p.g(bt.g(r)),1);case"look":return["&",p.g(XI(t,e))].join("");case"neg":return["!",p.g(XI(t,e))].join("");default:throw Error(["No matching clause: ",p.g(a)].join(""))}}function bJ(e,t){return x.h(Xv.g(Qn.g(t)),Co)?["<",Cf(e),"> = ",p.g(VI(t,!1))].join(""):[Cf(e)," = ",p.g(VI(t,!1))].join("")}function cJ(e){e=bg(e);var t=u.h(e,hr),n=u.h(e,Bp);return RI("\n",ke(bJ(n,t.g?t.g(n):t.call(null,n)),function e(t){return new Df(null,(function(){for(var r=t;;){if(!(r=z(r)))return null;if(Me(r)){var i=ed(r),o=C(i),l=Hf(o);e:for(var s=0;;){if(!(s<o)){i=!0;break e}var a=Zb(i,s),u=G(a,0,null);a=G(a,1,null),cg.h(u,n)&&(u=bJ(u,a),l.add(u)),s+=1}return Jf(Lf(l),i?e(fd(r)):null)}if(l=G(i=A(r),0,null),i=G(i,1,null),cg.h(l,n))return ke(bJ(l,i),e(Hd(r)));r=Hd(r)}}),null,null)}(t)))}function dJ(e){n(AA.g(e))?(ik.l(D(["NOT "])),ik.l(D([AA.g(e)]))):n(Kt.g(e))?ik.l(D([aJ(e)])):e instanceof RegExp?ik.l(D([ZI(e)])):gk(D([e]),kb())}function eJ(e){var t=bg(e);e=u.h(t,cw);var n=u.h(t,rs),r=u.h(t,TD);t=u.h(t,In),lk(D([["Parse error at line ",p.g(e),", column ",p.g(n),":"].join("")])),lk(D([r])),lk(D([Se(n)?1>=n?"^":Xf(p,Of.h(Tg(n-1," "),new Q(null,1,5,S,["^"],null))):null])),n=zj(Ng.h(EF,Xg.h(rz,t))),e=zj(Ng.h(EF,Xg.h(xg(rz),t))),0!==(r=C(n)+C(e))&&(x.h(1,r)?lk(D(["Expected:"])):lk(D(["Expected one of:"]))),n=z(n),r=null;for(var i=t=0;;)if(i<t){dJ(r.$(null,i)),lk(D([" (followed by end-of-string)"])),i+=1}else{if(!(n=z(n)))break;Me(r=n)?(n=ed(r),i=fd(r),r=n,t=C(n),n=i):(dJ(n=A(r)),lk(D([" (followed by end-of-string)"])),n=B(r),r=null,t=0),i=0}for(e=z(e),n=null,i=t=0;;)if(i<t)dJ(r=n.$(null,i)),kk(),i+=1;else{if(!(e=z(e)))break;Me(n=e)?(e=ed(n),t=fd(n),n=e,r=C(e),e=t,t=r):(dJ(r=A(n)),kk(),e=B(n),n=null,t=0),i=0}}function fJ(e){throw Xf(p,e)}function gJ(e){throw Xf(p,e)}function hJ(e){var t=n(e.ignoreCase)?"i":"";return t=n(e.multiline)?[t,"m"].join(""):t,n(e.unicode)?[t,"u"].join(""):t}function iJ(e){return z(e)&&yb(B(e))}function jJ(e){return I.j(e,Qn,kJ)}var kJ=new k(null,1,[Xv,Co],null),lJ=new k(null,2,[xx,function(e){return new k(null,2,[Xv,xx,gB,e],null)},tu,function(e){return new k(null,2,[Xv,tu,gB,e],null)}],null),mJ=new k(null,2,[tu,function(e,t){return new k(null,2,[Y,e,en,new se(null,t,null,1,null)],null)},xx,function(e,t){return new Q(null,2,5,S,[e,t],null)}],null);function nJ(e,t){var n=Xv.g(e);switch(n instanceof w?n.W:null){case"raw":return HI.Qc(null,t);case"hiccup":return NI(JI(new Q(null,1,5,S,[gB.g(e)],null)).Qc(null,t));case"enlive":return t=HI.Qc(null,t),new k(null,2,[Y,gB.g(e),en,0===C(t)?null:t],null);default:return e.g?e.g(t):e.call(null,t)}}function oJ(e,t){var r=lJ.g?lJ.g(e):lJ.call(null,e);return n(r)?ah.h(P,function e(t){return new Df(null,(function(){for(;;){var i=z(t);if(i){if(Me(i)){var o=ed(i),l=C(o),s=Hf(l);e:for(var a=0;;){if(!(a<l)){o=!0;break e}var u=Zb(o,a),c=G(u,0,null);u=G(u,1,null),c=n(Qn.g(u))?new Q(null,2,5,S,[c,u],null):new Q(null,2,5,S,[c,I.j(u,Qn,r.g?r.g(c):r.call(null,c))],null),s.add(c),a+=1}return Jf(Lf(s),o?e(fd(i)):null)}return s=G(o=A(i),0,null),o=G(o,1,null),ke(n(Qn.g(o))?new Q(null,2,5,S,[s,o],null):new Q(null,2,5,S,[s,I.j(o,Qn,r.g?r.g(s):r.call(null,s))],null),e(Hd(i)))}return null}}),null,null)}(t)):gJ(D(["Invalid output format ",e,". Use :enlive or :hiccup."]))}var pJ=new k(null,1,[Y,ir],null);function qJ(e){return x.h(e,pJ)?pJ:new k(null,2,[Y,BA,Eq,e],null)}function rJ(e){return x.h(e,pJ)?pJ:new k(null,2,[Y,gu,Eq,e],null)}function sJ(e){return x.h(e,pJ)?pJ:new k(null,2,[Y,cF,Eq,e],null)}function tJ(e,t,n){return x.h(n,pJ)?pJ:new k(null,4,[Y,Tn,Eq,n,Jq,e,EC,t],null)}var uJ=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};uJ.l=function(e){return ug(Ag(x,pJ),e)?pJ:iJ(e)?A(e):new k(null,2,[Y,Hm,Ls,e],null)},uJ.I=0,uJ.J=function(e){return this.l(z(e))};var vJ=function e(t){if(0===arguments.length)return e.A();for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],new Fd(n.slice(1),0,null))};vJ.A=function(){return pJ},vJ.l=function(e,t){return z(t=x.h(e,pJ)?Yg.h(xj([pJ]),t):t)&&(t=Xf(vJ,t),e=new k(null,3,[Y,yA,Qr,e,Rr,t],null)),e},vJ.J=function(e){var t=A(e);return e=B(e),this.l(t,e)},vJ.I=1;var wJ=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};function xJ(e){return x.h(e,"")?pJ:new k(null,2,[Y,CB,CB,e],null)}function yJ(e){return x.h(e,"")?pJ:new k(null,2,[Y,Hr,CB,e],null)}function zJ(e,t){return new k(null,3,[Y,bB,ft,e,mr,t],null)}function AJ(e){return x.h(e,"")?e=pJ:(e=(e=Sj(e))instanceof RegExp?new RegExp(["^",p.g(e.source)].join(""),hJ(e)):e,e=new k(null,2,[Y,RA,RA,e],null)),e}function BJ(e){return new k(null,2,[Y,Os,bt,e],null)}function CJ(e){return new k(null,2,[Y,iG,Eq,e],null)}function DJ(e){return new k(null,2,[Y,xm,Eq,e],null)}function EJ(e){return I.j(e,jt,!0)}wJ.l=function(e){return ug(Ag(x,pJ),e)?pJ:iJ(e=Yg.h(xj([pJ]),e))?A(e):new k(null,2,[Y,az,Ls,e],null)},wJ.I=0,wJ.J=function(e){return this.l(z(e))};var FJ=function e(t){var r,i=n(jt.g(t))?we.h(t,jt):t;return n(Eq.g(i))?I.j(i,Eq,(r=Eq.g(i),e.g?e.g(r):e.call(null,r))):n(Ls.g(i))?I.j(i,Ls,Ng.h(e,Ls.g(i))):x.h(Y.g(i),yA)?I.l(i,Qr,function(){var t=Qr.g(i);return e.g?e.g(t):e.call(null,t)}(),D([Rr,function(){var t=Rr.g(i);return e.g?e.g(t):e.call(null,t)}()])):i};function GJ(e){return ah.h(P,function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var r=ed(n),i=C(r),o=Hf(i);e:for(var l=0;;){if(!(l<i)){r=!0;break e}var s=Zb(r,l),a=G(s,0,null);s=G(s,1,null),a=new Q(null,2,5,S,[a,FJ(s)],null),o.add(a),l+=1}return Jf(Lf(o),r?e(fd(n)):null)}return o=G(r=A(n),0,null),r=G(r,1,null),ke(new Q(null,2,5,S,[o,FJ(r)],null),e(Hd(n)))}return null}}),null,null)}(e))}function HJ(e,t){var r=lJ.g?lJ.g(e):lJ.call(null,e);return n(r)?ah.h(P,function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var i=ed(n),o=C(i),l=Hf(o);e:for(var s=0;;){if(!(s<o)){i=!0;break e}var a=Zb(i,s),u=G(a,0,null);a=G(a,1,null),u=new Q(null,2,5,S,[u,I.j(a,Qn,r.g?r.g(u):r.call(null,u))],null),l.add(u),s+=1}return Jf(Lf(l),i?e(fd(n)):null)}return l=G(i=A(n),0,null),i=G(i,1,null),ke(new Q(null,2,5,S,[l,I.j(i,Qn,r.g?r.g(l):r.call(null,l))],null),e(Hd(n)))}return null}}),null,null)}(t)):gJ(D(["Invalid output format ",e,". Use :enlive or :hiccup."]))}function IJ(e,t){var r=lJ.g?lJ.g(e):lJ.call(null,e);return n(r)?ah.h(P,function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var i=ed(n),o=C(i),l=Hf(o);e:for(var s=0;;){if(!(s<o)){i=!0;break e}var a=Zb(i,s),u=G(a,0,null);a=G(a,1,null),u=new Q(null,2,5,S,[u,I.j(FJ(a),Qn,r.g?r.g(u):r.call(null,u))],null),l.add(u),s+=1}return Jf(Lf(l),i?e(fd(n)):null)}return l=G(i=A(n),0,null),i=G(i,1,null),ke(new Q(null,2,5,S,[l,I.j(FJ(i),Qn,r.g?r.g(l):r.call(null,l))],null),e(Hd(n)))}return null}}),null,null)}(t)):gJ(D(["Invalid output format ",e,". Use :enlive or :hiccup."]))}var JJ=function e(t,r){var i=Y.g(t);switch(i=i instanceof w?i.W:null){case"nt":case"epsilon":return t;case"opt":case"plus":case"star":case"rep":case"look":case"neg":return fh.F(t,new Q(null,1,5,S,[Eq],null),e,r);case"alt":case"cat":return I.j(t,Ls,Ng.h((function(t){return e.h?e.h(t,r):e.call(null,t,r)}),Ls.g(t)));case"ord":return I.l(t,Qr,function(){var n=Qr.g(t);return e.h?e.h(n,r):e.call(null,n,r)}(),D([Rr,function(){var n=Rr.g(t);return e.h?e.h(n,r):e.call(null,n,r)}()]));case"string":case"string-ci":case"regexp":return n(Qn.g(t))?I.j(wJ.l(D([r,we.h(t,Qn)])),Qn,Qn.g(t)):wJ.l(D([r,t]));default:throw Error(["No matching clause: ",p.g(i)].join(""))}};function KJ(e,t,n,r){var i=EJ(qJ(BJ(r)));return n=I.j(n,r,jJ(n.g?n.g(r):n.call(null,r))),r=ah.h(P,function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var r=ed(n),o=C(r),l=Hf(o);e:for(var s=0;;){if(!(s<o)){r=!0;break e}var a=Zb(r,s),u=G(a,0,null);a=G(a,1,null),u=new Q(null,2,5,S,[u,JJ(a,i)],null),l.add(u),s+=1}return Jf(Lf(l),r?e(fd(n)):null)}return l=G(r=A(n),0,null),r=G(r,1,null),ke(new Q(null,2,5,S,[l,JJ(r,i)],null),e(Hd(n)))}return null}}),null,null)}(e)),t=I.j(r,t,I.j(wJ.l(D([we.h(r.g?r.g(t):r.call(null,t),Qn),i])),Qn,Qn.g(r.g?r.g(t):r.call(null,t)))),pj.l(D([t,n]))}function LJ(e){if(null==e||!(0<=e&&1114111>=e))return null;if(65536<=e&&1114111>=e){const t=56320+(1023&e);return String.fromCharCode(55232+(e>>10))+String.fromCharCode(t)}return String.fromCharCode(e)}function MJ(e,t){const n=e.charCodeAt(t);if(55296<=n&&56319>=n&&t+1<e.length){if(56320<=(e=e.charCodeAt(t+1))&&57343>=e)return 55296<=n&&56319>=n&&56320<=e&&57343>=e?(n<<10)-56623104+(e-56320+65536):null}else if(56320<=n&&57343>=n&&0<t&&(55296<=(e=e.charCodeAt(t-1))&&56319>=e))return-(55296<=e&&56319>=e&&56320<=n&&57343>=n?(e<<10)-56623104+(n-56320+65536):0);return n}function NJ(e,t,n){var r=Y.g(e);switch(r=r instanceof w?r.W:null){case"nt":return OJ.j?OJ.j(e,t,n):OJ.call(null,e,t,n);case"alt":return PJ.j?PJ.j(e,t,n):PJ.call(null,e,t,n);case"cat":return QJ.j?QJ.j(e,t,n):QJ.call(null,e,t,n);case"string":return RJ.j?RJ.j(e,t,n):RJ.call(null,e,t,n);case"string-ci":return SJ.j?SJ.j(e,t,n):SJ.call(null,e,t,n);case"char":return TJ.j?TJ.j(e,t,n):TJ.call(null,e,t,n);case"epsilon":return UJ.j?UJ.j(e,t,n):UJ.call(null,e,t,n);case"opt":return VJ.j?VJ.j(e,t,n):VJ.call(null,e,t,n);case"plus":return WJ.j?WJ.j(e,t,n):WJ.call(null,e,t,n);case"rep":return XJ.j?XJ.j(e,t,n):XJ.call(null,e,t,n);case"star":return YJ.j?YJ.j(e,t,n):YJ.call(null,e,t,n);case"regexp":return ZJ.j?ZJ.j(e,t,n):ZJ.call(null,e,t,n);case"look":return $J.j?$J.j(e,t,n):$J.call(null,e,t,n);case"neg":return aK.j?aK.j(e,t,n):aK.call(null,e,t,n);case"ord":return bK.j?bK.j(e,t,n):bK.call(null,e,t,n);default:throw Error(["No matching clause: ",p.g(r)].join(""))}}function cK(e,t,n){var r=Y.g(e);switch(r=r instanceof w?r.W:null){case"nt":return dK.j?dK.j(e,t,n):dK.call(null,e,t,n);case"alt":return eK.j?eK.j(e,t,n):eK.call(null,e,t,n);case"cat":return fK.j?fK.j(e,t,n):fK.call(null,e,t,n);case"string":return gK.j?gK.j(e,t,n):gK.call(null,e,t,n);case"string-ci":return hK.j?hK.j(e,t,n):hK.call(null,e,t,n);case"char":return iK.j?iK.j(e,t,n):iK.call(null,e,t,n);case"epsilon":return jK.j?jK.j(e,t,n):jK.call(null,e,t,n);case"opt":return kK.j?kK.j(e,t,n):kK.call(null,e,t,n);case"plus":return lK.j?lK.j(e,t,n):lK.call(null,e,t,n);case"rep":return mK.j?mK.j(e,t,n):mK.call(null,e,t,n);case"star":return nK.j?nK.j(e,t,n):nK.call(null,e,t,n);case"regexp":return oK.j?oK.j(e,t,n):oK.call(null,e,t,n);case"look":return pK.j?pK.j(e,t,n):pK.call(null,e,t,n);case"neg":return aK.j?aK.j(e,t,n):aK.call(null,e,t,n);case"ord":return qK.j?qK.j(e,t,n):qK.call(null,e,t,n);default:throw Error(["No matching clause: ",p.g(r)].join(""))}}function rK(e,t,n,r,i){this.index=e,this.reason=t,this.D=n,this.m=r,this.G=i,this.B=2230716170,this.M=139264}h=rK.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"index":return this.index;case"reason":return this.reason;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#instaparse.gll.Failure{",", ","}",n,Of.h(new Q(null,2,5,S,[new Q(null,2,5,S,[Gm,this.index],null),new Q(null,2,5,S,[In,this.reason],null)],null),this.m))},h.xa=function(){return new Yh(this,2,new Q(null,2,5,S,[Gm,In],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 2+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-1140991288^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.index,t.index)&&x.h(this.reason,t.reason)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,2,[Gm,null,In,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new rK(this.index,this.reason,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"index":case"reason":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(Gm,t):O.call(null,Gm,t))?new rK(r,this.reason,this.D,this.m,null):n(O.h?O.h(In,t):O.call(null,In,t))?new rK(this.index,r,this.D,this.m,null):new rK(this.index,this.reason,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,2,5,S,[new xh(Gm,this.index),new xh(In,this.reason)],null),this.m))},h.S=function(e,t){return new rK(this.index,this.reason,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h.pa=cb,h.U=function(e,t){var n=this;return Qc(t,function(){var e=new Za,t=fb,r=eb;fb=!0,eb=function(t){return e.append(t)};try{eJ(n)}finally{eb=r,fb=t}return p.g(e)}())};var sK=Db(new rK(null,null,null,null,null));function tK(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w){this.ta=e,this.text=t,this.Ya=n,this.Qa=r,this.Xa=i,this.stack=o,this.Wa=l,this.Sa=s,this.Va=a,this.Ua=u,this.va=c,this.Za=h,this.Ra=d,this.$a=f,this.D=p,this.m=g,this.G=w,this.B=2230716170,this.M=139264}function uK(e,t,n,r,i){return new tK(e,t,n,r,i,Fg(F),Fg(F),Fg(0),Fg(mj(gf)),Fg(P),Fg(P),Fg(null),Fg(new rK(0,F,null,null,null)),!1,null,null,null)}function vK(e,t){return new k(null,2,[xA,e,Gm,t],null)}function wK(e,t){return x.h(C(TD.g(e)),Gm.g(t))}function xK(e,t,n,r,i,o,l){this.ic=e,this.$b=t,this.results=n,this.ac=r,this.D=i,this.m=o,this.G=l,this.B=2230716170,this.M=139264}function yK(e,t){return Ig.j(Uw.g(e),re,t)}function zK(e,t,n){function i(){return t.g?t.g(n):t.call(null,n)}var o=Dq.g(e),l=Gm.g(n);l=new Q(null,2,5,S,[t,l],null);var s=u.j(r(o),l,0);s>r(Wr.g(e))?Ig.j(tw.g(e),re,i):Ig.j(Uw.g(e),re,i),Ig.F(o,I,l,s+1)}function AK(e,t){return n(t=(e=r(e=Mu.g(e))).g?e.g(t):e.call(null,t))?0<C(r(rC.g(t))):null}function BK(e,t){return n(t=(e=r(e=Mu.g(e))).g?e.g(t):e.call(null,t))?0<C(r(Vy.g(t)))||0<C(r(rC.g(t))):null}function CK(e,t){return n(t=(e=r(e=Mu.g(e))).g?e.g(t):e.call(null,t))?0<C(r(fF.g(t)))||0<C(r(io.g(t))):null}function DK(e,t){var i=r(e=Mu.g(e));return n(i=i.g?i.g(t):i.call(null,t))||(i=new xK(Fg(F),Fg(F),Fg(wj),Fg(wj),null,null,null),Ig.F(e,I,t,i)),i}function EK(e,t){return(null!=e?262144&e.B||cb===e.Me||!e.B&&Cb(Ac,e):Cb(Ac,e))?ze(e,t):e}function FK(e,t,i){var o,l=DK(e,t),s=t.g?t.g(1):t.call(null,1),a=n(jt.g(s))?I.j(i,xA,null):i,u=n(o=Qn.g(s))?vK(EK(nJ(o,xA.g(a)),new k(null,2,[Dy,t.g?t.g(0):t.call(null,0),wt,Gm.g(a)],null)),Gm.g(a)):a,c=(i=wK(e,u))?fF.g(l):io.g(l);if(!yb(function(){var e=r(c);return e.g?e.g(u):e.call(null,u)}()))return null;Ig.j(c,re,u);for(var h=z(r(rC.g(l))),d=null,f=0,p=0;;)if(p<f){zK(e,d.$(null,p),u),p+=1}else{if(!(h=z(h)))break;Me(d=h)?(h=ed(d),p=fd(d),d=h,f=C(h),h=p):(zK(e,h=A(d),u),h=B(d),d=null,f=0),p=0}if(!i)return null;for(l=z(r(Vy.g(l))),i=null,f=d=0;;)if(f<d)zK(e,h=i.$(null,f),u),f+=1;else{if(!(l=z(l)))return null;Me(i=l)?(l=ed(i),d=fd(i),i=l,h=C(l),l=d,d=h):(zK(e,h=A(i),u),l=B(i),i=null,d=0),f=0}}function GK(e,t,n){var i=AK(e,t),o=DK(e,t),l=rC.g(o);Ig.j(l,re,n),l=z(r(io.g(o)));for(var s=null,a=0,u=0;;)if(u<a){var c=s.$(null,u);zK(e,n,c),u+=1}else{if(!(l=z(l)))break;Me(s=l)?(l=ed(s),u=fd(s),s=l,a=C(l),l=u):(l=A(s),zK(e,n,l),l=B(s),s=null,a=0),u=0}for(o=z(r(fF.g(o))),l=null,a=s=0;;)if(a<s)u=l.$(null,a),zK(e,n,u),a+=1;else{if(!(o=z(o)))break;Me(l=o)?(o=ed(l),a=fd(l),l=o,s=C(o),o=a):(o=A(l),zK(e,n,o),o=B(l),l=null,s=0),a=0}return yb(i)?yK(e,(function(){return NJ(t.g?t.g(1):t.call(null,1),t.g?t.g(0):t.call(null,0),e)})):null}function HK(e,t,n){var i=BK(e,t),o=DK(e,t),l=Vy.g(o);Ig.j(l,re,n),o=z(r(fF.g(o))),l=null;for(var s=0,a=0;;)if(a<s){var u=l.$(null,a);zK(e,n,u),a+=1}else{if(!(o=z(o)))break;Me(l=o)?(o=ed(l),a=fd(l),l=o,s=C(o),o=a):(o=A(l),zK(e,n,o),o=B(l),l=null,s=0),a=0}return yb(i)?yK(e,(function(){return cK(t.g?t.g(1):t.call(null,1),t.g?t.g(0):t.call(null,0),e)})):null}h=tK.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"grammar":return this.ta;case"text":return this.text;case"segment":return this.Ya;case"fail-index":return this.Qa;case"node-builder":return this.Xa;case"stack":return this.stack;case"next-stack":return this.Wa;case"generation":return this.Sa;case"negative-listeners":return this.Va;case"msg-cache":return this.Ua;case"nodes":return this.va;case"success":return this.Za;case"failure":return this.Ra;case"trace?":return this.$a;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#instaparse.gll.Tramp{",", ","}",n,Of.h(new Q(null,14,5,S,[new Q(null,2,5,S,[hr,this.ta],null),new Q(null,2,5,S,[TD,this.text],null),new Q(null,2,5,S,[zn,this.Ya],null),new Q(null,2,5,S,[Jm,this.Qa],null),new Q(null,2,5,S,[Zx,this.Xa],null),new Q(null,2,5,S,[Uw,this.stack],null),new Q(null,2,5,S,[tw,this.Wa],null),new Q(null,2,5,S,[Wr,this.Sa],null),new Q(null,2,5,S,[iC,this.Va],null),new Q(null,2,5,S,[Dq,this.Ua],null),new Q(null,2,5,S,[Mu,this.va],null),new Q(null,2,5,S,[jC,this.Za],null),new Q(null,2,5,S,[gx,this.Ra],null),new Q(null,2,5,S,[Nu,this.$a],null)],null),this.m))},h.xa=function(){return new Yh(this,14,new Q(null,14,5,S,[hr,TD,zn,Jm,Zx,Uw,tw,Wr,iC,Dq,Mu,jC,gx,Nu],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 14+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=166878148^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.ta,t.ta)&&x.h(this.text,t.text)&&x.h(this.Ya,t.Ya)&&x.h(this.Qa,t.Qa)&&x.h(this.Xa,t.Xa)&&x.h(this.stack,t.stack)&&x.h(this.Wa,t.Wa)&&x.h(this.Sa,t.Sa)&&x.h(this.Va,t.Va)&&x.h(this.Ua,t.Ua)&&x.h(this.va,t.va)&&x.h(this.Za,t.Za)&&x.h(this.Ra,t.Ra)&&x.h(this.$a,t.$a)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,14,[Dq,null,iC,null,Wr,null,gx,null,Jm,null,hr,null,jC,null,Mu,null,Zx,null,zn,null,Uw,null,Nu,null,tw,null,TD,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"grammar":case"text":case"segment":case"fail-index":case"node-builder":case"stack":case"next-stack":case"generation":case"negative-listeners":case"msg-cache":case"nodes":case"success":case"failure":case"trace?":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(hr,t):O.call(null,hr,t))?new tK(r,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(TD,t):O.call(null,TD,t))?new tK(this.ta,r,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(zn,t):O.call(null,zn,t))?new tK(this.ta,this.text,r,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(Jm,t):O.call(null,Jm,t))?new tK(this.ta,this.text,this.Ya,r,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(Zx,t):O.call(null,Zx,t))?new tK(this.ta,this.text,this.Ya,this.Qa,r,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(Uw,t):O.call(null,Uw,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,r,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(tw,t):O.call(null,tw,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,r,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(Wr,t):O.call(null,Wr,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,r,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(iC,t):O.call(null,iC,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,r,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(Dq,t):O.call(null,Dq,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,r,this.va,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(Mu,t):O.call(null,Mu,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,r,this.Za,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(jC,t):O.call(null,jC,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,r,this.Ra,this.$a,this.D,this.m,null):n(O.h?O.h(gx,t):O.call(null,gx,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,r,this.$a,this.D,this.m,null):n(O.h?O.h(Nu,t):O.call(null,Nu,t))?new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,r,this.D,this.m,null):new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,14,5,S,[new xh(hr,this.ta),new xh(TD,this.text),new xh(zn,this.Ya),new xh(Jm,this.Qa),new xh(Zx,this.Xa),new xh(Uw,this.stack),new xh(tw,this.Wa),new xh(Wr,this.Sa),new xh(iC,this.Va),new xh(Dq,this.Ua),new xh(Mu,this.va),new xh(jC,this.Za),new xh(gx,this.Ra),new xh(Nu,this.$a)],null),this.m))},h.S=function(e,t){return new tK(this.ta,this.text,this.Ya,this.Qa,this.Xa,this.stack,this.Wa,this.Sa,this.Va,this.Ua,this.va,this.Za,this.Ra,this.$a,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h=xK.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"listeners":return this.ic;case"full-listeners":return this.$b;case"results":return this.results;case"full-results":return this.ac;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#instaparse.gll.Node{",", ","}",n,Of.h(new Q(null,4,5,S,[new Q(null,2,5,S,[rC,this.ic],null),new Q(null,2,5,S,[Vy,this.$b],null),new Q(null,2,5,S,[io,this.results],null),new Q(null,2,5,S,[fF,this.ac],null)],null),this.m))},h.xa=function(){return new Yh(this,4,new Q(null,4,5,S,[rC,Vy,io,fF],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 4+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-1610074144^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.ic,t.ic)&&x.h(this.$b,t.$b)&&x.h(this.results,t.results)&&x.h(this.ac,t.ac)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,4,[fF,null,Vy,null,rC,null,io,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new xK(this.ic,this.$b,this.results,this.ac,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"listeners":case"full-listeners":case"results":case"full-results":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(rC,t):O.call(null,rC,t))?new xK(r,this.$b,this.results,this.ac,this.D,this.m,null):n(O.h?O.h(Vy,t):O.call(null,Vy,t))?new xK(this.ic,r,this.results,this.ac,this.D,this.m,null):n(O.h?O.h(io,t):O.call(null,io,t))?new xK(this.ic,this.$b,r,this.ac,this.D,this.m,null):n(O.h?O.h(fF,t):O.call(null,fF,t))?new xK(this.ic,this.$b,this.results,r,this.D,this.m,null):new xK(this.ic,this.$b,this.results,this.ac,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,4,5,S,[new xh(rC,this.ic),new xh(Vy,this.$b),new xh(io,this.results),new xh(fF,this.ac)],null),this.m))},h.S=function(e,t){return new xK(this.ic,this.$b,this.results,this.ac,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)};var IK=Ag(qj,ah);function JK(e,t,n){return Ig.j(iC.g(e),IK,ve([t.g?t.g(0):t.call(null,0),new Q(null,1,5,S,[n],null)]))}function KK(e,t,n,r){return Ig.h(gx.g(e),(function(e){var t=Gm.g(e);switch(t=Ue(n,t)){case 1:return new rK(n,new Q(null,1,5,S,[r],null),null,null,null);case 0:return new rK(n,re.h(In.g(e),r),null,null,null);case-1:return e;default:throw Error(["No matching clause: ",p.g(t)].join(""))}})),x.h(n,Jm.g(e))?FK(e,t,vK(function(){var t=Zx.g(e),r=TD.g(e);r=rf?r.substring(n):qf.call(null,r,n);var i=C(TD.g(e));return LK.O?LK.O(t,LG,r,n,i):LK.call(null,t,LG,r,n,i)}(),C(TD.g(e)))):null}function MK(e){var t=Be(r(e));Ig.h(e,Ce),t.A?t.A():t.call(null)}function NK(e,t){for(;;){var i=Uw.g(e);if(n(r(jC.g(e))))return ke(xA.g(r(jC.g(e))),new Df(null,function(e){return function(){return Gg(jC.g(e),null),NK(e,!0)}}(e),null,null));if(0<C(r(i)))MK(i);else if(0<C(r(iC.g(e)))){var o=A(r(iC.g(e)));i=G(o,0,null);var l=Be(o=G(o,1,null));l.A?l.A():l.call(null),x.h(C(o),1)?Ig.j(iC.g(e),we,i):Ig.F(iC.g(e),fh,new Q(null,1,5,S,[i],null),Ce)}else{if(!n(t))return null;Gg(i,r(t=tw.g(e))),Gg(t,F),Ig.h(Wr.g(e),Rd),t=null}}}function OK(e,t){return function(n){return FK(t,e,n)}}function PK(e,t){return function(){return FK(t,e,vK(null,e.g?e.g(0):e.call(null,0)))}}var QK=function e(t,n,r,i){return function(o){var l=bg(o);if(o=u.h(l,xA),l=u.h(l,Gm),o=BI(t,o),z(n)){l=new Q(null,2,5,S,[l,A(n)],null);var s=B(n);o=e.F?e.F(o,s,r,i):e.call(null,o,s,r,i),o=GK(i,l,o)}else o=FK(i,r,vK(o,l));return o}},RK=function e(t,n,r,i){return function(o){var l=bg(o);o=u.h(l,xA),l=u.h(l,Gm);var s,a=BI(t,o);return iJ(n)?HK(i,new Q(null,2,5,S,[l,A(n)],null),(s=B(n),e.F?e.F(a,s,r,i):e.call(null,a,s,r,i))):z(n)?GK(i,new Q(null,2,5,S,[l,A(n)],null),function(){var t=B(n);return e.F?e.F(a,t,r,i):e.call(null,a,t,r,i)}()):FK(i,r,vK(a,l))}},SK=function e(t,n,r,i,o){return function(l){var s=bg(l);return l=u.h(s,xA),s=u.h(s,Gm),x.h(s,r)?0===C(t)?FK(o,i,vK(null,s)):null:(l=BI(t,l),GK(o,new Q(null,2,5,S,[s,n],null),e.O?e.O(l,n,s,i,o):e.call(null,l,n,s,i,o)),FK(o,i,vK(l,s)))}},TK=function e(t,n,r,i,o){return function(l){var s=bg(l);return l=u.h(s,xA),s=u.h(s,Gm),x.h(s,r)?0===C(t)?FK(o,i,vK(null,s)):null:(l=BI(t,l),x.h(s,C(TD.g(o)))?FK(o,i,vK(l,s)):GK(o,new Q(null,2,5,S,[s,n],null),e.O?e.O(l,n,s,i,o):e.call(null,l,n,s,i,o)))}},UK=function e(t,n,r,i,o,l,s,a){return function(l){l=bg(l);var c=u.h(l,xA);l=u.h(l,Gm),c=BI(t,c);var h=n+1;return i<=h&&h<=o&&FK(a,s,vK(c,l)),h<o?GK(a,new Q(null,2,5,S,[l,r],null),e.Ma?e.Ma(c,h,r,i,o,l,s,a):e.call(null,c,h,r,i,o,l,s,a)):null}},VK=function e(t,n,r,i,o,l,s,a){return function(l){l=bg(l);var c=u.h(l,xA);l=u.h(l,Gm),c=BI(t,c);var h=n+1;return x.h(l,C(TD.g(a)))?i<=h&&h<=o?FK(a,s,vK(c,l)):null:h<o?GK(a,new Q(null,2,5,S,[l,r],null),e.Ma?e.Ma(c,h,r,i,o,l,s,a):e.call(null,c,h,r,i,o,l,s,a)):null}};function WK(e){return function(t){return Gg(jC.g(e),t)}}function RJ(e,t,n){var r=CB.g(e),i=TD.g(n),o=C(i),l=t+C(r);return o=o<l?o:l,i=sf?i.substring(t,o):qf.call(null,i,t,o),x.h(r,i)?FK(n,new Q(null,2,5,S,[t,e],null),vK(r,o)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,CB,EF,r],null))}function gK(e,t,n){var r=CB.g(e),i=TD.g(n),o=C(i),l=t+C(r);return o=o<l?o:l,l=sf?i.substring(t,o):qf.call(null,i,t,o),x.h(o,C(i))&&x.h(r,l)?FK(n,new Q(null,2,5,S,[t,e],null),vK(r,o)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,3,[Y,CB,EF,r,rz,!0],null))}function SJ(e,t,n){var r=CB.g(e),i=TD.g(n),o=C(i),l=t+C(r);return o=o<l?o:l,i=sf?i.substring(t,o):qf.call(null,i,t,o),x.h(r.toUpperCase(),i.toUpperCase())?FK(n,new Q(null,2,5,S,[t,e],null),vK(r,o)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,CB,EF,r],null))}function hK(e,t,n){var r=CB.g(e),i=TD.g(n),o=C(i),l=t+C(r);return o=o<l?o:l,l=sf?i.substring(t,o):qf.call(null,i,t,o),x.h(o,C(i))&&x.h(r.toUpperCase(),l.toUpperCase())?FK(n,new Q(null,2,5,S,[t,e],null),vK(r,o)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,3,[Y,CB,EF,r,rz,!0],null))}function TJ(e,t,n){var r=ft.g(e),i=mr.g(e),o=TD.g(n);if(t>=C(o))return KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,bB,EF,new k(null,3,[Kt,!0,ft,r,mr,i],null)],null));if(65535>=i)return r<=(o=o.charCodeAt(t))&&o<=i?FK(n,new Q(null,2,5,S,[t,e],null),vK(p.g(hf(o)),t+1)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,bB,EF,new k(null,3,[Kt,!0,ft,r,mr,i],null)],null));var l=LJ(o=MJ(o,0|t));return r<=o&&o<=i?FK(n,new Q(null,2,5,S,[t,e],null),vK(l,t+C(l))):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,bB,EF,new k(null,3,[Kt,!0,ft,r,mr,i],null)],null))}function iK(e,t,n){var r=ft.g(e),i=mr.g(e),o=TD.g(n),l=C(o);if(t>=C(o))return KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,bB,EF,new k(null,3,[Kt,!0,ft,r,mr,i],null)],null));if(65535>=i)return o=o.charCodeAt(t),x.h(t+1,l)&&r<=o&&o<=i?FK(n,new Q(null,2,5,S,[t,e],null),vK(p.g(hf(o)),l)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,bB,EF,new k(null,3,[Kt,!0,ft,r,mr,i],null)],null));var s=LJ(o=MJ(o,0|t));return x.h(t+C(s),l)&&r<=o&&o<=i?FK(n,new Q(null,2,5,S,[t,e],null),vK(s,l)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,3,[Y,bB,EF,new k(null,3,[Kt,!0,ft,r,mr,i],null),rz,!0],null))}function XK(e,t){return n(n(e=new RegExp(e.source,["g",hJ(e)].join("")).exec(t))?0===e.index:e)?A(e):null}function ZJ(e,t,r){var i=RA.g(e),o=zn.g(r);return n(o=XK(i,o=rf?o.substring(t):qf.call(null,o,t)))?FK(r,new Q(null,2,5,S,[t,e],null),vK(o,t+C(o))):KK(r,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,RA,EF,i],null))}function oK(e,t,r){var i=RA.g(e),o=zn.g(r),l=rf?o.substring(t):qf.call(null,o,t);l=XK(i,l);var s=C(o)-t;return n(n(l)?x.h(C(l),s):l)?FK(r,new Q(null,2,5,S,[t,e],null),vK(l,C(o))):KK(r,new Q(null,2,5,S,[t,e],null),t,new k(null,3,[Y,RA,EF,i,rz,!0],null))}function QJ(e,t,n){var r=Ls.g(e);return GK(n,new Q(null,2,5,S,[t,A(r)],null),QK(HI,B(r),new Q(null,2,5,S,[t,e],null),n))}function fK(e,t,n){var r=Ls.g(e);return GK(n,new Q(null,2,5,S,[t,A(r)],null),RK(HI,B(r),new Q(null,2,5,S,[t,e],null),n))}function WJ(e,t,n){var r=Eq.g(e);return GK(n,new Q(null,2,5,S,[t,r],null),SK(HI,r,t,new Q(null,2,5,S,[t,e],null),n))}function lK(e,t,n){var r=Eq.g(e);return GK(n,new Q(null,2,5,S,[t,r],null),TK(HI,r,t,new Q(null,2,5,S,[t,e],null),n))}function XJ(e,t,n){var r=Eq.g(e),i=Jq.g(e),o=EC.g(e);return 0===i?(FK(n,new Q(null,2,5,S,[t,e],null),vK(null,t)),1<=o?GK(n,new Q(null,2,5,S,[t,r],null),UK(HI,0,r,1,o,t,new Q(null,2,5,S,[t,e],null),n)):null):GK(n,new Q(null,2,5,S,[t,r],null),UK(HI,0,r,i,o,t,new Q(null,2,5,S,[t,e],null),n))}function mK(e,t,n){var r=Eq.g(e),i=Jq.g(e),o=EC.g(e);return 0===i?(FK(n,new Q(null,2,5,S,[t,e],null),vK(null,t)),1<=o?GK(n,new Q(null,2,5,S,[t,r],null),VK(HI,0,r,1,o,t,new Q(null,2,5,S,[t,e],null),n)):null):GK(n,new Q(null,2,5,S,[t,r],null),VK(HI,0,r,i,o,t,new Q(null,2,5,S,[t,e],null),n))}function YJ(e,t,n){var r=Eq.g(e);return GK(n,new Q(null,2,5,S,[t,r],null),SK(HI,r,t,new Q(null,2,5,S,[t,e],null),n)),FK(n,new Q(null,2,5,S,[t,e],null),vK(null,t))}function nK(e,t,n){var r=Eq.g(e);return x.h(t,C(TD.g(n)))?FK(n,new Q(null,2,5,S,[t,e],null),vK(null,t)):GK(n,new Q(null,2,5,S,[t,r],null),TK(HI,r,t,new Q(null,2,5,S,[t,e],null),n))}function PJ(e,t,n){var r=Ls.g(e);r=z(r);for(var i=null,o=0,l=0;;)if(l<o){var s=i.$(null,l);GK(n,new Q(null,2,5,S,[t,s],null),OK(new Q(null,2,5,S,[t,e],null),n)),l+=1}else{if(!(r=z(r)))return null;Me(i=r)?(r=ed(i),o=fd(i),i=r,s=C(r),r=o,o=s):(s=A(i),GK(n,new Q(null,2,5,S,[t,s],null),OK(new Q(null,2,5,S,[t,e],null),n)),r=B(i),i=null,o=0),l=0}}function eK(e,t,n){var r=Ls.g(e);r=z(r);for(var i=null,o=0,l=0;;)if(l<o){var s=i.$(null,l);HK(n,new Q(null,2,5,S,[t,s],null),OK(new Q(null,2,5,S,[t,e],null),n)),l+=1}else{if(!(r=z(r)))return null;Me(i=r)?(r=ed(i),o=fd(i),i=r,s=C(r),r=o,o=s):(s=A(i),HK(n,new Q(null,2,5,S,[t,s],null),OK(new Q(null,2,5,S,[t,e],null),n)),r=B(i),i=null,o=0),l=0}}function bK(e,t,n){var r=Qr.g(e),i=Rr.g(e);r=new Q(null,2,5,S,[t,r],null);var o=new Q(null,2,5,S,[t,i],null),l=OK(new Q(null,2,5,S,[t,e],null),n);return GK(n,r,l),JK(n,r,(function(){return GK(n,o,l)}))}function qK(e,t,n){var r=Qr.g(e),i=Rr.g(e);r=new Q(null,2,5,S,[t,r],null);var o=new Q(null,2,5,S,[t,i],null),l=OK(new Q(null,2,5,S,[t,e],null),n);return HK(n,r,l),JK(n,r,(function(){return HK(n,o,l)}))}function VJ(e,t,n){var r=Eq.g(e);return GK(n,new Q(null,2,5,S,[t,r],null),OK(new Q(null,2,5,S,[t,e],null),n)),FK(n,new Q(null,2,5,S,[t,e],null),vK(null,t))}function kK(e,t,n){var r=Eq.g(e);return HK(n,new Q(null,2,5,S,[t,r],null),OK(new Q(null,2,5,S,[t,e],null),n)),x.h(t,C(TD.g(n)))?FK(n,new Q(null,2,5,S,[t,e],null),vK(null,t)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,Tm,EF,zD],null))}function OJ(e,t,n){var r=hr.g(n),i=bt.g(e);return r=u.j(r,i,i),GK(n,new Q(null,2,5,S,[t,r],null),OK(new Q(null,2,5,S,[t,e],null),n))}function dK(e,t,n){var r=hr.g(n),i=bt.g(e);return r=u.j(r,i,i),HK(n,new Q(null,2,5,S,[t,r],null),OK(new Q(null,2,5,S,[t,e],null),n))}function $J(e,t,n){var r=Eq.g(e);return GK(n,new Q(null,2,5,S,[t,r],null),PK(new Q(null,2,5,S,[t,e],null),n))}function pK(e,t,n){return x.h(t,C(TD.g(n)))?$J(e,t,n):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,Ow,EF,zD],null))}function aK(e,t,r){var i,o=Eq.g(e),l=new Q(null,2,5,S,[t,o],null);return n(CK(r,l))?KK(r,new Q(null,2,5,S,[t,e],null),t,new k(null,1,[Y,Ym],null)):(GK(r,l,(i=new qk((function(){return KK(r,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,Ym,EF,new k(null,1,[AA,VI(o,!1)],null)],null))})),function(){return uk(i)})),JK(r,l,(function(){return yb(CK(r,l))?FK(r,new Q(null,2,5,S,[t,e],null),vK(null,t)):null})))}function UJ(e,t,n){return FK(n,new Q(null,2,5,S,[t,e],null),vK(null,t))}function jK(e,t,n){return x.h(t,C(TD.g(n)))?FK(n,new Q(null,2,5,S,[t,e],null),vK(null,t)):KK(n,new Q(null,2,5,S,[t,e],null),t,new k(null,2,[Y,RF,EF,zD],null))}function YK(e,t,r){n(r)?GK(e,new Q(null,2,5,S,[0,t],null),WK(e)):HK(e,new Q(null,2,5,S,[0,t],null),WK(e))}function ZK(e,t,i,o){if(YK(e=uK(e,i,i,-1,null),BJ(t),o),n(t=NK(e,null)))t=A(t);else{t=r(gx.g(e));e:{o=Gm.g(t);for(var l=e=1,s=0;;){if(x.h(o,s)){o=new k(null,2,[cw,e,rs,l],null);break e}x.h("\n",u.h(i,s))?(s+=1,e+=1,l=1):(s+=1,l+=1)}}e=pj.l;e:for(l=cw.g(o),i=z(QI(i,"\r\n","\n"));;){if(Ee(i)){i="";break e}if(x.h(l,1)){i=Xf(p,Fj(xg(new uj(null,new k(null,1,["\n",null],null),null)),i));break e}x.h("\n",A(i))?(i=B(i),--l):i=B(i)}t=e.call(pj,D([t,o,new k(null,1,[TD,i],null)]))}return t}function LK(e,t,n,r,i){return ze(e.h?e.h(t,n):e.call(null,t,n),new k(null,2,[Dy,r,wt,i],null))}function $K(e,t){return(null!=e?262144&e.B||cb===e.Me||!e.B&&Cb(Ac,e):Cb(Ac,e))?ze(e,pj.l(D([t,Ae(e)]))):e}var aL=function e(t,r){var i=Y.g(r);return n(i=t.g?t.g(i):t.call(null,i))?$K(Xf(i,Ng.h(Ag(e,t),en.g(r))),Ae(r)):n(Y.g(r))?I.j(r,en,Ng.h(Ag(e,t),en.g(r))):r},bL=function e(t,r){if(Ie(r)&&z(r)){var i=A(r);return n(i=t.g?t.g(i):t.call(null,i))?$K(Xf(i,Ng.h(Ag(e,t),B(r))),Ae(r)):ze(ah.h(new Q(null,1,5,S,[A(r)],null),Ng.h(Ag(e,t),B(r))),Ae(r))}return r},cL=function e(t,r){if("string"==typeof r)t=r;else{var i=(i=J(r))?Y.g(r):i;t=n(i)?aL(t,r):Le(r)&&A(r)instanceof w?bL(t,r):Ie(r)?ze(Ng.h(Ag(e,t),r),Ae(r)):r instanceof rK?r:gJ(D(["Invalid parse-tree, not recognized as either enlive or hiccup format."]))}return t};function dL(e,t,n){if(tf(n)){var r=Xf(N,Ng.h(e,n));return t.g?t.g(r):t.call(null,r)}return Fh(n)?(r=new xh(function(){var t=pc(n);return e.g?e.g(t):e.call(null,t)}(),function(){var t=qc(n);return e.g?e.g(t):e.call(null,t)}()),t.g?t.g(r):t.call(null,r)):Qe(n)?(r=Oj(Ng.h(e,n)),t.g?t.g(r):t.call(null,r)):Ke(n)?(r=Nb.j((function(t,n){return re.h(t,e.g?e.g(n):e.call(null,n))}),n,n),t.g?t.g(r):t.call(null,r)):Fe(n)?(r=ah.h(te(n),Ng.h(e,n)),t.g?t.g(r):t.call(null,r)):t.g?t.g(n):t.call(null,n)}var eL=function e(t,n){return dL(Ag(e,t),t,n)};function fL(e){function t(e){var t=G(e,0,null);return e=G(e,1,null),new Q(null,2,5,S,"string"==typeof t?[Bf.g(t),e]:[t,e],null)}return eL((function(e){return J(e)?ah.h(P,Ng.h(t,e)):e}),e)}function gL(e){return null==e?null:hf(e)}function hL(e,t,n,r,i){this.tc=e,this.form=t,this.D=n,this.m=r,this.G=i,this.B=2230716170,this.M=139264}function iL(e,t){return new hL(t,e,null,null,null)}h=hL.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"splicing?":return this.tc;case"form":return this.form;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.tools.reader.impl.utils.ReaderConditional{",", ","}",n,Of.h(new Q(null,2,5,S,[new Q(null,2,5,S,[rD,this.tc],null),new Q(null,2,5,S,[Ds,this.form],null)],null),this.m))},h.xa=function(){return new Yh(this,2,new Q(null,2,5,S,[rD,Ds],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 2+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-209062840^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.tc,t.tc)&&x.h(this.form,t.form)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,2,[rD,null,Ds,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new hL(this.tc,this.form,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"splicing?":case"form":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(rD,t):O.call(null,rD,t))?new hL(r,this.form,this.D,this.m,null):n(O.h?O.h(Ds,t):O.call(null,Ds,t))?new hL(this.tc,r,this.D,this.m,null):new hL(this.tc,this.form,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,2,5,S,[new xh(rD,this.tc),new xh(Ds,this.form)],null),this.m))},h.S=function(e,t){return new hL(this.tc,this.form,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h.pa=cb,h.U=function(e,t,r){return Qc(t,["#?",n(this.tc)?"@":null].join("")),bk(this.form,t,r)};var jL=/[\s]/;function kL(e){return null==e?null:","===e||jL.test(e)}function lL(e){return null==e?null:!/[^0-9]/.test(e)}function mL(e){return e instanceof w?ve([e,!0]):e instanceof Ad||"string"==typeof e?new k(null,1,[Y,e],null):e}var nL=Fg(0);function oL(e,t){return function t(n){return new Df(null,(function(){for(;;){var r=z(n);if(r){if(Me(r)){var i=ed(r),o=C(i),l=Hf(o);return function(){for(var t=0;;){if(!(t<o))return!0;var n=Zb(i,t),r=l;if(n instanceof Ad||n instanceof w){var s=Nj(zf,Cf)(n),a=G(s,0,null);s=G(s,1,null);var u=n instanceof Ad?Bd:Bf;n=null==a?u.h?u.h(e,s):u.call(null,e,s):x.h("_",a)?u.g?u.g(s):u.call(null,s):n}r.add(n),t+=1}}()?Jf(Lf(l),t(fd(r))):Jf(Lf(l),null)}var s=A(r);return ke(s instanceof Ad||s instanceof w?function(){var t=Nj(zf,Cf)(s),n=G(t,0,null);t=G(t,1,null);var r=s instanceof Ad?Bd:Bf;return null==n?r.h?r.h(e,t):r.call(null,e,t):x.h("_",n)?r.g?r.g(t):r.call(null,t):s}():s,t(Hd(r)))}return null}}),null,null)}(t)}function pL(e){var t=G(e,0,null);return e=G(e,1,null),n(t)?null:e}function qL(e,t){return e=parseInt(e,t),n(isNaN(e))?-1:e}function rL(e){if(null!=e&&null!=e.Ca)e=e.Ca(e);else{var t=rL[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=rL._))throw Eb("Reader.read-char",e);e=t.g?t.g(e):t.call(null,e)}}return e}function sL(e){if(null!=e&&null!=e.Bc)e=e.Bc(e);else{var t=sL[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=sL._))throw Eb("Reader.peek-char",e);e=t.g?t.g(e):t.call(null,e)}}return e}function tL(e,t){if(null!=e&&null!=e.Hd)e.Hd(e,t);else{var n=tL[ba(null==e?null:e)];if(null!=n)n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=tL._))throw Eb("IPushbackReader.unread",e);n.h?n.h(e,t):n.call(null,e,t)}}}function uL(e){if(null!=e&&null!=e.Jd)e=e.Jd(e);else{var t=uL[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=uL._))throw Eb("IndexingReader.get-line-number",e);e=t.g?t.g(e):t.call(null,e)}}return e}function vL(e){if(null!=e&&null!=e.Id)e=e.Id(e);else{var t=vL[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=vL._))throw Eb("IndexingReader.get-column-number",e);e=t.g?t.g(e):t.call(null,e)}}return e}function wL(e){if(null!=e&&null!=e.Re)e=e.Re(e);else{var t=wL[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=wL._))throw Eb("IndexingReader.get-file-name",e);e=t.g?t.g(e):t.call(null,e)}}return e}function xL(e,t){this.ka=e,this.bg=t,this.td=0}function yL(e,t){this.Zf=e,this.ga=t,this.Sb=this.De=1}function zL(e){return null!=e&&cb===e.zi}function AL(e){e=new xL(e,C(e));e:{var t=Array(1);if(Qe(null))for(var n=0,r=z(null);;){if(!(r&&1>n))break e;t[n]=A(r),n+=1,r=B(r)}else for(n=0;1>n;)t[n]=null,n+=1}return new yL(e,t)}function BL(e,t,r,i){var o=C(t);return e=n(e)?0:10<o?10:o,t=Ng.h(Ag(CL,!0),Og.h(e,t)),t=Xf(p,Pg(1,Ug.h(Sg(" "),t))),o=e<o?"...":null,[p.g(r),p.g(t),o,p.g(i)].join("")}xL.prototype.Ca=function(){if(this.bg>this.td){var e=this.ka.charAt(this.td);return this.td+=1,e}return null},xL.prototype.Bc=function(){return this.bg>this.td?this.ka.charAt(this.td):null},yL.prototype.Ca=function(){var e=this.Sb<this.De?this.ga[this.Sb]:this.Zf.Ca(null);return this.Sb<this.De&&(this.Sb+=1),gL(e)},yL.prototype.Bc=function(){return gL(this.Sb<this.De?this.ga[this.Sb]:this.Zf.Bc(null))},yL.prototype.Hd=function(e,t){if(n(t)){if(0===this.Sb)throw Error("Pushback buffer is full");return--this.Sb,this.ga[this.Sb]=t}return null};var CL,A2=Fg(P),B2=Fg(P),C2=Fg(P),D2=Fg(P),E2=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));function IL(e,t,r){t=new k(null,2,[X,Yl,Lm,t],null),e=zL(e)?I.l(t,CD,wL(e),D([cw,uL(e),bx,vL(e)])):t;var i=CD.g(e);t=cw.g(e);var o=bx.g(e);throw i=n(i)?[p.g(i)," "].join(""):null,t=n(t)?["[line ",p.g(t),", col ",p.g(o),"]"].join(""):null,cl(r=$f(p,i,t,n(n(i)?i:t)?" ":null,r),e)}function JL(e,t){return IL(e,sq,D([Xf(p,t)]))}function KL(e,t){return IL(e,fp,D([Xf(p,t)]))}function LL(e,t){return IL(e,qn,D([Xf(p,t)]))}function ML(e,t,r,i,o){return LL(e,D(["Unexpected EOF while reading ",n(o)?["item ",p.g(o)," of "].join(""):null,Cf(t),n(r)?[", starting at line ",p.g(r)," and column ",p.g(i)].join(""):null,"."]))}function NL(e,t,r,i){JL(e,D(["The map literal starting with ",CL.h(!1,A(i)),n(t)?[" on line ",p.g(t)," column ",p.g(r)].join(""):null," contains ",C(i)," form(s). Map literals must contain an even number of forms."]))}function OL(e){throw KL(null,D(["Invalid unicode literal: \\",e,"."]))}function PL(e,t){return JL(e,D(["Invalid unicode escape: \\u",t,"."]))}function QL(e,t,n){return JL(e,D(["Invalid ",Cf(t),": ",n,"."]))}function RL(e,t){return LL(e,D(["Unexpected EOF while reading start of ",Cf(t),"."]))}function SL(e,t,n){return JL(e,D(["Invalid character: ",n," found while reading ",Cf(t),"."]))}function TL(e){return LL(e,D(["Unexpected EOF while reading dispatch character."]))}function UL(e,t,n){e:{var r=t instanceof w?t.W:null;switch(r){case"regex":r='#"';break e;case"string":r='"';break e;default:throw Error(["No matching clause: ",p.g(r)].join(""))}}return LL(e,D(["Unexpected EOF reading ",Cf(t)," starting ",Yf(p,r,n),"."]))}function VL(e,t){return KL(null,D(["Invalid digit ",e," in unicode character \\",t,"."]))}function WL(e,t){return KL(e,D(["Invalid digit ",t," in unicode character."]))}function XL(e,t,n){return KL(e,D(["Invalid unicode literal. Unicode literals should be ",n,"characters long. ","Value supplied is ",t," characters long."]))}function YL(e,t){return JL(e,D(["Invalid character literal \\u",t,"."]))}function ZL(e,t){return JL(e,D(["Invalid octal escape sequence in a character literal: ",t,". Octal escape sequences must be 3 or fewer digits."]))}function $L(e){return JL(e,D(["Octal escape sequence must be in range [0, 377]."]))}function aM(e){return LL(e,D(["Unexpected EOF while reading character."]))}function bM(e,t){return JL(e,D(["Unsupported escape character: \\",t,"."]))}function cM(e){return JL(e,D(["A single colon is not a valid keyword."]))}function dM(e,t){JL(e,D(["Metadata cannot be ",CL.h(!1,t),". Metadata must be a Symbol, Keyword, String or Map."]))}function eM(e,t){return JL(e,D(["Metadata can not be applied to ",CL.h(!1,t),". ","Metadata can only be applied to IMetas."]))}function fM(e,t){return JL(e,D(["Namespaced map with namespace ",t," does not specify a map."]))}function gM(e,t){return JL(e,D(["Invalid value used as namespace in namespaced map: ",t,"."]))}function hM(e,t){JL(e,D(["Invalid reader tag: ",CL.h(!1,t),". Reader tags must be symbols."]))}function iM(e,t){return JL(e,D(["No reader function for tag ",CL.h(!1,t),"."]))}function jM(e,t){return t=function e(t){return new Df(null,(function(){for(var n=t;;){if(!(n=z(n)))return null;if(Me(n)){var r=ed(n),i=C(r),o=Hf(i);e:for(var l=0;;){if(!(l<i)){r=!0;break e}var s=Zb(r,l),a=G(s,0,null);1<G(s,1,null)&&o.add(a),l+=1}return Jf(Lf(o),r?e(fd(n)):null)}if(r=G(o=A(n),0,null),1<G(o,1,null))return ke(r,e(Hd(n)));n=Hd(n)}}),null,null)}(Mj(t)),$f(p,e,1<C(t)?"s":null,": ",Pg(1,Ug.h(Sg(", "),t)))}function kM(e,t,n){return t=Cf(t),JL(e,D([jM([String(t.charAt(0)).toUpperCase()+String(t.substr(1)).toLowerCase()," literal contains duplicate key"].join(""),n)]))}function lM(e,t){return n(t)?LL(e,D(["EOF while reading, starting at line ",t,"."])):LL(e,D(["EOF while reading."]))}function mM(e){for(var t=e.Ca(null);;){if(!(kL.g?kL.g(t):kL.call(null,t)))return t;t=e.Ca(null)}}CL=new Yk(Bd.h("cljs.tools.reader.impl.inspect","inspect*"),(function(e,t){return null==t?Nl:"string"==typeof t?CB:t instanceof w||"number"==typeof t||t instanceof Ad?Zw:Le(t)?hA:tf(t)?Xx:J(t)?BC:Ge(t)?pt:x.h(t,!0)||x.h(t,!1)?Zw:Db(t)}),E2,A2,B2,C2,D2),CL.C(null,CB,(function(e,t){e=n(e)?5:20;var r=t.length>e?'..."':'"',i=t.length;return['"',p.g(t.substring(0,e<i?e:i)),r].join("")})),CL.C(null,Zw,(function(e,t){return p.g(t)})),CL.C(null,Fd,(function(){return"<indexed seq>"})),CL.C(null,bi,(function(){return"<map seq>"})),CL.C(null,Ji,(function(){return"<map seq>"})),CL.C(null,wf,(function(){return"<cons>"})),CL.C(null,Df,(function(){return"<lazy seq>"})),CL.C(null,Nl,(function(){return"nil"})),CL.C(null,Xx,(function(e,t){return BL(e,t,"(",")")})),CL.C(null,BC,(function(e,t){var r=C(t),i=n(e)?0:r;return BL(e,t=Xf(Of,Og.h(i,t)),"{",r>i?"...}":"}")})),CL.C(null,pt,(function(e,t){return BL(e,t,"#{","}")})),CL.C(null,hA,(function(e,t){return BL(e,t,"[","]")})),CL.C(null,Zk,(function(e,t){return hk.l(D([Db(t)]))}));var nM=/^([-+]?)(?:(0)|([1-9][0-9]*)|0[xX]([0-9A-Fa-f]+)|0([0-7]+)|([1-9][0-9]?)[rR]([0-9A-Za-z]+)|0[0-9]+)(N)?$/,oM=/([-+]?[0-9]+)\/([0-9]+)/,pM=/([-+]?[0-9]+(\.[0-9]*)?([eE][-+]?[0-9]+)?)(M)?/;function qM(e,t){return G(e=Qj(e,t),0,null)===t}function rM(e){if(qM(nM,e)){var t=Eh(Qj(nM,e));if(null!=(t.g?t.g(2):t.call(null,2)))e=0;else{e="-"===(t.g?t.g(1):t.call(null,1));var r=(t=null!=(t.g?t.g(3):t.call(null,3))?new Q(null,2,5,S,[t.g?t.g(3):t.call(null,3),10],null):null!=(t.g?t.g(4):t.call(null,4))?new Q(null,2,5,S,[t.g?t.g(4):t.call(null,4),16],null):null!=(t.g?t.g(5):t.call(null,5))?new Q(null,2,5,S,[t.g?t.g(5):t.call(null,5),8],null):null!=(t.g?t.g(7):t.call(null,7))?new Q(null,2,5,S,[t.g?t.g(7):t.call(null,7),parseInt(t.g?t.g(6):t.call(null,6))],null):new Q(null,2,5,S,[null,null],null)).g?t.g(0):t.call(null,0);null==r?e=null:(t=parseInt(r,t.g?t.g(1):t.call(null,1)),e=e?-1*t:t,e=n(isNaN(e))?null:e)}}else qM(pM,e)?e=null!=((t=Eh(Qj(pM,e))).g?t.g(4):t.call(null,4))?parseFloat(t.g?t.g(1):t.call(null,1)):parseFloat(e):qM(oM,e)?(e=(t=Eh(Qj(oM,e))).g?t.g(1):t.call(null,1),t=t.g?t.g(2):t.call(null,2),e=n(Qj(/^\+/,e))?e.substring(1):e,e=parseInt(e)/parseInt(t)):e=null;return e}function sM(e){if(""===e||!0===/:$/.test(e)||!0===/^::/.test(e))return null;var t=e.indexOf("/"),n=0<t?e.substring(0,t):null;return null!=n?(t+=1)===C(e)||lL(ee(e=e.substring(t),0))||""===e||!1!==/:$/.test(n)||"/"!==e&&-1!==e.indexOf("/")?null:new Q(null,2,5,S,[n,e],null):"/"===e||-1===e.indexOf("/")?new Q(null,2,5,S,[null,e],null):null}var tM=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],1<n.length?new Fd(n.slice(1),0,null):null)};function uM(e){return function(){function t(e,t){var r=null;if(1<arguments.length){r=0;for(var i=Array(arguments.length-1);r<i.length;)i[r]=arguments[r+1],++r;r=new Fd(i,0,null)}return n.call(this,e,r)}function n(t){return JL(t,D([e]))}return t.I=1,t.J=function(e){var t=A(e);return e=Hd(e),n(t)},t.l=n,t}()}function vM(e){switch(e){case'"':case";":case"@":case"^":case"`":case"~":case"(":case")":case"[":case"]":case"{":case"}":case"\\":return!0;default:return!1}}tM.l=function(e){for(;;){var t=e.Ca(null);if("\n"===t||"\n"===t||null==t)break}return e},tM.I=1,tM.J=function(e){var t=A(e);return e=B(e),this.l(t,e)};var wM=new Za;function xM(e,t,n){if(null==n)return RL(e,t);for(wM.clear(),t=n;;){if(kL(t)||vM(t)||null==t)return null!=t&&e.Hd(null,t),wM.toString();wM.append(t),t=e.Ca(null)}}function yM(e,t,r,i){if(n(t=e.Ca(null))){var o=zM.g?zM.g(t):zM.call(null,t);return n(o)?o.F?o.F(e,t,r,i):o.call(null,e,t,r,i):(e.Hd(null,t),AM.F?AM.F(e,t,r,i):AM.call(null,e,t,r,i))}return TL(e)}function BM(e,t){return JL(e,D(["Unmatched delimiter ",t,"."]))}function CM(e){for(var t=new Za,n=e.Ca(null);;){if('"'===n)return Sj(p.g(t));if(null==n)return UL(e,Hz,D([t]));t.append(n),"\\"===n&&(null==(n=e.Ca(null))&&UL(e,Hz,D([t])),t.append(n)),n=e.Ca(null)}}function DM(e,t,n){t=1+t,C(e)!==t&&OL(e);for(var r=1,i=0;;){if(r===t)return String.fromCharCode(i);var o=qL(ee(e,r),n);if(-1===o)return VL(ee(e,r),e);i=o+i*n,r+=1}}function EM(e,t,r,i,o){for(var l=1,s=qL(t,r);;){if(-1===s)return WL(e,t);if(l===i)return String.fromCharCode(s);var a=e.Bc(null),u=kL(a);if(u||(u=n(u=FM.g?FM.g(a):FM.call(null,a))?u:null==a),n(u))return n(o)?XL(e,l,i):String.fromCharCode(s);if(u=qL(a,r),e.Ca(null),-1===u)return WL(e,a);s=u+s*r,l+=1}}function GM(e){var t=e.Ca(null);if(null!=t){var r=(t=vM(t)||kL(t)?p.g(t):xM(e,aG,t)).length;return 1===r?t.charAt(0):x.h(t,"newline")?"\n":x.h(t,"space")?" ":x.h(t,"tab")?"\t":x.h(t,"backspace")?"\b":x.h(t,"formfeed")?"\f":x.h(t,"return")?"\r":n(0==t.lastIndexOf("u",0))?55295<(r=(t=DM(t,4,16)).charCodeAt(0))&&57344>r?YL(e,r.toString(16)):t:n(0==t.lastIndexOf("o",0))?3<--r?ZL(e,t):(r=DM(t,r,8),255>=parseInt(t.substring(1),8)?r:$L(e)):JL(e,D(["Unsupported character: ",t,"."]))}return aM(e)}function HM(e){return zL(e)?new Q(null,2,5,S,[e.Jd(null),e.Id(null)-1|0],null):null}function IM(e){return zL(e)?new Q(null,2,5,S,[e.Jd(null),e.Id(null)],null):null}var JM={},KM={},LM=!1;function MM(e,t,n,r,i){var o=LM;LM=!0;try{e:for(var l=HM(n),s=G(l,0,null),a=G(l,1,null),u=gL(t),c=Xc(F);;){var h=NM?NM(n,!1,JM,u,r,i):OM.call(null,n,!1,JM,u,r,i);if(h===KM){var d=Zc(c);break e}if(h===JM){d=ML(n,e,s,a,C(c));break e}c=Pf.h(c,h)}return d}finally{LM=o}}function PM(e,t,r,i){var o=HM(e);t=G(o,0,null),o=G(o,1,null);var l=MM(Xx,")",e,r,i);if(r=G(i=IM(e),0,null),i=G(i,1,null),l=Ee(l)?Id:Xf(N,l),n(t)){var s=pj.l;e=wL(e),e=s.call(pj,D([n(e)?new k(null,1,[CD,e],null):null,new k(null,4,[cw,t,rs,o,MG,r,so,i],null)]))}else e=null;return ze(l,e)}function QM(e,t,r,i){var o=HM(e);t=G(o,0,null),o=G(o,1,null),r=MM(hA,"]",e,r,i);var l=IM(e);if(i=G(l,0,null),l=G(l,1,null),n(t)){var s=pj.l;e=wL(e),e=s.call(pj,D([n(e)?new k(null,1,[CD,e],null):null,new k(null,4,[cw,t,rs,o,MG,i,so,l],null)]))}else e=null;return ze(r,e)}function RM(e,t,r,i){var o=HM(e);t=G(o,0,null),o=G(o,1,null);var l=MM(BC,"}",e,r,i),s=C(l),a=Lj(2,l),u=yj(a);return r=G(i=IM(e),0,null),i=G(i,1,null),!wg(s)&&NL(e,t,o,l),x.h(C(u),C(a))||kM(e,BC,a),l=s<=2*gi?ii(Ye(l)):Qi(Ye(l)),n(t)?(s=pj.l,e=wL(e),e=s.call(pj,D([n(e)?new k(null,1,[CD,e],null):null,new k(null,4,[cw,t,rs,o,MG,r,so,i],null)]))):e=null,ze(l,e)}function SM(e,t){for(var r=function(){var e=new Za;return e.append(t),e}(),i=e.Ca(null);;){if(n(function(){var e=kL(i);return e||(n(e=FM.g?FM.g(i):FM.call(null,i))?e:null==i)}())){var o=p.g(r);e.Hd(null,i);var l=rM(o);return n(l)?l:JL(e,D(["Invalid number: ",o,"."]))}o=function(){var e=r;return e.append(i),e}(),l=e.Ca(null),r=o,i=l}}function TM(e){var t=e.Ca(null);switch(t){case"t":return"\t";case"r":return"\r";case"n":return"\n";case"\\":return"\\";case'"':return'"';case"b":return"\b";case"f":return"\f";case"u":return t=e.Ca(null),-1===parseInt(0|t,16)?PL(e,t):EM(e,t,16,4,!0);default:return lL(t)?255<(0|(t=EM(e,t,8,3,!1)))?$L(e):t:bM(e,t)}}function UM(e){for(var t=new Za,n=e.Ca(null);;){if(null==n)return UL(e,CB,D(['"',t]));switch(n){case"\\":var r=(o=void 0,(o=t).append(TM(e)),o),i=e.Ca(null);t=r,n=i;continue;case'"':return p.g(t);default:r=function(){var e=t;return e.append(n),e}(),i=e.Ca(null),t=r,n=i}}var o}function VM(e,t){var n=HM(e),r=G(n,0,null);if(n=G(n,1,null),null==(t=xM(e,zq,t)))return null;switch(t){case"nil":return null;case"true":return!0;case"false":return!1;case"/":return Ct;default:var i=sM(t);if(null!=i){if(t=Bd.h(i.$(null,0),i.$(null,1)),i=t.S,null==r)r=null;else{var o=wL(e);o=null==o?null:new k(null,1,[CD,o],null);var l=IM(e);e=G(l,0,null),l=G(l,1,null),r=pj.l(D([o,new k(null,4,[cw,r,rs,n,MG,e,so,l],null)]))}r=i.call(t,null,r)}else r=QL(e,zq,t);return r}}function WM(e){var t=e.Ca(null);if(kL(t))return cM(e);var r=sM(t=xM(e,bt,t));if(null!=r){var i=r.$(null,0);return r=r.$(null,1),":"===t.charAt(0)?null!=i?n(i=u.h(null,Bd.g(i.substring(1))))?Bf.h(p.g(i),r):QL(e,bt,[":",p.g(t)].join("")):n(i=null)?Bf.h(p.g(i),r.substring(1)):JL(e,D(["Invalid token: :",t])):Bf.h(i,r)}return QL(e,bt,[":",p.g(t)].join(""))}function XM(e){return function(t,n,r,i){return new se(null,e,new se(null,YM?YM(t,!0,null,r,i):OM.call(null,t,!0,null,r,i),null,1,null),2,null)}}function ZM(e,t,r,i){var o=HM(e);t=G(o,0,null),o=G(o,1,null);var l=mL(YM?YM(e,!0,null,r,i):OM.call(null,e,!0,null,r,i));return J(l)||dM(e,l),null!=(r=YM?YM(e,!0,null,r,i):OM.call(null,e,!0,null,r,i))&&(131072&r.B||cb===r.zd)?(e=n(n(t)?Qe(r):t)?I.l(l,cw,t,D([rs,o])):l,null!=r&&(262144&r.B||cb===r.Me)?ze(r,pj.l(D([Ae(r),e]))):r.K=e):eM(e,r)}function $M(e,t,r,i){var o=HM(e);t=G(o,0,null),o=n(o=G(o,1,null))?o-1|0:null;var l=MM(pt,"}",e,r,i);r=yj(l);var s=IM(e);return i=G(s,0,null),s=G(s,1,null),x.h(C(l),C(r))||JL(e,D([kM(e,pt,l)])),n(t)?(l=pj.l,e=wL(e),e=l.call(pj,D([n(e)?new k(null,1,[CD,e],null):null,new k(null,4,[cw,t,rs,o,MG,i,so,s],null)]))):e=null,ze(r,e)}function aN(e,t,n,r){return YM?YM(e,!0,null,n,r):OM.call(null,e,!0,null,n,r),e}function bN(e,t,n,r){return t=YM?YM(e,!0,null,n,r):OM.call(null,e,!0,null,n,r),x.h(bo,t)?Number.NaN:x.h(kD,t)?Number.NEGATIVE_INFINITY:x.h(Em,t)?Number.POSITIVE_INFINITY:JL(e,D([["Invalid token: ##",p.g(t)].join("")]))}var cN=new uj(null,new k(null,2,[lt,null,Mv,null],null),null);function dN(e,t,n){e===JM&&lM(t,(e=0>n)?n:e)}function eN(e,t,n,r){var i=fN;fN=!0;try{var o=NM?NM(t,!1,JM,")",n,r):OM.call(null,t,!1,JM,")",n,r);return dN(o,t,e),o===KM?KM:null}finally{fN=i}}var gN={};function hN(e,t,r,i){var o=zL(e)?uL(e):-1;e:for(var l=gN,s=null;;)if(l===gN){l=o,s=e;var a=r,c=i,h=NM?NM(s,!1,JM,")",a,c):OM.call(null,s,!1,JM,")",a,c);if(dN(h,s,l),x.h(h,KM))l=KM;else{var d=s,f=h;n(u.h(cN,f))&&JL(d,D(["Feature name ",f," is reserved"])),d=s,f=a,(h instanceof w?x.h(Zk,h)||M(u.h(f,Sy),h):JL(d,D(["Feature should be a keyword: ",h])))?(dN(a=NM?NM(s,!1,JM,")",a,c):OM.call(null,s,!1,JM,")",a,c),s,l),a===KM&&JL(s,D(0>l?["read-cond requires an even number of forms"]:["read-cond starting on line ",l," requires an even number of forms"])),l=a):l=n(l=eN(l,s,a,c))?l:gN}if(l===KM){r=KM;break e}s=null}else{if(s===KM){r=l;break e}s=eN(o,e,r,i)}return r===KM?e:n(t)?null!=r&&(16777216&r.B||cb===r.Je)?(t=Ye(r),ma(La,i,0,0).apply(null,t),e):JL(e,D(["Spliced form list in read-cond-splicing must implement ISequential"])):r}function iN(e,t,r,i){if(yb(function(){if(n(r)){var e=os.g(r),t=new uj(null,new k(null,2,[JA,null,uu,null],null),null);return t.g?t.g(e):t.call(null,e)}return r}()))throw cl("Conditional read not allowed",new k(null,1,[X,eo],null));var o=e.Ca(null);if(!n(o))return aM(e);if(o=(t=x.h(o,"@"))?e.Ca(null):o,t&&(n(LM)||JL(e,D(["cond-splice not in list"]))),!n(o=kL(o)?mM(e):o))return aM(e);if(cg.h(o,"("))throw cl("read-cond body must be a list",new k(null,1,[X,eo],null));var l=fN;fN=function(){var e=fN;return n(e)?e:x.h(JA,os.g(r))}();try{return n(fN)?iL(PM(e,o,r,i),t):hN(e,t,r,i)}finally{fN=l}}var jN=null;function kN(e){return Bd.g([-1===e?"rest":["p",p.g(e)].join(""),"__",p.g(Ig.h(nL,Rd)),"#"].join(""))}function lN(e,t,r,i){if(n(jN))throw cl("Nested #()s are not allowed",new k(null,1,[X,nq],null));t=jN,jN=lj();try{tL(e,"(");var o=YM?YM(e,!0,null,r,i):OM.call(null,e,!0,null,r,i),l=Pc(jN);if(l){var s=pc(A(l));e:{e=1;for(var a=Xc(F);;){if(e>s){var c=Zc(a);break e}r=e+1;var h=(i=Pf).h;l=a;var d=u.h(jN,e),f=n(d)?d:kN(e),p=h.call(i,l,f);e=r,a=p}}var g=n(jN.call(null,-1))?re.l(c,hl,D([jN.call(null,-1)])):c}else g=F;return new se(null,wl,new se(null,g,new se(null,o,null,1,null),2,null),3,null)}finally{jN=t}}function mN(e){if(n(jN)){var t=jN.call(null,e);return n(t)||(t=kN(e),jN=I.j(jN,e,t)),t}throw cl("Arg literal not in #()",new k(null,1,[X,nq],null))}function nN(e,t,n,r){if(null==jN)return VM(e,t);if(kL(t=e.Bc(null))||vM(t)||null==t)return mN(1);if(x.h(t,"&"))return e.Ca(null),mN(-1);if(Se(e=YM?YM(e,!0,null,n,r):OM.call(null,e,!0,null,n,r)))return mN(e);throw cl("Arg literal must be %, %& or %integer",new k(null,1,[X,nq],null))}var oN=null;function pN(e,t,r,i){return n(t=e.Bc(null))?x.h("@",t)?(t=XM(RE),e.Ca(null),e=t(e,"@",r,i)):e=XM(cD)(e,"~",r,i):e=null,e}function qN(e){e=z(e);for(var t=Xc(F);;){if(!e)return z(Zc(t));var n=A(e);e=B(e),t=Pf.h(Pf.h(t,pc(n)),qc(n))}}function rN(e){if(yb(oN))throw cl("Gensym literal not in syntax-quote",new k(null,1,[X,nq],null));var t=u.h(oN,e);return n(t)||(t=Bd.g([sf(Cf(e),0,Cf(e).length-1),"__",p.g(Ig.h(nL,Rd)),"__auto__"].join("")),oN=I.j(oN,e,t)),t}function sN(e,t){return((n=null!=e&&!!(262144&e.B||cb===e.Me))?z(we.l(Ae(e),cw,D([rs,MG,so,CD,$s]))):n)?new se(null,Rx,new se(null,t,new se(null,function(){var t=Ae(e);return tN.g?tN.g(t):tN.call(null,t)}(),null,1,null),2,null),3,null):t;var n}function uN(e,t){e:{t=z(t);for(var r=Xc(F);;){if(!t){t=z(Zc(r));break e}var i=A(t);r=Pf.h(r,Qe(i)&&x.h(A(i),cD)?new se(null,Kq,new se(null,oe(i),null,1,null),2,null):Qe(i)&&x.h(A(i),RE)?oe(i):new se(null,Kq,new se(null,tN.g?tN.g(i):tN.call(null,i),null,1,null),2,null)),t=B(t)}}return t=new se(null,Ep,new se(null,ke(wy,t),null,1,null),2,null),n(e)?new se(null,Rz,new se(null,e,new se(null,t,null,1,null),2,null),3,null):t}function vN(e){throw cl("resolve-symbol is not implemented",new k(null,1,[GA,e],null))}function tN(e){if(gl(e))var t=new se(null,Bl,new se(null,e,null,1,null),2,null);else if(e instanceof Ad)t=new se(null,Bl,new se(null,n((r=yb(zf(e)))?Ea(Cf(e),"#"):r)?rN(e):function(){var t=p.g(e);return n(Ea(t,"."))?(t=Bd.g(t.substring(0,t.length-1)),Bd.g([p.g(vN.call(null,t)),"."].join(""))):vN.call(null,e)}(),null,1,null),2,null);else if(Qe(e)&&x.h(A(e),cD))t=oe(e);else{if(Qe(e)&&x.h(A(e),RE))throw cl("unquote-splice not in list",new k(null,1,[X,nq],null));if(Fe(e))if(null!=e&&(67108864&e.B||cb===e.Lg))t=e;else if(J(e))t=uN(16<=C(e)?JE:MD,qN(e));else if(Le(e))t=new se(null,ru,new se(null,uN(null,e),null,1,null),2,null);else if(Ge(e))t=uN(nv,e);else{if(!Qe(e)&&!tf(e))throw cl("Unknown Collection type",new k(null,1,[X,rF],null));t=function(){var t=z(e);return t?uN(null,t):N(Tx)}()}else t=e instanceof w||"number"==typeof e||"string"==typeof e||null==e||e instanceof Boolean||!0===e||!1===e||e instanceof RegExp?e:new se(null,Bl,new se(null,e,null,1,null),2,null)}var r;return sN(e,t)}function wN(e,t,n,r){t=oN,oN=P;try{return tN(YM?YM(e,!0,null,n,r):OM.call(null,e,!0,null,n,r))}finally{oN=t}}function xN(e,t,i,o){var l=HM(e);t=G(l,0,null),l=G(l,1,null);var s,a=xM(e,oG,rL(e)),c=x.h(a,":")?null.name:x.h(":",A(a))?function(){var e=null==a?null:a.substring(1);if(null==(e=null==(e=null==(e=null==e?null:sM(e))?null:pL(e))?null:Bd.g(e)))e=null;else{var t=u.h(null,e);if(n(t))e=t;else{if(null==Ml&&(Ml=Fg(P)),null!=(t=u.h(r(Ml),e)))e=t;else{t=p.g(e);for(var i=p.g(t),o=new Za,l=0;l<i.length;){var s=i.charAt(l),c=Ia(Ib,s);null!=c?o.append(c):o.append(s),l+=1}i=".."===(i=o.toString())?"_DOT__DOT_":n(Il(i))?[i,"$"].join(""):i;e:for(t=(t instanceof Ad?Bd.g(i):i).split("."),i=aa;;){if(null==i){t=null;break e}if(null==t){t=i;break e}i=Ia(i,A(t)),t=B(t)}null==t?e=null:(t=new Ll(e),Ig.F(Ml,I,e,t),e=t)}e=n(e)?Bd.g(e.name):null}}return e}():null==(s=null==a?null:sM(a))?null:pL(s);if(n(c)){if("{"===mM(e)){o=MM(oG,"}",e,i,o);var h=IM(e);return i=G(h,0,null),h=G(h,1,null),!wg(C(o))&&NL(e,null,null,o),c=oL(p.g(c),Lj(2,o)),o=Lj(2,Hd(o)),x.h(C(yj(c)),C(c))||kM(e,oG,c),ze(Bj(c,o),n(t)?pj.l(D([function(){var t=wL(e);return n(t)?new k(null,1,[CD,t],null):null}(),new k(null,4,[cw,t,rs,l,MG,i,so,h],null)])):null)}return fM(e,a)}return gM(e,a)}function FM(e){switch(e){case'"':return UM;case":":return WM;case";":return tM;case"'":return XM(Bl);case"@":return XM(lB);case"^":return ZM;case"`":return wN;case"~":return pN;case"(":return PM;case")":case"]":case"}":return BM;case"[":return QM;case"{":return RM;case"\\":return GM;case"%":return nN;case"#":return yM;default:return null}}function zM(e){switch(e){case"^":return ZM;case"'":return XM(Al);case"(":return lN;case"{":return $M;case"<":return uM("Unreadable form");case"=":return uM("read-eval not supported");case'"':return CM;case"!":return tM;case"_":return aN;case"?":return iN;case":":return xN;case"#":return bN;default:return null}}function AM(e,t,r,i){if((t=YM?YM(e,!0,null,r,i):OM.call(null,e,!0,null,r,i))instanceof Ad||hM(e,t),n(fN))return new Fl(t,e=YM?YM(e,!0,null,r,i):OM.call(null,e,!0,null,r,i));var o=P.call(null,t);return o=n(o)?o:P.g?P.g(t):P.call(null,t),n(o)?(t=YM?YM(e,!0,null,r,i):OM.call(null,e,!0,null,r,i),o.g?o.g(t):o.call(null,t)):n(yN)?(o=yN,e=YM?YM(e,!0,null,r,i):OM.call(null,e,!0,null,r,i),o.h?o.h(t,e):o.call(null,t,e)):iM(e,t)}var yN=null,fN=!1;function OM(e){switch(arguments.length){case 5:return YM(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);case 6:return NM(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function YM(e,t,n,r,i){return NM(e,t,n,null,r,i)}function NM(e,t,n,r,i,o){try{e:for(;;){if(0!=o.length){var l=o[0];Array.prototype.splice.call(o,0,1),a=l;break e}var s=e.Ca(null);if(!kL(s)){if(null==s){var a=t?lM(e,null):n;break e}if(s===r){a=KM;break e}if(lL(s)||("+"===s||"-"===s)&&lL(e.Bc(null))){a=SM(e,s);break e}var u=FM(s);if(null==u){a=VM(e,s);break e}var c=u.F?u.F(e,s,i,o):u.call(null,e,s,i,o);if(c!==e){a=c;break e}}}return a}catch(r){if(r instanceof Error){if((t=r)instanceof bl){if(n=el(t),x.h(Yl,X.g(n)))throw t;throw dl(t.message,pj.l(D([new k(null,1,[X,Yl],null),n,zL(e)?new k(null,3,[cw,e.Jd(null),rs,e.Id(null),CD,e.Re(null)],null):null])),t)}throw dl(t.message,pj.l(D([new k(null,1,[X,Yl],null),zL(e)?new k(null,3,[cw,e.Jd(null),rs,e.Id(null),CD,e.Re(null)],null):null])),t)}throw r}}var zN=Zk;function AN(e,t){var r=zN;if(x.h(!0,r))return yJ(e);if(x.h(!1,r))return xJ(e);if(x.h(Zk,r))return n(t)?yJ(e):xJ(e);throw Error(["No matching clause: ",p.g(r)].join(""))}var BN=Sj(/'[^'\\]*(?:\\.[^'\\]*)*'/),CN=Sj(/#'[^'\\]*(?:\\.[^'\\]*)*'/),DN=Sj(/"[^"\\]*(?:\\.[^"\\]*)*"/),EN=Sj(/#"[^"\\]*(?:\\.[^"\\]*)*"/),FN=/(?:(?!(?:\(\*|\*\)))[\s\S])*/,GN=Sj("[,\\s]*"),HN=EJ(BJ(hB)),IN=oJ(xx,Ri([xm,az,yA,Ex,Hm,iG,FF,Os,wx,YF,cF,CB,Nn,jt,Cn,Iu,RA,tG,EA,gu,ir,hB,on,BA],[wJ.l(D([EJ(xJ("!")),HN,BJ(tG)])),rJ(wJ.l(D([HN,uJ.l(D([BJ(tG),BJ(iG),BJ(xm)])),HN]))),wJ.l(D([BJ(az),rJ(wJ.l(D([HN,EJ(xJ("/")),HN,BJ(az)])))])),uJ.l(D([xJ(":"),xJ(":="),xJ("::="),xJ("=")])),wJ.l(D([BJ(az),sJ(wJ.l(D([HN,EJ(xJ("|")),HN,BJ(az)])))])),wJ.l(D([EJ(xJ("&")),HN,BJ(tG)])),wJ.l(D([uJ.l(D([BJ(Os),BJ(wx)])),HN,EJ(BJ(Ex)),HN,BJ(Iu),EJ(uJ.l(D([BJ(hB),wJ.l(D([BJ(hB),uJ.l(D([xJ(";"),xJ(".")])),BJ(hB)]))])))])),wJ.l(D([DJ(BJ(ir)),AJ(Sj("[^, \\r\\t\\n<>(){}\\[\\]+*?:=|'\"#&!;./]+"))])),wJ.l(D([EJ(xJ("<")),HN,BJ(Os),HN,EJ(xJ(">"))])),wJ.l(D([AJ(FN),sJ(wJ.l(D([BJ(EA),AJ(FN)])))])),uJ.l(D([wJ.l(D([EJ(xJ("{")),HN,BJ(Iu),HN,EJ(xJ("}"))])),wJ.l(D([BJ(tG),HN,EJ(xJ("*"))]))])),uJ.l(D([AJ(BN),AJ(DN)])),jJ(wJ.l(D([HN,rJ(BJ(FF))]))),wJ.l(D([EJ(xJ("<")),HN,BJ(Iu),HN,EJ(xJ(">"))])),wJ.l(D([EJ(xJ("(")),HN,BJ(Iu),HN,EJ(xJ(")"))])),jJ(uJ.l(D([BJ(Hm),BJ(yA)]))),uJ.l(D([AJ(CN),AJ(EN)])),jJ(uJ.l(D([BJ(Os),BJ(CB),BJ(RA),BJ(BA),BJ(cF),BJ(gu),BJ(Cn),BJ(jt),BJ(ir)]))),wJ.l(D([xJ("(*"),BJ(YF),xJ("*)")])),wJ.l(D([BJ(tG),HN,EJ(xJ("+"))])),uJ.l(D([xJ("Epsilon"),xJ("epsilon"),xJ("EPSILON"),xJ("eps"),xJ("")])),wJ.l(D([AJ(GN),sJ(wJ.l(D([BJ(EA),AJ(GN)])))])),jJ(uJ.l(D([BJ(Nn),BJ(Iu)]))),uJ.l(D([wJ.l(D([EJ(xJ("[")),HN,BJ(Iu),HN,EJ(xJ("]"))])),wJ.l(D([BJ(tG),HN,EJ(xJ("?"))]))]))]));function JN(e){for(var t=z(e),r=F;;){var i=A(t);if(!n(i))return Xf(p,r);switch(i){case"\\":var o=oe(t);if(n(o)){x.h(o,"'")?(t=Pg(2,t),r=re.h(r,o)):(t=Pg(2,t),r=re.l(r,i,D([o])));continue}return fJ(D(["Encountered backslash character at end of string: ",e]));case'"':t=B(t),r=re.l(r,"\\",D(['"']));continue;default:t=B(t),r=re.h(r,i)}}}var KN=r(new Cd((function(){return UM}),ls,Ri([ZE,Rs,Yo,CD,so,rs,cw,MG,oo,KC,wD],[!0,xE,WF,"cljs/tools/reader.cljs",20,1,305,305,N(new Q(null,4,5,S,[ze(Qp,new k(null,1,[Y,Gn],null)),Qt,Om,Yr],null)),null,n(UM)?UM.md:null])));function LN(e){return e=JN(e=sf(e,1,C(e)-1)),e=AL(e=[p.g(e),'"'].join("")),KN.F?KN.F(e,null,null,null):KN.call(null,e,null,null,null)}function MN(e){return Sj(e=JN(e=sf(e,2,C(e)-1)))}var NN=function e(t){for(;;){var n=A.g?A.g(t):A.call(null,t);switch(n=n instanceof w?n.W:null){case"rule":var r=G(n=B.g?B.g(t):B.call(null,t),0,null);return n=G(n,1,null),x.h(A.g?A.g(r):A.call(null,r),wx)?new Q(null,2,5,S,[Bf.g(function(){var e=pe.g?pe.g(r):pe.call(null,r);return pe.g?pe.g(e):pe.call(null,e)}()),jJ(e.g?e.g(n):e.call(null,n))],null):new Q(null,2,5,S,[Bf.g(pe.g?pe.g(r):pe.call(null,r)),e.g?e.g(n):e.call(null,n)],null);case"nt":return BJ(Bf.g(pe.g?pe.g(t):pe.call(null,t)));case"alt":return Xf(uJ,Ng.h(e,B.g?B.g(t):B.call(null,t)));case"ord":return Xf(vJ,Ng.h(e,B.g?B.g(t):B.call(null,t)));case"paren":t=pe.g?pe.g(t):pe.call(null,t);continue;case"hide":return EJ(function(){var n=pe.g?pe.g(t):pe.call(null,t);return e.g?e.g(n):e.call(null,n)}());case"cat":return Xf(wJ,Ng.h(e,B.g?B.g(t):B.call(null,t)));case"string":return AN(LN(pe.g?pe.g(t):pe.call(null,t)),!1);case"regexp":return AJ(MN(pe.g?pe.g(t):pe.call(null,t)));case"opt":return qJ(function(){var n=pe.g?pe.g(t):pe.call(null,t);return e.g?e.g(n):e.call(null,n)}());case"star":return sJ(function(){var n=pe.g?pe.g(t):pe.call(null,t);return e.g?e.g(n):e.call(null,n)}());case"plus":return rJ(function(){var n=pe.g?pe.g(t):pe.call(null,t);return e.g?e.g(n):e.call(null,n)}());case"look":return CJ(function(){var n=pe.g?pe.g(t):pe.call(null,t);return e.g?e.g(n):e.call(null,n)}());case"neg":return DJ(function(){var n=pe.g?pe.g(t):pe.call(null,t);return e.g?e.g(n):e.call(null,n)}());case"epsilon":return pJ;default:throw Error(["No matching clause: ",p.g(n)].join(""))}}},ON=function e(t){for(;;){var n=Y.g(t);switch(n=n instanceof w?n.W:null){case"nt":return new Q(null,1,5,S,[bt.g(t)],null);case"string":case"string-ci":case"char":case"regexp":case"epsilon":return F;case"opt":case"plus":case"star":case"look":case"neg":case"rep":t=Eq.g(t);continue;case"alt":case"cat":return Wg(e,D([Ls.g(t)]));case"ord":return Wg(e,D([new Q(null,2,5,S,[Qr.g(t),Rr.g(t)],null)]));default:throw Error(["No matching clause: ",p.g(n)].join(""))}}};function PN(e){for(var t=yj(di(e)),r=z(zj(Wg(ON,D([ei(e)])))),i=null,o=0,l=0;;)if(l<o){var s=i.$(null,l);n(t.g?t.g(s):t.call(null,s))||fJ(D([rf(p.g(s),1)," occurs on the right-hand side of your grammar, but not on the left"])),l+=1}else{if(!(r=z(r)))break;Me(i=r)?(r=ed(i),l=fd(i),i=r,o=C(r),r=l):(r=A(i),n(t.g?t.g(r):t.call(null,r))||fJ(D([rf(p.g(r),1)," occurs on the right-hand side of your grammar, but not on the left"])),r=B(i),i=null,o=0),l=0}return e}function QN(e,t){var n=ZK(IN,Nn,e,!1);if(n instanceof rK)return fJ(D(["Error parsing grammar specification:\n",function(){var e=new Za,t=fb,r=eb;fb=!0,eb=function(t){return e.append(t)};try{lk(D([n]))}finally{eb=r,fb=t}return p.g(e)}()]));var r=A(A(e=Ng.h(NN,n)));return new k(null,3,[hr,PN(oJ(t,ah.h(P,e))),Bp,r,rv,t],null)}function RN(e,t,n){return null==n?gJ(D(["When you build a parser from a map of parser combinators, you must provide a start production using the :start keyword argument."])):new k(null,3,[hr,PN(oJ(t,e)),Bp,n,rv,t],null)}function SN(e,t){const n=Array.prototype.slice.call(arguments),r=n.shift();if(void 0===r)throw Error("[goog.string.format] Template required");return r.replace(/%([0\- \+]*)(\d+)?(\.(\d+))?([%sfdiu])/g,(function(e,t,r,i,o,l,s,a){if("%"==l)return"%";const u=n.shift();if(void 0===u)throw Error("[goog.string.format] Not enough arguments");return arguments[0]=u,SN.Dc[l].apply(null,arguments)}))}SN.Dc={},SN.Dc.s=function(e,t,n){return isNaN(n)||""==n||e.length>=Number(n)?e:e=-1<t.indexOf("-",0)?e+Xa(" ",Number(n)-e.length):Xa(" ",Number(n)-e.length)+e},SN.Dc.f=function(e,t,n,r,i){let o;return r=e.toString(),isNaN(i)||""==i||(r=parseFloat(e).toFixed(i)),o=0>Number(e)?"-":0<=t.indexOf("+")?"+":0<=t.indexOf(" ")?" ":"",0<=Number(e)&&(r=o+r),isNaN(n)||r.length>=Number(n)||(r=isNaN(i)?Math.abs(Number(e)).toString():Math.abs(Number(e)).toFixed(i),e=Number(n)-r.length-o.length,0<=t.indexOf("-",0)?r=o+r+Xa(" ",e):(t=0<=t.indexOf("0",0)?"0":" ",r=o+Xa(t,e)+r)),r},SN.Dc.d=function(e,t,n,r,i,o,l,s){return SN.Dc.f(parseInt(e,10),t,n,r,0,o,l,s)},SN.Dc.i=SN.Dc.d,SN.Dc.u=SN.Dc.d;var TN=Ri([$z,Ju,vt,sy,Gw,Lz,uz,qC,MB,fq,Dx,Sw,Go,Xp,Aq,Qx],[xJ("\r\n"),xJ("\t"),uJ.l(D([uJ.l(D([xJ(" "),xJ("\t")])),sJ(wJ.l(D([xJ("\r\n"),uJ.l(D([xJ(" "),xJ("\t")]))])))])),xJ("\n"),AJ("[\\u0021-\\u007E]"),AJ("[0-9]"),xJ(" "),AJ("[0-9a-fA-F]"),AJ("[\\u0000-\\u001F|\\u007F]"),xJ('"'),uJ.l(D([xJ(" "),xJ("\t")])),xJ("\r"),AJ("[\\u0000-\\u00FF]"),AJ("[a-zA-Z]"),AJ("[\\u0001-\\u007F]"),AJ("[01]")]),UN=Ri([xm,Es,Hu,bu,av,Nr,iG,Tl,FF,gs,Lz,Oz,Iq,Jn,jt,ax,qC,vC,YE,zz,rA,px,fA,Br,RA,FB,jE,Js,hB,as,iu,MC,on],[new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"!"],null),new se(null,new k(null,2,[Y,Os,bt,hB],null),null,1,null),2,null),jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,av],null),null,1,null),2,null),Qn,new k(null,2,[Xv,xx,gB,xm],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"("],null),new se(null,new k(null,2,[Y,Os,bt,hB],null),null,1,null),2,null),jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,Br],null),new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,hB],null),new se(null,new k(null,2,[Y,CB,CB,")"],null),null,1,null),2,null),jt,!0],null),null,1,null),2,null),3,null),Qn,new k(null,1,[Xv,Co],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"<"],null),new se(null,new k(null,2,[Y,Os,bt,hB],null),null,1,null),2,null),jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,jE],null),new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,hB],null),new se(null,new k(null,2,[Y,CB,CB,">"],null),null,1,null),2,null),jt,!0],null),null,1,null),2,null),3,null),Qn,new k(null,1,[Xv,Co],null)],null),pj.l(D([AJ("\\s+(?:;.*?\\u000D?\\u000A\\s*)*"),new k(null,1,[Qn,new k(null,2,[Xv,xx,gB,bu],null)],null)])),new k(null,3,[Y,Hm,Ls,new se(null,new k(null,2,[Y,Os,bt,gs],null),new se(null,new k(null,2,[Y,Os,bt,Es],null),new se(null,new k(null,2,[Y,Os,bt,jt],null),new se(null,new k(null,2,[Y,Os,bt,vC],null),new se(null,new k(null,2,[Y,Os,bt,Iq],null),new se(null,new k(null,2,[Y,Os,bt,Jn],null),new se(null,new k(null,2,[Y,Os,bt,iG],null),new se(null,new k(null,2,[Y,Os,bt,xm],null),new se(null,new k(null,2,[Y,Os,bt,RA],null),null,1,null),2,null),3,null),4,null),5,null),6,null),7,null),8,null),9,null),Qn,new k(null,1,[Xv,Co],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,Hu],null),new se(null,new k(null,3,[Y,Os,bt,ax,jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,Br],null),new se(null,new k(null,3,[Y,Os,bt,hB,jt,!0],null),null,1,null),2,null),3,null),4,null),Qn,new k(null,2,[Xv,xx,gB,Nr],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"&"],null),new se(null,new k(null,2,[Y,Os,bt,hB],null),null,1,null),2,null),jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,av],null),null,1,null),2,null),Qn,new k(null,2,[Xv,xx,gB,iG],null)],null),new k(null,3,[Y,gu,Eq,new k(null,2,[Y,Hm,Ls,new se(null,new k(null,2,[Y,CB,CB,"0"],null),new se(null,new k(null,2,[Y,CB,CB,"1"],null),null,1,null),2,null)],null),Qn,new k(null,2,[Xv,xx,gB,Tl],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,jE],null),new se(null,new k(null,3,[Y,Os,bt,ax,jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,Br],null),new se(null,new k(null,3,[Y,Os,bt,hB,jt,!0],null),null,1,null),2,null),3,null),4,null),Qn,new k(null,2,[Xv,xx,gB,FF],null)],null),new k(null,3,[Y,Os,bt,zz,Qn,new k(null,2,[Xv,xx,gB,gs],null)],null),pj.l(D([AJ("[0-9]"),new k(null,1,[Qn,new k(null,1,[Xv,Co],null)],null)])),new k(null,3,[Y,gu,Eq,new k(null,2,[Y,Os,bt,Lz],null),Qn,new k(null,2,[Xv,xx,gB,Oz],null)],null),new k(null,3,[Y,Hm,Ls,new se(null,new k(null,2,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,'"',jt,!0],null),new se(null,new k(null,2,[Y,cF,Eq,pj.l(D([AJ("[\\u0020-\\u0021\\u0023-\\u007E]"),P]))],null),new se(null,new k(null,3,[Y,CB,CB,'"',jt,!0],null),null,1,null),2,null),3,null)],null),new se(null,new k(null,2,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,"'",jt,!0],null),new se(null,new k(null,2,[Y,cF,Eq,pj.l(D([AJ("[\\u0020-\\u0026(-~]"),P]))],null),new se(null,new k(null,3,[Y,CB,CB,"'",jt,!0],null),null,1,null),2,null),3,null)],null),null,1,null),2,null),Qn,new k(null,2,[Xv,xx,gB,Iq],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,"%",jt,!0],null),new se(null,new k(null,2,[Y,Hm,Ls,new se(null,new k(null,2,[Y,Os,bt,rA],null),new se(null,new k(null,2,[Y,Os,bt,px],null),new se(null,new k(null,2,[Y,Os,bt,iu],null),null,1,null),2,null),3,null)],null),null,1,null),2,null),Qn,new k(null,1,[Xv,Co],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"<"],null),new se(null,new k(null,2,[Y,Os,bt,hB],null),null,1,null),2,null),jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,Br],null),new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,hB],null),new se(null,new k(null,2,[Y,CB,CB,">"],null),null,1,null),2,null),jt,!0],null),null,1,null),2,null),3,null),Qn,new k(null,2,[Xv,xx,gB,jt],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,Os,bt,hB,jt,!0],null),new se(null,new k(null,2,[Y,Hm,Ls,new se(null,new k(null,2,[Y,CB,CB,"="],null),new se(null,new k(null,2,[Y,CB,CB,"=/"],null),null,1,null),2,null)],null),new se(null,new k(null,3,[Y,Os,bt,hB,jt,!0],null),null,1,null),2,null),3,null),Qn,new k(null,2,[Xv,xx,gB,ax],null)],null),pj.l(D([AJ("[0-9a-fA-F]"),new k(null,1,[Qn,new k(null,1,[Xv,Co],null)],null)])),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"["],null),new se(null,new k(null,2,[Y,Os,bt,hB],null),null,1,null),2,null),jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,Br],null),new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,hB],null),new se(null,new k(null,2,[Y,CB,CB,"]"],null),null,1,null),2,null),jt,!0],null),null,1,null),2,null),3,null),Qn,new k(null,2,[Xv,xx,gB,vC],null)],null),new k(null,3,[Y,gu,Eq,new k(null,2,[Y,Os,bt,qC],null),Qn,new k(null,2,[Xv,xx,gB,YE],null)],null),pj.l(D([AJ("[a-zA-Z][-a-zA-Z0-9]*"),new k(null,1,[Qn,new k(null,1,[Xv,Co],null)],null)])),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,"b",jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,Tl],null),new se(null,new k(null,2,[Y,BA,Eq,new k(null,2,[Y,Hm,Ls,new se(null,new k(null,2,[Y,gu,Eq,new k(null,2,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,".",jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,Tl],null),null,1,null),2,null)],null)],null),new se(null,new k(null,2,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"-"],null),new se(null,new k(null,2,[Y,Os,bt,Tl],null),null,1,null),2,null)],null),null,1,null),2,null)],null)],null),null,1,null),2,null),3,null),Qn,new k(null,2,[Xv,xx,gB,rA],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,"d",jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,MC],null),new se(null,new k(null,2,[Y,BA,Eq,new k(null,2,[Y,Hm,Ls,new se(null,new k(null,2,[Y,gu,Eq,new k(null,2,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,".",jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,MC],null),null,1,null),2,null)],null)],null),new se(null,new k(null,2,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"-"],null),new se(null,new k(null,2,[Y,Os,bt,MC],null),null,1,null),2,null)],null),null,1,null),2,null)],null)],null),null,1,null),2,null),3,null),Qn,new k(null,2,[Xv,xx,gB,px],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,FB],null),new se(null,new k(null,2,[Y,cF,Eq,new k(null,2,[Y,az,Ls,new se(null,new k(null,3,[Y,Os,bt,bu,jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,FB],null),null,1,null),2,null)],null)],null),null,1,null),2,null),Qn,new k(null,2,[Xv,xx,gB,fA],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,fA],null),new se(null,new k(null,2,[Y,cF,Eq,new k(null,2,[Y,az,Ls,new se(null,new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,Os,bt,hB],null),new se(null,new k(null,2,[Y,CB,CB,"/"],null),new se(null,new k(null,2,[Y,Os,bt,hB],null),null,1,null),2,null),3,null),jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,fA],null),null,1,null),2,null)],null)],null),null,1,null),2,null),Qn,new k(null,2,[Xv,xx,gB,Br],null)],null),new k(null,3,[Y,Hm,Ls,new se(null,pj.l(D([AJ("#'[^'\\\\]*(?:\\\\.[^'\\\\]*)*'"),P])),new se(null,pj.l(D([AJ('#\\"[^\\"\\\\]*(?:\\\\.[^\\"\\\\]*)*\\"'),P])),null,1,null),2,null),Qn,new k(null,2,[Xv,xx,gB,RA],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,2,[Y,BA,Eq,new k(null,2,[Y,Os,bt,as],null)],null),new se(null,new k(null,3,[Y,Os,bt,hB,jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,av],null),null,1,null),2,null),3,null),Qn,new k(null,2,[Xv,xx,gB,FB],null)],null),new k(null,3,[Y,Os,bt,zz,Qn,new k(null,2,[Xv,xx,gB,jE],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,Os,bt,hB,jt,!0],null),new se(null,new k(null,2,[Y,gu,Eq,new k(null,2,[Y,Hm,Ls,new se(null,new k(null,2,[Y,Os,bt,FF],null),new se(null,new k(null,2,[Y,Os,bt,Nr],null),null,1,null),2,null)],null)],null),null,1,null),2,null),Qn,new k(null,1,[Xv,Co],null)],null),pj.l(D([AJ("\\s*(?:;.*?(?:\\u000D?\\u000A\\s*|$))*"),new k(null,1,[Qn,new k(null,2,[Xv,xx,gB,hB],null)],null)])),new k(null,3,[Y,Hm,Ls,new se(null,new k(null,2,[Y,Os,bt,Oz],null),new se(null,new k(null,2,[Y,az,Ls,new se(null,new k(null,2,[Y,BA,Eq,new k(null,2,[Y,Os,bt,Oz],null)],null),new se(null,new k(null,2,[Y,CB,CB,"*"],null),new se(null,new k(null,2,[Y,BA,Eq,new k(null,2,[Y,Os,bt,Oz],null)],null),null,1,null),2,null),3,null)],null),null,1,null),2,null),Qn,new k(null,2,[Xv,xx,gB,as],null)],null),new k(null,3,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,"x",jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,YE],null),new se(null,new k(null,2,[Y,BA,Eq,new k(null,2,[Y,Hm,Ls,new se(null,new k(null,2,[Y,gu,Eq,new k(null,2,[Y,az,Ls,new se(null,new k(null,3,[Y,CB,CB,".",jt,!0],null),new se(null,new k(null,2,[Y,Os,bt,YE],null),null,1,null),2,null)],null)],null),new se(null,new k(null,2,[Y,az,Ls,new se(null,new k(null,2,[Y,CB,CB,"-"],null),new se(null,new k(null,2,[Y,Os,bt,YE],null),null,1,null),2,null)],null),null,1,null),2,null)],null)],null),null,1,null),2,null),3,null),Qn,new k(null,2,[Xv,xx,gB,iu],null)],null),new k(null,3,[Y,gu,Eq,new k(null,2,[Y,Os,bt,Lz],null),Qn,new k(null,2,[Xv,xx,gB,MC],null)],null),new k(null,3,[Y,Hm,Ls,new se(null,new k(null,2,[Y,Os,bt,Js],null),new se(null,new k(null,2,[Y,Os,bt,Br],null),null,1,null),2,null),Qn,new k(null,1,[Xv,Co],null)],null)]),VN=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};function WN(e,t){return ah.h(P,function t(n){return new Df(null,(function(){for(var r=n;;){if(!(r=z(r)))return null;if(Me(r)){var i=ed(r),o=C(i),l=Hf(o);e:for(var s=0;;){if(!(s<o)){i=!0;break e}var a=Zb(i,s);M(e,a)&&(a=new Q(null,2,5,S,[a,e.g?e.g(a):e.call(null,a)],null),l.add(a)),s+=1}return Jf(Lf(l),i?t(fd(r)):null)}if(l=A(r),M(e,l))return ke(new Q(null,2,5,S,[l,e.g?e.g(l):e.call(null,l)],null),t(Hd(r)));r=Hd(r)}}),null,null)}(t))}function XN(e){return pj.l(D([WN(TN,zj(Wg(ON,D([ei(e)])))),e]))}function YN(e,t){var n=x.h(Qn.g(e),kJ),r=x.h(Qn.g(t),kJ);return n&&r?jJ(uJ.l(D([we.h(e,Qn),we.h(t,Qn)]))):n?jJ(uJ.l(D([we.h(e,Qn),t]))):r?jJ(uJ.l(D([e,we.h(t,Qn)]))):uJ.l(D([e,t]))}VN.l=function(e){if(x.h("-",oe(e))){var t=G(e,0,null);return G(e,1,null),zJ(t,G(e,2,null))}return Xf(wJ,function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var r=ed(n),i=C(r),o=Hf(i);e:for(var l=0;;){if(!(l<i)){r=!0;break e}var s=Zb(r,l);o.add(zJ(s,s)),l+=1}return Jf(Lf(o),r?e(fd(n)):null)}return ke(zJ(o=A(n),o),e(Hd(n)))}return null}}),null,null)}(e))},VN.I=0,VN.J=function(e){return this.l(z(e))};var ZN=parseInt,$N=Ri([xm,Nr,iG,Tl,FF,gs,Oz,Iq,jt,vC,YE,rA,px,fA,Br,RA,FB,jE,as,iu,MC],[DJ,function(e,t){return ve([e,jJ(t)])},CJ,function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=Xf(p,e),ZN.h?ZN.h(e,2):ZN.call(null,e,2)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}(),jj,function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return n(!1)?BJ(Bf.g(Xf(p,e).toUpperCase())):BJ(Bf.g(Xf(p,e)))}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}(),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=Xf(p,e),ZN.g?ZN.g(e):ZN.call(null,e)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}(),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return AN(Xf(p,e),!0)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}(),EJ,qJ,function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=Xf(p,e),ZN.h?ZN.h(e,16):ZN.call(null,e,16)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}(),VN,VN,wJ,uJ,zg.h(AJ,MN),function(){function e(e,t){return Ee(e)?sJ(t):x.h(C(e),2)?tJ(gF.g(e),$t.g(e),t):x.h(gF.g(e),1)?rJ(t):x.h($t.g(e),1)?qJ(t):tJ(function(){var t=gF.g(e);return n(t)?t:0}(),function(){var t=$t.g(e);return n(t)?t:1/0}(),t)}var t;return t=function(t,n){switch(arguments.length){case 1:return t;case 2:return e.call(this,t,n)}throw Error("Invalid arity: "+arguments.length)},t.g=function(e){return e},t.h=e,t}(),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return n(!1)?Bf.g(Xf(p,e).toUpperCase()):Bf.g(Xf(p,e))}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}(),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){var t=C(e);switch(t){case 1:return x.h(A(e),"*")?P:new k(null,2,[gF,A(e),$t,A(e)],null);case 2:return x.h(A(e),"*")?new k(null,1,[$t,oe(e)],null):new k(null,1,[gF,A(e)],null);case 3:return new k(null,2,[gF,A(e),$t,ee(e,2)],null);default:throw Error(["No matching clause: ",p.g(t)].join(""))}}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}(),VN,function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=Xf(p,e),ZN.g?ZN.g(e):ZN.call(null,e)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}()]);function aO(e,t){var n=ZK(UN,Js,e,!1);if(n instanceof rK)return fJ(D(["Error parsing grammar specification:\n",function(){var e=new Za,t=fb,r=eb;fb=!0,eb=function(t){return e.append(t)};try{lk(D([n]))}finally{eb=r,fb=t}return p.g(e)}()]));var r=cL($N,n);return e=XN(Yf(qj,YN,r)),r=A(A(A(r))),new k(null,3,[hr,PN(oJ(t,e)),Bp,r,rv,t],null)}function bO(e){var t=Ae(e);return e=Dy.g(t),t=wt.g(t),n(n(e)?t:e)?new Q(null,2,5,S,[e,t],null):null}function cO(e){return Le(e)&&x.h(C(e),1)||J(e)&&M(e,Y)&&Ee(u.h(e,en))||Ee(e)}var dO=new rK(null,null,null,null,null),eO=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function fO(e,t,n,r,i){return GK(e=uK(e,n,r,-1,null),new Q(null,2,5,S,[i,t],null),WK(e)),NK(e,null)}function gO(e,t,r,i,o,l){var s=C(r);for(l=z(l);;){if(!l)return null;var a=A(l),u=bO(a);if(G(u,0,null),u=n(u=G(u,1,null))?u:o+C(a),x.h(u,s))return new Q(null,3,5,S,[a,u,null],null);var c=z(fO(e,t,r,i,u));if(c)return new Q(null,3,5,S,[a,u,c],null);l=B(l)}}function hO(e,t,n,r,i){var o=C(n),l=fO(e,t,n,r,i),s=gO(e,t,n,r,i=jf(i),l);for(G(s,0,null),G(s,1,null),G(s,2,null),l=i,i=HI;;){var a=s,u=G(a,0,null);s=G(a,1,null);var c=G(a,2,null);if(null==a||x.h(l,s))return dO;if(null==c)return EK(BI(i,u),new k(null,3,[Ew,RB,Dy,0,wt,o],null));l=jf(s),i=BI(i,u),s=gO(e,t,n,r,s,c)}}function iO(e,t,n,r,i){if(x.h(n,xx))e:{n=C(i);var o=fO(e,t,i,i,0),l=jf(0),s=JI(new Q(null,1,5,S,[r],null));for(G(o=gO(e,t,i,i,l,o),0,null),G(o,1,null),G(o,2,null),r=l,l=s,s=o;;){var a=s,u=G(a,0,null);if(s=G(a,1,null),o=G(a,2,null),null==a||x.h(r,s)){e=dO;break e}if(null==o){e=EK(NI(BI(l,u)),new k(null,3,[Ew,RB,Dy,0,wt,n],null));break e}r=jf(s),l=BI(l,u),s=gO(e,t,i,i,s,o)}}else if(x.h(n,tu))e:for(n=C(i),s=fO(e,t,i,i,0),l=jf(0),o=gO(e,t,i,i,l,s),G(o,0,null),G(o,1,null),G(o,2,null),s=HI;;){var c=o;if(a=G(c,0,null),o=G(c,1,null),u=G(c,2,null),null==c||x.h(l,o)){e=dO;break e}if(null==u){e=EK(new k(null,2,[Y,r,en,z(BI(s,a))],null),new k(null,3,[Ew,RB,Dy,0,wt,n],null));break e}l=jf(o),s=BI(s,a),o=gO(e,t,i,i,o,u)}else e=null;return e}function jO(e,t,r,i,o,l){var s=C(l),a=fO(e,t,l,l,0),u=Ee(a);if(n(t=u||jt.g(t)))return dO;if(a=Yf(Cj,eO,a),t=eO.g(a),e=hO(e,Eq.g(r),l,l,t),s=new k(null,3,[Ew,RB,Dy,0,wt,s],null),e instanceof rK||x.h(Y.g(r),cF)&&cO(e))return dO;switch(i instanceof w?i.W:null){case"enlive":return EK(new k(null,2,[Y,o,en,BI(HI.Qc(null,a),e)],null),s);case"hiccup":return EK(NI(BI(JI(new Q(null,1,5,S,[o],null)).Qc(null,a),e)),s);default:return EK(BI(HI.Qc(null,a),e),s)}}function kO(e,t,r,i,o){var l,s=Ls.g(i),a=qe(s);if(l=x.h(Y.g(i),az)){l=Y.g(a);var u=new uj(null,new k(null,2,[cF,null,gu,null],null),null);l=n(l=u.g?u.g(l):u.call(null,l))?yb(jt.g(a))&&yb(jt.g(Eq.g(a))):l}return yb(l)?dO:(s=Xf(wJ,Aj(s)),x.h(Qn.g(i),kJ)?jO(e,s,a,null,r,t):jO(e,s,a,o,r,t))}function lO(e,t,n){var r=hr.g(e);e=rv.g(e);var i=u.h(r,n);return x.h(jt.g(i),!0)?dO:x.h(Qn.g(i),kJ)?x.h(Y.g(i),cF)?hO(r,n=Eq.g(i),t,t,0):x.h(Y.g(i),gu)?cO(t=hO(r,n=Eq.g(i),t,t,0))?dO:t:kO(r,t,n,i,e):x.h(Y.g(i),cF)?iO(r,Eq.g(i),e,n,t):x.h(Y.g(i),gu)?cO(t=iO(r,Eq.g(i),e,n,t))?dO:t:kO(r,t,n,i,e)}function mO(e,t){if(x.h(null,t))return e;if(x.h(en,t))return I.j(e,hr,GJ(hr.g(e)));if(x.h(PC,t))return I.j(e,hr,HJ(rv.g(e),hr.g(e)));if(x.h(Fm,t))return I.j(e,hr,IJ(rv.g(e),hr.g(e)));throw Error(["No matching clause: ",p.g(t)].join(""))}eO.g=function(e){var t=bO(e);return G(t,0,null),n(t=G(t,1,null))?jf(t):C(e)},eO.h=function(e,t){var r=bO(e);return G(r,0,null),n(r=G(r,1,null))?jf(r):t+C(e)},eO.I=2;var nO=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],2<n.length?new Fd(n.slice(2),0,null):null)};function pO(e,t,n,r,i,o){this.ta=e,this.mc=t,this.qc=n,this.D=r,this.m=i,this.G=o,this.B=2230716171,this.M=139264}function qO(e){var t=we.l(e,hr,D([Bp,rv]));return t=Ke(e)?ah.h(P,t):t,new pO(hr.g(e),Bp.g(e),rv.g(e),null,dg(t),null)}function rO(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;return sO(arguments[0],1<t.length?new Fd(t.slice(1),0,null):null)}function sO(e,t){var r,i=bg(t),o=u.j(i,Kp,QG),l=u.j(i,rv,xx),s=u.j(i,Ku,null);t="string"==typeof e?function(){e:{var t=zN;zN=Hr.h(i,Zk);try{var r=o instanceof w?o.W:null;switch(r){case"abnf":var a=aO(e,l);break e;case"ebnf":a=QN(e,l);break e;default:throw Error(["No matching clause: ",p.g(r)].join(""))}}finally{zN=t}a=void 0}return n(s)?qO(I.j(a,Bp,s)):qO(a)}():J(e)?qO(RN(e,l,s)):Le(e)?(r=n(s)?s:e.g?e.g(0):e.call(null,0),qO(r=RN(Xf(jj,e),l,r))):gJ(D(["Expected string, map, or vector as grammar specification, got ",hk.l(D([e]))]));var a=u.h(i,HA);if(n(a=a instanceof w?u.h(tO,a):a)){var c=bg(a);return a=u.h(c,hr),c=u.h(c,Bp),I.j(t,hr,KJ(t.ta,t.mc,a,c))}return t}function oO(e){return e instanceof sK||Ae(e)instanceof sK}nO.l=function(e,t,r){var i=bg(r);r=u.j(i,Ku,Bp.g(e));var o=u.j(i,It,!1),l=u.j(i,Ew,!1),s=u.h(i,Dv);return u.j(i,Cy,!1),e=mO(e,s),n(IG.g(i))?(l=hr.g(e),e=rv.g(e),i=mJ.g?mJ.g(e):mJ.call(null,e),(e=ZK(l,r,t,o))instanceof rK?(YK(l=uK(l,t,t,s=Gm.g(e),i),BJ(r),o),n(o=NK(l,null))?t=A(o):(o=LK(i,LG,t,0,C(t)),t=LK(i,r,o,0,C(t))),t=ze(t,pj.l(D([e,Ae(t)])))):t=e,t):n(n(l)?yb(o):l)?(i=lO(e,t,r),n(oO.g?oO.g(i):oO.call(null,i))?ZK(hr.g(e),r,t,o):i):ZK(hr.g(e),r,t,o)},nO.I=2,nO.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)},h=pO.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"grammar":return this.ta;case"start-production":return this.mc;case"output-format":return this.qc;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#instaparse.core.Parser{",", ","}",n,Of.h(new Q(null,3,5,S,[new Q(null,2,5,S,[hr,this.ta],null),new Q(null,2,5,S,[Bp,this.mc],null),new Q(null,2,5,S,[rv,this.qc],null)],null),this.m))},h.xa=function(){return new Yh(this,3,new Q(null,3,5,S,[hr,Bp,rv],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 3+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-360509877^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.ta,t.ta)&&x.h(this.mc,t.mc)&&x.h(this.qc,t.qc)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,3,[Bp,null,hr,null,rv,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new pO(this.ta,this.mc,this.qc,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"grammar":case"start-production":case"output-format":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(hr,t):O.call(null,hr,t))?new pO(r,this.mc,this.qc,this.D,this.m,null):n(O.h?O.h(Bp,t):O.call(null,Bp,t))?new pO(this.ta,r,this.qc,this.D,this.m,null):n(O.h?O.h(rv,t):O.call(null,rv,t))?new pO(this.ta,this.mc,r,this.D,this.m,null):new pO(this.ta,this.mc,this.qc,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,3,5,S,[new xh(hr,this.ta),new xh(Bp,this.mc),new xh(rv,this.qc)],null),this.m))},h.S=function(e,t){return new pO(this.ta,this.mc,this.qc,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h.call=function(e){switch(arguments.length-1){case 1:return this.g(arguments[1]);case 3:return this.j(arguments[1],arguments[2],arguments[3]);case 5:return this.O(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 7:return this.lb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]);case 9:return this.ab(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9]);case 11:return this.gb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11]);case 13:return this.hb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13]);case 15:return this.ib(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15]);case 17:return this.jb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17]);case 19:return this.kb(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19]);case 21:return this.Sc(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15],arguments[16],arguments[17],arguments[18],arguments[19],arguments[20],arguments[21]);default:throw Error(["Invalid arity: ",p.g(arguments.length-1)].join(""))}},h.apply=function(e,t){return this.call.apply(this,[this].concat(Lb(t)))},h.g=function(e){return nO(this,e)},h.j=function(e,t,n){return nO.l(this,e,D([t,n]))},h.O=function(e,t,n,r,i){return nO.l(this,e,D([t,n,r,i]))},h.lb=function(e,t,n,r,i,o,l){return nO.l(this,e,D([t,n,r,i,o,l]))},h.ab=function(e,t,n,r,i,o,l,s,a){return nO.l(this,e,D([t,n,r,i,o,l,s,a]))},h.gb=function(e,t,n,r,i,o,l,s,a,u,c){return nO.l(this,e,D([t,n,r,i,o,l,s,a,u,c]))},h.hb=function(e,t,n,r,i,o,l,s,a,u,c,h,d){return nO.l(this,e,D([t,n,r,i,o,l,s,a,u,c,h,d]))},h.ib=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p){return nO.l(this,e,D([t,n,r,i,o,l,s,a,u,c,h,d,f,p]))},h.jb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w){return nO.l(this,e,D([t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w]))},h.kb=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w){return nO.l(this,e,D([t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w]))},h.Sc=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b){return ag(nO,this,e,t,n,D([r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b]))},h.pa=cb,h.U=function(e,t){return Qc(t,cJ(this))};var tO=new k(null,2,[LF,rO("whitespace = #'\\s+'"),ju,rO("whitespace = #'[,\\s]+'")],null);function uO(e){var t="#"!==e;return t&&(t="'"!==e)&&(t=":"!==e)?vO.g?vO.g(e):vO.call(null,e):t}function wO(e){return"@"===e||"`"===e||"~"===e}function xO(e,t,r,i){if(yb(r))return RL(e,t);if(n(n(i)?wO(r):i))return SL(e,t,r);for(i=new Za,tL(e,r);;){if(kL(r)||uO(r)||null==r)return p.g(i);if(wO(r))return SL(e,t,r);i.append(rL(e)),r=sL(e)}}function yO(e,t,r){if(n(t=rL(e))){var i=zO.g?zO.g(t):zO.call(null,t);return n(i)?i.j?i.j(e,t,r):i.call(null,e,t,r):(tL(e,t),AO.j?AO.j(e,t,r):AO.call(null,e,t,r))}return TL(e)}function BO(e,t){return JL(e,D(["Unmatched delimiter ",t,"."]))}function CO(e,t,n){t=1+t,C(e)!==t&&OL(e);for(var r=1,i=0;;){if(r===t)return String.fromCharCode(i);var o=qL(ee(e,r),n);if(-1===o)return VL(ee(e,r),e);i=o+i*n,r+=1}}function DO(e,t,r,i,o){for(var l=1,s=qL(t,r);;){if(-1===s)return WL(e,t);if(l===i)return String.fromCharCode(s);var a=sL(e),u=kL(a);if(u||(u=n(u=vO.g?vO.g(a):vO.call(null,a))?u:null==a),n(u))return n(o)?XL(e,l,i):String.fromCharCode(s);if(u=qL(a,r),rL(e),-1===u)return WL(e,a);s=u+s*r,l+=1}}function EO(e){var t=rL(e);if(null!=t){var r=(t=uO(t)||wO(t)||kL(t)?p.g(t):xO(e,aG,t,!1)).length;return 1===r?ee(t,0):"newline"===t?"\n":"space"===t?" ":"tab"===t?"\t":"backspace"===t?"\b":"formfeed"===t?"\f":"return"===t?"\r":n(0==t.lastIndexOf("u",0))?55295<(r=(t=CO(t,4,16)).charCodeAt())&&57344>r?YL(e,r.toString(16)):t:n(0==t.lastIndexOf("o",0))?3<--r?ZL(e,t):255<(0|(t=CO(t,r,8)))?$L(e):t:JL(e,D(["Unsupported character: ",t,"."]))}return aM(e)}function FO(e){return zL(e)?new Q(null,2,5,S,[uL(e),(0|vL(e))-1|0],null):null}function GO(e,t,r,i){var o=FO(r),l=G(o,0,null);o=G(o,1,null),t=gL(t);for(var s=Xc(F);;){var a=mM(r);if(n(a)||ML(r,e,l,o,C(s)),x.h(t,gL(a)))return Zc(s);var u=vO.g?vO.g(a):vO.call(null,a);n(u)?s=(a=u.j?u.j(r,a,i):u.call(null,r,a,i))!==r?Pf.h(s,a):s:(tL(r,a),s=(a=HO?HO(r,!0,null,i):IO.call(null,r,!0,null,i))!==r?Pf.h(s,a):s)}}function JO(e,t,n){return Ee(e=GO(Xx,")",e,n))?Id:Xf(N,e)}function KO(e,t,n){return GO(hA,"]",e,n)}function LO(e,t,n){var r=FO(e);t=G(r,0,null),r=G(r,1,null);var i=C(n=GO(BC,"}",e,n)),o=Lj(2,n),l=yj(o);return!wg(i)&&NL(e,t,r,n),x.h(C(l),C(o))||kM(e,BC,o),i<=2*gi?ii(Ye(n)):Qi(Ye(n))}function MO(e,t){for(var r=function(){var e=new Za;return e.append(t),e}(),i=rL(e);;){if(n(function(){var e=kL(i);return e||(n(e=vO.g?vO.g(i):vO.call(null,i))?e:null==i)}())){var o=p.g(r);tL(e,i);var l=rM(o);return n(l)?l:JL(e,D(["Invalid number: ",o,"."]))}o=function(){var e=r;return e.append(i),e}(),l=rL(e),r=o,i=l}}function NO(e){var t=rL(e);switch(t){case"t":return"\t";case"r":return"\r";case"n":return"\n";case"\\":return"\\";case'"':return'"';case"b":return"\b";case"f":return"\f";case"u":return t=rL(e),-1===parseInt(0|t,16)?PL(e,t):DO(e,t,16,4,!0);default:return lL(t)?255<(0|(t=DO(e,t,8,3,!1)))?$L(e):t:bM(e,t)}}function OO(e){for(var t=new Za,n=rL(e);;){var r=n;if(x.h(null,r))return UL(e,CB,D(['"',t]));if(x.h("\\",r)){o=void 0,(o=t).append(NO(e)),r=o;var i=rL(e);t=r,n=i}else{if(x.h('"',r))return p.g(t);r=function(){var e=t;return e.append(n),e}(),i=rL(e),t=r,n=i}}var o}function PO(e,t){if(!n(t=xO(e,zq,t,!0)))return null;switch(t){case"nil":return null;case"true":return!0;case"false":return!1;case"/":return Ct;default:var r=sM(t);return r=n(r)?Bd.h(r.g?r.g(0):r.call(null,0),r.g?r.g(1):r.call(null,1)):null,n(r)?r:QL(e,zq,t)}}function QO(e){var t=rL(e);if(kL(t))return cM(e);var r=sM(t=xO(e,bt,t,!0));if(n(n(r)?-1===t.indexOf("::"):r)){var i=r.g?r.g(0):r.call(null,0);return r=r.g?r.g(1):r.call(null,1),":"===ee(t,0)?QL(e,bt,[":",p.g(t)].join("")):Bf.h(i,r)}return QL(e,bt,[":",p.g(t)].join(""))}function RO(e,t,n){return J(t=mL(HO?HO(e,!0,null,n):IO.call(null,e,!0,null,n)))||dM(e,t),null!=(n=HO?HO(e,!0,null,n):IO.call(null,e,!0,null,n))&&(131072&n.B||cb===n.zd)?ze(n,pj.l(D([Ae(n),t]))):eM(e,n)}function SO(e,t,n){return n=yj(t=GO(pt,"}",e,n)),x.h(C(t),C(n))||kM(e,pt,t),n}function TO(e){return HO?HO(e,!0,null,!0):IO.call(null,e,!0,null,!0),e}function UO(e,t,r){t=rL(e);var i=null==(t=xO(e,oG,t,!0))?null:sM(t);return n(i=null==i?null:pL(i))?"{"===mM(e)?(!wg(C(r=GO(oG,"}",e,r)))&&NL(e,null,null,r),t=oL(p.g(i),Lj(2,r)),r=Lj(2,Hd(r)),x.h(C(yj(t)),C(t))||kM(e,oG,t),Bj(t,r)):fM(e,t):gM(e,t)}function VO(e,t,n){return t=HO?HO(e,!0,null,n):IO.call(null,e,!0,null,n),x.h(bo,t)?Number.NaN:x.h(kD,t)?Number.NEGATIVE_INFINITY:x.h(Em,t)?Number.POSITIVE_INFINITY:JL(e,D([["Invalid token: ##",p.g(t)].join("")]))}function vO(e){switch(e){case'"':return OO;case":":return QO;case";":return tM;case"^":return RO;case"(":return JO;case")":case"]":case"}":return BO;case"[":return KO;case"{":return LO;case"\\":return EO;case"#":return yO;default:return null}}function zO(e){switch(e){case"^":return RO;case"{":return SO;case"<":return uM("Unreadable form");case"!":return tM;case"_":return TO;case":":return UO;case"#":return VO;default:return null}}function AO(e,t,r){t=HO?HO(e,!0,null,r):IO.call(null,e,!0,null,r);var i=HO?HO(e,!0,null,r):IO.call(null,e,!0,null,r);t instanceof Ad||hM(e,"Reader tag must be a symbol");var o=u.h(LC.g(r),t);return o=n(o)?o:P.g?P.g(t):P.call(null,t),n(o)?o.g?o.g(i):o.call(null,i):n(r=Zk.g(r))?r.h?r.h(t,i):r.call(null,t,i):iM(e,t)}function IO(e){switch(arguments.length){case 1:return WO(P,arguments[0]);case 2:return WO(arguments[0],arguments[1]);case 4:return HO(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function WO(e,t){e=bg(e);var n=u.h(e,qn);return HO(t,!M(e,qn),n,e)}function HO(e,t,r,i){try{for(;;){var o=rL(e);if(!kL(o)){if(null==o)return n(t)?lM(e,null):r;if(lL(o)||("+"===o||"-"===o)&&lL(e.Bc(null)))return MO(e,o);var l=vO(o);if(!n(l))return PO(e,o);var s=l.j?l.j(e,o,i):l.call(null,e,o,i);if(s!==e)return s}}}catch(n){if(n instanceof Error){if((t=n)instanceof bl){if(r=el(t),x.h(Yl,X.g(r)))throw t;throw dl(t.message,pj.l(D([new k(null,1,[X,Yl],null),r,zL(e)?new k(null,3,[cw,uL(e),rs,vL(e),CD,wL(e)],null):null])),t)}throw dl(t.message,pj.l(D([new k(null,1,[X,Yl],null),zL(e)?new k(null,3,[cw,uL(e),rs,vL(e),CD,wL(e)],null):null])),t)}throw n}}function XO(e,t){return n(n(t)?cg.h(t,""):t)?WO(e,AL(t)):null}var YO=function(){var e=new Q(null,13,5,S,[null,31,28,31,30,31,30,31,31,30,31,30,31],null),t=new Q(null,13,5,S,[null,31,29,31,30,31,30,31,31,30,31,30,31],null);return function(r,i){return u.h(n(i)?t:e,r)}}(),ZO=/(\d\d\d\d)(?:-(\d\d)(?:-(\d\d)(?:[T](\d\d)(?::(\d\d)(?::(\d\d)(?:[.](\d+))?)?)?)?)?)?(?:[Z]|([-+])(\d\d):(\d\d))?/;function $O(e){return e=parseInt(e,10),yb(isNaN(e))?e:null}function aP(e,t,n,r){if(!(e<=t&&t<=n))throw Error([p.g(r)," Failed:  ",p.g(e),"<=",p.g(t),"<=",p.g(n)].join(""));return t}function bP(e){var t=Pj(ZO,e);G(t,0,null);var r,i=G(t,1,null),o=G(t,2,null),l=G(t,3,null),s=G(t,4,null),a=G(t,5,null),u=G(t,6,null),c=G(t,7,null),h=G(t,8,null),d=G(t,9,null),f=G(t,10,null);if(yb(t))throw Error(["Unrecognized date/time syntax: ",p.g(e)].join(""));e=$O(i),t=n(r=$O(o))?r:1,i=function(){var e=$O(l);return n(e)?e:1}();var g=function(){var e=$O(s);return n(e)?e:0}(),w=function(){var e=$O(a);return n(e)?e:0}(),m=function(){var e=$O(u);return n(e)?e:0}(),v=function(){e:if(x.h(3,C(c)))var e=c;else if(3<C(c))e=c.substring(0,3);else for(e=new Za(c);;){if(!(3>e.getLength())){e=e.toString();break e}e=e.append("0")}return n(e=$O(e))?e:0}();return h=(x.h(h,"-")?-1:1)*(60*function(){var e=$O(d);return n(e)?e:0}()+function(){var e=$O(f);return n(e)?e:0}()),new Q(null,8,5,S,[e,aP(1,t,12,"timestamp month field must be in range 1..12"),aP(1,i,YO(t,0==(e%4+4)%4&&(0!=(e%100+100)%100||0==(e%400+400)%400)),"timestamp day field must be in range 1..last day in month"),aP(0,g,23,"timestamp hour field must be in range 0..23"),aP(0,w,59,"timestamp minute field must be in range 0..59"),aP(0,m,x.h(w,59)?60:59,"timestamp second field must be in range 0..60"),aP(0,v,999,"timestamp millisecond field must be in range 0..999"),h],null)}var cP=Fg(null),dP=Fg(pj.l(D([new k(null,4,[sp,function(e){if("string"==typeof e){var t=bP(e);if(!n(t))throw Error(["Unrecognized date/time syntax: ",p.g(e)].join(""));e=G(t,0,null);var r=G(t,1,null),i=G(t,2,null),o=G(t,3,null),l=G(t,4,null),s=G(t,5,null),a=G(t,6,null);return t=G(t,7,null),t=new Date(Date.UTC(e,r-1,i,o,l,s,a)-6e4*t)}throw Error("Instance literal expects a string for its timestamp.")},KB,function(e){if("string"==typeof e)return new $k(e.toLowerCase());throw Error("UUID literal expects a string as its representation.")},SD,function(e){if(Le(e))return ah.h(Uh,e);throw Error("Queue literal expects a vector for its elements.")},gw,function(e){if(Le(e)){var t=[];e=z(e);for(var n=null,r=0,i=0;;)if(i<r){var o=n.$(null,i);t.push(o),i+=1}else{if(!(e=z(e)))break;Me(n=e)?(e=ed(n),i=fd(n),n=e,r=C(e),e=i):(e=A(n),t.push(e),e=B(n),n=null,r=0),i=0}return t}if(J(e)){for(t={},e=z(e),n=null,i=r=0;;)if(i<r){var l=n.$(null,i);o=G(l,0,null),l=G(l,1,null),t[o=Cf(o)]=l,i+=1}else{if(!(e=z(e)))break;Me(e)?(r=ed(e),e=fd(e),n=r,r=C(r)):(n=G(r=A(e),0,null),r=G(r,1,null),t[n=Cf(n)]=r,e=B(e),n=null,r=0),i=0}return t}throw Error("JS literal expects a vector or map containing only string or unqualified keyword keys")}],null),P]))),eP=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};eP.g=function(e){return XO(new k(null,3,[LC,r(dP),Zk,r(cP),qn,null],null),e)},eP.h=function(e,t){return XO(gh(pj.l(D([new k(null,1,[Zk,r(cP)],null),e])),LC,(function(e){return pj.l(D([r(dP),e]))})),t)},eP.I=2;var fP=rO("\n    expr=and-or\n    <and-or>=<ws*> (eq-neq | and | or)\n    <eq-neq>=<ws*> (term | eq | neq | match)\n    and=and-or <ws*> <'&&'> eq-neq\n    or=and-or <ws*> <'||'> eq-neq\n    eq=eq-neq <ws*> <'=='> term\n    neq=eq-neq <ws*> <'!='> term\n    match=eq-neq <ws*> <'?'> term\n    <term>=<ws*> (ident | own-ident | number | str | lparen and-or rparen)\n    <lparen> = <ws*'('ws*>\n    <rparen> = <ws*')'ws*>\n    ident=<'$'> word\n    own-ident=<'#'> word\n    str=<'\\''> #'[^\\']+' <'\\''>\n    word=#'[a-zA-Z]+'\n    number=#'[-+]?[0-9]*\\.?[0-9]+'\n    ws=#'[\\s\\t]+'\n    ");function gP(e){if(z(e)){if(null==(e=nO(fP,e)))var t=null;else t=n(t=e instanceof sK?e:Ae(e)instanceof sK?Ae(e):null)?p.g(t):null;if(n(t))throw cl(["Error parsing restrictions ",t].join(""),new k(null,1,[Ar,t],null));return e}return null}function hP(e,t,r){return!z(e)||cL(Ri([Cr,jm,us,mB,zo,Bm,Iy,hm,lF,po],[x,eP,function(e,t){return n(e)?e:t},bf,bf,cg,function(e){G(e,0,null),e=G(e,1,null);var t=u.h(r,e);return n(t)?t:u.h(r,Bf.g(e))},function(e,t){return n(e)?t:e},function(e){G(e,0,null),e=G(e,1,null);var r=u.h(t,e);return n(r)?r:u.h(t,Bf.g(e))},function(e,t){return n(n(t)?e:t)?Pj(Sj(t),e):null}]),e)}var iP={},jP={},kP,lP,mP,nP,oP,pP,qP,rP,sP,tP;function uP(e,t){if(null!=e&&null!=e.Wb)e=e.Wb(e,t);else{var n=uP[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=uP._))throw Eb("Spec.conform*",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function vP(e,t){if(null!=e&&null!=e.Xb)e=e.Xb(e,t);else{var n=vP[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=vP._))throw Eb("Spec.with-gen*",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}var wP=Fg(P);function xP(e){if(Af(e)){var t=r(wP);if(Af(e=u.h(t,e)))e:for(;;){if(!Af(e)){t=e;break e}e=u.h(t,e)}else t=e;return t}return e}function yP(e){if(Af(e)){var t=xP(e);if(n(t))return t;throw Error(["Unable to resolve spec: ",p.g(e)].join(""))}return e}function zP(e){return null!=e&&cb===e.pc?e:null}function AP(e){var t=dF.g(e);return n(t)?e:t}function BP(e,t){return Af(e)?e:n(AP(e))?I.j(e,An,t):null!=e&&(131072&e.B||cb===e.zd)?ze(e,I.j(Ae(e),An,t)):null}function CP(e){return Af(e)?e:n(AP(e))?An.g(e):null!=e&&(131072&e.B||cb===e.zd)?An.g(Ae(e)):null}function DP(e){var t,r=n(t=(t=Af(e))?xP(e):t)||n(t=zP(e))||n(t=AP(e))?t:null;return n(AP(r))?BP(EP(r,null),CP(r)):r}function FP(e){var t=DP(e);if(n(t))return t;if(Af(e))throw Error(["Unable to resolve spec: ",p.g(e)].join(""));return null}function GP(e){if(Fa(null==e?"":String(e)))return null;if(2<=C(e=Ng.h(Kl,TI(e,"$",0)))&&ug((function(e){return!Fa(null==e?"":String(e))}),e)){var t=Nj(Aj,qe)(e);return e=G(t,0,null),t=G(t,1,null),Bd.g([RI(".",e),"/",p.g(t)].join(""))}return null}var IP=function(){function e(e,t){var n=HP[ba(null==e?null:e)];if(null!=n)return n.h?n.h(e,t):n.call(null,e,t);if(null!=(n=HP._))return n.h?n.h(e,t):n.call(null,e,t);throw Eb("Specize.specize*",e)}function t(e){var t=HP[ba(null==e?null:e)];if(null!=t)return t.g?t.g(e):t.call(null,e);if(null!=(t=HP._))return t.g?t.g(e):t.call(null,e);throw Eb("Specize.specize*",e)}var n;return n=function(n,r){switch(arguments.length){case 1:return t.call(this,n);case 2:return e.call(this,n,r)}throw Error("Invalid arity: "+arguments.length)},n.g=t,n.h=e,n}(),HP=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};HP.g=function(e){return null!=e&&null!=e.Eb?e.Eb(e):IP(e)},HP.h=function(e,t){return null!=e&&null!=e.Fb?e.Fb(e,t):IP(e,t)},HP.I=2,w.prototype.Eb=function(){return HP(yP(this))},w.prototype.Fb=function(){return HP(yP(this))},Ad.prototype.Eb=function(){return HP(yP(this))},Ad.prototype.Fb=function(){return HP(yP(this))},uj.prototype.Eb=function(){return JP(this,this,null,null,null)},uj.prototype.Fb=function(e,t){return JP(t,this,null,null,null)},HP._=function(){function e(e){var t=(t=xe(e))?GP(e.name):t;return n(t)?JP(t,e,null,null,null):JP(lG,e,null,null,null)}var t;return t=function(t,n){switch(arguments.length){case 1:return e.call(this,t);case 2:return JP(n,t,null,null,null)}throw Error("Invalid arity: "+arguments.length)},t.g=e,t.h=function(e,t){return JP(t,e,null,null,null)},t}();var KP=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function LP(e){return O(pB,e)}function MP(e,t){return uP(KP.g(e),t)}function NP(e,t){return n(AP(e=xP(e)))?I.j(e,Nv,t):vP(KP.g(e),t)}function Z(e,t,i){if(null==i)Ig.j(wP,we,e);else{var o=zP(i);n(o)||(o=n(o=AP(i))?o:u.h(r(wP),i)),t=n(o)?i:JP(t,i,null,null,null),Ig.F(wP,I,e,BP(t,e))}}function OP(e,t,r){if(n(e)){var i=FP(e);if(n(i))return MP(i,t);if(xe(e)||(null!=e?1&e.B||cb===e.ni||!e.B&&Cb(Pb,e):Cb(Pb,e)))return n(null)?e.g?e.g(t):e.call(null,t):n(e.g?e.g(t):e.call(null,t))?t:pB;throw Error([hk.l(D([r]))," is not a fn, expected predicate fn"].join(""))}return t}function PP(e,t){return!LP(uP(e=KP.g(e),t))}KP.g=function(e){var t=zP(e);return n(t)?t:HP(e)},KP.h=function(e,t){var r=zP(e);return n(r)?r:HP(e,t)},KP.I=2;var QP=function e(t){var i=bg(t),o=u.h(i,BA),l=u.h(i,T),s=u.h(i,dD),a=u.h(i,Cz),c=u.h(i,AB),h=u.h(i,KD),d=u.h(i,Np),f=u.h(i,mm),p=u.h(i,Zn),g=u.h(i,rE),w=u.h(i,AE),m=u.h(i,$p),v=Bj(Of.h(g,d),Of.h(f,w)),y=al();return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==kP||((kP=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v){this.je=e,this.Uh=t,this.Qh=n,this.di=r,this.Th=i,this.mb=o,this.Wh=l,this.ke=s,this.sf=a,this.Rh=u,this.ci=c,this.oh=h,this.ai=d,this.id=f,this.bi=p,this.Sh=g,this.jh=w,this.Xh=m,this.th=v,this.B=393216,this.M=0}).prototype.S=function(e,t){return new kP(this.je,this.Uh,this.Qh,this.di,this.Th,this.mb,this.Wh,this.ke,this.sf,this.Rh,this.ci,this.oh,this.ai,this.id,this.bi,this.Sh,this.jh,this.Xh,t)},kP.prototype.R=function(){return this.th},kP.prototype.Eb=function(){return this},kP.prototype.Fb=function(){return this},kP.prototype.pc=cb,kP.prototype.Wb=function(e,t){if(!n(this.ke.g?this.ke.g(t):this.ke.call(null,t)))return pB;e=r(wP);var i=z(t),o=A(i);for(B(i),G(o,0,null),G(o,1,null),o=i=t;;){t=i;var l=z(o);i=A(l);var s=B(l);if(i=G(l=i,0,null),l=G(l,1,null),!n(o))return t;if(o=this.je.g?this.je.g(i):this.je.call(null,i),n(o=u.h(e,o))){if(LP(o=MP(o,l)))return pB;t=o===l?t:I.j(t,i,o),o=s,i=t}else o=s,i=t}},kP.prototype.Xb=function(t,n){return t=I.j(this.sf,Cz,n),e.g?e.g(t):e.call(null,t)},kP.Na=!0,kP.Ja="cljs.spec.alpha/t_cljs$spec$alpha13719",kP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha13719")}),new kP((function(e){var t=v.g?v.g(e):v.call(null,e);return n(t)?t:e}),t,o,l,s,a,c,h,i,d,f,i,p,y,g,w,v,m,P)};function JP(e,t,r,i,o){return n(zP(t))?n(r)?NP(t,r):t:n(AP(t))?EP(t,r):Af(t)?(e=FP(t),n(r)?NP(e,r):e):(void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==lP||(lP=function(e,t,n,r,i,o){this.form=e,this.Qb=t,this.mb=n,this.Te=r,this.dg=i,this.vh=o,this.B=393216,this.M=0},lP.prototype.S=function(e,t){return new lP(this.form,this.Qb,this.mb,this.Te,this.dg,t)},lP.prototype.R=function(){return this.vh},lP.prototype.Eb=function(){return this},lP.prototype.Fb=function(){return this},lP.prototype.pc=cb,lP.prototype.Wb=function(e,t){return e=this.Qb.g?this.Qb.g(t):this.Qb.call(null,t),n(this.Te)?e:n(e)?t:pB},lP.prototype.Xb=function(e,t){return JP(this.form,this.Qb,t,this.Te,this.dg)},lP.Na=!0,lP.Ja="cljs.spec.alpha/t_cljs$spec$alpha13852",lP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha13852")}),new lP(e,t,r,i,o,P))}function RP(e,t){return SP(e,t,X,null)}function SP(e,t,i,o){var l=al(),s=i instanceof w?function(e,t){return I.j(e,i,t)}:i;return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==mP||(mP=function(e,t,n,r,i,o,l,s,a){this.form=e,this.Nf=t,this.$f=n,this.mb=r,this.id=i,this.re=o,this.Zg=l,this.tag=s,this.wh=a,this.B=393216,this.M=0},mP.prototype.S=function(e,t){return new mP(this.form,this.Nf,this.$f,this.mb,this.id,this.re,this.Zg,this.tag,t)},mP.prototype.R=function(){return this.wh},mP.prototype.Eb=function(){return this},mP.prototype.Fb=function(){return this},mP.prototype.pc=cb,mP.prototype.Wb=function(e,t){return n(e=this.re.g?this.re.g(t):this.re.call(null,t))?OP(e,t,this.form):pB},mP.prototype.Xb=function(e,t){return SP(this.form,this.Nf,this.$f,t)},mP.Na=!0,mP.Ja="cljs.spec.alpha/t_cljs$spec$alpha13912",mP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha13912")}),new mP(e,t,i,o,l,(function(e){var i=r(t),o=Wk(i);return n(o=Vk(i,o=o.g?o.g(e):o.call(null,e)))?i.g?i.g(e):i.call(null,e):o}),(function(e){var n=Wk(r(t));return n.g?n.g(e):n.call(null,e)}),s,P)}function TP(e,t){return UP(e,t,null)}function UP(e,t,n){var i=new qk((function(){return bh.j(KP,t,e)})),o=C(t);return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==nP||(nP=function(e,t,n,r,i,o){this.forms=e,this.Db=t,this.mb=n,this.ud=r,this.H=i,this.xh=o,this.B=393216,this.M=0},nP.prototype.S=function(e,t){return new nP(this.forms,this.Db,this.mb,this.ud,this.H,t)},nP.prototype.R=function(){return this.xh},nP.prototype.Eb=function(){return this},nP.prototype.Fb=function(){return this},nP.prototype.pc=cb,nP.prototype.Wb=function(e,t){if(e=r(this.ud),!Le(t)||!x.h(C(t),this.H))return pB;for(var n=t,i=0;;){if(x.h(i,this.H))return n;var o=t.g?t.g(i):t.call(null,i),l=uP(e.g?e.g(i):e.call(null,i),o);if(LP(l))return pB;n=l===o?n:I.j(n,i,l),i+=1}},nP.prototype.Xb=function(e,t){return UP(this.forms,this.Db,t)},nP.Na=!0,nP.Ja="cljs.spec.alpha/t_cljs$spec$alpha13936",nP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha13936")}),new nP(e,t,n,i,o,P)}function VP(e,t){return new xh(e,t)}var WP=function e(t,n,i,o){var l=al(),s=Bj(t,i),a=new qk((function(){return bh.j(KP,i,n)})),u=function(){switch(C(i)){case 2:return function(e){var n=r(a),i=uP(n.g?n.g(0):n.call(null,0),e);return LP(i)?LP(e=uP(n.g?n.g(1):n.call(null,1),e))?pB:VP(t.g?t.g(1):t.call(null,1),e):VP(t.g?t.g(0):t.call(null,0),i)};case 3:return function(e){var n=r(a),i=uP(n.g?n.g(0):n.call(null,0),e);return LP(i)?LP(i=uP(n.g?n.g(1):n.call(null,1),e))?LP(e=uP(n.g?n.g(2):n.call(null,2),e))?pB:VP(t.g?t.g(2):t.call(null,2),e):VP(t.g?t.g(1):t.call(null,1),i):VP(t.g?t.g(0):t.call(null,0),i)};default:return function(e){for(var n=r(a),i=0;;){if(!(i<C(n)))return pB;var o=n.g?n.g(i):n.call(null,i);if(!LP(o=uP(o,e)))return VP(t.g?t.g(i):t.call(null,i),o);i+=1}}}}();return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==oP||(oP=function(e,t,n,r,i,o,l,s,a){this.keys=e,this.forms=t,this.Db=n,this.mb=r,this.id=i,this.mh=o,this.ud=l,this.wc=s,this.yh=a,this.B=393216,this.M=0},oP.prototype.S=function(e,t){return new oP(this.keys,this.forms,this.Db,this.mb,this.id,this.mh,this.ud,this.wc,t)},oP.prototype.R=function(){return this.yh},oP.prototype.Eb=function(){return this},oP.prototype.Fb=function(){return this},oP.prototype.pc=cb,oP.prototype.Wb=function(e,t){return this.wc.g?this.wc.g(t):this.wc.call(null,t)},oP.prototype.Xb=function(t,n){return e.F?e.F(this.keys,this.forms,this.Db,n):e.call(null,this.keys,this.forms,this.Db,n)},oP.Na=!0,oP.Ja="cljs.spec.alpha/t_cljs$spec$alpha14015",oP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha14015")}),new oP(t,n,i,o,l,s,a,u,P)};function XP(e,t,r){var i=z(t);for(A(i),B(i),A(i=z(r)),B(i),i=r;;){r=e,e=A(t=z(t)),t=B(t);var o=z(i),l=i=A(o);if(i=o=B(o),!n(e))return r;if(LP(r=OP(e,r,l)))return pB;e=r}}var YP=function e(t,n,i){var o=new qk((function(){return bh.j(KP,n,t)})),l=function(){switch(C(n)){case 2:return function(e){var t=r(o);return LP(e=uP(t.g?t.g(0):t.call(null,0),e))?pB:uP(t.g?t.g(1):t.call(null,1),e)};case 3:return function(e){var t=r(o);return LP(e=uP(t.g?t.g(0):t.call(null,0),e))||LP(e=uP(t.g?t.g(1):t.call(null,1),e))?pB:uP(t.g?t.g(2):t.call(null,2),e)};default:return function(e){for(var t=r(o),n=0;;){if(!(n<C(t)))return e;if(LP(e=uP(t.g?t.g(n):t.call(null,n),e)))return pB;n+=1}}}}();return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==pP||(pP=function(e,t,n,r,i,o){this.forms=e,this.Db=t,this.mb=n,this.ud=r,this.wc=i,this.zh=o,this.B=393216,this.M=0},pP.prototype.S=function(e,t){return new pP(this.forms,this.Db,this.mb,this.ud,this.wc,t)},pP.prototype.R=function(){return this.zh},pP.prototype.Eb=function(){return this},pP.prototype.Fb=function(){return this},pP.prototype.pc=cb,pP.prototype.Wb=function(e,t){return this.wc.g?this.wc.g(t):this.wc.call(null,t)},pP.prototype.Xb=function(t,n){return e.j?e.j(this.forms,this.Db,n):e.call(null,this.forms,this.Db,n)},pP.Na=!0,pP.Ja="cljs.spec.alpha/t_cljs$spec$alpha14134",pP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha14134")}),new pP(t,n,i,o,l,P)},ZP=function e(t,r,i){return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==qP||(qP=function(e,t,n,r){this.forms=e,this.Db=t,this.mb=n,this.Ah=r,this.B=393216,this.M=0},qP.prototype.S=function(e,t){return new qP(this.forms,this.Db,this.mb,t)},qP.prototype.R=function(){return this.Ah},qP.prototype.Eb=function(){return this},qP.prototype.Fb=function(){return this},qP.prototype.pc=cb,qP.prototype.Wb=function(e,t){return e=Ng.j((function(e,n){return OP(e,t,n)}),this.Db,this.forms),n(vg(LP,e))?pB:Xf(pj,e)},qP.prototype.Xb=function(t,n){return e.j?e.j(this.forms,this.Db,n):e.call(null,this.forms,this.Db,n)},qP.Na=!0,qP.Ja="cljs.spec.alpha/t_cljs$spec$alpha14187",qP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha14187")}),new qP(t,r,i,P)},$P=new k(null,4,[iB,F,Jy,wj,Oy,Id,Wu,P],null);function aQ(e,t,i,o){function l(e,t,n,r){return re.h(e,r)}var s=bg(i),a=u.h(s,TC),c=u.h(s,Fo),h=u.j(s,qs,20),d=u.h(s,Jz),f=u.h(s,kx),p=u.h(s,tD),g=u.h(s,Wo),w=u.h(s,Um),m=u.h(s,mw),v=u.h(s,Fu),y=u.h(s,Jr),b=u.h(s,Rv),$=u.h(s,aF),E=n($)?te($):u.h($P,c),D=new qk((function(){return KP.g(t)})),k=n(w)?w:function(e){return e};return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==rP||((rP=function(e,t,n,r,i,o,l,s,a,u,c,h,d,f,p,g,w,m,v,y,b,S,$,C,I){this.form=e,this.qh=t,this.Bg=n,this.ph=r,this.mb=i,this.ih=o,this.Qb=l,this.ee=s,this.Vg=a,this.lh=u,this.zg=c,this.$d=h,this.Xg=d,this.Yg=f,this.Vd=p,this.kh=g,this.hh=w,this.Vh=m,this.count=v,this.Nh=y,this.Of=b,this.kind=S,this.Ff=$,this.Ug=C,this.Bh=I,this.B=393216,this.M=0}).prototype.S=function(e,t){return new rP(this.form,this.qh,this.Bg,this.ph,this.mb,this.ih,this.Qb,this.ee,this.Vg,this.lh,this.zg,this.$d,this.Xg,this.Yg,this.Vd,this.kh,this.hh,this.Vh,this.count,this.Nh,this.Of,this.kind,this.Ff,this.Ug,t)},rP.prototype.R=function(){return this.Bh},rP.prototype.Eb=function(){return this},rP.prototype.Fb=function(){return this},rP.prototype.pc=cb,rP.prototype.Wb=function(e,t){if(e=r(this.Vd),yb(this.ee.g?this.ee.g(t):this.ee.call(null,t)))return pB;if(n(this.Ff)){var i=this.$d.g?this.$d.g(t):this.$d.call(null,t),o=G(i,0,null),l=G(i,1,null);i=G(i,2,null);var s=o.g?o.g(t):o.call(null,t);o=0;var a=z(t);for(A(t=z(a)),B(t),t=s;;){var u=a;if(a=A(s=z(u)),s=B(s),!u)return i.g?i.g(t):i.call(null,t);if(LP(u=uP(e,a)))return pB;t=l.F?l.F(t,o,a,u):l.call(null,t,o,a,u),o+=1,a=s}}else if(ce(t))for(l=1>(l=jf(C(t)/101))?1:l,o=0;;){if(o>=C(t))return t;if(!PP(e,ee(t,o)))return pB;o+=l}else for(o=0,l=z(t),A(i=z(l)),B(i);;){if(i=A(a=z(l)),s=B(a),a=i,null==(u=l)||x.h(o,101))return t;if(!PP(e,a))return pB;l=s,o+=1}},rP.prototype.Xb=function(e,t){return aQ(this.form,this.Qb,this.Of,t)},rP.Na=!0,rP.Ja="cljs.spec.alpha/t_cljs$spec$alpha14276",rP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha14276")}),new rP(e,a,(function(e){return PP(r(D),e)}),s,o,h,t,d,f,c,l,(function(e){return Le(e)&&(yb($)||Le($))?new Q(null,3,5,S,[bf,function(e,t,n,r){return n===r?e:I.j(e,t,r)},bf],null):n((t=J(e))?(t=n(y)?yb($):y,n(t)?t:J($)):t)?new Q(null,3,5,S,[n(f)?te:bf,function(e,t,r,i){return r===i&&yb(f)?e:I.j(e,ee(n(f)?i:r,0),ee(i,1))},bf],null):tf($)||Qe($)||yb($)&&(tf(e)||Qe(e))?new Q(null,3,5,S,[te,l,vf],null):new Q(null,3,5,S,[function(e){return te(n($)?$:e)},l,bf],null);var t}),p,g,D,k,E,i,m,v,s,y,b,$,P)}function bQ(e){return new k(null,2,[dF,sA,Yn,e],null)}function cQ(e){return e=bg(e),e=u.h(e,dF),x.h(sA,e)}var dQ=function e(t){var r=bg(t),i=u.h(r,zs),o=A(t=z(i));t=B(t);var l=u.h(r,Zs),s=z(l),a=A(s);s=B(s);var c=u.h(r,zF),h=z(c);A(h),h=B(h);var d=u.h(r,Yn);return r=u.h(r,Tq),ug(bf,i)?cQ(o)?(i=Yn.g(o),i=re.h(d,n(l)?ve([a,i]):i),t?(t=new k(null,4,[zs,t,Zs,s,zF,h,Yn,i],null),e.g?e.g(t):e.call(null,t)):bQ(i)):new k(null,6,[dF,dp,zs,i,Yn,d,Zs,l,zF,c,Tq,r],null):null};function eQ(e,t,r,i,o){return n(e)?(i=new k(null,5,[dF,bF,Qs,t,Nq,i,zF,o,kt,al()],null),cQ(e)?I.l(i,Ms,t,D([Yn,re.h(r,Yn.g(e))])):I.l(i,Ms,e,D([Yn,r]))):null}function fQ(e,t,r,i){return n(n(t)?t:r)?(e=Xg.h((function(e){return e=A(e),i.g?i.g(e):i.call(null,e)}),Ng.F(Ih,e,function(){var e=z(t);return e||Sg(null)}(),function(){var e=z(r);return e||Sg(null)}())),new Q(null,3,5,S,[z(Ng.h(A,e)),n(t)?z(Ng.h(oe,e)):null,n(r)?z(Ng.h((function(e){return ee(e,2)}),e)):null],null)):new Q(null,3,5,S,[z(Xg.h(i,e)),t,r],null)}function gQ(e,t,r){var i=fQ(e,t,r,bf);e=A(r=z(t=G(i,0,null))),r=B(r);var o=G(i,1,null),l=G(o,0,null);return i=G(i,2,null),n(t)?(t=new k(null,4,[dF,GD,zs,t,Zs,o,zF,i],null),null==r?n(l)?cQ(e)?bQ(VP(l,Yn.g(e))):t:e:t):null}function hQ(e,t){return n(n(e)?t:e)?gQ(D([e,t]),null,null):n(e)?e:t}var iQ=function e(t){var r=bg(t=yP(t)),i=u.h(r,dF),o=u.h(r,zs);t=u.h(r,Ms);var l=u.h(r,Qs);if(r=u.h(r,zF),x.h(sA,i))return!0;if(x.h(null,i))return null;if(x.h(BD,i))return n(i=e.g?e.g(t):e.call(null,t))?!LP(t=XP(jQ(t),o,B(r))):i;if(x.h(bF,i))return(o=t===l)?o:e.g?e.g(t):e.call(null,t);if(x.h(dp,i))return ug(e,o);if(x.h(GD,i))return vg(e,o);throw Error(["No matching clause: ",p.g(i)].join(""))},jQ=function e(t){var r=bg(t=yP(t)),i=z(t=u.h(r,zs)),o=A(i);B(i);var l=u.h(r,Zs),s=G(l,0,null),a=u.h(r,dF);i=u.h(r,Ms);var c=u.h(r,Yn);if(r=u.h(r,zF),x.h(sA,a))return c;if(x.h(null,a))return null;if(x.h(BD,a))return o=e.g?e.g(i):e.call(null,i),(l=x.h(o,TB))?i=l:(i=dF.g(yP(i)),i=n(i=(l=new uj(null,new k(null,2,[bF,null,dp,null],null),null)).g?l.g(i):l.call(null,i))?Ee(o):i,i=n(i)?i:null),n(i)?TB:XP(o,t,r);if(x.h(bF,a))return kQ(i,c,s);if(x.h(dp,a))return kQ(o,c,s);if(x.h(GD,a))return t=G(r=fQ(t,l,r,iQ),0,null),t=G(t,0,null),r=G(r,1,null),r=G(r,0,null),t=null==t?TB:e.g?e.g(t):e.call(null,t),n(r)?VP(r,t):t;throw Error(["No matching clause: ",p.g(a)].join(""))};function kQ(e,t,r){var i=bg(e=yP(e)),o=u.h(i,dF);if(u.h(i,zs),e=u.h(i,Nq),x.h(null,o))return t;if(x.h(GD,o)||x.h(sA,o)||x.h(BD,o))return e=jQ(i),x.h(e,TB)?t:re.h(t,n(r)?ve([r,e]):e);if(x.h(bF,o)||x.h(dp,o))return Ee(i=jQ(i))||(r=n(r)?ve([r,i]):i,t=(e=n(e)?ah:re).h?e.h(t,r):e.call(null,t,r)),t;throw Error(["No matching clause: ",p.g(o)].join(""))}var lQ=function e(t,r){var i=bg(t=yP(t)),o=u.h(i,zF),l=u.h(i,Qs),s=z(t=u.h(i,zs)),a=A(s),c=B(s),h=u.h(i,Yn);s=u.h(i,dF);var d=u.h(i,Nq),f=u.h(i,Zs),g=z(f),w=A(g),m=B(g);g=u.h(i,um);var v,y=u.h(i,Ms);if(n(i)){if(x.h(sA,s))return null;if(x.h(null,s))return LP(t=OP(i,r,i))?null:bQ(t);if(x.h(BD,s))return n(i=e.h?e.h(y,r):e.call(null,y,r))?x.h(sA,dF.g(i))?LP(t=XP(jQ(i),t,B(o)))?null:bQ(t):new k(null,5,[dF,BD,Ms,i,um,g,zs,t,zF,o],null):null;if(x.h(dp,s))return hQ(dQ(new k(null,4,[zs,ke(e.h?e.h(a,r):e.call(null,a,r),c),Zs,f,zF,o,Yn,h],null)),n(iQ(a))?(v=dQ(new k(null,4,[zs,c,Zs,m,zF,B(o),Yn,kQ(a,h,w)],null)),e.h?e.h(v,r):e.call(null,v,r)):null);if(x.h(GD,s))return gQ(Ng.h((function(t){return e.h?e.h(t,r):e.call(null,t,r)}),t),f,o);if(x.h(bF,s))return hQ(eQ(e.h?e.h(y,r):e.call(null,y,r),l,h,d,o),n(iQ(y))?function(){var t=eQ(l,l,kQ(y,h,null),d,o);return e.h?e.h(t,r):e.call(null,t,r)}():null);throw Error(["No matching clause: ",p.g(s)].join(""))}return null};function mQ(e,t){for(;;){var r=z(t),i=A(r);if(r=B(r),Ee(t))return n(iQ(e))?(e=jQ(e),x.h(e,TB)?null:e):pB;if(!n(e=lQ(e,i)))return pB;t=r}}var EP=function e(t,n){return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==sP||(sP=function(e,t,n){this.te=e,this.mb=t,this.Ch=n,this.B=393216,this.M=0},sP.prototype.S=function(e,t){return new sP(this.te,this.mb,t)},sP.prototype.R=function(){return this.Ch},sP.prototype.Eb=function(){return this},sP.prototype.Fb=function(){return this},sP.prototype.pc=cb,sP.prototype.Wb=function(e,t){return null==t||Ie(t)?mQ(this.te,z(t)):pB},sP.prototype.Xb=function(t,n){return e.h?e.h(this.te,n):e.call(null,this.te,n)},sP.Na=!0,sP.Ja="cljs.spec.alpha/t_cljs$spec$alpha14816",sP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha14816")}),new sP(t,n,P)};Z(Lt,N(ez,N(wl,new Q(null,1,5,S,[FD],null),N(GG,N(om,VB,FD),N(om,dC,FD))),N(wl,new Q(null,1,5,S,[Zy],null),N(om,N(V,new Q(null,1,5,S,[new Q(null,2,5,S,[Tt,Wt],null)],null),new k(null,2,[VB,Tt,dC,Wt],null)),Zy))),JP(N(ez,N(V,new Q(null,1,5,S,[W],null),N(GG,N(om,VB,W),N(om,dC,W))),N(V,new Q(null,1,5,S,[W],null),N(om,N(V,new Q(null,1,5,S,[new Q(null,2,5,S,[Tt,Wt],null)],null),new k(null,2,[VB,Tt,dC,Wt],null)),W))),(function(e){return Bj(Ng.h(VB,e),Ng.h(dC,e))}),null,!0,(function(e){return Ng.h((function(e){var t=G(e,0,null);return e=G(e,1,null),new k(null,2,[VB,t,dC,e],null)}),e)})));var nQ=function e(t,n,i){var o=new qk((function(){return KP.h(n,t)}));return void 0!==$a&&void 0!==iP&&void 0!==jP&&void 0!==tP||(tP=function(e,t,n,r,i){this.form=e,this.Qb=t,this.mb=n,this.Vd=r,this.Dh=i,this.B=393216,this.M=0},tP.prototype.S=function(e,t){return new tP(this.form,this.Qb,this.mb,this.Vd,t)},tP.prototype.R=function(){return this.Dh},tP.prototype.Eb=function(){return this},tP.prototype.Fb=function(){return this},tP.prototype.pc=cb,tP.prototype.Wb=function(e,t){return null==t?null:uP(r(this.Vd),t)},tP.prototype.Xb=function(t,n){return e.j?e.j(this.form,this.Qb,n):e.call(null,this.form,this.Qb,n)},tP.Na=!0,tP.Ja="cljs.spec.alpha/t_cljs$spec$alpha15076",tP.Pa=function(e){return Qc(e,"cljs.spec.alpha/t_cljs$spec$alpha15076")}),new tP(t,n,i,o,P)};Z(zw,SC,Ab),Z(hz,SC,Ab),Z(ep,un,pf),Z(Un,wB,zb),Z(pm,N(eD,T,new Q(null,3,5,S,[zw,hz,ep],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[zw,hz,ep],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,GC)},function(e){return M(e,pr)},function(e){return M(e,bD)}],null),function(e){return J(e)&&M(e,GC)&&M(e,pr)&&M(e,bD)},F,new Q(null,3,5,S,[zw,hz,ep],null),null,new Q(null,3,5,S,[GC,pr,bD],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,GC)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pr)),N(V,new Q(null,1,5,S,[W],null),N(U,W,bD))],null),null]))),Z(VC,SC,Ab),Z(Ny,N(Zq,VC,N(eD,T,new Q(null,2,5,S,[Un,pm],null))),aQ(N(zx,VC,N(es,T,new Q(null,2,5,S,[Un,pm],null))),TP(new Q(null,2,5,S,[VC,N(eD,T,new Q(null,2,5,S,[Un,pm],null))],null),new Q(null,2,5,S,[VC,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[Un,pm],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,wu)},function(e){return M(e,pD)}],null),function(e){return J(e)&&M(e,wu)&&M(e,pD)},F,new Q(null,2,5,S,[Un,pm],null),null,new Q(null,2,5,S,[wu,pD],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,wu)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pD))],null),null]))],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,VC,N(eD,T,new Q(null,2,5,S,[Un,pm],null))),Jz,function(e){return J(e)}],null),null)),Z(jB,SC,Ab),Z(sC,N(jz,SC),nQ(SC,Ab,null)),Z(Yu,Yv,Te),Z(Vz,SC,Ab);var oQ,F2=Fg(P),G2=Fg(P),H2=Fg(P),I2=Fg(P),J2=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));oQ=new Yk(Bd.h("gateway.state.spec.common","address-type"),X,J2,F2,G2,H2,I2),Z(ME,Hs,Bb),oQ.C(null,gz,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[Ss,ME],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,oz)}],null),function(e){return J(e)&&M(e,X)&&M(e,oz)},F,new Q(null,2,5,S,[Ss,ME],null),null,new Q(null,2,5,S,[X,oz],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,oz))],null),null]))})),Z(Io,SC,Ab),oQ.C(null,qy,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[Ss,IB,Io],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,em)},function(e){return M(e,zt)}],null),function(e){return J(e)&&M(e,X)&&M(e,em)&&M(e,zt)},F,new Q(null,3,5,S,[Ss,IB,Io],null),null,new Q(null,3,5,S,[X,em,zt],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,em)),N(V,new Q(null,1,5,S,[W],null),N(U,W,zt))],null),null]))})),oQ.C(null,jD,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[Ss],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,X)}],null),function(e){return J(e)&&M(e,X)},F,new Q(null,1,5,S,[Ss],null),null,new Q(null,1,5,S,[X],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X))],null),null]))})),oQ.C(null,zt,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[Ss,Io],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,zt)}],null),function(e){return J(e)&&M(e,X)&&M(e,zt)},F,new Q(null,2,5,S,[Ss,Io],null),null,new Q(null,2,5,S,[X,zt],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,zt))],null),null]))})),oQ.C(null,Zk,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[Ss],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,X)}],null),function(e){return J(e)&&M(e,X)},F,new Q(null,1,5,S,[Ss],null),null,new Q(null,1,5,S,[X],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X))],null),null]))})),Z(yE,N(Gx,cn,X),RP(cn,new Cd((function(){return oQ}),cn,Ri([Rs,Yo,CD,so,rs,cw,MG,oo,KC,wD],[iw,Xs,"gateway/state/spec/common.cljc",23,1,10,10,Id,null,n(oQ)?oQ.md:null])))),Z(DA,N(Gx,cn,X),RP(cn,new Cd((function(){return oQ}),cn,Ri([Rs,Yo,CD,so,rs,cw,MG,oo,KC,wD],[iw,Xs,"gateway/state/spec/common.cljc",23,1,10,10,Id,null,n(oQ)?oQ.md:null])))),Z(sw,N(Zq,N(Hp,tq,SC,Pl,tA),Hs),aQ(N(zx,N(WD,tq,oC,Pl,As),BB),TP(new Q(null,2,5,S,[N(Hp,tq,SC,Pl,tA),Hs],null),new Q(null,2,5,S,[WP(new Q(null,2,5,S,[tq,Pl],null),new Q(null,2,5,S,[SC,tA],null),new Q(null,2,5,S,[Ab,yf],null),null),Bb],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,N(Hp,tq,SC,Pl,tA),Hs),Jz,function(e){return J(e)}],null),null)),Z(vo,N(Hp,ex,kn,qm,SC,kp,iB),WP(new Q(null,3,5,S,[ex,qm,kp],null),new Q(null,3,5,S,[kn,SC,iB],null),new Q(null,3,5,S,[vb,Ab,Le],null),null)),Z(zC,N(gq,SC,Yx),YP(new Q(null,2,5,S,[SC,Yx],null),new Q(null,2,5,S,[Ab,z],null),null)),Z(lw,SC,Ab),Z(bq,N(jz,Wu),nQ(Wu,J,null)),Z(uD,vo,vo),Z($E,vo,vo),Z(Kz,N(gq,tA,N(wl,new Q(null,1,5,S,[Az],null),N(U,new uj(null,new k(null,4,[mC,"null",cz,"null",Pp,"null",SB,"null"],null),null),Az))),YP(new Q(null,2,5,S,[tA,N(V,new Q(null,1,5,S,[W],null),N(U,new uj(null,new k(null,4,[mC,"null",cz,"null",Pp,"null",SB,"null"],null),null),W))],null),new Q(null,2,5,S,[yf,function(e){return M(new uj(null,new k(null,4,[mC,null,cz,null,Pp,null,SB,null],null),null),e)}],null),null)),Z(hD,N(xy,jB,Jr,Jy),aQ(jB,jB,new k(null,5,[Rv,!0,Jr,Ge,Fo,Jy,tD,N(xy,jB,Jr,Jy),Jz,function(e){return Ge(e)}],null),null)),Z(rt,jB,jB),Z(vn,jB,jB),Z(eA,eu,xb),Z(iq,eu,xb),Z(cC,N(eD,T,new Q(null,2,5,S,[eA,iq],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[eA,iq],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,OB)},function(e){return M(e,uA)}],null),function(e){return J(e)&&M(e,OB)&&M(e,uA)},F,new Q(null,2,5,S,[eA,iq],null),null,new Q(null,2,5,S,[OB,uA],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,OB)),N(V,new Q(null,1,5,S,[W],null),N(U,W,uA))],null),null]))),Z(jF,N(eD,T,new Q(null,4,5,S,[zC,Kz,hD,vn],null),dD,new Q(null,6,5,S,[lw,uD,$E,bq,rt,cC],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,4,5,S,[zC,Kz,hD,vn],null),new Q(null,6,5,S,[lw,uD,$E,bq,rt,cC],null),null,new Q(null,5,5,S,[function(e){return J(e)},function(e){return M(e,kt)},function(e){return M(e,JF)},function(e){return M(e,QD)},function(e){return M(e,Zv)}],null),function(e){return J(e)&&M(e,kt)&&M(e,JF)&&M(e,QD)&&M(e,Zv)},new Q(null,6,5,S,[Yo,PA,sD,Fw,Ru,bD],null),new Q(null,4,5,S,[zC,Kz,hD,vn],null),null,new Q(null,4,5,S,[kt,JF,QD,Zv],null),new Q(null,6,5,S,[lw,uD,$E,bq,rt,cC],null),new Q(null,5,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,kt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,JF)),N(V,new Q(null,1,5,S,[W],null),N(U,W,QD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Zv))],null),null]))),Z(Nt,N(Zq,zC,jF),aQ(N(zx,zC,jF),TP(new Q(null,2,5,S,[zC,jF],null),new Q(null,2,5,S,[zC,jF],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,zC,jF),Jz,function(e){return J(e)}],null),null)),Z(HC,Yv,Te),Z(qA,SC,Ab),Z(KE,N(Zq,wB,Hs),aQ(N(zx,hF,BB),TP(new Q(null,2,5,S,[wB,Hs],null),new Q(null,2,5,S,[zb,Bb],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,wB,Hs),Jz,function(e){return J(e)}],null),null)),Z(Bx,N(Zq,wB,Hs),aQ(N(zx,hF,BB),TP(new Q(null,2,5,S,[wB,Hs],null),new Q(null,2,5,S,[zb,Bb],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,wB,Hs),Jz,function(e){return J(e)}],null),null)),Z(DE,N(eD,T,new Q(null,2,5,S,[HC,qA],null),dD,new Q(null,2,5,S,[KE,Bx],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[HC,qA],null),new Q(null,2,5,S,[KE,Bx],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,kt)},function(e){return M(e,pA)}],null),function(e){return J(e)&&M(e,kt)&&M(e,pA)},new Q(null,2,5,S,[DB,oD],null),new Q(null,2,5,S,[HC,qA],null),null,new Q(null,2,5,S,[kt,pA],null),new Q(null,2,5,S,[KE,Bx],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,kt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pA))],null),null]))),Z(Et,N(Zq,qA,DE),aQ(N(zx,qA,DE),TP(new Q(null,2,5,S,[qA,DE],null),new Q(null,2,5,S,[qA,DE],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,qA,DE),Jz,function(e){return J(e)}],null),null)),Z(Lv,SC,Ab),Z(Bz,Lv,Lv),Z(ix,N(Zq,wB,wB),aQ(N(zx,hF,hF),TP(new Q(null,2,5,S,[wB,wB],null),new Q(null,2,5,S,[zb,zb],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,wB,wB),Jz,function(e){return J(e)}],null),null)),Z(fy,N(eD,T,new Q(null,1,5,S,[Lv],null),dD,new Q(null,2,5,S,[Bz,ix],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[Lv],null),new Q(null,2,5,S,[Bz,ix],null),null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,X)}],null),function(e){return J(e)&&M(e,X)},new Q(null,2,5,S,[Yo,DB],null),new Q(null,1,5,S,[Lv],null),null,new Q(null,1,5,S,[X],null),new Q(null,2,5,S,[Bz,ix],null),new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X))],null),null]))),Z(No,fy,fy),Z(St,N(xy,fy,Jr,iB),aQ(fy,fy,new k(null,5,[Rv,!0,Jr,Le,Fo,iB,tD,N(xy,fy,Jr,iB),Jz,function(e){return Le(e)}],null),null)),Z(ly,N(Zq,wB,wB),aQ(N(zx,hF,hF),TP(new Q(null,2,5,S,[wB,wB],null),new Q(null,2,5,S,[zb,zb],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,wB,wB),Jz,function(e){return J(e)}],null),null)),Z(RC,vo,vo),Z(uG,N(eD,T,new Q(null,2,5,S,[Bz,No],null),dD,new Q(null,3,5,S,[St,ly,RC],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[Bz,No],null),new Q(null,3,5,S,[St,ly,RC],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,Yo)},function(e){return M(e,ey)}],null),function(e){return J(e)&&M(e,Yo)&&M(e,ey)},new Q(null,3,5,S,[mE,Ev,qr],null),new Q(null,2,5,S,[Bz,No],null),null,new Q(null,2,5,S,[Yo,ey],null),new Q(null,3,5,S,[St,ly,RC],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Yo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ey))],null),null]))),Z(yw,SC,Ab),Z(jo,N(Zq,yw,N(Zq,Lv,uG)),aQ(N(zx,yw,N(ap,Lv,uG)),TP(new Q(null,2,5,S,[yw,N(Zq,Lv,uG)],null),new Q(null,2,5,S,[yw,aQ(N(zx,Lv,uG),TP(new Q(null,2,5,S,[Lv,uG],null),new Q(null,2,5,S,[Lv,uG],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,Lv,uG),Jz,function(e){return J(e)}],null),null)],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,yw,N(Zq,Lv,uG)),Jz,function(e){return J(e)}],null),null)),Z(rG,SC,Ab),Z(gn,zC,zC),Z(SA,jB,jB),Z(BG,jB,jB),Z(gt,N(xy,jB,Jr,Jy),aQ(jB,jB,new k(null,5,[Rv,!0,Jr,Ge,Fo,Jy,tD,N(xy,jB,Jr,Jy),Jz,function(e){return Ge(e)}],null),null)),Z(bA,N(xy,jB,Jr,Jy),aQ(jB,jB,new k(null,5,[Rv,!0,Jr,Ge,Fo,Jy,tD,N(xy,jB,Jr,Jy),Jz,function(e){return Ge(e)}],null),null)),Z(km,jF,jF),Z(YB,N(eD,T,new Q(null,3,5,S,[Lv,km,BG],null),dD,new Q(null,3,5,S,[bA,Ly,Ul],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[Lv,km,BG],null),new Q(null,3,5,S,[bA,Ly,Ul],null),null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,Fp)},function(e){return M(e,Ru)}],null),function(e){return J(e)&&M(e,X)&&M(e,Fp)&&M(e,Ru)},new Q(null,3,5,S,[wp,Ln,nC],null),new Q(null,3,5,S,[Lv,km,BG],null),null,new Q(null,3,5,S,[X,Fp,Ru],null),new Q(null,3,5,S,[bA,Ly,Ul],null),new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fp)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Ru))],null),null]))),Z(Ul,N(Zq,rG,YB),aQ(N(zx,rG,YB),TP(new Q(null,2,5,S,[rG,YB],null),new Q(null,2,5,S,[rG,YB],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,rG,YB),Jz,function(e){return J(e)}],null),null)),Z(XD,rG,rG),Z(Jv,Mw,Pe),Z(HD,N(eD,T,new Q(null,4,5,S,[rG,Lv,Bs,SA],null),dD,new Q(null,5,5,S,[Jv,BG,bA,gt,Ul],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,4,5,S,[rG,Lv,Bs,SA],null),new Q(null,5,5,S,[Jv,BG,bA,gt,Ul],null),null,new Q(null,5,5,S,[function(e){return J(e)},function(e){return M(e,kt)},function(e){return M(e,X)},function(e){return M(e,Ty)},function(e){return M(e,bp)}],null),function(e){return J(e)&&M(e,kt)&&M(e,X)&&M(e,Ty)&&M(e,bp)},new Q(null,5,5,S,[zy,Ru,wp,rn,nC],null),new Q(null,4,5,S,[rG,Lv,Bs,SA],null),null,new Q(null,4,5,S,[kt,X,Ty,bp],null),new Q(null,5,5,S,[Jv,BG,bA,gt,Ul],null),new Q(null,5,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,kt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Ty)),N(V,new Q(null,1,5,S,[W],null),N(U,W,bp))],null),null]))),Z(ry,N(Zq,rG,HD),aQ(N(zx,rG,HD),TP(new Q(null,2,5,S,[rG,HD],null),new Q(null,2,5,S,[rG,HD],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,rG,HD),Jz,function(e){return J(e)}],null),null)),Z(tn,N(eD,dD,new Q(null,1,5,S,[Et],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[null,new Q(null,1,5,S,[Et],null),null,new Q(null,1,5,S,[function(e){return J(e)}],null),function(e){return J(e)},new Q(null,1,5,S,[hx],null),F,null,F,new Q(null,1,5,S,[Et],null),new Q(null,1,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W))],null),null]))),Z(By,N(Zq,N(Hp,X,Lv,Fm,N(zp,hG,Fm)),N(xy,jB,Jr,Jy)),aQ(N(zx,N(WD,X,Lv,Fm,N(Cu,Zt,Fm)),N(vm,jB,Jr,lx)),TP(new Q(null,2,5,S,[N(Hp,X,Lv,Fm,N(zp,hG,Fm)),N(xy,jB,Jr,Jy)],null),new Q(null,2,5,S,[WP(new Q(null,2,5,S,[X,Fm],null),new Q(null,2,5,S,[Lv,N(zp,hG,Fm)],null),new Q(null,2,5,S,[Lv,Ag(x,Fm)],null),null),aQ(jB,jB,new k(null,5,[Rv,!0,Jr,Ge,Fo,Jy,tD,N(xy,jB,Jr,Jy),Jz,function(e){return Ge(e)}],null),null)],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,N(Hp,X,Lv,Fm,N(zp,hG,Fm)),N(xy,jB,Jr,Jy)),Jz,function(e){return J(e)}],null),null)),Z(Or,Yv,Te),Z(mF,SC,Ab),Z(go,Yv,Te),Z(Ww,SC,Ab),Z(VD,SC,Ab),Z(qB,SC,Ab),Z(lp,SC,Ab),Z(qx,N(eD,T,new Q(null,6,5,S,[Or,mF,go,Ks,Ww,VD],null),dD,new Q(null,3,5,S,[qB,lp,vo],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,6,5,S,[Or,mF,go,Ks,Ww,VD],null),new Q(null,3,5,S,[qB,lp,vo],null),null,new Q(null,7,5,S,[function(e){return J(e)},function(e){return M(e,kt)},function(e){return M(e,Yo)},function(e){return M(e,bD)},function(e){return M(e,oD)},function(e){return M(e,Gt)},function(e){return M(e,uq)}],null),function(e){return J(e)&&M(e,kt)&&M(e,Yo)&&M(e,bD)&&M(e,oD)&&M(e,Gt)&&M(e,uq)},new Q(null,3,5,S,[Nx,pr,Gp],null),new Q(null,6,5,S,[Or,mF,go,Ks,Ww,VD],null),null,new Q(null,6,5,S,[kt,Yo,bD,oD,Gt,uq],null),new Q(null,3,5,S,[qB,lp,vo],null),new Q(null,7,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,kt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Yo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,bD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,oD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Gt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,uq))],null),null]))),Z(Wp,N(Hp,Mr,On,WE,N(Zq,Or,qx)),WP(new Q(null,2,5,S,[Mr,WE],null),new Q(null,2,5,S,[On,N(Zq,Or,qx)],null),new Q(null,2,5,S,[Ee,aQ(N(zx,Or,qx),TP(new Q(null,2,5,S,[Or,qx],null),new Q(null,2,5,S,[Or,qx],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,Or,qx),Jz,function(e){return J(e)}],null),null)],null),null)),Z(zA,N(Zq,jB,Wp),aQ(N(zx,jB,Wp),TP(new Q(null,2,5,S,[jB,Wp],null),new Q(null,2,5,S,[jB,Wp],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,jB,Wp),Jz,function(e){return J(e)}],null),null)),Z(gv,Or,Or),Z(Qm,sC,sC),Z(mz,sC,sC),Z(aD,sC,sC),Z(Px,jB,jB),Z(er,N(eD,T,new Q(null,3,5,S,[Px,gv,Qm],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[Px,gv,Qm],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,Wm)},function(e){return M(e,Vo)},function(e){return M(e,jv)}],null),function(e){return J(e)&&M(e,Wm)&&M(e,Vo)&&M(e,jv)},F,new Q(null,3,5,S,[Px,gv,Qm],null),null,new Q(null,3,5,S,[Wm,Vo,jv],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Wm)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Vo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,jv))],null),null]))),Z(ot,N(Zq,aD,er),aQ(N(zx,aD,er),TP(new Q(null,2,5,S,[aD,er],null),new Q(null,2,5,S,[aD,er],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,aD,er),Jz,function(e){return J(e)}],null),null)),Z(Lx,jB,jB),Z(gG,N(eD,T,new Q(null,3,5,S,[Lx,gv,aD],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[Lx,gv,aD],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,bn)},function(e){return M(e,Vo)},function(e){return M(e,UC)}],null),function(e){return J(e)&&M(e,bn)&&M(e,Vo)&&M(e,UC)},F,new Q(null,3,5,S,[Lx,gv,aD],null),null,new Q(null,3,5,S,[bn,Vo,UC],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,bn)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Vo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,UC))],null),null]))),Z($F,N(Zq,Qm,gG),aQ(N(zx,Qm,gG),TP(new Q(null,2,5,S,[Qm,gG],null),new Q(null,2,5,S,[Qm,gG],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,Qm,gG),Jz,function(e){return J(e)}],null),null)),Z(bm,SC,Ab),Z(aE,bm,bm),Z(Zz,jB,jB),Z(Jw,N(eD,T,new Q(null,3,5,S,[Zz,gv,aD],null),dD,new Q(null,1,5,S,[aE],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[Zz,gv,aD],null),new Q(null,1,5,S,[aE],null),null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,QB)},function(e){return M(e,Vo)},function(e){return M(e,UC)}],null),function(e){return J(e)&&M(e,QB)&&M(e,Vo)&&M(e,UC)},new Q(null,1,5,S,[kC],null),new Q(null,3,5,S,[Zz,gv,aD],null),null,new Q(null,3,5,S,[QB,Vo,UC],null),new Q(null,1,5,S,[aE],null),new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,QB)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Vo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,UC))],null),null]))),Z(Gz,N(Zq,mz,Jw),aQ(N(zx,mz,Jw),TP(new Q(null,2,5,S,[mz,Jw],null),new Q(null,2,5,S,[mz,Jw],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,mz,Jw),Jz,function(e){return J(e)}],null),null)),Z(QC,jB,jB),Z(nr,N(eD,dr,new Q(null,2,5,S,[QC,Or],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[null,null,null,new Q(null,1,5,S,[function(e){return J(e)}],null),function(e){return J(e)},F,F,null,F,F,new Q(null,1,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W))],null),null]))),Z(Kx,N(Zq,mz,nr),aQ(N(zx,mz,nr),TP(new Q(null,2,5,S,[mz,nr],null),new Q(null,2,5,S,[mz,nr],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,mz,nr),Jz,function(e){return J(e)}],null),null)),Z(Mp,N(Zq,jB,N(xy,mz,Jr,Jy)),aQ(N(zx,jB,N(vm,mz,Jr,lx)),TP(new Q(null,2,5,S,[jB,N(xy,mz,Jr,Jy)],null),new Q(null,2,5,S,[jB,aQ(mz,mz,new k(null,5,[Rv,!0,Jr,Ge,Fo,Jy,tD,N(xy,mz,Jr,Jy),Jz,function(e){return Ge(e)}],null),null)],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,jB,N(xy,mz,Jr,Jy)),Jz,function(e){return J(e)}],null),null)),Z(lD,N(Zq,bm,Mp),aQ(N(zx,bm,Mp),TP(new Q(null,2,5,S,[bm,Mp],null),new Q(null,2,5,S,[bm,Mp],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,bm,Mp),Jz,function(e){return J(e)}],null),null)),Z(PF,N(eD,dD,new Q(null,7,5,S,[vo,zA,ot,$F,Gz,Kx,lD],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[null,new Q(null,7,5,S,[vo,zA,ot,$F,Gz,Kx,lD],null),null,new Q(null,1,5,S,[function(e){return J(e)}],null),function(e){return J(e)},new Q(null,7,5,S,[Gp,ew,Ux,Lp,Ey,wo,Iz],null),F,null,F,new Q(null,7,5,S,[vo,zA,ot,$F,Gz,Kx,lD],null),new Q(null,1,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W))],null),null]))),Z(Aw,sC,sC),Z(qp,SC,Ab),Z(dG,Hs,Bb),Z(Bw,N(eD,T,new Q(null,1,5,S,[qp],null),dD,new Q(null,2,5,S,[dG,hC],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[qp],null),new Q(null,2,5,S,[dG,hC],null),null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,ND)}],null),function(e){return J(e)&&M(e,ND)},new Q(null,2,5,S,[xp,pn],null),new Q(null,1,5,S,[qp],null),null,new Q(null,1,5,S,[ND],null),new Q(null,2,5,S,[dG,hC],null),new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ND))],null),null]))),Z(Ez,N(Zq,Aw,Bw),aQ(N(zx,Aw,Bw),TP(new Q(null,2,5,S,[Aw,Bw],null),new Q(null,2,5,S,[Aw,Bw],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,Aw,Bw),Jz,function(e){return J(e)}],null),null)),Z(uF,N(eD,dD,new Q(null,1,5,S,[Ez],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[null,new Q(null,1,5,S,[Ez],null),null,new Q(null,1,5,S,[function(e){return J(e)}],null),function(e){return J(e)},new Q(null,1,5,S,[Ey],null),F,null,F,new Q(null,1,5,S,[Ez],null),new Q(null,1,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W))],null),null]))),Z(kq,SC,Ab),Z(hu,Yv,Te),Z(xn,jB,jB),Z(Xq,sC,sC),Z($q,N(eD,T,new Q(null,2,5,S,[xn,Xq],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[xn,Xq],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,iD)},function(e){return M(e,Nw)}],null),function(e){return J(e)&&M(e,iD)&&M(e,Nw)},F,new Q(null,2,5,S,[xn,Xq],null),null,new Q(null,2,5,S,[iD,Nw],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,iD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Nw))],null),null]))),Z(Rq,sC,sC),Z(eE,SC,Ab),Z(KA,Mw,Pe),Z(gA,N(eD,dr,new Q(null,2,5,S,[eE,KA],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[null,null,null,new Q(null,1,5,S,[function(e){return J(e)}],null),function(e){return J(e)},F,F,null,F,F,new Q(null,1,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W))],null),null]))),Z(SE,kq,kq),Z(YA,new uj(null,new k(null,2,[jn,"null",cz,"null"],null),null),new uj(null,new k(null,2,[jn,null,cz,null],null),null)),Z(cu,N(eD,T,new Q(null,2,5,S,[eE,YA],null),dD,new Q(null,3,5,S,[cq,gA,qA],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[eE,YA],null),new Q(null,3,5,S,[cq,gA,qA],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,kt)},function(e){return M(e,X)}],null),function(e){return J(e)&&M(e,kt)&&M(e,X)},new Q(null,3,5,S,[Pw,cz,pA],null),new Q(null,2,5,S,[eE,YA],null),null,new Q(null,2,5,S,[kt,X],null),new Q(null,3,5,S,[cq,gA,qA],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,kt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X))],null),null]))),Z(Pr,N(Zq,Rq,cu),aQ(N(zx,Rq,cu),TP(new Q(null,2,5,S,[Rq,cu],null),new Q(null,2,5,S,[Rq,cu],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,Rq,cu),Jz,function(e){return J(e)}],null),null)),Z(lr,Yv,Te),Z(hw,cu,cu),Z(Lu,N(eD,T,new Q(null,2,5,S,[DA,sw],null),dD,new Q(null,6,5,S,[nm,PF,tn,uF,hw,qA],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[DA,sw],null),new Q(null,6,5,S,[nm,PF,tn,uF,hw,qA],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,$s)},function(e){return M(e,Uz)}],null),function(e){return J(e)&&M(e,$s)&&M(e,Uz)},new Q(null,6,5,S,[Vt,CF,zr,tF,Sv,pA],null),new Q(null,2,5,S,[DA,sw],null),null,new Q(null,2,5,S,[$s,Uz],null),new Q(null,6,5,S,[nm,PF,tn,uF,hw,qA],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,$s)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Uz))],null),null]))),Z(pw,N(Zq,jB,Lu),aQ(N(zx,jB,Lu),TP(new Q(null,2,5,S,[jB,Lu],null),new Q(null,2,5,S,[jB,Lu],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,jB,Lu),Jz,function(e){return J(e)}],null),null)),Z(bz,N(Zq,N(Hp,Gy,SC,Er,new uj(null,new k(null,1,[qv,"null"],null),null)),N(xy,jB)),aQ(N(zx,N(WD,Gy,oC,Er,new uj(null,new k(null,1,[qv,"null"],null),null)),N(vm,jB)),TP(new Q(null,2,5,S,[N(Hp,Gy,SC,Er,new uj(null,new k(null,1,[qv,"null"],null),null)),N(xy,jB)],null),new Q(null,2,5,S,[WP(new Q(null,2,5,S,[Gy,Er],null),new Q(null,2,5,S,[SC,new uj(null,new k(null,1,[qv,"null"],null),null)],null),new Q(null,2,5,S,[Ab,new uj(null,new k(null,1,[qv,null],null),null)],null),null),aQ(jB,jB,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,jB),Jz,function(e){return Fe(e)}],null),null)],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,N(Hp,Gy,SC,Er,new uj(null,new k(null,1,[qv,"null"],null),null)),N(xy,jB)),Jz,function(e){return J(e)}],null),null)),Z(QF,N(xy,jB),aQ(jB,jB,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,jB),Jz,function(e){return Fe(e)}],null),null)),Z(Yz,Nt,Nt),Z(im,jo,jo),Z(Yy,By,By),Z(nB,N(Zq,sw,jB),aQ(N(zx,sw,jB),TP(new Q(null,2,5,S,[sw,jB],null),new Q(null,2,5,S,[sw,jB],null)),new k(null,7,[Um,function(e,t){return ee(t,0)},aF,P,Rv,!0,Jr,J,Fo,Wu,tD,N(Zq,sw,jB),Jz,function(e){return J(e)}],null),null)),Z(ns,Hs,Bb),Z(Vv,SC,Ab),Z(XA,un,pf),Z(ty,N(eD,T,new Q(null,2,5,S,[Vv,XA],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[Vv,XA],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,jw)},function(e){return M(e,Zu)}],null),function(e){return J(e)&&M(e,jw)&&M(e,Zu)},F,new Q(null,2,5,S,[Vv,XA],null),null,new Q(null,2,5,S,[jw,Zu],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,jw)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Zu))],null),null]))),Z(ID,SC,Ab),Z(lo,N(eD,T,new Q(null,2,5,S,[ty,ID],null),dD,new Q(null,11,5,S,[ns,Ny,pw,bz,QF,nB,Yz,Pr,ry,im,Yy],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[ty,ID],null),new Q(null,11,5,S,[ns,Ny,pw,bz,QF,nB,Yz,Pr,ry,im,Yy],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,pq)},function(e){return M(e,ho)}],null),function(e){return J(e)&&M(e,pq)&&M(e,ho)},new Q(null,11,5,S,[Cv,PE,wG,xB,Ip,Du,YC,nn,Lo,Dz,zu],null),new Q(null,2,5,S,[ty,ID],null),null,new Q(null,2,5,S,[pq,ho],null),new Q(null,11,5,S,[ns,Ny,pw,bz,QF,nB,Yz,Pr,ry,im,Yy],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pq)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ho))],null),null]))),Z(Kn,SC,Ab),Z(XE,tA,yf);var uQ,K2=Fg(P),L2=Fg(P),M2=Fg(P),N2=Fg(P),O2=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));function AQ(e){if(null!=e&&null!=e.Yc)e=e.Yc(e);else{var t=AQ[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=AQ._))throw Eb("Domain.info",e);e=t.g?t.g(e):t.call(null,e)}}return e}function BQ(e,t){if(null!=e&&null!=e.Zc)e=e.Zc(e,t);else{var n=BQ[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=BQ._))throw Eb("Domain.init",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function CQ(e,t){if(null!=e&&null!=e.Wc)e=e.Wc(e,t);else{var n=CQ[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=CQ._))throw Eb("Domain.destroy",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function DQ(e,t,n){if(null!=e&&null!=e.Xc)e=e.Xc(e,t,n);else{var r=DQ[ba(null==e?null:e)];if(null!=r)e=r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=DQ._))throw Eb("Domain.handle-message",e);e=r.j?r.j(e,t,n):r.call(null,e,t,n)}}return e}function EQ(e,t,n,r,i,o,l){this.id=e,this.cc=t,this.source=n,this.options=r,this.D=i,this.m=o,this.G=l,this.B=2230716170,this.M=139264}uQ=new Yk(Bd.h("gateway.common.spec.messages","message-body"),X,O2,K2,L2,M2,N2),Z(To,SC,Ab),Z(Vw,SC,Ab),Z(or,N(jz,jB),nQ(jB,jB,null)),Z(KG,N(eD,T,new Q(null,2,5,S,[Kn,XE],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[Kn,XE],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,wu)},function(e){return M(e,X)}],null),function(e){return J(e)&&M(e,wu)&&M(e,X)},F,new Q(null,2,5,S,[Kn,XE],null),null,new Q(null,2,5,S,[wu,X],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,wu)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X))],null),null]))),Z(Ix,N(eD,T,new Q(null,2,5,S,[sC,jB],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[sC,jB],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,UC)},function(e){return M(e,pG)}],null),function(e){return J(e)&&M(e,UC)&&M(e,pG)},F,new Q(null,2,5,S,[sC,jB],null),null,new Q(null,2,5,S,[UC,pG],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,UC)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG))],null),null]))),Z(TA,N(eD,T,new Q(null,1,5,S,[jB],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[jB],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,pG)}],null),function(e){return J(e)&&M(e,pG)},F,new Q(null,1,5,S,[jB],null),null,new Q(null,1,5,S,[pG],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG))],null),null]))),Z(Ko,N(Xy,KG,TA),ZP(new Q(null,2,5,S,[KG,TA],null),new Q(null,2,5,S,[KG,TA],null),null)),Z(Ql,N(Xy,KG,TA,N(eD,T,new Q(null,1,5,S,[sC],null))),ZP(new Q(null,3,5,S,[KG,TA,N(eD,T,new Q(null,1,5,S,[sC],null))],null),new Q(null,3,5,S,[KG,TA,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[sC],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,UC)}],null),function(e){return J(e)&&M(e,UC)},F,new Q(null,1,5,S,[sC],null),null,new Q(null,1,5,S,[UC],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,UC))],null),null]))],null),null)),uQ.C(null,Cx,(function(){return ZP(new Q(null,2,5,S,[KG,N(eD,T,new Q(null,2,5,S,[To,Vw],null),dD,new Q(null,1,5,S,[or],null))],null),new Q(null,2,5,S,[KG,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[To,Vw],null),new Q(null,1,5,S,[or],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,pE)&&M(e,In)},new Q(null,1,5,S,[pG],null),new Q(null,2,5,S,[To,Vw],null),null,new Q(null,2,5,S,[pE,In],null),new Q(null,1,5,S,[or],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))],null),null)})),uQ.C(null,jC,(function(){return ZP(new Q(null,2,5,S,[KG,N(eD,dD,new Q(null,1,5,S,[or],null))],null),new Q(null,2,5,S,[KG,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[null,new Q(null,1,5,S,[or],null),null,new Q(null,1,5,S,[function(e){return J(e)}],null),function(e){return J(e)},new Q(null,1,5,S,[pG],null),F,null,F,new Q(null,1,5,S,[or],null),new Q(null,1,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W))],null),null]))],null),null)})),Z(gr,N(Gx,yF,X),RP(yF,new Cd((function(){return uQ}),yF,Ri([Rs,Yo,CD,so,rs,cw,MG,oo,KC,wD],[Fn,hv,"gateway/common/spec/messages.cljc",23,1,8,8,Id,null,n(uQ)?uQ.md:null])))),Z(tp,yE,yE),Z(EE,N(eD,T,new Q(null,2,5,S,[DA,gr],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[DA,gr],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,$s)},function(e){return M(e,Ro)}],null),function(e){return J(e)&&M(e,$s)&&M(e,Ro)},F,new Q(null,2,5,S,[DA,gr],null),null,new Q(null,2,5,S,[$s,Ro],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,$s)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Ro))],null),null]))),Z(dE,N(eD,T,new Q(null,2,5,S,[tp,gr],null),dD,new Q(null,1,5,S,[DA],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[tp,gr],null),new Q(null,1,5,S,[DA],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,tB)},function(e){return M(e,Ro)}],null),function(e){return J(e)&&M(e,tB)&&M(e,Ro)},new Q(null,1,5,S,[$s],null),new Q(null,2,5,S,[tp,gr],null),null,new Q(null,2,5,S,[tB,Ro],null),new Q(null,1,5,S,[DA],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,tB)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Ro))],null),null]))),Z(xo,N(jz,N(xy,dE)),nQ(N(xy,dE),aQ(dE,dE,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,dE),Jz,function(e){return Fe(e)}],null),null),null)),Z(NE,Mw,Pe),Z(uv,N(eD,T,new Q(null,1,5,S,[NE],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[NE],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,gz)}],null),function(e){return J(e)&&M(e,gz)},F,new Q(null,1,5,S,[NE],null),null,new Q(null,1,5,S,[gz],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,gz))],null),null]))),uQ.C(null,nG,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[dz,sw,uv],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[dz,sw,uv],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,Fr)},function(e){return M(e,Uz)},function(e){return M(e,rb)}],null),function(e){return J(e)&&M(e,Fr)&&M(e,Uz)&&M(e,rb)},F,new Q(null,3,5,S,[dz,sw,uv],null),null,new Q(null,3,5,S,[Fr,Uz,rb],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fr)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Uz)),N(V,new Q(null,1,5,S,[W],null),N(U,W,rb))],null),null]))],null),null)})),Z(WB,jB,jB),uQ.C(null,$w,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[WB,To,Vw],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[WB,To,Vw],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,rw)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,rw)&&M(e,pE)&&M(e,In)},F,new Q(null,3,5,S,[WB,To,Vw],null),null,new Q(null,3,5,S,[rw,pE,In],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,rw)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))],null),null)})),Z(xu,N(jz,N(zx,N(jz,lo),N(jz,N(xy,dE)))),nQ(N(zx,N(jz,lo),N(jz,N(xy,dE))),TP(new Q(null,2,5,S,[N(jz,lo),N(jz,N(xy,dE))],null),new Q(null,2,5,S,[nQ(lo,lo,null),nQ(N(xy,dE),aQ(dE,dE,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,dE),Jz,function(e){return Fe(e)}],null),null),null)],null)),null)),h=EQ.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"id":return this.id;case"identity":return this.cc;case"source":return this.source;case"options":return this.options;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#gateway.state.peers.Peer{",", ","}",n,Of.h(new Q(null,4,5,S,[new Q(null,2,5,S,[kt,this.id],null),new Q(null,2,5,S,[Uz,this.cc],null),new Q(null,2,5,S,[$s,this.source],null),new Q(null,2,5,S,[Vt,this.options],null)],null),this.m))},h.xa=function(){return new Yh(this,4,new Q(null,4,5,S,[kt,Uz,$s,Vt],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 4+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=802532213^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.id,t.id)&&x.h(this.cc,t.cc)&&x.h(this.source,t.source)&&x.h(this.options,t.options)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,4,[Uz,null,$s,null,kt,null,Vt,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new EQ(this.id,this.cc,this.source,this.options,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"id":case"identity":case"source":case"options":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(kt,t):O.call(null,kt,t))?new EQ(r,this.cc,this.source,this.options,this.D,this.m,null):n(O.h?O.h(Uz,t):O.call(null,Uz,t))?new EQ(this.id,r,this.source,this.options,this.D,this.m,null):n(O.h?O.h($s,t):O.call(null,$s,t))?new EQ(this.id,this.cc,r,this.options,this.D,this.m,null):n(O.h?O.h(Vt,t):O.call(null,Vt,t))?new EQ(this.id,this.cc,this.source,r,this.D,this.m,null):new EQ(this.id,this.cc,this.source,this.options,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,4,5,S,[new xh(kt,this.id),new xh(Uz,this.cc),new xh($s,this.source),new xh(Vt,this.options)],null),this.m))},h.S=function(e,t){return new EQ(this.id,this.cc,this.source,this.options,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)};var FQ=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function GQ(e,t){if(null==t)throw cl("Peer id is missing",P);if(n(e=FQ.h(e,t)))return e;throw cl(["Unable to find peer with id ",p.g(t)].join(""),P)}function HQ(e,t,r){if(null==t)throw cl("Peer id is missing",P);if(n(e=FQ.j(e,t,r)))return e;throw cl(["Unable to find peer with id ",p.g(t)," in domain ",p.g(r)].join(""),P)}function IQ(e){return x.h(gz,dh.h(e,new Q(null,2,5,S,[$s,X],null)))}function JQ(e,t){return wk(D([Ng.g(Ag(FQ,e)),dh.h(e,new Q(null,2,5,S,[JB,t],null))]))}function KQ(e,t){var n=X.g(t);switch(n instanceof w?n.W:null){case"node":return x.h(zt.g(t),zt.g(e));case"peer":return x.h(zt.g(t),zt.g(e))&&x.h(em.g(t),em.g(e));case"local":return x.h(oz.g(t),oz.g(e));default:return!1}}function LQ(e,t){return wk(D([zg.h(Ng.g(Hh),Xg.g((function(e){return KQ($s.g(e),t)}))),wG.g(e)]))}function MQ(e,t,n){return wk(D([Xg.g((function(e){return KQ($s.g(e),t)})),JQ(e,n)]))}function NQ(e,t,r,i,o,l){var s,a=FQ.h(e,r);if(n(a)){var u=a;return new Q(null,2,5,S,[e,u],null)}s=new EQ(r,i,t,l,null,null,null),u=n(o)?I.j(s,Sv,o):s;var c=xr.h(i,qv);return a=function(){var t=eh(fh.F(eh(e,new Q(null,2,5,S,[Du,i],null),r),new Q(null,2,5,S,[xB,c],null),Dg(re,wj),r),new Q(null,2,5,S,[wG,r],null),u);return n(cp.g(l))?hh(t,Ip,Dg(re,wj),r):t}(),new Q(null,2,5,S,[a,u],null)}function OQ(e,t){var n=Uz.g(t),r=kt.g(t),i=xr.h(n,qv);return hh(hh(gh(hh(e,Du,we,n),xB,(function(e){var t=De.h(u.h(e,i),r);return z(t)?I.j(e,i,t):we.h(e,i)})),wG,we,r),Ip,Dg(De,wj),r)}function PQ(e,t,n){return eh(e,new Q(null,2,5,S,[wG,t],null),n)}function QQ(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;return $f(fh,arguments[0],new Q(null,2,5,S,[wG,arguments[1]],null),arguments[2],3<t.length?new Fd(t.slice(3),0,null):null)}FQ.h=function(e,t){return n(t)?dh.h(e,new Q(null,2,5,S,[wG,t],null)):null},FQ.j=function(e,t,r){return e=FQ.h(e,t),n(u.h(e,r))?e:null},FQ.I=3;var RQ=function e(t){switch(arguments.length){case 6:return e.oa(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function SQ(e,t,r,i){return wk(D([Xg.g((function(e){var o=RQ.j(t,r,e);return n(o)?o:n(i)?x.h(kt.g(e),kt.g(r)):i})),Of.h(JQ(e,t),Ng.h(Ag(FQ,e),Ip.g(e)))]))}function TQ(e,t,r,i){if(n(dh.h(r,new Q(null,2,5,S,[Vt,cp],null))))return SQ(e,t,r,i);var o=dh.h(r,new Q(null,2,5,S,[Uz,xr],null));return n(o)?wk(D([zg.h(Ng.g(Ag(FQ,e)),Xg.g((function(e){var o=u.h(e,t);return o=n(o)?RQ.j(t,r,e):o,n(o)?o:n(i)?x.h(kt.g(e),kt.g(r)):i}))),Of.h(dh.h(e,new Q(null,2,5,S,[xB,o],null)),Ip.g(e))])):SQ(e,t,r,i)}function UQ(e,t,n,r,i){return Nb.j((function(t,n){var o=Uz.g(n),l=kt.g(n),s=kt.g(i),a=IQ(i);return t=a?re.h(t,zI.oa(e,r,s,l,o,new k(null,1,[gz,a],null))):t,IQ(n)?re.h(t,zI.oa(e,$s.g(n),l,s,Uz.g(i),new k(null,1,[gz,a],null))):t}),F,TQ(n,t,i,!1))}function VQ(e,t,n,r,i,o){var l=kt.g(r);return new Q(null,2,5,S,[oI(n,l,t),Nb.j((function(t,n){return t=re.h(t,AI.O(e,$s.g(n),kt.g(n),l,i)),yb(o)?re.h(t,AI.O(e,$s.g(r),l,kt.g(n),i)):t}),F,TQ(n,t,r,!1))],null)}RQ.oa=function(e,t,r,i,o,l){return null==t&&null==o?(i=xr.g(i),e=xr.g(e),n(l)?l:n(r)?r:x.h(i,e)):n(r=hP(t,e,i))?hP(o,i,e):r},RQ.j=function(e,t,n){var r=Uz.g(t),i=dh.h(t,new Q(null,2,5,S,[e,Gp],null)),o=dh.h(t,new Q(null,2,5,S,[Vt,cp],null)),l=Uz.g(n);e=dh.h(n,new Q(null,2,5,S,[e,Gp],null));var s=dh.h(n,new Q(null,2,5,S,[Vt,cp],null));return(t=cg.h(kt.g(n),kt.g(t)))?RQ.oa(r,i,o,l,e,s):t},RQ.I=6;var WQ={kg:["BC","AD"],jg:["Before Christ","Anno Domini"],mg:"JFMAMJJASOND".split(""),sg:"JFMAMJJASOND".split(""),lg:"January February March April May June July August September October November December".split(" "),rg:"January February March April May June July August September October November December".split(" "),og:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),ug:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),xg:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),wg:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),qg:"Sun Mon Tue Wed Thu Fri Sat".split(" "),vg:"Sun Mon Tue Wed Thu Fri Sat".split(" "),hi:"SMTWTFS".split(""),tg:"SMTWTFS".split(""),pg:["Q1","Q2","Q3","Q4"],ng:["1st quarter","2nd quarter","3rd quarter","4th quarter"],gg:["AM","PM"],kf:["EEEE, MMMM d, y","MMMM d, y","MMM d, y","M/d/yy"],pf:["h:mm:ss a zzzz","h:mm:ss a z","h:mm:ss a","h:mm a"],hg:["{1} 'at' {0}","{1} 'at' {0}","{1}, {0}","{1}, {0}"],lf:6,ji:[5,6],mf:5},XQ=WQ;function YQ(e,t,n,r,i){return i=i||0,(e=new Date(e,t,n)).valueOf()+864e5*(((void 0!==r?r:3)-i+7)%7-((e.getDay()+6)%7-i+7)%7)}function ZQ(){}function $Q(e){if("number"==typeof e){var t=new ZQ;t.ve=e;var n=e;if(0==n)n="Etc/GMT";else{var r=["Etc/GMT",0>n?"-":"+"];n=Math.abs(n),r.push(Math.floor(n/60)%100),0!=(n%=60)&&r.push(":",Ya(n,2)),n=r.join("")}return t.df=n,0==(n=e)?n="UTC":(r=["UTC",0>n?"+":"-"],n=Math.abs(n),r.push(Math.floor(n/60)%100),0!=(n%=60)&&r.push(":",n),n=r.join("")),e=aR(e),t.ef=[n,n],t.cd={ii:e,nf:e},t.xe=[],t}return(t=new ZQ).df=e.id,t.ve=-e.std_offset,t.ef=e.names,t.cd=e.names_ext,t.xe=e.transitions,t}function aR(e){var t=["GMT"];return t.push(0>=e?"+":"-"),e=Math.abs(e),t.push(Ya(Math.floor(e/60)%100,2),":",Ya(e%60,2)),t.join("")}function bR(e,t){t=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes())/36e5;for(var n=0;n<e.xe.length&&t>=e.xe[n];)n+=2;return 0==n?0:e.xe[n-1]}function cR(e){this.qe=[],this.Ha=XQ,"number"==typeof e?dR(this,e):eR(this,e)}XQ=WQ;var fR=[/^'(?:[^']|'')*('|$)/,/^(?:G+|y+|Y+|M+|k+|S+|E+|a+|h+|K+|H+|c+|L+|Q+|d+|m+|s+|v+|V+|w+|z+|Z+)/,/^[^'GyYMkSEahKHcLQdmsvVwzZ]+/];function gR(e){return e.getHours?e.getHours():0}function eR(e,t){for(;t;){const n=t;for(let n=0;n<fR.length;++n){const r=t.match(fR[n]);if(r){let i=r[0];t=t.substring(i.length),0==n&&("''"==i?i="'":(i=i.substring(1,"'"==r[1]?i.length-1:i.length),i=i.replace(/''/g,"'"))),e.qe.push({text:i,type:n});break}}if(n===t)throw Error("Malformed pattern part: "+t)}}function dR(e,t){let n;if(4>t)n=e.Ha.kf[t];else if(8>t)n=e.Ha.pf[t-4];else{if(!(12>t))return void dR(e,10);n=e.Ha.hg[t-8],n=n.replace("{1}",e.Ha.kf[t-8]),n=n.replace("{0}",e.Ha.pf[t-8])}eR(e,n)}function jR(e,t){{t=String(t);const n=e.Ha||XQ;if(void 0!==n.yg){e=[];for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);e.push(48<=i&&57>=i?String.fromCharCode(n.yg+i-48):t.charAt(r))}t=e.join("")}}return t}cR.prototype.format=function(e,t){if(!e)throw Error("The date to format must be non-null.");var n=t?6e4*(e.getTimezoneOffset()-(t.ve-bR(t,e))):0;let r=n?new Date(e.getTime()+n):e,i=r;t&&r.getTimezoneOffset()!=e.getTimezoneOffset()&&(r=new Date(r.getTime()+6e4*(r.getTimezoneOffset()-e.getTimezoneOffset())),i=new Date(e.getTime()+(n+(0<n?-864e5:864e5)))),n=[];for(let o=0;o<this.qe.length;++o){const l=this.qe[o].text;1==this.qe[o].type?n.push(iR(this,l,e,r,i,t)):n.push(l)}return n.join("")};var hR=!1;function kR(e){if(!(e.getHours&&e.getSeconds&&e.getMinutes))throw Error("The date to format has no time (probably a goog.date.Date). Use Date or goog.date.DateTime, or use a pattern without time fields.")}function iR(e,t,n,r,i,o){var l=t.length;switch(t.charAt(0)){case"G":return n=0<r.getFullYear()?1:0,4<=l?e.Ha.jg[n]:e.Ha.kg[n];case"y":return 0>(n=r.getFullYear())&&(n=-n),2==l&&(n%=100),jR(e,Ya(n,l));case"Y":return 0>(n=new Date(YQ(r.getFullYear(),r.getMonth(),r.getDate(),e.Ha.mf,e.Ha.lf)).getFullYear())&&(n=-n),2==l&&(n%=100),jR(e,Ya(n,l));case"M":e:switch(n=r.getMonth(),l){case 5:l=e.Ha.mg[n];break e;case 4:l=e.Ha.lg[n];break e;case 3:l=e.Ha.og[n];break e;default:l=jR(e,Ya(n+1,l))}return l;case"k":return kR(i),jR(e,Ya(gR(i)||24,l));case"S":return jR(e,(i.getMilliseconds()/1e3).toFixed(Math.min(3,l)).substr(2)+(3<l?Ya(0,l-3):""));case"E":return n=r.getDay(),4<=l?e.Ha.xg[n]:e.Ha.qg[n];case"a":return kR(i),l=gR(i),e.Ha.gg[12<=l&&24>l?1:0];case"h":return kR(i),jR(e,Ya(gR(i)%12||12,l));case"K":return kR(i),jR(e,Ya(gR(i)%12,l));case"H":return kR(i),jR(e,Ya(gR(i),l));case"c":e:switch(n=r.getDay(),l){case 5:l=e.Ha.tg[n];break e;case 4:l=e.Ha.wg[n];break e;case 3:l=e.Ha.vg[n];break e;default:l=jR(e,Ya(n,1))}return l;case"L":e:switch(n=r.getMonth(),l){case 5:l=e.Ha.sg[n];break e;case 4:l=e.Ha.rg[n];break e;case 3:l=e.Ha.ug[n];break e;default:l=jR(e,Ya(n+1,l))}return l;case"Q":return n=Math.floor(r.getMonth()/3),4>l?e.Ha.pg[n]:e.Ha.ng[n];case"d":return jR(e,Ya(r.getDate(),l));case"m":return kR(i),jR(e,Ya(i.getMinutes(),l));case"s":return kR(i),jR(e,Ya(i.getSeconds(),l));case"v":return(l=o||$Q(n.getTimezoneOffset())).df;case"V":return e=o||$Q(n.getTimezoneOffset()),2>=l?e.df:0<bR(e,n)?void 0!==e.cd.ig?e.cd.ig:e.cd.DST_GENERIC_LOCATION:void 0!==e.cd.nf?e.cd.nf:e.cd.STD_GENERIC_LOCATION;case"w":return n=YQ(i.getFullYear(),i.getMonth(),i.getDate(),e.Ha.mf,e.Ha.lf),jR(e,Ya(Math.floor(Math.round((n-new Date(new Date(n).getFullYear(),0,1).valueOf())/864e5)/7)+1,l));case"z":return e=o||$Q(n.getTimezoneOffset()),4>l?e.ef[0<bR(e,n)?2:0]:e.ef[0<bR(e,n)?3:1];case"Z":return t=o||$Q(n.getTimezoneOffset()),4>l?(e=[0>(l=-(t.ve-bR(t,n)))?"-":"+"],l=Math.abs(l),e.push(Ya(Math.floor(l/60)%100,2),Ya(l%60,2)),l=e.join("")):l=jR(e,aR(t.ve-bR(t,n))),l;default:return""}}function lR(e,t){var n=Yf(Cj,e,t);return ke(n,Yg.h((function(e){return n===e}),t))}function mR(e,t){return C(e)<C(t)?Nb.j(re,t,e):Nb.j(re,e,t)}function nR(e,t,n){return e=lR(C,re.l(n,t,D([e]))),Nb.j(ah,A(e),Hd(e))}function oR(a){try{return aa.JSON.parse(a)}catch(e){}if(a=String(a),!/^\s*$/.test(a)&&/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/(?:"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)[\s\u2028\u2029]*(?=:|,|]|}|$)/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(e){}throw Error("Invalid JSON string: "+a)}function pR(e){const t=[];return qR(new rR,e,t),t.join("")}function rR(){this.ue=void 0}function qR(e,t,n){if(null==t)n.push("null");else{if("object"==typeof t){if(Array.isArray(t)){var r=t;t=r.length,n.push("[");for(var i="",o=0;o<t;o++)n.push(i),i=r[o],qR(e,e.ue?e.ue.call(r,String(o),i):i,n),i=",";return void n.push("]")}if(!(t instanceof String||t instanceof Number||t instanceof Boolean)){for(r in n.push("{"),o="",t)Object.prototype.hasOwnProperty.call(t,r)&&("function"!=typeof(i=t[r])&&(n.push(o),sR(r,n),n.push(":"),qR(e,e.ue?e.ue.call(t,r,i):i,n),o=","));return void n.push("}")}t=t.valueOf()}switch(typeof t){case"string":sR(t,n);break;case"number":n.push(isFinite(t)&&!isNaN(t)?String(t):"null");break;case"boolean":n.push(String(t));break;case"function":n.push("null");break;default:throw Error("Unknown type: "+typeof t)}}}var tR={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},uR=/\uffff/.test("")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function sR(e,t){t.push('"',e.replace(uR,(function(e){let t=tR[e];return t||(t="\\u"+(65536|e.charCodeAt(0)).toString(16).substr(1),tR[e]=t),t})),'"')}var vR=new Q(null,3,5,S,[3,12,0],null);function wR(e){return"string"==typeof e?x.h(e,"")?null:e:null}function xR(e){return"number"==typeof e?jf(e):"string"==typeof e?(e=parseInt(e,10),n(isNaN(e))?null:e):null}function yR(e,t,n){return ef(Ej(),cf((function(t,n){var r=G(n,0,null);return n=G(n,1,null),e.j?e.j(t,r,n):e.call(null,t,r,n)}),bf),t,n)}function zR(e,t){return Nb.j((function(t,r){return n(t=e.g?e.g(r):e.call(null,r))?Td(t):null}),null,t)}x.h("default","nodejs");var AR="undefined"!=typeof window?window:null;function BR(e){var t=G(e=TI(p.g(e),/-/,2),0,null);e=G(e,1,null);if("string"!=typeof t)throw new TypeError("re-seq must match against a string.");return t=n(t=Rj(/\d+/,t))?bh.h(xR,t):null,new k(null,2,[bD,t,gC,n(e)?e.toLowerCase():null],null)}function CR(e){var t=G(vR,0,null),r=G(vR,1,null),i=G(vR,2,null),o=Le(e)?e:bD.g(BR(e));e=G(o,0,null);var l=G(o,1,null);if(o=G(o,2,null),o=bh.h((function(e){return n(e)?e:0}),new Q(null,3,5,S,[e,l,o],null)),e=G(o,0,null),l=G(o,1,null),o=G(o,2,null),!(t>e||x.h(t,e)&&(r>l||x.h(r,l)&&i>=o)))throw cl("Insufficient `com.taoensso/encore` version, you may have a dependency conflict: see http://goo.gl/qBbLvC for solutions.",new k(null,2,[Xu,RI(".",new Q(null,3,5,S,[e,l,o],null)),kB,RI(".",new Q(null,3,5,S,[t,r,i],null))],null))}var DR=function e(t){switch(arguments.length){case 3:return e.j(arguments[0],arguments[1],arguments[2]);case 2:return e.h(arguments[0],arguments[1]);default:for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],arguments[2],new Fd(n.slice(3),0,null))}};DR.j=function(e,t,n){return M(e,t)?e:I.j(e,t,n)},DR.l=function(e,t,n,r){return yR(DR,DR.j(e,t,n),r)},DR.J=function(e){var t=A(e),n=B(e);e=A(n);var r=B(n);return n=A(r),r=B(r),this.l(t,e,n,r)},DR.h=function(e,t){return af((function(e,t,n){return M(e,t)?e:I.j(e,t,n)}),null==e?P:e,t)},DR.I=3;var ER=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};ER.h=function(e,t){t=0>t?0:t;var n=C(e);return t>=n?F:Nh(e,t,n)},ER.j=function(e,t,n){t=0>t?0:t;var r=jf(C(e));return t>=(n=n>r?r:n)?F:Nh(e,t,n)},ER.I=3;var FR=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function GR(e){return 1<C(e)?Nh(e,1,C(e)):F}function HR(e,t){this.n=e,this.$e=t}function IR(e,t){this.n=e,this.ff=t}function JR(e,t,n){this.Ye=e,this.fg=t,this.jf=n}function KR(e){if(J(e))return af((function(e,t,n){var r=G(n,0,null);return n=G(n,1,null),I.j(e,t,new HR(r,n))}),P,e);if(Le(e)){var t=new Lg(-1);return Nb.j((function(e,r){var i=G(r,0,null),o=G(r,1,null);return r=G(r,2,null),I.j(e,n(r)?r:t.ld(null,t.Jb(null)+1),new HR(i,o))}),P,e)}throw cl("`encore/cond!`: no matching clause",P)}function LR(e){function t(e,t){var s=(new Date).getTime();for(yb(t)&&625e-7>=Math.random()&&(Gg(i,null),Ig.h(o,(function(e){return Zc(af((function(e,t,r){return Ee(r=af((function(e,t,r){var i=u.h(l,t);return n(i)?s>=r.ff+i.$e?we.h(e,t):e:we.h(e,t)}),r,r))?ad(e,t):$c(e,t,r)}),Xc(n(e)?e:P),e))})));;){var a=r(o),c=u.h(a,e),h=null==c?null:af(function(e,t,r,i,o,l){return function(e,t,i){var o=u.h(l,t);return n(o)?i.n<o.n||0>=(i=i.ff+o.$e-r)?e:null==e?new JR(ve([t,i]),t,i):i>e.jf?new JR(I.j(e.Ye,t,i),t,i):new JR(I.j(e.Ye,t,i),e.fg,e.jf):e}}(0,0,s,0,0,l),null,c);return n(n(t)?t:h)?n(t=h)?new Q(null,3,5,S,[(e=t).fg,e.jf,e.Ye],null):null:(n(t=r(i))||(c=af(function(e,t,r,i,o){return function(e,t,i){var l=I.j,s=u.h(r,t);if(n(s)){var a=s.ff;i=o>=a+i.$e?new IR(1,o):new IR(s.n+1,a)}else i=new IR(1,o);return l.call(I,e,t,i)}}(0,0,c,0,s),c,l),Gg(o,I.j(a,e,c))),null)}}if(Ee(e))return new Q(null,2,5,S,[null,yg(null)],null);var i=Fg(null),o=Fg(null),l=KR(e);return new Q(null,2,5,S,[o,function(){function e(e,r){if(n(O.h?O.h(e,wr):O.call(null,e,wr)))return n(O.h?O.h(r,VA):O.call(null,r,VA))?Gg(o,null):Ig.j(o,we,r),null;if(n(O.h?O.h(e,DD):O.call(null,e,DD)))return t(r,!0);throw cl("Unrecognized rate limiter command",new k(null,2,[Po,e,Hq,r],null))}function r(e){return t(e,!1)}function i(){return t(null,!1)}var l;return l=function(t,n){switch(arguments.length){case 0:return i.call(this);case 1:return r.call(this,t);case 2:return e.call(this,t,n)}throw Error("Invalid arity: "+arguments.length)},l.A=i,l.g=r,l.h=e,l}()],null)}FR.h=function(e,t){var n=C(e);return 0>t?Nh(e,0>(t+=n)?0:t,n):t>=n?F:Nh(e,t,n)},FR.j=function(e,t,n){if(0>=n)return F;var r=jf(C(e));return 0>t?Nh(e,t=0>(t+=r)?0:t,(n=t+n)>r?r:n):t>=(r=(n=t+n)>r?r:n)?F:Nh(e,t,r)},FR.I=3,function(){var e,t=Ia(AR,Cf("performance"),null);if(n(t)){var r=n(e=Ia(t,Cf("now"),null))||n(e=Ia(t,Cf("mozNow"),null))||n(e=Ia(t,Cf("msNow"),null))||n(e=Ia(t,Cf("oNow"),null))?e:Ia(t,Cf("webkitNow"),null);return n(r)?function(){return 1e6*jf(r.call(t))}:function(){return 1e6*(new Date).getTime()}}}();var MR=function(){function e(e){return new Za(e)}function t(){return new Za}var n;return n=function(n){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,n)}throw Error("Invalid arity: "+arguments.length)},n.A=t,n.g=e,n}(),NR=function(){function e(e,t){return e=e instanceof Za?e:MR.g(p.g(e)),t=p.g(t),e.append(t)}function t(e){return e instanceof Za?e:MR.g(p.g(e))}function n(){return MR.A()}var r;return r=function(r,i){switch(arguments.length){case 0:return n.call(this);case 1:return t.call(this,r);case 2:return e.call(this,r,i)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=t,r.h=e,r}();function OR(e,t){if(n(n(" ")?cg.h(" ",""):" ")){var r=Vg(),i=cf(NR,p);return n(e)?df(zg.h(e,r),i,t):df(r,i,t)}return n(e)?df(e,cf(NR,p),t):p.g(Nb.h(NR,t))}var PR=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};PR.h=function(e,t){return e.substring(t)},PR.j=function(e,t,n){return t>=n?"":e.substring(t,n)},PR.I=3;var QR=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function RR(e){return void 0===e||null==e?"nil":e}QR.h=function(e,t){return wR(e.substr(t))},QR.j=function(e,t,n){return wR(e.substr(t,n))},QR.I=3,bh.h(p,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_");var SR=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};function S2(){return!0}function P3(){return!1}function Q3(e){return cg.h(-1,e.indexOf("*"))?Sj(QI(QI(["^",p.g(e),"$"].join(""),".","\\."),"*","(.*)")):null}function R3(e,t){for(;;){if(n((c=void 0,(c=new uj(null,new k(null,2,["*",null,lm,null],null),null)).g?c.g(e):c.call(null,e))))return S2;if(n(function(){var t=xj([F,wj,Mv]);return t.g?t.g(e):t.call(null,e)}()))return P3;if(e instanceof RegExp)return function(e){return function(t){return Qj(e,t)}}(e);if("string"==typeof e){var r=Q3(e);if(!n(r))return function(e){return function(t){return x.h(t,e)}}(e);var i=t;e=r,t=i}else{if(!Le(e)&&!Ge(e))throw cl("Unexpected compile spec type",new k(null,2,[Po,e,X,Db(e)],null));if(n(function(){var t=yj(e);return t.g?t.g("*"):t.call(null,"*")}()))return S2;if(!x.h(C(e),1)){var o=Nb.j(function(e,t,r,i,o){return function(e,t){var r=G(e,0,null);e=G(e,1,null);var i=t instanceof RegExp?t:o(t);return n(i)?new Q(null,2,5,S,[r,re.h(e,i)],null):new Q(null,2,5,S,[re.h(r,t),e],null)}}(0,0,0,0,Q3),new Q(null,2,5,S,[wj,F],null),e),l=G(o,0,null),s=G(o,1,null),a=dg(l),u=function(){var e,r=dg(s);return n(r)?(e=r,r=function(t){return zR((function(e){return Qj(e,t)}),e)},n(t)?Hk(r):r):null}();if(n(function(){var e=a;return n(e)?u:e}()))return function(e,t,r,i,o,l,s){return function(e){var t=l.g?l.g(e):l.call(null,e);return n(t)?t:s.g?s.g(e):s.call(null,e)}}(0,0,0,0,0,a,u);if(n(a))return a;if(n(u))return u;throw cl("`encore/cond!`: no matching clause",P)}r=A(e),e=r,t=i=t}}var c}function YR(e){for(;;){if(J(e)){var t=u.h(e,Sx),r=function(){var t=u.h(e,uu);return n(t)?t:u.h(e,cs)}(),i=function(){var t=u.h(e,At);return n(t)?t:u.h(e,NF)}(),o=function(){var e=r;return n(e)?R3(e,t):null}(),l=function(){var e=i;return n(e)?R3(e,t):null}();if(x.h(l,S2)||x.h(o,P3))return P3;if(n(function(){var e=o;return n(e)?l:e}()))return function(e,t,r,i,o,l){return function(e){return e=p.g(e),!!n(o.g?o.g(e):o.call(null,e))&&!n(l.g?l.g(e):l.call(null,e))}}(0,0,0,0,o,l);if(n(o))return x.h(o,S2)?S2:function(e,t,r,i,o){return function(e){return e=p.g(e),!!n(e=o.g?o.g(e):o.call(null,e))}}(0,0,0,0,o);if(n(l))return x.h(l,P3)?S2:function(e,t,r,i,o,l){return function(e){return e=p.g(e),!!n(e=l.g?l.g(e):l.call(null,e))}}(0,0,0,0,0,l);throw cl("compile-str-filter: `allow-spec` and `deny-spec` cannot both be nil",new k(null,2,[ov,r,mp,i],null))}e=new k(null,2,[uu,e,At,null],null)}}function ZR(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;return $R(0<t.length?new Fd(t.slice(0),0,null):null)}function $R(e){return G(e,0,null),new k(null,6,[NB,!0,aw,!1,ny,null,iy,null,qo,IE,Ir,function(e){return e=bg(e),lk(D([uk(e=u.h(e,no))]))}],null)}function aS(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;return bS(0<t.length?new Fd(t.slice(0),0,null):null)}function bS(e){return G(e,0,null),new k(null,6,[NB,!0,aw,!1,ny,null,iy,null,qo,IE,Ir,"undefined"==typeof console?function(){return null}:function(e){var t=function(e){var t=function(){var t=e instanceof w?e.W:null;switch(t){case"trace":return console.trace;case"debug":return console.debug;case"info":case"report":return console.info;case"warn":return console.warn;case"error":case"fatal":return console.error;default:throw Error(["No matching clause: ",p.g(t)].join(""))}}();return n(t)?t:console.log}(bE.g(e));if(n(t)){if(n(function(){var t=u.h(e,Op);return n(t)?t:dh.h(e,new Q(null,2,5,S,[Iw,Op],null))}())){var r=function(){var t=I.l(e,hn,"",D([Gs,null])),n=qo.g(e);return n.g?n.g(t):n.call(null,t)}(),i=function(){var t=$r.g(e),i=Gs.g(e);return n(i)?ke(r,ke(i,t)):ke(r,t)}();return t.apply(console,Mb(i))}return t.call(console,uk(no.g(e)))}return null}],null)}SR.l=function(e){var t=bg(e);e=u.h(t,Fs);var r=u.h(t,kA),i=u.h(t,CA),o=u.h(t,wC),l=u.h(t,Au),s=u.h(t,uC),a=u.h(t,cx),c=u.h(t,Ap);return t=u.h(t,Fz),Math.round((n(t)?31536e6*t:0)+(n(o)?2551392e3*o:0)+(n(r)?6048e5*r:0)+(n(a)?864e5*a:0)+(n(c)?36e5*c:0)+(n(s)?6e4*s:0)+(n(l)?1e3*l:0)+(n(i)?i:0)+(n(e)?e:0))},SR.I=0,SR.J=function(e){return this.l(z(e))},zg.h((function(e){return kf(jf(e),1e3)}),SR),zg.h(dg,ER),zg.h(dg,FR),zg.h(wR,PR),zg.h(wR,QR),Le(vR)?CR(new Q(null,3,5,S,[2,126,2],null)):CR(2.126);var cS=new k(null,1,[Vl,DC],null),dS=function e(t){switch(arguments.length){case 1:return e.g(arguments[0]);case 2:return e.h(arguments[0],arguments[1]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};dS.g=function(e){return dS.h(null,e)},dS.h=function(e,t){var r=bg(e),i=u.h(r,ZF);u.h(r,Fv);var o=bg(t);t=u.h(o,bE),r=u.h(o,Gs);var l=u.h(o,hn),s=u.h(o,jy),a=u.h(o,FG);u.h(o,Jt);var c=u.h(o,Km);return o=u.h(o,Qo),[n(c=uk(c))?[p.g(c)," "].join(""):null,Cf(t).toUpperCase()," [",p.g(n(s)?s:n(a)?a:"?"),":",p.g(n(o)?o:"?"),"] - ",p.g(uk(l)),n(i)?null:n(r)?["\n",p.g(eS?eS(r):fS.call(null,r,e))].join(""):null].join("")},dS.I=2;var gS=new k(null,6,[ny,it,Dt,new uj(null,new k(null,1,["*",null],null),null),cv,F,Lq,cS,qo,dS,dA,"undefined"!=typeof window?new k(null,1,[Uo,aS.g?aS.g(P):aS.call(null,P)],null):new k(null,1,[mn,ZR.g?ZR.g(P):ZR.call(null,P)],null)],null);function hS(e){function t(){return e}return iS.g?iS.g(t):iS.call(null,t)}function iS(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;return gS=Yf(arguments[0],gS,1<t.length?new Fd(t.slice(1),0,null):null)}function jS(e){switch(e instanceof w?e.W:null){case"trace":return 0;case"debug":return 1;case"info":return 2;case"warn":return 3;case"error":return 4;case"fatal":return 5;case"report":return 6;default:return null}}function kS(e){if(n(jS(e)))return e;throw cl("Invalid Timbre logging level: should be e/o #{:trace :debug :info :warn :error :fatal :report}",new k(null,2,[Po,e,X,Db(e)],null))}function lS(e){var t=jS(e);if(n(t))return t;throw cl("Invalid Timbre logging level: should be e/o #{:trace :debug :info :warn :error :fatal :report}",new k(null,2,[Po,e,X,Db(e)],null))}function mS(e,t){return(lS.g?lS.g(e):lS.call(null,e))>=(lS.g?lS.g(t):lS.call(null,t))}var nS=Hk((function(e){return YR(e)})),oS=Hk((function(e,t){return(e=nS(e)).g?e.g(t):e.call(null,t)}));function pS(e,t){return e=n(xe.g?xe.g(e):xe.call(null,e))?e.g?e.g(t):e.call(null,t):oS(e,t),!!n(e)}var qS=Hk((function(e,t){return zR((function(e){var r=G(e,0,null);return e=G(e,1,null),n(oS(r,t))?kS(e):null}),e)}));function rS(e,t,r){return e=n(t=Le(t)?qS(t,r):t)?t:e,kS.g?kS.g(e):kS.call(null,e)}function sS(e){if(n(e)){var t=xj([F,wj]);e=n(t=t.g?t.g(e):t.call(null,e))?null:e}else e=null;return e}function tS(e,t){return e=sS(e),t=sS(t),n(n(e)?e:t)?new k(null,2,[uu,e,At,t],null):null}function uS(e,t,r,i){var o,l=n(i)?i:gS;return o=n(o=u.h(l,ny))?o:u.h(l,bE),i=rS.j?rS.j(e,o,r):rS.call(null,e,o,r),!!n(mS.h?mS.h(t,i):mS.call(null,t,i))&&(t=function(){var e=u.h(l,Dt);if(n(e))return e;e=u.h(l,QE);var t=u.h(l,uy);return tS.h?tS.h(e,t):tS.call(null,e,t)}(),!n(t)||!!n(pS.h?pS.h(t,r):pS.call(null,t,r)))}function vS(e){return OR(Ng.g((function(e){return Ke(e=RR(e))?hk.l(D([e])):e})),e)}var wS=Hk((function(e,t){return G(e=LR(t),0,null),G(e,1,null)}));function xS(e,t){var r,i=O.h?O.h(au,au):O.call(null,au,au),o=O.h?O.h(e,uE):O.call(null,e,uE),l=G(t,0,null);if(n(n(i)?l instanceof Error:i)){e=l;var s=null,a=GR(t);return t=n(o)?G(a,0,null):null,o=n(o)?GR(a):a,new Q(null,4,5,S,[e,s,t,o],null)}s=n((r=J(l))?rb.g(Ae(l)):r)?l:null,e=function(){var e=Pm.g(s);return n(e)?e:n(i)?null:au}();var u=we.h(s,Pm);return a=n(u)?GR(t):t,t=n(o)?G(a,0,null):null,o=n(o)?GR(a):a,new Q(null,4,5,S,[e,u,t,o],null)}function yS(e,t,i,o,l,s){var a,c=gS;if(uS(fC,e,t,c)){var h=new Date;l=r(l);var d=G(l=xS(o,l),0,null),f=G(l,1,null),g=G(l,2,null);if(l=G(l,3,null),h=re.h(n(null)?null:P,Ri([Eu,Wl,Ts,$r,FG,Qq,jy,bE,Gs,Fp,Qo,ZD,Iw,RD],[h,null,c,l,null,(a=new uj(null,new k(null,2,[ds,null,Cx,null],null),null),a.g?a.g(e):a.call(null,e)),t,e,d,null,i,new qk((function(){return d})),f,g])),h=Nb.j((function(e,t){return null==(e=t.g?t.g(e):t.call(null,e))?Td(null):e}),h,cv.g(c)),n(h)){l=bg(h);var w=u.h(l,$r);h=I.j(h,et,new qk((function(){return w})));var m=DR.l(h,hn,new qk((function(){if(x.h(null,o))return"";if(x.h(lE,o))return vS(w);if(x.h(uE,o)){if("string"!=typeof g)throw cl("Timbre format-style logging call without a format pattern (string)",new k(null,2,[bE,e,aq,[p.g(n(t)?t:n(null)?null:"?"),":",p.g(n(i)?i:"?")].join("")],null));return Yf(SN,n(g)?g:"",bh.h(RR,w))}throw Error(["No matching clause: ",p.g(o)].join(""))})),D([tx,new qk((function(){return xd(new Q(null,3,5,S,[s,g,u.j(f,vx,w)],null))}))])),v=Hk(u.j(c,qo,dS)),y=re.h(cS,u.h(c,Lq)),b=Hk((function(e){return new qk((function(){var t=u.h(m,Eu),r=bg(e);return r=u.h(r,Vl),n(O.h?O.h(r,DC):O.call(null,r,DC))?new Date(t).toISOString():new cR(r).format(t)}))}));af((function(r,i,o){if(n(n(d=NB.g(o))?uS(Cy,e,t,o):d)){var l=iy.g(o);if(function(){var e=Ee(l);if(e)return e;e=wS(i,l);var t=uk(tx.g(m));return yb(e=e.g?e.g(t):e.call(null,t))}()){var s=bg(o);r=u.h(s,Ir),u.h(s,aw);var a=function(){var e=qo.g(o),t=(t=null==e)?t:O.h?O.h(e,IE):O.call(null,e,IE);return n(t)?v:e}(),c=function(){var e=Lq.g(o),t=(t=null==e)?t:O.h?O.h(e,IE):O.call(null,e,IE);return n(t)?b(y):b(re.h(y,e))}(),h=re.h(m,new k(null,5,[$n,i,Lw,o,qo,a,no,new qk((function(){var e=I.j(m,Km,c);return a.g?a.g(e):a.call(null,e)})),Km,c],null));return s=function(){var e=qu.g(o);return n(e)?e.g?e.g(h):e.call(null,h):h}(),n(s)?r.g?r.g(s):r.call(null,s):null}}var d;return null}),null,dA.g(c))}}return null}function fS(e){switch(arguments.length){case 1:case 2:return eS(arguments[0]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}}function eS(e){var t=e.stack;return n(t)?t:p.g(e)}function zS(e,t,n){var r=zS[ba(null)];if(null!=r)r.F?r.F(null,e,t,n):r.call(null,null,e,t,n);else{if(null==(r=zS._))throw Eb("Measurements.record!",null);r.F?r.F(null,e,t,n):r.call(null,null,e,t,n)}}function AS(e){if(null!=e&&null!=e.Jf)e.Jf(e);else{var t=AS[ba(null==e?null:e)];if(null!=t)t.g?t.g(e):t.call(null,e);else{if(null==(t=AS._))throw Eb("Node.close",e);t.g?t.g(e):t.call(null,e)}}}function BS(e,t){if(null!=e&&null!=e.Kf)e.Kf(e,t);else{var n=BS[ba(null==e?null:e)];if(null!=n)n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=BS._))throw Eb("Node.message",e);n.h?n.h(e,t):n.call(null,e,t)}}}function CS(e,t){if(null==e||null==e.fh){var n=CS[ba(null==e?null:e)];if(null!=n)n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=CS._))throw Eb("Node.add-source",e);n.h?n.h(e,t):n.call(null,e,t)}}}function DS(e,t){if(null!=e&&null!=e.Lf)e.Lf(e,t);else{var n=DS[ba(null==e?null:e)];if(null!=n)n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=DS._))throw Eb("Node.remove-source",e);n.h?n.h(e,t):n.call(null,e,t)}}}function ES(e,t,r){if(r=pG.g(r),n(n(e=FQ.h(e,r))?cg.h(t,$s.g(e)):e))throw cl(["The original source of peer ",p.g(r)," doesnt match the current source"].join(""),P)}function FS(e,t,r){return Nb.j((function(t,r){var i=G(t,0,null);t=G(t,1,null),yS(it,"gateway.node",33,lE,new qk((function(){return new Q(null,2,5,S,["about to remove source from domain",AQ(r)],null)})),-1725873782);var o=DQ(r,i,e);return n(o)?(i=G(o,0,null),o=G(o,1,null),yS(it,"gateway.node",36,lE,new qk((function(){return new Q(null,2,5,S,["removed source from domain",AQ(r)],null)})),-1884391675),new Q(null,2,5,S,[i,ah.h(t,o)],null)):new Q(null,2,5,S,[i,t],null)}),new Q(null,2,5,S,[t,F],null),Xg.h(zb,re.h(bh.h((function(e){return G(e,0,null),e=G(e,1,null),wu.g(e)}),we.h(r,"global")),dh.h(r,new Q(null,2,5,S,["global",wu],null)))))}function GS(e,t,r,i,o){try{if(x.h(zB,X.g(o)))return FS(r,t,e);var l=dh.h(e,new Q(null,2,5,S,[wu.h(o,"global"),wu],null));return n(l)?(yS(it,"gateway.node",59,lE,new qk((function(){return new Q(null,4,5,S,["Handling message with domain",l,"message: \n",p.g(r)],null)})),1168230188),ES(t,i,o),DQ(l,t,r)):new Q(null,2,5,S,[t,new Q(null,1,5,S,[wI.O(wu.g(o),i,UC.g(o),pG.g(o),lI("global.errors.failure",["Unable to find domain for message ",p.g(r)].join("")))],null)],null)}finally{n(e=X.g(o))&&n(null)&&zS(Lr,["inv/",Cf(e)].join(""),0)}}var HS={};function IS(e){e=aI(e);var t=X.g(e);return n(t)?I.j(e,X,Bf.g(t)):e}function JS(e,t,i,o){e=IS(e);var l=dh.h(r(t),new Q(null,2,5,S,[o,$s],null));if(n(l)){x.h(my,X.g(e))||BS(i,new k(null,3,[ut,gz,$s,l,Ro,e],null));var s=(new Date).getTime();return Ig.h(t,(function(e){return eh(e,new Q(null,2,5,S,[o,oA],null),s)}))}return yS(tz,"gateway.cljs.common",31,lE,new qk((function(){return new Q(null,2,5,S,["Cannot process message for not-registered key",o],null)})),1304480393)}function KS(e,t){XH(oz.g(e));try{DS(t,e)}catch(e){if(!(e instanceof Error))throw e;var n=e;yS(Cx,"gateway.cljs.common",39,lE,new qk((function(){return new Q(null,3,5,S,[n,"Unable to remove client for",Gh],null)})),55484312)}}function LS(e,t,r){yS(pD,"gateway.cljs.common",43,lE,new qk((function(){return new Q(null,2,5,S,["removing client for",r],null)})),1631725028);var i=G(e=Kg(e,r),0,null);G(e,1,null),n(e=dh.h(i,new Q(null,2,5,S,[r,$s],null)))&&KS(e,t)}function MS(e,t,n,r){Ig.F(e,I,n,new k(null,2,[$s,r,oA,(new Date).getTime()],null)),CS(t,r)}function NS(e,t,n){return ah.h(P,function(){function r(e){return G(e,0,null),e=G(e,1,null),oA.g(e)<t}return e.h?e.h(r,n):e.call(null,r,n)}())}function OS(e,t,n){yS(it,"gateway.cljs.common",61,lE,new qk((function(){return new Q(null,2,5,S,["running client scavenger. collecting everything older than",n],null)})),-1542705052);for(var r=G(e=Jg(e,Bg(NS,Yg,n)),0,null),i=(G(e,1,null),z(NS(Xg,n,r))),o=null,l=0,s=0;;)if(s<l){var a=o.$(null,s),u=G(a,0,null),c=G(a,1,null),h=$s.g(c);yS(pD,"gateway.cljs.common",66,lE,new qk(function(e,t,n,r,i,o,l){return function(){return new Q(null,2,5,S,["scavenging client for",l],null)}}(0,0,0,0,0,0,u)),641848866),KS(h,t),s+=1}else{if(!(h=z(i)))break;if(Me(a=h))i=ed(a),s=fd(a),o=i,l=C(i),i=s;else{var d=A(a);u=G(d,0,null),c=G(d,1,null);var f=$s.g(c);yS(pD,"gateway.cljs.common",66,lE,new qk(function(e,t,n,r,i,o,l){return function(){return new Q(null,2,5,S,["scavenging client for",l],null)}}(0,0,0,0,0,0,u)),1832245127),KS(f,t),i=B(a),o=null,l=0}s=0}}function PS(e,t,n){this.ga=e,this.n=t,this.we=0,this.pe=n,this.B=2,this.M=0}function QS(e,t){return new PS(cH(e),e,t)}PS.prototype.Fd=function(){return!1},PS.prototype.ce=function(e,t){return this.ga.length!==this.n?this.ga.unshift(t):(this.we+=1,n(this.pe)&&(this.pe.h?this.pe.h(t,this.we):this.pe.call(null,t,this.we))),this},PS.prototype.da=function(){return this.ga.length};var RS={},q2;function TS(e,t,r,i){var o=OH(1);return sH((function(){var t,l=function(){function t(t){var o=t[1];if(7===o)return t[2]=t[2],t[1]=3,fv;if(1===o)return t[2]=null,t[1]=2,fv;if(4===o)return o=t[7],o=t[2],t[7]=o,t[1]=n(o)?5:6,fv;if(13===o)return t[2]=null,t[1]=14,fv;if(6===o)return t[2]=null,t[1]=7,fv;if(3===o)return NH(t,t[2]);if(12===o)return o=t[7],o=Ak(o),o=e.h?e.h(i,o):e.call(null,i,o),t[2]=o,t[1]=14,fv;if(2===o)return MH(t,4,r);if(11===o){if(t[4]=Hd(t[4]),o=t[2],t[5]=o,!(o instanceof Error))throw o;return t[1]=10,t[5]=null,fv}if(9===o)return t[8]=t[2],t[2]=null,t[1]=2,fv;if(5===o)return t[2]=null,t[1]=8,fv;if(14===o)return o=t[2],t[4]=Hd(t[4]),t[2]=o,t[1]=9,fv;if(10===o){o=t[7];var l=t[2];return o=yS(Cx,"gateway.cljs.local-client",15,lE,new qk((function(){return new Q(null,2,5,S,[l,"error while invoking the client callback"],null)})),1731654278),t[2]=o,t[1]=9,fv}return 8===o?(t[4]=ke(11,t[4]),t[1]=n(e)?12:13,fv):null}return function(){function e(e){for(;;){e:try{for(;;){var n=t(e);if(!O(n,fv)){var r=n;break e}}}catch(t){if(r=t,e[2]=r,!z(e[4]))throw r;e[1]=A(e[4]),r=fv}if(!O(r,fv))return r}}function n(){var e=[null,null,null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(t){switch(arguments.length){case 0:return n.call(this);case 1:return e.call(this,t)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=e,r}()}();return LH(((t=l())[6]=o,t))})),new k(null,3,[X,gz,oz,r,yv,hE.h(t,"127.0.0.1")],null)}function US(e,t){return n(n(e)?t:e)&&(e=r(e),LS(kw.g(e),zt.g(e),t),yS(pD,"gateway.cljs.local-client",27,lE,new qk((function(){return new Q(null,1,5,S,["local client disconnected"],null)})),1156787933)),Promise.resolve(!0)}function VS(e,t,i){if(n(n(e)?t:e)){yS(it,"gateway.cljs.local-client",33,lE,new qk((function(){return new Q(null,3,5,S,["Processing incoming message",i,"from local client"],null)})),1270995320);var o=Ek(i);return e=r(e),JS(o,kw.g(e),zt.g(e),t)}return null}function WS(e,t){var n=r(e),i=dh.j(n,new Q(null,3,5,S,[Ts,kw,UD],null),100),o=OH(QS(i,(function(e,t){return yS(tz,"gateway.cljs.local-client",45,lE,new qk((function(){return new Q(null,5,5,S,["Dropped message",e," for a local client. Total dropped:",t,". Consider increasing local clients buffer_size."],null)})),584385440)}))),l=(void 0!==RH&&void 0!==HS&&void 0!==RS&&void 0!==q2||(q2=function(e,t,n,r,i,o){this.Ve=e,this.Zd=t,this.qd=n,this.sh=r,this.ch=i,this.Ci=o,this.B=393216,this.M=0},q2.prototype.S=function(e,t){return new q2(this.Ve,this.Zd,this.qd,this.sh,this.ch,t)},q2.prototype.R=function(){return this.Ci},q2.prototype.disconnect=function(){return US(this.Ve,this.ch)},q2.prototype.send=function(e){return VS(this.Ve,this.ch,e)},q2.Na=!0,q2.Ja="gateway.cljs.local-client/t_gateway$cljs$local_client13740",q2.Pa=function(e){return Qc(e,"gateway.cljs.local-client/t_gateway$cljs$local_client13740")}),new q2(e,t,n,i,o,P));yS(pD,"gateway.cljs.local-client",49,lE,new qk((function(){return new Q(null,2,5,S,["local client connected, buffer-size: ",i],null)})),1698335611);var s=TS(t,n,o,l);return MS(kw.g(n),zt.g(n),o,s),Promise.resolve(l)}var YS=function(){function e(e,t,n){var r=XS[ba(null==e?null:e)];if(null!=r)return r.j?r.j(e,t,n):r.call(null,e,t,n);if(null!=(r=XS._))return r.j?r.j(e,t,n):r.call(null,e,t,n);throw Eb("IPromise.-then",e)}function t(e,t){var n=XS[ba(null==e?null:e)];if(null!=n)return n.h?n.h(e,t):n.call(null,e,t);if(null!=(n=XS._))return n.h?n.h(e,t):n.call(null,e,t);throw Eb("IPromise.-then",e)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),XS=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};XS.h=function(e,t){return null!=e&&null!=e.Uf?e.Uf(e,t):YS(e,t)},XS.j=function(e,t,n){return null!=e&&null!=e.Vf?e.Vf(e,t,n):YS(e,t,n)},XS.I=3;var $S=function(){function e(e,t,n){var r=ZS[ba(null==e?null:e)];if(null!=r)return r.j?r.j(e,t,n):r.call(null,e,t,n);if(null!=(r=ZS._))return r.j?r.j(e,t,n):r.call(null,e,t,n);throw Eb("IPromise.-thenErr",e)}function t(e,t){var n=ZS[ba(null==e?null:e)];if(null!=n)return n.h?n.h(e,t):n.call(null,e,t);if(null!=(n=ZS._))return n.h?n.h(e,t):n.call(null,e,t);throw Eb("IPromise.-thenErr",e)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),ZS=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};ZS.h=function(e,t){return null!=e&&null!=e.Wf?e.Wf(e,t):$S(e,t)},ZS.j=function(e,t,n){return null!=e&&null!=e.Xf?e.Xf(e,t,n):$S(e,t,n)},ZS.I=3;var bT=function(){function e(e,t,n){var r=aT[ba(null==e?null:e)];if(null!=r)return r.j?r.j(e,t,n):r.call(null,e,t,n);if(null!=(r=aT._))return r.j?r.j(e,t,n):r.call(null,e,t,n);throw Eb("IPromise.-finally",e)}function t(e,t){var n=aT[ba(null==e?null:e)];if(null!=n)return n.h?n.h(e,t):n.call(null,e,t);if(null!=(n=aT._))return n.h?n.h(e,t):n.call(null,e,t);throw Eb("IPromise.-finally",e)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),aT=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function cT(e){if(null!=e&&null!=e.af)e=e.af(e);else{var t=cT[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=cT._))throw Eb("IPromiseFactory.-promise",e);e=t.g?t.g(e):t.call(null,e)}}return e}function dT(e){if(null!=e&&null!=e.Pf)e=e.Pf(e);else{var t=dT[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=dT._))throw Eb("ICancellable.-cancel!",e);e=t.g?t.g(e):t.call(null,e)}}return e}function eT(e,t){if(null!=e&&null!=e.Rf)e=e.Rf(e,t);else{var n=eT[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=eT._))throw Eb("ICompletable.-resolve!",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function fT(e,t){if(null!=e&&null!=e.Qf)e=e.Qf(e,t);else{var n=fT[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=fT._))throw Eb("ICompletable.-reject!",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function gT(e,t,n){if(null!=e&&null!=e.Yf)e=e.Yf(e,t,n);else{var r=gT[ba(null==e?null:e)];if(null!=r)e=r.j?r.j(e,t,n):r.call(null,e,t,n);else{if(null==(r=gT._))throw Eb("IScheduler.-schedule!",e);e=r.j?r.j(e,t,n):r.call(null,e,t,n)}}return e}aT.h=function(e,t){return null!=e&&null!=e.Sf?e.Sf(e,t):bT(e,t)},aT.j=function(e,t,n){return null!=e&&null!=e.Tf?e.Tf(e,t,n):bT(e,t,n)},aT.I=3;var iT=new qk((function(){return hT.A?hT.A():hT.call(null)}));function jT(e){return gT(iT instanceof qk?r(iT):iT,1e3,e)}function kT(e,t){return gT(iT instanceof qk?r(iT):iT,e,t)}function lT(e){this.state=e,this.M=1,this.B=0}function mT(){}function hT(){return new mT}lT.prototype.Dd=function(){return r(Ia(this.state,"done"))},lT.prototype.Pf=function(){if(n(Ia(this.state,"cancelled")))return null;var e=Ia(this.state,"cancel-fn");return this.state.cancelled=!0,e.A?e.A():e.call(null)},mT.prototype.Yf=function(e,t,n){var r=new Lg(!1),i=setTimeout((function(){try{return n.A?n.A():n.call(null)}finally{ld(r,!0)}}),t);return new lT({done:r,cancelled:!1,"cancel-fn":function(){return clearTimeout(i)}})};var nT=Promise;function oT(){var e={},t=new nT((function(t,n){return e.resolve=t,e.reject=n}));return t.Ai=cb,t.Rf=function(t,n){return e.resolve(n)},t.Qf=function(t,n){return e.reject(n)},t}function pT(e){var t=oT();try{var n=function(e){return eT(t,e)},r=function(e){return fT(t,e)};e.h?e.h(n,r):e.call(null,n,r)}catch(e){fT(t,e)}return t}function qT(e,t){return XS(e,t)}function rT(e,t){return aT(e,t)}function sT(e,t){return ZS(e,t)}function tT(){return this}function uT(e,t){return vT(e,t)}function vT(e,t){var n=new k(null,2,[X,gx,Ar,"Authentication timed out"],null),r=oT(),i=kT(t,(function(){return x.h(n,jG)?fT(r,new tT):eT(r,n)}));return nT.race(Mb(Ng.h(cT,new Q(null,2,5,S,[rT(e,(function(){return dT(i)})),r],null))))}function wT(e,t){if(null!=e&&null!=e.Hf)e=e.Hf(e,t);else{var n=wT[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=wT._))throw Eb("Authenticator.authenticate",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function xT(e){if(null!=e&&null!=e.If)e.If(e);else{var t=xT[ba(null==e?null:e)];if(null!=t)t.g?t.g(e):t.call(null,e);else{if(null==(t=xT._))throw Eb("Authenticator.stop",e);t.g?t.g(e):t.call(null,e)}}}function yT(e){var t=bg(e=du.g(e));return e=u.h(t,iz),t=u.h(t,NA),n(n(e)?t:e)?nT.resolve(new k(null,3,[X,jC,xr,e,iz,e],null)):nT.reject(cl("Missing login/secret",new k(null,2,[X,gx,Ar,"Missing login/secret"],null)))}function zT(e){return x.h(fw.g(e),"gateway-token")?Ol.g(e):null}!function(e){e.prototype.af=function(){return this},e.prototype.Uf=function(e,t){return this.then((function(e){return t.g?t.g(e):t.call(null,e)}))},e.prototype.Vf=function(e,t){return this.then((function(e){return t.g?t.g(e):t.call(null,e)}))},e.prototype.Wf=function(e,t){return this.catch((function(e){return t.g?t.g(e):t.call(null,e)}))},e.prototype.Xf=function(e,t){return this.catch((function(e){return t.g?t.g(e):t.call(null,e)}))},e.prototype.Sf=function(e,t){return this.then((function(e){return t.h?t.h(e,null):t.call(null,e,null)}),(function(e){return t.h?t.h(null,e):t.call(null,null,e)})),this},e.prototype.Tf=function(e,t){return this.then((function(e){return t.h?t.h(e,null):t.call(null,e,null)}),(function(e){return t.h?t.h(null,e):t.call(null,null,e)})),this}}(Promise),XS._=function(){function e(e,t,n){return XS(cT(e),t,n)}function t(e,t){return XS(cT(e),t)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),ZS._=function(){function e(e,t,n){return ZS(cT(e),t,n)}function t(e,t){return ZS(cT(e),t)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),aT._=function(){function e(e,t,n){return aT(cT(e),t,n)}function t(e,t){return aT(cT(e),t)}var n;return n=function(n,r,i){switch(arguments.length){case 2:return t.call(this,n,r);case 3:return e.call(this,n,r,i)}throw Error("Invalid arity: "+arguments.length)},n.h=t,n.j=e,n}(),Error.prototype.af=function(){return nT.reject(this)},cT._=function(e){return nT.resolve(e)},Promise.prototype.pa=cb,Promise.prototype.U=function(e,t){return Qc(t,"#<Promise[~]>")},oa(tT,Error),Z(Py,Hs,Bb),Z(Hy,sw,sw),Z(Ao,N(eD,T,new Q(null,1,5,S,[Py],null),dD,new Q(null,2,5,S,[sC,Hy],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[Py],null),new Q(null,2,5,S,[sC,Hy],null),null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,du)}],null),function(e){return J(e)&&M(e,du)},new Q(null,2,5,S,[UC,EG],null),new Q(null,1,5,S,[Py],null),null,new Q(null,1,5,S,[du],null),new Q(null,2,5,S,[sC,Hy],null),new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,du))],null),null]))),Z(yy,tA,yf);var AT,T2=Fg(P),U2=Fg(P),V2=Fg(P),W2=Fg(P),X2=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));AT=new Yk(Bd.h("gateway.auth.spec","response-type"),X,X2,T2,U2,V2,W2),Z(ps,SC,Ab),AT.C(null,gx,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[yy,ps],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,Ar)}],null),function(e){return J(e)&&M(e,X)&&M(e,Ar)},F,new Q(null,2,5,S,[yy,ps],null),null,new Q(null,2,5,S,[X,Ar],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Ar))],null),null]))})),Z(Av,SC,Ab),Z($C,SC,Ab),Z(ym,SC,Ab),AT.C(null,jC,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[yy,Av,$C],null),new Q(null,1,5,S,[ym],null),null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,iz)},function(e){return M(e,xr)}],null),function(e){return J(e)&&M(e,X)&&M(e,iz)&&M(e,xr)},new Q(null,1,5,S,[Jp],null),new Q(null,3,5,S,[yy,Av,$C],null),null,new Q(null,3,5,S,[X,iz,xr],null),new Q(null,1,5,S,[ym],null),new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,iz)),N(V,new Q(null,1,5,S,[W],null),N(U,W,xr))],null),null]))})),AT.C(null,ln,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[yy,Py],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,du)}],null),function(e){return J(e)&&M(e,X)&&M(e,du)},F,new Q(null,2,5,S,[yy,Py],null),null,new Q(null,2,5,S,[X,du],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,du))],null),null]))})),Z(UE,N(Gx,pF,X),RP(pF,new Cd((function(){return AT}),pF,Ri([Rs,Yo,CD,so,rs,cw,MG,oo,KC,wD],[gD,$y,"gateway/auth/spec.cljc",24,1,14,14,Id,null,n(AT)?AT.md:null]))));var GT=new k(null,6,["application",new k(null,1,[Dr,!0],null),"instance",new k(null,1,[Dr,!1],null),"region",new k(null,1,[Dr,!1],null),"environment",new k(null,1,[Dr,!1],null),"machine",new k(null,1,[Dr,!1],null),"user",new k(null,1,[Dr,!1],null)],null);function HT(e){return af((function(e,t,n){return I.j(e,M(GT,t)?Bf.g(t):t,n)}),P,e)}function IT(e){var t=vg((function(t){var r=G(t,0,null);return G(t,1,null),n(t=Dr.g(r))?null==u.h(e,Bf.g(r)):t}),GT);if(n(t)){var r=G(t,0,null);return G(t,1,null),r}return null}function JT(e){var t=IT(e);if(n(t))throw cl(["Identity ",p.g(e)," is missing a required key: ",p.g(t)].join(""),P)}function KT(e,t){var r=n(e)?-1!=e.indexOf("127.0.0.1"):e;return n(r)?n(r=t)?r:e:n(r=e)?r:t}function LT(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);255<i&&(t[n++]=255&i,i>>=8),t[n++]=i}return t}Ua(),fH()||Ta("iPod"),Ta("iPad"),!Ta("Android")||Va()||Ua()||Ta("Opera")||Ta("Silk"),Va();var MT=Ta("Safari")&&!(Va()||Ta("Coast")||Ta("Opera")||Ta("Edge")||Ta("Edg/")||Ta("OPR")||Ua()||Ta("Silk")||Ta("Android"))&&!(fH()||Ta("iPad")||Ta("iPod")),NT={},OT=null,PT=hH||iH,QT=PT||"function"==typeof aa.btoa,RT=PT||!MT&&!gH&&"function"==typeof aa.atob,$T;function ST(e){var t;void 0===t&&(t=0),TT(),t=NT[t];const n=Array(Math.floor(e.length/3)),r=t[64]||"";let i=0,o=0;for(;i<e.length-2;i+=3){var l=e[i],s=e[i+1],a=e[i+2],u=t[l>>2];l=t[(3&l)<<4|s>>4],s=t[(15&s)<<2|a>>6],a=t[63&a],n[o++]=""+u+l+s+a}switch(u=0,a=r,e.length-i){case 2:a=t[(15&(u=e[i+1]))<<2]||r;case 1:e=e[i],n[o]=""+t[e>>2]+t[(3&e)<<4|u>>4]+a+r}return n.join("")}function UT(e){return QT?aa.btoa(e):ST(LT(e))}function VT(e){if(RT)return aa.atob(e);var t="";return WT(e,(function(e){t+=String.fromCharCode(e)})),t}function WT(e,t){function n(t){for(;r<e.length;){var n=e.charAt(r++),i=OT[n];if(null!=i)return i;if(!Fa(n))throw Error("Unknown base64 encoding at char: "+n)}return t}TT();for(var r=0;;){var i=n(-1),o=n(0),l=n(64),s=n(64);if(64===s&&-1===i)break;t(i<<2|o>>4),64!=l&&(t(o<<4&240|l>>2),64!=s&&t(l<<6&192|s))}}function TT(){if(!OT){OT={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=e.concat(t[n].split(""));NT[n]=r;for(var i=0;i<r.length;i++){var o=r[i];void 0===OT[o]&&(OT[o]=i)}}}}function XT(){this.blockSize=-1}function YT(e,t){this.blockSize=-1,this.blockSize=ZT,this.xc=aa.Uint8Array?new Uint8Array(this.blockSize):Array(this.blockSize),this.Jc=this.rd=0,this.ea=[],this.oe=e,this.ie=t,this.gf=aa.Int32Array?new Int32Array(64):Array(64),void 0===$T&&($T=aa.Int32Array?new Int32Array(aU):aU),this.reset()}oa(YT,XT);var ZT=64,bU=Ja(128,Qa(ZT-1));YT.prototype.reset=function(){this.Jc=this.rd=0,this.ea=aa.Int32Array?new Int32Array(this.ie):Ka(this.ie)},YT.prototype.Tc=function(){for(var e=this.xc,t=this.gf,n=0,r=0;r<e.length;)t[n++]=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3],r=4*n;for(e=16;64>e;e++){r=0|t[e-15],n=0|t[e-2];var i=(0|t[e-16])+((r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3)|0,o=(0|t[e-7])+((n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10)|0;t[e]=i+o|0}n=0|this.ea[0],r=0|this.ea[1];var l=0|this.ea[2],s=0|this.ea[3],a=0|this.ea[4],u=0|this.ea[5],c=0|this.ea[6];for(i=0|this.ea[7],e=0;64>e;e++){var h=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&r^n&l^r&l)|0;o=(i=i+((a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7))|0)+((o=(o=a&u^~a&c)+(0|$T[e])|0)+(0|t[e])|0)|0,i=c,c=u,u=a,a=s+o|0,s=l,l=r,r=n,n=o+h|0}this.ea[0]=this.ea[0]+n|0,this.ea[1]=this.ea[1]+r|0,this.ea[2]=this.ea[2]+l|0,this.ea[3]=this.ea[3]+s|0,this.ea[4]=this.ea[4]+a|0,this.ea[5]=this.ea[5]+u|0,this.ea[6]=this.ea[6]+c|0,this.ea[7]=this.ea[7]+i|0},YT.prototype.update=function(e,t){void 0===t&&(t=e.length);var n=0,r=this.rd;if("string"==typeof e)for(;n<t;)this.xc[r++]=e.charCodeAt(n++),r==this.blockSize&&(this.Tc(),r=0);else{if(!ea(e))throw Error("message must be string or array");for(;n<t;){var i=e[n++];if(!("number"==typeof i&&0<=i&&255>=i&&i==(0|i)))throw Error("message must be a byte array");this.xc[r++]=i,r==this.blockSize&&(this.Tc(),r=0)}}this.rd=r,this.Jc+=t},YT.prototype.digest=function(){var e=[],t=8*this.Jc;56>this.rd?this.update(bU,56-this.rd):this.update(bU,this.blockSize-(this.rd-56));for(var n=63;56<=n;n--)this.xc[n]=255&t,t/=256;for(this.Tc(),n=t=0;n<this.oe;n++)for(var r=24;0<=r;r-=8)e[t++]=this.ea[n]>>r&255;return e};var aU=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function cU(){YT.call(this,8,dU)}oa(cU,YT);var dU=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function eU(e,t){this.blockSize=-1,this.blockSize=128,this.xc=aa.Uint8Array?new Uint8Array(this.blockSize):Array(this.blockSize),this.Jc=this.fd=0,this.ea=[],this.oe=e,this.gf=[],this.ie=fU(t),this.ne=!1,this.reset()}oa(eU,XT);var gU=Ja([128],Qa(127));function fU(e){for(var t=[],n=0;n<e.length;n+=2)t.push(new qa(e[n+1],e[n]));return t}h=eU.prototype,h.reset=function(){this.Jc=this.fd=0,this.ea=Ka(this.ie),this.ne=!1},h.update=function(e,t){if(t=void 0!==t?t:e.length,this.ne)throw Error("this hasher needs to be reset");var n=this.fd;if("string"==typeof e)for(var r=0;r<t;r++){var i=e.charCodeAt(r);if(255<i)throw Error("Characters must be in range [0,255]");this.xc[n++]=i,n==this.blockSize&&(this.Tc(),n=0)}else{if(!ea(e))throw Error("message must be string or array");for(r=0;r<t;r++){if("number"!=typeof(i=e[r])||0>i||255<i||i!=(0|i))throw Error("message must be a byte array");this.xc[n++]=i,n==this.blockSize&&(this.Tc(),n=0)}}this.fd=n,this.Jc+=t},h.digest=function(){if(this.ne)throw Error("this hasher needs to be reset");var e=8*this.Jc;112>this.fd?this.update(gU,112-this.fd):this.update(gU,this.blockSize-this.fd+112);for(var t=127;112<=t;t--)this.xc[t]=255&e,e/=256;this.Tc(),e=0;var n=Array(8*this.oe);for(t=0;t<this.oe;t++){var r=this.ea[t],i=r.ha;r=r.la;for(var o=24;0<=o;o-=8)n[e++]=i>>o&255;for(o=24;0<=o;o-=8)n[e++]=r>>o&255}return this.ne=!0,n},h.Tc=function(){for(var e=this.xc,t=this.gf,n=0;16>n;n++){var r=8*n;t[n]=new qa(e[r+4]<<24|e[r+5]<<16|e[r+6]<<8|e[r+7],e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])}for(n=16;80>n;n++){e=(r=t[n-15]).la,r=r.ha;var i=t[n-2],o=i.la;i=i.ha,t[n]=this.cg(t[n-16],t[n-7],new qa(e>>>1^r<<31^e>>>8^r<<24^e>>>7^r<<25,r>>>1^e<<31^r>>>8^e<<24^r>>>7),new qa(o>>>19^i<<13^i>>>29^o<<3^o>>>6^i<<26,i>>>19^o<<13^o>>>29^i<<3^i>>>6))}e=this.ea[0],r=this.ea[1],o=this.ea[2],i=this.ea[3];var l=this.ea[4],s=this.ea[5],a=this.ea[6],u=this.ea[7];for(n=0;80>n;n++){var c=e.la,h=e.ha;c=new qa(c>>>28^h<<4^h>>>2^c<<30^h>>>7^c<<25,h>>>28^c<<4^c>>>2^h<<30^c>>>7^h<<25).add(new qa(e.la&r.la|r.la&o.la|e.la&o.la,e.ha&r.ha|r.ha&o.ha|e.ha&o.ha)),h=l.la;var d=l.ha,f=l.la,p=l.ha;h=this.cg(u,new qa(h>>>14^d<<18^h>>>18^d<<14^d>>>9^h<<23,d>>>14^h<<18^d>>>18^h<<14^h>>>9^d<<23),new qa(f&s.la|~f&a.la,p&s.ha|~p&a.ha),hU[n],t[n]),u=a,a=s,s=l,l=i.add(h),i=o,o=r,r=e,e=h.add(c)}this.ea[0]=this.ea[0].add(e),this.ea[1]=this.ea[1].add(r),this.ea[2]=this.ea[2].add(o),this.ea[3]=this.ea[3].add(i),this.ea[4]=this.ea[4].add(l),this.ea[5]=this.ea[5].add(s),this.ea[6]=this.ea[6].add(a),this.ea[7]=this.ea[7].add(u)},h.cg=function(e,t,n){for(var r=(2147483648^e.la)+(2147483648^t.la),i=e.ha+t.ha,o=arguments.length-1;2<=o;--o)r+=2147483648^arguments[o].la,i+=arguments[o].ha;return 1&arguments.length&&(r+=2147483648),i+=arguments.length>>1,i+=Math.floor(r/4294967296),new qa(r,i)};var hU=fU([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function iU(){eU.call(this,6,jU)}oa(iU,eU);var jU=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428];function kU(){eU.call(this,8,lU)}oa(kU,eU);var lU=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209];function mU(e,t,n){for(this.blockSize=-1,this.Pb=e,this.blockSize=n||e.blockSize||16,this.Mf=Array(this.blockSize),this.Xe=Array(this.blockSize),(e=t).length>this.blockSize&&(this.Pb.update(e),e=this.Pb.digest(),this.Pb.reset()),n=0;n<this.blockSize;n++)t=n<e.length?e[n]:0,this.Mf[n]=92^t,this.Xe[n]=54^t;this.Pb.update(this.Xe)}oa(mU,XT),mU.prototype.reset=function(){this.Pb.reset(),this.Pb.update(this.Xe)},mU.prototype.update=function(e,t){this.Pb.update(e,t)},mU.prototype.digest=function(){var e=this.Pb.digest();return this.Pb.reset(),this.Pb.update(this.Mf),this.Pb.update(e),this.Pb.digest()},mU.prototype.getHmac=function(e){return this.reset(),this.update(e),this.digest()};var nU=new k(null,4,"HS256 sha256 HS384 sha384 HS512 sha512 RS256 RSA-SHA256".split(" "),null),oU=new k(null,4,"HS256 hmac HS384 hmac HS512 hmac RS256 sign".split(" "),null);function pU(e){return QI(QI(QI(e,"+","-"),"/","_"),"=","")}function qU(e,t){return new mU(function(){switch(e){case"sha256":return new cU;case"sha384":return new iU;case"sha512":return new kU;default:throw Error([p.g(e)," hashing not supported"].join(""))}}(),t)}function rU(e,t,n,r){if("hmac"===r)return pU(ST(qU(n,LT(t)).getHmac(e)));throw Error("algorithm not supported")}function sU(e,t,n,r,i){if("hmac"===i)return x.h(t,rU(e,n,r,i));throw Error("algorithm not supported")}function tU(e,t){t=bg(t);var r,i=u.h(t,yB),o=u.h(t,fo),l=u.h(t,kv),s=u.j(t,bv,kf((new Date).getTime(),1e3)),a=u.j(t,sE,0);if(n(function(){if(n(o)){var t=fo.g(e);return Fe(o)?t=yb(vg(t=xj([t]),o)):t=cg.h(t,o),t}return o}()))throw cl(["Issuer does not match ",p.g(o)].join(""),new k(null,2,[X,Qw,Qv,fo],null));if(n(function(){if(n(l)){var t=kv.g(e);if(Fe(t))t=yb(vg(xj([l]),t));else t=cg.h(l,t);return t}return l}()))throw cl(["Audience does not match ",p.g(l)].join(""),new k(null,2,[X,Qw,Qv,kv],null));if(n(n(r=Rl.g(e))?Rl.g(e)<=s-a:r))throw cl(["Token is expired ",p.g(Rl.g(e))].join(""),new k(null,2,[X,Qw,Qv,Rl],null));if(n(function(){var t=Vm.g(e);return n(t)?Vm.g(e)>s+a:t}()))throw cl(["Token is not yet valid ",p.g(Vm.g(e))].join(""),new k(null,2,[X,Qw,Qv,Vm],null));if(n(function(){var t=Mq.g(e);return n(t)?"number"==typeof i&&s-Mq.g(e)>i:t}()))throw cl(["Token is older than max-age ",p.g(i)].join(""),new k(null,2,[X,Qw,Qv,yB],null));return e}var uU=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};na("gateway.common.jwt.unsign",uU),uU.h=function(e,t){return uU.j(e,t,P)},uU.j=function(e,t,r){r=bg(r);var i=u.j(r,ev,!1),o=TI(e,".",0);e=u.h(o,0);var l=u.h(o,1);if(o=u.h(o,2),n(vg(vb,new Q(null,3,5,S,[e,l,o],null))))throw Error("invalid token");var s=oR(VT(QI(QI(e,"_","/"),"-","+"))).alg,a=af((function(e,t,n){return I.j(e,Bf.g(t),n)}),P,Ek(oR(VT(QI(QI(l,"_","/"),"-","+"))))),c=u.h(nU,s);if(s=u.h(oU,s),n(i))return a;if(yb(n(c)?s:c))throw Error("algorithm not supported");if(yb(sU([p.g(e),".",p.g(l)].join(""),o,t,c,s)))throw Error("signature verification failed");return tU(a,r)},uU.I=3;var vU=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],arguments[1],2<n.length?new Fd(n.slice(2),0,null):null)};na("gateway.common.jwt.sign",vU),vU.l=function(e,t,r){var i=G(r,0,null);r=G(r,1,null);var o=n(i)?i:"HS256",l=n(r)?r:P;if(i=u.h(nU,o),r=u.h(oU,o),!J(e))throw Error("payload should be in JSON format");if(!J(l))throw Error("extra-headers should be a map");if(!n(n(i)?r:i))throw Error("algorithm not supported");return t=rU([o=pU(UT(pR(Ak(Yf(re,l,new k(null,2,[Am,o,CG,"JWT"],null)))))),".",e=pU(UT(pR(Ak(e))))].join(""),t,i,r),[o,".",e,".",p.g(t)].join("")},vU.I=2,vU.J=function(e){var t=A(e),n=B(e);return e=A(n),n=B(n),this.l(t,e,n)};var wU=6e5;function xU(e,t,r){var i=SH()+wU;return t=new k(null,3,[X,fz,iD,t,fz,r],null),i=n(i)?I.j(t,Rl,kf(i,1e3)):t,vU(i,ho.g(e))}function yU(e,t){var r=SH();return e=gh(gh(uU.j(t,e,n(r)?new k(null,1,[bv,kf(r,1e3)],null):null),X,Bf),iD,HT),x.h(X.g(e),fz)?gh(e,fz,(function(e){return gh(fL(e),X,Bf)})):e}var zU=new k(null,2,[lq,5e3,HG,2e4],null);function AU(e,t){if(null!=e&&null!=e.We)e=e.We(e,t);else{var n=AU[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=AU._))throw Eb("AuthImpl.auth",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function BU(e,t){switch(e=yU(e,t),(t=X.g(e))instanceof w?t.W:null){case"gw-request":return n(t=fz.g(e))?nT.resolve(new k(null,3,[X,jC,fz,t,iD,iD.g(e)],null)):nT.reject(new k(null,2,[X,gx,Ar,"Token is missing the gateway request information"],null));case"authentication":return n(t=xr.g(e))?nT.resolve(new k(null,2,[X,jC,xr,t],null)):nT.reject(new k(null,2,[X,gx,Ar,"Token is missing the impersonation information"],null));default:return nT.reject(new k(null,2,[X,gx,Ar,["Invalid gateway token type: ",p.g(X.g(e))].join("")],null))}}function CU(e,t,r){var i=zT(du.g(r));return n(i)?BU(ho.g(r),i):n(e)?uT(pT((function(t,n){return PH(e,new Q(null,3,5,S,[t,n,r],null))})),t):nT.reject(cl("No authenticator configured",new k(null,2,[X,gx,Ar,"No authenticator configured"],null)))}function DU(e,t){this.Ce=e,this.timeout=t}function EU(e,t){var r=bg(e=pj.l(D([zU,e])));e=u.h(r,lq);var i=OH(new eH(cH(r=u.h(r,HG)),r));yS(pD,"gateway.auth.impl",87,lE,new qk((function(){return new Q(null,2,5,S,["starting authenticator with impl ",t],null)})),-1504629951);var o=OH(1);return sH((function(){var e,r=function(){function e(e){var r=e[1];if(1===r)return e[2]=null,e[1]=2,fv;if(2===r)return MH(e,4,i);if(3===r)return NH(e,e[2]);if(4===r)return r=e[7],r=e[2],e[7]=r,e[1]=n(r)?5:6,fv;if(5===r){var o=G(r=e[7],0,null),l=G(r,1,null),s=gh(r=G(r,2,null),du,fL),a=du.g(s);return r=yS(it,"gateway.auth.impl",94,lE,new qk((function(){return new Q(null,2,5,S,["processing authentication",n(NA.g(a))?I.j(a,NA,"XXX"):I.j(a,Ol,"XXX")],null)})),677263882),s=sT(s=qT(s=AU(t,s),(function(e){return o.g?o.g(e):o.call(null,e)})),(function(e){return l.g?l.g(e):l.call(null,e)})),e[8]=r,e[9]=s,e[2]=null,e[1]=2,fv}return 6===r?(e[2]=null,e[1]=7,fv):7===r?(e[2]=e[2],e[1]=3,fv):null}return function(){function t(t){for(;;){e:try{for(;;){var n=e(t);if(!O(n,fv)){var r=n;break e}}}catch(e){if(r=e,t[2]=r,!z(t[4]))throw r;t[1]=A(t[4]),r=fv}if(!O(r,fv))return r}}function n(){var e=[null,null,null,null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(e){switch(arguments.length){case 0:return n.call(this);case 1:return t.call(this,e)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=t,r}()}();return LH(((e=r())[6]=o,e))})),new DU(i,e)}function FU(e){this.Be=e}DU.prototype.If=function(){return n(this.Ce)?XH(this.Ce):null},DU.prototype.Hf=function(e,t){return CU(this.Ce,this.timeout,t)},FU.prototype.We=function(e,t){var n,r=this;return sT(qT((n=Ak(t),r.Be.g?r.Be.g(n):r.Be.call(null,n)),(function(e){var t=gh(fL(Ek(e)),X,Bf);return yS(it,"gateway.cljs.authenticators",15,lE,new qk((function(){return new Q(null,2,5,S,["auth response",t],null)})),1689212095),t})),(function(e){throw yS(it,"gateway.cljs.authenticators",18,lE,new qk((function(){return new Q(null,2,5,S,["auth failure",e],null)})),-1263989411),cl(e,new k(null,2,[X,gx,Ar,e],null))}))};var GU={},HU,IU,JU,KU,LU,MU,NU=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};NU.l=function(e){return Qc(db,Xf(jk,e))},NU.I=0,NU.J=function(e){return this.l(z(e))};var OU=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(0<n.length?new Fd(n.slice(0),0,null):null)};function PU(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;Xf(OU,0<t.length?new Fd(t.slice(0),0,null):null),Qc(db,"\n")}function QU(e){if("number"==typeof e)return e;if("string"==typeof e&&1===e.length)return e.charCodeAt(0);throw Error("Argument to char must be a character or number")}function RU(e,t,n){var r=n;for(n=F;;){if(Ee(r))return new Q(null,2,5,S,[n,t],null);var i=A(r);r=B(r),t=G(i=Xf(e,new Q(null,2,5,S,[i,t],null)),0,null),i=G(i,1,null),n=re.h(n,t),t=i}}function SU(e,t){var n=t;for(t=F;;){var r=Xf(e,new Q(null,1,5,S,[n],null));if(n=G(r,0,null),r=G(r,1,null),yb(n))return new Q(null,2,5,S,[t,r],null);t=re.h(t,n),n=r}}function TU(e){return new Q(null,2,5,S,[ah.h(P,function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var r=ed(n),i=C(r),o=Hf(i);e:for(var l=0;;){if(!(l<i)){r=!0;break e}var s=Zb(r,l),a=G(s,0,null);s=G(s,1,null);var u=G(s,0,null);G(s,1,null),o.add(new Q(null,2,5,S,[a,u],null)),l+=1}return Jf(Lf(o),r?e(fd(n)):null)}return o=G(r=A(n),0,null),r=G(r,1,null),i=G(r,0,null),G(r,1,null),ke(new Q(null,2,5,S,[o,i],null),e(Hd(n)))}return null}}),null,null)}(e)),ah.h(P,function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var r=ed(n),i=C(r),o=Hf(i);e:for(var l=0;;){if(!(l<i)){r=!0;break e}var s=Zb(r,l),a=G(s,0,null);s=G(s,1,null),G(s,0,null),s=G(s,1,null),o.add(new Q(null,2,5,S,[a,s],null)),l+=1}return Jf(Lf(o),r?e(fd(n)):null)}return o=G(r=A(n),0,null),r=G(r,1,null),G(r,0,null),r=G(r,1,null),ke(new Q(null,2,5,S,[o,r],null),e(Hd(n)))}return null}}),null,null)}(e))],null)}function UU(e,t){return ah.h(P,function e(n){return new Df(null,(function(){for(;;){var r=z(n);if(r){if(Me(r)){var i=ed(r),o=C(i),l=Hf(o);e:for(var s=0;;){if(!(s<o)){i=!0;break e}var a=Zb(i,s),u=G(a,0,null);a=G(a,1,null),l.add(new Q(null,2,5,S,[u,new Q(null,2,5,S,[a,t],null)],null)),s+=1}return Jf(Lf(l),i?e(fd(r)):null)}return l=G(i=A(r),0,null),i=G(i,1,null),ke(new Q(null,2,5,S,[l,new Q(null,2,5,S,[i,t],null)],null),e(Hd(r)))}return null}}),null,null)}(e))}function VU(){var e=db;if(null!=e&&null!=e.Qe)e.Qe(e);else{var t=VU[ba(null==e?null:e)];if(null!=t)t.g?t.g(e):t.call(null,e);else{if(null==(t=VU._))throw Eb("IPrettyFlush.-ppflush",e);t.g?t.g(e):t.call(null,e)}}}function WU(e,t){return e=r(r(e)),t.g?t.g(e):t.call(null,e)}function XU(e,t,n){Ig.F(r(e),I,t,n)}function YU(e,t){return x.h(t,"\n")?(XU(e,TR,0),XU(e,cw,WU(e,cw)+1)):XU(e,TR,WU(e,TR)+1),Qc(WU(e,XF),t)}function ZU(e,t){var r=Fg(new k(null,4,[EC,t,TR,0,cw,0,XF,e],null));return void 0!==$a&&void 0!==GU&&void 0!==HU||(HU=function(e,t,n,r){this.Da=e,this.Ze=t,this.Vc=n,this.Eh=r,this.B=1074167808,this.M=0},HU.prototype.S=function(e,t){return new HU(this.Da,this.Ze,this.Vc,t)},HU.prototype.R=function(){return this.Eh},HU.prototype.Jb=function(){return this.Vc},HU.prototype.oc=function(){return Rc(this.Da)},HU.prototype.Oc=function(e,t){if(e=Db(t),n(x.h?x.h(String,e):x.call(null,String,e)))return 0>(e=t.lastIndexOf("\n"))?XU(this,TR,WU(this,TR)+C(t)):(XU(this,TR,C(t)-e-1),XU(this,cw,WU(this,cw)+C(Xg.h((function(e){return x.h(e,"\n")}),t)))),Qc(WU(this,XF),t);if(n(x.h?x.h(Number,e):x.call(null,Number,e)))return YU(this,t);throw Error(["No matching clause: ",p.g(e)].join(""))},HU.Na=!0,HU.Ja="cljs.pprint/t_cljs$pprint19595",HU.Pa=function(e){return Qc(e,"cljs.pprint/t_cljs$pprint19595")}),new HU(e,t,r,P)}function $U(e,t,n,r,i,o,l,s,a,u,c,h,d){this.parent=e,this.Ab=t,this.ob=n,this.nb=r,this.vb=i,this.wb=o,this.prefix=l,this.zb=s,this.Bb=a,this.xb=u,this.D=c,this.m=h,this.G=d,this.B=2230716170,this.M=139264}function aV(e,t){for(t=IF.g(t);;){if(null==t)return!1;if(e===t)return!0;t=IF.g(t)}}function bV(e,t,n,r,i,o,l,s){this.Z=e,this.data=t,this.Rb=n,this.Y=r,this.X=i,this.D=o,this.m=l,this.G=s,this.B=2230716170,this.M=139264}function cV(e,t,n,r,i,o,l,s){this.Z=e,this.type=t,this.fa=n,this.Y=r,this.X=i,this.D=o,this.m=l,this.G=s,this.B=2230716170,this.M=139264}function dV(e,t,n,r,i,o,l){this.Z=e,this.fa=t,this.Y=n,this.X=r,this.D=i,this.m=o,this.G=l,this.B=2230716170,this.M=139264}function eV(e,t,n,r,i,o,l){this.Z=e,this.fa=t,this.Y=n,this.X=r,this.D=i,this.m=o,this.G=l,this.B=2230716170,this.M=139264}function fV(e,t,n,r,i,o,l,s,a){this.Z=e,this.fa=t,this.Lb=n,this.offset=r,this.Y=i,this.X=o,this.D=l,this.m=s,this.G=a,this.B=2230716170,this.M=139264}OU.l=function(e){return Qc(db,Xf(hk,e))},OU.I=0,OU.J=function(e){return this.l(z(e))},h=$U.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"parent":return this.parent;case"section":return this.Ab;case"start-col":return this.ob;case"indent":return this.nb;case"done-nl":return this.vb;case"intra-block-nl":return this.wb;case"prefix":return this.prefix;case"per-line-prefix":return this.zb;case"suffix":return this.Bb;case"logical-block-callback":return this.xb;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.pprint.logical-block{",", ","}",n,Of.h(new Q(null,10,5,S,[new Q(null,2,5,S,[IF,this.parent],null),new Q(null,2,5,S,[eF,this.Ab],null),new Q(null,2,5,S,[fE,this.ob],null),new Q(null,2,5,S,[Rp,this.nb],null),new Q(null,2,5,S,[Us,this.vb],null),new Q(null,2,5,S,[dm,this.wb],null),new Q(null,2,5,S,[jr,this.prefix],null),new Q(null,2,5,S,[dn,this.zb],null),new Q(null,2,5,S,[bs,this.Bb],null),new Q(null,2,5,S,[rp,this.xb],null)],null),this.m))},h.xa=function(){return new Yh(this,10,new Q(null,10,5,S,[IF,eF,fE,Rp,Us,dm,jr,dn,bs,rp],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 10+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=1977012399^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.parent,t.parent)&&x.h(this.Ab,t.Ab)&&x.h(this.ob,t.ob)&&x.h(this.nb,t.nb)&&x.h(this.vb,t.vb)&&x.h(this.wb,t.wb)&&x.h(this.prefix,t.prefix)&&x.h(this.zb,t.zb)&&x.h(this.Bb,t.Bb)&&x.h(this.xb,t.xb)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,10,[bs,null,Rp,null,IF,null,eF,null,Us,null,fE,null,jr,null,dn,null,rp,null,dm,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new $U(this.parent,this.Ab,this.ob,this.nb,this.vb,this.wb,this.prefix,this.zb,this.Bb,this.xb,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"parent":case"section":case"start-col":case"indent":case"done-nl":case"intra-block-nl":case"prefix":case"per-line-prefix":case"suffix":case"logical-block-callback":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(IF,t):O.call(null,IF,t))?new $U(r,this.Ab,this.ob,this.nb,this.vb,this.wb,this.prefix,this.zb,this.Bb,this.xb,this.D,this.m,null):n(O.h?O.h(eF,t):O.call(null,eF,t))?new $U(this.parent,r,this.ob,this.nb,this.vb,this.wb,this.prefix,this.zb,this.Bb,this.xb,this.D,this.m,null):n(O.h?O.h(fE,t):O.call(null,fE,t))?new $U(this.parent,this.Ab,r,this.nb,this.vb,this.wb,this.prefix,this.zb,this.Bb,this.xb,this.D,this.m,null):n(O.h?O.h(Rp,t):O.call(null,Rp,t))?new $U(this.parent,this.Ab,this.ob,r,this.vb,this.wb,this.prefix,this.zb,this.Bb,this.xb,this.D,this.m,null):n(O.h?O.h(Us,t):O.call(null,Us,t))?new $U(this.parent,this.Ab,this.ob,this.nb,r,this.wb,this.prefix,this.zb,this.Bb,this.xb,this.D,this.m,null):n(O.h?O.h(dm,t):O.call(null,dm,t))?new $U(this.parent,this.Ab,this.ob,this.nb,this.vb,r,this.prefix,this.zb,this.Bb,this.xb,this.D,this.m,null):n(O.h?O.h(jr,t):O.call(null,jr,t))?new $U(this.parent,this.Ab,this.ob,this.nb,this.vb,this.wb,r,this.zb,this.Bb,this.xb,this.D,this.m,null):n(O.h?O.h(dn,t):O.call(null,dn,t))?new $U(this.parent,this.Ab,this.ob,this.nb,this.vb,this.wb,this.prefix,r,this.Bb,this.xb,this.D,this.m,null):n(O.h?O.h(bs,t):O.call(null,bs,t))?new $U(this.parent,this.Ab,this.ob,this.nb,this.vb,this.wb,this.prefix,this.zb,r,this.xb,this.D,this.m,null):n(O.h?O.h(rp,t):O.call(null,rp,t))?new $U(this.parent,this.Ab,this.ob,this.nb,this.vb,this.wb,this.prefix,this.zb,this.Bb,r,this.D,this.m,null):new $U(this.parent,this.Ab,this.ob,this.nb,this.vb,this.wb,this.prefix,this.zb,this.Bb,this.xb,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,10,5,S,[new xh(IF,this.parent),new xh(eF,this.Ab),new xh(fE,this.ob),new xh(Rp,this.nb),new xh(Us,this.vb),new xh(dm,this.wb),new xh(jr,this.prefix),new xh(dn,this.zb),new xh(bs,this.Bb),new xh(rp,this.xb)],null),this.m))},h.S=function(e,t){return new $U(this.parent,this.Ab,this.ob,this.nb,this.vb,this.wb,this.prefix,this.zb,this.Bb,this.xb,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h=bV.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"type-tag":return this.Z;case"data":return this.data;case"trailing-white-space":return this.Rb;case"start-pos":return this.Y;case"end-pos":return this.X;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.pprint.buffer-blob{",", ","}",n,Of.h(new Q(null,5,5,S,[new Q(null,2,5,S,[qG,this.Z],null),new Q(null,2,5,S,[Fw,this.data],null),new Q(null,2,5,S,[Zl,this.Rb],null),new Q(null,2,5,S,[nD,this.Y],null),new Q(null,2,5,S,[$m,this.X],null)],null),this.m))},h.xa=function(){return new Yh(this,5,new Q(null,5,5,S,[qG,Fw,Zl,nD,$m],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 5+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=1809113693^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.Z,t.Z)&&x.h(this.data,t.data)&&x.h(this.Rb,t.Rb)&&x.h(this.Y,t.Y)&&x.h(this.X,t.X)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,5,[$m,null,Zl,null,qG,null,nD,null,Fw,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new bV(this.Z,this.data,this.Rb,this.Y,this.X,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"type-tag":case"data":case"trailing-white-space":case"start-pos":case"end-pos":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(qG,t):O.call(null,qG,t))?new bV(r,this.data,this.Rb,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(Fw,t):O.call(null,Fw,t))?new bV(this.Z,r,this.Rb,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(Zl,t):O.call(null,Zl,t))?new bV(this.Z,this.data,r,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(nD,t):O.call(null,nD,t))?new bV(this.Z,this.data,this.Rb,r,this.X,this.D,this.m,null):n(O.h?O.h($m,t):O.call(null,$m,t))?new bV(this.Z,this.data,this.Rb,this.Y,r,this.D,this.m,null):new bV(this.Z,this.data,this.Rb,this.Y,this.X,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,5,5,S,[new xh(qG,this.Z),new xh(Fw,this.data),new xh(Zl,this.Rb),new xh(nD,this.Y),new xh($m,this.X)],null),this.m))},h.S=function(e,t){return new bV(this.Z,this.data,this.Rb,this.Y,this.X,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h=cV.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"type-tag":return this.Z;case"type":return this.type;case"logical-block":return this.fa;case"start-pos":return this.Y;case"end-pos":return this.X;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.pprint.nl-t{",", ","}",n,Of.h(new Q(null,5,5,S,[new Q(null,2,5,S,[qG,this.Z],null),new Q(null,2,5,S,[X,this.type],null),new Q(null,2,5,S,[rB,this.fa],null),new Q(null,2,5,S,[nD,this.Y],null),new Q(null,2,5,S,[$m,this.X],null)],null),this.m))},h.xa=function(){return new Yh(this,5,new Q(null,5,5,S,[qG,X,rB,nD,$m],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 5+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-1640656800^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.Z,t.Z)&&x.h(this.type,t.type)&&x.h(this.fa,t.fa)&&x.h(this.Y,t.Y)&&x.h(this.X,t.X)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,5,[$m,null,X,null,rB,null,qG,null,nD,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new cV(this.Z,this.type,this.fa,this.Y,this.X,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"type-tag":case"type":case"logical-block":case"start-pos":case"end-pos":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(qG,t):O.call(null,qG,t))?new cV(r,this.type,this.fa,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(X,t):O.call(null,X,t))?new cV(this.Z,r,this.fa,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(rB,t):O.call(null,rB,t))?new cV(this.Z,this.type,r,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(nD,t):O.call(null,nD,t))?new cV(this.Z,this.type,this.fa,r,this.X,this.D,this.m,null):n(O.h?O.h($m,t):O.call(null,$m,t))?new cV(this.Z,this.type,this.fa,this.Y,r,this.D,this.m,null):new cV(this.Z,this.type,this.fa,this.Y,this.X,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,5,5,S,[new xh(qG,this.Z),new xh(X,this.type),new xh(rB,this.fa),new xh(nD,this.Y),new xh($m,this.X)],null),this.m))},h.S=function(e,t){return new cV(this.Z,this.type,this.fa,this.Y,this.X,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h=dV.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"type-tag":return this.Z;case"logical-block":return this.fa;case"start-pos":return this.Y;case"end-pos":return this.X;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.pprint.start-block-t{",", ","}",n,Of.h(new Q(null,4,5,S,[new Q(null,2,5,S,[qG,this.Z],null),new Q(null,2,5,S,[rB,this.fa],null),new Q(null,2,5,S,[nD,this.Y],null),new Q(null,2,5,S,[$m,this.X],null)],null),this.m))},h.xa=function(){return new Yh(this,4,new Q(null,4,5,S,[qG,rB,nD,$m],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 4+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-414877272^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.Z,t.Z)&&x.h(this.fa,t.fa)&&x.h(this.Y,t.Y)&&x.h(this.X,t.X)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,4,[$m,null,rB,null,qG,null,nD,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new dV(this.Z,this.fa,this.Y,this.X,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"type-tag":case"logical-block":case"start-pos":case"end-pos":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(qG,t):O.call(null,qG,t))?new dV(r,this.fa,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(rB,t):O.call(null,rB,t))?new dV(this.Z,r,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(nD,t):O.call(null,nD,t))?new dV(this.Z,this.fa,r,this.X,this.D,this.m,null):n(O.h?O.h($m,t):O.call(null,$m,t))?new dV(this.Z,this.fa,this.Y,r,this.D,this.m,null):new dV(this.Z,this.fa,this.Y,this.X,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,4,5,S,[new xh(qG,this.Z),new xh(rB,this.fa),new xh(nD,this.Y),new xh($m,this.X)],null),this.m))},h.S=function(e,t){return new dV(this.Z,this.fa,this.Y,this.X,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h=eV.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"type-tag":return this.Z;case"logical-block":return this.fa;case"start-pos":return this.Y;case"end-pos":return this.X;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.pprint.end-block-t{",", ","}",n,Of.h(new Q(null,4,5,S,[new Q(null,2,5,S,[qG,this.Z],null),new Q(null,2,5,S,[rB,this.fa],null),new Q(null,2,5,S,[nD,this.Y],null),new Q(null,2,5,S,[$m,this.X],null)],null),this.m))},h.xa=function(){return new Yh(this,4,new Q(null,4,5,S,[qG,rB,nD,$m],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 4+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=1365867980^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.Z,t.Z)&&x.h(this.fa,t.fa)&&x.h(this.Y,t.Y)&&x.h(this.X,t.X)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,4,[$m,null,rB,null,qG,null,nD,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new eV(this.Z,this.fa,this.Y,this.X,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"type-tag":case"logical-block":case"start-pos":case"end-pos":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(qG,t):O.call(null,qG,t))?new eV(r,this.fa,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(rB,t):O.call(null,rB,t))?new eV(this.Z,r,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(nD,t):O.call(null,nD,t))?new eV(this.Z,this.fa,r,this.X,this.D,this.m,null):n(O.h?O.h($m,t):O.call(null,$m,t))?new eV(this.Z,this.fa,this.Y,r,this.D,this.m,null):new eV(this.Z,this.fa,this.Y,this.X,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,4,5,S,[new xh(qG,this.Z),new xh(rB,this.fa),new xh(nD,this.Y),new xh($m,this.X)],null),this.m))},h.S=function(e,t){return new eV(this.Z,this.fa,this.Y,this.X,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h=fV.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"type-tag":return this.Z;case"logical-block":return this.fa;case"relative-to":return this.Lb;case"offset":return this.offset;case"start-pos":return this.Y;case"end-pos":return this.X;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.pprint.indent-t{",", ","}",n,Of.h(new Q(null,6,5,S,[new Q(null,2,5,S,[qG,this.Z],null),new Q(null,2,5,S,[rB,this.fa],null),new Q(null,2,5,S,[am,this.Lb],null),new Q(null,2,5,S,[jx,this.offset],null),new Q(null,2,5,S,[nD,this.Y],null),new Q(null,2,5,S,[$m,this.X],null)],null),this.m))},h.xa=function(){return new Yh(this,6,new Q(null,6,5,S,[qG,rB,am,jx,nD,$m],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 6+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-1602780238^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.Z,t.Z)&&x.h(this.fa,t.fa)&&x.h(this.Lb,t.Lb)&&x.h(this.offset,t.offset)&&x.h(this.Y,t.Y)&&x.h(this.X,t.X)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,6,[jx,null,$m,null,am,null,rB,null,qG,null,nD,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new fV(this.Z,this.fa,this.Lb,this.offset,this.Y,this.X,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"type-tag":case"logical-block":case"relative-to":case"offset":case"start-pos":case"end-pos":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(qG,t):O.call(null,qG,t))?new fV(r,this.fa,this.Lb,this.offset,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(rB,t):O.call(null,rB,t))?new fV(this.Z,r,this.Lb,this.offset,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(am,t):O.call(null,am,t))?new fV(this.Z,this.fa,r,this.offset,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(jx,t):O.call(null,jx,t))?new fV(this.Z,this.fa,this.Lb,r,this.Y,this.X,this.D,this.m,null):n(O.h?O.h(nD,t):O.call(null,nD,t))?new fV(this.Z,this.fa,this.Lb,this.offset,r,this.X,this.D,this.m,null):n(O.h?O.h($m,t):O.call(null,$m,t))?new fV(this.Z,this.fa,this.Lb,this.offset,this.Y,r,this.D,this.m,null):new fV(this.Z,this.fa,this.Lb,this.offset,this.Y,this.X,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,6,5,S,[new xh(qG,this.Z),new xh(rB,this.fa),new xh(am,this.Lb),new xh(jx,this.offset),new xh(nD,this.Y),new xh($m,this.X)],null),this.m))},h.S=function(e,t){return new fV(this.Z,this.fa,this.Lb,this.offset,this.Y,this.X,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)};var gV=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("cljs.pprint","write-token"),(function(e,t){return qG.g(t)}),i,e,t,n,r)}();function iV(e,t,i){t=z(t);for(var o=null,l=0,s=0;;)if(s<l){var a=o.$(null,s);if(!x.h(qG.g(a),js)){var u=Zl.g(r(r(e)));n(u)&&Qc(XF.g(r(r(e))),u)}gV.h(e,a),Ig.F(r(e),I,Zl,Zl.g(a)),a=Zl.g(r(r(e))),n(n(i)?a:i)&&(Qc(XF.g(r(r(e))),a),Ig.F(r(e),I,Zl,null)),s+=1}else{if(!(t=z(t)))break;Me(t)?(o=ed(t),t=fd(t),a=o,l=C(o),o=a):(a=A(t),x.h(qG.g(a),js)||n(o=Zl.g(r(r(e))))&&Qc(XF.g(r(r(e))),o),gV.h(e,a),Ig.F(r(e),I,Zl,Zl.g(a)),a=Zl.g(r(r(e))),n(n(i)?a:i)&&(Qc(XF.g(r(r(e))),a),Ig.F(r(e),I,Zl,null)),t=B(t),o=null,l=0),s=0}}function jV(e,t){var n,i=WU(XF.g(r(r(e))),EC);return(n=null==i)||(n=(e=WU(XF.g(r(r(e))),TR))+(t=(t=z(t))?$m.g(qe(t))-nD.g(A(t)):0)<i),n}function kV(e,t,i){return n(t=r(Us.g(t)))?t:!jV(e,i)}function lV(e,t,i){var o=ux.g(r(r(e))),l=WU(XF.g(r(r(e))),EC);return n(o)?n(l)?(o=r(fE.g(t))>=l-o)?kV(e,t,i):o:l:o}gV.C(null,Do,(function(e,t){var i=rp.g(r(r(e)));return n(i)&&(i.g?i.g(Ku):i.call(null,Ku)),t=rB.g(t),n(i=jr.g(t))&&Qc(XF.g(r(r(e))),i),e=WU(XF.g(r(r(e))),TR),Gg(fE.g(t),e),Gg(Rp.g(t),e)})),gV.C(null,aC,(function(e,t){var i=rp.g(r(r(e)));return n(i)&&(i.g?i.g(Bn):i.call(null,Bn)),n(t=bs.g(rB.g(t)))?Qc(XF.g(r(r(e))),t):null})),gV.C(null,wz,(function(e,t){var i=rB.g(t),o=Rp.g(i),l=jx.g(t);if(t=am.g(t),n(x.h?x.h(vv,t):x.call(null,vv,t)))e=r(fE.g(i));else{if(!n(x.h?x.h(zm,t):x.call(null,zm,t)))throw Error(["No matching clause: ",p.g(t)].join(""));e=WU(XF.g(r(r(e))),TR)}return Gg(o,l+e)})),gV.C(null,Qy,(function(e,t){return Qc(XF.g(r(r(e))),Fw.g(t))})),gV.C(null,js,(function(e,t){var i=x.h(X.g(t),Is);return i||(i=(i=!x.h(X.g(t),yD))?r(Us.g(rB.g(t))):i),n(i)?hV.h?hV.h(e,t):hV.call(null,e,t):n(t=Zl.g(r(r(e))))&&Qc(XF.g(r(r(e))),t),Ig.F(r(e),I,Zl,null)}));var mV=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("cljs.pprint","emit-nl?"),(function(e){return X.g(e)}),i,e,t,n,r)}();function nV(e){var t=A(e),n=rB.g(t);return t=z(Fj((function(e){return!(x.h(qG.g(e),js)&&aV(rB.g(e),n))}),B(e))),new Q(null,2,5,S,[t,z(Pg(C(t)+1,e))],null)}function oV(e){var t=A(e),n=rB.g(t);return z(Fj((function(e){var t=rB.g(e);return!(x.h(qG.g(e),js)&&(x.h(t,n)||aV(t,n)))}),B(e)))}function hV(e,t){Qc(XF.g(r(r(e))),"\n"),Ig.F(r(e),I,Zl,null),t=rB.g(t);var i=dn.g(t);n(i)&&Qc(XF.g(r(r(e))),i),i=Xf(p,Tg(r(Rp.g(t))-C(i)," ")),Qc(XF.g(r(r(e))),i);e:for(Gg(dm.g(t),!0),Gg(Us.g(t),!0),e=IF.g(t);n(e);)Gg(Us.g(e),!0),Gg(dm.g(e),!0),e=IF.g(e);return null}function pV(e){var t=z(Fj((function(e){return!x.h(qG.g(e),js)}),e));return new Q(null,2,5,S,[t,z(Pg(C(t),e))],null)}mV.C(null,qw,(function(e,t,n){return kV(t,e=rB.g(e),n)})),mV.C(null,tm,(function(e,t,n){return lV(t,e=rB.g(e),n)})),mV.C(null,yD,(function(e,t,i,o){e=rB.g(e);var l=r(dm.g(e));return n(l)?l:(o=!jV(t,o))?o:lV(t,e,i)})),mV.C(null,Is,(function(){return!0}));var qV=function e(t,r){var i=pV(r);r=G(i,0,null);var o=G(i,1,null);if(n(r)&&iV(t,r,!1),n(o)){r=G(i=nV(o),0,null),i=G(i,1,null);var l=A(o);return n(mV.F(l,t,r,oV(o)))&&(hV(t,l),o=B(o)),jV(t,o)?t=o:(o=e.h?e.h(t,r):e.call(null,t,r),x.h(o,r)?(iV(t,r,!1),t=i):t=ah.h(F,Of.h(o,i))),t}return null};function rV(e){for(var t=Cp.g(r(r(e)));;){if(Ig.F(r(e),I,Cp,ah.h(F,t)),jV(e,t))return null;var n=qV(e,t);if(t===n)return null;t=n}}function sV(e,t){return Ig.F(r(e),I,Cp,re.h(Cp.g(r(r(e))),t)),jV(e,Cp.g(r(r(e))))?null:rV(e)}function tV(e){var t=Zl.g(r(r(e)));return n(t)?(Qc(XF.g(r(r(e))),t),Ig.F(r(e),I,Zl,null)):null}function uV(e,t){var i=TI(t,"\n",-1);if(x.h(C(i),1))return t;t=dn.g(A(Wn.g(r(r(e)))));var o=A(i);if(x.h($x,So.g(r(r(e))))){var l=DG.g(r(r(e))),s=l+C(o);Ig.F(r(e),I,DG,s),sV(e,new bV(Qy,o,null,l,s,null,null,null)),rV(e),n(o=Cp.g(r(r(e))))&&(iV(e,o,!0),Ig.F(r(e),I,Cp,F))}else tV(e),Qc(XF.g(r(r(e))),o);Qc(XF.g(r(r(e))),"\n"),o=z(B(Aj(i))),l=null;for(var a=s=0;;)if(a<s){var u=l.$(null,a);Qc(XF.g(r(r(e))),u),Qc(XF.g(r(r(e))),"\n"),n(t)&&Qc(XF.g(r(r(e))),t),a+=1}else{if(!(o=z(o)))break;Me(l=o)?(o=ed(l),a=fd(l),l=o,s=C(o),o=a):(o=A(l),Qc(XF.g(r(r(e))),o),Qc(XF.g(r(r(e))),"\n"),n(t)&&Qc(XF.g(r(r(e))),t),o=B(l),l=null,s=0),a=0}return Ig.F(r(e),I,$x,jp),qe(i)}function vV(e){var t=wV,i=xV,o=new $U(null,null,Fg(0),Fg(0),Fg(!1),Fg(!1),null,null,null,null,null,null,null),l=Fg(Ri([Wn,ux,ED,Ns,yu,So,DG,Zl,XF,ys,Cp],[o,i,o,!0,null,jp,0,null,ZU(e,t),1,F]));return void 0!==$a&&void 0!==GU&&void 0!==IU||(IU=function(e,t,n,r,i,o){this.Da=e,this.Ze=t,this.Oh=n,this.nh=r,this.Vc=i,this.Fh=o,this.B=1074167808,this.M=0},IU.prototype.S=function(e,t){return new IU(this.Da,this.Ze,this.Oh,this.nh,this.Vc,t)},IU.prototype.R=function(){return this.Fh},IU.prototype.Jb=function(){return this.Vc},IU.prototype.Oc=function(e,t){if(e=Db(t),n(x.h?x.h(String,e):x.call(null,String,e))){var i=uV(this,t);t=i.replace(/\s+$/,""),e=i.substring(t.length);var o=So.g(r(r(this)));return x.h(o,jp)?(tV(this),Qc(XF.g(r(r(this))),t),Ig.F(r(this),I,Zl,e)):(i=(o=DG.g(r(r(this))))+C(i),Ig.F(r(this),I,DG,i),sV(this,new bV(Qy,t,e,o,i,null,null,null)))}if(n(x.h?x.h(Number,e):x.call(null,Number,e)))return x.h(So.g(r(r(this))),jp)?(tV(this),t=Qc(XF.g(r(r(this))),t)):x.h(t,"\n")?t=uV(this,"\n"):(i=(e=DG.g(r(r(this))))+1,Ig.F(r(this),I,DG,i),t=hf(t),t=sV(this,new bV(Qy,t,null,e,i,null,null,null))),t;throw Error(["No matching clause: ",p.g(e)].join(""))},IU.prototype.oc=function(){return this.Qe(null),Rc(XF.g(r(r(this))))},IU.prototype.Qe=function(){return x.h(So.g(r(r(this))),$x)?(iV(this,Cp.g(r(r(this))),!0),Ig.F(r(this),I,Cp,F)):tV(this)},IU.Na=!0,IU.Ja="cljs.pprint/t_cljs$pprint19947",IU.Pa=function(e){return Qc(e,"cljs.pprint/t_cljs$pprint19947")}),new IU(e,t,i,o,l,P)}function yV(e,t){var i=db;if(t=new $U(Wn.g(r(r(i))),null,Fg(0),Fg(0),Fg(!1),Fg(!1),e,null,t,null,null,null,null),Ig.F(r(i),I,Wn,t),x.h(So.g(r(r(i))),jp)){tV(i);var o=rp.g(r(r(i)));n(o)&&(o.g?o.g(Ku):o.call(null,Ku)),n(e)&&Qc(XF.g(r(r(i))),e),i=WU(XF.g(r(r(i))),TR),Gg(t.ob,i),Gg(t.nb,i)}else e=(o=DG.g(r(r(i))))+(n(e)?C(e):0),Ig.F(r(i),I,DG,e),sV(i,new dV(Do,t,o,e,null,null,null))}function zV(){var e=db,t=Wn.g(r(r(e))),i=bs.g(t);if(x.h(So.g(r(r(e))),jp)){tV(e),n(i)&&Qc(XF.g(r(r(e))),i);var o=rp.g(r(r(e)));n(o)&&(o.g?o.g(Bn):o.call(null,Bn))}else i=(o=DG.g(r(r(e))))+(n(i)?C(i):0),Ig.F(r(e),I,DG,i),sV(e,new eV(aC,t,o,i,null,null,null));Ig.F(r(e),I,Wn,IF.g(t))}var AV=!0,BV=null,wV=72,xV=40,CV=null,DV=null,EV=null,FV=null,GV=10,HV=0,IV=null;function JV(e){var t=null!=e?!!(32768&e.B||cb===e.zf)||!e.B&&Cb(xc,e):Cb(xc,e);return t?Ns.g(r(r(e))):t}function KV(e){var t=IV;return n(t)&&(t=n(t=ib)?IV>=ib:t),yb(AV)?OU.call(null,e):n(t)?Qc(db,"..."):(n(IV)&&(IV+=1),BV.call(null,e)),t}var LV=function e(t){for(var n=[],r=arguments.length,i=0;i<r;)n.push(arguments[i]),i+=1;return e.l(arguments[0],1<n.length?new Fd(n.slice(1),0,null):null)};function MV(e){var t=new Za,n=db;db=new od(t);try{var r=db,i=yb(JV(r)),o=db;db=i?vV(r):r;try{r=AV,AV=!0;try{KV(e)}finally{AV=r}x.h(0,WU(db,TR))||Qc(db,"\n"),VU()}finally{db=o}Wj(p.g(t))}finally{db=n}}function NV(e,t){if(yb(t.g?t.g(e):t.call(null,e)))throw Error(["Bad argument: ",p.g(e),". It must be one of ",p.g(t)].join(""))}function OV(){var e=jb;return n(e)?HV>=jb:e}function PV(e){NV(e,new uj(null,new k(null,4,[Is,null,tm,null,yD,null,qw,null],null),null));var t=db;Ig.F(r(t),I,So,$x);var n=DG.g(r(r(t))),i=Wn.g(r(r(t)));sV(t,new cV(js,e,i,n,n,null,null,null))}function QV(e,t){NV(e,new uj(null,new k(null,2,[vv,null,zm,null],null),null));var i=db,o=Wn.g(r(r(i)));if(x.h(So.g(r(r(i))),jp)){tV(i);var l=Rp.g(o);if(n(x.h?x.h(vv,e):x.call(null,vv,e)))e=r(fE.g(o));else{if(!n(x.h?x.h(zm,e):x.call(null,zm,e)))throw Error(["No matching clause: ",p.g(e)].join(""));e=WU(XF.g(r(r(i))),TR)}Gg(l,t+e)}else l=DG.g(r(r(i))),sV(i,new fV(wz,o,e,t,l,l,null,null,null))}function RV(e,t,r){t="string"==typeof t?SV(t):t,r=TV(r);e:{var i=new Za,o=yb(e)||!0===e?new od(i):e,l=UV(t)&&yb(JV(o))?n(JV(o))?o:vV(o):o,s=db;db=l;try{try{VV(t,r)}finally{o!==l&&Rc(l)}var a=yb(e)?p.g(i):!0===e?Wj(p.g(i)):null;break e}finally{db=s}a=void 0}return a}LV.l=function(e,t){var r=pj.l(D([new k(null,1,[kC,!0],null),Xf(jj,t)]));t=GV;var i=DV,o=ib,l=jb,s=CV,a=xV,u=BV,c=AV,h=FV,d=hb,f=wV,g=EV,w=XF.h(r,GV),m=fD.h(r,DV),v=Pq.h(r,ib),y=bE.h(r,jb),b=sz.h(r,CV),S=ux.h(r,xV),$=tr.h(r,BV),C=kF.h(r,AV),I=ku.h(r,FV),x=qb.h(r,hb),E=Fy.h(r,wV),A=NG.h(r,EV);GV=w,DV=m,ib=v,jb=y,CV=b,xV=S,BV=$,AV=C,FV=I,hb=x,wV=E,EV=A;try{var _=new Za,j=!M(r,kC)||kC.g(r),N=!0===j||null==j?new od(_):j;if(n(AV)){var R=yb(JV(N));r=db,db=R?vV(N):N;try{KV(e),VU()}finally{db=r}}else{R=db,db=N;try{OU.call(null,e)}finally{db=R}}return!0===j&&Wj(p.g(_)),null==j?p.g(_):null}finally{EV=g,wV=f,hb=d,FV=h,AV=c,BV=u,xV=a,CV=s,jb=l,ib=o,DV=i,GV=t}},LV.I=1,LV.J=function(e){var t=A(e);return e=B(e),this.l(t,e)};var WV=null;function XV(e,t){throw e=[p.g(e),"\n",p.g(WV),"\n",p.g(Xf(p,Tg(t," "))),"^\n"].join(""),Error(e)}function YV(e,t,n,r,i,o){this.sc=e,this.fb=t,this.rc=n,this.D=r,this.m=i,this.G=o,this.B=2230716170,this.M=139264}function TV(e){return new YV(e=z(e),e,0,null,null,null)}function ZV(e){var t=ur.g(e);if(n(t))return new Q(null,2,5,S,[A(t),new YV(mt.g(e),B(t),DG.g(e)+1,null,null,null)],null);throw Error("Not enough arguments for format definition")}function $V(e){var t=ZV(e);return e=G(t,0,null),t=G(t,1,null),e="string"==typeof e?SV(e):e,new Q(null,2,5,S,[e,t],null)}function aW(e,t){return t>=DG.g(e)?(t=DG.g(e)-t,bW.h?bW.h(e,t):bW.call(null,e,t)):new YV(mt.g(e),Pg(t,mt.g(e)),t,null,null,null)}function bW(e,t){var n=DG.g(e)+t;return 0>t?aW(e,n):new YV(mt.g(e),Pg(t,ur.g(e)),n,null,null,null)}function cW(e,t,n,r,i,o,l){this.bc=e,this.Zb=t,this.lc=n,this.offset=r,this.D=i,this.m=o,this.G=l,this.B=2230716170,this.M=139264}function dW(e,t){var n=G(e,0,null);e=G(e,1,null);var r=G(e,0,null);return e=G(e,1,null),t=G(r=M(new uj(null,new k(null,2,[Wz,null,hs,null],null),null),n)?new Q(null,2,5,S,[r,t],null):x.h(r,np)?ZV(t):x.h(r,Vn)?new Q(null,2,5,S,[C(ur.g(t)),t],null):new Q(null,2,5,S,[r,t],null),0,null),r=G(r,1,null),new Q(null,2,5,S,[new Q(null,2,5,S,[n,new Q(null,2,5,S,[t,e],null)],null),r],null)}function eW(e,t){return e=G(t=RU(dW,t,e),0,null),t=G(t,1,null),new Q(null,2,5,S,[ah.h(P,e),t],null)}h=YV.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"seq":return this.sc;case"rest":return this.fb;case"pos":return this.rc;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.pprint.arg-navigator{",", ","}",n,Of.h(new Q(null,3,5,S,[new Q(null,2,5,S,[mt,this.sc],null),new Q(null,2,5,S,[ur,this.fb],null),new Q(null,2,5,S,[DG,this.rc],null)],null),this.m))},h.xa=function(){return new Yh(this,3,new Q(null,3,5,S,[mt,ur,DG],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 3+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-402038447^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.sc,t.sc)&&x.h(this.fb,t.fb)&&x.h(this.rc,t.rc)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,3,[DG,null,mt,null,ur,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new YV(this.sc,this.fb,this.rc,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"seq":case"rest":case"pos":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(mt,t):O.call(null,mt,t))?new YV(r,this.fb,this.rc,this.D,this.m,null):n(O.h?O.h(ur,t):O.call(null,ur,t))?new YV(this.sc,r,this.rc,this.D,this.m,null):n(O.h?O.h(DG,t):O.call(null,DG,t))?new YV(this.sc,this.fb,r,this.D,this.m,null):new YV(this.sc,this.fb,this.rc,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,3,5,S,[new xh(mt,this.sc),new xh(ur,this.fb),new xh(DG,this.rc)],null),this.m))},h.S=function(e,t){return new YV(this.sc,this.fb,this.rc,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},h=cW.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"func":return this.bc;case"def":return this.Zb;case"params":return this.lc;case"offset":return this.offset;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#cljs.pprint.compiled-directive{",", ","}",n,Of.h(new Q(null,4,5,S,[new Q(null,2,5,S,[vA,this.bc],null),new Q(null,2,5,S,[qE,this.Zb],null),new Q(null,2,5,S,[CC,this.lc],null),new Q(null,2,5,S,[jx,this.offset],null)],null),this.m))},h.xa=function(){return new Yh(this,4,new Q(null,4,5,S,[vA,qE,CC,jx],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 4+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=-829256337^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.bc,t.bc)&&x.h(this.Zb,t.Zb)&&x.h(this.lc,t.lc)&&x.h(this.offset,t.offset)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,4,[jx,null,vA,null,CC,null,qE,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new cW(this.bc,this.Zb,this.lc,this.offset,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"func":case"def":case"params":case"offset":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(vA,t):O.call(null,vA,t))?new cW(r,this.Zb,this.lc,this.offset,this.D,this.m,null):n(O.h?O.h(qE,t):O.call(null,qE,t))?new cW(this.bc,r,this.lc,this.offset,this.D,this.m,null):n(O.h?O.h(CC,t):O.call(null,CC,t))?new cW(this.bc,this.Zb,r,this.offset,this.D,this.m,null):n(O.h?O.h(jx,t):O.call(null,jx,t))?new cW(this.bc,this.Zb,this.lc,r,this.D,this.m,null):new cW(this.bc,this.Zb,this.lc,this.offset,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,4,5,S,[new xh(vA,this.bc),new xh(qE,this.Zb),new xh(CC,this.lc),new xh(jx,this.offset)],null),this.m))},h.S=function(e,t){return new cW(this.bc,this.Zb,this.lc,this.offset,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)};var fW=new k(null,3,[2,"#b",8,"#o",16,"#x"],null);function gW(e,t,r){var i=G(r=ZV(r),0,null);if(r=G(r,1,null),Se(i))if(x.h(GV,10))var o=[p.g(i),n(FV)?".":null].join("");else{var l=(o=p).g;if(n(FV)){var s=u.h(fW,GV);s=n(s)?s:["#",p.g(GV),"r"].join("")}else s=null;o=[l.call(o,s),p.g(hW(GV,i))].join("")}else o=null;return o=(o=(i=(e=n(o)?o:e.g?e.g(i):e.call(null,i)).length)+oB.g(t))>=nx.g(t)?o:o+(kf(nx.g(t)-o-1,xt.g(t))+1)*xt.g(t),i=Xf(p,Tg(o-i,Yw.g(t))),n(hs.g(t))?NU.l(D([[p.g(i),p.g(e)].join("")])):NU.l(D([[p.g(e),p.g(i)].join("")])),r}function iW(e,t){return vf(A(SU((function(t){return new Q(null,2,5,S,0<t?[lf(t,e),kf(t,e)]:[null,null],null)}),t)))}function hW(e,t){return 0===t?"0":Xf(p,Ng.h((function(e){return hf(10>e?QU("0")+e:QU("a")+(e-10))}),iW(e,t)))}function jW(e,t){return vf(A(SU((function(t){return new Q(null,2,5,S,[z(vf(Og.h(e,t))),z(Pg(e,t))],null)}),vf(t))))}function kW(e,t,r){var i=G(r=ZV(r),0,null);if(r=G(r,1,null),Se(i)||"number"==typeof i&&!isNaN(i)&&1/0!==i&&parseFloat(i)!==parseInt(i,10)&&x.h(i,Math.floor(i))){var o=0>i,l=hW(e,o?-i:i);e=n(Wz.g(t))?function(){var e=Ng.h((function(e){return Xf(p,e)}),jW(ky.g(t),l)),n=Tg(C(e),LE.g(t));return Xf(p,B(Ug.h(n,e)))}():l,e=(e=o?["-",p.g(e)].join(""):n(hs.g(t))?["+",p.g(e)].join(""):e).length<nx.g(t)?[p.g(Xf(p,Tg(nx.g(t)-e.length,Yw.g(t)))),p.g(e)].join(""):e,NU.l(D([e]))}else gW(jk,new k(null,5,[nx,nx.g(t),xt,1,oB,0,Yw,Yw.g(t),hs,!0],null),TV(new Q(null,1,5,S,[i],null)));return r}var lW=new Q(null,20,5,S,"zero one two three four five six seven eight nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen eighteen nineteen".split(" "),null),mW=new Q(null,20,5,S,"zeroth first second third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth thirteenth fourteenth fifteenth sixteenth seventeenth eighteenth nineteenth".split(" "),null),nW=new Q(null,10,5,S,"  twenty thirty forty fifty sixty seventy eighty ninety".split(" "),null),oW=new Q(null,10,5,S,"  twentieth thirtieth fortieth fiftieth sixtieth seventieth eightieth ninetieth".split(" "),null),pW=new Q(null,22,5,S," thousand million billion trillion quadrillion quintillion sextillion septillion octillion nonillion decillion undecillion duodecillion tredecillion quattuordecillion quindecillion sexdecillion septendecillion octodecillion novemdecillion vigintillion".split(" "),null);function qW(e){var t=kf(e,100);e=lf(e,100);var n=0<t?[p.g(ee(lW,t))," hundred"].join(""):null,r=p,i=r.g;if(0<e)if(20>e)var o=ee(lW,e);else{o=kf(e,10);var l=lf(e,10);o=[p.g(0<o?ee(nW,o):null),0<o&&0<l?"-":null,p.g(0<l?ee(lW,l):null)].join("")}else o=null;return[n,0<t&&0<e?" ":null,i.call(r,o)].join("")}function rW(e,t){var n=C(e),r=F;--n;var i=A(e);for(e=B(e);;){if(null==e)return[p.g(Xf(p,Pg(1,Ug.h(Sg(", "),r)))),Ee(i)||Ee(r)?null:", ",p.g(i),!Ee(i)&&0<n+t?[" ",p.g(ee(pW,n+t))].join(""):null].join("");r=Ee(i)?r:re.h(r,[p.g(i)," ",p.g(ee(pW,n+t))].join("")),--n,i=A(e),e=B(e)}}var sW=new Q(null,4,5,S,[new Q(null,9,5,S,"I II III IIII V VI VII VIII VIIII".split(" "),null),new Q(null,9,5,S,"X XX XXX XXXX L LX LXX LXXX LXXXX".split(" "),null),new Q(null,9,5,S,"C CC CCC CCCC D DC DCC DCCC DCCCC".split(" "),null),new Q(null,3,5,S,["M","MM","MMM"],null)],null),tW=new Q(null,4,5,S,[new Q(null,9,5,S,"I II III IV V VI VII VIII IX".split(" "),null),new Q(null,9,5,S,"X XX XXX XL L LX LXX LXXX XC".split(" "),null),new Q(null,9,5,S,"C CC CCC CD D DC DCC DCCC CM".split(" "),null),new Q(null,3,5,S,["M","MM","MMM"],null)],null);function uW(e,t){var n=G(t=ZV(t),0,null);if(t=G(t,1,null),"number"==typeof n&&0<n&&4e3>n){var r=iW(10,n);n=F;for(var i=C(r)-1;;){if(Ee(r)){NU.l(D([Xf(p,n)]));break}var o=A(r);n=x.h(0,o)?n:re.h(n,ee(ee(e,i),o-1)),--i,r=B(r)}}else kW(10,new k(null,5,[nx,0,Yw," ",LE,",",ky,3,Wz,!0],null),TV(new Q(null,1,5,S,[n],null)));return t}var vW=new k(null,5,[8,"Backspace",9,"Tab",10,"Newline",13,"Return",32,"Space"],null);function wW(e,t){t=G(e=ZV(t),0,null),e=G(e,1,null);var r=QU(t);t=127&r,r&=128;var i=u.h(vW,t);return 0<r&&NU.l(D(["Meta-"])),NU.l(D([n(i)?i:32>t?["Control-",p.g(hf(t+64))].join(""):x.h(t,127)?"Control-?":hf(t)])),e}function xW(e,t){var r=ZV(t);if(t=G(r,0,null),r=G(r,1,null),e=Sq.g(e),n(x.h?x.h("o",e):x.call(null,"o",e)))RV(!0,"\\o~3,'0o",D([QU(t)]));else if(n(x.h?x.h("u",e):x.call(null,"u",e)))RV(!0,"\\u~4,'0x",D([QU(t)]));else{if(!n(x.h?x.h(null,e):x.call(null,null,e)))throw Error(["No matching clause: ",p.g(e)].join(""));Qc(db,n(x.h?x.h("\b",t):x.call(null,"\b",t))?"\\backspace":n(x.h?x.h(" ",t):x.call(null," ",t))?"\\space":n(x.h?x.h("\t",t):x.call(null,"\t",t))?"\\tab":n(x.h?x.h("\n",t):x.call(null,"\n",t))?"\\newline":n(x.h?x.h("\f",t):x.call(null,"\f",t))?"\\formfeed":n(x.h?x.h("\r",t):x.call(null,"\r",t))?"\\return":n(x.h?x.h('"',t):x.call(null,'"',t))?'\\"':n(x.h?x.h("\\",t):x.call(null,"\\",t))?"\\\\":["\\",p.g(t)].join(""))}return r}function yW(e,t){return e=G(t=ZV(t),0,null),t=G(t,1,null),NU.l(D([e])),t}function zW(e){return e=A(e),x.h(Bt,e)||x.h(yr,e)}function AW(e,t,n){return oe(RU((function(e,t){if(zW(t))return new Q(null,2,5,S,[null,t],null);var r=G(t=eW(CC.g(e),t),0,null);t=G(t,1,null);var i=TU(r);return r=G(i,0,null),i=G(i,1,null),r=I.j(r,by,n),new Q(null,2,5,S,[null,Xf(vA.g(e),new Q(null,3,5,S,[r,t,i],null))],null)}),t,e))}function BW(e){var t=(e=p.g(e).toLowerCase()).indexOf("e"),n=e.indexOf(".");t=G(e=new Q(null,2,5,S,0>t?0>n?[e,p.g(e.length-1)]:[[e.substring(0,n),e.substring(n+1)].join(""),p.g(n-1)]:0>n?[e.substring(0,t),e.substring(t+1)]:[[e.substring(0,1),e.substring(2,t)].join(""),e.substring(t+1)],null),0,null),e=G(e,1,null);e:if(n=C(t),0<n&&x.h(ee(t,C(t)-1),"0"))for(--n;;){if(0>n){t="";break e}if(!x.h(ee(t,n),"0")){t=t.substring(0,n+1);break e}--n}e:{var r=C(n=t);if(0<r&&x.h(ee(n,0),"0"))for(var i=0;;){if(x.h(i,r)||!x.h(ee(n,i),"0")){n=n.substring(i);break e}i+=1}}return t=C(t)-C(n),e=0<C(e)&&x.h(ee(e,0),"+")?e.substring(1):e,Ee(n)?new Q(null,2,5,S,["0",0],null):new Q(null,2,5,S,[n,parseInt(e,10)-t],null)}function CW(e,t,r,i){if(n(n(r)?r:i)){var o=C(e);i=n(i)?2>i?2:i:0,n(r)?r=t+r+1:0<=t?r=(r=t+1)>--i?r:i:r=i+t;var l=x.h(r,0)?new Q(null,4,5,S,[["0",p.g(e)].join(""),t+1,1,o+1],null):new Q(null,4,5,S,[e,t,r,o],null);if(r=G(l,0,null),o=G(l,1,null),i=G(l,2,null),l=G(l,3,null),n(i)){if(0>i)return new Q(null,3,5,S,["0",0,!1],null);if(l>i){if(t=ee(r,i),e=r.substring(0,i),QU(t)>=QU("5")){e:for(t=C(e)-1,r=0|t;;){if(0>r){t=Yf(p,"1",Tg(t+1,"0"));break e}if(!x.h("9",e.charAt(r))){t=Zf(p,e.substring(0,r),hf(QU(e.charAt(r))+1),Tg(t-r,"0"));break e}--r}return e=C(t)>e.length,new Q(null,3,5,S,[e?sf(t,0,C(t)-1):t,o,e],null)}return new Q(null,3,5,S,[e,o,!1],null)}}}return new Q(null,3,5,S,[e,t,!1],null)}function DW(e,t,r){var i=new Q(null,2,5,S,0>t?[[p.g(Xf(p,Tg(-t-1,"0"))),p.g(e)].join(""),-1]:[e,t],null);e=G(i,0,null);var o=G(i,1,null);return r=(i=C(e))<(r=n(r)?o+r+1:o+1)?[p.g(e),p.g(Xf(p,Tg(r-i,"0")))].join(""):e,0>t?t=[".",p.g(r)].join(""):(t+=1,t=[r.substring(0,t),".",r.substring(t)].join("")),t}function EW(e,t){return 0>t?[".",p.g(e)].join(""):[e.substring(0,t),".",e.substring(t)].join("")}function FW(e,t){var r=kE.g(e),i=zE.g(e),o=G(t=ZV(t),0,null);t=G(t,1,null);var l=new Q(null,2,5,S,0>o?["-",-o]:["+",o],null),s=G(l,0,null);l=G(l,1,null);var a,u=G(l=BW(l),0,null),c=G(l,1,null)+vE.g(e);l=n(a=hs.g(e))?a:0>o;var h=yb(i)&&C(u)-1<=c,d=CW(u,c,i,n(r)?r-(n(l)?1:0):null);if(u=G(d,0,null),c=G(d,1,null),u=DW(u,n(d=G(d,2,null))?c+1:c,i),i=n(n(r)?n(i)?1<=i&&x.h(u.charAt(0),"0")&&x.h(u.charAt(1),".")&&u.length>r-(n(l)?1:0):i:r)?u.substring(1):u,c=x.h(A(i),"."),n(r)){u=i.length,u=n(l)?u+1:u,h=h&&!(u>=r);var f=(c=c&&!(u>=r))||h?u+1:u;n(function(){var t=f>r;return t?BE.g(e):t}())?NU.l(D([Xf(p,Tg(r,BE.g(e)))])):NU.l(D([[p.g(Xf(p,Tg(r-f,Yw.g(e)))),p.g(n(l)?s:null),c?"0":null,i,h?"0":null].join("")]))}else NU.l(D([[p.g(n(l)?s:null),c?"0":null,i,h?"0":null].join("")]));return t}function GW(e,t){var r=G(t=ZV(t),0,null);t=G(t,1,null);var i,o=BW(0>r?-r:r);for(G(o,0,null),G(o,1,null);;){var l=G(o,0,null),s=G(o,1,null),a=kE.g(e),u=zE.g(e),c=wE.g(e),h=vE.g(e),d=(i=void 0,n(i=fm.g(e))?i:"E");o=function(){var t=hs.g(e);return n(t)?t:0>r}();var f=0>=h,g=s-(h-1),w=p.g(Math.abs(g)),m=(d=[p.g(d),0>g?"-":"+",p.g(n(c)?Xf(p,Tg(c-w.length,"0")):null),w].join("")).length;if(g=C(l),l=[p.g(Xf(p,Tg(-h,"0"))),p.g(l),p.g(n(u)?Xf(p,Tg(u-(g-1)-(0>h?-h:0),"0")):null)].join(""),g=n(a)?a-m:null,g=G(l=CW(l,0,x.h(h,0)?u-1:0<h?u:0>h?u-1:null,n(g)?g-(n(o)?1:0):null),0,null),G(l,1,null),w=G(l,2,null),l=EW(g,h),u=x.h(h,C(g))&&null==u,yb(w)){if(n(a)){s=l.length+m,s=n(o)?s+1:s;var v=(f=f&&!x.h(s,a))?s+1:s;s=u&&v<a,n(function(){var t=v>a;return t||(t=n(t=c)?m-2>c:t),n(t)?BE.g(e):t}())?NU.l(D([Xf(p,Tg(a,BE.g(e)))])):NU.l(D([[p.g(Xf(p,Tg(a-v-(s?1:0),Yw.g(e)))),n(o)?0>r?"-":"+":null,f?"0":null,l,s?"0":null,d].join("")]))}else NU.l(D([[n(o)?0>r?"-":"+":null,f?"0":null,l,u?"0":null,d].join("")]));break}o=new Q(null,2,5,S,[g,s+1],null)}return t}function HW(e,t,r){var i=ZV(t),o=G(i,0,null);G(i,1,null);var l=G(i=BW(0>o?-o:o),0,null);i=G(i,1,null);var s=kE.g(e),a=zE.g(e),u=wE.g(e);return i=x.h(o,0)?0:i+1,o=n(u)?u+2:4,s=n(s)?s-o:null,n(a)?l=a:l=(l=C(l))>(a=7>i?i:7)?l:a,0<=(i=l-i)&&i<=l?(e=FW(new k(null,6,[kE,s,zE,i,vE,0,BE,BE.g(e),Yw,Yw.g(e),hs,hs.g(e)],null),t),NU.l(D([Xf(p,Tg(o," "))])),e):GW(e,t)}function IW(e,t){var r=G(t=ZV(t),0,null);t=G(t,1,null);var i=BW(Math.abs(r)),o=G(i,0,null),l=G(i,1,null),s=zE.g(e),a=nE.g(e);i=kE.g(e);var u=function(){var t=hs.g(e);return n(t)?t:0>r}(),c=CW(o,l,s,null);return o=G(c,0,null),l=G(c,1,null),s=DW(o,n(c=G(c,2,null))?l+1:l,s),a=[p.g(Xf(p,Tg(a-s.indexOf("."),"0"))),s].join(""),s=a.length+(n(u)?1:0),NU.l(D([[n(function(){var t=Wz.g(e);return n(t)?u:t}())?0>r?"-":"+":null,p.g(Xf(p,Tg(i-s,Yw.g(e)))),n(function(){var t=yb(Wz.g(e));return t?u:t}())?0>r?"-":"+":null,a].join("")])),t}function JW(e,t){var r=up.g(e);t=G(r=n(r)?new Q(null,2,5,S,[r,t],null):ZV(t),0,null),r=G(r,1,null);var i=OF.g(e);return n(t=0>t||t>=C(i)?A(lt.g(e)):ee(i,t))?AW(t,r,by.g(e)):r}function KW(e,t){var r=ZV(t);t=G(r,0,null),r=G(r,1,null);var i=OF.g(e);return t=n(t)?oe(i):A(i),n(t)?AW(t,r,by.g(e)):r}function LW(e,t){var r=ZV(t),i=G(r,0,null);r=G(r,1,null);var o=OF.g(e);return o=n(i)?A(o):null,n(i)?n(o)?AW(o,t,by.g(e)):t:r}function MW(e,t){var r=aB.g(e),i=A(OF.g(e));t=G(i=Ee(i)?$V(t):new Q(null,2,5,S,[i,t],null),0,null),i=G(i,1,null);var o=G(i=ZV(i),0,null);i=G(i,1,null);var l=0;o=TV(o);for(var s=-1;;){if(yb(r)&&x.h(DG.g(o),s)&&1<l)throw Error("%{ construct not consuming any arguments: Infinite loop!");if(n((s=Ee(ur.g(o))&&(yb(Wz.g(Sz.g(e)))||0<l))||(n(r)?l>=r:r)))return i;if(s=AW(t,o,by.g(e)),x.h(Bt,A(s)))return i;l+=1;var a=DG.g(o);o=s,s=a}}function NW(e,t){var r=aB.g(e),i=A(OF.g(e));t=G(i=Ee(i)?$V(t):new Q(null,2,5,S,[i,t],null),0,null),i=G(i,1,null);var o=G(i=ZV(i),0,null);i=G(i,1,null);for(var l=0;;){var s=Ee(o)&&(yb(Wz.g(Sz.g(e)))||0<l);if(n(s||(n(r)?l>=r:r)))return i;if(s=AW(t,TV(A(o)),TV(B(o))),x.h(yr,A(s)))return i;l+=1,o=B(o)}}function OW(e,t){var r=aB.g(e),i=A(OF.g(e)),o=Ee(i)?$V(t):new Q(null,2,5,S,[i,t],null);t=G(o,0,null),i=0,o=G(o,1,null);for(var l=-1;;){if(yb(r)&&x.h(DG.g(o),l)&&1<i)throw Error("%@{ construct not consuming any arguments: Infinite loop!");if(n((l=Ee(ur.g(o))&&(yb(Wz.g(Sz.g(e)))||0<i))||(n(r)?i>=r:r)))return o;if(l=AW(t,o,by.g(e)),x.h(Bt,A(l)))return oe(l);i+=1;var s=DG.g(o);o=l,l=s}}function PW(e,t){var r=aB.g(e),i=A(OF.g(e)),o=Ee(i)?$V(t):new Q(null,2,5,S,[i,t],null);for(t=G(o,0,null),i=0,o=G(o,1,null);;){var l=Ee(ur.g(o))&&(yb(Wz.g(Sz.g(e)))||0<i);if(n(l||(n(r)?i>=r:r)))return o;if(o=G(l=n(l=ur.g(o))?new Q(null,2,5,S,[A(l),new YV(mt.g(o),B(l),DG.g(o)+1,null,null,null)],null):new Q(null,2,5,S,[null,o],null),0,null),l=G(l,1,null),o=AW(t,TV(o),l),x.h(yr,A(o)))return l;o=l,i+=1}}function QW(e,t){if(n(Wz.g(Sz.g(e)))){var r=OF.g(e),i=C(r),o=1<i?CB.g(CC.g(A(A(r)))):n(Wz.g(e))?"(":null,l=ee(r,1<i?1:0);if(r=2<i?CB.g(CC.g(A(ee(r,2)))):n(Wz.g(e))?")":null,t=G(i=ZV(t),0,null),i=G(i,1,null),n(OV()))Qc(db,"#");else{var s=HV,a=IV;HV+=1,IV=0;try{yV(o,r),AW(l,TV(t),by.g(e)),zV()}finally{IV=a,HV=s}}e=i}else e=RW(e,t);return e}function SW(e,t,n){for(var r=F;;){if(Ee(e))return new Q(null,2,5,S,[r,t],null);var i=A(e);e:{var o=new Za,l=db;db=new od(o);try{var s=new Q(null,2,5,S,[AW(i,t,n),p.g(o)],null);break e}finally{db=l}s=void 0}if(t=G(s,0,null),i=G(s,1,null),x.h(Bt,A(t)))return new Q(null,2,5,S,[r,oe(t)],null);e=B(e),r=re.h(r,i)}}function RW(e,t){var i,o=n(i=lt.g(e))?SW(i,t,by.g(e)):null,l=G(o,0,null);l=G(l,0,null);var s=n(o=G(o,1,null))?o:t;o=function(){var t=Uv.g(e);return n(t)?eW(t,s):null}();var a=G(o,0,null),u=n(o=G(o,1,null))?o:s;o=function(){var e=A(CE.g(a));return n(e)?e:0}();var c=function(){var e=A(oq.g(a));return n(e)?e:WU(db,EC)}(),h=OF.g(e),d=G(u=SW(h,u,by.g(e)),0,null);u=G(u,1,null);var f=function(){var t=C(d)-1+(n(Wz.g(e))?1:0)+(n(hs.g(e))?1:0);return 1>t?1:t}();h=Nb.h(ff,Ng.h(C,d));var g=nx.g(e),w=oB.g(e),m=xt.g(e),v=h+f*w,y=(g=v<=g?g:g+m*(1+kf(v-g-1,m)))-h;h=function(){var e=kf(y,f);return w>e?w:e}(),m=y-h*f,h=Xf(p,Tg(h,Yw.g(e))),n(n(l)?WU(XF.g(r(r(db))),TR)+o+g>c:l)&&NU.l(D([l])),o=m;for(var b=d,S=function(){var t=Wz.g(e);return n(t)?t:x.h(C(b),1)&&yb(hs.g(e))}();z(b);)NU.l(D([[p.g(yb(S)?A(b):null),p.g(n(function(){var t=S;return n(t)||(t=B(b))?t:hs.g(e)}())?h:null),p.g(0<o?Yw.g(e):null)].join("")])),--o,b=l=n(S)?b:B(b),S=!1;return u}function TW(e){return void 0!==$a&&void 0!==GU&&void 0!==JU||((JU=function(e,t){this.Da=e,this.Gh=t,this.B=1074135040,this.M=0}).prototype.S=function(e,t){return new JU(this.Da,t)},JU.prototype.R=function(){return this.Gh},JU.prototype.oc=function(){return Rc(this.Da)},JU.prototype.Oc=function(e,t){if(e=Db(t),n(x.h?x.h(String,e):x.call(null,String,e)))return Qc(this.Da,t.toLowerCase());if(n(x.h?x.h(Number,e):x.call(null,Number,e)))return Qc(this.Da,hf(t).toLowerCase());throw Error(["No matching clause: ",p.g(e)].join(""))},JU.Na=!0,JU.Ja="cljs.pprint/t_cljs$pprint20670",JU.Pa=function(e){return Qc(e,"cljs.pprint/t_cljs$pprint20670")}),new JU(e,P)}function UW(e){return void 0!==$a&&void 0!==GU&&void 0!==KU||((KU=function(e,t){this.Da=e,this.Hh=t,this.B=1074135040,this.M=0}).prototype.S=function(e,t){return new KU(this.Da,t)},KU.prototype.R=function(){return this.Hh},KU.prototype.oc=function(){return Rc(this.Da)},KU.prototype.Oc=function(e,t){if(e=Db(t),n(x.h?x.h(String,e):x.call(null,String,e)))return Qc(this.Da,t.toUpperCase());if(n(x.h?x.h(Number,e):x.call(null,Number,e)))return Qc(this.Da,hf(t).toUpperCase());throw Error(["No matching clause: ",p.g(e)].join(""))},KU.Na=!0,KU.Ja="cljs.pprint/t_cljs$pprint20678",KU.Pa=function(e){return Qc(e,"cljs.pprint/t_cljs$pprint20678")}),new KU(e,P)}function VW(e,t){var r=A(e);return Xf(p,A(SU((function(e){if(Ee(e))return new Q(null,2,5,S,[null,null],null);var t=RegExp("\\W\\w","g").exec(e);return t=n(t)?t.index+1:t,n(t)?new Q(null,2,5,S,[[e.substring(0,t),ee(e,t).toUpperCase()].join(""),e.substring(t+1)],null):new Q(null,2,5,S,[e,null],null)}),n(n(t)?n(r)?Wa(r):r:t)?[r.toUpperCase(),e.substring(1)].join(""):e)))}function WW(e){var t=Fg(!0);return void 0!==$a&&void 0!==GU&&void 0!==LU||(LU=function(e,t,n){this.Da=e,this.Rd=t,this.Ih=n,this.B=1074135040,this.M=0},LU.prototype.S=function(e,t){return new LU(this.Da,this.Rd,t)},LU.prototype.R=function(){return this.Ih},LU.prototype.oc=function(){return Rc(this.Da)},LU.prototype.Oc=function(e,t){if(e=Db(t),n(x.h?x.h(String,e):x.call(null,String,e)))return Qc(this.Da,VW(t.toLowerCase(),r(this.Rd))),0<t.length?Gg(this.Rd,Fa(ee(t,C(t)-1))):null;if(n(x.h?x.h(Number,e):x.call(null,Number,e)))return t=hf(t),e=n(r(this.Rd))?t.toUpperCase():t,Qc(this.Da,e),Gg(this.Rd,Fa(t));throw Error(["No matching clause: ",p.g(e)].join(""))},LU.Na=!0,LU.Ja="cljs.pprint/t_cljs$pprint20688",LU.Pa=function(e){return Qc(e,"cljs.pprint/t_cljs$pprint20688")}),new LU(e,t,P)}function XW(e){var t=Fg(!1);return void 0!==$a&&void 0!==GU&&void 0!==MU||(MU=function(e,t,n){this.Da=e,this.xd=t,this.Jh=n,this.B=1074135040,this.M=0},MU.prototype.S=function(e,t){return new MU(this.Da,this.xd,t)},MU.prototype.R=function(){return this.Jh},MU.prototype.oc=function(){return Rc(this.Da)},MU.prototype.Oc=function(e,t){if(e=Db(t),n(x.h?x.h(String,e):x.call(null,String,e)))return t=t.toLowerCase(),yb(r(this.xd))?(e=n(e=RegExp("\\S","g").exec(t))?e.index:e,n(e)?(Qc(this.Da,[t.substring(0,e),ee(t,e).toUpperCase(),t.substring(e+1).toLowerCase()].join("")),Gg(this.xd,!0)):Qc(this.Da,t)):Qc(this.Da,t.toLowerCase());if(n(x.h?x.h(Number,e):x.call(null,Number,e)))return t=hf(t),n((e=yb(r(this.xd)))?Wa(t):e)?(Gg(this.xd,!0),Qc(this.Da,t.toUpperCase())):Qc(this.Da,t.toLowerCase());throw Error(["No matching clause: ",p.g(e)].join(""))},MU.Na=!0,MU.Ja="cljs.pprint/t_cljs$pprint20700",MU.Pa=function(e){return Qc(e,"cljs.pprint/t_cljs$pprint20700")}),new MU(e,t,P)}function YW(e,t){return QV(n(Wz.g(e))?zm:vv,nE.g(e)),t}function ZW(e,t){return PV(e=n(Wz.g(e))?n(hs.g(e))?Is:yD:n(hs.g(e))?tm:qw),t}var $W=Ri("ASDBOXRPCFEG$%&|~\nT*?()[;]{}<>^W_I".split(""),[new k(null,5,[ws,"A",CC,new k(null,4,[nx,new Q(null,2,5,S,[0,Number],null),xt,new Q(null,2,5,S,[1,Number],null),oB,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return function(e,t){return gW(jk,e,t)}}],null),new k(null,5,[ws,"S",CC,new k(null,4,[nx,new Q(null,2,5,S,[0,Number],null),xt,new Q(null,2,5,S,[1,Number],null),oB,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return function(e,t){return gW(hk,e,t)}}],null),new k(null,5,[ws,"D",CC,new k(null,4,[nx,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null),LE,new Q(null,2,5,S,[",",String],null),ky,new Q(null,2,5,S,[3,Number],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return function(e,t){return kW(10,e,t)}}],null),new k(null,5,[ws,"B",CC,new k(null,4,[nx,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null),LE,new Q(null,2,5,S,[",",String],null),ky,new Q(null,2,5,S,[3,Number],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return function(e,t){return kW(2,e,t)}}],null),new k(null,5,[ws,"O",CC,new k(null,4,[nx,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null),LE,new Q(null,2,5,S,[",",String],null),ky,new Q(null,2,5,S,[3,Number],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return function(e,t){return kW(8,e,t)}}],null),new k(null,5,[ws,"X",CC,new k(null,4,[nx,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null),LE,new Q(null,2,5,S,[",",String],null),ky,new Q(null,2,5,S,[3,Number],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return function(e,t){return kW(16,e,t)}}],null),new k(null,5,[ws,"R",CC,new k(null,5,[XF,new Q(null,2,5,S,[null,Number],null),nx,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null),LE,new Q(null,2,5,S,[",",String],null),ky,new Q(null,2,5,S,[3,Number],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(e){return n(A(XF.g(e)))?function(e,t){return kW(XF.g(e),e,t)}:n(n(t=hs.g(e))?Wz.g(e):t)?function(e,t){return uW(sW,t)}:n(hs.g(e))?function(e,t){return uW(tW,t)}:n(Wz.g(e))?function(e,t){if(t=G(e=ZV(t),0,null),e=G(e,1,null),x.h(0,t))NU.l(D(["zeroth"]));else{var n=iW(1e3,0>t?-t:t);if(C(n)<=C(pW)){var r=Ng.h(qW,Qg(1,n));r=rW(r,1);var i=qe(n);n=kf(i,100),i=lf(i,100);var o=0<n?[p.g(ee(lW,n))," hundred"].join(""):null,l=p,s=l.g;if(0<i)if(20>i)var a=ee(mW,i);else{a=kf(i,10);var u=lf(i,10);a=0<a&&!(0<u)?ee(oW,a):[p.g(0<a?ee(nW,a):null),0<a&&0<u?"-":null,p.g(0<u?ee(mW,u):null)].join("")}else a=0<n?"th":null;n=[o,0<n&&0<i?" ":null,s.call(l,a)].join(""),NU.l(D([[0>t?"minus ":null,Ee(r)||Ee(n)?Ee(r)?n:[r,"th"].join(""):[r,", ",n].join("")].join("")]))}else kW(10,new k(null,5,[nx,0,Yw," ",LE,",",ky,3,Wz,!0],null),TV(new Q(null,1,5,S,[t],null))),t=11<(r=lf(t,100))||19>r,r=lf(r,10),NU.l(D([1===r&&t?"st":2===r&&t?"nd":3===r&&t?"rd":"th"]))}return e}:function(e,t){if(e=G(t=ZV(t),0,null),t=G(t,1,null),x.h(0,e))NU.l(D(["zero"]));else{var n=iW(1e3,0>e?-e:e);C(n)<=C(pW)?(n=rW(n=Ng.h(qW,n),0),NU.l(D([[0>e?"minus ":null,n].join("")]))):kW(10,new k(null,5,[nx,0,Yw," ",LE,",",ky,3,Wz,!0],null),TV(new Q(null,1,5,S,[e],null)))}return t};var t}],null),new k(null,5,[ws,"P",CC,P,oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return function(e,t){t=n(Wz.g(e))?bW(t,-1):t,e=n(hs.g(e))?new Q(null,2,5,S,["y","ies"],null):new Q(null,2,5,S,["","s"],null);var r=ZV(t);return t=G(r,0,null),r=G(r,1,null),NU.l(D([x.h(t,1)?A(e):oe(e)])),r}}],null),new k(null,5,[ws,"C",CC,new k(null,1,[Sq,new Q(null,2,5,S,[null,String],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(e){return n(Wz.g(e))?wW:n(hs.g(e))?xW:yW}],null),new k(null,5,[ws,"F",CC,new k(null,5,[kE,new Q(null,2,5,S,[null,Number],null),zE,new Q(null,2,5,S,[null,Number],null),vE,new Q(null,2,5,S,[0,Number],null),BE,new Q(null,2,5,S,[null,String],null),Yw,new Q(null,2,5,S,[" ",String],null)],null),oD,new uj(null,new k(null,1,[hs,null],null),null),Mo,P,JD,function(){return FW}],null),new k(null,5,[ws,"E",CC,new k(null,7,[kE,new Q(null,2,5,S,[null,Number],null),zE,new Q(null,2,5,S,[null,Number],null),wE,new Q(null,2,5,S,[null,Number],null),vE,new Q(null,2,5,S,[1,Number],null),BE,new Q(null,2,5,S,[null,String],null),Yw,new Q(null,2,5,S,[" ",String],null),fm,new Q(null,2,5,S,[null,String],null)],null),oD,new uj(null,new k(null,1,[hs,null],null),null),Mo,P,JD,function(){return GW}],null),new k(null,5,[ws,"G",CC,new k(null,7,[kE,new Q(null,2,5,S,[null,Number],null),zE,new Q(null,2,5,S,[null,Number],null),wE,new Q(null,2,5,S,[null,Number],null),vE,new Q(null,2,5,S,[1,Number],null),BE,new Q(null,2,5,S,[null,String],null),Yw,new Q(null,2,5,S,[" ",String],null),fm,new Q(null,2,5,S,[null,String],null)],null),oD,new uj(null,new k(null,1,[hs,null],null),null),Mo,P,JD,function(){return HW}],null),new k(null,5,[ws,"$",CC,new k(null,4,[zE,new Q(null,2,5,S,[2,Number],null),nE,new Q(null,2,5,S,[1,Number],null),kE,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return IW}],null),new k(null,5,[ws,"%",CC,new k(null,1,[mw,new Q(null,2,5,S,[1,Number],null)],null),oD,wj,Mo,P,JD,function(){return function(e,t){e=mw.g(e);for(var n=0;n<e;)PU(),n+=1;return t}}],null),new k(null,5,[ws,"&",CC,new k(null,1,[mw,new Q(null,2,5,S,[1,Number],null)],null),oD,new uj(null,new k(null,1,[kF,null],null),null),Mo,P,JD,function(){return function(e,t){0<(e=mw.g(e))&&((null!=db?32768&db.B||cb===db.zf||!db.B&&Cb(xc,db):Cb(xc,db))&&x.h(0,WU(XF.g(r(r(db))),TR))||PU()),--e;for(var n=0;n<e;)PU(),n+=1;return t}}],null),new k(null,5,[ws,"|",CC,new k(null,1,[mw,new Q(null,2,5,S,[1,Number],null)],null),oD,wj,Mo,P,JD,function(){return function(e,t){e=mw.g(e);for(var n=0;n<e;)NU.l(D(["\f"])),n+=1;return t}}],null),new k(null,5,[ws,"~",CC,new k(null,1,[nE,new Q(null,2,5,S,[1,Number],null)],null),oD,wj,Mo,P,JD,function(){return function(e,t){return e=nE.g(e),NU.l(D([Xf(p,Tg(e,"~"))])),t}}],null),new k(null,5,[ws,"\n",CC,P,oD,new uj(null,new k(null,2,[Wz,null,hs,null],null),null),Mo,P,JD,function(){return function(e,t){return n(hs.g(e))&&PU(),t}}],null),new k(null,5,[ws,"T",CC,new k(null,2,[Fq,new Q(null,2,5,S,[1,Number],null),xt,new Q(null,2,5,S,[1,Number],null)],null),oD,new uj(null,new k(null,2,[hs,null,kF,null],null),null),Mo,P,JD,function(e){return n(hs.g(e))?function(e,t){var n=Fq.g(e);e=xt.g(e);var i=n+WU(XF.g(r(r(db))),TR);return i=0<e?lf(i,e):0,n+=x.h(0,i)?0:e-i,NU.l(D([Xf(p,Tg(n," "))])),t}:function(e,t){var n=Fq.g(e);e=xt.g(e);var i=WU(XF.g(r(r(db))),TR);return n=i<n?n-i:x.h(e,0)?0:e-lf(i-n,e),NU.l(D([Xf(p,Tg(n," "))])),t}}],null),new k(null,5,[ws,"*",CC,new k(null,1,[nE,new Q(null,2,5,S,[1,Number],null)],null),oD,new uj(null,new k(null,2,[Wz,null,hs,null],null),null),Mo,P,JD,function(){return function(e,t){var r=nE.g(e);return n(hs.g(e))?aW(t,r):bW(t,n(Wz.g(e))?-r:r)}}],null),new k(null,5,[ws,"?",CC,P,oD,new uj(null,new k(null,1,[hs,null],null),null),Mo,P,JD,function(e){return n(hs.g(e))?function(e,t){var n=$V(t);return AW(t=G(n,0,null),n=G(n,1,null),by.g(e))}:function(e,t){var n=$V(t);t=G(n,0,null);var r=ZV(n=G(n,1,null));return n=G(r,0,null),r=G(r,1,null),AW(t,n=TV(n),by.g(e)),r}}],null),new k(null,5,[ws,"(",CC,P,oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,new k(null,3,[ow,")",Wx,null,lt,null],null),JD,function(e){var t,r=n(n(t=hs.g(e))?Wz.g(e):t)?UW:n(Wz.g(e))?WW:n(hs.g(e))?XW:TW;return function(e,t){e:{var n=A(OF.g(e)),i=db;db=r.g?r.g(db):r.call(null,db);try{var o=AW(n,t,by.g(e));break e}finally{db=i}o=void 0}return o}}],null),new k(null,5,[ws,")",CC,P,oD,wj,Mo,P,JD,function(){return null}],null),new k(null,5,[ws,"[",CC,new k(null,1,[up,new Q(null,2,5,S,[null,Number],null)],null),oD,new uj(null,new k(null,2,[Wz,null,hs,null],null),null),Mo,new k(null,3,[ow,"]",Wx,!0,lt,IA],null),JD,function(e){return n(Wz.g(e))?KW:n(hs.g(e))?LW:JW}],null),new k(null,5,[ws,";",CC,new k(null,2,[CE,new Q(null,2,5,S,[null,Number],null),oq,new Q(null,2,5,S,[null,Number],null)],null),oD,new uj(null,new k(null,1,[Wz,null],null),null),Mo,new k(null,1,[XC,!0],null),JD,function(){return null}],null),new k(null,5,[ws,"]",CC,P,oD,wj,Mo,P,JD,function(){return null}],null),new k(null,5,[ws,"{",CC,new k(null,1,[aB,new Q(null,2,5,S,[null,Number],null)],null),oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,new k(null,2,[ow,"}",Wx,!1],null),JD,function(e){var t=hs.g(e);return t=n(t)?Wz.g(e):t,n(t)?PW:n(Wz.g(e))?NW:n(hs.g(e))?OW:MW}],null),new k(null,5,[ws,"}",CC,P,oD,new uj(null,new k(null,1,[Wz,null],null),null),Mo,P,JD,function(){return null}],null),new k(null,5,[ws,"<",CC,new k(null,4,[nx,new Q(null,2,5,S,[0,Number],null),xt,new Q(null,2,5,S,[1,Number],null),oB,new Q(null,2,5,S,[0,Number],null),Yw,new Q(null,2,5,S,[" ",String],null)],null),oD,new uj(null,new k(null,4,[Wz,null,hs,null,xq,null,kF,null],null),null),Mo,new k(null,3,[ow,">",Wx,!0,lt,mu],null),JD,function(){return QW}],null),new k(null,5,[ws,">",CC,P,oD,new uj(null,new k(null,1,[Wz,null],null),null),Mo,P,JD,function(){return null}],null),new k(null,5,[ws,"^",CC,new k(null,3,[ay,new Q(null,2,5,S,[null,Number],null),dy,new Q(null,2,5,S,[null,Number],null),cy,new Q(null,2,5,S,[null,Number],null)],null),oD,new uj(null,new k(null,1,[Wz,null],null),null),Mo,P,JD,function(){return function(e,t){var r=ay.g(e),i=dy.g(e),o=cy.g(e),l=n(Wz.g(e))?yr:Bt;return n(n(r)?n(i)?o:i:r)?r<=i&&i<=o?new Q(null,2,5,S,[l,t],null):t:n(n(r)?i:r)?x.h(r,i)?new Q(null,2,5,S,[l,t],null):t:n(r)?x.h(r,0)?new Q(null,2,5,S,[l,t],null):t:(n(Wz.g(e))?Ee(ur.g(by.g(e))):Ee(ur.g(t)))?new Q(null,2,5,S,[l,t],null):t}}],null),new k(null,5,[ws,"W",CC,P,oD,new uj(null,new k(null,4,[Wz,null,hs,null,xq,null,kF,null],null),null),Mo,P,JD,function(e){if(n(n(r=hs.g(e))?r:Wz.g(e))){var t=Of.h(n(hs.g(e))?new Q(null,4,5,S,[bE,null,Pq,null],null):F,n(Wz.g(e))?new Q(null,2,5,S,[kF,!0],null):F);return function(e,r){return e=G(r=ZV(r),0,null),r=G(r,1,null),n(Yf(LV,e,t))?new Q(null,2,5,S,[Bt,r],null):r}}var r;return function(e,t){return e=G(t=ZV(t),0,null),t=G(t,1,null),n(KV(e))?new Q(null,2,5,S,[Bt,t],null):t}}],null),new k(null,5,[ws,"_",CC,P,oD,new uj(null,new k(null,3,[Wz,null,hs,null,xq,null],null),null),Mo,P,JD,function(){return ZW}],null),new k(null,5,[ws,"I",CC,new k(null,1,[nE,new Q(null,2,5,S,[0,Number],null)],null),oD,new uj(null,new k(null,1,[Wz,null],null),null),Mo,P,JD,function(){return YW}],null)]),aX=/^([vV]|#|('.)|([+-]?\d+)|(?=,))/,bX=new uj(null,new k(null,2,[Vn,null,np,null],null),null);function cX(e){var t=G(e,0,null),r=G(e,1,null),i=G(e,2,null),o=(e=new RegExp(aX.source,"g")).exec(t);return n(o)?(i=A(o),t=t.substring(e.lastIndex),e=r+e.lastIndex,x.h(",",ee(t,0))?new Q(null,2,5,S,[new Q(null,2,5,S,[i,r],null),new Q(null,3,5,S,[t.substring(1),e+1,!0],null)],null):new Q(null,2,5,S,[new Q(null,2,5,S,[i,r],null),new Q(null,3,5,S,[t,e,!1],null)],null)):n(i)?XV("Badly formed parameters in format directive",r):new Q(null,2,5,S,[null,new Q(null,2,5,S,[t,r],null)],null)}function dX(e){var t=G(e,0,null);return e=G(e,1,null),new Q(null,2,5,S,[x.h(t.length,0)?null:x.h(t.length,1)&&M(new uj(null,new k(null,2,["V",null,"v",null],null),null),ee(t,0))?np:x.h(t.length,1)&&x.h("#",ee(t,0))?Vn:x.h(t.length,2)&&x.h("'",ee(t,0))?ee(t,1):parseInt(t,10),e],null)}var eX=new k(null,2,[":",Wz,"@",hs],null);function fX(e,t){return SU((function(e){var t=G(e,0,null),r=G(e,1,null);if(e=G(e,2,null),Ee(t))return new Q(null,2,5,S,[null,new Q(null,3,5,S,[t,r,e],null)],null);var i=u.h(eX,A(t));return n(i)?M(e,i)?XV(['Flag "',p.g(A(t)),'" appears more than once in a directive'].join(""),r):new Q(null,2,5,S,[!0,new Q(null,3,5,S,[t.substring(1),r+1,I.j(e,i,new Q(null,2,5,S,[!0,r],null))],null)],null):new Q(null,2,5,S,[null,new Q(null,3,5,S,[t,r,e],null)],null)}),new Q(null,3,5,S,[e,t,P],null))}function gX(e,t){var r,i=oD.g(e);n((r=yb(hs.g(i)))?hs.g(t):r)&&XV(['"@" is an illegal flag for format directive "',p.g(ws.g(e)),'"'].join(""),ee(hs.g(t),1)),n(function(){var e=yb(Wz.g(i));return e?Wz.g(t):e}())&&XV(['":" is an illegal flag for format directive "',p.g(ws.g(e)),'"'].join(""),ee(Wz.g(t),1)),n(function(){var e=yb(xq.g(i));return e?n(e=hs.g(t))?Wz.g(t):e:e}())&&XV(['Cannot combine "@" and ":" flags for format directive "',p.g(ws.g(e)),'"'].join(""),function(){var e=ee(Wz.g(t),1),n=ee(hs.g(t),1);return e<n?e:n}())}function hX(e,t,n,r){return gX(e,n),C(t)>C(CC.g(e))&&XV(RV(null,'Too many parameters for directive "~C": ~D~:* ~[were~;was~:;were~] specified but only ~D~:* ~[are~;is~:;are~] allowed',D([ws.g(e),C(t),C(CC.g(e))])),oe(A(t))),Oj(Ng.j((function(t,n){var r=A(t);return null==r||M(bX,r)||x.h(oe(oe(n)),Db(r))?null:XV(["Parameter ",Cf(A(n)),' has bad type in directive "',p.g(ws.g(e)),'": ',p.g(Db(r))].join(""),oe(t))}),t,CC.g(e))),pj.l(D([ah.h(P,vf(function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var i=ed(n),o=C(i),l=Hf(o);e:for(var s=0;;){if(!(s<o)){i=!0;break e}var a=Zb(i,s),u=G(a,0,null);a=G(a,1,null),a=G(a,0,null),l.add(new Q(null,2,5,S,[u,new Q(null,2,5,S,[a,r],null)],null)),s+=1}return Jf(Lf(l),i?e(fd(n)):null)}return l=G(i=A(n),0,null),i=G(i,1,null),i=G(i,0,null),ke(new Q(null,2,5,S,[l,new Q(null,2,5,S,[i,r],null)],null),e(Hd(n)))}return null}}),null,null)}(CC.g(e)))),Nb.j((function(e,t){return Yf(I,e,t)}),P,Xg.h((function(e){return A(ee(e,1))}),Bj(di(CC.g(e)),t))),n]))}function iX(e,t){e=G(t=SU(cX,new Q(null,3,5,S,[e,t,!1],null)),0,null);var r=G(t,1,null);t=G(r,0,null),r=G(r,1,null),G(t=fX(t,r),0,null),t=G(t,1,null);var i=G(t,0,null),o=G(t,1,null);t=G(t,2,null),r=A(i);var l,s=u.h($W,r.toUpperCase()),a=n(s)?hX(s,Ng.h(dX,e),t,o):null;return yb(r)&&XV("Format string ended in the middle of a directive",o),yb(s)&&XV(['Directive "',p.g(r),'" is undefined'].join(""),o),new Q(null,2,5,S,[new cW((l=JD.g(s),l.h?l.h(a,o):l.call(null,a,o)),s,a,o,null,null,null),function(){var e=i.substring(1),t=o+1;if(x.h("\n",ws.g(s))&&yb(Wz.g(a)))e:{var n=new Q(null,2,5,S,[" ","\t"],null);n=Fe(n)?yj(n):xj([n]);for(var r=0;;){var l;if((l=x.h(r,C(e)))||(l=ee(e,r),l=yb(l=n.g?n.g(l):n.call(null,l))),l){n=r;break e}r+=1}}else n=0;return new Q(null,2,5,S,[e.substring(n),t+n],null)}()],null)}function jX(e,t){return new cW((function(t,n){return NU.l(D([e])),n}),null,new k(null,1,[CB,e],null),t,null,null,null)}function kX(e,t){var n=lX(Mo.g(qE.g(e)),jx.g(e),t);return t=G(n,0,null),n=G(n,1,null),new Q(null,2,5,S,[new cW(vA.g(e),qE.g(e),pj.l(D([CC.g(e),UU(t,jx.g(e))])),jx.g(e),null,null,null),n],null)}function mX(e,t,r){return SU((function(r){if(Ee(r))return XV("No closing bracket found.",t);var i=A(r);if(r=B(r),n(ow.g(Mo.g(qE.g(i)))))i=kX(i,r);else if(x.h(ow.g(e),ws.g(qE.g(i))))i=new Q(null,2,5,S,[null,new Q(null,4,5,S,[Ot,CC.g(i),null,r],null)],null);else{var o=XC.g(Mo.g(qE.g(i)));o=n(o)?Wz.g(CC.g(i)):o,i=n(o)?new Q(null,2,5,S,[null,new Q(null,4,5,S,[lt,null,CC.g(i),r],null)],null):n(XC.g(Mo.g(qE.g(i))))?new Q(null,2,5,S,[null,new Q(null,4,5,S,[XC,null,null,r],null)],null):new Q(null,2,5,S,[i,r],null)}return i}),r)}function lX(e,t,r){return oe(SU((function(r){var i=G(r,0,null),o=G(r,1,null);r=G(r,2,null);var l=mX(e,t,r);r=G(l,0,null);var s=G(l,1,null);l=G(s,0,null);var a=G(s,1,null),u=G(s,2,null);return s=G(s,3,null),x.h(l,Ot)?new Q(null,2,5,S,[null,new Q(null,2,5,S,[qj.l(Of,D([i,ve([n(o)?lt:OF,new Q(null,1,5,S,[r],null),Sz,a])])),s],null)],null):x.h(l,lt)?n(lt.g(i))?XV('Two else clauses ("~:;") inside bracket construction.',t):yb(lt.g(e))?XV('An else clause ("~:;") is in a bracket type that doesn\'t support it.',t):x.h(mu,lt.g(e))&&z(OF.g(i))?XV('The else clause ("~:;") is only allowed in the first position for this directive.',t):x.h(mu,lt.g(e))?new Q(null,2,5,S,[!0,new Q(null,3,5,S,[qj.l(Of,D([i,new k(null,2,[lt,new Q(null,1,5,S,[r],null),Uv,u],null)])),!1,s],null)],null):new Q(null,2,5,S,[!0,new Q(null,3,5,S,[qj.l(Of,D([i,new k(null,1,[OF,new Q(null,1,5,S,[r],null)],null)])),!0,s],null)],null):x.h(l,XC)?n(o)?XV('A plain clause (with "~;") follows an else clause ("~:;") inside bracket construction.',t):yb(Wx.g(e))?XV('A separator ("~;") is in a bracket type that doesn\'t support it.',t):new Q(null,2,5,S,[!0,new Q(null,3,5,S,[qj.l(Of,D([i,new k(null,1,[OF,new Q(null,1,5,S,[r],null)],null)])),!1,s],null)],null):null}),new Q(null,3,5,S,[new k(null,1,[OF,F],null),!1,r],null)))}function nX(e){return A(SU((function(e){var t=A(e);e=B(e);var r=Mo.g(qE.g(t));return n(ow.g(r))?kX(t,e):new Q(null,2,5,S,[t,e],null)}),e))}function SV(e){var t=WV;WV=e;try{return nX(A(SU((function(e){var t=G(e,0,null);if(e=G(e,1,null),Ee(t))return new Q(null,2,5,S,[null,t],null);var n=t.indexOf("~");return 0>n?new Q(null,2,5,S,[jX(t,e),new Q(null,2,5,S,["",e+t.length],null)],null):0===n?iX(t.substring(1),e+1):new Q(null,2,5,S,[jX(t.substring(0,n),e),new Q(null,2,5,S,[t.substring(n),n+e],null)],null)}),new Q(null,2,5,S,[e,0],null))))}finally{WV=t}}var UV=function e(t){for(;;){if(Ee(t))return!1;var r=kF.g(oD.g(qE.g(A(t))));if(n(r)||(r=n(r=vg(e,A(OF.g(CC.g(A(t))))))?r:vg(e,A(lt.g(CC.g(A(t)))))),n(r))return!0;t=B(t)}};function VV(e,t){return RU((function(e,t){if(zW(t))return new Q(null,2,5,S,[null,t],null);var n=G(t=eW(CC.g(e),t),0,null);t=G(t,1,null);var r=TU(n);return n=G(r,0,null),r=G(r,1,null),n=I.j(n,by,t),new Q(null,2,5,S,[null,Xf(vA.g(e),new Q(null,3,5,S,[n,t,r],null))],null)}),t,e),null}var oX=Hk(SV),pX=new k(null,6,[Bl,"'",Al,"#'",lB,"@",cD,"~",sv,"@",lv,"~"],null);function qX(e){var t=A(e);return n(n(t=pX.g?pX.g(t):pX.call(null,t))?x.h(2,C(e)):t)?(Qc(db,t),KV(oe(e)),!0):null}function rX(e){if(n(OV()))Qc(db,"#");else{var t=HV,r=IV;HV+=1,IV=0;try{yV("[","]");for(var i=0,o=z(e);;){if(yb(ib)||i<ib){if(o&&(KV(A(o)),B(o))){Qc(db," "),PV(qw),e=i+1;var l=B(o);i=e,o=l;continue}}else Qc(db,"...");break}zV()}finally{IV=r,HV=t}}return null}function sX(e){var t,r=Ke(e)?null:(t=new Cd((function(){return nk}),kz,Ri([ZE,Rs,Yo,CD,so,rs,cw,MG,oo,KC,wD],[!0,sm,Vx,"cljs/core.cljs",15,1,10543,10543,N(new Q(null,1,5,S,[Ut],null)),"Returns [lifted-ns lifted-map] or nil if m can't be lifted.",n(nk)?nk.md:null]))).g?t.g(e):t.call(null,e),i=G(r,0,null),o=n(r=G(r,1,null))?r:e,l=n(i)?["#:",p.g(i),"{"].join(""):"{";if(n(OV()))Qc(db,"#");else{i=HV,r=IV,HV+=1,IV=0;try{yV(l,"}"),l=0;for(var s=z(o);;){if(yb(ib)||l<ib){if(s){if(n(OV()))Qc(db,"#");else{o=HV;var a=IV;HV+=1,IV=0;try{yV(null,null),KV(A(A(s))),Qc(db," "),PV(qw),IV=0,KV(pe(A(s))),zV()}finally{IV=a,HV=o}}if(B(s)){Qc(db,", "),PV(qw),o=l+1;var u=B(s);l=o,s=u;continue}}}else Qc(db,"...");break}zV()}finally{IV=r,HV=i}}return null}function tX(e){return Qc(db,hk.l(D([e])))}!function(){var e=oX("~<[~;~@{~w~^, ~:_~}~;]~:>");(function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}t.I=0,t.J=function(e){return n(e=z(e))},t.l=n})()}();var uX=function(){var e=oX("~<#{~;~@{~w~^ ~:_~}~;}~:>");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}(),vX=new k(null,2,["core$future_call","Future","core$promise","Promise"],null),wX=function(){var e=oX("~<<-(~;~@{~w~^ ~_~}~;)-<~:>");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}();function xX(e){return e instanceof Th?wn:(null!=e?32768&e.B||cb===e.zf||!e.B&&Cb(xc,e):Cb(xc,e))?UA:e instanceof Ad?zq:Qe(e)?Xx:J(e)?BC:Le(e)?hA:Ge(e)?pt:null==e?null:Zk}var yX,Y2=Fg(P),Z2=Fg(P),$2=Fg(P),a3=Fg(P),b3=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));function EX(e){return Le(e)?new Q(null,2,5,S,["[","]"],null):new Q(null,2,5,S,["(",")"],null)}function FX(e){if(Ie(e)){var t=EX(e),r=G(t,0,null),i=G(t,1,null),o=z(e),l=A(o),s=B(o);if(n(OV()))Qc(db,"#");else{var a=HV,u=IV,c=HV+1;HV=c,IV=0;try{yV(r,i),(E=oX("~w~:i"),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=TV(e),VV(E,e)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}())(l);for(var h=s;z(h);){!function(){var e,t=oX(" ");return e=t,function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()();var d=A(h);if(Ie(d)){var f=EX(d),p=G(f,0,null),g=G(f,1,null);if(n(OV()))Qc(db,"#");else{var m=HV,v=IV,y=HV+1;HV=y,IV=0;try{if(yV(p,g),x.h(C(d),3)&&oe(d)instanceof w){var b=d,S=G(b,0,null),$=G(b,1,null),I=G(b,2,null);!function(){var e,t=oX("~w ~w ");return e=t,function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(S,$),Ie(I)?function(){var e,t=Le(I)?"~<[~;~@{~w~^ ~:_~}~;]~:>":"~<(~;~@{~w~^ ~:_~}~;)~:>",n="string"==typeof t?oX(t):t;return e=n,function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(I):KV(I)}else Xf(function(){var e,t=oX("~w ~:i~@{~w~^ ~:_~}");return e=t,function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}(),d);zV()}finally{IV=v,HV=m}}B(h)&&function(){var e,t=oX("~_");return e=t,function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()()}else KV(d),B(h)&&function(){var e,t=oX("~:_");return e=t,function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()();h=B(h)}zV()}finally{IV=u,HV=a}}}else KV(e);var E}yX=new Yk(Bd.h("cljs.pprint","simple-dispatch"),xX,b3,Y2,Z2,$2,a3),Uk(yX,Xx,(function(e){if(yb(qX(e)))if(n(OV()))Qc(db,"#");else{var t=HV,r=IV;HV+=1,IV=0;try{yV("(",")");for(var i=0,o=z(e);;){if(yb(ib)||i<ib){if(o&&(KV(A(o)),B(o))){Qc(db," "),PV(qw),e=i+1;var l=B(o);i=e,o=l;continue}}else Qc(db,"...");break}zV()}finally{IV=r,HV=t}}return null})),Uk(yX,hA,rX),Uk(yX,BC,sX),Uk(yX,pt,uX),Uk(yX,null,(function(){return Qc(db,hk.l(D([null])))})),Uk(yX,Zk,tX),BV=yX;var GX=function(){var e=oX("~:<~w~^ ~@_~w~^ ~_~@{~w~^ ~_~}~:>");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}();function HX(e,t){var r;z(e)&&(n(t)?(r=oX(" ~_"),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=TV(e),VV(r,e)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}())():function(){var e=oX(" ~@_");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(),function(){var e=oX("~{~w~^ ~_~}");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(e))}function IX(e){var t;z(e)&&(t=oX(" ~_~{~w~^ ~_~}"),function(){function e(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(e){return e=TV(e),VV(t,e)}return e.I=0,e.J=function(e){return n(e=z(e))},e.l=n,e}())(e)}function JX(e){if(B(e)){var t=z(e);e=A(t);var r=B(t);t=A(r);var i="string"==typeof A(r=B(r))?new Q(null,2,5,S,[A(r),B(r)],null):new Q(null,2,5,S,[null,r],null);r=G(i,0,null);var o=J(A(i=G(i,1,null)))?new Q(null,2,5,S,[A(i),B(i)],null):new Q(null,2,5,S,[null,i],null);if(i=G(o,0,null),o=G(o,1,null),n(OV()))Qc(db,"#");else{var l=HV,s=IV;HV+=1,IV=0;try{yV("(",")"),(a=oX("~w ~1I~@_~w"),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=TV(e),VV(a,e)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}())(e,t),n(r)&&function(){var e=oX(" ~_~w");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(r),n(i)&&function(){var e=oX(" ~_~w");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(i),Le(A(o))?HX(o,n(r)?r:i):IX(o),zV()}finally{IV=s,HV=l}}return null}var a;return KX(e)}function LX(e){if(n(OV()))Qc(db,"#");else{var t=HV,r=IV;HV+=1,IV=0;try{yV("[","]");for(var i=0;;){if(yb(ib)||i<ib){if(z(e)){if(n(OV()))Qc(db,"#");else{var o=HV,l=IV;HV+=1,IV=0;try{yV(null,null),KV(A(e)),B(e)&&(Qc(db," "),PV(tm),KV(oe(e))),zV()}finally{IV=l,HV=o}}if(B(Hd(e))){Qc(db," "),PV(qw),o=i+1;var s=B(Hd(e));i=o,e=s;continue}}}else Qc(db,"...");break}zV()}finally{IV=r,HV=t}}}function MX(e){var t=A(e);if(n(OV()))Qc(db,"#");else{var r=HV,i=IV;HV+=1,IV=0;try{yV("(",")"),B(e)&&Le(oe(e))?(function(){var e=oX("~w ~1I~@_");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(t),LX(oe(e)),function(){var e=oX(" ~_~{~w~^ ~_~}");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(B(Hd(e)))):KX(e),zV()}finally{IV=i,HV=r}}return null}var NX=function(){var e=oX("~:<~1I~w~^ ~@_~w~@{ ~_~w~}~:>");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}(),OX=P;function KX(e){if(n(OV()))Qc(db,"#");else{var t=HV,r=IV;HV+=1,IV=0;try{yV("(",")"),QV(vv,1);for(var i=0,o=z(e);;){if(yb(ib)||i<ib){if(o&&(KV(A(o)),B(o))){Qc(db," "),PV(qw),e=i+1;var l=B(o);i=e,o=l;continue}}else Qc(db,"...");break}zV()}finally{IV=r,HV=t}}return null}var PX=function(e){return ah.h(P,Wg(bf,D([function e(t){return new Df(null,(function(){for(;;){var n=z(t);if(n){if(Me(n)){var r=ed(n),i=C(r),o=Hf(i);e:for(var l=0;;){if(!(l<i)){r=!0;break e}var s=Zb(r,l);s=new Q(null,2,5,S,[s,new Q(null,2,5,S,[Bd.g(Cf(A(s))),oe(s)],null)],null),o.add(s),l+=1}return Jf(Lf(o),r?e(fd(n)):null)}return o=A(n),ke(new Q(null,2,5,S,[o,new Q(null,2,5,S,[Bd.g(Cf(A(o))),oe(o)],null)],null),e(Hd(n)))}return null}}),null,null)}(e)])))}(function(e){return ah.h(P,Ng.h((function(e){var t=G(e,0,null),r=G(e,1,null),i=zf(t);return yb(i=n(i)?i:gl(t))?new Q(null,2,5,S,[Bd.h("clojure.core",Cf(t)),r],null):e}),e))}(Ri([zl,wl,ro,ql,at,Im,ao,nt,hq,vp,Gq,aA,Rw,El,zv,Wy,Fx,SF,rm,sl,ZA,eB,vF,WA,pv,sG,Cm,yn,Eo,$B],[GX,function(e){var t,n=oe(e),r=A(Hd(Hd(e)));if(!Le(n))return KX(e);e=OX,OX=x.h(1,C(n))?ve([A(n),"%"]):ah.h(P,Ng.j((function(e,t){return new Q(null,2,5,S,[e,["%",p.g(t)].join("")],null)}),n,Kj(C(n)+1)));try{return(t=oX("~<#(~;~@{~w~^ ~_~}~;)~:>"),function(){function e(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(e){return e=TV(e),VV(t,e)}return e.I=0,e.J=function(e){return n(e=z(e))},e.l=n,e}())(r)}finally{OX=e}},MX,NX,function(e){if(3<C(e)){if(n(OV()))Qc(db,"#");else{var t=HV,r=IV;HV+=1,IV=0;try{yV("(",")"),QV(vv,1),Xf((a=oX("~w ~@_~w ~@_~w ~_"),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=TV(e),VV(a,e)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}()),e);for(var i=0,o=z(Pg(3,e));;){if(yb(ib)||i<ib){if(o){if(n(OV()))Qc(db,"#");else{e=HV;var l=IV;HV+=1,IV=0;try{yV(null,null),KV(A(o)),B(o)&&(Qc(db," "),PV(tm),KV(oe(o))),zV()}finally{IV=l,HV=e}}if(B(Hd(o))){Qc(db," "),PV(qw),e=i+1;var s=B(Hd(o));i=e,o=s;continue}}}else Qc(db,"...");break}zV()}finally{IV=r,HV=t}}return null}var a;return KX(e)},GX,JX,JX,MX,GX,MX,NX,NX,GX,NX,MX,MX,GX,MX,function(e){if(B(e)){var t=z(e);e=A(t);var r=B(t);t=A(r);var i="string"==typeof A(r=B(r))?new Q(null,2,5,S,[A(r),B(r)],null):new Q(null,2,5,S,[null,r],null);r=G(i,0,null),i=G(i,1,null);var o=G(i=J(A(i))?new Q(null,2,5,S,[A(i),B(i)],null):new Q(null,2,5,S,[null,i],null),0,null),l=G(i,1,null);if(n(OV()))Qc(db,"#");else{i=HV;var s=IV;HV+=1,IV=0;try{for(yV("(",")"),(u=oX("~w ~1I~@_~w"),function(){function e(e){var n=null;if(0<arguments.length){n=0;for(var r=Array(arguments.length-0);n<r.length;)r[n]=arguments[n+0],++n;n=new Fd(r,0,null)}return t.call(this,n)}function t(e){return e=TV(e),VV(u,e)}return e.I=0,e.J=function(e){return t(e=z(e))},e.l=t,e}())(e,t),n(n(r)?r:n(o)?o:z(l))&&function(){var e=oX("~@:_");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(),n(r)&&RV(!0,'"~a"~:[~;~:@_~]',D([r,n(o)?o:z(l)])),n(o)&&function(){var e=oX("~w~:[~;~:@_~]");return function(){function t(e){var t=null;if(0<arguments.length){t=0;for(var r=Array(arguments.length-0);t<r.length;)r[t]=arguments[t+0],++t;t=new Fd(r,0,null)}return n.call(this,t)}function n(t){return t=TV(t),VV(e,t)}return t.I=0,t.J=function(e){return n(e=z(e))},t.l=n,t}()}()(o,z(l)),e=l;;){FX(A(e));var a=B(e);if(!a)break;t=a,PV(qw),e=t}zV()}finally{IV=s,HV=i}}return null}var u;return KV(e)},MX,function(e){if(n(OV()))Qc(db,"#");else{var t=HV,r=IV;HV+=1,IV=0;try{if(yV("(",")"),QV(vv,1),KV(A(e)),B(e)){Qc(db," "),PV(qw);for(var i=0,o=B(e);;){if(yb(ib)||i<ib){if(o){if(n(OV()))Qc(db,"#");else{e=HV;var l=IV;HV+=1,IV=0;try{yV(null,null),KV(A(o)),B(o)&&(Qc(db," "),PV(tm),KV(oe(o))),zV()}finally{IV=l,HV=e}}if(B(Hd(o))){Qc(db," "),PV(qw),e=i+1;var s=B(Hd(o));i=e,o=s;continue}}}else Qc(db,"...");break}}zV()}finally{IV=r,HV=t}}return null},MX,JX,JX,GX,GX,MX,MX,GX]))),QX,c3=Fg(P),d3=Fg(P),e3=Fg(P),f3=Fg(P),g3=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));QX=new Yk(Bd.h("cljs.pprint","code-dispatch"),xX,g3,c3,d3,e3,f3),Uk(QX,Xx,(function(e){if(yb(qX(e))){var t=PX.call(null,A(e));return n(t)?t.g?t.g(e):t.call(null,e):KX(e)}return null})),Uk(QX,zq,(function(e){var t=e.g?e.g(OX):e.call(null,OX);return n(t)?NU.l(D([t])):n(EV)?NU.l(D([Cf(e)])):OU.call(null,e)})),Uk(QX,hA,rX),Uk(QX,BC,sX),Uk(QX,pt,uX),Uk(QX,wn,wX),Uk(QX,UA,(function(e){var t=p,i=t.g,o=Db(e).name,l=Qj(/^[^$]+\$[^$]+/,o);if(l=n(l)?vX.g?vX.g(l):vX.call(null,l):null,t=["#<",i.call(t,n(l)?l:o),"@",p.g(fa(e)),": "].join(""),n(OV()))Qc(db,"#");else{i=HV,o=IV,HV+=1,IV=0;try{yV(t,">"),QV(vv,-(t.length-2)),PV(qw);var s=null!=e?!!(1&e.M||cb===e.vi)||!e.M&&Cb(Uc,e):Cb(Uc,e);KV((s?!Vc(e):s)?rx:r(e)),zV()}finally{IV=o,HV=i}}return null})),Uk(QX,null,OU),Uk(QX,Zk,tX),BV=yX;var gY=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.local-node.core","process-response"),(function(e){e=bg(e);var t=u.h(e,tB);return u.h(e,Ro),X.g(t)}),i,e,t,n,r)}();function hY(e){this.ch=e}function iY(e,t,n){var r=bg(n),i=u.h(r,$s),o=u.h(r,Ro),l=u.h(r,ut);u.h(r,tB),dh.h(e,new Q(null,2,5,S,[pq,jw],null));try{return x.h(o,new k(null,1,[Bo,1],null))?yS(pD,"gateway.local-node.core",65,lE,new qk((function(){return new Q(null,1,5,S,[function(){var t=new Za,n=fb,r=eb;fb=!0,eb=function(e){return t.append(e)};try{MV(e)}finally{eb=r,fb=n}return p.g(t)}()],null)})),2068656781):x.h(l,jD)?null:GS(t,e,n,i,o)}catch(t){if(t instanceof Error){var s=t;return yS(Cx,"gateway.local-node.core",70,lE,new qk((function(){return new Q(null,3,5,S,[s,"Error handling message",n],null)})),2120187070),new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O(null,i,UC.g(o),pG.g(o),iI(s,"global.errors.failure"))],null)],null)}throw t}}function jY(e,t){var r=pG.g(t);return n(r)?n(e=FQ.h(e,r))?Uz.g(e):null:n(e=Uz.g(t))?I.j(e,xr,xr.g(t)):null}function kY(e,t,i){var o=new Lg(null);try{if(yS(Cy,"gateway.local-node.core",89,lE,new qk((function(){return new Q(null,2,5,S,["domain handler processing message",i],null)})),-105116117),n(!1)){var l=Ro.g(i),s=X.g(l);switch(Mg(o,jY(e,l)),s instanceof w?s.W:null){case"gateway.common.commands/source-removed":break;case"hello":n(!1)&&yS(pD,"gateway.local-node.core",null,lE,new qk((function(){return new Q(null,2,5,S,[gy,new k(null,2,[Uz,r(o),gy,TH(l,new Q(null,2,5,S,[du,"secret"],null))],null)],null)})),-382234349);break;default:n(!1)&&yS(pD,"gateway.local-node.core",null,lE,new qk((function(){return new Q(null,2,5,S,[gy,new k(null,2,[Uz,r(o),gy,l],null)],null)})),608982741)}}var a=iY(e,t,i),u=G(a,0,null),c=G(a,1,null),h=n(u)?u:e,d=z(c);t=null;for(var f=s=0;;)if(f<s){var p=t.$(null,f);gY.g(p),n(!1)&&n(!1)&&yS(pD,"gateway.local-node.core",null,lE,new qk(function(e,t,n,i,o,l,s,a,u,c){return function(){return new Q(null,2,5,S,[gy,new k(null,2,[Uz,r(c),gy,Ro.g(o)],null)],null)}}(0,0,0,0,p,0,0,0,0,o)),1974632640),f+=1}else{var g=z(d);if(!g)break;var m=g;if(Me(m)){var v=ed(m),y=fd(m);m=v;var b=C(v);d=y,t=m,s=b}else{var $=A(m);gY.g($),n(!1)&&n(!1)&&yS(pD,"gateway.local-node.core",null,lE,new qk(function(e,t,n,i,o,l,s,a,u,c,h,d){return function(){return new Q(null,2,5,S,[gy,new k(null,2,[Uz,r(d),gy,Ro.g(o)],null)],null)}}(0,0,0,0,$,0,0,0,0,0,0,o)),-2132107373),d=B(m),t=null,s=0}f=0}return h}catch(t){if(t instanceof Error){var I=t;return yS(Cx,"gateway.local-node.core",107,lE,new qk((function(){return new Q(null,3,5,S,[I,"error handling message",i],null)})),-1874165429),e}throw t}}function lY(e){return ah.h(P,Ng.h((function(e){var t=AQ(e);return new Q(null,2,5,S,[GC.g(t),new k(null,2,[wu,e,pD,t],null)],null)}),e))}function mY(e){var t=P,r=MA.h(t,2e4);yS(pD,"gateway.local-node.core",120,lE,new qk((function(){return new Q(null,2,5,S,["node buffer size:",r],null)})),-581393212);var i=OH(QS(r,(function(e,t){return yS(tz,"gateway.local-node.core",125,lE,new qk((function(){return new Q(null,4,5,S,["the message",e,"is dropped. total dropped so far",t],null)})),702921230)}))),o=lY(e);yS(it,"gateway.local-node.core",128,lE,new qk((function(){return new Q(null,1,5,S,[p.g(o)],null)})),-1855562472),tv.g(t);var l=bI(),s=OH(1);return sH((function(){var e,t=function(){function e(e){var t=e[1];if(1===t){t=function(e,t){return BQ(t,e)};var r=mI(l);r=I.j(r,PE,o),r=I.j(r,Cv,i);var s=ei(o);return s=Ng.h(wu,s),t=Nb.j(t,r,s),e[7]=t,e[2]=null,e[1]=2,fv}return 2===t?MH(e,4,i):3===t?NH(e,e[2]):4===t?(r=e[8],t=e[2],e[8]=t,e[1]=n(null==t)?5:6,fv):5===t?(r=e[8],t=e[7],r=function(e,t){return CQ(t,e)},s=ei(o),s=Ng.h(wu,s),t=Nb.j(r,t,s),e[2]=t,e[1]=7,fv):6===t?(r=e[8],t=kY(t=e[7],o,r),e[7]=t,e[2]=null,e[1]=2,fv):7===t?(e[2]=e[2],e[1]=3,fv):null}return function(){function t(t){for(;;){e:try{for(;;){var n=e(t);if(!O(n,fv)){var r=n;break e}}}catch(e){if(r=e,t[2]=r,!z(t[4]))throw r;t[1]=A(t[4]),r=fv}if(!O(r,fv))return r}}function n(){var e=[null,null,null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(e){switch(arguments.length){case 0:return n.call(this);case 1:return t.call(this,e)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=t,r}()}();return LH(((e=t())[6]=s,e))})),new hY(i)}gY.C(null,jD,(function(){return null})),gY.C(null,zt,(function(){return null})),gY.C(null,qy,(function(){return null})),gY.C(null,gz,(function(e){e=bg(e);var t=u.h(e,tB),n=u.h(e,Ro);return yS(it,"gateway.local-node.core",38,lE,new qk((function(){return new Q(null,3,5,S,["Sending message",n,"to local peer"],null)})),1335907910),PH(oz.g(t),n)})),gY.C(null,Zk,(function(e){return yS(Cx,"gateway.local-node.core",42,lE,new qk((function(){return new Q(null,2,5,S,["Unable to process response",e],null)})),880557039)})),hY.prototype.Jf=function(){return WG(this.ch)},hY.prototype.Kf=function(e,t){return PH(this.ch,t)},hY.prototype.fh=function(){return null},hY.prototype.Lf=function(e,t){return PH(this.ch,new k(null,3,[ut,gz,$s,t,Ro,new k(null,1,[X,zB],null)],null))};var nY=hI("agm.peer-removed","Peer has been removed"),oY=hI("agm.method-removed","Method has been removed"),pY=hI("agm.errors.subscription.invalid_subscription","Trying to drop a subscription that wasnt established. Did you mean to return an error instead?");function qY(e,t,n,r,i){return tI(e,new k(null,6,[wu,"agm",X,ou,pG,t,fn,i,OC,n,ew,r],null))}function rY(e,t,n,r){return tI(e,new k(null,5,[wu,"agm",X,kG,pG,t,OC,n,ew,r],null))}function sY(e,t,n,r){return tI(e,new k(null,5,[wu,"agm",X,xA,UC,t,pG,n,xA,r],null))}function tY(e,t,n,r,i,o){return tI(e,t=new k(null,8,[wu,"agm",X,yo,qD,t,pG,n,Vo,r,pz,i,pE,GC.g(o),In,Ar.g(o)],null))}function uY(e,t,n,r,i,o,l){return tI(e,new k(null,8,[wu,"agm",X,gy,pG,t,qD,n,cB,r,xw,i,Gu,o,Fw,l],null))}function vY(e,t,n){return new k(null,6,[wu,"agm",X,dw,qD,e,pG,t,pE,GC.g(n),In,Ar.g(n)],null)}function wY(e,t,r){var i=bg(r);r=u.h(i,OC);var o=u.h(i,Vo),l=u.h(i,kr);i=u.h(i,IC),cg.h(kt.g(e),kt.g(t))&&yb(RQ.j(CF,e,t))&&jI("agm.errors.invocation.failure","Unable to invoke methods across different users"),n(dh.h(e,new Q(null,4,5,S,[CF,ew,r,o],null)))||jI("agm.errors.invocation.failure",["Unable to find method with id ",p.g(o)," on server id ",p.g(r)," registered with this peer"].join("")),z(l)&&z(i)&&jI("agm.errors.invocation.failure","Cant use positional and by-name arguments at the same time")}function xY(e,t){if("string"==typeof e)return x.h(e,t);var n=null!=t;return n?Pj(e,t):n}function yY(e,t){return Nb.j((function(e,r){return!!n(xY(r,t))&&Td(!0)}),!1,e)}function zY(e,t){return Nb.j((function(e,r){return n(xY(r,t))?Td(!0):e}),!1,NF.g(e))}function AY(e,t){return!n(e=cs.g(e))||Nb.j((function(e,r){return n(xY(r,t))?Td(!0):e}),!1,e)}function BY(e,t){return J(t)?af((function(t,r,i){return n(zY(e,r))?I.j(t,r,"<REMOVED>"):n(AY(e,r))?I.j(t,r,i):I.j(t,r,"<REMOVED>")}),P,t):t}function CY(e,t){var r=Nb.j((function(e,r){var i=xY(Yo.g(r),t);return i=n(i)?Vu.h(r,!0):i,n(i)?Td(r):e}),null,ew.g(e));if(null!=r)return r;switch((e=Su.g(e))instanceof w?e.W:null){case"whitelist":default:return new k(null,1,[kr,new k(null,1,[NF,F],null)],null);case"blacklist":return null}}var DY=new k(null,1,[cG,null],null);function EY(){var e=null!=cG.g(DY);return e?dh.h(DY,new Q(null,2,5,S,[FC,xv],null)):e}function FY(e,t){return BY(kr.g(e),t)}function GY(e,t,r){n(e=cG.g(e))&&(e.j?e.j("interop",t,r):e.call(null,"interop",t,r))}function HY(e){if(null!=cG.g(DY)){var t=r(e);t=bg(t),t=u.h(t,fw);var i=Yo.g(t);t=dh.h(DY,new Q(null,2,5,S,[FC,iE],null));var o=Zm.g(t);if(n(o)){if(n(o.g?o.g(i):o.call(null,i))){var l=Rn.g(t);GY(DY,"invoke",I.j(gh(r(e),Jx,(function(e){return n(l)?l.h?l.h(i,e):l.call(null,i,e):e})),fw,i))}}else{var s=CY(eC.g(t),i);n(s)&&GY(DY,"invoke",I.j(gh(r(e),Jx,(function(e){return FY(s,e)})),fw,i))}}}function IY(e){if(null!=cG.g(DY)){var t=r(e);t=bg(t),t=u.h(t,fw),t=Yo.g(t);var i=dh.h(DY,new Q(null,2,5,S,[FC,iE],null)),o=Zm.g(i);n(o)?n(o.g?o.g(t):o.call(null,t))&&GY(DY,"yield",I.j(r(e),fw,t)):n(CY(eC.g(i),t))&&GY(DY,"yield",I.j(r(e),fw,t))}}function JY(e){if(null!=cG.g(DY)){var t=r(e);t=bg(t),t=u.h(t,fw);var i=Yo.g(t);t=dh.h(DY,new Q(null,2,5,S,[FC,iE],null));var o=Zm.g(t);if(n(o)){if(n(o.g?o.g(i):o.call(null,i))){var l=Rn.g(t);GY(DY,"subscribe",I.j(gh(r(e),Jx,(function(e){return n(l)?l.h?l.h(i,e):l.call(null,i,e):e})),fw,i))}}else{var s=CY(eC.g(t),i);n(s)&&GY(DY,"subscribe",I.j(gh(r(e),Jx,(function(e){return FY(s,e)})),fw,i))}}}function KY(e){if(null!=cG.g(DY)){var t=r(e);t=bg(t),t=u.h(t,fw),t=Yo.g(t);var i=dh.h(DY,new Q(null,2,5,S,[FC,iE],null)),o=Zm.g(i);n(o)?n(o.g?o.g(t):o.call(null,t))&&GY(DY,"unsubscribe",I.j(r(e),fw,t)):n(CY(eC.g(i),t))&&GY(DY,"unsubscribe",I.j(r(e),fw,t))}}function LY(e){if(null!=cG.g(DY)){var t=r(e);t=bg(t),t=u.h(t,fw);var i=Yo.g(t);t=dh.h(DY,new Q(null,2,5,S,[FC,iE],null));var o=Zm.g(t);if(n(o)){if(n(o.g?o.g(i):o.call(null,i))){var l=Rn.g(t);GY(DY,"event",I.j(gh(r(e),Fw,(function(e){return n(l)?l.h?l.h(i,e):l.call(null,i,e):e})),fw,i))}}else{var s=CY(eC.g(t),i);n(s)&&GY(DY,"event",I.j(gh(r(e),Fw,(function(e){return FY(s,e)})),fw,i))}}}function MY(e,t){return new k(null,3,[X,qy,em,t,zt,e],null)}function NY(e,t,n,r){return fh.F(e,new Q(null,4,5,S,[CF,Iz,t,n],null),Dg(re,wj),r)}function OY(e,t,n,r){return null==t?e:WH(e,new Q(null,4,5,S,[CF,Iz,t,n],null),r)}function PY(e,t,n,r,i){var o=bg(n);n=u.h(o,QB);var l=u.h(o,kC);return o=u.h(o,Vo),e=PQ(e,n,l=OY(TH(FQ.h(e,n),new Q(null,3,5,S,[CF,wo,t],null)),l,r,t)),IQ(l)?new Q(null,2,5,S,[e,tY($s.g(l),t,n,o,r,i)],null):new Q(null,2,5,S,[e,null],null)}function QY(e,t,r){var i=dh.h(t,new Q(null,2,5,S,[CF,Ey],null)),o=kt.g(t);return t=Nb.j((function(e,t){var i=G(t,0,null),l=G(t,1,null);return t=G(e,0,null),e=G(e,1,null),i=G(l=PY(t,i,l,o,r),0,null),l=G(l,1,null),new Q(null,2,5,S,[n(i)?i:t,Qe(l)||Le(l)?Nb.j(Dg(re,F),e,l):null!=l?Dg(re,F)(e,l):e],null)}),new Q(null,2,5,S,[e,F],null),i),e=G(t,0,null),t=G(t,1,null),new Q(null,2,5,S,[e,t],null)}function RY(e,t,r){if(n(EY())){var i=kt.g(t);r=z(r);for(var o=null,l=0,s=0;;)if(s<l){var a=o.$(null,s),u=A(a),c=oe(a),h=dh.h(t,new Q(null,4,5,S,[CF,ew,i,Vo.g(c)],null));KY(new qk(function(n,r,i,o,l,s,a){return function(){return new k(null,4,[qD,l,ip,Uz.g(e),QB,Uz.g(t),fw,a],null)}}(0,0,0,0,u,0,h))),s+=1}else{if(!(c=z(r)))break;if(Me(u=c))r=ed(u),s=fd(u),o=r,l=C(r),r=s;else{a=A(u),h=A(a);var d=oe(a);KY(new qk(function(n,r,i,o,l,s,a){return function(){return new k(null,4,[qD,l,ip,Uz.g(e),QB,Uz.g(t),fw,a],null)}}(0,0,0,0,h,0,dh.h(t,new Q(null,4,5,S,[CF,ew,i,Vo.g(d)],null))))),r=B(u),o=null,l=0}s=0}}}function SY(e,t,n){return af((function(e,r,i){return x.h(t,QB.g(i))&&(Ee(n)||M(n,Vo.g(i)))?gh(e,Ws,(function(e){return I.j(e,r,i)})):gh(e,ms,(function(e){return I.j(e,r,i)}))}),P,e)}function TY(e,t,n,r,i){var o=kt.g(n);o=bg(r=SY(dh.h(t,new Q(null,2,5,S,[CF,Ey],null)),o,r)),r=u.h(o,Ws);var l=u.h(o,ms);return o=af((function(e,n,r){return A(PY(e,n,r,kt.g(t),i))}),e,r),z(r)?(RY(t,n,r),new Q(null,2,5,S,[QQ(o,kt.g(t),(function(e){return z(l)?eh(e,new Q(null,2,5,S,[CF,Ey],null),l):hh(e,CF,we,Ey)})),yI($s.g(t))?bh.h((function(e){return tI($s.g(t),vY(e=pc(e),kt.g(t),i))}),r):null],null)):new Q(null,2,5,S,[e,null],null)}function UY(e,t,r){var i=bg(r),o=u.h(i,pG),l=u.h(i,OC),s=u.h(i,qD),a=u.h(i,Vo),c=u.h(i,kr),h=u.h(i,IC),d=u.h(i,Fp);i=u.h(i,oD);var f=FQ.h(t,l);if(n(f)){var g=eh(f,new Q(null,3,5,S,[CF,wo,s],null),new k(null,2,[ip,o,Vo,a],null));f=$s.g(g);var w=dh.h(e,new Q(null,4,5,S,[CF,ew,l,a],null));return JY(new qk((function(){return new k(null,5,[qD,s,ip,Uz.g(e),QB,Uz.g(g),fw,w,Jx,h],null)}))),new Q(null,2,5,S,[PQ(t,l,g),yI(f)?new Q(null,1,5,S,[tI(f,Ri([kr,X,pz,qD,pG,Fp,wu,oD,IC,Vo],[c,uw,o,s,l,d,"agm",i,h,a]))],null):new Q(null,1,5,S,[vI(MY(cI(pq.g(t)),o),new k(null,2,[X,zt,zt,zt.g(f)],null),r)],null)],null)}throw cl(["Unable to find server with id ",p.g(l)].join(""),P)}function VY(e,t,r){var i,o=bg(t),l=u.h(o,UC),s=u.h(o,pG),a=u.h(o,OC),c=u.h(o,Vo),h=eh(HQ(e,s,CF),new Q(null,3,5,S,[CF,Ey,r],null),new k(null,3,[QB,a,Vo,c,UC,l],null)),d=HQ(e,a,CF),f=null==(i=Ae(t))?null:Mt.g(i);return wY(h,d,t),n(f)&&yS(tz,"gateway.domains.agm.subscriptions",176,lE,new qk((function(){return new Q(null,13,5,S,["agm","peer",Uz.g(h),"subscribes for method",c,"on server",Uz.g(d),"with subscription",r,"using request",l,"with large payload",f],null)})),1181224655),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.subscriptions",183,lE,new qk((function(){return new Q(null,10,5,S,["peer",s,"subscribes for method",c,"on",a,"with subscription",r,"using request",l],null)})),222552095),UY(h,PQ(e,s,h),I.j(t,qD,r))}function WY(e,t,r,i,o,l,s){if(n(t)){var a=new Q(null,3,5,S,[CF,Ey,i],null),u=dh.h(t,a),c=UC.g(u);return u=$s.g(t),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.subscriptions",214,lE,new qk((function(){return new Q(null,8,5,S,["peer",r,"dropped/rejected subscription",i,"for request",c,"error?:",s],null)})),748272252),new Q(null,2,5,S,[PQ(e,r,TH(t,a)),yI(u)?n(s)?new Q(null,1,5,S,[wI.oa("agm",u,c,r,o,l)],null):new Q(null,1,5,S,[tI(u,vY(i,r,o))],null):null],null)}return new Q(null,2,5,S,[e,null],null)}function XY(e,t,n,r,i){var o=FQ.h(e,t),l=dh.h(o,new Q(null,4,5,S,[CF,Ey,n,UC],null));return e=PQ(e,t,eh(o,new Q(null,4,5,S,[CF,Ey,n,kC],null),r)),r=$s.g(o),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.subscriptions",235,lE,new qk((function(){return new Q(null,6,5,S,["peer",t,"is accepted subscription",n,"for request",l],null)})),-393787040),IQ(o)?new Q(null,2,5,S,[e,new Q(null,1,5,S,[tI(r,new k(null,5,[wu,"agm",X,Zo,UC,l,pG,t,qD,n],null))],null)],null):new Q(null,2,5,S,[e,new Q(null,1,5,S,[vI(MY(cI(pq.g(e)),pG.g(i)),new k(null,2,[X,zt,zt,zt.g(r)],null),i)],null)],null)}function YY(e,t,r){var i=bg(r),o=u.h(i,qD),l=u.h(i,pG);null==(i=u.h(i,pu))&&jI("agm.errors.subscription.invalid_subscription","Invalid or missing stream id");var s=dh.h(t,new Q(null,3,5,S,[CF,wo,o],null));return n(s)?(s=ip.g(s),XY(PQ(e,l,NY(eh(t,new Q(null,4,5,S,[CF,wo,o,kC],null),i),i,s,o)),s,o,i,r)):yS(it,"gateway.domains.agm.subscriptions",260,lE,new qk((function(){return new Q(null,3,5,S,["Subscription accept response",r,"for missing interest"],null)})),1216486695)}function ZY(e,t){var r=bg(t),i=u.h(r,qD),o=u.h(r,pG);return r=u.h(r,Dn),n(o=FQ.j(e,o,CF))?YY(e,o,t):(yS(tz,"gateway.domains.agm.subscriptions",270,lE,new qk((function(){return new Q(null,3,5,S,["Subscription accept response",t,"from missing peer"],null)})),-2101957782),WY(e,FQ.h(e,r),r,i,hI("agm.errors.subscription.failure","Received a response from a missing server"),null,!0))}Z(Ax,Or,Or),Z($l,jB,jB),Z(wq,N(jz,N(xy,Hs)),nQ(N(xy,Hs),aQ(BB,Bb,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,Hs),Jz,function(e){return Fe(e)}],null),null),null)),Z(lA,N(jz,Wu),nQ(Wu,J,null)),Z(py,N(jz,Wu),nQ(Wu,J,null)),Z(ct,N(jz,Wu),nQ(Wu,J,null)),Z(yG,N(Xy,Ix,N(eD,T,new Q(null,2,5,S,[$l,Ax],null),dD,new Q(null,4,5,S,[wq,lA,py,ct],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,2,5,S,[$l,Ax],null),dD,new Q(null,4,5,S,[wq,lA,py,ct],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[$l,Ax],null),new Q(null,4,5,S,[wq,lA,py,ct],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,OC)},function(e){return M(e,Vo)}],null),function(e){return J(e)&&M(e,OC)&&M(e,Vo)},new Q(null,4,5,S,[kr,IC,oD,Fp],null),new Q(null,2,5,S,[$l,Ax],null),null,new Q(null,2,5,S,[OC,Vo],null),new Q(null,4,5,S,[wq,lA,py,ct],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,OC)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Vo))],null),null]))],null),null)),Z(zG,SC,Ab),Z(cA,N(Xy,Ix,N(eD,T,new Q(null,3,5,S,[zG,To,Vw],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,3,5,S,[zG,To,Vw],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[zG,To,Vw],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,qD)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,qD)&&M(e,pE)&&M(e,In)},F,new Q(null,3,5,S,[zG,To,Vw],null),null,new Q(null,3,5,S,[qD,pE,In],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))],null),null)),Z(HF,jB,jB),Z(lz,N(eD,T,new Q(null,4,5,S,[zG,jB,Ax,HF],null),dD,new Q(null,4,5,S,[wq,lA,py,ct],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,4,5,S,[zG,jB,Ax,HF],null),new Q(null,4,5,S,[wq,lA,py,ct],null),null,new Q(null,5,5,S,[function(e){return J(e)},function(e){return M(e,qD)},function(e){return M(e,pG)},function(e){return M(e,Vo)},function(e){return M(e,pz)}],null),function(e){return J(e)&&M(e,qD)&&M(e,pG)&&M(e,Vo)&&M(e,pz)},new Q(null,4,5,S,[kr,IC,oD,Fp],null),new Q(null,4,5,S,[zG,jB,Ax,HF],null),null,new Q(null,4,5,S,[qD,pG,Vo,pz],null),new Q(null,4,5,S,[wq,lA,py,ct],null),new Q(null,5,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Vo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pz))],null),null]))),Z(Gr,N(eD,T,new Q(null,6,5,S,[zG,jB,Ax,HF,To,Vw],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,6,5,S,[zG,jB,Ax,HF,To,Vw],null),null,null,new Q(null,7,5,S,[function(e){return J(e)},function(e){return M(e,qD)},function(e){return M(e,pG)},function(e){return M(e,Vo)},function(e){return M(e,pz)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,qD)&&M(e,pG)&&M(e,Vo)&&M(e,pz)&&M(e,pE)&&M(e,In)},F,new Q(null,6,5,S,[zG,jB,Ax,HF,To,Vw],null),null,new Q(null,6,5,S,[qD,pG,Vo,pz,pE,In],null),F,new Q(null,7,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Vo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pz)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))),Z(Jo,SC,Ab),Z(st,N(eD,T,new Q(null,3,5,S,[zG,jB,Jo],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[zG,jB,Jo],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,qD)},function(e){return M(e,pG)},function(e){return M(e,pu)}],null),function(e){return J(e)&&M(e,qD)&&M(e,pG)&&M(e,pu)},F,new Q(null,3,5,S,[zG,jB,Jo],null),null,new Q(null,3,5,S,[qD,pG,pu],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pu))],null),null]))),Z(xC,N(eD,T,new Q(null,4,5,S,[jB,zG,To,Vw],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,4,5,S,[jB,zG,To,Vw],null),null,null,new Q(null,5,5,S,[function(e){return J(e)},function(e){return M(e,pG)},function(e){return M(e,qD)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,pG)&&M(e,qD)&&M(e,pE)&&M(e,In)},F,new Q(null,4,5,S,[jB,zG,To,Vw],null),null,new Q(null,4,5,S,[pG,qD,pE,In],null),F,new Q(null,5,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))),Z(vD,eu,xb),Z(Qz,Mw,Pe),Z(Iv,Wu,J),Z(ox,N(eD,T,new Q(null,4,5,S,[jB,vD,Qz,Iv],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,4,5,S,[jB,vD,Qz,Iv],null),null,null,new Q(null,5,5,S,[function(e){return J(e)},function(e){return M(e,pG)},function(e){return M(e,xw)},function(e){return M(e,Gu)},function(e){return M(e,Fw)}],null),function(e){return J(e)&&M(e,pG)&&M(e,xw)&&M(e,Gu)&&M(e,Fw)},F,new Q(null,4,5,S,[jB,vD,Qz,Iv],null),null,new Q(null,4,5,S,[pG,xw,Gu,Fw],null),F,new Q(null,5,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG)),N(V,new Q(null,1,5,S,[W],null),N(U,W,xw)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Gu)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fw))],null),null]))),Z(AF,N(Xy,ox,N(eD,T,new Q(null,1,5,S,[zG],null))),ZP(new Q(null,2,5,S,[ox,N(eD,T,new Q(null,1,5,S,[zG],null))],null),new Q(null,2,5,S,[ox,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[zG],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,qD)}],null),function(e){return J(e)&&M(e,qD)},F,new Q(null,1,5,S,[zG],null),null,new Q(null,1,5,S,[qD],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD))],null),null]))],null),null)),Z(Pt,N(Xy,ox,N(eD,T,new Q(null,1,5,S,[Jo],null))),ZP(new Q(null,2,5,S,[ox,N(eD,T,new Q(null,1,5,S,[Jo],null))],null),new Q(null,2,5,S,[ox,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[Jo],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,pu)}],null),function(e){return J(e)&&M(e,pu)},F,new Q(null,1,5,S,[Jo],null),null,new Q(null,1,5,S,[pu],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pu))],null),null]))],null),null)),Z(tC,N(Xy,Ix,N(eD,T,new Q(null,2,5,S,[$l,Ax],null),dD,new Q(null,3,5,S,[wq,lA,ct],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,2,5,S,[$l,Ax],null),dD,new Q(null,3,5,S,[wq,lA,ct],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[$l,Ax],null),new Q(null,3,5,S,[wq,lA,ct],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,OC)},function(e){return M(e,Vo)}],null),function(e){return J(e)&&M(e,OC)&&M(e,Vo)},new Q(null,3,5,S,[kr,IC,Fp],null),new Q(null,2,5,S,[$l,Ax],null),null,new Q(null,2,5,S,[OC,Vo],null),new Q(null,3,5,S,[wq,lA,ct],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,OC)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Vo))],null),null]))],null),null)),Z(rr,SC,Ab),Z(PD,N(eD,T,new Q(null,4,5,S,[rr,HF,jB,Ax],null),dD,new Q(null,3,5,S,[wq,lA,ct],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,4,5,S,[rr,HF,jB,Ax],null),new Q(null,3,5,S,[wq,lA,ct],null),null,new Q(null,5,5,S,[function(e){return J(e)},function(e){return M(e,jv)},function(e){return M(e,pz)},function(e){return M(e,pG)},function(e){return M(e,Vo)}],null),function(e){return J(e)&&M(e,jv)&&M(e,pz)&&M(e,pG)&&M(e,Vo)},new Q(null,3,5,S,[kr,IC,Fp],null),new Q(null,4,5,S,[rr,HF,jB,Ax],null),null,new Q(null,4,5,S,[jv,pz,pG,Vo],null),new Q(null,3,5,S,[wq,lA,ct],null),new Q(null,5,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,jv)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pz)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Vo))],null),null]))),Z(BF,Wu,J),Z($A,N(eD,T,new Q(null,3,5,S,[rr,jB,BF],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[rr,jB,BF],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,jv)},function(e){return M(e,pG)},function(e){return M(e,xA)}],null),function(e){return J(e)&&M(e,jv)&&M(e,pG)&&M(e,xA)},F,new Q(null,3,5,S,[rr,jB,BF],null),null,new Q(null,3,5,S,[jv,pG,xA],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,jv)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pG)),N(V,new Q(null,1,5,S,[W],null),N(U,W,xA))],null),null])));var $Y,h3=Fg(P),i3=Fg(P),j3=Fg(P),k3=Fg(P),l3=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));function fZ(e,t,r,i){var o=pG.g(r),l=u.h(r,n(i)?UC:qD),s=HQ(e,o,CF),a=dh.h(s,new Q(null,3,5,S,[CF,wo,l],null));if(n(a)){var c=ip.g(a),h=u.h(a,kC);a=FQ.h(e,c);var d=$s.g(a);return n(n(h)?h:i)?(t=G(s=new Q(null,2,5,S,[PQ(e,o,OY(TH(s,new Q(null,3,5,S,[CF,wo,l],null)),h,c,l)),F],null),0,null),s=G(s,1,null),i=G(l=WY(t,a,c,l,kI(r),Fp.g(r),i),0,null),l=G(l,1,null),i=G(l=new Q(null,2,5,S,[n(i)?i:t,Qe(l)||Le(l)?Nb.j(Dg(re,F),s,l):null!=l?Dg(re,F)(s,l):s],null),0,null),l=G(l,1,null),e=G(r=n(n(a)?!yI(d):a)?new Q(null,2,5,S,[null,vI(MY(cI(pq.g(e)),o),new k(null,2,[X,zt,zt,zt.g(d)],null),r)],null):null,0,null),r=G(r,1,null),new Q(null,2,5,S,[n(e)?e:i,Qe(r)||Le(r)?Nb.j(Dg(re,F),l,r):null!=r?Dg(re,F)(l,r):l],null)):new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.oa("agm",t,l,o,pY,null)],null)],null)}return new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.oa("agm",t,l,o,hI("agm.errors.subscription.invalid_subscription","Trying to drop a non-existing subscription"),null)],null)],null)}function gZ(e,t,r,i,o){var l=FQ.h(e,r);if(n(l)){var s=dh.h(l,new Q(null,3,5,S,[CF,wo,i],null));if(n(s)){KY(new qk((function(){return new k(null,4,[qD,i,ip,Uz.g(t),QB,Uz.g(l),fw,dh.h(l,new Q(null,4,5,S,[CF,ew,r,Vo.g(s)],null))],null)})));var a=kt.g(t),u=$s.g(l);return e=PQ(e,r,OY(TH(l,new Q(null,3,5,S,[CF,wo,i],null)),kC.g(s),a,i)),new Q(null,2,5,S,[e,new Q(null,1,5,S,[yI(u)?tY(u,i,r,Vo.g(s),a,kI(o)):vI(MY(cI(pq.g(e)),a),new k(null,2,[X,zt,zt,zt.g(u)],null),o)],null)],null)}}return null}function hZ(e,t,r,i,o){var l=HQ(e,r,CF),s=new Q(null,3,5,S,[CF,Ey,i],null),a=dh.h(l,s);return a=bg(a),a=u.h(a,QB),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.subscriptions",376,lE,new qk((function(){return new Q(null,6,5,S,["peer",r,"unsubscribes subscription",i,"using request",o],null)})),855536145),n(a)?n(t=gZ(e=PQ(e,r,TH(l,s)),l,a,i,t))?t:new Q(null,2,5,S,[e,F],null):jI("agm.errors.subscription.invalid_subscription",["Unable to find subscription with id ",p.g(i)," on subscriber id ",p.g(r)].join(""))}function iZ(e,t,r,i,o,l,s){if(n(EY())){var a=kt.g(r),c=dh.h(r,new Q(null,2,5,S,[CF,wo],null)),h=dh.h(r,new Q(null,3,5,S,[CF,ew,a],null));e=z(e);for(var d=null,f=0,p=0;;)if(p<f){var g=d.$(null,p),w=u.h(c,g),m=u.h(h,Vo.g(w));LY(new qk(function(e,n,a,u,c,h,d){return function(){return new k(null,8,[qD,d,ip,Uz.g(t),QB,Uz.g(r),fw,h,cB,i,vr,o,Gu,l,Fw,s],null)}}(0,0,0,0,0,m,g))),p+=1}else{if(!(m=z(e)))break;if(Me(w=m))e=ed(w),p=fd(w),d=e,f=C(e),e=p;else{g=A(w);var v=u.h(c,g);LY(new qk(function(e,n,a,u,c,h,d){return function(){return new k(null,8,[qD,d,ip,Uz.g(t),QB,Uz.g(r),fw,h,cB,i,vr,o,Gu,l,Fw,s],null)}}(0,0,0,0,0,u.h(h,Vo.g(v)),g))),e=B(w),d=null,f=0}p=0}}}function jZ(e,t){var i,o=bg(t),l=u.h(o,pG),s=u.h(o,pu),a=u.h(o,xw),c=u.h(o,Gu),h=u.h(o,Fw),d=null==(i=Ae(t))?null:Mt.g(i),f=FQ.j(e,l,CF);o=dh.h(f,new Q(null,3,5,S,[CF,Iz,s],null));var p=new Lg(wj);return n(d)&&yS(tz,"gateway.domains.agm.subscriptions",463,lE,new qk((function(){return new Q(null,7,5,S,["agm","peer",Uz.g(f),"publishes data on stream",s,"with large payload",d],null)})),-2073346152),new Q(null,2,5,S,[e,Oj(Xg.h(zb,Wg((function(n){var i=G(n,0,null);n=G(n,1,null);var o=FQ.h(e,i),s=$s.g(o);return yI(s)?(iZ(n,o,f,!1,a,c,h),Ng.h((function(e){return uY(s,i,e,!1,a,c,h)}),n)):(n=zt.g(s),M(r(p),n)?null:(p.ld(null,re.h(p.Jb(null),n)),new Q(null,1,5,S,[vI(MY(cI(pq.g(e)),l),new k(null,2,[X,zt,zt,n],null),t)],null)))}),D([o]))))],null)}function kZ(e,t){var r=bg(t),i=u.h(r,pG),o=u.h(r,qD),l=u.h(r,xw),s=u.h(r,Gu);r=u.h(r,Fw);var a,c=null==(a=Ae(t))?null:Mt.g(a),h=FQ.j(e,i,CF),d=dh.h(h,new Q(null,4,5,S,[CF,wo,o,ip],null)),f=FQ.h(e,d);if(n(c)){d=dh.h(h,new Q(null,4,5,S,[CF,wo,o,Vo],null));var p=dh.h(h,new Q(null,5,5,S,[CF,ew,i,d,Yo],null));yS(tz,"gateway.domains.agm.subscriptions",512,lE,new qk((function(){return new Q(null,10,5,S,["agm","server",Uz.g(h),"posts data on method/subscription",p,o,"to peer",Uz.g(f),"with large payload",c],null)})),392683709)}var g=$s.g(f);if(n(g)){var w=d=S;IQ(f)?(iZ(new Q(null,1,5,S,[o],null),f,h,!0,l,s,r),i=uY(g,kt.g(f),o,!0,l,s,r)):i=vI(MY(cI(pq.g(e)),i),new k(null,2,[X,zt,zt,zt.g(g)],null),t),e=new Q(null,2,5,d,[e,new Q(null,1,5,w,[i],null)],null)}else e=null;return e}function lZ(e){e=aI(e);var t=gP(Gp.g(e));return n(t)?I.j(e,Xo,t):e}function mZ(e,t,r){return!n(e=Xo.g(e))||hP(e,t,r)}function nZ(e,t,n){var r=FQ.h(e,n),i=new Q(null,3,5,S,[CF,ew,t],null),o=ah.h(wj,Ng.h(A,dh.h(r,i)));return z(o)?oZ(e,t,r,i,o):new Q(null,2,5,S,[QQ(e,n,(function(e){return $H(TH(e,i),CF)})),null],null)}function oZ(e,t,r,i,o){var l=FQ.h(e,t);return o=Nb.j((function(e,t){var r=G(e,0,null);e=G(e,1,null);var o=re.h(i,t);return n(dh.h(r,o))?new Q(null,2,5,S,[TH(r,o),re.h(e,t)],null):new Q(null,2,5,S,[r,e],null)}),new Q(null,2,5,S,[r,wj],null),o),r=G(o,0,null),o=G(o,1,null),e=PQ(e,kt.g(r),$H(r,CF)),yb(z(o))?new Q(null,2,5,S,[e,null],null):(l=G(e=TY(e,r,l,o,oY),0,null),e=G(e,1,null),t=G(r=new Q(null,2,5,S,[l,IQ(r)?rY($s.g(r),kt.g(r),t,Eh(o)):null],null),0,null),r=G(r,1,null),new Q(null,2,5,S,[n(t)?t:l,Qe(r)||Le(r)?Nb.j(Dg(re,F),e,r):null!=r?Dg(re,F)(e,r):e],null))}function pZ(e,t){t=bg(t);var r=u.h(t,pG),i=u.h(t,ew),o=new Q(null,3,5,S,[CF,ew,r],null);t=$H(Nb.j((function(e,t){var r=re.h(o,t);return n(dh.h(e,r))?TH(e,r):jI("agm.errors.unregistration.failure",["Unable to unregister missing method ",p.g(t)].join(""))}),GQ(e,r),i),CF);var l=PQ(e,r,t);return t=ef(Yg.g((function(e){return x.h(r,kt.g(e))})),cf((function(e,t){var l=G(e,0,null);e=G(e,1,null);var s=oZ(l,r,t,o,i);return t=G(s,0,null),s=G(s,1,null),new Q(null,2,5,S,[n(t)?t:l,Qe(s)||Le(s)?Nb.j(Dg(re,F),e,s):null!=s?Dg(re,F)(e,s):e],null)}),bf),new Q(null,2,5,S,[l,F],null),TQ(e,CF,t,!1)),e=G(t,0,null),t=G(t,1,null),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.mthds",120,lE,new qk((function(){return new Q(null,4,5,S,["peer",r,"un-registers methods",i],null)})),212793653),new Q(null,2,5,S,[e,t],null)}function qZ(e,t,n,r){var i=kt.g(t),o=Uz.g(t),l=kt.g(r),s=Uz.g(r),a=dh.h(r,new Q(null,3,5,S,[CF,ew,i],null));return a=ef(Xg.g((function(e){return mZ(e,o,s)})),cf((function(e,t){var n=G(e,0,null);return e=G(e,1,null),new Q(null,2,5,S,[I.j(n,kt.g(t),t),re.h(e,we.h(t,Xo))],null)}),bf),new Q(null,2,5,S,[a,F],null),n),n=G(a,0,null),z(a=G(a,1,null))?new Q(null,2,5,S,[PQ(e,l,eh(r,new Q(null,3,5,S,[CF,ew,i],null),n)),IQ(r)?qY($s.g(r),l,i,a,X.g($s.g(t))):null],null):new Q(null,2,5,S,[e,null],null)}function rZ(e,t){t=bg(t);var r=u.h(t,pG),i=u.h(t,ew),o=Ng.h(lZ,i),l=Nb.j((function(e,t){return eh(e,new Q(null,4,5,S,[CF,ew,r,kt.g(t)],null),t)}),GQ(e,r),o);return t=PQ(e,r,l),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.mthds",200,lE,new qk((function(){return new Q(null,4,5,S,["peer",r,"registers methods",i],null)})),-723085),Nb.j((function(e,t){var r=G(e,0,null);e=G(e,1,null);var i=qZ(r,l,o,t);return t=G(i,0,null),i=G(i,1,null),new Q(null,2,5,S,[n(t)?t:r,Qe(i)||Le(i)?Nb.j(Dg(re,F),e,i):null!=i?Dg(re,F)(e,i):e],null)}),new Q(null,2,5,S,[t,F],null),TQ(e,CF,l,!1))}function sZ(e,t,n){var r=Uz.g(e),i=Uz.g(n);return ef(Xg.g((function(e){return mZ(e,r,i)})),cf((function(t,n){return re.h(t,I.j(we.h(n,Xo),OC,kt.g(e)))}),bf),F,t)}function tZ(e,t,n){var r=bg(t),i=u.h(r,UC),o=u.h(r,pG),l=u.h(r,OC),s=u.h(r,jv),a=u.h(r,Vo),c=u.h(r,kr),h=u.h(r,IC);r=u.h(r,Fp);var d=eh(n,new Q(null,3,5,S,[CF,Lp,s],null),new k(null,3,[bn,o,Vo,a,UC,i],null)),f=!IQ(d);return n=S,i=PQ(e,l,d),f?o=new Q(null,1,5,S,[vI(MY(cI(pq.g(e)),o),new k(null,2,[X,zt,zt,dh.h(d,new Q(null,2,5,S,[$s,zt],null))],null),t)],null):o=new Q(null,1,5,e=S,[o=tI(t=$s.g(d),Ri([kr,jv,X,pz,pG,Fp,wu,IC,Vo],[c,s,iE,o,l,r,"agm",h,a]))],null),new Q(null,2,5,n,[i,o],null)}function uZ(e,t,r,i,o){var l,s=bg(t),a=u.h(s,UC),c=u.h(s,pG),h=u.h(s,OC),d=u.h(s,Vo),f=null==(l=Ae(t))?null:Mt.g(l),p=dh.h(i,new Q(null,4,5,S,[CF,ew,h,d],null));n(f)&&yS(tz,"gateway.domains.agm.calls",62,lE,new qk((function(){return new Q(null,11,5,S,["agm","peer",Uz.g(o),"calls method",Yo.g(p),"on",Uz.g(i),"using request",a,"with large payload",f],null)})),-1194006118),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.calls",67,lE,new qk((function(){return new Q(null,8,5,S,["peer",c,"calls method",d,"on",h,"using request",a],null)})),-1488680685);var g=eh(o,new Q(null,3,5,S,[CF,Ux,a],null),new k(null,3,[Wm,h,Vo,d,jv,r],null));return HY(new qk((function(){return new k(null,5,[UC,a,bn,Uz.g(g),QB,Uz.g(i),fw,p,Jx,IC.g(t)],null)}))),tZ(PQ(e,c,g),I.j(t,jv,r),x.h(c,h)?g:i)}function vZ(e,t,n,r){var i=kt.g(r);r=bg(r=Ik((function(e){return x.h(Wm.g(qc(e)),i)}),dh.h(n,new Q(null,2,5,S,[CF,Ux],null))));var o=u.h(r,!0),l=u.h(r,!1);return z(o)?new Q(null,2,5,S,[QQ(e,kt.g(n),(function(e){return z(l)?eh(e,new Q(null,2,5,S,[CF,Ux],null),ah.h(P,l)):hh(e,CF,we,Ux)})),IQ(n)?bh.h((function(e){return wI.O("agm",t,pc(e),kt.g(n),hI("agm.errors.invocation.failure","Peer has left while waiting for result"))}),o):null],null):new Q(null,2,5,S,[e,null],null)}function wZ(e,t,r,i,o){var l,s=UC.g(r),a=bn.g(r),u=Vo.g(r),c=null==(l=FQ.h(e,a))?null:TH(l,new Q(null,3,5,S,[CF,Ux,s],null));if(n(c)){var h=PQ(e,a,c),d=FQ.h(h,t),f=dh.h(d,new Q(null,4,5,S,[CF,ew,t,u],null)),p=jC.g(o),g=gx.g(o),w=function(){var e=Ae(i);return null==e?null:Mt.g(e)}();return IQ(c)?n(p)?(IY(new qk((function(){return new k(null,6,[UC,UC.g(r),bn,Uz.g(c),QB,Uz.g(d),fw,f,jC,!0,xA,xA.g(p)],null)}))),n(w)&&yS(tz,"gateway.domains.agm.calls",164,lE,new qk((function(){return new Q(null,11,5,S,["agm","method",Yo.g(f),"on server",Uz.g(d),"yield success to",Uz.g(c),"for request",s,"with large payload",w],null)})),971476847),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.calls",170,lE,new qk((function(){return new Q(null,4,5,S,["yield success to",a,"for request",s],null)})),1881811820),new Q(null,2,5,S,[h,new Q(null,1,5,S,[sY($s.g(c),s,a,xA.g(p))],null)],null)):(IY(new qk((function(){return new k(null,6,[UC,UC.g(r),bn,Uz.g(c),QB,Uz.g(d),fw,f,jC,!1,xA,rj(g,new Q(null,2,5,S,[In,pE],null))],null)}))),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.calls",182,lE,new qk((function(){return new Q(null,4,5,S,["yield error to",a,"for request",s],null)})),1458584070),new Q(null,2,5,S,[h,new Q(null,1,5,S,[wI.oa("agm",$s.g(c),s,a,kI(g),Fp.g(g))],null)],null)):new Q(null,2,5,S,[h,new Q(null,1,5,S,[vI(MY(cI(pq.g(h)),t),new k(null,2,[X,zt,zt,dh.h(c,new Q(null,2,5,S,[$s,zt],null))],null),i)],null)],null)}return null}function xZ(e,t,r,i,o){var l=FQ.h(e,r),s=dh.h(l,new Q(null,3,5,S,[CF,Lp,t],null));return n(s)?(e=G(t=new Q(null,2,5,S,[PQ(e,r,TH(l,new Q(null,3,5,S,[CF,Lp,t],null))),F],null),0,null),t=G(t,1,null),r=G(i=wZ(e,r,s,i,o),0,null),i=G(i,1,null),new Q(null,2,5,S,[n(r)?r:e,Qe(i)||Le(i)?Nb.j(Dg(re,F),t,i):null!=i?Dg(re,F)(t,i):t],null)):null}function yZ(e,t,r,i,o,l){return t=new k(null,6,[wu,"global",X,yx,UC,t,pG,r,iv,i,mx,o],null),tI(e,l=n(l)?I.j(t,Vt,l):t)}function zZ(e,t,r){var i=HQ(e,r,CF);return Nb.j((function(e,i){var o=G(e,0,null);G(e,1,null);var l=G(e,0,null);e=G(e,1,null),o=FQ.h(o,r);var s=Uz.g(i),a=kt.g(i),u=wk(D([Ng.g(Hh),dh.h(i,new Q(null,3,5,S,[CF,ew,a],null))])),c=kt.g(o),h=IQ(o),d=IQ(i);return s=h?re.h(F,zI.oa("agm",t,c,a,s,new k(null,1,[gz,d],null))):F,a=d?re.h(s,zI.oa("agm",$s.g(i),a,c,Uz.g(o),new k(null,1,[gz,h],null))):s,i=G(o=qZ(l,i,u,o),0,null),o=G(o,1,null),i=G(o=new Q(null,2,5,S,[i,n(o)?re.h(a,o):a],null),0,null),o=G(o,1,null),new Q(null,2,5,S,[n(i)?i:l,Qe(o)||Le(o)?Nb.j(Dg(re,F),e,o):null!=o?Dg(re,F)(e,o):e],null)}),new Q(null,2,5,S,[e,F],null),TQ(e,CF,i,!1))}function AZ(e,t,n,r,i){return i=gP(i),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.core",87,lE,new qk((function(){return new Q(null,4,5,S,["peer",n,"joins with identity",r],null)})),921486964),zZ(nI(e,n,CF,i),t,n)}function BZ(e,t,r,i){var o=FQ.h(e,r),l=$s.g(o),s=function(){var i,s,a,u,c=new Q(null,2,5,S,[e,null],null),h=(i=G(c,0,null),s=G(c,1,null),a=vZ(i,l,o,t),u=G(a,0,null),a=G(a,1,null),new Q(null,2,5,S,[n(u)?u:i,Qe(a)||Le(a)?Nb.j(Dg(re,F),s,a):null!=a?Dg(re,F)(s,a):s],null)),d=function(){var e=G(h,0,null),r=G(h,1,null),i=TY(e,o,t,null,nY),l=G(i,0,null);return i=G(i,1,null),new Q(null,2,5,S,[n(l)?l:e,Qe(i)||Le(i)?Nb.j(Dg(re,F),r,i):null!=i?Dg(re,F)(r,i):r],null)}(),f=G(d,0,null);d=G(d,1,null);var p=nZ(f,kt.g(t),r),g=G(p,0,null);return p=G(p,1,null),new Q(null,2,5,S,[n(g)?g:f,Qe(p)||Le(p)?Nb.j(Dg(re,F),d,p):null!=p?Dg(re,F)(d,p):d],null)}(),a=G(s,0,null);return s=G(s,1,null),new Q(null,2,5,S,[a,yI(l)?re.h(s,AI.O("agm",l,r,kt.g(t),i)):s],null)}function CZ(e,t,r){var i=kt.g(t),o=ef(Ng.g(kt),cf((function(e,i){var o=G(e,0,null);e=G(e,1,null);var l=BZ(o,t,i,r);return i=G(l,0,null),l=G(l,1,null),new Q(null,2,5,S,[n(i)?i:o,Qe(l)||Le(l)?Nb.j(Dg(re,F),e,l):null!=l?Dg(re,F)(e,l):e],null)}),bf),QY(e,t,r),TQ(e,CF,t,!1));return e=G(o,0,null),o=G(o,1,null),yS(pD,"GATEWAY_ACTION_LOG|agm|gateway.domains.agm.core",164,lE,new qk((function(){return new Q(null,3,5,S,["peer",i,"leaves agm domain"],null)})),684820040),new Q(null,2,5,S,[oI(e,i,CF),o],null)}function DZ(e,t){return yS(it,"gateway.domains.agm.core",199,lE,new qk((function(){return new Q(null,1,5,S,["removing source from agm domain"],null)})),-1494874071),t=tg(MQ(e,t,CF)),e=ef(Ng.g(kt),cf((function(e,t){return oI(e,t,CF)}),bf),e,t),e=Nb.j((function(e,t){var r=G(e,0,null);e=G(e,1,null);var i=CZ(r,t,nY);return t=G(i,0,null),i=G(i,1,null),new Q(null,2,5,S,[n(t)?t:r,Qe(i)||Le(i)?Nb.j(Dg(re,F),e,i):null!=i?Dg(re,F)(e,i):e],null)}),new Q(null,2,5,S,[e,null],null),t),yS(it,"gateway.domains.agm.core",210,lE,new qk((function(){return new Q(null,1,5,S,["removed source from agm domain"],null)})),-190443969),e}function EZ(e,t,n){n=bg(n);var r=u.h(n,pG);n=u.h(n,UC);var i=HQ(e,r,CF);return i=Eh($g(Ng.h((function(t){t=bg(t);var n=u.h(t,kt),i=FQ.h(e,r);return sZ(t,n=ei(dh.h(t,new Q(null,3,5,S,[CF,ew,n],null))),i)}),Xg.h(IQ,TQ(e,CF,i,!1))))),new Q(null,2,5,S,[e,new Q(null,1,5,S,[tI(t,new k(null,4,[ew,i,UC,n,X,ew,pG,r],null))],null)],null)}$Y=new Yk(Bd.h("gateway.domains.agm.subscriptions","drop-interest-rq"),X,l3,h3,i3,j3,k3),$Y.C(null,Cx,(function(){return gr})),$Y.C(null,Bu,(function(){return xC})),Z(eG,N(Gx,hy,X),RP(hy,new Cd((function(){return $Y}),hy,Ri([Rs,Yo,CD,so,rs,cw,MG,oo,KC,wD],[Oq,iA,"gateway/domains/agm/subscriptions.cljc",27,1,296,296,Id,null,n($Y)?$Y.md:null])))),Z(yt,N(xy,qx),aQ(qx,qx,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,qx),Jz,function(e){return Fe(e)}],null),null)),Z(br,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[yt],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[yt],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[yt],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,ew)}],null),function(e){return J(e)&&M(e,ew)},F,new Q(null,1,5,S,[yt],null),null,new Q(null,1,5,S,[ew],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ew))],null),null]))],null),null)),Z(Ys,N(xy,Or),aQ(Or,Or,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,Or),Jz,function(e){return Fe(e)}],null),null)),Z(cE,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[Ys],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[Ys],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[Ys],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,ew)}],null),function(e){return J(e)&&M(e,ew)},F,new Q(null,1,5,S,[Ys],null),null,new Q(null,1,5,S,[ew],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ew))],null),null]))],null),null)),Z(LD,SC,Ab),Z(En,SC,Ab),Z(AG,Mw,Pe),Z(vB,N(eD,T,new Q(null,1,5,S,[AG],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[AG],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,gz)}],null),function(e){return J(e)&&M(e,gz)},F,new Q(null,1,5,S,[AG],null),null,new Q(null,1,5,S,[gz],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,gz))],null),null]))),uQ.C(null,nG,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[ar,sw,vB],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[ar,sw,vB],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,Fr)},function(e){return M(e,Uz)},function(e){return M(e,rb)}],null),function(e){return J(e)&&M(e,Fr)&&M(e,Uz)&&M(e,rb)},F,new Q(null,3,5,S,[ar,sw,vB],null),null,new Q(null,3,5,S,[Fr,Uz,rb],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fr)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Uz)),N(V,new Q(null,1,5,S,[W],null),N(U,W,rb))],null),null]))],null),null)})),Z(nF,jB,jB),uQ.C(null,$w,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[nF,LD,En],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[nF,LD,En],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,rw)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,rw)&&M(e,pE)&&M(e,In)},F,new Q(null,3,5,S,[nF,LD,En],null),null,new Q(null,3,5,S,[rw,pE,In],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,rw)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))],null),null)})),uQ.C(null,kG,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,1,5,S,[Ys],null),dD,new Q(null,2,5,S,[LD,En],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[Ys],null),new Q(null,2,5,S,[LD,En],null),null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,ew)}],null),function(e){return J(e)&&M(e,ew)},new Q(null,2,5,S,[pE,In],null),new Q(null,1,5,S,[Ys],null),null,new Q(null,1,5,S,[ew],null),new Q(null,2,5,S,[LD,En],null),new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ew))],null),null]))],null),null)})),Z(DF,new uj(null,new k(null,4,[jD,"null",qy,"null",zt,"null",gz,"null"],null),null),new uj(null,new k(null,4,[jD,null,qy,null,zt,null,gz,null],null),null)),uQ.C(null,ou,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[$l,DF,Vq],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[$l,DF,Vq],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,OC)},function(e){return M(e,fn)},function(e){return M(e,ew)}],null),function(e){return J(e)&&M(e,OC)&&M(e,fn)&&M(e,ew)},F,new Q(null,3,5,S,[$l,DF,Vq],null),null,new Q(null,3,5,S,[OC,fn,ew],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,OC)),N(V,new Q(null,1,5,S,[W],null),N(U,W,fn)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ew))],null),null]))],null),null)})),uQ.C(null,uw,(function(){return ZP(new Q(null,2,5,S,[Ko,lz],null),new Q(null,2,5,S,[Ko,lz],null),null)})),uQ.C(null,yo,(function(){return ZP(new Q(null,2,5,S,[Ko,Gr],null),new Q(null,2,5,S,[Ko,Gr],null),null)})),uQ.C(null,Sl,(function(){return ZP(new Q(null,2,5,S,[KG,yG],null),new Q(null,2,5,S,[KG,yG],null),null)})),uQ.C(null,to,(function(){return ZP(new Q(null,2,5,S,[KG,st],null),new Q(null,2,5,S,[KG,st],null),null)})),uQ.C(null,Zo,(function(){return ZP(new Q(null,2,5,S,[Ql,N(eD,T,new Q(null,1,5,S,[zG],null))],null),new Q(null,2,5,S,[Ql,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[zG],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,qD)}],null),function(e){return J(e)&&M(e,qD)},F,new Q(null,1,5,S,[zG],null),null,new Q(null,1,5,S,[qD],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD))],null),null]))],null),null)})),uQ.C(null,Bu,(function(){return ZP(new Q(null,2,5,S,[KG,xC],null),new Q(null,2,5,S,[KG,xC],null),null)})),uQ.C(null,dw,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[zG,LD,En],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[zG,LD,En],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,qD)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,qD)&&M(e,pE)&&M(e,In)},F,new Q(null,3,5,S,[zG,LD,En],null),null,new Q(null,3,5,S,[qD,pE,In],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))],null),null)})),uQ.C(null,Bv,(function(){return ZP(new Q(null,2,5,S,[KG,br],null),new Q(null,2,5,S,[KG,br],null),null)})),uQ.C(null,Pn,(function(){return ZP(new Q(null,2,5,S,[KG,cE],null),new Q(null,2,5,S,[KG,cE],null),null)})),uQ.C(null,Mn,(function(){return ZP(new Q(null,2,5,S,[KG,AF],null),new Q(null,2,5,S,[KG,AF],null),null)})),uQ.C(null,wm,(function(){return ZP(new Q(null,2,5,S,[KG,Pt],null),new Q(null,2,5,S,[KG,Pt],null),null)})),Z(Dm,Mw,Pe),uQ.C(null,gy,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,5,5,S,[zG,Dm,vD,Qz,Iv],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,5,5,S,[zG,Dm,vD,Qz,Iv],null),null,null,new Q(null,6,5,S,[function(e){return J(e)},function(e){return M(e,qD)},function(e){return M(e,cB)},function(e){return M(e,xw)},function(e){return M(e,Gu)},function(e){return M(e,Fw)}],null),function(e){return J(e)&&M(e,qD)&&M(e,cB)&&M(e,xw)&&M(e,Gu)&&M(e,Fw)},F,new Q(null,5,5,S,[zG,Dm,vD,Qz,Iv],null),null,new Q(null,5,5,S,[qD,cB,xw,Gu,Fw],null),F,new Q(null,6,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qD)),N(V,new Q(null,1,5,S,[W],null),N(U,W,cB)),N(V,new Q(null,1,5,S,[W],null),N(U,W,xw)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Gu)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fw))],null),null]))],null),null)})),uQ.C(null,yp,(function(){return ZP(new Q(null,2,5,S,[KG,tC],null),new Q(null,2,5,S,[KG,tC],null),null)})),uQ.C(null,iE,(function(){return ZP(new Q(null,2,5,S,[KG,PD],null),new Q(null,2,5,S,[KG,PD],null),null)})),uQ.C(null,wA,(function(){return ZP(new Q(null,2,5,S,[KG,$A],null),new Q(null,2,5,S,[KG,$A],null),null)})),uQ.C(null,xA,(function(){return ZP(new Q(null,2,5,S,[Ql,N(eD,T,new Q(null,1,5,S,[BF],null))],null),new Q(null,2,5,S,[Ql,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[BF],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,xA)}],null),function(e){return J(e)&&M(e,xA)},F,new Q(null,1,5,S,[BF],null),null,new Q(null,1,5,S,[xA],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,xA))],null),null]))],null),null)})),Z(pC,SC,Ab),Z(Cq,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[sw],null),dD,new Q(null,1,5,S,[pC],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[sw],null),dD,new Q(null,1,5,S,[pC],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[sw],null),new Q(null,1,5,S,[pC],null),null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Uz)}],null),function(e){return J(e)&&M(e,Uz)},new Q(null,1,5,S,[Gp],null),new Q(null,1,5,S,[sw],null),null,new Q(null,1,5,S,[Uz],null),new Q(null,1,5,S,[pC],null),new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Uz))],null),null]))],null),null));var FZ=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.domains.agm.core","handle-request"),(function(e,t,n){return X.g(n)}),i,e,t,n,r)}();function GZ(e,t){var r=bg(t),i=u.h(r,$s);r=u.h(r,Ro);try{return FZ.j(e,i,r)}catch(l){var o=l;return n(el(o))||yS(Cx,"gateway.domains.agm.core",321,lE,new qk((function(){return new Q(null,3,5,S,[o,"Error handling request",t],null)})),-85748133),yI(i)?new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("agm",i,UC.g(r),pG.g(r),iI(o,"agm.errors.failure"))],null)],null):null}}function HZ(){}FZ.C(null,OG,(function(e,t,r){if(yI(t)){var i=bg(r),o=u.h(i,UC),l=u.h(i,pG),s=u.h(i,Uz);if(i=u.h(i,Gp),n(pI(e,l,CF)))e=new Q(null,2,5,S,[e,new Q(null,1,5,S,[xI.F("agm",t,o,l)],null)],null);else{s=G(i=AZ(e,t,l,s,i),0,null),i=G(i,1,null);var a=FQ.h(s,l),c=S,h=re.l;t=xI.F("agm",t,o,l),e=MY(cI(pq.g(e)),l),r=I.j(r,X,qt),r=n(Vt.g(a))?I.j(r,Vt,Vt.g(a)):r,e=new Q(null,2,5,c,[s,h.call(re,i,t,D([uI(e,r)]))],null)}}else s=bg(r),r=u.h(s,pG),l=u.h(s,Uz),s=u.h(s,Gp),e=n(pI(e,r,CF))?null:AZ(e,t,r,l,s);return e})),FZ.C(null,mv,(function(e,t,r){if(yI(t)){var i=bg(r),o=u.h(i,UC),l=CZ(e,GQ(e,i=u.h(i,pG)),kI(r)),s=G(l,0,null);l=G(l,1,null),e=new Q(null,2,5,S,[s,re.l(l,xI.F("agm",t,o,i),D([uI(MY(cI(pq.g(e)),i),I.j(r,X,Pz))]))],null)}else t=bg(r),t=u.h(t,pG),e=n(t=FQ.h(e,t))?CZ(e,t,kI(r)):null;return e})),FZ.C(null,Bv,(function(e,t,n){if(yI(t)){var r=bg(n),i=u.h(r,UC),o=u.h(r,pG);r=u.h(r,ew);var l=rZ(e,n);e=G(l,0,null),l=G(l,1,null),t=new Q(null,2,5,S,[e,re.l(l,qY(t,o,o,r,gz),D([xI.F("agm",t,i,o),uI(MY(cI(pq.g(e)),o),n)]))],null)}else t=rZ(e,n);return t})),FZ.C(null,Pn,(function(e,t,n){if(yI(t)){var r=bg(n),i=u.h(r,UC),o=u.h(r,pG);r=u.h(r,ew);var l=pZ(e,n),s=G(l,0,null);l=G(l,1,null),e=new Q(null,2,5,S,[s,re.l(l,rY(t,o,o,r),D([xI.F("agm",t,i,o),uI(MY(cI(pq.g(e)),o),n)]))],null)}else e=pZ(e,n);return e})),FZ.C(null,yp,(function(e,t,n){if(yI(t)){t=bg(n),u.h(t,UC);var r=u.h(t,pG);t=HQ(e,t=u.h(t,OC),CF),r=HQ(e,r,CF);var i=dI(pq.g(e)),o=G(i,0,null);i=G(i,1,null),wY(r,t,n),e=uZ(I.j(e,pq,o),n,i,t,r)}else o=bg(n),u.h(o,UC),t=u.h(o,pG),r=u.h(o,OC),o=u.h(o,jv),e=IQ(r=FQ.j(e,r,CF))?uZ(e,n,o,r,HQ(e,t,CF)):null;return e})),FZ.C(null,wA,(function(e,t,n){yI(t);var r=bg(n);return t=u.h(r,jv),HQ(e,r=u.h(r,pG),CF),xZ(e,t,r,n,new k(null,1,[jC,n],null))})),FZ.C(null,Sl,(function(e,t,r){if(yI(t)){var i=dI(pq.g(e));t=G(i,0,null),i=G(i,1,null),e=VY(I.j(e,pq,t),r,i)}else i=bg(r),t=u.h(i,qD),i=u.h(i,OC),e=n(FQ.h(e,i))?VY(e,r,t):null;return e})),FZ.C(null,fB,(function(e,t,n){if(yI(t)){var r=bg(n),i=u.h(r,UC),o=u.h(r,pG);e=G(n=hZ(e,n,o,r=u.h(r,qD),i),0,null),n=G(n,1,null),e=new Q(null,2,5,S,[e,re.h(n,xI.F("agm",t,i,o))],null)}else o=bg(n),t=u.h(o,UC),e=hZ(e,n,i=u.h(o,pG),o=u.h(o,qD),t);return e})),FZ.C(null,Bu,(function(e,t,n){return fZ(e,t,n,!1)})),FZ.C(null,to,(function(e,t,n){return yI(t)?(t=bg(n),u.h(t,qD),e=YY(e,t=HQ(e,t=u.h(t,pG),CF),n)):e=ZY(e,n),e})),FZ.C(null,wm,(function(e,t,n){return jZ(e,n)})),FZ.C(null,Mn,(function(e,t,n){return kZ(e,n)})),FZ.C(null,Cx,(function(e,t,r){var i=bg(r),o=u.h(i,UC);return GQ(e,i=u.h(i,pG)),n(o=xZ(e,o,i,r,new k(null,1,[gx,r],null)))?o:fZ(e,t,r,!0)})),FZ.C(null,zB,(function(e,t){return DZ(e,t)})),FZ.C(null,Mx,(function(e,t,n){return EZ(e,t,n)})),FZ.C(null,Zk,(function(e,t,n){return yS(Cx,"gateway.domains.agm.core",304,lE,new qk((function(){return new Q(null,2,5,S,["Unhandled message",n],null)})),-345016818),new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("agm",t,UC.h(n,-1),pG.g(n),lI("agm.errors.unhandled_message",["Unhandled message ",p.g(n)].join("")))],null)],null)})),HZ.prototype.Yc=function(){return new k(null,3,[GC,"agm",pr,"",bD,1],null)},HZ.prototype.Zc=function(e,t){return t},HZ.prototype.Wc=function(e,t){return t},HZ.prototype.Xc=function(e,t,n){return GZ(t,n)};var IZ=hI("activity.peer-removed","Peer has been removed"),JZ=hI("activity.destroyed","Activity destroyed");function KZ(e,t,n){return new k(null,6,[wu,"activity",X,jq,pG,e,FA,t,pE,GC.g(n),In,Ar.g(n)],null)}function LZ(e,t){return new k(null,4,[wu,"activity",X,Up,pG,e,hp,t],null)}function MZ(e,t,n,r){return tI(e,new k(null,5,[wu,"activity",X,sn,UC,t,pG,n,Ov,r],null))}var NZ=function e(t){return ah.h(P,Ng.h((function(t){var n=G(t,0,null);return t=G(t,1,null),new Q(null,2,5,S,[n,gh(gh(t,Fp,Fw),nC,e)],null)}),t))};function OZ(e,t){return e=FQ.h(e,t),new k(null,3,[pG,t,Yo,Xm.g(e),X,pA.g(e)],null)}function PZ(e,t,r,i){var o=nC.g(r),l=Xm.g(t),s=pA.g(t);return e=Ri([wp,bp,X,pG,Mz,wv,wu,Rt,Ov,Ru],[bh.h(Ag(OZ,e),rn.g(r)),bp.g(r),ts,kt.g(t),X.g(r),i,"activity",Ty.g(r),kt.g(r),OZ(e,Ru.g(r))]),l=n(l)?I.j(e,Xm,l):e,s=n(s)?I.j(l,pA,s):l,n(o)?I.j(s,nC,NZ(o)):s}var QZ=function e(t){switch(arguments.length){case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};QZ.F=function(e,t,n,r){return tI(t,QZ.j(e,n,r))},QZ.j=function(e,t,r){var i=nC.g(r);return e=Ri([wp,bp,X,pG,Mz,wu,Rt,Ov,Ru],[bh.h(Ag(OZ,e),mR(wp.g(r),rn.g(r))),bp.g(r),$u,t,X.g(r),"activity",Ty.g(r),kt.g(r),OZ(e,Ru.g(r))]),n(i)?I.j(e,nC,NZ(i)):e},QZ.I=4;var RZ=Ag(xI,"activity"),SZ=Ag(wI,"activity");function TZ(e,t,n){return Nb.j((function(e,t){return t=new Q(null,2,5,S,[hx,t],null),eh(e,t,re.h(dh.j(e,t,F),n))}),e,t)}function UZ(e,t,r){return n((i=z(t))?r:i)?Nb.j((function(e,t){t=new Q(null,2,5,S,[hx,t],null);var n=YH(r,dh.j(e,t,null));return z(n)?eh(e,t,n):TH(e,t)}),e,t):e;var i}function VZ(e,t){return n(t)?dh.h(e,new Q(null,2,5,S,[Lo,t],null)):null}function WZ(e,t,r){return n(t)?eh(e,new Q(null,2,5,S,[Lo,t],null),r):e}function XZ(e,t){return dh.h(e,new Q(null,2,5,S,[Dz,t],null))}function YZ(e,t,n){return Nb.j((function(e,n){return eh(e,new Q(null,3,5,S,[Dz,t,Yo.g(n)],null),n)}),e,n)}function ZZ(e,t,n){return Nb.j((function(e,n){return TH(e,new Q(null,3,5,S,[Dz,t,n],null))}),e,n)}function $Z(e,t){return mR(dh.h(e,new Q(null,2,5,S,[zu,t],null)),dh.h(e,new Q(null,2,5,S,[zu,Fm],null)))}function a_(e,t,n){return fh.F(e,new Q(null,2,5,S,[zu,n],null),Dg(re,wj),t)}function b_(e,t,n){return fh.F(e,new Q(null,2,5,S,[zu,n],null),De,t)}function c_(e,t){return n(t)?n(e=VZ(e,t))?e:jI("activity.errors.invalid_activity",["Unable to find activity with id ",p.g(t)].join("")):null}function d_(e,t){return eh(e,new Q(null,2,5,S,[YC,kt.g(t)],null),t)}function e_(e,t){return n(t)?dh.h(e,new Q(null,2,5,S,[YC,t],null)):null}function f_(e,t,r){return n(n(t)?r:t)?M(u.h(t,QD),r)?e:eh(e,new Q(null,2,5,S,[YC,kt.g(t)],null),hh(t,QD,Dg(re,wj),r)):e}function g_(e,t,n){var r=hh(t,QD,De,n);return n=x.h(n,Ru.g(r))?we.h(r,Ru):r,new Q(null,2,5,S,[eh(e,new Q(null,2,5,S,[YC,kt.g(t)],null),n),n],null)}var h_=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.domains.global.state","apply-command"),(function(e,t){return A(t)}),i,e,t,n,r)}();function i_(e,t,n){var r=Ik(pA,n);return TZ(PQ(e,kt.g(t),fh.j(t,new Q(null,2,5,S,[zr,hx],null),Dg((function(e){return af((function(e,t,n){return I.j(e,t,A(n))}),e,r)}),P))),di(r),kt.g(t))}function j_(e,t,n){return bh.h((function(e){var r=$s.g(e);e=kt.g(e);var i=kt.g(t);return tI(r,new k(null,5,[wu,"activity",X,rq,pG,e,bC,i,hx,n],null))}),TQ(e,zr,t,!1))}function k_(e,t,r,i){var o=kt.g(t);return ch(zb,Ng.h((function(e){if(n(n(i)?i:cg.h(o,kt.g(e)))){var t=$s.g(e);e=kt.g(e);var l=Eh(r);t=tI(t,new k(null,5,[wu,"activity",X,uo,pG,e,bC,o,gp,l],null))}else t=null;return t}),TQ(e,zr,t,!1)))}h_.C(null,Ws,(function(e,t){return G(t,0,null),z(t=G(t,1,null))?Yf(we,e,t):e})),h_.C(null,Cw,(function(e,t){return G(t,0,null),null!=(t=G(t,1,null))?af(I,e,t):e})),h_.C(null,HB,(function(e,t){return G(t,0,null),null!=(t=G(t,1,null))?af((function(e,t,n){return gh(e,t,(function(e){return Le(n)||Qe(n)||Le(e)||Qe(e)?n:He(n)&&He(e)?pj.l(D([e,n])):n}))}),e,t):e})),h_.C(null,AD,(function(e,t){return G(t,0,null),n(t=G(t,1,null))?t:e})),h_.C(null,Zk,(function(e,t){var n=G(t,0,null),r=G(t,1,null);return yS(tz,"gateway.domains.global.state",101,lE,new qk((function(){return new Q(null,4,5,S,["ignoring unknown context delta command",n,"with payload",r],null)})),1214764613),e}));var l_=function e(t){switch(arguments.length){case 2:return e.h(arguments[0],arguments[1]);case 3:return e.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function m_(e,t){t=pA.g(t),n(dh.h(e,new Q(null,3,5,S,[zr,hx,t],null)))&&jI("activity.errors.factory_already_registered",["Factory for type ",p.g(t)," is already registered by this peer"].join(""))}function n_(e,t){return ZH((function(e){return x.h(kt.g(e),t)}),ei(e))}function o_(e,t){var r=dh.h(e,new Q(null,2,5,S,[zr,hx],null));return t=Nb.j((function(e,t){var i=G(e,0,null);return e=G(e,1,null),n(t=n_(r,t))?new Q(null,2,5,S,[TH(i,new Q(null,3,5,S,[zr,hx,pA.g(t)],null)),re.h(e,t)],null):new Q(null,2,5,S,[i,e],null)}),new Q(null,2,5,S,[e,wj],null),t),e=G(t,0,null),t=G(t,1,null),new Q(null,2,5,S,[$H(e,zr),t],null)}function p_(e,t,r,i,o,l,s,a){return l=n(l)?I.j(P,cz,new k(null,4,[kt,kt.g(l),X,X.g(l),Rt,kt.g(s),sB,Fw.g(s)],null)):P,a=n(a)?I.j(l,Xm,a):l,l=$s.g(e),e=kt.g(e),s=kt.g(t),t=pj.l(D([DB.g(t),r])),tI(l,pj.l(D([new k(null,7,[wu,"activity",X,xF,UC,o,pG,e,sr,s,PG,i,DB,t],null),a])))}function q_(e,t,r){var i=FQ.h(e,pG.g(r));return n(i)?new Q(null,2,5,S,[e,new Q(null,1,5,S,[SZ($s.g(i),UC.g(r),kt.g(i),t)],null)],null):new Q(null,2,5,S,[e,null],null)}function r_(e,t,r){return e=FQ.h(e,n(t)?t:A(dh.h(e,new Q(null,2,5,S,[hx,r],null)))),n(t=dh.h(e,new Q(null,3,5,S,[zr,hx,r],null)))?new Q(null,2,5,S,[e,t],null):jI("activity.errors.missing_factory",["Unable to find factory owner for type ",p.g(r)].join(""))}function s_(e,t,r,i,o,l,s){var a=r_(e,null,X.g(r)),u=G(a,0,null);a=G(a,1,null);var c=GQ(e,t),h=dI(pq.g(e));return t=G(h,0,null),h=G(h,1,null),l=new k(null,4,[X,cz,kt,h,pA,X.g(r),cz,new k(null,2,[kt,kt.g(i),Xz,l],null)],null),r=n(Yo.g(r))?I.j(l,Xm,Yo.g(r)):l,l=xU(e,l=Uz.g(c),r),e=qI(I.j(e,pq,t),h,r),new k(null,3,[su,e,Pv,new Q(null,1,5,S,[p_(u,a,s,l,h,i,o,null)],null),Mm,h],null)}function t_(e){return ei(dh.h(e,new Q(null,1,5,S,[YC],null)))}function u_(e,t,r){var i=function(){var e=null==r?null:Uz.g(r);return null==e?null:xr.g(e)}(),o=function(){var e=null==r?null:Vt.g(r);return null==e?null:cp.g(e)}();e=ei(YC.g(e));var l=Nb.j((function(e,n){if(e=x.h(t,Yo.g(n))){var r=(e=x).h,o=null==n?null:Uz.g(n);o=null==o?null:xr.g(o),e=r.call(e,i,o)}return e?Td(n):null}),null,e);return n(l)?l:Nb.j((function(e,r){return n((i=x.h(t,Yo.g(r)))?n(o)?o:null==(i=null==r?null:Vt.g(r))?null:cp.g(i):i)?Td(r):null;var i}),null,e)}function v_(e,t){if(n(e=dh.h(e,new Q(null,2,5,S,[YC,t],null))))return e;throw cl(["Unable to find context with id ",p.g(t)].join(""),P)}function w_(e,t,r){return n(n(t)?r:t)?M(u.h(t,QD),r)?e:eh(e,new Q(null,2,5,S,[YC,kt.g(t)],null),hh(t,QD,Dg(re,wj),r)):e}l_.h=function(e,t){return ch(zb,Ng.h(Bg(l_,e,t),Xg.h(Bg(RQ,zr,t),Ng.h(Ag(FQ,e),yj($g(ei(u.h(e,hx))))))))},l_.j=function(e,t,r){var i=ei(dh.h(r,new Q(null,2,5,S,[zr,hx],null)));return n(i)?(e=$s.g(t),t=kt.g(t),r=kt.g(r),i=Eh(i),e=tI(e,new k(null,5,[wu,"activity",X,rq,pG,t,bC,r,hx,i],null))):e=null,e},l_.I=3;var x_=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.common.context.state","apply-delta-cmd"),(function(e,t){return A(t)}),i,e,t,n,r)}();x_.C(null,Ws,(function(e,t){return G(t,0,null),z(t=G(t,1,null))?Yf(we,e,t):e})),x_.C(null,Cw,(function(e,t){return G(t,0,null),null!=(t=G(t,1,null))?af(I,e,t):e})),x_.C(null,HB,(function(e,t){return G(t,0,null),null!=(t=G(t,1,null))?af((function(e,t,n){return gh(e,t,(function(e){return Le(n)&&Le(e)?n:He(n)&&He(e)?pj.l(D([e,n])):n}))}),e,t):e})),x_.C(null,AD,(function(e,t){return G(t,0,null),n(t=G(t,1,null))?t:e}));var y_=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.common.context.state","apply-command"),(function(e,t){return Bf.g(X.g(t))}),i,e,t,n,r)}(),z_=function e(t,n,r){var i=z(n);n=A(i);var o=B(i);if(null==n)t=r;else if(o){i=I.j;var l=u.h(t,n);l=null!=l&&J(l)?l:P,r=e.j?e.j(l,o,r):e.call(null,l,o,r),t=i.call(I,t,n,r)}else t=I.j(t,n,r);return t};function A_(e,t,r,i){var o=kt.g(t),l=new Q(null,3,5,S,[YC,o,Fw],null),s=Nb,a=s.j;return t=Fw.g(t),eh(eh(e,l,a.call(s,x_,n(t)?t:P,r)),new Q(null,3,5,S,[YC,o,bD],null),i)}function B_(e,t,r,i,o,l,s){var a=new k(null,2,[OB,0,uA,(new Date).getTime()],null),u=Uz.g(e),c=Vt.g(e);return e=Ri([sD,Uz,Zv,Yo,PA,kt,JF,QD,bD,Fw],[l,u,kt.g(e),t,o,s,i,wj,a,r]),n(c)?I.j(e,Vt,c):e}function C_(e,t,n,r,i,o,l){this.id=e,this.type=t,this.Yb=n,this.dc=r,this.D=i,this.m=o,this.G=l,this.B=2230716170,this.M=139264}function D_(e,t,n){var r=eI(pq.g(e)),i=G(r,0,null);n=B_(n,r=G(r,1,null),Vs.g(t),cz,PA.g(t),sD.g(t),r);var o=Zu.h(i,1),l=["a-",p.g(jw.g(i)),"-",p.g(o)].join("");i=G(o=new Q(null,2,5,S,[I.j(i,Zu,o+1),l],null),0,null),o=G(o,1,null),l=I.j;var s=Mz.g(t),a=pG.g(t);return t=l.call(I,new C_(o,s,r,a,null,null,null),Pw,t),new Q(null,3,5,S,[I.j(e,pq,i),t,n],null)}function E_(e,t,n){return ah.j(F,zg.h(Xg.g((function(e){return x.h(t,dh.h(e,new Q(null,2,5,S,[Uz,xr],null)))})),Ng.g((function(e){return tI($s.g(e),LZ(e=kt.g(e),n))}))),JQ(e,zr))}function F_(e,t,n){return ah.j(F,zg.h(Xg.g((function(e){return x.h(t,dh.h(e,new Q(null,2,5,S,[Uz,xr],null)))})),Ng.g((function(e){var t=$s.g(e);return e=kt.g(e),tI(t,new k(null,4,[wu,"activity",X,Sr,pG,e,hp,n],null))}))),JQ(e,zr))}function G_(e,t,r){return n(e=u.h(XZ(e,dh.h(t,new Q(null,2,5,S,[Uz,xr],null))),r))?e:jI("activity.errors.missing_type",["Unable to find activity type ",p.g(r)].join(""))}function H_(e,t){var n=DB.g(e);return pj.l(D([n,u.h(t,new k(null,1,[X,X.g(e)],null)),u.h(t,new k(null,2,[X,X.g(e),Yo,Yo.g(e)],null))]))}function I_(e,t,n,r,i){return e=bg(e),t=s_(u.h(e,su),n,t,u.h(e,cz),r,!0,H_(t,i)),UH(VH(I.j(e,su,su.g(t)),new Q(null,1,5,S,[Pv],null),Pv.g(t)),new Q(null,2,5,S,[cz,nn],null),D([Mm.g(t)]))}function J_(e,t,n,r,i){e=bg(e),u.h(e,su);var o=u.h(e,cz);return Nb.j((function(e,t){try{var l=bg(s_(su.g(e),n,t,cz.g(e),r,!1,H_(t,i))),s=u.h(l,su),a=u.h(l,Pv),c=u.h(l,Mm);return UH(VH(I.j(e,su,s),new Q(null,1,5,S,[Pv],null),a),new Q(null,2,5,S,[cz,nn],null),D([c]))}catch(n){var h=n;return yS(tz,"gateway.domains.activity.activities",157,lE,new qk((function(){return new Q(null,5,5,S,[h,"Unable to create helper type",t,"for activity",kt.g(o)],null)})),-414554048),e}}),e,t)}function K_(e,t,r,i){var o=bg(r),l=u.h(o,UC),s=HQ(e,o=u.h(o,pG),zr),a=G_(e,s,Mz.g(r));i=ah.h(P,Ng.h((function(e){return new Q(null,2,5,S,[rj(e,new Q(null,2,5,S,[X,Yo],null)),DB.g(e)],null)}),i));var c=Kr.g(r);return n(n(c)?!Ee(i):c)&&jI("activity.errors.activity_is_child","Cannot specify types override and custom configuration at the same time"),r=G(e=D_(e,r,s),0,null),s=G(e,1,null),e=G(e,2,null),t=J_(I_(new k(null,3,[su,r,Pv,new Q(null,1,5,S,[MZ(t,l,o,kt.g(s))],null),cz,s],null),function(){var e=ey.g(c);return n(e)?e:ey.g(a)}(),o,e,i),function(){var e=mE.g(c);return n(e)?e:mE.g(a)}(),o,e,i),o=bg(t),l=u.h(o,su),t=u.h(o,Pv),o=u.h(o,cz),l=WZ(d_(l,e),kt.g(o),o),new Q(null,2,5,S,[l,t],null)}function L_(e,t,n){var r=kt.g(n);return!!(M(rn.g(e),r)||M(wp.g(e),r)||x.h(Ru.g(e),r))||RQ.oa(Uz.g(t),PA.g(e),dh.h(t,new Q(null,2,5,S,[Vt,cp],null)),Uz.g(n),null,dh.h(n,new Q(null,2,5,S,[Vt,cp],null)))}function M_(e,t,n){var r=Ru.g(t),i=rn.g(t);return bh.h((function(r){return tI($s.g(r),PZ(e,r,t,n))}),Xg.h(zb,Ng.h((function(t){return FQ.h(e,t)}),re.h(i,r))))}function N_(e,t,r,i){var o=Xg.h,l=Bg(L_,r,i),s=Ng.h,a=Ag(FQ,e),c=Yg.h;return t=Ag(x,t),e=$Z(e,X.g(r)),n(!0)?r=nR(xj([i=kt.g(i)]),u.j(r,wp,wj),D([u.h(r,rn)])):r=null,o.call(Xg,l,s.call(Ng,a,c.call(Yg,t,mR(e,r))))}function O_(e,t){var n=X.g(t),r=FQ.h(e,Ru.g(t));return bh.h((function(n){return QZ.F(e,$s.g(n),kt.g(n),t)}),Xg.h((function(e){return L_(t,r,e)}),Ng.h(Ag(FQ,e),$Z(e,n))))}function P_(e,t,r,i){return n(zy.g(t))?(r=FQ.h(e,r),bh.h((function(e){var n=$s.g(e);e=kt.g(e);var r=kt.g(t);return tI(n,e=new k(null,6,[wu,"activity",X,dq,pG,e,Ov,r,pE,GC.g(i),In,Ar.g(i)],null))}),N_(e,null,t,r))):null}function Q_(e,t,r){if(n(zy.g(t))){var i=kt.g(r);return bh.h((function(e){var i=$s.g(e),o=kt.g(e),l=kt.g(t),s=Xm.g(r);return e=pA.g(r),o=new k(null,5,[wu,"activity",X,Uu,pG,o,Ov,l,bC,kt.g(r)],null),s=n(s)?I.j(o,Xm,s):o,tI(i,e=n(e)?I.j(s,pA,e):s)}),N_(e,i,t,r))}return null}function R_(e,t,r,i){var o=kt.g(t);return bh.h((function(e){var i=$s.g(e),o=kt.g(e),l=kt.g(r);return e=Xm.g(t),o=new k(null,6,[wu,"activity",X,JC,pG,o,Ov,l,OA,kt.g(t),Ur,pA.g(t)],null),tI(i,e=n(e)?I.j(o,mq,e):o)}),N_(e,o,r,i))}function S_(e,t,n,r){var i=FQ.h(e,Ru.g(n));return bh.h((function(e){var i=$s.g(e);e=kt.g(e);var o=kt.g(n);return tI(i,e=new k(null,7,[wu,"activity",X,$v,pG,e,Ov,o,JG,t,pE,GC.g(r),In,Ar.g(r)],null))}),N_(e,t,n,i))}function T_(e,t,r){var i=kt.g(r),o=Ty.g(t);if(o=e_(e,o),t=hh(t,rn,Dg(re,wj),i),n(zy.g(t))){var l=Ru.g(t),s=FQ.h(e,l);l=re.h,s=R_(e,r,t,s),r=tI($s.g(r),PZ(e,r,t,Fw.g(o))),r=l.call(re,s,r)}else r=null;return new k(null,3,[su,f_(e,o,i),cz,t,Pv,r],null)}function U_(e){return $H(TH(TH(e,new Q(null,2,5,S,[zr,Oo],null)),new Q(null,2,5,S,[zr,Ru],null)),zr)}function V_(e,t,r){return Nb.j((function(e,t){var i=G(e,0,null);e=G(e,1,null);var o=FQ.h(i,t);if(n(o)){var l=S;i=PQ(i,t,U_(o));var s=re.h;t=tI(o=$s.g(o),KZ(t,null,r)),t=new Q(null,2,5,l,[i,s.call(re,e,t)],null)}else t=new Q(null,2,5,S,[i,e],null);return t}),new Q(null,2,5,S,[e,F],null),t)}function W_(e,t){return Nb.j((function(e,t){return A(rI(e,t))}),e,nn.g(t))}function X_(e,t,r){var i=Pw.g(t),o=Ru.g(t);kt.g(t);var l=S;e=W_(e,t);var s=kt.g(t);e=TH(e,new Q(null,2,5,S,[Lo,s],null)),s=Ty.g(t),e=TH(e,new Q(null,2,5,S,[YC,s],null)),l=G(e=new Q(null,2,5,l,[e,null],null),0,null),e=G(e,1,null);var a=V_(l,nR(xj([o]),wp.g(t),D([rn.g(t)])),r);return s=G(a,0,null),a=G(a,1,null),l=G(e=new Q(null,2,5,S,[n(s)?s:l,Qe(a)||Le(a)?Nb.j(Dg(re,F),e,a):null!=a?Dg(re,F)(e,a):e],null),0,null),e=G(e,1,null),t=G(o=new Q(null,2,5,S,[l,P_(l,t,o,r)],null),0,null),o=G(o,1,null),t=G(o=new Q(null,2,5,S,[n(t)?t:l,Qe(o)||Le(o)?Nb.j(Dg(re,F),e,o):null!=o?Dg(re,F)(e,o):e],null),0,null),o=G(o,1,null),l=n(i)?FQ.h(t,pG.g(i)):i,n(l)?new Q(null,2,5,S,[t,re.h(o,SZ($s.g(l),UC.g(i),pG.g(i),r))],null):new Q(null,2,5,S,[t,o],null)}function Y_(e,t){return n(Xz.g(t))?e=X_(e,t=VZ(e,kt.g(t)),hI("activity.errors.owner_creation","Activity owner cannot be created")):e=new Q(null,2,5,S,[e,null],null),e}function Z_(e,t){var r=n(wp.g(e))?hh(e,wp,De,t):e;return n(rn.g(e))?hh(r,rn,De,t):r}function $_(e,t,n,r){yS(it,"gateway.domains.activity.activities",563,lE,new qk((function(){return new Q(null,5,5,S,["a participant",kt.g(n),"of activity",kt.g(t),"has left"],null)})),-882816949);var i=kt.g(n),o=Z_(t,i),l=kt.g(o);return r=S_(e,i,o,r),new k(null,3,[su,A(g_(WZ(PQ(e,i,U_(n)),l,o),e_(e,Ty.g(o)),i)),cz,o,Pv,r],null)}function a0(e,t,r,i,o){var l=kt.g(r);return yS(it,"gateway.domains.activity.activities",583,lE,new qk((function(){return new Q(null,5,5,S,["the owner",l,"of activity",kt.g(t),"has left"],null)})),-1159722902),n(o)?X_(PQ(e,l,U_(r)),t,i):(r=bg(e=$_(e,t,r,i)),e=u.h(r,su),r=u.h(r,Pv),new Q(null,2,5,S,[e,r],null))}function b0(e,t,n,r,i,o){return e=z(i)?Nb.j((function(e,t){return o.j?o.j(e,r,t):o.call(null,e,r,t)}),e,Yg.h(vb,i)):o.j?o.j(e,r,Fm):o.call(null,e,r,Fm),new Q(null,2,5,S,[e,new Q(null,1,5,S,[RZ(t,n,r)],null)],null)}function c0(e,t,n){n=bg(n);var r=u.h(n,UC),i=u.h(n,pG),o=u.h(n,ks);return n=HQ(e,i,zr),e=G(t=b0(e,t,r,i,o,a_),0,null),t=G(t,1,null),r=Xg.h(zy,ei(u.h(e,Lo))),new Q(null,2,5,S,[e,ah.h(t,bh.h(Cg(QZ,e,$s.g(n),kt.g(n)),z(o)?Xg.h((function(e){return M(o,X.g(e))}),r):r))],null)}function d0(e,t,n,r,i){return tI(t,new k(null,5,[wu,e,X,Sn,UC,n,pG,r,Rt,i],null))}function e0(e,t,n,r,i,o){return tI(t,new k(null,6,[wu,e,X,eq,UC,n,pG,r,Rt,i,Fw,o],null))}function f0(e,t,n,r,i){return tI(t,new k(null,6,[wu,e,X,Hv,pG,n,Rt,r,pE,GC.g(i),In,Ar.g(i)],null))}function g0(e){return[p.g(e),".errors.not_authorized"].join("")}function h0(e){return lI([p.g(e),".destroyed"].join(""),"Context destroyed explicitly")}function i0(e){return lI([p.g(e),".peer-left"].join(""),"Context destroyed because its owner/last peer left")}function j0(e){return[p.g(e),".errors.failure"].join("")}function k0(e,t){return e=bD.g(e),t=bD.g(t),OB.g(e)>OB.g(t)||x.h(OB.g(e),OB.g(t))&&uA.g(e)>=uA.g(t)}function l0(e,t,r){var i=JF.g(e);return function(){var o=x.h(kt.g(t),Zv.g(e));return o||(x.h(i,cz)?M(QD.g(e),kt.g(t)):(o=x.h(kt.g(t),Zv.g(e)))||(o=x.h(kt.g(t),Ru.g(e)))?o:yb(r)||n(o=sD.g(e))?hP(sD.g(e),Uz.g(e),Uz.g(t)):o)}()}function m0(e,t,r){x.h(JF.g(t),cz)&&jI(g0(e),"Activity contexts cannot be explicitly destroyed");var i=x.h(JF.g(t),SB),o=i&&x.h(Ru.g(t),kt.g(r));n(t=o||((i=!i)?l0(t,r,!1):i))||jI(g0(e),"Not authorized to destroy context")}function n0(e,t){var r=x.h(kt.g(t),Zv.g(e));return r||(r=x.h(kt.g(t),Ru.g(e)))||n(r=hP(PA.g(e),Uz.g(e),Uz.g(t)))?r:l0(e,t,!0)}function o0(e,t){var n=IQ(e);return n&&(n=cg.h(JF.g(t),cz))?n0(t,e):n}function p0(e,t,r){n(n0(t,r))||jI(g0(e),"Not authorized to read context")}function q0(e){return n(dh.h(e,new Q(null,2,5,S,[Vt,Sp],null)))?"global":"context"}function r0(e,t,n,r,i){var o=kt.g(t);return e=A_(e,t,r,i),new Q(null,2,5,S,[e,bh.h((function(e){var t=q0(e),i=$s.g(e);return e=kt.g(e),tI(i,new k(null,6,[wu,t,X,Bq,pG,e,ko,n,Rt,o,fG,r],null))}),Xg.h(IQ,Ng.h(Ag(FQ,e),Yg.h(Ag(x,n),QD.g(t)))))],null)}function s0(e,t){var r=bg(t);u.h(r,UC);var i,o=u.h(r,pG),l=u.h(r,Yo);r=u.h(r,fG);try{var s=GQ(e,o),a=u_(e,l,s);return n(a)?n(n(i=l0(a,s,!1))?k0(t,a):i)?r0(e,a,o,aI(r),bD.g(t)):new Q(null,2,5,S,[e,null],null):(yS(tz,"gateway.common.context.ops",156,lE,new qk((function(){return new Q(null,2,5,S,["unable to find remote context",l],null)})),-2046241708),new Q(null,2,5,S,[e,null],null))}catch(i){var c=i;return yS(Cx,"gateway.common.context.ops",160,lE,new qk((function(){return new Q(null,2,5,S,[c,"error performing remote context update"],null)})),-123359054),new Q(null,2,5,S,[e,null],null)}}function t0(e,t,r,i){if(yI(r)){var o=bg(i),l=u.h(o,UC),s=u.h(o,pG),a=u.h(o,Rt);o=u.h(o,fG);try{var c=GQ(t,s),h=v_(t,a),d=bD.h(h,new k(null,1,[OB,0],null)),f=I.j(gh(d,OB,Rd),uA,(new Date).getTime());n(l0(h,c,!1))||jI(g0(e),"Not authorized to update context");var p=r0(t,h,s,aI(o),f),g=G(p,0,null),w=G(p,1,null),m=new Q(null,2,5,S,[g,new Q(null,2,5,S,[xI.F(e,r,l,s),uI(MY(cI(pq.g(t)),s),I.l(i,X,MF,D([bD,f,Yo,Yo.g(h)])))],null)],null),v=G(m,0,null),y=G(m,1,null),b=new Q(null,2,5,S,[n(v)?v:g,Qe(y)||Le(y)?Nb.j(Dg(re,F),w,y):null!=y?Dg(re,F)(w,y):w],null)}catch(n){b=new Q(null,2,5,S,[t,new Q(null,1,5,S,[wI.O(e,r,l,s,iI(n,j0(e)))],null)],null)}}else b=s0(t,i);return b}function u0(e){if(e instanceof w)return e;switch(e){case"ownership":return SB;case"ref-counted":return Pp;case"retained":return mC;default:return null}}function v0(e,t,n,r){r=bg(r);var i=u.h(r,Yo),o=u.h(r,Fw),l=u.h(r,JF),s=u.h(r,PA),a=u.h(r,sD),c=u.h(r,pG),h=eI(pq.g(e));return r=G(h,0,null),h=G(h,1,null),t=I.l(B_(t,i,o,l,s,a,h),QD,xj([c]),D([mG,n])),t=x.h(l,SB)?I.j(t,Ru,c):t,n=S,e=I.j(e,pq,r),e=eh(e,new Q(null,2,5,S,[YC,kt.g(t)],null),t),new Q(null,2,5,n,[e,t],null)}function w0(e,t,n,r,i,o){return yS(pD,"GATEWAY_ACTION_LOG|context|gateway.common.context.ops",240,lE,new qk((function(){return new Q(null,6,5,S,["peer",o,"subscribes for context",Yo.g(i),"using request",r],null)})),1435752541),t=w_(t,i,o),new Q(null,2,5,S,[t,new Q(null,1,5,S,[e0(e,n,r,o,kt.g(i),Fw.g(i))],null)],null)}function x0(e,t,r){r=bg(r),u.h(r,UC);var i=u.h(r,pG),o=u.h(r,Yo);try{var l=GQ(t,i),s=u_(t,o,l);return n(s)?(p0(e,s,l),new Q(null,2,5,S,[w_(t,s,i),null],null)):(yS(tz,"gateway.common.context.ops",257,lE,new qk((function(){return new Q(null,2,5,S,["unable to find remote context",o],null)})),-1378912437),new Q(null,2,5,S,[t,null],null))}catch(e){return new Q(null,2,5,S,[t,null],null)}}function y0(e,t,r,i){if(yI(r)){var o=bg(i),l=u.h(o,UC),s=u.h(o,pG);o=u.h(o,Rt);try{var a=GQ(t,s),c=v_(t,o),h=Ag(w0,e);p0(e,c,a);var d=new Q(null,2,5,S,[t,null],null),f=G(d,0,null),p=G(d,1,null),g=h(f,r,l,c,s),w=G(g,0,null),m=G(g,1,null),v=new Q(null,2,5,S,[n(w)?w:f,Qe(m)||Le(m)?Nb.j(Dg(re,F),p,m):null!=m?Dg(re,F)(p,m):p],null),y=G(v,0,null),b=G(v,1,null),$=new Q(null,2,5,S,[null,uI(MY(cI(pq.g(t)),s),I.l(i,X,lu,D([Yo,Yo.g(c)])))],null),C=G($,0,null),x=G($,1,null),E=new Q(null,2,5,S,[n(C)?C:y,Qe(x)||Le(x)?Nb.j(Dg(re,F),b,x):null!=x?Dg(re,F)(b,x):b],null)}catch(n){E=new Q(null,2,5,S,[t,new Q(null,1,5,S,[wI.O(e,r,l,s,iI(n,j0(e)))],null)],null)}}else E=x0(e,t,i);return E}function z0(e,t,n){var r=Yo.g(t),i=kt.g(t),o=kt.g(n);return ah.j(F,zg.j(Xg.g(IQ),Xg.g(Ag(n0,t)),Ng.g((function(e){var t=q0(e),n=$s.g(e);return e=kt.g(e),tI(n,new k(null,6,[wu,t,X,fr,pG,e,UB,o,Rt,i,Yo,r],null))}))),TQ(e,Yp,n,!0))}function A0(e,t,n){var r=kt.g(e);return ah.j(F,zg.j(Xg.g(IQ),Xg.g(Ag(n0,e)),Ng.g((function(e){return f0(q0(e),$s.g(e),kt.g(e),r,n)}))),t)}function B0(e,t){var r=gP(PA.g(t)),i=gP(sD.g(t)),o=u0(JF.g(t));return n(o)||jI([p.g(e),".errors.bad_lifetime"].join(""),["Bad lifetime value ",p.g(o)].join("")),pj.l(D([t,new k(null,3,[PA,r,sD,i,JF,o],null)]))}function C0(e,t,r,i){var o=bg(i),l=u.h(o,UC),s=u.h(o,pG),a=u.h(o,Yo);try{var c=GQ(t,s),h=u_(t,a,c);if(n(h))return p0(e,h,c),w0(e,t,r,l,h,s);var d=v0(t,c,!0,B0(e,i)),f=G(d,0,null),p=G(d,1,null);return yS(pD,"GATEWAY_ACTION_LOG|context|gateway.common.context.ops",380,lE,new qk((function(){return new Q(null,6,5,S,["peer",s,"creates context",a,"using request",l],null)})),319259055),new Q(null,2,5,S,[f,re.l(z0(f,p,c),d0(e,r,l,s,kt.g(p)),D([uI(MY(cI(pq.g(t)),s),I.l(i,X,Qu,D([bD,bD.g(p)])))]))],null)}catch(n){var g=n;return yS(Cx,"gateway.common.context.ops",389,lE,new qk((function(){return new Q(null,2,5,S,[g,"error"],null)})),1914118705),new Q(null,2,5,S,[t,new Q(null,1,5,S,[wI.O(e,r,l,s,iI(g,j0(e)))],null)],null)}}function D0(e,t,r,i){if(yI(r))var o=C0(e,t,r,i);else{var l=bg(i);u.h(l,UC),r=u.h(l,pG),l=u.h(l,Yo);try{var s=GQ(t,r),a=u_(t,l,s);if(n(a))p0(e,a,s),o=k0(i,a)?r0(t,a,r,new k(null,1,[AD,Fw.g(i)],null),bD.g(i)):new Q(null,2,5,S,[t,null],null);else{var c=v0(t,s,!1,B0(e,i)),h=G(c,0,null),d=G(c,1,null);o=new Q(null,2,5,S,[h,z0(h,d,s)],null)}}catch(e){o=new Q(null,2,5,S,[t,null],null)}}return o}function E0(e,t,n,r){yS(pD,"GATEWAY_ACTION_LOG|context|gateway.common.context.ops",419,lE,new qk((function(){return new Q(null,5,5,S,["context",Yo.g(n),"is destroyed","with reason",r],null)})),-1663283401);var i=kt.g(n),o=QD.g(n);return new Q(null,2,5,S,[TH(t,new Q(null,2,5,S,[YC,i],null)),Nb.j(re,bh.h((function(t){return f0(e,$s.g(t),kt.g(t),i,r)}),Xg.h(IQ,Ng.h(Ag(FQ,t),o))),A0(n,wk(D([Yg.h((function(e){return u.h(o,kt.g(e))}),JQ(t,Yp))])),r))],null)}function F0(e,t,r){r=bg(r);var i=u.h(r,pG),o=u.h(r,Yo);try{var l=GQ(t,i),s=u_(t,o,l);return n(s)?(m0(e,s,l),E0(e,t,s,h0(e))):(yS(tz,"gateway.common.context.ops",446,lE,new qk((function(){return new Q(null,2,5,S,["unable to find remote context",o],null)})),1357307602),new Q(null,2,5,S,[t,null],null))}catch(e){return new Q(null,2,5,S,[t,null],null)}}function G0(e,t,r,i){if(yI(r)){var o=bg(i),l=u.h(o,UC),s=u.h(o,pG);o=u.h(o,Rt);try{var a=GQ(t,s),c=v_(t,o);m0(e,c,a);var h=E0(e,t,c,h0(e)),d=G(h,0,null),f=G(h,1,null),p=new Q(null,2,5,S,[null,new Q(null,2,5,S,[xI.F(e,r,l,s),uI(MY(cI(pq.g(t)),s),I.l(i,X,Ho,D([Yo,Yo.g(c)])))],null)],null),g=G(p,0,null),w=G(p,1,null),m=new Q(null,2,5,S,[n(g)?g:d,Qe(w)||Le(w)?Nb.j(Dg(re,F),f,w):null!=w?Dg(re,F)(f,w):f],null)}catch(n){m=new Q(null,2,5,S,[t,new Q(null,1,5,S,[wI.O(e,r,l,s,iI(n,j0(e)))],null)],null)}}else m=F0(e,t,i);return m}y_.C(null,pt,(function(e,t){var r=bg(t);return t=u.h(r,oy),r=u.h(r,NC),e=n(e)?e:P,r=Fa(null==r?"":String(r))?null:TI(r,/\./,0),z_(e,r,t)})),y_.C(null,mA,(function(e,t){return t=bg(t),null==(t=Fa(null==(t=u.h(t,NC))?"":String(t))?null:TI(t,/\./,0))?P:TH.l(e,t,D([new k(null,1,[vq,!0],null)]))})),x_.C(null,Pu,(function(e,t){return G(t,0,null),t=G(t,1,null),Nb.j((function(e,t){return y_.h(e,aI(t))}),e,t)})),x_.C(null,Zk,(function(e,t){var n=G(t,0,null),r=G(t,1,null);return yS(tz,"gateway.common.context.state",154,lE,new qk((function(){return new Q(null,4,5,S,["ignoring unknown context delta command",n,"with payload",r],null)})),372664218),e})),h=C_.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"id":return this.id;case"type":return this.type;case"context-id":return this.Yb;case"initiator":return this.dc;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#gateway.domains.activity.activity.Activity{",", ","}",n,Of.h(new Q(null,4,5,S,[new Q(null,2,5,S,[kt,this.id],null),new Q(null,2,5,S,[X,this.type],null),new Q(null,2,5,S,[Ty,this.Yb],null),new Q(null,2,5,S,[bp,this.dc],null)],null),this.m))},h.xa=function(){return new Yh(this,4,new Q(null,4,5,S,[kt,X,Ty,bp],null),n(this.m)?nd(this.m):eg())},h.R=function(){return this.D},h.da=function(){return 4+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=246370226^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.id,t.id)&&x.h(this.type,t.type)&&x.h(this.Yb,t.Yb)&&x.h(this.dc,t.dc)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,4,[bp,null,X,null,kt,null,Ty,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new C_(this.id,this.type,this.Yb,this.dc,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"id":case"type":case"context-id":case"initiator":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(kt,t):O.call(null,kt,t))?new C_(r,this.type,this.Yb,this.dc,this.D,this.m,null):n(O.h?O.h(X,t):O.call(null,X,t))?new C_(this.id,r,this.Yb,this.dc,this.D,this.m,null):n(O.h?O.h(Ty,t):O.call(null,Ty,t))?new C_(this.id,this.type,r,this.dc,this.D,this.m,null):n(O.h?O.h(bp,t):O.call(null,bp,t))?new C_(this.id,this.type,this.Yb,r,this.D,this.m,null):new C_(this.id,this.type,this.Yb,this.dc,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,4,5,S,[new xh(kt,this.id),new xh(X,this.type),new xh(Ty,this.Yb),new xh(bp,this.dc)],null),this.m))},h.S=function(e,t){return new C_(this.id,this.type,this.Yb,this.dc,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},Z(HE,SC,Ab),Z(Hx,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[sw],null),dD,new Q(null,1,5,S,[HE],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[sw],null),dD,new Q(null,1,5,S,[HE],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[sw],null),new Q(null,1,5,S,[HE],null),null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Uz)}],null),function(e){return J(e)&&M(e,Uz)},new Q(null,1,5,S,[Gp],null),new Q(null,1,5,S,[sw],null),null,new Q(null,1,5,S,[Uz],null),new Q(null,1,5,S,[HE],null),new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Uz))],null),null]))],null),null)),Z(vG,zC,zC),Z(sx,N(xy,SC),aQ(oC,Ab,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,SC),Jz,function(e){return Fe(e)}],null),null)),Z(yC,Wu,J),Z(co,Wu,J),Z(xG,Wu,J),Z(KF,new uj(null,new k(null,2,[mA,"null",pt,"null"],null),null),new uj(null,new k(null,2,[mA,null,pt,null],null),null)),Z(cm,SC,Ab),Z(vz,Hs,Bb),Z(Kw,N(eD,T,new Q(null,2,5,S,[KF,cm],null),dD,new Q(null,1,5,S,[vz],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[KF,cm],null),new Q(null,1,5,S,[vz],null),null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,NC)}],null),function(e){return J(e)&&M(e,X)&&M(e,NC)},new Q(null,1,5,S,[oy],null),new Q(null,2,5,S,[KF,cm],null),null,new Q(null,2,5,S,[X,NC],null),new Q(null,1,5,S,[vz],null),new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,NC))],null),null]))),Z($o,N(xy,Kw,Jr,iB,aF,F),aQ(Kw,Kw,new k(null,6,[Rv,!0,Jr,Le,aF,F,Fo,iB,tD,N(xy,Kw,Jr,iB,aF,F),Jz,function(e){return Le(e)}],null),null)),Z(OD,N(eD,dD,new Q(null,5,5,S,[sx,yC,co,xG,$o],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[null,new Q(null,5,5,S,[sx,yC,co,xG,$o],null),null,new Q(null,1,5,S,[function(e){return J(e)}],null),function(e){return J(e)},new Q(null,5,5,S,[Ws,Cw,HB,AD,Pu],null),F,null,F,new Q(null,5,5,S,[sx,yC,co,xG,$o],null),new Q(null,1,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W))],null),null]))),Z(fs,N(Xy,Ix,N(eD,T,new Q(null,2,5,S,[vG,OD],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,2,5,S,[vG,OD],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[vG,OD],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,Rt)},function(e){return M(e,fG)}],null),function(e){return J(e)&&M(e,Rt)&&M(e,fG)},F,new Q(null,2,5,S,[vG,OD],null),null,new Q(null,2,5,S,[Rt,fG],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,fG))],null),null]))],null),null)),Z(op,N(V,new Q(null,1,5,S,[W],null),N(Vr,Kz,N(Ky,W))),(function(e){return MP(Kz,Bf.g(e))})),Z(ww,N(jz,SC),nQ(SC,Ab,null)),Z(AC,N(jz,SC),nQ(SC,Ab,null)),Z(xD,N(Xy,Ix,N(eD,T,new Q(null,3,5,S,[lw,bq,op],null),dD,new Q(null,3,5,S,[cC,ww,AC],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,3,5,S,[lw,bq,op],null),dD,new Q(null,3,5,S,[cC,ww,AC],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[lw,bq,op],null),new Q(null,3,5,S,[cC,ww,AC],null),null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,Yo)},function(e){return M(e,Fw)},function(e){return M(e,JF)}],null),function(e){return J(e)&&M(e,Yo)&&M(e,Fw)&&M(e,JF)},new Q(null,3,5,S,[bD,PA,sD],null),new Q(null,3,5,S,[lw,bq,op],null),null,new Q(null,3,5,S,[Yo,Fw,JF],null),new Q(null,3,5,S,[cC,ww,AC],null),new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Yo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fw)),N(V,new Q(null,1,5,S,[W],null),N(U,W,JF))],null),null]))],null),null)),Z(vG,zC,zC),Z(jA,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[vG],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[vG],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[vG],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Rt)}],null),function(e){return J(e)&&M(e,Rt)},F,new Q(null,1,5,S,[vG],null),null,new Q(null,1,5,S,[Rt],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt))],null),null]))],null),null)),Z(Tu,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[vG],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[vG],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[vG],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Rt)}],null),function(e){return J(e)&&M(e,Rt)},F,new Q(null,1,5,S,[vG],null),null,new Q(null,1,5,S,[Rt],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt))],null),null]))],null),null)),Z(dx,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[vG],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[vG],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[vG],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Rt)}],null),function(e){return J(e)&&M(e,Rt)},F,new Q(null,1,5,S,[vG],null),null,new Q(null,1,5,S,[Rt],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt))],null),null]))],null),null)),Z($D,SC,Ab),Z(Xr,SC,Ab),Z(EB,jB,jB),uQ.C(null,Bq,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[EB,cr,OD],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[EB,cr,OD],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,ko)},function(e){return M(e,Rt)},function(e){return M(e,fG)}],null),function(e){return J(e)&&M(e,ko)&&M(e,Rt)&&M(e,fG)},F,new Q(null,3,5,S,[EB,cr,OD],null),null,new Q(null,3,5,S,[ko,Rt,fG],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ko)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,fG))],null),null]))],null),null)})),uQ.C(null,MF,(function(){return ZP(new Q(null,2,5,S,[KG,fs],null),new Q(null,2,5,S,[KG,fs],null),null)})),uQ.C(null,Sn,(function(){return ZP(new Q(null,2,5,S,[Ql,N(eD,T,new Q(null,1,5,S,[cr],null))],null),new Q(null,2,5,S,[Ql,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[cr],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Rt)}],null),function(e){return J(e)&&M(e,Rt)},F,new Q(null,1,5,S,[cr],null),null,new Q(null,1,5,S,[Rt],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt))],null),null]))],null),null)})),Z(Ht,jB,jB),Z(cr,zC,zC),uQ.C(null,fr,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[Ht,cr,lw],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[Ht,cr,lw],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,UB)},function(e){return M(e,Rt)},function(e){return M(e,Yo)}],null),function(e){return J(e)&&M(e,UB)&&M(e,Rt)&&M(e,Yo)},F,new Q(null,3,5,S,[Ht,cr,lw],null),null,new Q(null,3,5,S,[UB,Rt,Yo],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,UB)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Yo))],null),null]))],null),null)})),uQ.C(null,eq,(function(){return ZP(new Q(null,2,5,S,[Ql,N(eD,T,new Q(null,2,5,S,[cr,bq],null))],null),new Q(null,2,5,S,[Ql,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[cr,bq],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,Rt)},function(e){return M(e,Fw)}],null),function(e){return J(e)&&M(e,Rt)&&M(e,Fw)},F,new Q(null,2,5,S,[cr,bq],null),null,new Q(null,2,5,S,[Rt,Fw],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fw))],null),null]))],null),null)})),uQ.C(null,Hv,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[cr,$D,Xr],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[cr,$D,Xr],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,Rt)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,Rt)&&M(e,pE)&&M(e,In)},F,new Q(null,3,5,S,[cr,$D,Xr],null),null,new Q(null,3,5,S,[Rt,pE,In],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))],null),null)})),uQ.C(null,Qu,(function(){return ZP(new Q(null,2,5,S,[KG,xD],null),new Q(null,2,5,S,[KG,xD],null),null)})),uQ.C(null,Ho,(function(){return ZP(new Q(null,2,5,S,[KG,dx],null),new Q(null,2,5,S,[KG,dx],null),null)})),uQ.C(null,lu,(function(){return ZP(new Q(null,2,5,S,[KG,jA],null),new Q(null,2,5,S,[KG,jA],null),null)})),uQ.C(null,xs,(function(){return ZP(new Q(null,2,5,S,[KG,Tu],null),new Q(null,2,5,S,[KG,Tu],null),null)}));var H0=function e(t){switch(arguments.length){case 3:return e.j(arguments[0],arguments[1],arguments[2]);case 4:return e.F(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",p.g(arguments.length)].join(""))}};function I0(e,t,r){var i=bg(r);u.h(i,UC);var o=u.h(i,pG),l=u.h(i,Yo);try{var s=GQ(t,o),a=u_(t,l,s);return n(a)?H0.F(e,t,o,a):(yS(tz,"gateway.common.context.ops",517,lE,new qk((function(){return new Q(null,2,5,S,["unable to find remote context",l],null)})),1511749041),new Q(null,2,5,S,[t,null],null))}catch(e){var c=e;return yS(tz,"gateway.common.context.ops",521,lE,new qk((function(){return new Q(null,3,5,S,[c,"unable to process remote unsubscribe",r],null)})),91111828),new Q(null,2,5,S,[t,null],null)}}function J0(e,t,r,i){if(yI(r)){var o=bg(i),l=u.h(o,UC),s=u.h(o,pG);o=u.h(o,Rt);try{GQ(t,s);var a=v_(t,o),c=H0.F(e,t,s,a),h=G(c,0,null),d=G(c,1,null),f=new Q(null,2,5,S,[null,new Q(null,2,5,S,[xI.F(e,r,l,s),uI(MY(cI(pq.g(t)),s),I.l(i,X,xs,D([Yo,Yo.g(a)])))],null)],null),p=G(f,0,null),g=G(f,1,null),w=new Q(null,2,5,S,[n(p)?p:h,Qe(g)||Le(g)?Nb.j(Dg(re,F),d,g):null!=g?Dg(re,F)(d,g):d],null)}catch(n){w=new Q(null,2,5,S,[t,new Q(null,1,5,S,[wI.O(e,r,l,s,iI(n,j0(e)))],null)],null)}}else w=I0(e,t,i);return w}function K0(e,t,n){var r=$s.g(n),i=kt.g(n);return Ng.h((function(t){var n=Ru.g(t),o=kt.g(t);return t=Yo.g(t),tI(r,new k(null,6,[wu,e,X,fr,pG,i,UB,n,Rt,o,Yo,t],null))}),Xg.h(Ag(o0,n),t_(t)))}function L0(e,t){return n(e=FQ.h(e,pG.g(Ro.g(t))))?yb(Sp.g(Vt.g(e))):null}H0.j=function(e,t,r){var i=kt.g(r),o=Ag(H0,e);return Nb.j((function(e,t){var r=G(e,0,null);e=G(e,1,null);var l=o(r,i,t);return t=G(l,0,null),l=G(l,1,null),new Q(null,2,5,S,[n(t)?t:r,Qe(l)||Le(l)?Nb.j(Dg(re,F),e,l):null!=l?Dg(re,F)(e,l):e],null)}),new Q(null,2,5,S,[t,F],null),t_(t))},H0.F=function(e,t,r,i){if(M(QD.g(i),r)){var o=hh(i,QD,De,r);r=x.h(r,Ru.g(o))?we.h(o,Ru):o,t=G(i=new Q(null,2,5,S,[eh(t,new Q(null,2,5,S,[YC,kt.g(i)],null),r),r],null),0,null),i=G(i,1,null);e:switch(r=JF.g(i),r instanceof w?r.W:null){case"ownership":r=null==Ru.g(i);break e;case"ref-counted":r=Ee(QD.g(i));break e;default:r=!1}return n(r)?E0(e,t,i,i0(e)):new Q(null,2,5,S,[t,null],null)}return new Q(null,2,5,S,[t,null],null)},H0.I=4;var M0=Ag(t0,"activity");function N0(e){return 0<(e=1e3*dh.j(e,new Q(null,2,5,S,[du,nA],null),0))?e:wU}function O0(e,t){var r=rI(e,UC.g(t));e=G(r,0,null);var i=G(r,1,null);if(!n(i))return null;switch((r=X.g(i))instanceof w?r.W:null){case"activity":return n(t=cz.g(i))?Y_(e,t):null;case"create-peer":return q_(e,kI(t),Pw.g(i));default:return yS(Cx,"gateway.domains.activity.core",37,lE,new qk((function(){return new Q(null,2,5,S,["Unable to handle error for an unknown incoming request type",X.g(i)],null)})),754475914)}}var P0=Bg(VQ,"activity",zr);function Q0(e,t,r,i){var o=new Q(null,2,5,S,[e,null],null),l=function(){var e=G(o,0,null),i=G(o,1,null),l=dh.h(t,new Q(null,2,5,S,[zr,Oo],null)),s=VZ(e,l);if(n(s)){l=Ru.g(s);var a=kt.g(t),c=M(iF.g(s),a);s=c?hh(s,iF,Dg(De,wj),a):s,x.h(l,a)?a=a0(e,s,t,r,!c):(a=bg(l=$_(e,s,t,r)),l=u.h(a,su),a=u.h(a,Pv),a=new Q(null,2,5,S,[l,a],null))}else a=null;return l=G(a,0,null),a=G(a,1,null),new Q(null,2,5,S,[n(l)?l:e,Qe(a)||Le(a)?Nb.j(Dg(re,F),i,a):null!=a?Dg(re,F)(i,a):i],null)}(),s=function(){var e=G(l,0,null),r=G(l,1,null),i=ei(dh.h(t,new Q(null,2,5,S,[zr,hx],null))),o=n(i)?new Q(null,2,5,S,[UZ(e,Ng.h(pA,i),kt.g(t)),k_(e,t,Ng.h(kt,i),!1)],null):null;return i=G(o,0,null),o=G(o,1,null),new Q(null,2,5,S,[n(i)?i:e,Qe(o)||Le(o)?Nb.j(Dg(re,F),r,o):null!=o?Dg(re,F)(r,o):r],null)}();e=G(s,0,null),s=G(s,1,null);var a=P0(e,t,r,i);return i=G(a,0,null),a=G(a,1,null),new Q(null,2,5,S,[n(i)?i:e,Qe(a)||Le(a)?Nb.j(Dg(re,F),s,a):null!=a?Dg(re,F)(s,a):s],null)}function R0(e,t){return t=MQ(e,t,zr),e=ef(Ng.g(kt),cf((function(e,t){return oI(e,t,zr)}),bf),e,t),Nb.j((function(e,t){var r=G(e,0,null);e=G(e,1,null);var i=Q0(r,t,IZ,!0);return t=G(i,0,null),i=G(i,1,null),new Q(null,2,5,S,[n(t)?t:r,Qe(i)||Le(i)?Nb.j(Dg(re,F),e,i):null!=i?Dg(re,F)(e,i):e],null)}),new Q(null,2,5,S,[e,null],null),t)}var S0=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.domains.activity.core","handle-request"),(function(e,t,n){return X.g(n)}),i,e,t,n,r)}();function T0(e){return gh(gh(e,ey,aI),mE,Ag(bh,aI))}function U0(e){return bh.h((function(e){return T0(rj(aI(e),new Q(null,4,5,S,[Yo,ey,mE,Ev],null)))}),e)}function V0(){this.gh=null}function W0(e,t,r){return n(r=GE.g(r))?C(dh.h(e,new Q(null,2,5,S,[xB,n(t)?t:qv],null)))>=r:null}function X0(e,t){return af((function(e,n,r){return I.j(e,n,x.h("?",r)?t:r)}),P,e)}function Y0(e,t,r){function i(e,n){return wI.O("global",t,l,s,hI(e,n))}var o=bg(r),l=u.h(o,UC),s=u.h(o,pG);o=u.h(o,xz);var a=Uz.g(FQ.h(e,s));if(n(a)){var c=sI(e,o);return n(c)?DQ(c,e,new k(null,3,[ut,gz,$s,t,Ro,I.j(I.j(r,Uz,a),X,OG)],null)):new Q(null,2,5,S,[e,new Q(null,1,5,S,[i("global.errors.invalid_domain",["Unable to join missing domain ",p.g(o)].join(""))],null)],null)}return new Q(null,2,5,S,[e,new Q(null,1,5,S,[i("global.errors.invalid_peer",["Unable to find peer with id ",p.g(s)].join(""))],null)],null)}function Z0(e,t,n){return Y0(e,t,n)}function $0(e,t,r,i,o){var l=bg(r),s=u.h(l,UC),a=u.h(l,qz),c=u.h(l,fz),h=u.h(l,xr),d=u.h(l,Jp),f=u.h(l,Vt);l=mD.g(i);var g=G(e=rI(e,kt.g(c)),0,null);G(e,1,null);var w,m,v,y=function(){var e=pj.l(D([new k(null,1,[Ay,KT(yv.g(t),hE.g(o))],null),HT(a),rj(r,new Q(null,2,5,S,[xr,iz],null))]));if(n(iD.g(r))){var i=iD.g(r);e=n(i=xr.g(i))?I.j(e,xr,i):e}return e}(),b=n(Wv.g(y))?new Q(null,2,5,S,[y,g],null):(w=pq.g(g),m=Zu.h(w,1),v=["i-",p.g(jw.g(w)),"-",p.g(m)].join(""),w=G(m=new Q(null,2,5,S,[I.j(w,Zu,m+1),v],null),0,null),m=G(m,1,null),new Q(null,2,5,S,[I.j(y,Wv,m),I.j(g,pq,w)],null));e=G(b,0,null),b=G(b,1,null),f=I.j(f,Sp,!0);try{n(dh.h(b,new Q(null,2,5,S,[Du,e],null)))&&jI("global.errors.already_seen","Hello already received once"),JT(e),n(W0(b,h,l))&&jI("global.errors.limits_exceeded","Maximum number of peers per user have been reached");var $=fI(pq.g(b)),x=G($,0,null),E=G($,1,null),A=X0(e,E),_=NQ(I.j(b,pq,x),t,E,A,c,f),j=G(_,0,null),N=G(_,1,null),R=yZ(t,s,kt.g(N),Ng.h(pD,ei(PE.g(j))),A,pj.l(D([function(){var e=pD.g(i);return n(e)?new k(null,1,[pD,e],null):null}(),n(d)?new k(null,1,[Jp,d],null):null])));n(null)&&zS(jm,"global/peer-count",C(wG.g(j)));var T=new Q(null,2,5,S,[j,new Q(null,1,5,S,[R],null)],null),P=G(T,0,null),O=G(T,1,null),B=Z0(P,t,new k(null,6,[UC,s,pG,kt.g(N),Uz,A,Vt,f,xz,"context",wu,"global"],null)),M=G(B,0,null),U=G(B,1,null);return new Q(null,2,5,S,[n(M)?M:P,Qe(U)||Le(U)?Nb.j(Dg(re,F),O,U):null!=U?Dg(re,F)(O,U):O],null)}catch(w){return c=w,yI(t)?new Q(null,2,5,S,[b,new Q(null,1,5,S,[wI.O("global",t,s,null,iI(c,"global.errors.failure"))],null)],null):null}}function a1(e,t,r){yS(it,"gateway.domains.global.core",230,lE,new qk((function(){return new Q(null,1,5,S,["removing source from global domain"],null)})),-1006906324);var i=dh.h(e,new Q(null,2,5,S,[pq,jw],null));e=Nb.j((function(e,o){var l=G(e,0,null);e=G(e,1,null);var s=new Q(null,2,5,S,[OQ(l,o),null],null),a=G(s,0,null);return s=G(s,1,null),l=G(e=new Q(null,2,5,S,[n(a)?a:l,Qe(s)||Le(s)?Nb.j(Dg(re,F),e,s):null!=s?Dg(re,F)(e,s):e],null),0,null),e=G(e,1,null),o=G(a=new Q(null,2,5,S,[null,yI(t)?uI(new k(null,3,[X,qy,em,kt.g(o),zt,i],null),r):null],null),0,null),a=G(a,1,null),new Q(null,2,5,S,[n(o)?o:l,Qe(a)||Le(a)?Nb.j(Dg(re,F),e,a):null!=a?Dg(re,F)(e,a):e],null)}),new Q(null,2,5,S,[e,null],null),LQ(e,t));var o=G(e,0,null);return G(e,1,null),yS(it,"gateway.domains.global.core",243,lE,new qk((function(){return new Q(null,1,5,S,["removed source from global domain"],null)})),-2080102303),n(null)&&zS(jm,"global/peer-count",C(wG.g(o))),e}function b1(e,t,r,i,o){r=bg(r);var l=u.h(r,UC),s=u.h(r,Uz);r=fL(r=u.h(r,du));var a=Bf.g(Hn.h(r,Zk.g(i)));return n(i=dh.h(i,new Q(null,2,5,S,[nw,a],null)))?(qT(sT(qT(wT(i,new k(null,4,[UC,l,qz,s,du,r,ho,ho.g(e)],null)),(function(e){return gh(e,X,(function(e){switch(e instanceof w?e.W:null){case"success":return an;case"continue":return tE;default:return e}}))})),(function(e){return I.j(el(e),X,Ft)})),(function(e){return PH(o,new k(null,3,[ut,gz,$s,t,Ro,I.l(e,UC,l,D([qz,s]))],null))})),new Q(null,2,5,S,[e,null],null)):new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("global",t,l,null,lI("global.errors.authentication.failure",["Requested authentication provider ",p.g(a)," is not available"].join("")))],null)],null)}S0.C(null,OG,(function(e,t,r){var i=bg(r);r=u.h(i,UC);var o=u.h(i,pG);if(i=u.h(i,Gp),n(pI(e,o,zr)))t=new Q(null,2,5,S,[e,new Q(null,1,5,S,[RZ(t,r,o)],null)],null);else{i=gP(i),i=nI(e,o,zr,i),e=FQ.h(i,o);e:{var l=Sv.g(e);if(n(l)){var s=Xm.g(l),a=pA.g(l);switch(s=n(s)?I.j(e,Xm,s):e,a=n(a)?I.j(s,pA,a):s,s=(s=X.g(l))instanceof w?s.W:null){case"activity":var c=VZ(i,s=dh.h(l,new Q(null,2,5,S,[cz,kt],null)));if(n(c)){var h=kt.g(a),d=dh.h(l,new Q(null,2,5,S,[cz,Xz],null)),f=e_(i,Ty.g(c));c=UH(c,new Q(null,1,5,S,[wp],null),D([h])),d=n(d)?I.j(c,Ru,kt.g(a)):c,i=f_(PQ(WZ(i,s,d=WH(d,new Q(null,1,5,S,[nn],null),kt.g(l))),h,eh(eh(a,new Q(null,2,5,S,[zr,Oo],null),s),new Q(null,2,5,S,[zr,Sm],null),Sm.g(l))),f,h)}break e;case"create-peer":i=PQ(i,kt.g(a),a);break e;default:throw Error(["No matching clause: ",p.g(s)].join(""))}}}if(l=re.h,s=a=ah.h,h=UQ("activity",zr,i,t,e),z(f=yj(ei(XZ(i,dh.h(e,new Q(null,2,5,S,[Uz,xr],null)))))))f=new Q(null,1,5,d=S,[tI(c=$s.g(e),LZ(kt.g(e),f))],null);else f=null;t=l.call(re,a.call(ah,s.call(ah,h,f),l_.h(i,e)),RZ(t,r,o)),t=new Q(null,2,5,S,[i,t],null)}return t})),S0.C(null,mv,(function(e,t,r){var i=bg(r),o=u.h(i,UC);return e=G(r=Q0(e,HQ(e,i=u.h(i,pG),zr),kI(r),!1),0,null),r=G(r,1,null),t=G(o=new Q(null,2,5,S,[null,RZ(t,o,i)],null),0,null),o=G(o,1,null),new Q(null,2,5,S,[n(t)?t:e,Qe(o)||Le(o)?Nb.j(Dg(re,F),r,o):null!=o?Dg(re,F)(r,o):r],null)})),S0.C(null,sk,(function(e,t,r){r=pG.g(r),r=FQ.h(e,r);var i=dh.h(r,new Q(null,2,5,S,[zr,Oo],null));if(n(i)){var o=kt.g(r),l=VZ(e,i);if(n(l)){var s=x.h(Ru.g(l),o);if(t=s?l:hh(l,rn,Dg(re,wj),o),t=WH(t,new Q(null,1,5,S,[wp],null),o),s){if(o=Ty.g(t),o=Fw.g(e_(e,o)),s=kt.g(r),l=dh.h(r,new Q(null,2,5,S,[zr,Sm],null)),t=we.h(I.l(t,Ru,s,D([zy,!0])),Pw),s=WZ(PQ(e,s,eh(r,new Q(null,2,5,S,[zr,Oo],null),kt.g(t))),kt.g(t),t),n(l)){l=ah.h;var a=S;o=tI($s.g(r),PZ(e,r,t,o)),e=l.call(ah,new Q(null,1,5,a,[o],null),Q_(e,t,r))}else e=ah.h(M_(e,t,o),O_(e,t));e=new k(null,3,[su,s,cz,t,Pv,e],null)}else e=T_(e,t,r);t=bg(e),e=u.h(t,su),r=u.h(t,cz),t=u.h(t,Pv),e=new Q(null,2,5,S,[WZ(e,i,r),t],null)}else e=new Q(null,2,5,S,[PQ(e,o,U_(r)),new Q(null,1,5,S,[tI(t,KZ(o,null,JZ))],null)],null)}else n(l=dh.h(r,new Q(null,2,5,S,[Sv,Pw],null)))?(i=pG.g(l),s=FQ.h(e,i),o=t=S,s=$s.g(s),l=UC.g(l),r=kt.g(r),e=new Q(null,2,5,t,[e,new Q(null,1,5,o,[tI(s,new k(null,5,[wu,"activity",X,mo,UC,l,pG,i,is,r],null))],null)],null)):e=jI("activity.errors.invalid_peer",["Unable to find originating request for a ready message from peer ",p.g(kt.g(r))].join(""));return e})),S0.C(null,TE,(function(e,t,r){var i=bg(r);r=u.h(i,UC);var o=u.h(i,pG);i=U0(i=u.h(i,hp));var l=HQ(e,o,zr),s=dh.h(l,new Q(null,2,5,S,[Uz,xr],null));return n(s)?new Q(null,2,5,S,[YZ(e,s,i),re.h(E_(e,s,i),RZ(t,r,o))],null):new Q(null,2,5,S,[e,new Q(null,1,5,S,[SZ(t,r,o,lI("activity.errors.registration.failure",["Registering peer is missing an user in its identity",p.g(Uz.g(l))].join("")))],null)],null)})),S0.C(null,bG,(function(e,t,r){var i=bg(r);r=u.h(i,UC);var o=u.h(i,pG),l=u.h(i,hp),s=HQ(e,o,zr);return n(i=dh.h(s,new Q(null,2,5,S,[Uz,xr],null)))?(l=yj(l),l=yj(Xg.h(l,di(XZ(e,i)))),e=new Q(null,2,5,S,[ZZ(e,i,l),re.h(F_(e,i,l),RZ(t,r,o))],null)):e=new Q(null,2,5,S,[e,new Q(null,1,5,S,[SZ(t,r,o,lI("activity.errors.registration.failure",["Removing peer is missing an user in its identity",p.g(Uz.g(s))].join("")))],null)],null),e})),S0.C(null,Tw,(function(e,t,r,i){var o=wU;wU=N0(i);try{var l=we.h(r,DB);return K_(e,t,n(Kr.g(r))?gh(l,Kr,zg.h(T0,aI)):l,Ng.h(aI,DB.g(r)))}finally{wU=o}})),S0.C(null,fx,(function(e,t,r){var i=bg(r),o=u.h(i,UC),l=u.h(i,pG),s=u.h(i,Ov);i=HQ(e,l,zr),s=c_(e,s);var a=kt.g(i);return M(rn.g(s),a)||M(wp.g(s),a)||x.h(Ru.g(s),a)?i=!0:(a=FQ.h(e,Ru.g(s)),i=RQ.oa(Uz.g(a),sD.g(s),!1,Uz.g(i),null,!1)),n(i)?(e=G(r=X_(e,s,kI(r)),0,null),r=G(r,1,null),t=G(o=new Q(null,2,5,S,[null,RZ(t,o,l)],null),0,null),o=G(o,1,null),t=new Q(null,2,5,S,[n(t)?t:e,Qe(o)||Le(o)?Nb.j(Dg(re,F),r,o):null!=o?Dg(re,F)(r,o):r],null)):t=new Q(null,2,5,S,[e,SZ(t,o,l,hI("activity.errors.not_authorized","Not authorized to destroy activity"))],null),t})),S0.C(null,Sl,(function(e,t,n){return c0(e,t,n)})),S0.C(null,fB,(function(e,t,n){var r=bg(n);n=u.h(r,UC);var i=u.h(r,pG);return r=u.h(r,ks),HQ(e,i,zr),b0(e,t,n,i,r,b_)})),S0.C(null,LA,(function(e,t,r){var i=bg(r);r=u.h(i,UC);var o=u.h(i,pG),l=u.h(i,lC),s=u.h(i,Ov),a=u.h(i,pA),c=u.h(i,Xm);return HQ(e,o,zr),i=c_(e,s),l=pj.l(D([HQ(e,l,zr),ah.h(P,Xg.h(oe,new k(null,2,[Xm,c,pA,a],null)))])),c=zr.g(l),a=Oo.g(c),c=Ru.g(c),a=VZ(e,n(a)?a:c),x.h(kt.g(a),s)?t=new Q(null,2,5,S,[e,new Q(null,1,5,S,[RZ(t,r,o)],null)],null):n(a)?t=jI("activity.errors.activity_is_child",["Peer is already in activity ",p.g(kt.g(a))].join("")):(s=kt.g(i),a=kt.g(l),c=bg(e=T_(e,i,l)),e=u.h(c,su),i=u.h(c,cz),c=u.h(c,Pv),l=bg(e=new k(null,3,[su,PQ(WZ(e,s,i),a,eh(l,new Q(null,2,5,S,[zr,Oo],null),s)),cz,i,Pv,c],null)),e=u.h(l,su),l=u.h(l,Pv),t=new Q(null,2,5,S,[e,re.h(l,RZ(t,r,o))],null)),t})),S0.C(null,wF,(function(e,t,r){var i=bg(r),o=u.h(i,UC),l=HQ(e,i=u.h(i,pG),zr),s=dh.h(l,new Q(null,2,5,S,[zr,Oo],null));s=VZ(e,s);var a=Ru.g(s);return n(s)||jI("activity.errors.not_a_member","Not a member of an activity"),r=kI(r),x.h(a,i)?r=a0(e,s,l,r,!0):(r=bg(e=$_(e,s,l,r)),e=u.h(r,su),r=u.h(r,Pv),r=new Q(null,2,5,S,[e,r],null)),e=G(r,0,null),r=G(r,1,null),t=G(o=new Q(null,2,5,S,[null,RZ(t,o,i)],null),0,null),o=G(o,1,null),new Q(null,2,5,S,[n(t)?t:e,Qe(o)||Le(o)?Nb.j(Dg(re,F),r,o):null!=o?Dg(re,F)(r,o):r],null)})),S0.C(null,nu,(function(e,t,n){var r=bg(n);n=u.h(r,UC);var i=u.h(r,pG),o=u.h(r,hx);r=HQ(e,i,zr);for(var l=z(o=Ng.h(fL,o)),s=null,a=0,c=0;;)if(c<a){m_(r,s.$(null,c)),c+=1}else{if(!(l=z(l)))break;Me(s=l)?(l=ed(s),c=fd(s),s=l,a=C(l),l=c):(m_(r,l=A(s)),l=B(s),s=null,a=0),c=0}return e=i_(e,r,o),new Q(null,2,5,S,[e,re.h(j_(e,r,o),RZ(t,n,i))],null)})),S0.C(null,qF,(function(e,t,n){var r=bg(n);n=u.h(r,UC);var i=u.h(r,pG),o=u.h(r,gp),l=o_(r=HQ(e,i,zr),o);return o=G(l,0,null),l=G(l,1,null),e=UZ(PQ(e,i,o),Ng.h(pA,l),i),t=re.h(k_(e,r,bh.h(kt,l),!0),RZ(t,n,i)),new Q(null,2,5,S,[e,t],null)})),S0.C(null,jn,(function(e,t,r,i){var o=wU;wU=N0(i);try{var l=bg(r),s=u.h(l,UC),a=u.h(l,pG),c=u.h(l,bC),h=u.h(l,pA),d=u.h(l,Xm),f=u.h(l,Ov);HQ(e,a,zr);var p=n(f)?c_(e,f):null,g=n(d)?d:h,w=DB.g(r),m=r_(e,c,h),v=G(m,0,null),y=G(m,1,null),b=GQ(e,a),$=dI(pq.g(e)),C=G($,0,null),x=G($,1,null),E=rj(r,new Q(null,2,5,S,[UC,pG],null)),D=new k(null,4,[X,jn,kt,x,pA,h,Pw,E],null),A=n(g)?I.j(D,Xm,g):D,_=xU(e,Uz.g(b),A),j=qI(I.j(e,pq,C),x,A),N=new k(null,3,[su,j,Pv,new Q(null,1,5,S,[p_(v,y,w,_,x,p,e_(e,Ty.g(p)),g)],null),Mm,x],null);return new Q(null,2,5,S,[su.g(N),re.h(Pv.g(N),RZ(t,s,a))],null)}finally{wU=o}})),S0.C(null,ZB,(function(e,t,n){var r=bg(n);t=u.h(r,UC);var i=u.h(r,pG),o=u.h(r,GF);HQ(e,i,zr);var l=GQ(e,o),s=r=S;return new Q(null,2,5,r,[e,new Q(null,2,5,s,[n=tI(l=$s.g(l),KZ(o,i,n=kI(n))),RZ(t,i)],null)],null)})),S0.C(null,Cx,(function(e,t,n){return O0(e,n)})),S0.C(null,Sm,(function(e,t,r,i){var o=wU;wU=N0(i);try{var l=bg(r),s=u.h(l,UC),a=u.h(l,pG),c=GQ(e,a),h=dh.h(c,new Q(null,2,5,S,[zr,Oo],null)),d=VZ(e,h),f=dI(pq.g(e)),p=G(f,0,null),g=G(f,1,null),w=new k(null,5,[X,cz,kt,g,pA,pA.g(c),cz,new k(null,2,[kt,kt.g(d),Xz,x.h(kt.g(c),Ru.g(d))],null),Sm,!0],null),m=n(Xm.g(c))?I.j(w,Xm,Xm.g(c)):w,v=qI(I.j(e,pq,p),g,m);r=S;var y=n(h)?WZ(v,h,hh(d,iF,Dg(re,wj),a)):v;h=S;var b=xU(e,Uz.g(c),m);return new Q(null,2,5,r,[y,new Q(null,1,5,h,[tI(t,new k(null,5,[wu,"activity",X,Ol,UC,s,pG,a,Ol,b],null))],null)],null)}finally{wU=o}})),S0.C(null,MF,(function(e,t,n){return M0(e,t,n)})),S0.C(null,zB,(function(e,t){return R0(e,t)})),S0.C(null,Zk,(function(e,t,n){return yS(Cx,"gateway.domains.activity.core",251,lE,new qk((function(){return new Q(null,2,5,S,["Unhandled message",n],null)})),-278021844),new Q(null,2,5,S,[e,new Q(null,1,5,S,[SZ(t,UC.h(n,-1),pG.g(n),lI("activity.errors.unhandled_message",["Unhandled message ",p.g(n)].join("")))],null)],null)})),V0.prototype.Yc=function(){return new k(null,3,[GC,"activity",pr,"",bD,2],null)},V0.prototype.Zc=function(e,t){return t},V0.prototype.Wc=function(e,t){return t},V0.prototype.Xc=function(e,t,r){var i=bg(r);e=u.h(i,$s),i=u.h(i,Ro),X.g(i);try{return S0.F(t,e,i,this.gh)}catch(l){var o=l;return n(el(o))||yS(Cx,"gateway.domains.activity.core",275,lE,new qk((function(){return new Q(null,3,5,S,[o,"Error handling request",r],null)})),369713077),yI(e)?new Q(null,2,5,S,[t,new Q(null,1,5,S,[SZ(e,UC.g(i),pG.g(i),iI(o,"activity.errors.failure"))],null)],null):null}},Z(Cs,N(V,new Q(null,1,5,S,[W],null),N(Vr,Py,N(Zr,W))),(function(e){return MP(Py,fL(e))})),Z(YD,N(eD,T,new Q(null,3,5,S,[sC,sw,Cs],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[sC,sw,Cs],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,UC)},function(e){return M(e,Uz)},function(e){return M(e,du)}],null),function(e){return J(e)&&M(e,UC)&&M(e,Uz)&&M(e,du)},F,new Q(null,3,5,S,[sC,sw,Cs],null),null,new Q(null,3,5,S,[UC,Uz,du],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,UC)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Uz)),N(V,new Q(null,1,5,S,[W],null),N(U,W,du))],null),null]))),Z(OE,VC,VC),Z(QA,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[OE],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[OE],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[OE],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,xz)}],null),function(e){return J(e)&&M(e,xz)},F,new Q(null,1,5,S,[OE],null),null,new Q(null,1,5,S,[xz],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,xz))],null),null]))],null),null)),Z(Yq,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[OE],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[OE],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[OE],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,xz)}],null),function(e){return J(e)&&M(e,xz)},F,new Q(null,1,5,S,[OE],null),null,new Q(null,1,5,S,[xz],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,xz))],null),null]))],null),null)),Z(Ox,N(V,new Q(null,1,5,S,[W],null),N(Vr,Kz,N(Ky,W))),(function(e){return MP(Kz,Bf.g(e))})),Z(Ry,N(jz,SC),nQ(SC,Ab,null)),Z(Tv,N(jz,SC),nQ(SC,Ab,null)),Z(qq,N(Xy,Ix,N(eD,T,new Q(null,5,5,S,[lw,bq,Ox,Ry,Tv],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,5,5,S,[lw,bq,Ox,Ry,Tv],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,5,5,S,[lw,bq,Ox,Ry,Tv],null),null,null,new Q(null,6,5,S,[function(e){return J(e)},function(e){return M(e,Yo)},function(e){return M(e,Fw)},function(e){return M(e,JF)},function(e){return M(e,PA)},function(e){return M(e,sD)}],null),function(e){return J(e)&&M(e,Yo)&&M(e,Fw)&&M(e,JF)&&M(e,PA)&&M(e,sD)},F,new Q(null,5,5,S,[lw,bq,Ox,Ry,Tv],null),null,new Q(null,5,5,S,[Yo,Fw,JF,PA,sD],null),F,new Q(null,6,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Yo)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fw)),N(V,new Q(null,1,5,S,[W],null),N(U,W,JF)),N(V,new Q(null,1,5,S,[W],null),N(U,W,PA)),N(V,new Q(null,1,5,S,[W],null),N(U,W,sD))],null),null]))],null),null)),Z(PB,zC,zC),Z(dv,N(xy,SC),aQ(oC,Ab,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,SC),Jz,function(e){return Fe(e)}],null),null)),Z(ht,Wu,J),Z(Xl,Wu,J),Z(Tp,Wu,J),Z(gm,N(eD,dD,new Q(null,4,5,S,[dv,ht,Xl,Tp],null)),QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[null,new Q(null,4,5,S,[dv,ht,Xl,Tp],null),null,new Q(null,1,5,S,[function(e){return J(e)}],null),function(e){return J(e)},new Q(null,4,5,S,[Ws,Cw,HB,AD],null),F,null,F,new Q(null,4,5,S,[dv,ht,Xl,Tp],null),new Q(null,1,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W))],null),null]))),Z(My,N(Xy,Ix,N(eD,T,new Q(null,2,5,S,[PB,gm],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,2,5,S,[PB,gm],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[PB,gm],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,Rt)},function(e){return M(e,fG)}],null),function(e){return J(e)&&M(e,Rt)&&M(e,fG)},F,new Q(null,2,5,S,[PB,gm],null),null,new Q(null,2,5,S,[Rt,fG],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,fG))],null),null]))],null),null)),Z(WC,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[PB],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[PB],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[PB],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Rt)}],null),function(e){return J(e)&&M(e,Rt)},F,new Q(null,1,5,S,[PB],null),null,new Q(null,1,5,S,[Rt],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt))],null),null]))],null),null)),Z(nz,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[PB],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[PB],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[PB],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Rt)}],null),function(e){return J(e)&&M(e,Rt)},F,new Q(null,1,5,S,[PB],null),null,new Q(null,1,5,S,[Rt],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt))],null),null]))],null),null)),Z(Zp,N(Xy,Ix,N(eD,T,new Q(null,1,5,S,[PB],null))),ZP(new Q(null,2,5,S,[Ix,N(eD,T,new Q(null,1,5,S,[PB],null))],null),new Q(null,2,5,S,[Ix,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[PB],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Rt)}],null),function(e){return J(e)&&M(e,Rt)},F,new Q(null,1,5,S,[PB],null),null,new Q(null,1,5,S,[Rt],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt))],null),null]))],null),null)),Z(XB,SC,Ab),Z(uB,SC,Ab),uQ.C(null,Nm,(function(){return ZP(new Q(null,2,5,S,[KG,YD],null),new Q(null,2,5,S,[KG,YD],null),null)})),uQ.C(null,qt,(function(){return ZP(new Q(null,2,5,S,[KG,QA],null),new Q(null,2,5,S,[KG,QA],null),null)})),uQ.C(null,Pz,(function(){return ZP(new Q(null,2,5,S,[KG,Yq],null),new Q(null,2,5,S,[KG,Yq],null),null)})),Z(pp,sw,sw),uQ.C(null,an,(function(){return QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,5,5,S,[VE,sC,pp,$C,Av],null),new Q(null,1,5,S,[ym],null),null,new Q(null,6,5,S,[function(e){return J(e)},function(e){return M(e,X)},function(e){return M(e,UC)},function(e){return M(e,qz)},function(e){return M(e,xr)},function(e){return M(e,iz)}],null),function(e){return J(e)&&M(e,X)&&M(e,UC)&&M(e,qz)&&M(e,xr)&&M(e,iz)},new Q(null,1,5,S,[Jp],null),new Q(null,5,5,S,[VE,sC,pp,$C,Av],null),null,new Q(null,5,5,S,[X,UC,qz,xr,iz],null),new Q(null,1,5,S,[ym],null),new Q(null,6,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,X)),N(V,new Q(null,1,5,S,[W],null),N(U,W,UC)),N(V,new Q(null,1,5,S,[W],null),N(U,W,qz)),N(V,new Q(null,1,5,S,[W],null),N(U,W,xr)),N(V,new Q(null,1,5,S,[W],null),N(U,W,iz))],null),null]))})),Z(Wq,N(xy,pm),aQ(pm,pm,new k(null,4,[Rv,!0,Fo,null,tD,N(xy,pm),Jz,function(e){return Fe(e)}],null),null)),Z(Uq,sw,sw),uQ.C(null,yx,(function(){return ZP(new Q(null,2,5,S,[Ql,N(eD,T,new Q(null,2,5,S,[Wq,Uq],null))],null),new Q(null,2,5,S,[Ql,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[Wq,Uq],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,iv)},function(e){return M(e,mx)}],null),function(e){return J(e)&&M(e,iv)&&M(e,mx)},F,new Q(null,2,5,S,[Wq,Uq],null),null,new Q(null,2,5,S,[iv,mx],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,iv)),N(V,new Q(null,1,5,S,[W],null),N(U,W,mx))],null),null]))],null),null)})),uQ.C(null,Sn,(function(){return ZP(new Q(null,2,5,S,[Ql,N(eD,T,new Q(null,1,5,S,[Ps],null))],null),new Q(null,2,5,S,[Ql,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,1,5,S,[Ps],null),null,null,new Q(null,2,5,S,[function(e){return J(e)},function(e){return M(e,Rt)}],null),function(e){return J(e)&&M(e,Rt)},F,new Q(null,1,5,S,[Ps],null),null,new Q(null,1,5,S,[Rt],null),F,new Q(null,2,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt))],null),null]))],null),null)})),Z(Nz,jB,jB),Z(Ps,zC,zC),uQ.C(null,fr,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[Nz,Ps,lw],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[Nz,Ps,lw],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,UB)},function(e){return M(e,Rt)},function(e){return M(e,Yo)}],null),function(e){return J(e)&&M(e,UB)&&M(e,Rt)&&M(e,Yo)},F,new Q(null,3,5,S,[Nz,Ps,lw],null),null,new Q(null,3,5,S,[UB,Rt,Yo],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,UB)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Yo))],null),null]))],null),null)})),uQ.C(null,eq,(function(){return ZP(new Q(null,2,5,S,[Ql,N(eD,T,new Q(null,2,5,S,[Ps,bq],null))],null),new Q(null,2,5,S,[Ql,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,2,5,S,[Ps,bq],null),null,null,new Q(null,3,5,S,[function(e){return J(e)},function(e){return M(e,Rt)},function(e){return M(e,Fw)}],null),function(e){return J(e)&&M(e,Rt)&&M(e,Fw)},F,new Q(null,2,5,S,[Ps,bq],null),null,new Q(null,2,5,S,[Rt,Fw],null),F,new Q(null,3,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Fw))],null),null]))],null),null)})),Z(GB,jB,jB),uQ.C(null,Bq,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[GB,Ps,gm],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[GB,Ps,gm],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,ko)},function(e){return M(e,Rt)},function(e){return M(e,fG)}],null),function(e){return J(e)&&M(e,ko)&&M(e,Rt)&&M(e,fG)},F,new Q(null,3,5,S,[GB,Ps,gm],null),null,new Q(null,3,5,S,[ko,Rt,fG],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,ko)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,fG))],null),null]))],null),null)})),uQ.C(null,Hv,(function(){return ZP(new Q(null,2,5,S,[Ko,N(eD,T,new Q(null,3,5,S,[Ps,XB,uB],null))],null),new Q(null,2,5,S,[Ko,QP(Ri([T,dD,Cz,AB,KD,Np,mm,Zn,rE,AE,$p,BA],[new Q(null,3,5,S,[Ps,XB,uB],null),null,null,new Q(null,4,5,S,[function(e){return J(e)},function(e){return M(e,Rt)},function(e){return M(e,pE)},function(e){return M(e,In)}],null),function(e){return J(e)&&M(e,Rt)&&M(e,pE)&&M(e,In)},F,new Q(null,3,5,S,[Ps,XB,uB],null),null,new Q(null,3,5,S,[Rt,pE,In],null),F,new Q(null,4,5,S,[N(V,new Q(null,1,5,S,[W],null),N(Wu,W)),N(V,new Q(null,1,5,S,[W],null),N(U,W,Rt)),N(V,new Q(null,1,5,S,[W],null),N(U,W,pE)),N(V,new Q(null,1,5,S,[W],null),N(U,W,In))],null),null]))],null),null)}));var c1=Ag(t0,"global"),d1=Ag(D0,"global"),e1=Ag(G0,"global"),f1=Ag(y0,"global"),g1=Ag(J0,"global"),h1=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.domains.global.core","handle-request"),(function(e,t,n){return X.g(n)}),i,e,t,n,r)}();function i1(e,t,r,i,o){var l=bg(o),s=u.h(l,$s);l=u.h(l,Ro);try{return h1.oa(i,s,l,e,t,r)}catch(e){if(e instanceof Error){var a=e;return n(el(a))||yS(Cx,"gateway.domains.global.core",426,lE,new qk((function(){return new Q(null,3,5,S,[a,"Error processing message",o],null)})),1315495637),new Q(null,2,5,S,[i,new Q(null,1,5,S,[wI.O("global",s,UC.h(l,-1),pG.g(l),iI(a,"global.errors.failure"))],null)],null)}throw e}}function j1(e){this.Ue=new k(null,1,[hE,"127.0.0.1"],null),this.Ag=e,this.configuration=null}function k1(e,t){return af((function(e,n,r){return!yb(xY(r,u.h(t,n)))||Td(!1)}),!0,e)}function l1(e,t,r){var i=Nb.j((function(e,i){return n(k1(cG.g(i),t))?n(yY(dh.h(i,new Q(null,2,5,S,[ss,NF],null)),r))?Td(!1):n(e)?e:yY(dh.h(i,new Q(null,2,5,S,[ss,cs],null)),r):e}),null,bw.g(e));if(null!=i)return i;switch((e=Su.g(e))instanceof w?e.W:null){case"whitelist":default:return!0;case"blacklist":return!1}}function m1(e){if(null!=e&&null!=e.bh)e=e.bh(e);else{var t=m1[ba(null==e?null:e)];if(null!=t)e=t.g?t.g(e):t.call(null,e);else{if(null==(t=m1._))throw Eb("Repository.start!",e);e=t.g?t.g(e):t.call(null,e)}}return e}function n1(e){if(null!=e&&null!=e.dh)e.dh(e);else{var t=n1[ba(null==e?null:e)];if(null!=t)t.g?t.g(e):t.call(null,e);else{if(null==(t=n1._))throw Eb("Repository.stop!",e);t.g?t.g(e):t.call(null,e)}}}function o1(e,t){if(null!=e&&null!=e.$g)e=e.$g(e,t);else{var n=o1[ba(null==e?null:e)];if(null!=n)e=n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=o1._))throw Eb("Repository.add!",e);e=n.h?n.h(e,t):n.call(null,e,t)}}return e}function p1(e,t){if(null!=e&&null!=e.ah)e.ah(e,t);else{var n=p1[ba(null==e?null:e)];if(null!=n)n.h?n.h(e,t):n.call(null,e,t);else{if(null==(n=p1._))throw Eb("Repository.publish!",e);n.h?n.h(e,t):n.call(null,e,t)}}}function q1(e,t){if(null!=e&&null!=e.eh)e=e.eh(e,t,null);else{var n=q1[ba(null==e?null:e)];if(null!=n)e=n.j?n.j(e,t,null):n.call(null,e,t,null);else{if(null==(n=q1._))throw Eb("RepositoryFactory.repository",e);e=n.j?n.j(e,t,null):n.call(null,e,t,null)}}return e}function T3(e){if(null!=e&&null!=e.Ki)e.Ki(e);else{var t=T3[ba(null==e?null:e)];if(null!=t)t.g?t.g(e):t.call(null,e);else{if(null==(t=T3._))throw Eb("RepositoryFactory.shutdown",e);t.g?t.g(e):t.call(null,e)}}}h1.C(null,Nm,(function(e,t,n,r){return b1(e,t,n,r,Cv.g(e))})),h1.C(null,qt,(function(e,t,r){if(yI(t))t=Y0(e,t,r);else{var i=bg(r),o=u.h(i,pG),l=u.h(i,xz);i=u.h(i,Vt),n(l=sI(e,l))?(o=G(e=NQ(e,t,o,Uz.g(r),null,i),0,null),G(e,1,null),t=DQ(l,o,new k(null,3,[ut,jD,$s,t,Ro,I.j(r,X,OG)],null))):t=null}return t})),h1.C(null,Pz,(function(e,t,r){if(yI(t)){var i=bg(r),o=u.h(i,UC),l=u.h(i,pG);if(i=u.h(i,xz),n(FQ.h(e,l))){var s=sI(e,i);e=n(s)?DQ(s,e,new k(null,3,[ut,gz,$s,t,Ro,I.j(r,X,mv)],null)):new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("global",t,o,l,lI("global.errors.invalid_domain",["Unable to leave missing domain ",p.g(i)].join("")))],null)],null)}else e=new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("global",t,o,l,lI("global.errors.invalid_peer",["Unable to find peer with id ",p.g(l)].join("")))],null)],null)}else l=bg(r),o=u.h(l,pG),l=u.h(l,xz),n(FQ.h(e,o))?e=n(o=sI(e,l))?DQ(o,e,new k(null,3,[ut,gz,$s,t,Ro,I.j(r,X,mv)],null)):null:e=null;return e})),h1.C(null,an,(function(e,t,n,r,i,o){return $0(e,t,n,i,o)})),h1.C(null,Ft,(function(e,t,n){var r=bg(n);return n=u.h(r,Ar),r=u.h(r,UC),new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("global",t,r,null,hI("global.errors.authentication.failure",n))],null)],null)})),h1.C(null,tE,(function(e,t,n){var r=bg(n);return n=u.h(r,UC),r=u.h(r,du),new Q(null,2,5,S,[e,new Q(null,1,5,S,[tI(t,new k(null,4,[wu,"global",X,oF,UC,n,du,r],null))],null)],null)})),h1.C(null,Qu,(function(e,t,n){return d1(e,t,n)})),h1.C(null,MF,(function(e,t,n){return c1(e,t,n)})),h1.C(null,lu,(function(e,t,n){return f1(e,t,n)})),h1.C(null,xs,(function(e,t,n){return g1(e,t,n)})),h1.C(null,Ho,(function(e,t,n){return e1(e,t,n)})),h1.C(null,my,(function(e){return new Q(null,1,5,S,[e],null)})),h1.C(null,zB,(function(e,t,n){return a1(e,t,n)})),h1.C(null,ZC,(function(e,t,r,i,o){i=bg(r),r=u.h(i,UC);var l=GQ(e,i=u.h(i,pG)),s=S,a=S;e:{var c=wU;wU=N0(o);try{var h=Uz.g(l),d=SH()+wU,f=new k(null,2,[X,du,xr,xr.g(h)],null),p=n(d)?I.j(f,Rl,kf(d,1e3)):f,g=vU(p,ho.g(e));break e}finally{wU=c}g=void 0}return new Q(null,2,5,s,[e,new Q(null,1,5,a,[tI(t,new k(null,5,[wu,"global",X,Ol,UC,r,pG,i,Ol,g],null))],null)],null)})),h1.C(null,Zk,(function(e,t,n){return yS(Cx,"gateway.domains.global.core",410,lE,new qk((function(){return new Q(null,2,5,S,["Unhandled message",n],null)})),-107392902),new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("global",t,UC.h(n,-1),pG.g(n),lI("global.errors.unhandled_message",["Unhandled message ",p.g(n)].join("")))],null)],null)})),j1.prototype.Yc=function(){return new k(null,3,[GC,"global",pr,"",bD,1],null)},j1.prototype.Zc=function(e,t){return t},j1.prototype.Wc=function(e,t){return t},j1.prototype.Xc=function(e,t,n){return i1(this.Ag,this.configuration,this.Ue,t,n)};var r1=new uj(null,new k(null,3,[Xt,null,oE,null,Wv,null],null),null);function s1(e){var t=vg((function(t){var n=!M(e,t);return n?t:n}),r1);n(t)&&jI("metrics.errors.bad_identity",["Repository is missing required ",p.g(t)," property"].join(""))}function t1(e,t){var n=kt.g(t);if(z(t=dh.h(t,new Q(null,2,5,S,[Ou,Gv],null)))){yS(pD,"gateway.domains.metrics.core",72,lE,new qk((function(){return new Q(null,2,5,S,["stopping metrics publishing for peer",n],null)})),-1708796740),t=z(t);for(var r=null,i=0,o=0;;)if(o<i){n1(r.$(null,o)),o+=1}else{if(!(t=z(t)))break;Me(r=t)?(t=ed(r),o=fd(r),r=t,i=C(t),t=o):(n1(t=A(r)),t=B(r),r=null,i=0),o=0}}return oI(e,n,Ou)}function u1(e,t,n){var r=bg(n),i=u.h(r,UC);return e=t1(e,GQ(e,r=u.h(r,pG)),kI(n)),new Q(null,2,5,S,[e,new Q(null,1,5,S,[xI.F("metrics",t,i,r)],null)],null)}function v1(e){return af((function(e,t,n){return I.j(e,t,w1.g?w1.g(n):w1.call(null,n))}),P,e)}function w1(e){return af((function(e,t,n){return t=Bf.g(t),I.j(e,t,x.h(t,vy)?v1(n):n)}),P,e)}function x1(e,t,r){var i=dh.h(r,new Q(null,2,5,S,[Ou,Gv],null));if(n(i))return new Q(null,2,5,S,[e,i],null);i=kt.g(r);var o=dh.h(r,new Q(null,2,5,S,[Ou,Dp],null));return t=Oj(Ng.h((function(e){return m1(q1(e,o))}),t)),new Q(null,2,5,S,[eh(e,new Q(null,4,5,S,[wG,i,Ou,Gv],null),t),t],null)}function y1(e,t,n,r){var i=bg(t);t=u.h(i,pG),i=u.h(i,ss);var o=GQ(e,t),l=dh.h(o,new Q(null,2,5,S,[Ou,Dp],null)),s=Xg.h((function(e){return l1(r,l,Yo.g(e))}),Ng.h(w1,i));return z(s)?(yS(it,"gateway.domains.metrics.core",130,lE,new qk((function(){return new Q(null,4,5,S,["publisher",l,"adding metrics",Ng.h(Yo,s)],null)})),-1418276318),e=G(n=x1(e,n,o),0,null),z(n=G(n,1,null))?new Q(null,2,5,S,[eh(e,new Q(null,4,5,S,[wG,t,Ou,Gv],null),Oj(Ng.h((function(e){return o1(e,s)}),n))),null],null):null):null}function z1(e,t,r){var i=bg(t);t=u.h(i,pG),i=u.h(i,sF),t=GQ(e,t);var o=dh.h(t,new Q(null,2,5,S,[Ou,Dp],null));if(!z(e=Xg.h((function(e){return l1(r,o,Yo.g(e))}),Ng.h(aI,i))))return null;if(!n(t=dh.h(t,new Q(null,2,5,S,[Ou,Gv],null))))return null;t=z(t),i=null;for(var l=0,s=0;;)if(s<l){var a=i.$(null,s);p1(a,e),s+=1}else{if(!(t=z(t)))return null;Me(i=t)?(t=ed(i),l=fd(i),i=t,a=C(t),t=l,l=a):(p1(a=A(i),e),t=B(i),i=null,l=0),s=0}}function A1(e,t){return yS(it,"gateway.domains.metrics.core",154,lE,new qk((function(){return new Q(null,2,5,S,["removing source",t],null)})),-2114275704),e=Nb.j((function(e,t){return t1(e,t)}),e,MQ(e,t,Ou)),new Q(null,2,5,S,[e,null],null)}var B1=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.domains.metrics.core","handle-request"),function(){function e(e,t,n,r){if(3<arguments.length)for(var i=0,o=Array(arguments.length-3);i<o.length;)o[i]=arguments[i+3],++i;return X.g(n)}return e.I=3,e.J=function(e){A(e),A(e=B(e));var t=A(e=B(e));return Hd(e),X.g(t)},e.l=function(e,t,n){return X.g(n)},e}(),i,e,t,n,r)}();function C1(e,t,n){this.Ue=e,this.$h=t,this.filters=n}function D1(e,t){var n=E1;return yS(it,"gateway.domains.metrics.core",228,lE,new qk((function(){return new Q(null,2,5,S,["initializing metrics domain with filters",t],null)})),555140773),new C1(n,e,t)}function F1(e,t){return yS(it,"gateway.domains.bus.core",53,lE,new qk((function(){return new Q(null,2,5,S,["removing source",t],null)})),83980188),e=Nb.j((function(e,t){return oI(e,em.g(t),tF)}),e,MQ(e,t,tF)),new Q(null,2,5,S,[e,null],null)}function G1(e){return Wg((function(e){var t=G(e,0,null);return e=G(e,1,null),Ng.j((function(e,t){return new k(null,2,[qy,e,Xw,t],null)}),Sg(t),e)}),D([Ng.h((function(e){return new Q(null,2,5,S,[e,dh.h(e,new Q(null,2,5,S,[tF,Ey],null))],null)}),e)]))}function H1(e,t,r){G(r,0,null);var i=bg(r=G(r,1,null)),o=u.h(i,ND);return e=n(i=u.h(i,xp))?Pj(i,e):x.h(o,e),n(e)?t=yb(e=pn.g(r))||yb(t)||x.h(e,t):t=e,t}function I1(e,t){var n=Uz.g(t);return af((function(e,t,r){return!!x.h(u.h(n,t),r)||Td(!1)}),!0,e)}function J1(e,t,i){var o=Fw.g(t);if(n(o)){var l=bg(t),s=u.h(l,ND),a=u.h(l,yz),c=u.h(l,pG);l=u.h(l,Tr);var h=Bg(H1,s,a);s=Ag(I1,HT(l));var d=Uz.g(i),f=new Lg(wj);return i=Nb.j((function(i,l){l=bg(l);var s=u.h(l,qy),a=u.h(l,Xw);return l=$s.g(s),s=kt.g(s),yI(l)?(a=A(a),l=tI(l,new k(null,6,[wu,"bus",X,gy,pG,s,qD,a,Vp,d,Fw,o],null))):x.h(c,s)?l=null:(l=zt.g(l),M(r(f),l)?l=null:(f.ld(null,re.h(f.Jb(null),l)),l=vI(MY(cI(pq.g(e)),c),new k(null,2,[X,zt,zt,l],null),t))),n(l)?re.h(i,l):i}),F,Xg.h((function(e){return h(Xw.g(e))}),G1(Xg.h(s,TQ(e,tF,i,!0))))),new Q(null,2,5,S,[e,i],null)}return null}function K1(e,t,n,r){var i=bg(t),o=u.h(i,ND),l=u.h(i,yz),s=u.h(i,UC);i=u.h(i,pG);var a=$s.g(r),c=new Q(null,3,5,S,[tF,Ey,n],null);return l=new k(null,2,[ND,o,pn,l],null),o=-1!=o.indexOf(">")||-1!=o.indexOf("*")?I.j(l,xp,Sj(QI(QI(QI(o,".","\\."),"*","[a-zA-Z_0-9]+"),">",".*"))):l,r=eh(r,c,o),new Q(null,2,5,S,[PQ(e,i,r),yI(a)?new Q(null,2,5,S,[tI(a,new k(null,5,[wu,"bus",X,Zo,UC,s,pG,i,qD,n],null)),uI(MY(cI(pq.g(e)),i),I.j(t,qD,n))],null):null],null)}function L1(e,t,n){var r=bg(t),i=u.h(r,UC),o=u.h(r,pG),l=u.h(r,qD);return r=$s.g(n),n=fh.F(n,new Q(null,2,5,S,[tF,Ey],null),we,l),new Q(null,2,5,S,[PQ(e,o,n),yI(r)?new Q(null,2,5,S,[xI.F("bus",r,i,o),uI(MY(cI(pq.g(e)),o),t)],null):null],null)}B1.C(null,OG,function(){function e(e,n,r,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return t.call(this,e,n,r,o)}function t(e,t,r,i){i=bg(i);var o=u.h(i,Dw),l=bg(r);r=u.h(l,UC),i=u.h(l,pG);var s=u.h(l,Uz);l=u.h(l,Vt);var a=pj.l,c=Ay.g(s);return n(c)||(c=n(c=KT(yv.g(t),hE.g(o)))?c:"127.0.0.1"),o=new k(null,6,[Ay,c,Xn,Xn.g(o),dB,(new Date).getTime(),vs,vs.g(o),oE,oE.g(s),Xt,FE.g(s)],null),o=a.call(pj,D([o,aI(l),aI(s)])),n(pI(e,i,Ou))||(s1(o),e=eh(nI(e,i,Ou,null),new Q(null,4,5,S,[wG,i,Ou,Dp],null),o)),t=new Q(null,2,5,S,[e,new Q(null,1,5,S,[xI.F("metrics",t,r,i)],null)],null)}return e.I=3,e.J=function(e){return t(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},e.l=t,e}()),B1.C(null,mv,function(){function e(e,t,n,r){if(3<arguments.length)for(var i=0,o=Array(arguments.length-3);i<o.length;)o[i]=arguments[i+3],++i;return u1(e,t,n)}return e.I=3,e.J=function(e){var t=A(e),n=A(e=B(e)),r=A(e=B(e));return Hd(e),u1(t,n,r)},e.l=function(e,t,n){return u1(e,t,n)},e}()),B1.C(null,zB,function(){function e(e,t,n,r){if(3<arguments.length)for(var i=0,o=Array(arguments.length-3);i<o.length;)o[i]=arguments[i+3],++i;return A1(e,t)}return e.I=3,e.J=function(e){var t=A(e),n=A(e=B(e));return A(e=B(e)),Hd(e),A1(t,n)},e.l=function(e,t){return A1(e,t)},e}()),B1.C(null,Rm,function(){function e(e,n,r,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return t.call(this,e,n,r,o)}function t(e,t,n,r){return r=bg(r),y1(e,n,u.h(r,LB),r=u.h(r,eC))}return e.I=3,e.J=function(e){var n=A(e);A(e=B(e));return t(n,0,A(e=B(e)),e=Hd(e))},e.l=t,e}()),B1.C(null,wm,function(){function e(e,n,r,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return t.call(this,e,n,r,o)}function t(e,t,n,r){return t=bg(r),z1(e,n,t=u.h(t,eC))}return e.I=3,e.J=function(e){return t(A(e),A(e=B(e)),A(e=B(e)),e=Hd(e))},e.l=t,e}()),B1.C(null,Zk,function(){function e(e,n,r,i){var o=null;if(3<arguments.length){o=0;for(var l=Array(arguments.length-3);o<l.length;)l[o]=arguments[o+3],++o;o=new Fd(l,0,null)}return t.call(this,e,n,r,o)}function t(e,t,n){return yS(Cx,"gateway.domains.metrics.core",185,lE,new qk((function(){return new Q(null,2,5,S,["Unhandled message",n],null)})),-666006089),new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("metrics",t,UC.h(n,-1),pG.g(n),lI("metrics.errors.unhandled_message",["Unhandled message ",p.g(n)].join("")))],null)],null)}return e.I=3,e.J=function(e){var n=A(e),r=A(e=B(e)),i=A(e=B(e));return e=Hd(e),t(n,r,i)},e.l=t,e}()),C1.prototype.Yc=function(){return new k(null,3,[GC,"metrics",pr,"",bD,1],null)},C1.prototype.Zc=function(e,t){return t},C1.prototype.Wc=function(e,t){return Nb.j((function(e,t){return t1(e,t)}),t,JQ(t,Ou))},C1.prototype.Xc=function(e,t,r){var i=bg(r);e=u.h(i,$s),i=u.h(i,Ro);try{return B1.ab(t,e,i,Dw,this.Ue,LB,this.$h,eC,this.filters)}catch(l){var o=l;return n(el(o))||yS(Cx,"gateway.domains.metrics.core",218,lE,new qk((function(){return new Q(null,3,5,S,[o,"Error processing message",r],null)})),1651183211),new Q(null,2,5,S,[t,new Q(null,1,5,S,[wI.O("metrics",e,UC.g(i),pG.g(i),iI(o,"metrics.errors.failure"))],null)],null)}};var M1=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.domains.bus.core","handle-request"),(function(e,t,n){return X.g(n)}),i,e,t,n,r)}();function N1(){}M1.C(null,OG,(function(e,t,r){if(yI(t)){var i=bg(r),o=u.h(i,UC),l=u.h(i,pG);if(u.h(i,Uz),i=u.h(i,Gp),n(pI(e,l,tF)))e=new Q(null,2,5,S,[e,new Q(null,1,5,S,[xI.F("bus",t,o,l)],null)],null);else{i=nI(e,l,tF,gP(i));var s=FQ.h(i,l),a=S,c=S;t=xI.F("bus",t,o,l),e=MY(cI(pq.g(e)),l),r=I.j(r,X,qt),e=new Q(null,2,5,a,[i,new Q(null,2,5,c,[t,uI(e,r=n(Vt.g(s))?I.j(r,Vt,Vt.g(s)):r)],null)],null)}}else i=bg(r),r=u.h(i,pG),i=u.h(i,Gp),e=n(pI(e,r,tF))?null:new Q(null,2,5,S,[nI(e,r,tF,gP(i)),null],null);return e})),M1.C(null,mv,(function(e,t,r){if(yI(t)){var i=bg(r),o=u.h(i,UC),l=oI(e,i=u.h(i,pG),tF);e=new Q(null,2,5,S,[l,new Q(null,2,5,S,[xI.F("bus",t,o,i),uI(MY(cI(pq.g(e)),i),I.j(r,X,Pz))],null)],null)}else t=bg(r),t=u.h(t,pG),e=n(r=FQ.h(e,t))?new Q(null,2,5,S,[oI(e,t,tF),null],null):null;return e})),M1.C(null,wm,(function(e,t,r){return yI(t)?e=n(t=GQ(e,t=pG.g(r)))?J1(e,r,t):null:(t=pG.g(r),e=n(t=FQ.h(e,t))?J1(e,r,t):null),e})),M1.C(null,Sl,(function(e,t,r){if(yI(t)){var i=dI(pq.g(e));t=G(i,0,null),i=G(i,1,null);var o=pG.g(r);o=HQ(e,o,tF),e=K1(I.j(e,pq,t),r,i,o)}else i=bg(r),t=u.h(i,qD),i=u.h(i,pG),e=n(i=FQ.j(e,i,tF))?K1(e,r,t,i):null;return e})),M1.C(null,fB,(function(e,t,r){return yI(t)?e=L1(e,r,t=HQ(e,pG.g(r),tF)):e=n(t=FQ.h(e,pG.g(r)))?L1(e,r,t):null,e})),M1.C(null,zB,(function(e,t){return F1(e,t)})),M1.C(null,Zk,(function(e,t,n){return yS(Cx,"gateway.domains.bus.core",306,lE,new qk((function(){return new Q(null,2,5,S,["Unhandled message",n],null)})),-1875473934),new Q(null,2,5,S,[e,new Q(null,1,5,S,[wI.O("bus",t,UC.h(n,-1),pG.g(n),lI("bus.errors.unhandled_message",["Unhandled message ",p.g(n)].join("")))],null)],null)})),N1.prototype.Yc=function(){return new k(null,3,[GC,"bus",pr,"",bD,1],null)},N1.prototype.Zc=function(e,t){return t},N1.prototype.Wc=function(e,t){return t},N1.prototype.Xc=function(e,t,r){var i=bg(r);e=u.h(i,$s),i=u.h(i,Ro);try{return M1.j(t,e,i)}catch(l){var o=l;return n(el(o))||yS(Cx,"gateway.domains.bus.core",342,lE,new qk((function(){return new Q(null,3,5,S,[o,"Error processing message",r],null)})),-1963062850),new Q(null,2,5,S,[t,new Q(null,1,5,S,[wI.O("bus",e,UC.g(i),pG.g(i),iI(o,"bus.errors.failure"))],null)],null)}},i0("context");var O1=hI("context.peer-removed","Peer has been removed"),P1=Ag(xI,"context"),Q1=Ag(wI,"context"),R1=Ag(t0,"context"),S1=Ag(D0,"context"),T1=Ag(G0,"context"),U1=Ag(y0,"context"),V1=Ag(J0,"context"),W1=Ag((function(e,t,r,i,o){var l=Ag(H0,e);return e=G(t=VQ(e,Yp,t,r,i,o),0,null),t=G(t,1,null),t=Xg.h(Ag(L0,e),t),e=G(t=new Q(null,2,5,S,[e,t],null),0,null),t=G(t,1,null),r=G(l=l(e,r),0,null),l=G(l,1,null),new Q(null,2,5,S,[n(r)?r:e,Qe(l)||Le(l)?Nb.j(Dg(re,F),t,l):null!=l?Dg(re,F)(t,l):t],null)}),"context");function X1(e,t,r,i){var o=HQ(e,r,Yp),l=function(){var l=Xg.h(Ag(L0,e),UQ("context",Yp,e,t,o));return n(i)?Yg.h((function(e){return x.h(r,Fr.g(Ro.g(e)))}),l):l}();return Eh(Of.h(l,yb(i)?K0(q0(o),e,o):Id))}function Y1(e,t,r,i,o){var l=gP(i);return i=function(){var t=nI(e,r,Yp,l);return n(o)?QQ(t,r,(function(e){return TH(e,new Q(null,2,5,S,[Vt,Sp],null))})):t}(),new Q(null,2,5,S,[i,X1(i,t,r,o)],null)}function Z1(e,t,r){var i=bg(r),o=u.h(i,UC),l=u.h(i,pG);u.h(i,Uz),i=u.h(i,Gp);var s,a=dh.h(r,new Q(null,2,5,S,[Vt,Sp],null)),c=null==(s=null==(s=FQ.h(e,l))?null:Vt.g(s))?null:Sp.g(s),h=pI(e,l,Yp);if(n(n(h)?yb(c):h))return new Q(null,2,5,S,[e,new Q(null,1,5,S,[P1(t,o,l)],null)],null);c=G(i=Y1(e,t,l,i,n(h)?c:h),0,null);var d=G(i,1,null),f=FQ.h(c,l);return new Q(null,2,5,S,[c,function(){var i=re.h,s=MY(cI(pq.g(e)),l),u=I.j(r,X,qt);return u=n(Vt.g(f))?I.j(u,Vt,Vt.g(f)):u,i=i.call(re,d,uI(s,u)),yb(a)?re.h(i,P1(t,o,l)):i}()],null)}function $1(e,t,r){r=bg(r);var i=u.h(r,pG);u.h(r,Uz),r=u.h(r,Gp);var o,l=null==(o=null==(o=FQ.h(e,i))?null:Vt.g(o))?null:Sp.g(o);return n(function(){var t=yb(l);return t?pI(e,i,Yp):t}())?null:Y1(e,t,i,r,l)}function a2(e,t){yS(it,"gateway.domains.context.core",124,lE,new qk((function(){return new Q(null,1,5,S,["removing source from the context domain"],null)})),-354290208),t=tg(MQ(e,t,Yp)),e=ef(Ng.g(kt),cf((function(e,t){return oI(e,t,Yp)}),bf),e,t);var r=new k(null,6,[UC,null,wu,"global",X,Pz,xz,"context",pE,O1.uri,In,O1.message],null);return e=Nb.j((function(e,t){var i=G(e,0,null);e=G(e,1,null);var o=W1(i,t,O1,!0),l=G(o,0,null);return o=G(o,1,null),i=G(e=new Q(null,2,5,S,[n(l)?l:i,Qe(o)||Le(o)?Nb.j(Dg(re,F),e,o):null!=o?Dg(re,F)(e,o):e],null),0,null),e=G(e,1,null),t=G(l=new Q(null,2,5,S,[i,uI(MY(cI(pq.g(i)),kt.g(t)),I.j(r,pG,kt.g(t)))],null),0,null),l=G(l,1,null),new Q(null,2,5,S,[n(t)?t:i,Qe(l)||Le(l)?Nb.j(Dg(re,F),e,l):null!=l?Dg(re,F)(e,l):e],null)}),new Q(null,2,5,S,[e,null],null),t),yS(it,"gateway.domains.context.core",144,lE,new qk((function(){return new Q(null,1,5,S,["removed source from context domain"],null)})),1125663545),e}var b2=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.domains.context.core","handle-request"),(function(e,t,n){return X.g(n)}),i,e,t,n,r)}();function c2(e,t){var r=bg(t),i=u.h(r,$s);r=u.h(r,Ro);try{return b2.j(e,i,r)}catch(l){var o=l;return n(el(o))||yS(Cx,"gateway.domains.context.core",226,lE,new qk((function(){return new Q(null,3,5,S,[o,"Error handling request",t],null)})),-416825199),yI(i)?new Q(null,2,5,S,[e,new Q(null,1,5,S,[Q1(i,UC.g(r),pG.g(r),iI(o,"context.errors.failure"))],null)],null):null}}function d2(){}b2.C(null,OG,(function(e,t,n){return yI(t)?Z1(e,t,n):$1(e,t,n)})),b2.C(null,mv,(function(e,t,r){if(yI(t)){var i=bg(r),o=u.h(i,UC);i=u.h(i,pG);var l=W1(e,GQ(e,i),kI(r),!1),s=G(l,0,null);l=G(l,1,null),e=new Q(null,2,5,S,[s,re.l(l,P1(t,o,i),D([uI(MY(cI(pq.g(e)),i),I.j(r,X,Pz))]))],null)}else t=bg(r),t=u.h(t,pG),e=n(t=FQ.h(e,t))?W1(e,t,kI(r),!1):null;return e})),b2.C(null,Qu,(function(e,t,n){return S1(e,t,n)})),b2.C(null,MF,(function(e,t,n){return R1(e,t,n)})),b2.C(null,lu,(function(e,t,n){return U1(e,t,n)})),b2.C(null,xs,(function(e,t,n){return V1(e,t,n)})),b2.C(null,Ho,(function(e,t,n){return T1(e,t,n)})),b2.C(null,zB,(function(e,t){return a2(e,t)})),b2.C(null,Zk,(function(e,t,n){return yS(Cx,"gateway.domains.context.core",209,lE,new qk((function(){return new Q(null,2,5,S,["Unhandled message",n],null)})),1462882945),new Q(null,2,5,S,[e,new Q(null,1,5,S,[Q1(t,UC.h(n,-1),pG.g(n),lI([p.g("context"),".errors.unhandled_message"].join(""),["Unhandled message ",p.g(n)].join("")))],null)],null)})),d2.prototype.Yc=function(){return new k(null,3,[GC,"context",pr,"",bD,2],null)},d2.prototype.Zc=function(e,t){return t},d2.prototype.Wc=function(e,t){return t},d2.prototype.Xc=function(e,t,n){return c2(t,n)};var e2=function(){var e=Fg(P),t=Fg(P),n=Fg(P),r=Fg(P),i=u.j(P,fu,Kk.A?Kk.A():Kk.call(null));return new Yk(Bd.h("gateway.basic-auth.core","authenticate"),(function(e){return dh.h(e,new Q(null,2,5,S,[du,fw],null))}),i,e,t,n,r)}();function f2(e,t){this.fi=e,this.gi=t}function g2(e,t){return new f2(e,t)}function h2(){var e=P;return yS(pD,"gateway.basic-auth.core",57,lE,new qk((function(){return new Q(null,2,5,S,["creating basic authenticator with configuration",e],null)})),-881256413),EU(e,g2(bI(),1e3*vw.h(e,6e4)))}function n3(e,t,r,i){yS(pD,"gateway.metrics.core.util",12,lE,new qk((function(){return new Q(null,5,5,S,["initializing batch with",t," batch size and",r,"batch interval"],null)})),460922689);var o=OH(i),l=t-1,s=OH(1);return sH((function(){var i,a=function(){function i(i){var s=i[1];if(7===s)return i[2]=i[2],i[1]=3,fv;if(20===s)return i[1]=23,fv;if(1===s){s=s2(r);var a=Xc(F);return i[7]=s,i[8]=a,i[2]=null,i[1]=2,fv}if(24===s)return i[2]=null,i[1]=25,fv;if(4===s){var u=i[7],c=i[8],h=i[2];s=G(h,0,null);var d=G(h,1,null);return a=C(c),u=x.h(d,u),i[9]=d,i[10]=h,i[11]=a,i[12]=s,i[1]=u?5:6,fv}return 15===s?(s=Zc(c=i[8]),t2(i,18,o,s)):21===s?(i[2]=i[2],i[1]=14,fv):13===s?(a=i[11],i[1]=n(a===l)?19:20,fv):22===s?(s=i[2],a=s2(r),u=Xc(F),i[13]=s,i[7]=a,i[8]=u,i[2]=null,i[1]=2,fv):6===s?(s=i[12],i[1]=n(null==s)?12:13,fv):25===s?(i[2]=i[2],i[1]=21,fv):17===s?(a=i[2],s=WG(o),i[14]=a,i[2]=s,i[1]=14,fv):3===s?NH(i,i[2]):12===s?(a=i[11],i[1]=n(0<a)?15:16,fv):2===s?(u=i[7],y2(i,4,new Q(null,2,5,S,[e,u],null))):23===s?(s=i[12],u=i[7],c=i[8],s=Pf.h(c,s),i[7]=u,i[8]=s,i[2]=null,i[1]=2,fv):19===s?(a=i[11],s=i[12],u=i[7],c=i[8],a=yS(Cy,"gateway.metrics.core.util",33,lE,new qk((function(){return new Q(null,2,5,S,["hit batch size",t],null)})),-144825985),s=Zc(s=Pf.h(c,s)),i[15]=a,t2(i,22,o,s)):11===s?(i[2]=i[2],i[1]=10,fv):9===s?(i[2]=null,i[1]=10,fv):5===s?(a=i[11],s=i[12],u=i[7],c=i[8],s=yS(Cy,"gateway.metrics.core.util",22,lE,new qk((function(){return new Q(null,1,5,S,["scheduled flush"],null)})),1156583871),i[16]=s,i[1]=n(0<a)?8:9,fv):14===s?(i[2]=i[2],i[1]=7,fv):16===s?(i[2]=null,i[1]=17,fv):10===s?(s=i[2],a=s2(r),u=Xc(F),i[7]=a,i[8]=u,i[17]=s,i[2]=null,i[1]=2,fv):18===s?(i[2]=i[2],i[1]=17,fv):8===s?(s=Zc(c=i[8]),t2(i,11,o,s)):null}return function(){function e(e){for(;;){e:try{for(;;){var t=i(e);if(!O(t,fv)){var n=t;break e}}}catch(t){if(n=t,e[2]=n,!z(e[4]))throw n;e[1]=A(e[4]),n=fv}if(!O(n,fv))return n}}function t(){var e=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];return e[0]=n,e[1]=1,e}var n=null;return n=function(n){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,n)}throw Error("Invalid arity: "+arguments.length)},n.A=t,n.g=e,n}()}();return LH(((i=a())[6]=s,i))})),o}function o3(e,t,n,r){return ze(new Q(null,2,5,S,[r,null],null),new k(null,3,[fY,e,xQ,t,Tz,n],null))}function p3(e){return e.g?e.g(0):e.call(null,0)}function q3(e){var t=p3(e);return(e=fY.g(Ae(e))).g?e.g(t):e.call(null,t)}function r3(e){var t=G(e,0,null),r=G(e,1,null),i=bg(r),o=u.h(i,DX);r=u.h(i,TX);var l=u.h(i,CX),s=u.h(i,BX);return i=u.h(i,gE),n(l)?(l=Be(l),n(i)?(i=S,t=Of.h(o,ke(t,s)),r=new Q(null,2,5,i,[t=(o=Tz.g(Ae(e))).h?o.h(l,t):o.call(null,l,t),n(r)?I.j(r,gE,!0):r],null)):r=new Q(null,2,5,S,[l,r],null),ze(r,Ae(e))):null}function s3(e){for(;;){if(x.h(Bn,e.g?e.g(1):e.call(null,1)))return p3(e);var t=r3(e);if(!n(t))return p3(e);e=t}}function t3(e){var t=G(e,0,null),r=G(e,1,null);r=bg(r);var i=u.h(r,DX),o=u.h(r,BX),l=z(o),s=A(l);return l=B(l),n(n(r)?o:r)?ze(new Q(null,2,5,S,[s,I.l(r,DX,re.h(i,t),D([BX,l]))],null),Ae(e)):null}function u3(e){for(var t=[],n=arguments.length,r=0;r<n;)t.push(arguments[r]),r+=1;return n=arguments[0],t=2<t.length?new Fd(t.slice(2),0,null):null,t=Yf(arguments[1],p3(n),t),G(n,0,null),r=G(n,1,null),ze(new Q(null,2,5,S,[t,I.j(r,gE,!0)],null),Ae(n))}function v3(e){if(x.h(Bn,e.g?e.g(1):e.call(null,1)))return e;var t=q3(e);if(n(t))if(n(q3(e))){t=G(e,0,null);var r=G(e,1,null);if(!n(q3(e)))throw"called children on a leaf node";var i=p3(e),o=xQ.g(Ae(e)),l=z(i=o.g?o.g(i):o.call(null,i));o=A(l),l=B(l),t=n(i)?ze(new Q(null,2,5,S,[o,new k(null,4,[DX,F,CX,n(r)?re.h(CX.g(r),t):new Q(null,1,5,S,[t],null),TX,r,BX,l],null)],null),Ae(e)):null}else t=null;if(n(t))return t;if(n(t=t3(e)))return t;for(;;){if(!n(r3(e)))return new Q(null,2,5,S,[p3(e),Bn],null);if(n(t=t3(r3(e))))return t;e=r3(e)}}function w3(e){return x.h(Bn,e.g?e.g(1):e.call(null,1))}function m3(e){return o3((function(e){return J(e)||J(ee(e,1))}),(function(e){return z(J(e)?e:ee(e,1))}),(function(e,t){return J(e)?ah.h(P,t):I.j(e,1,ah.h(P,t))}),e)}function x3(e,t){return s3(A(Xg.h(w3,tt((function(e){return v3(u3(e,(function(e){var r=G(e,0,null);return e=G(e,1,null),new Q(null,2,5,S,[r,n(t.g?t.g(r):t.call(null,r))?sQ:e],null)})))}),v3(m3(e))))))}function y3(e,t,n){e=z(e.g?e.g(n):e.call(null,n)),n=null;for(var r=0,i=0;;)if(i<r){var o=n.$(null,i);try{yS(Cy,"glue42.metrics.publisher.core",42,lE,new qk(function(e,t,n,r,i){return function(){return new Q(null,2,5,S,["publishing metrics",i],null)}}(0,0,0,0,o)),2041161085),null==rk.g(o)&&null==ss.g(o)&&null==CT.g(o)&&yS(tz,"glue42.metrics.publisher.core",44,lE,new qk(function(e,t,n,r,i){return function(){return new Q(null,2,5,S,["sending empty message to",Uz.g(i)],null)}}(0,0,0,0,o)),-1450430472),t.g?t.g(o):t.call(null,o)}catch(e){yS(tz,"glue42.metrics.publisher.core",47,lE,new qk(function(e,t,n,r,i,o){return function(){return new Q(null,3,5,S,[i,"Unable to send metrics message",o],null)}}(0,0,0,0,e,o)),1510270920)}i+=1}else{var l=z(e);if(!l)return null;var s=l;if(Me(s))e=ed(s),r=fd(s),n=e,s=C(e),e=r,r=s;else{o=A(s);try{yS(Cy,"glue42.metrics.publisher.core",42,lE,new qk(function(e,t,n,r,i){return function(){return new Q(null,2,5,S,["publishing metrics",i],null)}}(0,0,0,0,o)),380710774),null==rk.g(o)&&null==ss.g(o)&&null==CT.g(o)&&yS(tz,"glue42.metrics.publisher.core",44,lE,new qk(function(e,t,n,r,i){return function(){return new Q(null,2,5,S,["sending empty message to",Uz.g(i)],null)}}(0,0,0,0,o)),-795328914),t.g?t.g(o):t.call(null,o)}catch(e){yS(tz,"glue42.metrics.publisher.core",47,lE,new qk(function(e,t,n,r,i,o){return function(){return new Q(null,3,5,S,[i,"Unable to send metrics message",o],null)}}(0,0,0,0,e,o)),-830554498)}e=B(s),n=null,r=0}i=0}}function z3(e,t){e.finally(t)}function A3(e,t,r){var i=OH(1);return z3(sT(qT(r.g?r.g(Ku):r.call(null,Ku),(function(i){var o=OH(1);return sH((function(){var l,s=function(){function o(o){var l=o[1];return 1===l?(o[2]=null,o[1]=2,fv):2===l?MH(o,4,e):3===l?NH(o,o[2]):4===l?(l=o[2],o[7]=l,o[1]=n(l)?5:6,fv):5===l?(l=o[7],l=y3(t,r,l),o[8]=l,o[2]=null,o[1]=2,fv):6===l?(l=(l=r.g?r.g(Kv):r.call(null,Kv)).g?l.g(i):l.call(null,i),o[2]=l,o[1]=7,fv):7===l?(o[2]=o[2],o[1]=3,fv):null}return function(){function e(e){for(;;){e:try{for(;;){var t=o(e);if(!O(t,fv)){var n=t;break e}}}catch(t){if(n=t,e[2]=n,!z(e[4]))throw n;e[1]=A(e[4]),n=fv}if(!O(n,fv))return n}}function t(){var e=[null,null,null,null,null,null,null,null,null];return e[0]=n,e[1]=1,e}var n=null;return n=function(n){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,n)}throw Error("Invalid arity: "+arguments.length)},n.A=t,n.g=e,n}()}();return LH(((l=s())[6]=o,l))})),o})),(function(e){var t=OH(1);return sH((function(){var n,r=function(){function t(t){for(;;){e:try{for(;;){var n=t,r=n[1],o=1===r?t2(n,2,i,e):2===r?NH(n,n[2]):null;if(!O(o,fv)){var l=o;break e}}}catch(e){if(l=e,t[2]=l,!z(t[4]))throw l;t[1]=A(t[4]),l=fv}if(!O(l,fv))return l}}function n(){var e=[null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(e){switch(arguments.length){case 0:return n.call(this);case 1:return t.call(this,e)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=t,r}();return LH(((n=r())[6]=t,n))})),t})),WG(i)),i}function B3(e,t,r){yS(pD,"glue42.metrics.publisher.core",91,lE,new qk((function(){return new Q(null,2,5,S,["creating publisher with configuration\n",function(){var t=new Za,n=fb,r=eb;fb=!0,eb=function(e){return t.append(e)};try{MV(x3(e,(function(e){return Qj(/password/,Cf(e))})))}finally{eb=r,fb=n}return p.g(t)}()],null)})),934677226);var i=bg(e),o=u.h(i,UD);o=u.j(i,MA,1e4);var l,s=u.h(i,tQ),a=OH(new dZ(cH(i=n(l=o)?l:o),i));return C3(n3(a,function(){var e=SS.g(s);return n(e)?e:ET.h(s,0)}(),AH.h(s,1e3),new dZ(cH(i),i)),t,r),a}function C3(e,t,r){var i=OH(1);sH((function(){var o=function(){function i(i){var o=i[1];if(7===o)return o=i[7],i[2]=function(){return null},i[1]=8,fv;if(1===o)return o=i[8],i[8]=t,i[1]=n(t)?3:4,fv;if(4===o)return i[2]=bf,i[1]=5,fv;if(6===o)return o=i[7],i[2]=o,i[1]=8,fv;if(3===o)return o=i[8],i[2]=o,i[1]=5,fv;if(2===o){var l=i[9];return o=i[2],i[9]=o,i[1]=n(o)?9:10,fv}return 11===o?NH(i,i[2]):9===o?(l=i[9],o=yS(Cx,"glue42.metrics.publisher.core",108,lE,new qk(function(){var e=l;return function(){return new Q(null,2,5,S,[e,"Error in publisher"],null)}}()),626222098),i[2]=o,i[1]=11,fv):5===o?(o=i[7],o=i[2],i[7]=r,i[10]=o,i[1]=n(r)?6:7,fv):10===o?(i[2]=null,i[1]=11,fv):8===o?(o=i[10],MH(i,2,o=A3(e,o,i[2]))):null}return function(){function e(e){for(;;){e:try{for(;;){var t=i(e);if(!O(t,fv)){var n=t;break e}}}catch(t){if(n=t,e[2]=n,!z(e[4]))throw n;e[1]=A(e[4]),n=fv}if(!O(n,fv))return n}}function t(){var e=[null,null,null,null,null,null,null,null,null,null,null];return e[0]=n,e[1]=1,e}var n=null;return n=function(n){switch(arguments.length){case 0:return t.call(this);case 1:return e.call(this,n)}throw Error("Invalid arity: "+arguments.length)},n.A=t,n.g=e,n}()}(),l=function(){var e=o();return e[6]=i,e}();return LH(l)}))}function D3(e,t,r,i){return ef(Ng.g(aI),cf((function(e,i){var o=Yo.g(i),l=u.h(e,o);return n(l)||(l=yb(l=(l=null==t)?l:l1(t,r,o))),yb(l)?I.j(e,o,i):e}),bf),e,i)}function E3(e,t,n){return e=new k(null,2,[Uz,e,rk,t],null),null!=n?I.j(e,CT,n):e}function F3(e,t,n,r,i,o,l,s,a,u,c){this.uh=e,this.Ii=t,this.filters=n,this.Di=r,this.Hi=i,this.Fi=o,this.Gi=l,this.Ei=s,this.D=a,this.m=u,this.G=c,this.B=2230716170,this.M=139264}function H3(e,t){var i,o=Ig.h(e.Gi,(function(e){var r=pj.l(D([e,t])),i=cg.h(su.g(e),su.g(r)),o=we.h;return r=n(n(e=wQ.g(e))?e:i)?I.j(r,AX,uA.g(r)):r,o.call(we,r,wQ)}));if(n(n(i=e.uh)?n(i=r(e.Fi))?i:BT.g(t):i)){var l=E3(e.Di,we.h(o,BT),e.Hi),s=OH(1);sH((function(){var t,n=function(){function t(t){for(;;){e:try{for(;;){var n=t,r=n[1],i=1===r?t2(n,2,e.uh,l):2===r?NH(n,n[2]):null;if(!O(i,fv)){var o=i;break e}}}catch(e){if(o=e,t[2]=o,!z(t[4]))throw o;t[1]=A(t[4]),o=fv}if(!O(o,fv))return o}}function n(){var e=[null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(e){switch(arguments.length){case 0:return n.call(this);case 1:return t.call(this,e)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=t,r}();return LH(((t=n())[6]=s,t))}))}return e}function G3(e){return af((function(e,t,n){return I.j(e,t instanceof w?Cf(t):p.g(t),p.g(n))}),null,e)}function I3(e){return n(e)?(WG(e),QH((function(){return null}),e)):null}function J3(e,t){this.Qi=e,this.Tg=t}function K3(e,t){return new J3(t,e)}e2.C(null,"secret",(function(e,t,n){return qT(yT(e),(function(e){var r=vU(new k(null,2,[xr,xr.g(e),Rl,kf(SH()+n,1e3)],null),t);return I.j(e,Jp,r)}))})),e2.C(null,"access-token",(function(e,t){try{var n=dh.h(e,new Q(null,2,5,S,[du,Ol],null)),r=xr.g(uU.j(n,t,new k(null,1,[bv,kf(SH(),1e3)],null)));return nT.resolve(new k(null,4,[X,jC,iz,r,xr,r,Jp,n],null))}catch(e){var i=e;return yS(it,"gateway.basic-auth.core",37,lE,new qk((function(){return new Q(null,2,5,S,[i,"Error processing access token authentication request"],null)})),-914926200),nT.reject(cl(fl(i),new k(null,2,[X,gx,Ar,["Invalid or expired token: ",p.g(fl(i))].join("")],null)))}})),e2.C(null,Zk,(function(e){e=dh.h(e,new Q(null,2,5,S,[du,fw],null));var t=["Unknown authentication method ",p.g(e)].join("");return yS(it,"gateway.basic-auth.core",44,lE,new qk((function(){return new Q(null,1,5,S,[t],null)})),277736902),nT.reject(cl(t,new k(null,2,[X,gx,Ar,t],null)))})),f2.prototype.We=function(e,t){return e2.j(t,this.fi,this.gi)},h=F3.prototype,h.na=function(e,t){return this.P(null,t,null)},h.P=function(e,t,n){switch(t instanceof w?t.W:null){case"publisher":return this.uh;case"metrics":return this.Ii;case"filters":return this.filters;case"repo-id":return this.Di;case"metadata":return this.Hi;case"running":return this.Fi;case"latest-status":return this.Gi;case"heartbeat-interval":return this.Ei;default:return u.j(this.m,t,n)}},h.Ka=function(e,t,n){return Nb.j((function(e,n){var r=G(n,0,null);return n=G(n,1,null),t.j?t.j(e,r,n):t.call(null,e,r,n)}),n,this)},h.U=function(e,t,n){return Tj(t,(function(e){return Tj(t,bk,""," ","",n,e)}),"#glue42.metrics.publisher.core.BasicRepository{",", ","}",n,Of.h(new Q(null,8,5,S,[new Q(null,2,5,S,[cG,this.uh],null),new Q(null,2,5,S,[ss,this.Ii],null),new Q(null,2,5,S,[eC,this.filters],null),new Q(null,2,5,S,[Dp,this.Di],null),new Q(null,2,5,S,[CT,this.Hi],null),new Q(null,2,5,S,[P2,this.Fi],null),new Q(null,2,5,S,[R2,this.Gi],null),new Q(null,2,5,S,[SX,this.Ei],null)],null),this.m))},h.xa=function(){return new Yh(this,8,new Q(null,8,5,S,[cG,ss,eC,Dp,CT,P2,R2,SX],null),n(this.m)?nd(this.m):eg())},h.bh=function(){var e=this;yS(pD,"glue42.metrics.publisher.core",141,lE,new qk((function(){return new Q(null,4,5,S,["starting repository for",e.Di,"with heartbeat interval",e.Ei],null)})),863130315);var t=SH(),i=Ig.h(e.Gi,(function(e){return n(BT.g(e))?we.h(pj.l(D([e,new k(null,4,[su,0,pr,"Running",wQ,!0,AX,t],null)])),BT):e}));if(!(0>e.Ei)){i=we.h(I.j(I.j(i,uA,t),Uy,t+3*e.Ei),wQ);var o=E3(e.Di,i,e.Hi),l=OH(1);sH((function(){var t,n=function(){function t(t){for(;;){e:try{for(;;){var n=t,r=n[1],i=1===r?t2(n,2,e.uh,o):2===r?NH(n,n[2]):null;if(!O(i,fv)){var l=i;break e}}}catch(e){if(l=e,t[2]=l,!z(t[4]))throw l;t[1]=A(t[4]),l=fv}if(!O(l,fv))return l}}function n(){var e=[null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(e){switch(arguments.length){case 0:return n.call(this);case 1:return t.call(this,e)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=t,r}();return LH(((t=n())[6]=l,t))}))}if(Gg(e.Fi,!0),0<e.Ei){var s=OH(1);sH((function(){var t,i=function(){function t(t){var i=t[1];if(1===i)return t[2]=null,t[1]=2,fv;if(2===i)return MH(t,4,i=s2(e.Ei));if(3===i)return NH(t,t[2]);if(4===i){i=t[2];var o=r(e.Fi);return t[7]=i,t[1]=n(o)?5:6,fv}return 5===i?(i=SH(),o=r(e.Gi),o=I.j(o,uA,i),i=I.j(o,Uy,i+3*e.Ei),i=we.h(i,wQ),i=E3(e.Di,i,e.Hi),t2(t,8,e.uh,i)):6===i?(t[2]=null,t[1]=7,fv):7===i?(t[2]=t[2],t[1]=3,fv):8===i?(t[8]=t[2],t[2]=null,t[1]=2,fv):null}return function(){function e(e){for(;;){e:try{for(;;){var n=t(e);if(!O(n,fv)){var r=n;break e}}}catch(t){if(r=t,e[2]=r,!z(e[4]))throw r;e[1]=A(e[4]),r=fv}if(!O(r,fv))return r}}function n(){var e=[null,null,null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(t){switch(arguments.length){case 0:return n.call(this);case 1:return e.call(this,t)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=e,r}()}();return LH(((t=i())[6]=s,t))}))}return this},h.dh=function(){var e=this,t=SH();return yS(pD,"glue42.metrics.publisher.core",175,lE,new qk((function(){return new Q(null,2,5,S,["stopping repository for",e.Di],null)})),1465667031),Gg(e.Fi,!1),H3(this,new k(null,6,[su,-1,BT,!0,uA,t,AX,t,Uy,t,pr,"Repository stopped"],null))},h.$g=function(e,t){return Ig.l(this.Ii,D3,this.filters,this.Di,D([t])),this},h.ah=function(e,t){var i,o=this;if(n(n(i=o.uh)&&n(i=o.Fi)?z(t):i)){e=z(t);for(var l=null,s=0,a=0;;)if(a<s){var c=l.$(null,a),h=u.h(r(o.Ii),Yo.g(c));if(n(h)){var d=h,f=new k(null,3,[Uz,o.Di,rQ,d,FT,we.h(c,Yo)],null),p=OH(1);sH(function(e,t,n,r,i,l,s,a,u,c){return function(){var e,t,n,r=(n=l,t=function(e){var t=e[1];return 1===t?t2(e,2,o.uh,n):2===t?NH(e,e[2]):null},function(){function e(e){for(;;){e:try{for(;;){var n=t(e);if(!O(n,fv)){var r=n;break e}}}catch(t){if(r=t,e[2]=r,!z(e[4]))throw r;e[1]=A(e[4]),r=fv}if(!O(r,fv))return r}}function n(){var e=[null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(t){switch(arguments.length){case 0:return n.call(this);case 1:return e.call(this,t)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=e,r}());return LH(((e=r())[6]=i,e))}}(0,0,0,0,p,f))}a+=1}else{if(!(h=z(e)))break;if(Me(c=h))e=ed(c),a=fd(c),l=e,s=C(e),e=a;else{if(d=A(c),n(f=u.h(r(o.Ii),Yo.g(d)))){p=f;var g=new k(null,3,[Uz,o.Di,rQ,p,FT,we.h(d,Yo)],null);sH(function(e,t,n,r,i,l,s,a,u,c,h,d){return function(){var e,t,n,r=(n=l,t=function(e){var t=e[1];return 1===t?t2(e,2,o.uh,n):2===t?NH(e,e[2]):null},function(){function e(e){for(;;){e:try{for(;;){var n=t(e);if(!O(n,fv)){var r=n;break e}}}catch(t){if(r=t,e[2]=r,!z(e[4]))throw r;e[1]=A(e[4]),r=fv}if(!O(r,fv))return r}}function n(){var e=[null,null,null,null,null,null,null];return e[0]=r,e[1]=1,e}var r=null;return r=function(t){switch(arguments.length){case 0:return n.call(this);case 1:return e.call(this,t)}throw Error("Invalid arity: "+arguments.length)},r.A=n,r.g=e,r}());return LH(((e=r())[6]=i,e))}}(0,0,0,0,OH(1),g))}e=B(c),l=null,s=0}a=0}}return this},h.R=function(){return this.D},h.da=function(){return 8+C(this.m)},h.ba=function(){var e=this.G;return null!=e?e:this.G=e=2012919292^Pd(this)},h.aa=function(e,t){return null!=t&&this.constructor===t.constructor&&x.h(this.uh,t.uh)&&x.h(this.Ii,t.Ii)&&x.h(this.filters,t.filters)&&x.h(this.Di,t.Di)&&x.h(this.Hi,t.Hi)&&x.h(this.Fi,t.Fi)&&x.h(this.Gi,t.Gi)&&x.h(this.Ei,t.Ei)&&x.h(this.m,t.m)},h.bb=function(e,t){return M(new uj(null,new k(null,8,[Dp,null,cG,null,eC,null,R2,null,P2,null,SX,null,CT,null,ss,null],null),null),t)?we.h(Bc(ah.h(P,this),this.D),t):new F3(this.uh,this.Ii,this.filters,this.Di,this.Hi,this.Fi,this.Gi,this.Ei,this.D,dg(we.h(this.m,t)),null)},h.za=function(e,t){switch(t instanceof w?t.W:null){case"publisher":case"metrics":case"filters":case"repo-id":case"metadata":case"running":case"latest-status":case"heartbeat-interval":return!0;default:return M(this.m,t)}},h.ja=function(e,t,r){return n(O.h?O.h(cG,t):O.call(null,cG,t))?new F3(r,this.Ii,this.filters,this.Di,this.Hi,this.Fi,this.Gi,this.Ei,this.D,this.m,null):n(O.h?O.h(ss,t):O.call(null,ss,t))?new F3(this.uh,r,this.filters,this.Di,this.Hi,this.Fi,this.Gi,this.Ei,this.D,this.m,null):n(O.h?O.h(eC,t):O.call(null,eC,t))?new F3(this.uh,this.Ii,r,this.Di,this.Hi,this.Fi,this.Gi,this.Ei,this.D,this.m,null):n(O.h?O.h(Dp,t):O.call(null,Dp,t))?new F3(this.uh,this.Ii,this.filters,r,this.Hi,this.Fi,this.Gi,this.Ei,this.D,this.m,null):n(O.h?O.h(CT,t):O.call(null,CT,t))?new F3(this.uh,this.Ii,this.filters,this.Di,r,this.Fi,this.Gi,this.Ei,this.D,this.m,null):n(O.h?O.h(P2,t):O.call(null,P2,t))?new F3(this.uh,this.Ii,this.filters,this.Di,this.Hi,r,this.Gi,this.Ei,this.D,this.m,null):n(O.h?O.h(R2,t):O.call(null,R2,t))?new F3(this.uh,this.Ii,this.filters,this.Di,this.Hi,this.Fi,r,this.Ei,this.D,this.m,null):n(O.h?O.h(SX,t):O.call(null,SX,t))?new F3(this.uh,this.Ii,this.filters,this.Di,this.Hi,this.Fi,this.Gi,r,this.D,this.m,null):new F3(this.uh,this.Ii,this.filters,this.Di,this.Hi,this.Fi,this.Gi,this.Ei,this.D,I.j(this.m,t,r),null)},h.ca=function(){return z(Of.h(new Q(null,8,5,S,[new xh(cG,this.uh),new xh(ss,this.Ii),new xh(eC,this.filters),new xh(Dp,this.Di),new xh(CT,this.Hi),new xh(P2,this.Fi),new xh(R2,this.Gi),new xh(SX,this.Ei)],null),this.m))},h.S=function(e,t){return new F3(this.uh,this.Ii,this.filters,this.Di,this.Hi,this.Fi,this.Gi,this.Ei,t,this.m,this.G)},h.ia=function(e,t){return Le(t)?this.ja(null,Zb(t,0),Zb(t,1)):Nb.j(Xb,this,t)},J3.prototype.eh=function(e,t,n){e=bg(n);var r=u.h(e,CT);n=this.Tg,e=eC.g(n),t=G3(t),r=G3(r);var i=Fg(new k(null,4,[su,0,pr,"Running",wQ,!0,AX,SH()],null));return n=yQ.h(n,1e3),new F3(this.Qi,Fg(P),e,t,r,Fg(!0),i,n,null,null,null)},J3.prototype.Ki=function(){return I3(this.Qi)};var L3=function e(t){return new k(null,1,[oy,J(t)?af((function(t,n,r){return I.j(t,n,e.g?e.g(r):e.call(null,r))}),P,t):t],null)},M3=function e(t){return J(t)?new k(null,1,[oy,af((function(t,r,i){var o=e.g?e.g(i):e.call(null,i);return i=n(o)?o:i,n(i)?I.j(t,r,i):null}),P,t)],null):null};function N3(e,t){var r=Nb.j((function(t,r){var i=G(t,0,null),o=G(t,1,null);if(n(t=rk.g(r)))return new Q(null,2,5,S,[Nb.j(re,F,Xg.h(zb,new Q(null,2,5,S,[o,new k(null,4,[Uz,e,rk,t,ss,null,CT,M3(dg(CT.g(r)))],null)],null))),null],null);var l=rQ.g(r),s=Yo.g(l);t=S;var a=fh.F;o=eh(n(o)?o:new k(null,1,[Uz,e],null),new Q(null,3,5,S,[ss,s,GL],null),we.h(l,Yo)),s=new Q(null,3,5,S,[ss,s,RX],null),l=Dg(re,F),r=FT.g(r);var u=uA.g(r);return r=new k(null,2,[uA,n(u)?u:SH(),oy,L3(oy.g(r))],null),new Q(null,2,5,t,[i,a.call(fh,o,s,l,r)],null)}),new Q(null,2,5,S,[F,null],null),t);return t=G(r,0,null),n(r=G(r,1,null))?re.h(t,r):t}function O3(e,t){return yS(Cy,"glue42.metrics.publisher.common",69,lE,new qk((function(){return new Q(null,2,5,S,["conflating",t],null)})),-425318874),Nb.j((function(t,n){var r=G(n,0,null);return n=G(n,1,null),Nb.j(re,t,Wg((function(e){return N3(r,e)}),D([Yt(e,e,n)])))}),F,Ik(Uz,t))}function S3(e){var t;return(t="string"==typeof e)&&(t=0==e.lastIndexOf("#",0)&&0<C(e)),t?Sj(e.substring(1)):e}function W3(e){return af((function(e,t,n){return I.j(e,t,S3(n))}),P,e)}function X3(e){return bh.h((function(e){return fh.j(fh.j(gh(e,cG,W3),new Q(null,2,5,S,[ss,NF],null),(function(e){return n(e)?bh.h(S3,e):null})),new Q(null,2,5,S,[ss,cs],null),(function(e){return n(e)?bh.h(S3,e):null}))}),e)}function Y3(e){var t=u.h(e,DL);return n(t)?I.j(we.h(e,DL),Su,t):e}function Z3(e){var t=bg(e),r=u.h(t,pQ),i=u.h(t,WR),o=u.h(t,VR),l=u.h(t,Fp);e=bg(e=u.h(t,DB));var s=u.h(e,qQ);s=u.h(e,Q2);var a,c=u.h(e,UR);return yS(pD,"glue42.metrics.cljs.gateway",56,lE,new qk((function(){return new Q(null,2,5,S,["Creating JS repository from:",t],null)})),-968205711),K3(e,B3(I.j(e,eC,gh(gh(Y3(eC.g(e)),Su,Bf),bw,X3)),Ag(O3,n(a=s)||n(a=s)?a:1),(function(e){if(yS(it,"glue42.metrics.cljs.gateway",62,lE,new qk((function(){return new Q(null,2,5,S,["Received metric: ",e],null)})),2019188930),x.h(Ku,e)){var s=n(o)?function(){var e=yb(c)?Ak(l):l;return o.g?o.g(e):o.call(null,e)}():null;return s instanceof nT?s:nT.resolve(s)}return x.h(Kv,e)?(yS(pD,"glue42.metrics.cljs.gateway",70,lE,new qk((function(){return new Q(null,2,5,S,["Cleanup called for",t],null)})),199576799),n(i)?i:function(){return null}):(s=function(){var t=yb(c)?Ak(e):e;return r.g?r.g(t):r.call(null,t)}(),s instanceof nT?s:nT.resolve(s))})))}function U3(e){if(n(e=dh.h(e,new Q(null,2,5,S,[ss,bw],null)))){var t=Ng.h((function(e){return Z3(e)}),e);return yS(pD,"gateway.cljs.metrics",19,uE,new qk((function(){return new Q(null,2,5,S,["metrics repository factories created: %s",t],null)})),718967903),t}return null}var i2={},j2={},V3;!function(e){iS((function(t){return I.j(t,ny,e)}))}(pD);var E1=new k(null,1,[dB,(new Date).getTime()],null);function l2(e){return new k(null,6,[NB,!0,aw,!1,ny,null,iy,null,qo,IE,Ir,function(t){return t={time:Eu.g(t),level:Cf(bE.g(t)),namespace:jy.g(t),file:FG.g(t),line:Qo.g(t),stacktrace:Gs.g(t),message:uk(hn.g(t)),output:uk(no.g(t))},e.g?e.g(t):e.call(null,t)}],null)}function m2(e){return n(e=dh.h(e,new Q(null,2,5,S,[du,EL],null)))?(yS(pD,"gateway-web.core",66,lE,new qk((function(){return new Q(null,1,5,S,["will be using custom JS authenticator"],null)})),-528201992),new k(null,2,[Zk,vQ,nw,new k(null,1,[vQ,EU(P,new FU(e))],null)],null)):new k(null,2,[Zk,vQ,nw,new k(null,1,[vQ,h2()],null)],null)}na("gateway_web.core.configure_logging",(function(e){e=Fk(e,D([Gk,!0]));var t=new k(null,2,[bE,pD,dA,new k(null,1,[FL,aS.g?aS.g(P):aS.call(null,P)],null)],null);return t=n(bE.g(e))?I.j(t,bE,Bf.g(bE.g(e))):t,t=n(cs.g(e))?I.j(t,zQ,cs.g(e)):t,t=n(NF.g(e))?I.j(t,jH,NF.g(e)):t,hS(e=n(Lw.g(e))?eh(t,new Q(null,2,5,S,[dA,FL],null),l2(Lw.g(e))):t)}));var n2=function e(t,i,o,l,s){return n(function(){var e=r(t);return n(e)?0<s:e}())?(OS(o,l,(new Date).getTime()-1e3*s),Ig.h(i,(function(){return jT((function(){return e.O?e.O(t,i,o,l,s):e.call(null,t,i,o,l,s)}))}))):null};function o2(e){var t=Ts.g(r(e));yS(pD,"gateway-web.core",83,lE,new qk((function(){return new Q(null,2,5,S,["starting gateway with configuration",t],null)})),981509366),Ig.h(e,(function(e){var n=m2(t),r=U3(t),i=gh(gh(Y3(eC.g(ss.g(t))),Su,Bf),bw,X3);i=mY(i=new Q(null,6,5,S,[new HZ,new V0,new j1(n),new N1,new d2,D1(r,i)],null));var o=Fg(P),l=Fg(null),s=Fg(!0),a=dh.j(t,new Q(null,2,5,S,[kw,DT],null),60);return 0<a&&(yS(pD,"gateway-web.core",100,lE,new qk((function(){return new Q(null,3,5,S,["clients inactive for",a,"will be scavenged"],null)})),2009614341),n2(s,l,o,i,a)),I.l(e,eY,s,D([HL,n,LB,r,zt,i,kw,o,zX,l]))}))}function p2(e){yS(pD,"gateway-web.core",119,lE,new qk((function(){return new Q(null,1,5,S,["stopping gateway"],null)})),-896061828),Ig.h(e,(function(e){Ig.h(eY.g(e),yg(!1));var t=zX.g(e);null!=(t=null==t?null:r(t))&&dT(t),null!=(t=zt.g(e))&&AS(t);e:{t=z(t=LB.g(e));for(var n=null,i=0,o=0;;)if(o<i){var l=n.$(null,o);T3(l),o+=1}else{if(!(t=z(t)))break e;Me(n=t)?(t=ed(n),i=fd(n),n=t,l=C(t),t=i,i=l):(T3(l=A(n)),t=B(n),n=null,i=0),o=0}}if(null!=(t=HL.g(e)))e:for(t=z(ei(nw.g(t))),n=null,o=i=0;;)if(o<i)l=n.$(null,o),xT(l),o+=1;else{if(!(t=z(t)))break e;Me(n=t)?(t=ed(n),i=fd(n),n=t,l=C(t),t=i,i=l):(xT(l=A(n)),t=B(n),n=null,i=0),o=0}return new k(null,1,[Ts,Ts.g(e)],null)}))}na("gateway_web.core.create",(function(e){var t=Fg(new k(null,1,[Ts,fL(Ek(e))],null));return void 0!==i2&&void 0!==j2&&void 0!==V3||(V3=function(e,t,n){this.Tg=e,this.qd=t,this.Pi=n,this.B=393216,this.M=0},V3.prototype.S=function(e,t){return new V3(this.Tg,this.qd,t)},V3.prototype.R=function(){return this.Pi},V3.prototype.start=function(){var e=this,t=this;return new Promise((function(n){return o2(e.qd),n.g?n.g(t):n.call(null,t)}))},V3.prototype.stop=function(){var e=this,t=this;return new Promise((function(n){return p2(e.qd),n.g?n.g(t):n.call(null,t)}))},V3.prototype.connect=function(e){return WS(this.qd,e)},V3.Na=!0,V3.Ja="gateway-web.core/t_gateway_web$core14064",V3.Pa=function(e){return Qc(e,"gateway-web.core/t_gateway_web$core14064")}),new V3(e,t,P)}))}).call(commonjsGlobal$1);class Gateway{constructor(){this.configureLogging=window.gateway_web.core.configure_logging,this.create=window.gateway_web.core.create}start(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){(null==e?void 0:e.logging)&&this.configureLogging({level:e.logging.level,appender:e.logging.appender});const n="number"==typeof(null===(t=null==e?void 0:e.clients)||void 0===t?void 0:t.buffer_size)?e.clients.buffer_size:1e3;this._gatewayWebInstance=this.create({clients:{inactive_seconds:0,buffer_size:n}}),yield this._gatewayWebInstance.start()}))}connectClient(e){return __awaiter$7(this,void 0,void 0,(function*(){return yield this._gatewayWebInstance.connect(((t,n)=>e.postMessage(n)))}))}connectExtClient(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=yield this._gatewayWebInstance.connect(((t,n)=>e.postMessage({glue42ExtInc:n})));e.onMessage.addListener((r=>{var i;const o=null===(i=null==r?void 0:r.glue42ExtOut)||void 0===i?void 0:i.glue42core;if(o&&o.type===Glue42CoreMessageTypes.clientUnload.name)return n.disconnect(),e.disconnect(),void(t&&t(o.data.clientId,!0));if(!r.glue42ExtOut||o);else{const e=r.glue42ExtOut;n.send(e)}}))}))}setupInternalClient(e){return __awaiter$7(this,void 0,void 0,(function*(){let t;e.onmessage=n=>__awaiter$7(this,void 0,void 0,(function*(){var r;const i=null===(r=n.data)||void 0===r?void 0:r.glue42core;if(i&&i.type===Glue42CoreMessageTypes.gatewayInternalConnect.name)t=yield this.handleInternalGatewayConnectionRequest(e);else if(t&&!e.closed)return i&&i.type===Glue42CoreMessageTypes.gatewayDisconnect.name?(e.closed=!0,void(null==t||t.disconnect())):void(null==t||t.send(n.data))}))}))}handleInternalGatewayConnectionRequest(e){return __awaiter$7(this,void 0,void 0,(function*(){e.closed=!1;try{const t=yield this._gatewayWebInstance.connect(((t,n)=>e.postMessage(n)));return e.postMessage({glue42core:{type:Glue42CoreMessageTypes.gatewayInternalConnect.name,success:!0}}),t}catch(t){const n="string"==typeof t?t:JSON.stringify(t.message);return void e.postMessage({glue42core:{type:Glue42CoreMessageTypes.gatewayInternalConnect.name,error:n}})}}))}}class PlatformLogger{setLogger(e){this._logger=e}get(e){if(this._logger)return this._logger.subLogger(e)}}var logger=new PlatformLogger,lib$3={exports:{}},seed$1=1;function getNextValue$1(){return(seed$1=(9301*seed$1+49297)%233280)/233280}function setSeed$3(e){seed$1=e}var randomFromSeed$3={nextValue:getNextValue$1,seed:setSeed$3},randomFromSeed$2=randomFromSeed$3,ORIGINAL$1="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$5,previousSeed$1,shuffled$1;function reset$1(){shuffled$1=!1}function setCharacters$1(e){if(e){if(e!==alphabet$5){if(e.length!==ORIGINAL$1.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$1.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL$1.length+" unique characters. These characters were not unique: "+t.join(", "));alphabet$5=e,reset$1()}}else alphabet$5!==ORIGINAL$1&&(alphabet$5=ORIGINAL$1,reset$1())}function characters$1(e){return setCharacters$1(e),alphabet$5}function setSeed$2(e){randomFromSeed$2.seed(e),previousSeed$1!==e&&(reset$1(),previousSeed$1=e)}function shuffle$1(){alphabet$5||setCharacters$1(ORIGINAL$1);for(var e,t=alphabet$5.split(""),n=[],r=randomFromSeed$2.nextValue();t.length>0;)r=randomFromSeed$2.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function getShuffled$1(){return shuffled$1||(shuffled$1=shuffle$1())}function lookup$1(e){return getShuffled$1()[e]}function get$1(){return alphabet$5||ORIGINAL$1}var alphabet_1$1={get:get$1,characters:characters$1,seed:setSeed$2,lookup:lookup$1,shuffled:getShuffled$1},crypto$3="object"==typeof window&&(window.crypto||window.msCrypto),randomByte$1;randomByte$1=crypto$3&&crypto$3.getRandomValues?function(e){return crypto$3.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t};var randomByteBrowser$1=randomByte$1,format_browser$1=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*r*n/t.length),o="";;)for(var l=e(i),s=i;s--;)if((o+=t[l[s]&r]||"").length===+n)return o},alphabet$4=alphabet_1$1,random$1=randomByteBrowser$1,format$1=format_browser$1;function generate$3(e){for(var t,n=0,r="";!t;)r+=format$1(random$1,alphabet$4.get(),1),t=e<Math.pow(16,n+1),n++;return r}var generate_1$1=generate$3,generate$2=generate_1$1,REDUCE_TIME$1=1567752802062,version$4=7,counter$1,previousSeconds$1;function build$1(e){var t="",n=Math.floor(.001*(Date.now()-REDUCE_TIME$1));return n===previousSeconds$1?counter$1++:(counter$1=0,previousSeconds$1=n),t+=generate$2(version$4),t+=generate$2(e),counter$1>0&&(t+=generate$2(counter$1)),t+=generate$2(n)}var build_1$1=build$1,alphabet$3=alphabet_1$1;function isShortId$1(e){return!(!e||"string"!=typeof e||e.length<6)&&!new RegExp("[^"+alphabet$3.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}var isValid$1=isShortId$1;!function(e){var t=alphabet_1$1,n=build_1$1,r=isValid$1,i=0;function o(){return n(i)}e.exports=o,e.exports.generate=o,e.exports.seed=function(n){return t.seed(n),e.exports},e.exports.worker=function(t){return i=t,e.exports},e.exports.characters=function(e){return void 0!==e&&t.characters(e),t.shuffled()},e.exports.isValid=r}(lib$3);var libExports$1=lib$3.exports,shortid$2=libExports$1,shortid$3=getDefaultExportFromCjs$1(shortid$2),toStr$9=Object.prototype.toString,isArguments$3=function(e){var t=toStr$9.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===toStr$9.call(e.callee)),n},implementation$b,hasRequiredImplementation;function requireImplementation(){if(hasRequiredImplementation)return implementation$b;var e;if(hasRequiredImplementation=1,!Object.keys){var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=isArguments$3,i=Object.prototype.propertyIsEnumerable,o=!i.call({toString:null},"toString"),l=i.call((function(){}),"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=function(e){var t=e.constructor;return t&&t.prototype===e},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},c=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!u["$"+e]&&t.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{a(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();e=function(e){var i=null!==e&&"object"==typeof e,u="[object Function]"===n.call(e),h=r(e),d=i&&"[object String]"===n.call(e),f=[];if(!i&&!u&&!h)throw new TypeError("Object.keys called on a non-object");var p=l&&u;if(d&&e.length>0&&!t.call(e,0))for(var g=0;g<e.length;++g)f.push(String(g));if(h&&e.length>0)for(var w=0;w<e.length;++w)f.push(String(w));else for(var m in e)p&&"prototype"===m||!t.call(e,m)||f.push(String(m));if(o)for(var v=function(e){if("undefined"==typeof window||!c)return a(e);try{return a(e)}catch(e){return!1}}(e),y=0;y<s.length;++y)v&&"constructor"===s[y]||!t.call(e,s[y])||f.push(s[y]);return f}}return implementation$b=e}var slice$1=Array.prototype.slice,isArgs=isArguments$3,origKeys=Object.keys,keysShim=origKeys?function(e){return origKeys(e)}:requireImplementation(),originalKeys=Object.keys;keysShim.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return isArgs(e)?originalKeys(slice$1.call(e)):originalKeys(e)})}else Object.keys=keysShim;return Object.keys||keysShim};var objectKeys$2=keysShim,shams$1,hasRequiredShams;function requireShams(){return hasRequiredShams?shams$1:(hasRequiredShams=1,shams$1=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0})}var origSymbol="undefined"!=typeof Symbol&&Symbol,hasSymbolSham=requireShams(),hasSymbols$5=function(){return"function"==typeof origSymbol&&("function"==typeof Symbol&&("symbol"==typeof origSymbol("foo")&&("symbol"==typeof Symbol("bar")&&hasSymbolSham())))},test={foo:{}},$Object=Object,hasProto$1=function(){return{__proto__:test}.foo===test.foo&&!({__proto__:null}instanceof $Object)},ERROR_MESSAGE="Function.prototype.bind called on incompatible ",slice=Array.prototype.slice,toStr$8=Object.prototype.toString,funcType="[object Function]",implementation$a=function(e){var t=this;if("function"!=typeof t||toStr$8.call(t)!==funcType)throw new TypeError(ERROR_MESSAGE+t);for(var n,r=slice.call(arguments,1),i=Math.max(0,t.length-r.length),o=[],l=0;l<i;l++)o.push("$"+l);if(n=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof n){var i=t.apply(this,r.concat(slice.call(arguments)));return Object(i)===i?i:this}return t.apply(e,r.concat(slice.call(arguments)))})),t.prototype){var s=function(){};s.prototype=t.prototype,n.prototype=new s,s.prototype=null}return n},implementation$9=implementation$a,functionBind=Function.prototype.bind||implementation$9,bind$1=functionBind,src=bind$1.call(Function.call,Object.prototype.hasOwnProperty),undefined$1,$SyntaxError$1=SyntaxError,$Function=Function,$TypeError$2=TypeError,getEvalledConstructor=function(e){try{return $Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},$gOPD$2=Object.getOwnPropertyDescriptor;if($gOPD$2)try{$gOPD$2({},"")}catch(e){$gOPD$2=null}var throwTypeError=function(){throw new $TypeError$2},ThrowTypeError=$gOPD$2?function(){try{return throwTypeError}catch(e){try{return $gOPD$2(arguments,"callee").get}catch(e){return throwTypeError}}}():throwTypeError,hasSymbols$4=hasSymbols$5(),hasProto=hasProto$1(),getProto$1=Object.getPrototypeOf||(hasProto?function(e){return e.__proto__}:null),needsEval={},TypedArray="undefined"!=typeof Uint8Array&&getProto$1?getProto$1(Uint8Array):undefined$1,INTRINSICS={"%AggregateError%":"undefined"==typeof AggregateError?undefined$1:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?undefined$1:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols$4&&getProto$1?getProto$1([][Symbol.iterator]()):undefined$1,"%AsyncFromSyncIteratorPrototype%":undefined$1,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":"undefined"==typeof Atomics?undefined$1:Atomics,"%BigInt%":"undefined"==typeof BigInt?undefined$1:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?undefined$1:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?undefined$1:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?undefined$1:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?undefined$1:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?undefined$1:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?undefined$1:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":"undefined"==typeof Int8Array?undefined$1:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?undefined$1:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?undefined$1:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols$4&&getProto$1?getProto$1(getProto$1([][Symbol.iterator]())):undefined$1,"%JSON%":"object"==typeof JSON?JSON:undefined$1,"%Map%":"undefined"==typeof Map?undefined$1:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&hasSymbols$4&&getProto$1?getProto$1((new Map)[Symbol.iterator]()):undefined$1,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?undefined$1:Promise,"%Proxy%":"undefined"==typeof Proxy?undefined$1:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?undefined$1:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?undefined$1:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&hasSymbols$4&&getProto$1?getProto$1((new Set)[Symbol.iterator]()):undefined$1,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?undefined$1:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols$4&&getProto$1?getProto$1(""[Symbol.iterator]()):undefined$1,"%Symbol%":hasSymbols$4?Symbol:undefined$1,"%SyntaxError%":$SyntaxError$1,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError$2,"%Uint8Array%":"undefined"==typeof Uint8Array?undefined$1:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?undefined$1:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?undefined$1:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?undefined$1:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?undefined$1:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?undefined$1:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?undefined$1:WeakSet};if(getProto$1)try{null.error}catch(e){var errorProto=getProto$1(getProto$1(e));INTRINSICS["%Error.prototype%"]=errorProto}var doEval=function e(t){var n;if("%AsyncFunction%"===t)n=getEvalledConstructor("async function () {}");else if("%GeneratorFunction%"===t)n=getEvalledConstructor("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=getEvalledConstructor("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&getProto$1&&(n=getProto$1(i.prototype))}return INTRINSICS[t]=n,n},LEGACY_ALIASES={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bind=functionBind,hasOwn$1=src,$concat$1=bind.call(Function.call,Array.prototype.concat),$spliceApply=bind.call(Function.apply,Array.prototype.splice),$replace$1=bind.call(Function.call,String.prototype.replace),$strSlice=bind.call(Function.call,String.prototype.slice),$exec$1=bind.call(Function.call,RegExp.prototype.exec),rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=function(e){var t=$strSlice(e,0,1),n=$strSlice(e,-1);if("%"===t&&"%"!==n)throw new $SyntaxError$1("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new $SyntaxError$1("invalid intrinsic syntax, expected opening `%`");var r=[];return $replace$1(e,rePropName,(function(e,t,n,i){r[r.length]=n?$replace$1(i,reEscapeChar,"$1"):t||e})),r},getBaseIntrinsic=function(e,t){var n,r=e;if(hasOwn$1(LEGACY_ALIASES,r)&&(r="%"+(n=LEGACY_ALIASES[r])[0]+"%"),hasOwn$1(INTRINSICS,r)){var i=INTRINSICS[r];if(i===needsEval&&(i=doEval(r)),void 0===i&&!t)throw new $TypeError$2("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}throw new $SyntaxError$1("intrinsic "+e+" does not exist!")},getIntrinsic=function(e,t){if("string"!=typeof e||0===e.length)throw new $TypeError$2("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new $TypeError$2('"allowMissing" argument must be a boolean');if(null===$exec$1(/^%?[^%]*%?$/,e))throw new $SyntaxError$1("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=stringToPath(e),r=n.length>0?n[0]:"",i=getBaseIntrinsic("%"+r+"%",t),o=i.name,l=i.value,s=!1,a=i.alias;a&&(r=a[0],$spliceApply(n,$concat$1([0,1],a)));for(var u=1,c=!0;u<n.length;u+=1){var h=n[u],d=$strSlice(h,0,1),f=$strSlice(h,-1);if(('"'===d||"'"===d||"`"===d||'"'===f||"'"===f||"`"===f)&&d!==f)throw new $SyntaxError$1("property names with quotes must have matching quotes");if("constructor"!==h&&c||(s=!0),hasOwn$1(INTRINSICS,o="%"+(r+="."+h)+"%"))l=INTRINSICS[o];else if(null!=l){if(!(h in l)){if(!t)throw new $TypeError$2("base intrinsic for "+e+" exists, but the property is not available.");return}if($gOPD$2&&u+1>=n.length){var p=$gOPD$2(l,h);l=(c=!!p)&&"get"in p&&!("originalValue"in p.get)?p.get:l[h]}else c=hasOwn$1(l,h),l=l[h];c&&!s&&(INTRINSICS[o]=l)}}return l},GetIntrinsic$8=getIntrinsic,$defineProperty=GetIntrinsic$8("%Object.defineProperty%",!0),hasPropertyDescriptors$1=function(){if($defineProperty)try{return $defineProperty({},"a",{value:1}),!0}catch(e){return!1}return!1};hasPropertyDescriptors$1.hasArrayLengthDefineBug=function(){if(!hasPropertyDescriptors$1())return null;try{return 1!==$defineProperty([],"length",{value:1}).length}catch(e){return!0}};var hasPropertyDescriptors_1=hasPropertyDescriptors$1,keys=objectKeys$2,hasSymbols$3="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),toStr$7=Object.prototype.toString,concat=Array.prototype.concat,origDefineProperty=Object.defineProperty,isFunction=function(e){return"function"==typeof e&&"[object Function]"===toStr$7.call(e)},hasPropertyDescriptors=hasPropertyDescriptors_1(),supportsDescriptors$2=origDefineProperty&&hasPropertyDescriptors,defineProperty$1=function(e,t,n,r){if(t in e)if(!0===r){if(e[t]===n)return}else if(!isFunction(r)||!r())return;supportsDescriptors$2?origDefineProperty(e,t,{configurable:!0,enumerable:!1,value:n,writable:!0}):e[t]=n},defineProperties$1=function(e,t){var n=arguments.length>2?arguments[2]:{},r=keys(t);hasSymbols$3&&(r=concat.call(r,Object.getOwnPropertySymbols(t)));for(var i=0;i<r.length;i+=1)defineProperty$1(e,r[i],t[r[i]],n[r[i]])};defineProperties$1.supportsDescriptors=!!supportsDescriptors$2;var defineProperties_1=defineProperties$1,callBind$6={exports:{}};!function(e){var t=functionBind,n=getIntrinsic,r=n("%Function.prototype.apply%"),i=n("%Function.prototype.call%"),o=n("%Reflect.apply%",!0)||t.call(i,r),l=n("%Object.getOwnPropertyDescriptor%",!0),s=n("%Object.defineProperty%",!0),a=n("%Math.max%");if(s)try{s({},"a",{value:1})}catch(e){s=null}e.exports=function(e){var n=o(t,i,arguments);l&&s&&(l(n,"length").configurable&&s(n,"length",{value:1+a(0,e.length-(arguments.length-1))}));return n};var u=function(){return o(t,r,arguments)};s?s(e.exports,"apply",{value:u}):e.exports.apply=u}(callBind$6);var callBindExports=callBind$6.exports,GetIntrinsic$7=getIntrinsic,callBind$5=callBindExports,$indexOf$1=callBind$5(GetIntrinsic$7("String.prototype.indexOf")),callBound$c=function(e,t){var n=GetIntrinsic$7(e,!!t);return"function"==typeof n&&$indexOf$1(e,".prototype.")>-1?callBind$5(n):n},objectKeys$1=objectKeys$2,hasSymbols$2=requireShams()(),callBound$b=callBound$c,toObject=Object,$push=callBound$b("Array.prototype.push"),$propIsEnumerable=callBound$b("Object.prototype.propertyIsEnumerable"),originalGetSymbols=hasSymbols$2?Object.getOwnPropertySymbols:null,implementation$8=function(e,t){if(null==e)throw new TypeError("target must be an object");var n=toObject(e);if(1===arguments.length)return n;for(var r=1;r<arguments.length;++r){var i=toObject(arguments[r]),o=objectKeys$1(i),l=hasSymbols$2&&(Object.getOwnPropertySymbols||originalGetSymbols);if(l)for(var s=l(i),a=0;a<s.length;++a){var u=s[a];$propIsEnumerable(i,u)&&$push(o,u)}for(var c=0;c<o.length;++c){var h=o[c];if($propIsEnumerable(i,h)){var d=i[h];n[h]=d}}}return n},implementation$7=implementation$8,lacksProperEnumerationOrder=function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),n={},r=0;r<t.length;++r)n[t[r]]=t[r];var i=Object.assign({},n),o="";for(var l in i)o+=l;return e!==o},assignHasPendingExceptions=function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}return!1},polyfill$4=function(){return Object.assign?lacksProperEnumerationOrder()||assignHasPendingExceptions()?implementation$7:Object.assign:implementation$7},define$3=defineProperties_1,getPolyfill$5=polyfill$4,shim$5=function(){var e=getPolyfill$5();return define$3(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},defineProperties=defineProperties_1,callBind$4=callBindExports,implementation$6=implementation$8,getPolyfill$4=polyfill$4,shim$4=shim$5,polyfill$3=callBind$4.apply(getPolyfill$4()),bound=function(e,t){return polyfill$3(Object,arguments)};defineProperties(bound,{getPolyfill:getPolyfill$4,implementation:implementation$6,shim:shim$4});var object_assign=bound,implementation$5={exports:{}},functionsHaveNames=function(){return"string"==typeof function(){}.name},gOPD$3=Object.getOwnPropertyDescriptor;if(gOPD$3)try{gOPD$3([],"length")}catch(e){gOPD$3=null}functionsHaveNames.functionsHaveConfigurableNames=function(){if(!functionsHaveNames()||!gOPD$3)return!1;var e=gOPD$3((function(){}),"name");return!!e&&!!e.configurable};var $bind=Function.prototype.bind;functionsHaveNames.boundFunctionsHaveNames=function(){return functionsHaveNames()&&"function"==typeof $bind&&""!==function(){}.bind().name};var functionsHaveNames_1=functionsHaveNames;!function(e){var t=functionsHaveNames_1.functionsHaveConfigurableNames(),n=Object,r=TypeError;e.exports=function(){if(null!=this&&this!==n(this))throw new r("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},t&&Object.defineProperty&&Object.defineProperty(e.exports,"name",{value:"get flags"})}(implementation$5);var implementationExports=implementation$5.exports,implementation$4=implementationExports,supportsDescriptors$1=defineProperties_1.supportsDescriptors,$gOPD$1=Object.getOwnPropertyDescriptor,polyfill$2=function(){if(supportsDescriptors$1&&"gim"===/a/gim.flags){var e=$gOPD$1(RegExp.prototype,"flags");if(e&&"function"==typeof e.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var t="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(n,"sticky",{get:function(){t+="y"}}),"dy"===t)return e.get}}return implementation$4},supportsDescriptors=defineProperties_1.supportsDescriptors,getPolyfill$3=polyfill$2,gOPD$2=Object.getOwnPropertyDescriptor,defineProperty=Object.defineProperty,TypeErr=TypeError,getProto=Object.getPrototypeOf,regex=/a/,shim$3=function(){if(!supportsDescriptors||!getProto)throw new TypeErr("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=getPolyfill$3(),t=getProto(regex),n=gOPD$2(t,"flags");return n&&n.get===e||defineProperty(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},define$2=defineProperties_1,callBind$3=callBindExports,implementation$3=implementationExports,getPolyfill$2=polyfill$2,shim$2=shim$3,flagsBound=callBind$3(getPolyfill$2());define$2(flagsBound,{getPolyfill:getPolyfill$2,implementation:implementation$3,shim:shim$2});var regexp_prototype_flags=flagsBound,esGetIterator={exports:{}},hasSymbols$1=requireShams(),shams=function(){return hasSymbols$1()&&!!Symbol.toStringTag},hasToStringTag$7=shams(),callBound$a=callBound$c,$toString$3=callBound$a("Object.prototype.toString"),isStandardArguments=function(e){return!(hasToStringTag$7&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===$toString$3(e)},isLegacyArguments=function(e){return!!isStandardArguments(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==$toString$3(e)&&"[object Function]"===$toString$3(e.callee)},supportsStandardArguments=function(){return isStandardArguments(arguments)}();isStandardArguments.isLegacyArguments=isLegacyArguments;var isArguments$2=supportsStandardArguments?isStandardArguments:isLegacyArguments,_nodeResolve_empty={},_nodeResolve_empty$1=Object.freeze({__proto__:null,default:_nodeResolve_empty}),require$$0=getAugmentedNamespace(_nodeResolve_empty$1),hasMap="function"==typeof Map&&Map.prototype,mapSizeDescriptor=Object.getOwnPropertyDescriptor&&hasMap?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,mapSize=hasMap&&mapSizeDescriptor&&"function"==typeof mapSizeDescriptor.get?mapSizeDescriptor.get:null,mapForEach=hasMap&&Map.prototype.forEach,hasSet="function"==typeof Set&&Set.prototype,setSizeDescriptor=Object.getOwnPropertyDescriptor&&hasSet?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,setSize=hasSet&&setSizeDescriptor&&"function"==typeof setSizeDescriptor.get?setSizeDescriptor.get:null,setForEach=hasSet&&Set.prototype.forEach,hasWeakMap="function"==typeof WeakMap&&WeakMap.prototype,weakMapHas=hasWeakMap?WeakMap.prototype.has:null,hasWeakSet="function"==typeof WeakSet&&WeakSet.prototype,weakSetHas=hasWeakSet?WeakSet.prototype.has:null,hasWeakRef="function"==typeof WeakRef&&WeakRef.prototype,weakRefDeref=hasWeakRef?WeakRef.prototype.deref:null,booleanValueOf=Boolean.prototype.valueOf,objectToString=Object.prototype.toString,functionToString=Function.prototype.toString,$match=String.prototype.match,$slice$1=String.prototype.slice,$replace=String.prototype.replace,$toUpperCase=String.prototype.toUpperCase,$toLowerCase=String.prototype.toLowerCase,$test=RegExp.prototype.test,$concat=Array.prototype.concat,$join=Array.prototype.join,$arrSlice=Array.prototype.slice,$floor=Math.floor,bigIntValueOf$1="function"==typeof BigInt?BigInt.prototype.valueOf:null,gOPS=Object.getOwnPropertySymbols,symToString="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,hasShammedSymbols="function"==typeof Symbol&&"object"==typeof Symbol.iterator,toStringTag="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===hasShammedSymbols||"symbol")?Symbol.toStringTag:null,isEnumerable=Object.prototype.propertyIsEnumerable,gPO$1=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function addNumericSeparator(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||$test.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-$floor(-e):$floor(e);if(r!==e){var i=String(r),o=$slice$1.call(t,i.length+1);return $replace.call(i,n,"$&_")+"."+$replace.call($replace.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return $replace.call(t,n,"$&_")}var utilInspect=require$$0,inspectCustom=utilInspect.custom,inspectSymbol=isSymbol$2(inspectCustom)?inspectCustom:null,objectInspect=function e(t,n,r,i){var o=n||{};if(has$2(o,"quoteStyle")&&"single"!==o.quoteStyle&&"double"!==o.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(has$2(o,"maxStringLength")&&("number"==typeof o.maxStringLength?o.maxStringLength<0&&o.maxStringLength!==1/0:null!==o.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!has$2(o,"customInspect")||o.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(has$2(o,"indent")&&null!==o.indent&&"\t"!==o.indent&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(has$2(o,"numericSeparator")&&"boolean"!=typeof o.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var s=o.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return inspectString(t,o);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var a=String(t);return s?addNumericSeparator(t,a):a}if("bigint"==typeof t){var u=String(t)+"n";return s?addNumericSeparator(t,u):u}var c=void 0===o.depth?5:o.depth;if(void 0===r&&(r=0),r>=c&&c>0&&"object"==typeof t)return isArray$2(t)?"[Array]":"[Object]";var h=getIndent(o,r);if(void 0===i)i=[];else if(indexOf(i,t)>=0)return"[Circular]";function d(t,n,l){if(n&&(i=$arrSlice.call(i)).push(n),l){var s={depth:o.depth};return has$2(o,"quoteStyle")&&(s.quoteStyle=o.quoteStyle),e(t,s,r+1,i)}return e(t,o,r+1,i)}if("function"==typeof t&&!isRegExp(t)){var f=nameOf(t),p=arrObjKeys(t,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+$join.call(p,", ")+" }":"")}if(isSymbol$2(t)){var g=hasShammedSymbols?$replace.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):symToString.call(t);return"object"!=typeof t||hasShammedSymbols?g:markBoxed(g)}if(isElement(t)){for(var w="<"+$toLowerCase.call(String(t.nodeName)),m=t.attributes||[],v=0;v<m.length;v++)w+=" "+m[v].name+"="+wrapQuotes(quote(m[v].value),"double",o);return w+=">",t.childNodes&&t.childNodes.length&&(w+="..."),w+="</"+$toLowerCase.call(String(t.nodeName))+">"}if(isArray$2(t)){if(0===t.length)return"[]";var y=arrObjKeys(t,d);return h&&!singleLineValues(y)?"["+indentedJoin(y,h)+"]":"[ "+$join.call(y,", ")+" ]"}if(isError(t)){var b=arrObjKeys(t,d);return"cause"in Error.prototype||!("cause"in t)||isEnumerable.call(t,"cause")?0===b.length?"["+String(t)+"]":"{ ["+String(t)+"] "+$join.call(b,", ")+" }":"{ ["+String(t)+"] "+$join.call($concat.call("[cause]: "+d(t.cause),b),", ")+" }"}if("object"==typeof t&&l){if(inspectSymbol&&"function"==typeof t[inspectSymbol]&&utilInspect)return utilInspect(t,{depth:c-r});if("symbol"!==l&&"function"==typeof t.inspect)return t.inspect()}if(isMap$3(t)){var S=[];return mapForEach&&mapForEach.call(t,(function(e,n){S.push(d(n,t,!0)+" => "+d(e,t))})),collectionOf("Map",mapSize.call(t),S,h)}if(isSet$3(t)){var $=[];return setForEach&&setForEach.call(t,(function(e){$.push(d(e,t))})),collectionOf("Set",setSize.call(t),$,h)}if(isWeakMap$1(t))return weakCollectionOf("WeakMap");if(isWeakSet$1(t))return weakCollectionOf("WeakSet");if(isWeakRef(t))return weakCollectionOf("WeakRef");if(isNumber$1(t))return markBoxed(d(Number(t)));if(isBigInt$1(t))return markBoxed(d(bigIntValueOf$1.call(t)));if(isBoolean$1(t))return markBoxed(booleanValueOf.call(t));if(isString$3(t))return markBoxed(d(String(t)));if(!isDate$1(t)&&!isRegExp(t)){var C=arrObjKeys(t,d),I=gPO$1?gPO$1(t)===Object.prototype:t instanceof Object||t.constructor===Object,x=t instanceof Object?"":"null prototype",E=!I&&toStringTag&&Object(t)===t&&toStringTag in t?$slice$1.call(toStr$6(t),8,-1):x?"Object":"",D=(I||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(E||x?"["+$join.call($concat.call([],E||[],x||[]),": ")+"] ":"");return 0===C.length?D+"{}":h?D+"{"+indentedJoin(C,h)+"}":D+"{ "+$join.call(C,", ")+" }"}return String(t)};function wrapQuotes(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function quote(e){return $replace.call(String(e),/"/g,"&quot;")}function isArray$2(e){return!("[object Array]"!==toStr$6(e)||toStringTag&&"object"==typeof e&&toStringTag in e)}function isDate$1(e){return!("[object Date]"!==toStr$6(e)||toStringTag&&"object"==typeof e&&toStringTag in e)}function isRegExp(e){return!("[object RegExp]"!==toStr$6(e)||toStringTag&&"object"==typeof e&&toStringTag in e)}function isError(e){return!("[object Error]"!==toStr$6(e)||toStringTag&&"object"==typeof e&&toStringTag in e)}function isString$3(e){return!("[object String]"!==toStr$6(e)||toStringTag&&"object"==typeof e&&toStringTag in e)}function isNumber$1(e){return!("[object Number]"!==toStr$6(e)||toStringTag&&"object"==typeof e&&toStringTag in e)}function isBoolean$1(e){return!("[object Boolean]"!==toStr$6(e)||toStringTag&&"object"==typeof e&&toStringTag in e)}function isSymbol$2(e){if(hasShammedSymbols)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!symToString)return!1;try{return symToString.call(e),!0}catch(e){}return!1}function isBigInt$1(e){if(!e||"object"!=typeof e||!bigIntValueOf$1)return!1;try{return bigIntValueOf$1.call(e),!0}catch(e){}return!1}var hasOwn=Object.prototype.hasOwnProperty||function(e){return e in this};function has$2(e,t){return hasOwn.call(e,t)}function toStr$6(e){return objectToString.call(e)}function nameOf(e){if(e.name)return e.name;var t=$match.call(functionToString.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function indexOf(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function isMap$3(e){if(!mapSize||!e||"object"!=typeof e)return!1;try{mapSize.call(e);try{setSize.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}function isWeakMap$1(e){if(!weakMapHas||!e||"object"!=typeof e)return!1;try{weakMapHas.call(e,weakMapHas);try{weakSetHas.call(e,weakSetHas)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}function isWeakRef(e){if(!weakRefDeref||!e||"object"!=typeof e)return!1;try{return weakRefDeref.call(e),!0}catch(e){}return!1}function isSet$3(e){if(!setSize||!e||"object"!=typeof e)return!1;try{setSize.call(e);try{mapSize.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}function isWeakSet$1(e){if(!weakSetHas||!e||"object"!=typeof e)return!1;try{weakSetHas.call(e,weakSetHas);try{weakMapHas.call(e,weakMapHas)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}function isElement(e){return!(!e||"object"!=typeof e)&&("undefined"!=typeof HTMLElement&&e instanceof HTMLElement||"string"==typeof e.nodeName&&"function"==typeof e.getAttribute)}function inspectString(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return inspectString($slice$1.call(e,0,t.maxStringLength),t)+r}return wrapQuotes($replace.call($replace.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,lowbyte),"single",t)}function lowbyte(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+$toUpperCase.call(t.toString(16))}function markBoxed(e){return"Object("+e+")"}function weakCollectionOf(e){return e+" { ? }"}function collectionOf(e,t,n,r){return e+" ("+t+") {"+(r?indentedJoin(n,r):$join.call(n,", "))+"}"}function singleLineValues(e){for(var t=0;t<e.length;t++)if(indexOf(e[t],"\n")>=0)return!1;return!0}function getIndent(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=$join.call(Array(e.indent+1)," ")}return{base:n,prev:$join.call(Array(t+1),n)}}function indentedJoin(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+$join.call(e,","+n)+"\n"+t.prev}function arrObjKeys(e,t){var n=isArray$2(e),r=[];if(n){r.length=e.length;for(var i=0;i<e.length;i++)r[i]=has$2(e,i)?t(e[i],e):""}var o,l="function"==typeof gOPS?gOPS(e):[];if(hasShammedSymbols){o={};for(var s=0;s<l.length;s++)o["$"+l[s]]=l[s]}for(var a in e)has$2(e,a)&&(n&&String(Number(a))===a&&a<e.length||hasShammedSymbols&&o["$"+a]instanceof Symbol||($test.call(/[^\w$]/,a)?r.push(t(a,e)+": "+t(e[a],e)):r.push(a+": "+t(e[a],e))));if("function"==typeof gOPS)for(var u=0;u<l.length;u++)isEnumerable.call(e,l[u])&&r.push("["+t(l[u])+"]: "+t(e[l[u]],e));return r}var GetIntrinsic$6=getIntrinsic,callBound$9=callBound$c,inspect=objectInspect,$TypeError$1=GetIntrinsic$6("%TypeError%"),$WeakMap$1=GetIntrinsic$6("%WeakMap%",!0),$Map$3=GetIntrinsic$6("%Map%",!0),$weakMapGet=callBound$9("WeakMap.prototype.get",!0),$weakMapSet=callBound$9("WeakMap.prototype.set",!0),$weakMapHas=callBound$9("WeakMap.prototype.has",!0),$mapGet$1=callBound$9("Map.prototype.get",!0),$mapSet=callBound$9("Map.prototype.set",!0),$mapHas$5=callBound$9("Map.prototype.has",!0),listGetNode=function(e,t){for(var n,r=e;null!==(n=r.next);r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n},listGet=function(e,t){var n=listGetNode(e,t);return n&&n.value},listSet=function(e,t,n){var r=listGetNode(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}},listHas=function(e,t){return!!listGetNode(e,t)},sideChannel=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new $TypeError$1("Side channel does not contain "+inspect(e))},get:function(r){if($WeakMap$1&&r&&("object"==typeof r||"function"==typeof r)){if(e)return $weakMapGet(e,r)}else if($Map$3){if(t)return $mapGet$1(t,r)}else if(n)return listGet(n,r)},has:function(r){if($WeakMap$1&&r&&("object"==typeof r||"function"==typeof r)){if(e)return $weakMapHas(e,r)}else if($Map$3){if(t)return $mapHas$5(t,r)}else if(n)return listHas(n,r);return!1},set:function(r,i){$WeakMap$1&&r&&("object"==typeof r||"function"==typeof r)?(e||(e=new $WeakMap$1),$weakMapSet(e,r,i)):$Map$3?(t||(t=new $Map$3),$mapSet(t,r,i)):(n||(n={key:{},next:null}),listSet(n,r,i))}};return r},GetIntrinsic$5=getIntrinsic,has$1=src,channel=sideChannel(),$TypeError=GetIntrinsic$5("%TypeError%"),SLOT$1={assert:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new $TypeError("`O` is not an object");if("string"!=typeof t)throw new $TypeError("`slot` must be a string");if(channel.assert(e),!SLOT$1.has(e,t))throw new $TypeError("`"+t+"` is not present on `O`")},get:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new $TypeError("`O` is not an object");if("string"!=typeof t)throw new $TypeError("`slot` must be a string");var n=channel.get(e);return n&&n["$"+t]},has:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new $TypeError("`O` is not an object");if("string"!=typeof t)throw new $TypeError("`slot` must be a string");var n=channel.get(e);return!!n&&has$1(n,"$"+t)},set:function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new $TypeError("`O` is not an object");if("string"!=typeof t)throw new $TypeError("`slot` must be a string");var r=channel.get(e);r||(r={},channel.set(e,r)),r["$"+t]=n}};Object.freeze&&Object.freeze(SLOT$1);var internalSlot=SLOT$1,SLOT=internalSlot,$SyntaxError=SyntaxError,$StopIteration="object"==typeof StopIteration?StopIteration:null,stopIterationIterator=function(e){if(!$StopIteration)throw new $SyntaxError("this environment lacks StopIteration");SLOT.set(e,"[[Done]]",!1);var t={next:function(){var e=SLOT.get(this,"[[Iterator]]"),t=SLOT.get(e,"[[Done]]");try{return{done:t,value:t?void 0:e.next()}}catch(t){if(SLOT.set(e,"[[Done]]",!0),t!==$StopIteration)throw t;return{done:!0,value:void 0}}}};return SLOT.set(t,"[[Iterator]]",e),t},toString={}.toString,isarray=Array.isArray||function(e){return"[object Array]"==toString.call(e)},strValue=String.prototype.valueOf,tryStringObject=function(e){try{return strValue.call(e),!0}catch(e){return!1}},toStr$5=Object.prototype.toString,strClass="[object String]",hasToStringTag$6=shams(),isString$2=function(e){return"string"==typeof e||"object"==typeof e&&(hasToStringTag$6?tryStringObject(e):toStr$5.call(e)===strClass)},$Map$2="function"==typeof Map&&Map.prototype?Map:null,$Set$3="function"==typeof Set&&Set.prototype?Set:null,exported$2;$Map$2||(exported$2=function(e){return!1});var $mapHas$4=$Map$2?Map.prototype.has:null,$setHas$4=$Set$3?Set.prototype.has:null;exported$2||$mapHas$4||(exported$2=function(e){return!1});var isMap$2=exported$2||function(e){if(!e||"object"!=typeof e)return!1;try{if($mapHas$4.call(e),$setHas$4)try{$setHas$4.call(e)}catch(e){return!0}return e instanceof $Map$2}catch(e){}return!1},$Map$1="function"==typeof Map&&Map.prototype?Map:null,$Set$2="function"==typeof Set&&Set.prototype?Set:null,exported$1;$Set$2||(exported$1=function(e){return!1});var $mapHas$3=$Map$1?Map.prototype.has:null,$setHas$3=$Set$2?Set.prototype.has:null;exported$1||$setHas$3||(exported$1=function(e){return!1});var isSet$2=exported$1||function(e){if(!e||"object"!=typeof e)return!1;try{if($setHas$3.call(e),$mapHas$3)try{$mapHas$3.call(e)}catch(e){return!0}return e instanceof $Set$2}catch(e){}return!1},isArguments$1=isArguments$2,getStopIterationIterator=stopIterationIterator;if(hasSymbols$5()||requireShams()()){var $iterator=Symbol.iterator;esGetIterator.exports=function(e){return null!=e&&void 0!==e[$iterator]?e[$iterator]():isArguments$1(e)?Array.prototype[$iterator].call(e):void 0}}else{var isArray$1=isarray,isString$1=isString$2,GetIntrinsic$4=getIntrinsic,$Map=GetIntrinsic$4("%Map%",!0),$Set$1=GetIntrinsic$4("%Set%",!0),callBound$8=callBound$c,$arrayPush=callBound$8("Array.prototype.push"),$charCodeAt=callBound$8("String.prototype.charCodeAt"),$stringSlice=callBound$8("String.prototype.slice"),advanceStringIndex=function(e,t){if(t+1>=e.length)return t+1;var n=$charCodeAt(e,t);if(n<55296||n>56319)return t+1;var r=$charCodeAt(e,t+1);return r<56320||r>57343?t+1:t+2},getArrayIterator=function(e){var t=0;return{next:function(){var n,r=t>=e.length;return r||(n=e[t],t+=1),{done:r,value:n}}}},getNonCollectionIterator=function(e,t){if(isArray$1(e)||isArguments$1(e))return getArrayIterator(e);if(isString$1(e)){var n=0;return{next:function(){var t=advanceStringIndex(e,n),r=$stringSlice(e,n,t);return n=t,{done:t>e.length,value:r}}}}return t&&void 0!==e["_es6-shim iterator_"]?e["_es6-shim iterator_"]():void 0};if($Map||$Set$1){var isMap$1=isMap$2,isSet$1=isSet$2,$mapForEach=callBound$8("Map.prototype.forEach",!0),$setForEach=callBound$8("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var $mapIterator=callBound$8("Map.prototype.iterator",!0),$setIterator=callBound$8("Set.prototype.iterator",!0);var $mapAtAtIterator=callBound$8("Map.prototype.@@iterator",!0)||callBound$8("Map.prototype._es6-shim iterator_",!0),$setAtAtIterator=callBound$8("Set.prototype.@@iterator",!0)||callBound$8("Set.prototype._es6-shim iterator_",!0),getCollectionIterator=function(e){if(isMap$1(e)){if($mapIterator)return getStopIterationIterator($mapIterator(e));if($mapAtAtIterator)return $mapAtAtIterator(e);if($mapForEach){var t=[];return $mapForEach(e,(function(e,n){$arrayPush(t,[n,e])})),getArrayIterator(t)}}if(isSet$1(e)){if($setIterator)return getStopIterationIterator($setIterator(e));if($setAtAtIterator)return $setAtAtIterator(e);if($setForEach){var n=[];return $setForEach(e,(function(e){$arrayPush(n,e)})),getArrayIterator(n)}}};esGetIterator.exports=function(e){return getCollectionIterator(e)||getNonCollectionIterator(e)}}else esGetIterator.exports=function(e){if(null!=e)return getNonCollectionIterator(e,!0)}}var esGetIteratorExports=esGetIterator.exports,numberIsNaN=function(e){return e!=e},implementation$2=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||!(!numberIsNaN(e)||!numberIsNaN(t))},implementation$1=implementation$2,polyfill$1=function(){return"function"==typeof Object.is?Object.is:implementation$1},getPolyfill$1=polyfill$1,define$1=defineProperties_1,shim$1=function(){var e=getPolyfill$1();return define$1(Object,{is:e},{is:function(){return Object.is!==e}}),e},define=defineProperties_1,callBind$2=callBindExports,implementation=implementation$2,getPolyfill=polyfill$1,shim=shim$1,polyfill=callBind$2(getPolyfill(),Object);define(polyfill,{getPolyfill:getPolyfill,implementation:implementation,shim:shim});var objectIs=polyfill,fnToStr=Function.prototype.toString,reflectApply="object"==typeof Reflect&&null!==Reflect&&Reflect.apply,badArrayLike,isCallableMarker;if("function"==typeof reflectApply&&"function"==typeof Object.defineProperty)try{badArrayLike=Object.defineProperty({},"length",{get:function(){throw isCallableMarker}}),isCallableMarker={},reflectApply((function(){throw 42}),null,badArrayLike)}catch(e){e!==isCallableMarker&&(reflectApply=null)}else reflectApply=null;var constructorRegex=/^\s*class\b/,isES6ClassFn=function(e){try{var t=fnToStr.call(e);return constructorRegex.test(t)}catch(e){return!1}},tryFunctionObject=function(e){try{return!isES6ClassFn(e)&&(fnToStr.call(e),!0)}catch(e){return!1}},toStr$4=Object.prototype.toString,objectClass="[object Object]",fnClass="[object Function]",genClass="[object GeneratorFunction]",ddaClass="[object HTMLAllCollection]",ddaClass2="[object HTML document.all class]",ddaClass3="[object HTMLCollection]",hasToStringTag$5="function"==typeof Symbol&&!!Symbol.toStringTag,isIE68=!(0 in[,]),isDDA=function(){return!1};if("object"==typeof document){var all=document.all;toStr$4.call(all)===toStr$4.call(document.all)&&(isDDA=function(e){if((isIE68||!e)&&(void 0===e||"object"==typeof e))try{var t=toStr$4.call(e);return(t===ddaClass||t===ddaClass2||t===ddaClass3||t===objectClass)&&null==e("")}catch(e){}return!1})}var isCallable$1=reflectApply?function(e){if(isDDA(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{reflectApply(e,null,badArrayLike)}catch(e){if(e!==isCallableMarker)return!1}return!isES6ClassFn(e)&&tryFunctionObject(e)}:function(e){if(isDDA(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(hasToStringTag$5)return tryFunctionObject(e);if(isES6ClassFn(e))return!1;var t=toStr$4.call(e);return!(t!==fnClass&&t!==genClass&&!/^\[object HTML/.test(t))&&tryFunctionObject(e)},isCallable=isCallable$1,toStr$3=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,forEachArray=function(e,t,n){for(var r=0,i=e.length;r<i;r++)hasOwnProperty.call(e,r)&&(null==n?t(e[r],r,e):t.call(n,e[r],r,e))},forEachString=function(e,t,n){for(var r=0,i=e.length;r<i;r++)null==n?t(e.charAt(r),r,e):t.call(n,e.charAt(r),r,e)},forEachObject=function(e,t,n){for(var r in e)hasOwnProperty.call(e,r)&&(null==n?t(e[r],r,e):t.call(n,e[r],r,e))},forEach$1=function(e,t,n){if(!isCallable(t))throw new TypeError("iterator must be a function");var r;arguments.length>=3&&(r=n),"[object Array]"===toStr$3.call(e)?forEachArray(e,t,r):"string"==typeof e?forEachString(e,t,r):forEachObject(e,t,r)},forEach_1=forEach$1,possibleNames=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],g$1="undefined"==typeof globalThis?commonjsGlobal$1:globalThis,availableTypedArrays$1=function(){for(var e=[],t=0;t<possibleNames.length;t++)"function"==typeof g$1[possibleNames[t]]&&(e[e.length]=possibleNames[t]);return e},GetIntrinsic$3=getIntrinsic,$gOPD=GetIntrinsic$3("%Object.getOwnPropertyDescriptor%",!0);if($gOPD)try{$gOPD([],"length")}catch(e){$gOPD=null}var gopd=$gOPD,forEach=forEach_1,availableTypedArrays=availableTypedArrays$1,callBind$1=callBindExports,callBound$7=callBound$c,gOPD$1=gopd,$toString$2=callBound$7("Object.prototype.toString"),hasToStringTag$4=shams(),g="undefined"==typeof globalThis?commonjsGlobal$1:globalThis,typedArrays=availableTypedArrays(),$slice=callBound$7("String.prototype.slice"),getPrototypeOf=Object.getPrototypeOf,$indexOf=callBound$7("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},cache={__proto__:null};forEach(typedArrays,hasToStringTag$4&&gOPD$1&&getPrototypeOf?function(e){var t=new g[e];if(Symbol.toStringTag in t){var n=getPrototypeOf(t),r=gOPD$1(n,Symbol.toStringTag);if(!r){var i=getPrototypeOf(n);r=gOPD$1(i,Symbol.toStringTag)}cache["$"+e]=callBind$1(r.get)}}:function(e){var t=new g[e];cache["$"+e]=callBind$1(t.slice)});var tryTypedArrays=function(e){var t=!1;return forEach(cache,(function(n,r){if(!t)try{"$"+n(e)===r&&(t=$slice(r,1))}catch(e){}})),t},trySlices=function(e){var t=!1;return forEach(cache,(function(n,r){if(!t)try{n(e),t=$slice(r,1)}catch(e){}})),t},whichTypedArray$2=function(e){if(!e||"object"!=typeof e)return!1;if(!hasToStringTag$4){var t=$slice($toString$2(e),8,-1);return $indexOf(typedArrays,t)>-1?t:"Object"===t&&trySlices(e)}return gOPD$1?tryTypedArrays(e):null},whichTypedArray$1=whichTypedArray$2,isTypedArray$1=function(e){return!!whichTypedArray$1(e)},callBind=callBindExports,callBound$6=callBound$c,GetIntrinsic$2=getIntrinsic,isTypedArray=isTypedArray$1,$ArrayBuffer=GetIntrinsic$2("ArrayBuffer",!0),$Float32Array=GetIntrinsic$2("Float32Array",!0),$byteLength$2=callBound$6("ArrayBuffer.prototype.byteLength",!0),abSlice=$ArrayBuffer&&!$byteLength$2&&(new $ArrayBuffer).slice,$abSlice=abSlice&&callBind(abSlice),isArrayBuffer$2=$byteLength$2||$abSlice?function(e){if(!e||"object"!=typeof e)return!1;try{return $byteLength$2?$byteLength$2(e):$abSlice(e,0),!0}catch(e){return!1}}:$Float32Array?function(e){try{return new $Float32Array(e).buffer===e&&!isTypedArray(e)}catch(t){return"object"==typeof e&&"RangeError"===t.name}}:function(e){return!1},getDay=Date.prototype.getDay,tryDateObject=function(e){try{return getDay.call(e),!0}catch(e){return!1}},toStr$2=Object.prototype.toString,dateClass="[object Date]",hasToStringTag$3=shams(),isDateObject=function(e){return"object"==typeof e&&null!==e&&(hasToStringTag$3?tryDateObject(e):toStr$2.call(e)===dateClass)},callBound$5=callBound$c,hasToStringTag$2=shams(),has,$exec,isRegexMarker,badStringifier;if(hasToStringTag$2){has=callBound$5("Object.prototype.hasOwnProperty"),$exec=callBound$5("RegExp.prototype.exec"),isRegexMarker={};var throwRegexMarker=function(){throw isRegexMarker};badStringifier={toString:throwRegexMarker,valueOf:throwRegexMarker},"symbol"==typeof Symbol.toPrimitive&&(badStringifier[Symbol.toPrimitive]=throwRegexMarker)}var $toString$1=callBound$5("Object.prototype.toString"),gOPD=Object.getOwnPropertyDescriptor,regexClass="[object RegExp]",isRegex$1=hasToStringTag$2?function(e){if(!e||"object"!=typeof e)return!1;var t=gOPD(e,"lastIndex");if(!(t&&has(t,"value")))return!1;try{$exec(e,badStringifier)}catch(e){return e===isRegexMarker}}:function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&$toString$1(e)===regexClass},callBound$4=callBound$c,$byteLength$1=callBound$4("SharedArrayBuffer.prototype.byteLength",!0),isSharedArrayBuffer$1=$byteLength$1?function(e){if(!e||"object"!=typeof e)return!1;try{return $byteLength$1(e),!0}catch(e){return!1}}:function(e){return!1},numToStr=Number.prototype.toString,tryNumberObject=function(e){try{return numToStr.call(e),!0}catch(e){return!1}},toStr$1=Object.prototype.toString,numClass="[object Number]",hasToStringTag$1=shams(),isNumberObject=function(e){return"number"==typeof e||"object"==typeof e&&(hasToStringTag$1?tryNumberObject(e):toStr$1.call(e)===numClass)},callBound$3=callBound$c,$boolToStr=callBound$3("Boolean.prototype.toString"),$toString=callBound$3("Object.prototype.toString"),tryBooleanObject=function(e){try{return $boolToStr(e),!0}catch(e){return!1}},boolClass="[object Boolean]",hasToStringTag=shams(),isBooleanObject=function(e){return"boolean"==typeof e||null!==e&&"object"==typeof e&&(hasToStringTag&&Symbol.toStringTag in e?tryBooleanObject(e):$toString(e)===boolClass)},isSymbol$1={exports:{}},toStr=Object.prototype.toString,hasSymbols=hasSymbols$5();if(hasSymbols){var symToStr=Symbol.prototype.toString,symStringRegex=/^Symbol\(.*\)$/,isSymbolObject=function(e){return"symbol"==typeof e.valueOf()&&symStringRegex.test(symToStr.call(e))};isSymbol$1.exports=function(e){if("symbol"==typeof e)return!0;if("[object Symbol]"!==toStr.call(e))return!1;try{return isSymbolObject(e)}catch(e){return!1}}}else isSymbol$1.exports=function(e){return!1};var isSymbolExports=isSymbol$1.exports,isBigint={exports:{}},$BigInt="undefined"!=typeof BigInt&&BigInt,hasBigints=function(){return"function"==typeof $BigInt&&"function"==typeof BigInt&&"bigint"==typeof $BigInt(42)&&"bigint"==typeof BigInt(42)},hasBigInts=hasBigints();if(hasBigInts){var bigIntValueOf=BigInt.prototype.valueOf,tryBigInt=function(e){try{return bigIntValueOf.call(e),!0}catch(e){}return!1};isBigint.exports=function(e){return null!=e&&"boolean"!=typeof e&&"string"!=typeof e&&"number"!=typeof e&&"symbol"!=typeof e&&"function"!=typeof e&&("bigint"==typeof e||tryBigInt(e))}}else isBigint.exports=function(e){return!1};var isBigintExports=isBigint.exports,isString=isString$2,isNumber=isNumberObject,isBoolean=isBooleanObject,isSymbol=isSymbolExports,isBigInt=isBigintExports,whichBoxedPrimitive$1=function(e){return null==e||"object"!=typeof e&&"function"!=typeof e?null:isString(e)?"String":isNumber(e)?"Number":isBoolean(e)?"Boolean":isSymbol(e)?"Symbol":isBigInt(e)?"BigInt":void 0},$WeakMap="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,$WeakSet$1="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null,exported;$WeakMap||(exported=function(e){return!1});var $mapHas$2=$WeakMap?$WeakMap.prototype.has:null,$setHas$2=$WeakSet$1?$WeakSet$1.prototype.has:null;exported||$mapHas$2||(exported=function(e){return!1});var isWeakmap=exported||function(e){if(!e||"object"!=typeof e)return!1;try{if($mapHas$2.call(e,$mapHas$2),$setHas$2)try{$setHas$2.call(e,$setHas$2)}catch(e){return!0}return e instanceof $WeakMap}catch(e){}return!1},isWeakset={exports:{}},GetIntrinsic$1=getIntrinsic,callBound$2=callBound$c,$WeakSet=GetIntrinsic$1("%WeakSet%",!0),$setHas$1=callBound$2("WeakSet.prototype.has",!0);if($setHas$1){var $mapHas$1=callBound$2("WeakMap.prototype.has",!0);isWeakset.exports=function(e){if(!e||"object"!=typeof e)return!1;try{if($setHas$1(e,$setHas$1),$mapHas$1)try{$mapHas$1(e,$mapHas$1)}catch(e){return!0}return e instanceof $WeakSet}catch(e){}return!1}}else isWeakset.exports=function(e){return!1};var isWeaksetExports=isWeakset.exports,isMap=isMap$2,isSet=isSet$2,isWeakMap=isWeakmap,isWeakSet=isWeaksetExports,whichCollection$1=function(e){if(e&&"object"==typeof e){if(isMap(e))return"Map";if(isSet(e))return"Set";if(isWeakMap(e))return"WeakMap";if(isWeakSet(e))return"WeakSet"}return!1},callBound$1=callBound$c,$byteLength=callBound$1("ArrayBuffer.prototype.byteLength",!0),isArrayBuffer$1=isArrayBuffer$2,arrayBufferByteLength=function(e){return isArrayBuffer$1(e)?$byteLength?$byteLength(e):e.byteLength:NaN},assign=object_assign,callBound=callBound$c,flags=regexp_prototype_flags,GetIntrinsic=getIntrinsic,getIterator=esGetIteratorExports,getSideChannel=sideChannel,is=objectIs,isArguments=isArguments$2,isArray=isarray,isArrayBuffer=isArrayBuffer$2,isDate=isDateObject,isRegex=isRegex$1,isSharedArrayBuffer=isSharedArrayBuffer$1,objectKeys=objectKeys$2,whichBoxedPrimitive=whichBoxedPrimitive$1,whichCollection=whichCollection$1,whichTypedArray=whichTypedArray$2,byteLength=arrayBufferByteLength,sabByteLength=callBound("SharedArrayBuffer.prototype.byteLength",!0),$getTime=callBound("Date.prototype.getTime"),gPO=Object.getPrototypeOf,$objToString=callBound("Object.prototype.toString"),$Set=GetIntrinsic("%Set%",!0),$mapHas=callBound("Map.prototype.has",!0),$mapGet=callBound("Map.prototype.get",!0),$mapSize=callBound("Map.prototype.size",!0),$setAdd=callBound("Set.prototype.add",!0),$setDelete=callBound("Set.prototype.delete",!0),$setHas=callBound("Set.prototype.has",!0),$setSize=callBound("Set.prototype.size",!0);function setHasEqualElement(e,t,n,r){for(var i,o=getIterator(e);(i=o.next())&&!i.done;)if(internalDeepEqual(t,i.value,n,r))return $setDelete(e,i.value),!0;return!1}function findLooseMatchingPrimitives(e){return void 0===e?null:"object"!=typeof e?"symbol"!=typeof e&&("string"!=typeof e&&"number"!=typeof e||+e==+e):void 0}function mapMightHaveLoosePrim(e,t,n,r,i,o){var l=findLooseMatchingPrimitives(n);if(null!=l)return l;var s=$mapGet(t,l),a=assign({},i,{strict:!1});return!(void 0===s&&!$mapHas(t,l)||!internalDeepEqual(r,s,a,o))&&(!$mapHas(e,l)&&internalDeepEqual(r,s,a,o))}function setMightHaveLoosePrim(e,t,n){var r=findLooseMatchingPrimitives(n);return null!=r?r:$setHas(t,r)&&!$setHas(e,r)}function mapHasEqualEntry(e,t,n,r,i,o){for(var l,s,a=getIterator(e);(l=a.next())&&!l.done;)if(internalDeepEqual(n,s=l.value,i,o)&&internalDeepEqual(r,$mapGet(t,s),i,o))return $setDelete(e,s),!0;return!1}function internalDeepEqual(e,t,n,r){var i=n||{};if(i.strict?is(e,t):e===t)return!0;if(whichBoxedPrimitive(e)!==whichBoxedPrimitive(t))return!1;if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return i.strict?is(e,t):e==t;var o,l=r.has(e),s=r.has(t);if(l&&s){if(r.get(e)===r.get(t))return!0}else o={};return l||r.set(e,o),s||r.set(t,o),objEquiv(e,t,i,r)}function isBuffer(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&(!(e.length>0&&"number"!=typeof e[0])&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))))}function setEquiv(e,t,n,r){if($setSize(e)!==$setSize(t))return!1;for(var i,o,l,s=getIterator(e),a=getIterator(t);(i=s.next())&&!i.done;)if(i.value&&"object"==typeof i.value)l||(l=new $Set),$setAdd(l,i.value);else if(!$setHas(t,i.value)){if(n.strict)return!1;if(!setMightHaveLoosePrim(e,t,i.value))return!1;l||(l=new $Set),$setAdd(l,i.value)}if(l){for(;(o=a.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!setHasEqualElement(l,o.value,n.strict,r))return!1}else if(!n.strict&&!$setHas(e,o.value)&&!setHasEqualElement(l,o.value,n.strict,r))return!1;return 0===$setSize(l)}return!0}function mapEquiv(e,t,n,r){if($mapSize(e)!==$mapSize(t))return!1;for(var i,o,l,s,a,u,c=getIterator(e),h=getIterator(t);(i=c.next())&&!i.done;)if(s=i.value[0],a=i.value[1],s&&"object"==typeof s)l||(l=new $Set),$setAdd(l,s);else if(void 0===(u=$mapGet(t,s))&&!$mapHas(t,s)||!internalDeepEqual(a,u,n,r)){if(n.strict)return!1;if(!mapMightHaveLoosePrim(e,t,s,a,n,r))return!1;l||(l=new $Set),$setAdd(l,s)}if(l){for(;(o=h.next())&&!o.done;)if(s=o.value[0],u=o.value[1],s&&"object"==typeof s){if(!mapHasEqualEntry(l,e,s,u,n,r))return!1}else if(!(n.strict||e.has(s)&&internalDeepEqual($mapGet(e,s),u,n,r)||mapHasEqualEntry(l,e,s,u,assign({},n,{strict:!1}),r)))return!1;return 0===$setSize(l)}return!0}function objEquiv(e,t,n,r){var i,o;if(typeof e!=typeof t)return!1;if(null==e||null==t)return!1;if($objToString(e)!==$objToString(t))return!1;if(isArguments(e)!==isArguments(t))return!1;if(isArray(e)!==isArray(t))return!1;var l=e instanceof Error,s=t instanceof Error;if(l!==s)return!1;if((l||s)&&(e.name!==t.name||e.message!==t.message))return!1;var a=isRegex(e),u=isRegex(t);if(a!==u)return!1;if((a||u)&&(e.source!==t.source||flags(e)!==flags(t)))return!1;var c=isDate(e),h=isDate(t);if(c!==h)return!1;if((c||h)&&$getTime(e)!==$getTime(t))return!1;if(n.strict&&gPO&&gPO(e)!==gPO(t))return!1;var d=whichTypedArray(e),f=whichTypedArray(t);if(d!==f)return!1;if(d||f){if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}var p=isBuffer(e),g=isBuffer(t);if(p!==g)return!1;if(p||g){if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}var w=isArrayBuffer(e),m=isArrayBuffer(t);if(w!==m)return!1;if(w||m)return byteLength(e)===byteLength(t)&&("function"==typeof Uint8Array&&internalDeepEqual(new Uint8Array(e),new Uint8Array(t),n,r));var v=isSharedArrayBuffer(e),y=isSharedArrayBuffer(t);if(v!==y)return!1;if(v||y)return sabByteLength(e)===sabByteLength(t)&&("function"==typeof Uint8Array&&internalDeepEqual(new Uint8Array(e),new Uint8Array(t),n,r));if(typeof e!=typeof t)return!1;var b=objectKeys(e),S=objectKeys(t);if(b.length!==S.length)return!1;for(b.sort(),S.sort(),i=b.length-1;i>=0;i--)if(b[i]!=S[i])return!1;for(i=b.length-1;i>=0;i--)if(!internalDeepEqual(e[o=b[i]],t[o],n,r))return!1;var $=whichCollection(e),C=whichCollection(t);return $===C&&("Set"===$||"Set"===C?setEquiv(e,t,n,r):"Map"!==$||mapEquiv(e,t,n,r))}var deepEqual$1=function(e,t,n){return internalDeepEqual(e,t,n,getSideChannel())},deepEqual$2=getDefaultExportFromCjs$1(deepEqual$1),fastDeepEqual=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,o;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(o=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,o[i]))return!1;for(i=r;0!=i--;){var l=o[i];if(!e(t[l],n[l]))return!1}return!0}return t!=t&&n!=n},equal=getDefaultExportFromCjs$1(fastDeepEqual);const getRelativeBounds=(e,t,n)=>{if("bottom"===n)return{left:t.left,top:t.top+t.height+0,width:t.width,height:e.height};if("top"===n)return{left:t.left,top:t.top-e.height-0,width:t.width,height:e.height};if("right"===n)return{left:t.left+t.width+0,top:t.top,width:e.width,height:t.height};if("left"===n)return{left:t.left-e.width-0,top:t.top,width:e.width,height:t.height};throw new Error("invalid relativeDirection")},objEqual=(e,t)=>deepEqual$2(e,t,{strict:!0}),objEqualFast=(e,t)=>equal(e,t),waitFor=(e,t)=>{let n=e;return()=>{n--,0===n&&t()}},wait=e=>new Promise((t=>setTimeout((()=>t()),e))),extractErrorMsg$1=e=>"string"==typeof e?e:e.message?JSON.stringify(e.message):JSON.stringify(e),checkMatch=(e,t)=>{if(!e.count)return!1;const n=t();return n&&(e.count=--e.count<0?0:e.count),n},clearNullUndefined=e=>{Object.keys(e).forEach((t=>{null!==e[t]&&void 0!==e[t]||delete e[t]}))};class PlatformController{constructor(e,t,n,r,i,o,l,s,a,u,c,h){this.domainsController=e,this.glueController=t,this.portsBridge=n,this.stateController=r,this.serviceWorkerController=i,this.preferredConnectionController=o,this.interceptionController=l,this.pluginsController=s,this.sessionController=a,this.licenseController=u,this.localStorageController=c,this.idbController=h}get logger(){return logger.get("main.web.platform")}get ctxTrackingGlue(){return this.glueController.contextsTrackingGlue}get systemGlue(){return this.glueController.systemGlue}get platformApi(){return this._platformApi}start(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){this.verifyLicense(e.licenseKey),yield this.idbController.start(e.user),yield this.portsBridge.configure(e),this.portsBridge.onClientUnloaded(this.handleClientUnloaded.bind(this)),yield this.glueController.start(e),yield Promise.all([this.glueController.createPlatformSystemMethod(this.handleClientMessage.bind(this)),this.glueController.createPlatformSystemStream()]),this.stateController.start(),yield this.domainsController.startAllDomains(e),this._platformApi=this.buildPlatformApi(),yield this.glueController.initClientGlue(null==e?void 0:e.browser,null==e?void 0:e.browserFactory,null===(t=null==e?void 0:e.workspaces)||void 0===t?void 0:t.isFrame,this._platformApi),yield this.serviceWorkerController.connect(e),yield this.domainsController.configurePostStartAllDomains(),yield this.pluginsController.start({platformConfig:e,plugins:null===(n=e.plugins)||void 0===n?void 0:n.definitions,api:this.platformApi,handlePluginMessage:this.handlePluginMessage.bind(this)}),e.connection&&(yield this.preferredConnectionController.start(e.connection)),this.serviceWorkerController.notifyReady(),this.portsBridge.start()}))}getClientGlue(){return this.glueController.clientGlue}handleClientMessage(e,t,n,r){this.processControllerCommand(e,"client",t.instance).then((e=>n(e))).catch((e=>r(e)))}handlePluginMessage(e,t){return __awaiter$7(this,void 0,void 0,(function*(){return this.processControllerCommand(e,"plugin",t)}))}processControllerCommand(e,t,n){var r,i,o,l;return __awaiter$7(this,void 0,void 0,(function*(){try{this.domainsController.validateDomain(e.domain)}catch(e){const i=extractErrorMsg$1(e);throw null===(r=this.logger)||void 0===r||r.trace(`rejecting execution of a command issued by a ${t}: ${n}, because of a domain validation error: ${i}`),new Error(`Cannot execute this platform control, because of domain validation error: ${i}`)}const s=Object.assign({},e,{commandId:shortid$2.generate(),callerId:n,callerType:t});null===(i=this.logger)||void 0===i||i.trace(`[${s.commandId}] received a command for a valid domain: ${e.domain} from ${t}: ${n}, forwarding to the appropriate controller`);try{const e=yield this.executeCommand(s);return null===(o=this.logger)||void 0===o||o.trace(`[${s.commandId}] this command was executed successfully, sending the result to the caller.`),e}catch(t){const n="string"==typeof t?t:t.message?JSON.stringify(t.message):JSON.stringify(t);throw null===(l=this.logger)||void 0===l||l.trace(`[${s.commandId}] this command's execution was rejected, reason: ${n}`),new Error(`The platform rejected operation ${s.operation} for domain: ${e.domain} with reason: ${n}`)}}))}handleClientUnloaded(e){this.domainsController.notifyDomainsClientUnloaded(e)}executeCommand(e){var t,n;const r=this.interceptionController.getOperationInterceptor({domain:e.domain,operation:e.operation});return r&&!(null===(t=e.settings)||void 0===t?void 0:t.skipInterception)?(null===(n=this.logger)||void 0===n||n.trace(`[${e.commandId}] The operation is being intercepted and executed by: ${r.name}`),r.intercept(e)):this.domainsController.executeControlMessage(e)}buildPlatformApi(){return{version:this.glueController.platformVersion,contextTrackGlue:this.ctxTrackingGlue,systemGlue:this.systemGlue,connectExtClient:(e,t)=>this.connectExtClient(e,t),onSystemReconnect:e=>this.onSystemReconnect(e),system:{shutdown:this.shutDown.bind(this),connection:{switchGW:this.preferredConnectionController.connectPreferred.bind(this.preferredConnectionController),switchToInternal:this.preferredConnectionController.revertToDefault.bind(this.preferredConnectionController)}}}}connectExtClient(e,t){return __awaiter$7(this,void 0,void 0,(function*(){yield this.portsBridge.handleExtConnectionRequest(e,t)}))}onSystemReconnect(e){return this.preferredConnectionController.onReconnect(e)}shutDown(){return __awaiter$7(this,void 0,void 0,(function*(){yield this.glueController.sendShutDownSignals(),this.stateController.cancel(),this.portsBridge.shutdown(),this.domainsController.shutdown(),this.serviceWorkerController.shutdown(),yield this.pluginsController.shutdown(),this.interceptionController.shutdown(),this.preferredConnectionController.shutdown(),this.glueController.shutdown(),this.sessionController.shutdown(),this.localStorageController.stop(),this.idbController.stop(),window.iobrowser={webStarted:!1}}))}verifyLicense(e){var t;if(!e||"string"!=typeof e||!e.length)throw new Error("The provided license key is not a valid string");if(!this.licenseController.verifyLicense(e).valid)throw this.logExpirationErrors(),new Error("Glue42 Core Plus cannot initialize, because there was no license token provided or it was invalid. Please contact Glue42 Sales team at licensing@glue42.com");const n=this.licenseController.getLicensePayload(e);if("trial"===n.type&&this.licenseController.checkExpired(n.expiration))throw this.logExpirationErrors(),new Error("Glue42 Core Plus cannot initialize, because the provided trial license has expired. Please contact Glue42 Sales team at licensing@glue42.com");this.licenseController.checkExpired(n.expiration)&&this.logExpirationErrors(),null===(t=this.logger)||void 0===t||t.info(`This Glue42 Core Plus is running with a ${n.type} license, which expires on: ${new Date(1e3*n.expiration).toString()}`)}logExpirationErrors(){var e,t,n,r,i;null===(e=this.logger)||void 0===e||e.error("***********************************************************************************************************"),null===(t=this.logger)||void 0===t||t.error("***********************************************************************************************************"),null===(n=this.logger)||void 0===n||n.error("********************** This is Glue42 Core Plus has an expired in invalid license **************************"),null===(r=this.logger)||void 0===r||r.error("***********************************************************************************************************"),null===(i=this.logger)||void 0===i||i.error("***********************************************************************************************************")}}const connectBrowserAppProps=["name","title","version","customProperties","icon","caption","type"],fdc3v2AppProps=["appId","name","type","details","version","title","tooltip","lang","description","categories","icons","screenshots","contactEmail","moreInfo","publisher","customConfig","hostManifests","interop","localizedVersions"];var ok$2=function(e){return{ok:!0,result:e}},err$2=function(e){return{ok:!1,error:e}},asPromise$2=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},withDefault$2=function(e,t){return!0===t.ok?t.result:e},withException$2=function(e){if(!0===e.ok)return e.result;throw e.error},map$2=function(e,t){return!0===t.ok?ok$2(e(t.result)):t},map2$2=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:ok$2(e(t.result,n.result))},mapError$2=function(e,t){return!0===t.ok?t:err$2(e(t.error))},andThen$2=function(e,t){return!0===t.ok?e(t.result):t},__assign$3=function(){return __assign$3=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign$3.apply(this,arguments)};function __rest$2(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function isEqual$2(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!=typeof t)return!1;if("object"==typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!isEqual$2(e[n],t[n]))return!1;return!0}var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(n=0;n<r.length;n++){if(!t.hasOwnProperty(r[n]))return!1;if(!isEqual$2(e[r[n]],t[r[n]]))return!1}return!0}}var isJsonArray$2=function(e){return Array.isArray(e)},isJsonObject$2=function(e){return"object"==typeof e&&null!==e&&!isJsonArray$2(e)},typeString$2=function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}},expectedGot$2=function(e,t){return"expected "+e+", got "+typeString$2(t)},printPath$2=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},prependAt$2=function(e,t){var n=t.at,r=__rest$2(t,["at"]);return __assign$3({at:e+(n||"")},r)},Decoder$2=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return mapError$2((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return asPromise$2(n.run(e))},this.runWithException=function(e){return withException$2(n.run(e))},this.map=function(t){return new e((function(e){return map$2(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return andThen$2((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,r){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(r)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?ok$2(e):err$2({message:expectedGot$2("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?ok$2(e):err$2({message:expectedGot$2("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?ok$2(e):err$2({message:expectedGot$2("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return isEqual$2(e,t)?ok$2(t):err$2({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(isJsonObject$2(e)&&t){var n={};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].decode(e[r]);if(!0!==i.ok)return void 0===e[r]?err$2({message:"the key '"+r+"' is required but was not present"}):err$2(prependAt$2("."+r,i.error));void 0!==i.result&&(n[r]=i.result)}return ok$2(n)}return isJsonObject$2(e)?ok$2(e):err$2({message:expectedGot$2("an object",e)})}))},e.array=function(t){return new e((function(e){if(isJsonArray$2(e)&&t){return e.reduce((function(e,n,r){return map2$2((function(e,t){return e.concat([t])}),e,function(e,n){return mapError$2((function(e){return prependAt$2("["+n+"]",e)}),t.decode(e))}(n,r))}),ok$2([]))}return isJsonArray$2(e)?ok$2(e):err$2({message:expectedGot$2("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(isJsonArray$2(e)){if(e.length!==t.length)return err$2({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e[r]);if(!i.ok)return err$2(prependAt$2("["+r+"]",i.error));n[r]=i.result}return ok$2(n)}return err$2({message:expectedGot$2("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.oneOf.apply(e,[t,n].concat(r))},e.intersection=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e((function(e){return[t,n].concat(r).reduce((function(t,n){return map2$2(Object.assign,t,n.decode(e))}),ok$2({}))}))},e.anyJson=function(){return new e((function(e){return ok$2(e)}))},e.unknownJson=function(){return new e((function(e){return ok$2(e)}))},e.dict=function(t){return new e((function(e){if(isJsonObject$2(e)){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=t.decode(e[r]);if(!0!==i.ok)return err$2(prependAt$2("."+r,i.error));n[r]=i.result}return ok$2(n)}return err$2({message:expectedGot$2("an object",e)})}))},e.optional=function(t){return new e((function(e){return null==e?ok$2(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e);if(!0===i.ok)return i;n[r]=i.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return err$2({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return ok$2(withDefault$2(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var r=e,i=0;i<t.length;i++){if(void 0===r)return err$2({at:printPath$2(t.slice(0,i+1)),message:"path does not exist"});if("string"==typeof t[i]&&!isJsonObject$2(r))return err$2({at:printPath$2(t.slice(0,i+1)),message:expectedGot$2("an object",r)});if("number"==typeof t[i]&&!isJsonArray$2(r))return err$2({at:printPath$2(t.slice(0,i+1)),message:expectedGot$2("an array",r)});r=r[t[i]]}return mapError$2((function(e){return void 0===r?{at:printPath$2(t),message:"path does not exist"}:prependAt$2(printPath$2(t),e)}),n.decode(r))}))},e.succeed=function(t){return new e((function(e){return ok$2(t)}))},e.fail=function(t){return new e((function(e){return err$2({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),string$2=Decoder$2.string,number$2=Decoder$2.number,boolean$1=Decoder$2.boolean,anyJson$2=Decoder$2.anyJson;Decoder$2.unknownJson;var constant$2=Decoder$2.constant,object$2=Decoder$2.object,array$2=Decoder$2.array;Decoder$2.tuple;var dict=Decoder$2.dict,optional$2=Decoder$2.optional,oneOf$2=Decoder$2.oneOf;Decoder$2.union,Decoder$2.intersection,Decoder$2.withDefault,Decoder$2.valueAt,Decoder$2.succeed,Decoder$2.fail,Decoder$2.lazy;const nonEmptyStringDecoder$2=string$2().where((e=>e.length>0),"Expected a non-empty string"),nonNegativeNumberDecoder$2=number$2().where((e=>e>=0),"Expected a non-negative number"),intentDefinitionDecoder$1=object$2({name:nonEmptyStringDecoder$2,displayName:optional$2(string$2()),contexts:optional$2(array$2(string$2())),customConfig:optional$2(object$2())}),v2TypeDecoder=oneOf$2(constant$2("web"),constant$2("native"),constant$2("citrix"),constant$2("onlineNative"),constant$2("other")),v2DetailsDecoder=object$2({url:nonEmptyStringDecoder$2}),v2IconDecoder=object$2({src:nonEmptyStringDecoder$2,size:optional$2(nonEmptyStringDecoder$2),type:optional$2(nonEmptyStringDecoder$2)}),v2ScreenshotDecoder=object$2({src:nonEmptyStringDecoder$2,size:optional$2(nonEmptyStringDecoder$2),type:optional$2(nonEmptyStringDecoder$2),label:optional$2(nonEmptyStringDecoder$2)}),v2ListensForIntentDecoder=object$2({contexts:array$2(nonEmptyStringDecoder$2),displayName:optional$2(nonEmptyStringDecoder$2),resultType:optional$2(nonEmptyStringDecoder$2),customConfig:optional$2(anyJson$2())}),v2IntentsDecoder=object$2({listensFor:optional$2(dict(v2ListensForIntentDecoder)),raises:optional$2(dict(array$2(nonEmptyStringDecoder$2)))}),v2UserChannelDecoder=object$2({broadcasts:optional$2(array$2(nonEmptyStringDecoder$2)),listensFor:optional$2(array$2(nonEmptyStringDecoder$2))}),v2AppChannelDecoder=object$2({name:nonEmptyStringDecoder$2,description:optional$2(nonEmptyStringDecoder$2),broadcasts:optional$2(array$2(nonEmptyStringDecoder$2)),listensFor:optional$2(array$2(nonEmptyStringDecoder$2))}),v2InteropDecoder=object$2({intents:optional$2(v2IntentsDecoder),userChannels:optional$2(v2UserChannelDecoder),appChannels:optional$2(array$2(v2AppChannelDecoder))}),glue42ApplicationDetailsDecoder=object$2({url:nonEmptyStringDecoder$2,top:optional$2(number$2()),left:optional$2(number$2()),width:optional$2(nonNegativeNumberDecoder$2),height:optional$2(nonNegativeNumberDecoder$2)}),glue42HostManifestsBrowserDecoder=object$2({name:optional$2(nonEmptyStringDecoder$2),type:optional$2(nonEmptyStringDecoder$2.where((e=>"window"===e),"Expected a value of window")),title:optional$2(nonEmptyStringDecoder$2),version:optional$2(nonEmptyStringDecoder$2),customProperties:optional$2(anyJson$2()),icon:optional$2(string$2()),caption:optional$2(string$2()),details:optional$2(glue42ApplicationDetailsDecoder),intents:optional$2(array$2(intentDefinitionDecoder$1)),hidden:optional$2(boolean$1())}),hostManifestsBrowserDecoder=oneOf$2(object$2({Glue42:oneOf$2(glue42HostManifestsBrowserDecoder,anyJson$2())}),anyJson$2()),v1DefinitionDecoder=object$2({name:nonEmptyStringDecoder$2,appId:nonEmptyStringDecoder$2,title:optional$2(nonEmptyStringDecoder$2),version:optional$2(nonEmptyStringDecoder$2),manifest:nonEmptyStringDecoder$2,manifestType:nonEmptyStringDecoder$2,tooltip:optional$2(nonEmptyStringDecoder$2),description:optional$2(nonEmptyStringDecoder$2),contactEmail:optional$2(nonEmptyStringDecoder$2),supportEmail:optional$2(nonEmptyStringDecoder$2),publisher:optional$2(nonEmptyStringDecoder$2),images:optional$2(array$2(object$2({url:optional$2(nonEmptyStringDecoder$2)}))),icons:optional$2(array$2(object$2({icon:optional$2(nonEmptyStringDecoder$2)}))),customConfig:anyJson$2(),intents:optional$2(array$2(intentDefinitionDecoder$1))}),v2LocalizedDefinitionDecoder=object$2({appId:optional$2(nonEmptyStringDecoder$2),name:optional$2(nonEmptyStringDecoder$2),details:optional$2(v2DetailsDecoder),version:optional$2(nonEmptyStringDecoder$2),title:optional$2(nonEmptyStringDecoder$2),tooltip:optional$2(nonEmptyStringDecoder$2),lang:optional$2(nonEmptyStringDecoder$2),description:optional$2(nonEmptyStringDecoder$2),categories:optional$2(array$2(nonEmptyStringDecoder$2)),icons:optional$2(array$2(v2IconDecoder)),screenshots:optional$2(array$2(v2ScreenshotDecoder)),contactEmail:optional$2(nonEmptyStringDecoder$2),supportEmail:optional$2(nonEmptyStringDecoder$2),moreInfo:optional$2(nonEmptyStringDecoder$2),publisher:optional$2(nonEmptyStringDecoder$2),customConfig:optional$2(array$2(anyJson$2())),hostManifests:optional$2(hostManifestsBrowserDecoder),interop:optional$2(v2InteropDecoder)}),v2DefinitionDecoder=object$2({appId:nonEmptyStringDecoder$2,name:nonEmptyStringDecoder$2,type:v2TypeDecoder,details:v2DetailsDecoder,version:optional$2(nonEmptyStringDecoder$2),title:optional$2(nonEmptyStringDecoder$2),tooltip:optional$2(nonEmptyStringDecoder$2),lang:optional$2(nonEmptyStringDecoder$2),description:optional$2(nonEmptyStringDecoder$2),categories:optional$2(array$2(nonEmptyStringDecoder$2)),icons:optional$2(array$2(v2IconDecoder)),screenshots:optional$2(array$2(v2ScreenshotDecoder)),contactEmail:optional$2(nonEmptyStringDecoder$2),supportEmail:optional$2(nonEmptyStringDecoder$2),moreInfo:optional$2(nonEmptyStringDecoder$2),publisher:optional$2(nonEmptyStringDecoder$2),customConfig:optional$2(array$2(anyJson$2())),hostManifests:optional$2(hostManifestsBrowserDecoder),interop:optional$2(v2InteropDecoder),localizedVersions:optional$2(dict(v2LocalizedDefinitionDecoder))}),allDefinitionsDecoder=oneOf$2(v1DefinitionDecoder,v2DefinitionDecoder),parseDecoderErrorToStringMessage=e=>`${e.kind} at ${e.at}: ${JSON.stringify(e.input)}. Reason - ${e.message}`;class FDC3Service{constructor(){this.fdc3ToDesktopDefinitionType={web:"window",native:"exe",citrix:"citrix",onlineNative:"clickonce",other:"window"}}toApi(){return{isFdc3Definition:this.isFdc3Definition.bind(this),parseToBrowserBaseAppData:this.parseToBrowserBaseAppData.bind(this),parseToDesktopAppConfig:this.parseToDesktopAppConfig.bind(this)}}isFdc3Definition(e){const t=allDefinitionsDecoder.run(e);return t.ok?e.appId&&e.details?{isFdc3:!0,version:"2.0"}:e.manifest?{isFdc3:!0,version:"1.2"}:{isFdc3:!1,reason:"The passed definition is not FDC3"}:{isFdc3:!1,reason:parseDecoderErrorToStringMessage(t.error)}}parseToBrowserBaseAppData(e){var t;const{isFdc3:n,version:r}=this.isFdc3Definition(e);if(!n)throw new Error("The passed definition is not FDC3");const i=allDefinitionsDecoder.run(e);if(!i.ok)throw new Error(`Invalid FDC3 ${r} definition. Error: ${parseDecoderErrorToStringMessage(i.error)}`);const o=this.getUserPropertiesFromDefinition(e,r),l={url:this.getUrl(e,r)};let s={name:e.appId,type:"window",createOptions:l,userProperties:Object.assign(Object.assign({},o),{intents:"1.2"===r?o.intents:this.getIntentsFromV2AppDefinition(e),details:l}),title:e.title,version:e.version,icon:this.getIconFromDefinition(e,r),caption:e.description,fdc3:"2.0"===r?Object.assign(Object.assign({},e),{definitionVersion:"2.0"}):void 0};if(null===(t=e.hostManifests)||void 0===t?void 0:t.Glue42){const t=glue42HostManifestsBrowserDecoder.run(e.hostManifests.Glue42);if(!t.ok)throw new Error(`Invalid FDC3 ${r} definition. Error: ${parseDecoderErrorToStringMessage(t.error)}`);if(!Object.keys(t.result).length)throw new Error("Invalid 'hostManifests['Glue42]' key");s=this.mergeBaseAppDataWithGlueManifest(s,t.result)}return s}parseToDesktopAppConfig(e){var t,n,r;const{isFdc3:i,version:o}=this.isFdc3Definition(e);if(!i)throw new Error("The passed definition is not FDC3");const l=allDefinitionsDecoder.run(e);if(!l.ok)throw new Error(`Invalid FDC3 ${o} definition. Error: ${parseDecoderErrorToStringMessage(l.error)}`);if("1.2"===o){const n=e;return{name:n.appId,type:"window",details:{url:this.getUrl(e,o)},version:n.version,title:n.title,tooltip:n.tooltip,caption:n.description,icon:null===(t=n.icons)||void 0===t?void 0:t[0].icon,intents:n.intents,customProperties:{manifestType:n.manifestType,images:n.images,contactEmail:n.contactEmail,supportEmail:n.supportEmail,publisher:n.publisher,icons:n.icons,customConfig:n.customConfig}}}const s=e;let a={name:s.appId,type:this.fdc3ToDesktopDefinitionType[s.type],details:s.details,version:s.version,title:s.title,tooltip:s.tooltip,caption:s.description,icon:this.getIconFromDefinition(s,"2.0"),intents:this.getIntentsFromV2AppDefinition(s),fdc3:Object.assign(Object.assign({},s),{definitionVersion:"2.0"})};if(null===(n=s.hostManifests)||void 0===n?void 0:n.Glue42){if("object"!=typeof s.hostManifests.Glue42||Array.isArray(s.hostManifests.Glue42))throw new Error("Invalid 'hostManifests['Glue42]' key");a=this.mergeDesktopConfigWithGlueManifest(a,null===(r=s.hostManifests)||void 0===r?void 0:r.Glue42)}return a}getUserPropertiesFromDefinition(e,t){return"1.2"===t?Object.fromEntries(Object.entries(e).filter((([e])=>!connectBrowserAppProps.includes(e)))):Object.fromEntries(Object.entries(e).filter((([e])=>!connectBrowserAppProps.includes(e)&&!fdc3v2AppProps.includes(e))))}getUrl(e,t){var n,r;let i;if("1.2"===t){const t=JSON.parse(e.manifest);i=(null===(n=t.details)||void 0===n?void 0:n.url)||t.url}else i=null===(r=e.details)||void 0===r?void 0:r.url;if(!i||"string"!=typeof i)throw new Error(`Invalid FDC3 ${t} definition. Provide valid 'url' under '${"1.2"===t?"manifest":"details"}' key`);return i}getIntentsFromV2AppDefinition(e){var t,n;const r=null===(n=null===(t=e.interop)||void 0===t?void 0:t.intents)||void 0===n?void 0:n.listensFor;if(!r)return;return Object.entries(r).map((e=>{const[t,n]=e;return Object.assign({name:t},n)}))}getIconFromDefinition(e,t){var n,r,i,o;return"1.2"===t?(null===(r=null===(n=e.icons)||void 0===n?void 0:n.find((e=>e.icon)))||void 0===r?void 0:r.icon)||void 0:(null===(o=null===(i=e.icons)||void 0===i?void 0:i.find((e=>e.src)))||void 0===o?void 0:o.src)||void 0}mergeBaseAppDataWithGlueManifest(e,t){let n=e;if(t.details){const r=Object.assign(Object.assign({},e.createOptions),t.details);n.createOptions=r,n.userProperties.details=r}return Array.isArray(t.intents)&&(n.userProperties.intents=(n.userProperties.intents||[]).concat(t.intents)),n=Object.assign(Object.assign({},n),t),delete n.details,delete n.intents,n}mergeDesktopConfigWithGlueManifest(e,t){const n=Object.assign({},e,t,{details:Object.assign(Object.assign({},e.details),t.details)});return Array.isArray(t.intents)&&(n.intents=(e.intents||[]).concat(t.intents)),n}}const decoders$1={common:{nonEmptyStringDecoder:nonEmptyStringDecoder$2,nonNegativeNumberDecoder:nonNegativeNumberDecoder$2},fdc3:{allDefinitionsDecoder:allDefinitionsDecoder,v1DefinitionDecoder:v1DefinitionDecoder,v2DefinitionDecoder:v2DefinitionDecoder}};var INTENTS_ERRORS;!function(e){e.USER_CANCELLED="User Closed Intents Resolver UI without choosing a handler",e.CALLER_NOT_DEFINED="Caller Id is not defined",e.TIMEOUT_HIT="Timeout hit",e.INTENT_NOT_FOUND="Cannot find Intent",e.HANDLER_NOT_FOUND="Cannot find Intent Handler",e.TARGET_INSTANCE_UNAVAILABLE="Cannot start Target Instance",e.INTENT_DELIVERY_FAILED="Target Instance did not add a listener",e.RESOLVER_UNAVAILABLE="Intents Resolver UI unavailable",e.RESOLVER_TIMEOUT="User did not choose a handler",e.INVALID_RESOLVER_RESPONSE="Intents Resolver UI returned invalid response",e.INTENT_HANDLER_REJECTION="Intent Handler function processing the raised intent threw an error or rejected the promise it returned"}(INTENTS_ERRORS||(INTENTS_ERRORS={}));let IoC$2=class{constructor(){this._decoders=decoders$1,this._errors={intents:INTENTS_ERRORS}}get fdc3(){return this._fdc3||(this._fdc3=(new FDC3Service).toApi()),this._fdc3}get decoders(){return this._decoders}get errors(){return this._errors}};const ioc=new IoC$2,fdc3=ioc.fdc3,decoders=ioc.decoders,errors=ioc.errors;var ok$1=function(e){return{ok:!0,result:e}},err$1=function(e){return{ok:!1,error:e}},asPromise$1=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},withDefault$1=function(e,t){return!0===t.ok?t.result:e},withException$1=function(e){if(!0===e.ok)return e.result;throw e.error},map$1=function(e,t){return!0===t.ok?ok$1(e(t.result)):t},map2$1=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:ok$1(e(t.result,n.result))},mapError$1=function(e,t){return!0===t.ok?t:err$1(e(t.error))},andThen$1=function(e,t){return!0===t.ok?e(t.result):t},__assign$2=function(){return __assign$2=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign$2.apply(this,arguments)};function __rest$1(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function isEqual$1(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!=typeof t)return!1;if("object"==typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!isEqual$1(e[n],t[n]))return!1;return!0}var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(n=0;n<r.length;n++){if(!t.hasOwnProperty(r[n]))return!1;if(!isEqual$1(e[r[n]],t[r[n]]))return!1}return!0}}var isJsonArray$1=function(e){return Array.isArray(e)},isJsonObject$1=function(e){return"object"==typeof e&&null!==e&&!isJsonArray$1(e)},typeString$1=function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}},expectedGot$1=function(e,t){return"expected "+e+", got "+typeString$1(t)},printPath$1=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},prependAt$1=function(e,t){var n=t.at,r=__rest$1(t,["at"]);return __assign$2({at:e+(n||"")},r)},Decoder$1=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return mapError$1((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return asPromise$1(n.run(e))},this.runWithException=function(e){return withException$1(n.run(e))},this.map=function(t){return new e((function(e){return map$1(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return andThen$1((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,r){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(r)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?ok$1(e):err$1({message:expectedGot$1("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?ok$1(e):err$1({message:expectedGot$1("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?ok$1(e):err$1({message:expectedGot$1("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return isEqual$1(e,t)?ok$1(t):err$1({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(isJsonObject$1(e)&&t){var n={};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].decode(e[r]);if(!0!==i.ok)return void 0===e[r]?err$1({message:"the key '"+r+"' is required but was not present"}):err$1(prependAt$1("."+r,i.error));void 0!==i.result&&(n[r]=i.result)}return ok$1(n)}return isJsonObject$1(e)?ok$1(e):err$1({message:expectedGot$1("an object",e)})}))},e.array=function(t){return new e((function(e){if(isJsonArray$1(e)&&t){return e.reduce((function(e,n,r){return map2$1((function(e,t){return e.concat([t])}),e,function(e,n){return mapError$1((function(e){return prependAt$1("["+n+"]",e)}),t.decode(e))}(n,r))}),ok$1([]))}return isJsonArray$1(e)?ok$1(e):err$1({message:expectedGot$1("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(isJsonArray$1(e)){if(e.length!==t.length)return err$1({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e[r]);if(!i.ok)return err$1(prependAt$1("["+r+"]",i.error));n[r]=i.result}return ok$1(n)}return err$1({message:expectedGot$1("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.oneOf.apply(e,[t,n].concat(r))},e.intersection=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e((function(e){return[t,n].concat(r).reduce((function(t,n){return map2$1(Object.assign,t,n.decode(e))}),ok$1({}))}))},e.anyJson=function(){return new e((function(e){return ok$1(e)}))},e.unknownJson=function(){return new e((function(e){return ok$1(e)}))},e.dict=function(t){return new e((function(e){if(isJsonObject$1(e)){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=t.decode(e[r]);if(!0!==i.ok)return err$1(prependAt$1("."+r,i.error));n[r]=i.result}return ok$1(n)}return err$1({message:expectedGot$1("an object",e)})}))},e.optional=function(t){return new e((function(e){return null==e?ok$1(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e);if(!0===i.ok)return i;n[r]=i.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return err$1({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return ok$1(withDefault$1(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var r=e,i=0;i<t.length;i++){if(void 0===r)return err$1({at:printPath$1(t.slice(0,i+1)),message:"path does not exist"});if("string"==typeof t[i]&&!isJsonObject$1(r))return err$1({at:printPath$1(t.slice(0,i+1)),message:expectedGot$1("an object",r)});if("number"==typeof t[i]&&!isJsonArray$1(r))return err$1({at:printPath$1(t.slice(0,i+1)),message:expectedGot$1("an array",r)});r=r[t[i]]}return mapError$1((function(e){return void 0===r?{at:printPath$1(t),message:"path does not exist"}:prependAt$1(printPath$1(t),e)}),n.decode(r))}))},e.succeed=function(t){return new e((function(e){return ok$1(t)}))},e.fail=function(t){return new e((function(e){return err$1({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),string$1=Decoder$1.string,number$1=Decoder$1.number,boolean=Decoder$1.boolean,anyJson$1=Decoder$1.anyJson;Decoder$1.unknownJson;var constant$1=Decoder$1.constant,object$1=Decoder$1.object,array$1=Decoder$1.array;Decoder$1.tuple,Decoder$1.dict;var optional$1=Decoder$1.optional,oneOf$1=Decoder$1.oneOf;Decoder$1.union;var intersection=Decoder$1.intersection;Decoder$1.withDefault,Decoder$1.valueAt,Decoder$1.succeed;var fail=Decoder$1.fail,lazy=Decoder$1.lazy;const nonNegativeNumberDecoder$1=number$1().where((e=>e>=0),"Expected a non-negative number"),nonEmptyStringDecoder$1=string$1().where((e=>e.length>0),"Expected a non-empty string"),anyDecoder=anyJson$1(),windowBoundsDecoder=object$1({top:number$1(),left:number$1(),width:nonNegativeNumberDecoder$1,height:nonNegativeNumberDecoder$1}),windowRelativeDirectionDecoder=oneOf$1(constant$1("top"),constant$1("left"),constant$1("right"),constant$1("bottom")),logLevelDecoder=oneOf$1(constant$1("trace"),constant$1("debug"),constant$1("info"),constant$1("warn"),constant$1("error")),channelMetaDecoder=anyJson$1().where((e=>"string"==typeof e.color&&e.color.length>0),"Expected color to be a non-empty string"),layoutTypeDecoder=oneOf$1(constant$1("Global"),constant$1("Activity"),constant$1("ApplicationDefault"),constant$1("Swimlane"),constant$1("Workspace")),componentTypeDecoder=oneOf$1(constant$1("application"),constant$1("activity")),functionCheck=(e,t)=>{const n=typeof e;return"function"===n?anyJson$1():fail(`The provided argument as ${t} should be of type function, provided: ${typeof n}`)},operationCheckConfigDecoder=object$1({operation:nonEmptyStringDecoder$1}),operationCheckResultDecoder=object$1({isSupported:boolean()}),layoutSummaryDecoder$1=object$1({name:nonEmptyStringDecoder$1,type:layoutTypeDecoder,context:optional$1(anyJson$1()),metadata:optional$1(anyJson$1())}),windowComponentStateDecoder=object$1({context:optional$1(anyJson$1()),bounds:windowBoundsDecoder,createArgs:object$1({name:optional$1(nonEmptyStringDecoder$1),url:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1())}),windowState:optional$1(nonEmptyStringDecoder$1),restoreState:optional$1(nonEmptyStringDecoder$1),instanceId:nonEmptyStringDecoder$1,isCollapsed:optional$1(boolean()),isSticky:optional$1(boolean()),restoreSettings:object$1({groupId:optional$1(nonEmptyStringDecoder$1),groupZOrder:optional$1(number$1())})}),windowLayoutComponentDecoder=object$1({type:constant$1("window"),componentType:optional$1(componentTypeDecoder),application:nonEmptyStringDecoder$1,state:windowComponentStateDecoder}),libDomainDecoder=oneOf$1(constant$1("system"),constant$1("windows"),constant$1("appManager"),constant$1("layouts"),constant$1("workspaces"),constant$1("intents"),constant$1("notifications"),constant$1("extension"),constant$1("channels"),constant$1("search"),constant$1("themes"),constant$1("manager"),constant$1("prefs")),systemOperationTypesDecoder=oneOf$1(constant$1("getEnvironment"),constant$1("getBase"),constant$1("operationCheck")),windowLayoutItemDecoder=object$1({type:constant$1("window"),config:object$1({appName:nonEmptyStringDecoder$1,windowId:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1()),url:optional$1(nonEmptyStringDecoder$1),title:optional$1(string$1()),showCloseButton:optional$1(boolean()),allowExtract:optional$1(boolean()),allowReorder:optional$1(boolean()),isMaximized:optional$1(boolean())})}),groupLayoutItemDecoder$1=object$1({type:constant$1("group"),config:anyJson$1(),children:array$1(oneOf$1(windowLayoutItemDecoder))}),columnLayoutItemDecoder$1=object$1({type:constant$1("column"),config:anyJson$1(),children:array$1(oneOf$1(groupLayoutItemDecoder$1,windowLayoutItemDecoder,lazy((()=>columnLayoutItemDecoder$1)),lazy((()=>rowLayoutItemDecoder$1))))}),rowLayoutItemDecoder$1=object$1({type:constant$1("row"),config:anyJson$1(),children:array$1(oneOf$1(columnLayoutItemDecoder$1,groupLayoutItemDecoder$1,windowLayoutItemDecoder,lazy((()=>rowLayoutItemDecoder$1))))}),workspaceLayoutComponentStateDecoder=object$1({config:anyJson$1(),context:anyJson$1(),children:array$1(oneOf$1(rowLayoutItemDecoder$1,columnLayoutItemDecoder$1,groupLayoutItemDecoder$1,windowLayoutItemDecoder))}),workspaceLayoutComponentDecoder=object$1({type:constant$1("Workspace"),application:optional$1(string$1()),state:workspaceLayoutComponentStateDecoder}),workspaceFrameComponentStateDecoder=object$1({bounds:windowBoundsDecoder,instanceId:nonEmptyStringDecoder$1,selectedWorkspace:nonNegativeNumberDecoder$1,workspaces:array$1(workspaceLayoutComponentStateDecoder),windowState:optional$1(nonEmptyStringDecoder$1),restoreState:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1())}),workspaceFrameComponentDecoder=object$1({type:constant$1("workspaceFrame"),application:nonEmptyStringDecoder$1,componentType:optional$1(componentTypeDecoder),state:workspaceFrameComponentStateDecoder}),glueLayoutDecoder=object$1({name:nonEmptyStringDecoder$1,type:layoutTypeDecoder,components:array$1(oneOf$1(windowLayoutComponentDecoder,workspaceLayoutComponentDecoder,workspaceFrameComponentDecoder)),context:optional$1(anyJson$1()),metadata:optional$1(anyJson$1()),version:optional$1(number$1())}),workspacesSandboxDecoder=object$1({flags:string$1()}),applicationDetailsDecoder=object$1({url:nonEmptyStringDecoder$1,top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1),workspacesSandbox:optional$1(workspacesSandboxDecoder)}),intentDefinitionDecoder=object$1({name:nonEmptyStringDecoder$1,displayName:optional$1(string$1()),contexts:optional$1(array$1(string$1())),customConfig:optional$1(object$1()),resultType:optional$1(nonEmptyStringDecoder$1)}),glueCoreAppDefinitionDecoder=object$1({name:nonEmptyStringDecoder$1,type:nonEmptyStringDecoder$1.where((e=>"window"===e),"Expected a value of window"),title:optional$1(nonEmptyStringDecoder$1),version:optional$1(nonEmptyStringDecoder$1),customProperties:optional$1(anyJson$1()),icon:optional$1(string$1()),caption:optional$1(string$1()),details:applicationDetailsDecoder,intents:optional$1(array$1(intentDefinitionDecoder)),hidden:optional$1(boolean()),fdc3:optional$1(decoders.fdc3.v2DefinitionDecoder)});object$1({name:nonEmptyStringDecoder$1,title:optional$1(nonEmptyStringDecoder$1),version:optional$1(nonEmptyStringDecoder$1),appId:optional$1(nonEmptyStringDecoder$1),manifest:nonEmptyStringDecoder$1,manifestType:nonEmptyStringDecoder$1,tooltip:optional$1(nonEmptyStringDecoder$1),description:optional$1(nonEmptyStringDecoder$1),contactEmail:optional$1(nonEmptyStringDecoder$1),supportEmail:optional$1(nonEmptyStringDecoder$1),publisher:optional$1(nonEmptyStringDecoder$1),images:optional$1(array$1(object$1({url:optional$1(nonEmptyStringDecoder$1)}))),icons:optional$1(array$1(object$1({icon:optional$1(nonEmptyStringDecoder$1)}))),customConfig:anyJson$1(),intents:optional$1(array$1(intentDefinitionDecoder))});const remoteStoreDecoder=object$1({url:nonEmptyStringDecoder$1,pollingInterval:optional$1(nonNegativeNumberDecoder$1),requestTimeout:optional$1(nonNegativeNumberDecoder$1),customHeaders:optional$1(anyJson$1())});object$1({fetch:anyJson$1().andThen((e=>functionCheck(e,"supplier fetch"))),timeout:optional$1(nonNegativeNumberDecoder$1),pollingInterval:optional$1(nonNegativeNumberDecoder$1),save:optional$1(anyJson$1().andThen((e=>functionCheck(e,"supplier save")))),delete:optional$1(anyJson$1().andThen((e=>functionCheck(e,"supplier delete"))))});const channelDefinitionDecoder=object$1({name:nonEmptyStringDecoder$1,meta:channelMetaDecoder,data:optional$1(anyJson$1())}),pluginDefinitionDecoder=object$1({name:nonEmptyStringDecoder$1,start:anyJson$1(),stop:optional$1(anyJson$1()),version:optional$1(nonEmptyStringDecoder$1),config:optional$1(anyJson$1()),critical:optional$1(boolean())}),allApplicationDefinitionsDecoder=oneOf$1(glueCoreAppDefinitionDecoder,decoders.fdc3.v2DefinitionDecoder,decoders.fdc3.v1DefinitionDecoder);array$1(allApplicationDefinitionsDecoder);const applicationsConfigDecoder=object$1({local:optional$1(array$1(allApplicationDefinitionsDecoder)),remote:optional$1(remoteStoreDecoder)}),layoutsConfigDecoder=object$1({mode:optional$1(oneOf$1(constant$1("idb"),constant$1("session"))),local:optional$1(array$1(glueLayoutDecoder))}),channelsConfigDecoder=object$1({definitions:array$1(channelDefinitionDecoder)}),pluginsConfigDecoder=object$1({definitions:array$1(pluginDefinitionDecoder)}),gatewayConfigDecoder=object$1({logging:optional$1(object$1({level:optional$1(logLevelDecoder),appender:optional$1(anyJson$1().andThen((e=>functionCheck(e,"gateway log appender"))))})),clients:optional$1(object$1({buffer_size:optional$1(number$1())}))}),glueConfigDecoder=anyJson$1(),maximumActiveWorkspacesDecoder=object$1({threshold:number$1().where((e=>e>1),"Expected a number larger than 1")}),idleWorkspacesDecoder=object$1({idleMSThreshold:number$1().where((e=>e>100),"Expected a number larger than 100")}),hibernationConfigDecoder=object$1({maximumActiveWorkspaces:optional$1(maximumActiveWorkspacesDecoder),idleWorkspaces:optional$1(idleWorkspacesDecoder)}),loadingConfigDecoder=object$1({delayed:optional$1(object$1({batch:optional$1(number$1()),initialOffsetInterval:optional$1(number$1()),interval:optional$1(number$1())})),defaultStrategy:optional$1(oneOf$1(constant$1("direct"),constant$1("delayed"),constant$1("lazy"))),showDelayedIndicator:optional$1(boolean())}),iframeSandBoxConfigDecoder=object$1({flags:string$1()}),workspacesConfigDecoder=object$1({src:nonEmptyStringDecoder$1,hibernation:optional$1(hibernationConfigDecoder),loadingStrategy:optional$1(loadingConfigDecoder),isFrame:optional$1(boolean()),initAsEmpty:optional$1(boolean()),frameCache:optional$1(boolean()),iframeSandbox:optional$1(iframeSandBoxConfigDecoder)}),preferredConnectionSettingsDecoder=object$1({url:nonEmptyStringDecoder$1,auth:optional$1(object$1({username:optional$1(nonEmptyStringDecoder$1),password:optional$1(nonEmptyStringDecoder$1),sessionId:optional$1(nonEmptyStringDecoder$1),provider:optional$1(nonEmptyStringDecoder$1),providerContext:optional$1(anyJson$1()),token:optional$1(nonEmptyStringDecoder$1),gatewayToken:optional$1(nonEmptyStringDecoder$1),flowName:optional$1(constant$1("sspi")),flowCallback:optional$1(anyJson$1().andThen((e=>functionCheck(e,"flowCallback function"))))})),forceIncompleteSwitch:optional$1(boolean()),discoveryIntervalMS:optional$1(nonNegativeNumberDecoder$1)}),connectionConfigDecoder=object$1({preferred:optional$1(preferredConnectionSettingsDecoder),enableManualSwitching:optional$1(boolean()),alwaysPlatform:optional$1(boolean()),allowedClientFallbackOrigin:optional$1(nonEmptyStringDecoder$1)}),windowsConfigDecoder=object$1({windowResponseTimeoutMs:optional$1(nonNegativeNumberDecoder$1),defaultWindowOpenBounds:optional$1(windowBoundsDecoder)}),serviceWorkerConfigDecoder=object$1({url:optional$1(nonEmptyStringDecoder$1),registrationPromise:optional$1(anyJson$1())}),notificationFilterDecoder=object$1({allowed:optional$1(array$1(nonEmptyStringDecoder$1)),blocked:optional$1(array$1(nonEmptyStringDecoder$1))}),notificationsConfigDecoder=object$1({enabled:optional$1(boolean()),enableToasts:optional$1(boolean()),sourceFilter:optional$1(notificationFilterDecoder),clearNotificationOnClick:optional$1(boolean())}),themesConfigDecoder=object$1({defaultTheme:optional$1(oneOf$1(constant$1("os"),constant$1("light"),constant$1("dark")))}),userConfigDecoder=object$1({username:nonEmptyStringDecoder$1}),managerAuthConfig=object$1({basic:optional$1(object$1({username:nonEmptyStringDecoder$1,password:nonEmptyStringDecoder$1})),username:optional$1(nonEmptyStringDecoder$1),token:optional$1(object$1({bearer:optional$1(nonEmptyStringDecoder$1)})),includeCredentials:optional$1(boolean())}),managerConfigDecoder=object$1({url:nonEmptyStringDecoder$1,auth:managerAuthConfig,critical:optional$1(boolean()),headers:optional$1(anyJson$1()),fetchIntervalMS:optional$1(nonNegativeNumberDecoder$1),tokenRefreshIntervalMS:optional$1(nonNegativeNumberDecoder$1),responseTimeoutMS:optional$1(nonNegativeNumberDecoder$1)}),applicationPreferencesStoreDecoder=object$1({type:optional$1(oneOf$1(constant$1("local"),constant$1("manager")))}),applicationPreferencesConfigDecoder=object$1({store:optional$1(applicationPreferencesStoreDecoder)}),platformConfigDecoder=object$1({licenseKey:nonEmptyStringDecoder$1,windows:optional$1(windowsConfigDecoder),applications:optional$1(applicationsConfigDecoder),notifications:optional$1(notificationsConfigDecoder),layouts:optional$1(layoutsConfigDecoder),channels:optional$1(channelsConfigDecoder),plugins:optional$1(pluginsConfigDecoder),serviceWorker:optional$1(serviceWorkerConfigDecoder),gateway:optional$1(gatewayConfigDecoder),connection:optional$1(connectionConfigDecoder),browser:optional$1(glueConfigDecoder),workspaces:optional$1(workspacesConfigDecoder),environment:optional$1(anyJson$1()),themes:optional$1(themesConfigDecoder),manager:optional$1(managerConfigDecoder),user:optional$1(userConfigDecoder),browserFactory:optional$1(anyJson$1().andThen((e=>functionCheck(e,"glueFactory")))),applicationPreferences:optional$1(applicationPreferencesConfigDecoder)}),windowOpenSettingsDecoder=object$1({top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1),context:optional$1(anyJson$1()),relativeTo:optional$1(nonEmptyStringDecoder$1),relativeDirection:optional$1(windowRelativeDirectionDecoder),windowId:optional$1(nonEmptyStringDecoder$1),layoutComponentId:optional$1(nonEmptyStringDecoder$1)}),interceptorRegistrationRequestDecoder=object$1({callInterceptor:anyJson$1().andThen((e=>functionCheck(e,"callInterceptor"))),interceptions:array$1(object$1({domain:libDomainDecoder,operation:nonEmptyStringDecoder$1}))}),focusEventDataDecoder=object$1({windowId:nonEmptyStringDecoder$1,hasFocus:boolean()});var isMergeableObject=function(e){return isNonNullObject(e)&&!isSpecial(e)};function isNonNullObject(e){return!!e&&"object"==typeof e}function isSpecial(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||isReactElement(e)}var canUseSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(e){return e.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(e){return Array.isArray(e)?[]:{}}function cloneUnlessOtherwiseSpecified(e,t){return!1!==t.clone&&t.isMergeableObject(e)?deepmerge(emptyTarget(e),e,t):e}function defaultArrayMerge(e,t,n){return e.concat(t).map((function(e){return cloneUnlessOtherwiseSpecified(e,n)}))}function getMergeFunction(e,t){if(!t.customMerge)return deepmerge;var n=t.customMerge(e);return"function"==typeof n?n:deepmerge}function getEnumerableOwnPropertySymbols(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}function getKeys(e){return Object.keys(e).concat(getEnumerableOwnPropertySymbols(e))}function propertyIsOnObject(e,t){try{return t in e}catch(e){return!1}}function propertyIsUnsafe(e,t){return propertyIsOnObject(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))}function mergeObject(e,t,n){var r={};return n.isMergeableObject(e)&&getKeys(e).forEach((function(t){r[t]=cloneUnlessOtherwiseSpecified(e[t],n)})),getKeys(t).forEach((function(i){propertyIsUnsafe(e,i)||(propertyIsOnObject(e,i)&&n.isMergeableObject(t[i])?r[i]=getMergeFunction(i,n)(e[i],t[i],n):r[i]=cloneUnlessOtherwiseSpecified(t[i],n))})),r}function deepmerge(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||defaultArrayMerge,n.isMergeableObject=n.isMergeableObject||isMergeableObject,n.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var r=Array.isArray(t);return r===Array.isArray(e)?r?n.arrayMerge(e,t,n):mergeObject(e,t,n):cloneUnlessOtherwiseSpecified(t,n)}deepmerge.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return deepmerge(e,n,t)}),{})};var deepmerge_1=deepmerge,cjs=deepmerge_1,deepMerge=getDefaultExportFromCjs$1(cjs);function __awaiter$1(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))}let nanoid$1=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"");function createRegistry$1(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};function r(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,i){var o=n[e];return o||(o=[],n[e]=o),o.push(t),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(t){r(t,e)}}))}),0),function(){var r=n[e];r&&(0===(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[])).length?delete n[e]:n[e]=r)}},execute:function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=n[e];if(!o||0===o.length)return[];var l=[];return o.forEach((function(n){try{var i=n.apply(void 0,t);l.push(i)}catch(t){l.push(void 0),r(t,e)}})),l},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}createRegistry$1.default=createRegistry$1;var lib$2=createRegistry$1;const SEARCH_QUERY_STATUSES={done:"done",inProgress:"in-progress",error:"error"},CLIENT_TO_PROVIDER_PROTOCOL_OPERATIONS={info:"info",search:"search",cancel:"cancel"};var ok=function(e){return{ok:!0,result:e}},err=function(e){return{ok:!1,error:e}},asPromise=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},withDefault=function(e,t){return!0===t.ok?t.result:e},withException=function(e){if(!0===e.ok)return e.result;throw e.error},map=function(e,t){return!0===t.ok?ok(e(t.result)):t},map2=function(e,t,n){return!1===t.ok?t:!1===n.ok?n:ok(e(t.result,n.result))},mapError=function(e,t){return!0===t.ok?t:err(e(t.error))},andThen=function(e,t){return!0===t.ok?e(t.result):t},__assign$1=function(){return __assign$1=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign$1.apply(this,arguments)};function __rest(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function isEqual(e,t){if(e===t)return!0;if(null===e&&null===t)return!0;if(typeof e!=typeof t)return!1;if("object"==typeof e){if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!isEqual(e[n],t[n]))return!1;return!0}var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(n=0;n<r.length;n++){if(!t.hasOwnProperty(r[n]))return!1;if(!isEqual(e[r[n]],t[r[n]]))return!1}return!0}}var isJsonArray=function(e){return Array.isArray(e)},isJsonObject=function(e){return"object"==typeof e&&null!==e&&!isJsonArray(e)},typeString=function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}},expectedGot=function(e,t){return"expected "+e+", got "+typeString(t)},printPath=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},prependAt=function(e,t){var n=t.at,r=__rest(t,["at"]);return __assign$1({at:e+(n||"")},r)},Decoder=function(){function e(t){var n=this;this.decode=t,this.run=function(e){return mapError((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),n.decode(e))},this.runPromise=function(e){return asPromise(n.run(e))},this.runWithException=function(e){return withException(n.run(e))},this.map=function(t){return new e((function(e){return map(t,n.decode(e))}))},this.andThen=function(t){return new e((function(e){return andThen((function(n){return t(n).decode(e)}),n.decode(e))}))},this.where=function(t,r){return n.andThen((function(n){return t(n)?e.succeed(n):e.fail(r)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?ok(e):err({message:expectedGot("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?ok(e):err({message:expectedGot("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?ok(e):err({message:expectedGot("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return isEqual(e,t)?ok(t):err({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(isJsonObject(e)&&t){var n={};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r].decode(e[r]);if(!0!==i.ok)return void 0===e[r]?err({message:"the key '"+r+"' is required but was not present"}):err(prependAt("."+r,i.error));void 0!==i.result&&(n[r]=i.result)}return ok(n)}return isJsonObject(e)?ok(e):err({message:expectedGot("an object",e)})}))},e.array=function(t){return new e((function(e){if(isJsonArray(e)&&t){return e.reduce((function(e,n,r){return map2((function(e,t){return e.concat([t])}),e,function(e,n){return mapError((function(e){return prependAt("["+n+"]",e)}),t.decode(e))}(n,r))}),ok([]))}return isJsonArray(e)?ok(e):err({message:expectedGot("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(isJsonArray(e)){if(e.length!==t.length)return err({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e[r]);if(!i.ok)return err(prependAt("["+r+"]",i.error));n[r]=i.result}return ok(n)}return err({message:expectedGot("a tuple of length "+t.length,e)})}))},e.union=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.oneOf.apply(e,[t,n].concat(r))},e.intersection=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e((function(e){return[t,n].concat(r).reduce((function(t,n){return map2(Object.assign,t,n.decode(e))}),ok({}))}))},e.anyJson=function(){return new e((function(e){return ok(e)}))},e.unknownJson=function(){return new e((function(e){return ok(e)}))},e.dict=function(t){return new e((function(e){if(isJsonObject(e)){var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=t.decode(e[r]);if(!0!==i.ok)return err(prependAt("."+r,i.error));n[r]=i.result}return ok(n)}return err({message:expectedGot("an object",e)})}))},e.optional=function(t){return new e((function(e){return null==e?ok(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new e((function(e){for(var n=[],r=0;r<t.length;r++){var i=t[r].decode(e);if(!0===i.ok)return i;n[r]=i.error}var o=n.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return err({message:'expected a value matching one of the decoders, got the errors ["'+o+'"]'})}))},e.withDefault=function(t,n){return new e((function(e){return ok(withDefault(t,n.decode(e)))}))},e.valueAt=function(t,n){return new e((function(e){for(var r=e,i=0;i<t.length;i++){if(void 0===r)return err({at:printPath(t.slice(0,i+1)),message:"path does not exist"});if("string"==typeof t[i]&&!isJsonObject(r))return err({at:printPath(t.slice(0,i+1)),message:expectedGot("an object",r)});if("number"==typeof t[i]&&!isJsonArray(r))return err({at:printPath(t.slice(0,i+1)),message:expectedGot("an array",r)});r=r[t[i]]}return mapError((function(e){return void 0===r?{at:printPath(t),message:"path does not exist"}:prependAt(printPath(t),e)}),n.decode(r))}))},e.succeed=function(t){return new e((function(e){return ok(t)}))},e.fail=function(t){return new e((function(e){return err({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),string=Decoder.string,number=Decoder.number;Decoder.boolean;var anyJson=Decoder.anyJson;Decoder.unknownJson;var constant=Decoder.constant,object=Decoder.object,array=Decoder.array;Decoder.tuple,Decoder.dict;var optional=Decoder.optional,oneOf=Decoder.oneOf;Decoder.union,Decoder.intersection,Decoder.withDefault,Decoder.valueAt,Decoder.succeed,Decoder.fail,Decoder.lazy;const nonEmptyStringDecoder=string().where((e=>e.length>0),"Expected a non-empty string"),nonNegativeNumberDecoder=number().where((e=>e>=0),"Expected a non-negative number"),searchTypeDecoder=object({name:nonEmptyStringDecoder,displayName:optional(nonEmptyStringDecoder)}),providerData=object({id:nonEmptyStringDecoder,interopId:nonEmptyStringDecoder,name:nonEmptyStringDecoder,appName:optional(nonEmptyStringDecoder),types:optional(array(searchTypeDecoder))}),providerLimitsDecoder=object({maxResults:optional(nonNegativeNumberDecoder),maxResultsPerType:optional(nonNegativeNumberDecoder)}),queryConfigDecoder=object({search:nonEmptyStringDecoder,providers:optional(array(providerData)),types:optional(array(searchTypeDecoder)),providerLimits:optional(providerLimitsDecoder)}),providerRegistrationConfig=object({name:nonEmptyStringDecoder,types:optional(array(searchTypeDecoder))}),operationDecoder=oneOf(constant("cancel"),constant("info"),constant("search")),queryStatusDecoder=oneOf(constant("done"),constant("in-progress"),constant("error")),searchCancelRequestDecoder=object({id:nonEmptyStringDecoder}),mainActionDecoder=object({method:nonEmptyStringDecoder,target:optional(oneOf(object({instance:nonEmptyStringDecoder}),constant("all"))),params:optional(anyJson())}),secondaryActionDecoder=object({name:nonEmptyStringDecoder,method:nonEmptyStringDecoder,target:optional(oneOf(object({instance:nonEmptyStringDecoder}),constant("all"))),params:optional(anyJson())}),queryResultDecoder=object({type:searchTypeDecoder,id:optional(nonEmptyStringDecoder),displayName:optional(nonEmptyStringDecoder),description:optional(nonEmptyStringDecoder),iconURL:optional(nonEmptyStringDecoder),metadata:optional(anyJson()),action:optional(mainActionDecoder),secondaryActions:optional(array(secondaryActionDecoder))}),legacySearchResultItemDecoder=object({type:string(),category:optional(string()),id:optional(string()),displayName:optional(string()),description:optional(string()),iconURL:optional(string()),action:optional(mainActionDecoder)}),protocolSearchResultsBatchDecoder=object({items:array(oneOf(queryResultDecoder,legacySearchResultItemDecoder)),provider:optional(providerData),queryId:nonEmptyStringDecoder,status:constant("in-progress")}),protocolSearchCompletedDecoder=object({items:array(oneOf(queryResultDecoder,legacySearchResultItemDecoder)),queryId:nonEmptyStringDecoder,status:constant("done")}),protocolProviderErrorDecoder=object({items:array(oneOf(queryResultDecoder,legacySearchResultItemDecoder)),provider:optional(providerData),queryId:nonEmptyStringDecoder,errorMessage:nonEmptyStringDecoder,status:constant("error")});class ClientController{constructor(e,t,n){this.logger=e,this.glueController=t,this.modelFactory=n,this.registry=lib$2(),this.activeQueryLookup={},this.queryIdToMasterIdLookup={},this.pendingDebounce=[],this.debounceMS=0}setDebounceMS(e){this.logger.info(`[${e.commandId}] Setting the debounceMS to: ${e.milliseconds}`),this.debounceMS=e.milliseconds,this.logger.info(`[${e.commandId}] debounceMS set to: ${e.milliseconds}`)}getDebounceMS(e){return this.logger.info(`[${e.commandId}] Getting the debounceMS`),this.debounceMS}query(e,t){return __awaiter$1(this,void 0,void 0,(function*(){if(this.debounceMS&&!t)return this.debounceQuery(e);yield this.glueController.registerMainClientMethod(this.handleProviderCall.bind(this));const{queryConfig:n,commandId:r}=e;this.logger.info(`[${r}] Initiating a query request`);let i=yield this.glueController.getAllProvidersInfo();this.logger.trace(`[${r}] Got all available providers: ${JSON.stringify(i)}`),n.providers&&(this.logger.info(`[${r}] Filtering providers by explicitly allowed providers.`),i=this.filterProvidersByAllowList(i,n.providers)),n.types&&(this.logger.info(`[${r}] Filtering providers by explicitly allowed types.`),i=this.filterProvidersByAllowedTypes(i,n.types)),i.length||this.logger.warn(`[${r}] There are no providers that can handle the query for ${e.queryConfig.search}`),this.logger.info(`[${r}] Sending query request to providers: ${JSON.stringify(i)}`);const o=yield this.glueController.sendQueryRequest(n,i);this.logger.info(`[${r}] Received responses from the providers: ${JSON.stringify(o)}`);const l=this.generateMasterQueryId(),s=this.modelFactory.buildClientQueryModel(l,this);return this.logger.info(`[${r}] The query is in progress with master id: ${l}`),this.activeQueryLookup[l]={servers:o,model:s},o.forEach((e=>{this.queryIdToMasterIdLookup[e.queryId]=l})),o.length||setTimeout((()=>{this.registry.execute(`on-query-completed-${l}`),this.cleanUpQuery(l)}),0),s.exposeFacade()}))}cancelQuery(e,t){return __awaiter$1(this,void 0,void 0,(function*(){const n=this.activeQueryLookup[e];if(!n)throw new Error(`[${t}] Cannot cancel query: ${e}, because this query does not exist`);const r=n.servers;this.logger.info(`[${t}] Sending cancel query requests`),yield Promise.all(r.map((e=>(this.logger.trace(`[${t}] Sending cancel query request to ${e.interopId} with queryId: ${e.queryId}`),this.glueController.sendQueryCancelRequest({id:e.queryId},{instance:e.interopId}))))),this.logger.info(`[${t}] The query was cancelled`)}))}processClientOnResults(e){return this.registry.add(`on-query-results-${e.masterQueryId}`,e.callback)}processClientOnCompleted(e){return this.registry.add(`on-query-completed-${e.masterQueryId}`,e.callback)}processClientOnError(e){return this.registry.add(`on-query-error-${e.masterQueryId}`,e.callback)}handleProviderCall(e){return __awaiter$1(this,void 0,void 0,(function*(){const{status:t}=e,n=queryStatusDecoder.runWithException(t),r=nanoid$1(10);switch(n){case SEARCH_QUERY_STATUSES.done:return this.handleQueryCompleted({completedConfig:e,commandId:r});case SEARCH_QUERY_STATUSES.inProgress:return this.handleQueryResults({resultsBatch:e,commandId:r});case SEARCH_QUERY_STATUSES.error:return this.handleQueryError({error:e,commandId:r});default:throw new Error(`Unrecognized status: ${t}`)}}))}handleQueryResults(e){var t,n;const{resultsBatch:r,commandId:i}=e;this.logger.trace(`[${i}] Processing a results batch from provider: ${null===(t=r.provider)||void 0===t?void 0:t.name} with id: ${null===(n=r.provider)||void 0===n?void 0:n.id}`);const o=protocolSearchResultsBatchDecoder.runWithException(r),l=this.queryIdToMasterIdLookup[o.queryId];if(!l)return void this.logger.warn(`[${i}] Received results for an unknown query. Provider ${JSON.stringify(o.provider)}, items: ${JSON.stringify(o.items)}`);this.logger.trace(`[${i}] The results batch is validated, forwarding to the callbacks`);const s=this.checkTransformLegacyResults(o.items),a={provider:o.provider,results:s};this.registry.execute(`on-query-results-${l}`,a)}handleQueryCompleted(e){const{completedConfig:t,commandId:n}=e;this.logger.trace(`[${n}] Processing a query completed message from query id: ${t.queryId}`);const r=protocolSearchCompletedDecoder.runWithException(t),i=this.queryIdToMasterIdLookup[r.queryId];if(!i)return void this.logger.warn(`[${n}] Received completed message for an unknown query. Provider query id: ${JSON.stringify(r.queryId)}`);if(r.items.length){const e={results:this.checkTransformLegacyResults(r.items)};this.registry.execute(`on-query-results-${i}`,e)}delete this.queryIdToMasterIdLookup[r.queryId];const o=this.activeQueryLookup[i];o.servers=o.servers.filter((e=>e.queryId!==r.queryId)),o.servers.length?this.logger.trace(`[${n}] Waiting for more providers to complete`):(this.logger.trace(`[${n}] All providers are done, marking this query as completed`),this.registry.execute(`on-query-completed-${i}`),this.cleanUpQuery(i))}handleQueryError(e){const{error:t,commandId:n}=e;this.logger.trace(`[${n}] Processing an error message from query: ${t.queryId}`);const r=protocolProviderErrorDecoder.runWithException(t),i=this.queryIdToMasterIdLookup[r.queryId];if(!i)return void this.logger.warn(`[${n}] Received error message for an unknown query. Provider query id: ${JSON.stringify(r.queryId)} and message: ${JSON.stringify(r.errorMessage)}`);const o={error:r.errorMessage,provider:r.provider};this.registry.execute(`on-query-error-${i}`,o)}filterProvidersByAllowList(e,t){const n=t.reduce(((e,t)=>(e[t.id]=!0,e)),{});return e.filter((e=>e.info.providers.some((e=>n[e.id]))))}filterProvidersByAllowedTypes(e,t){const n=t.reduce(((e,t)=>(e[t.name]=!0,e)),{});return e.filter((e=>{const t=e.info.supportedTypes;return!!t.some((e=>"*"===e))||(!t||!t.length||t.some((e=>n[e])))}))}generateMasterQueryId(){const e=nanoid$1(10);return this.activeQueryLookup[e]?this.generateMasterQueryId():e}cleanUpQuery(e){this.registry.clearKey(`on-query-results-${e}`),this.registry.clearKey(`on-query-completed-${e}`),this.registry.clearKey(`on-query-error-${e}`),delete this.activeQueryLookup[e]}debounceQuery(e){return new Promise(((t,n)=>{clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout((()=>{const t=[...this.pendingDebounce];this.pendingDebounce=[],this.query(e,!0).then((e=>t.forEach((({resolve:t})=>t(e))))).catch((e=>t.forEach((({reject:t})=>t(e)))))}),this.debounceMS),this.pendingDebounce.push({resolve:t,reject:n})}))}checkTransformLegacyResults(e){if(!e.length)return[];const t=e[0];return t&&"object"!=typeof t.type?e.map((e=>({type:{name:e.type,displayName:e.category},id:e.id,displayName:e.displayName,description:e.description,iconURL:e.iconURL,action:e.action}))):e}}const MAIN_PROVIDER_METHOD_NAME="T42.Search.Provider",MAIN_CLIENT_METHOD_NAME="T42.Search.Client",SEQUELIZER_INTERVAL_MS=10,FLUSH_SEQUELIZER_INTERVAL_MS=10,FLUSH_TIMEOUT_MS=100,STALE_QUERY_TIMEOUT_MS=9e5;let GlueController$1=class{constructor(e){this.glue=e}get myAppName(){return this.glue.interop.instance.applicationName}get myInteropId(){return this.glue.interop.instance.instance}registerMainProviderMethod(e){return __awaiter$1(this,void 0,void 0,(function*(){this.checkMyMethodExists(MAIN_PROVIDER_METHOD_NAME).exists||(yield this.glue.interop.register(MAIN_PROVIDER_METHOD_NAME,e))}))}registerMainClientMethod(e){return __awaiter$1(this,void 0,void 0,(function*(){this.checkMyMethodExists(MAIN_CLIENT_METHOD_NAME).exists||(yield this.glue.interop.register(MAIN_CLIENT_METHOD_NAME,e))}))}clearMainProviderMethod(){return __awaiter$1(this,void 0,void 0,(function*(){yield this.glue.interop.unregister(MAIN_PROVIDER_METHOD_NAME)}))}sendClientResultsBatch(e,t,n){return __awaiter$1(this,void 0,void 0,(function*(){const r={items:e.results,provider:e.provider,queryId:n,status:SEARCH_QUERY_STATUSES.inProgress};yield this.glue.interop.invoke(MAIN_CLIENT_METHOD_NAME,r,{instance:t})}))}sendClientQueueCompleted(e,t){return __awaiter$1(this,void 0,void 0,(function*(){const n={items:[],queryId:t,status:SEARCH_QUERY_STATUSES.done};yield this.glue.interop.invoke(MAIN_CLIENT_METHOD_NAME,n,{instance:e})}))}sendClientErrorMessage(e,t,n,r){return __awaiter$1(this,void 0,void 0,(function*(){const i={items:[],provider:r,errorMessage:e,queryId:n,status:SEARCH_QUERY_STATUSES.error};yield this.glue.interop.invoke(MAIN_CLIENT_METHOD_NAME,i,{instance:t})}))}sendQueryRequest(e,t){return __awaiter$1(this,void 0,void 0,(function*(){if(!t.length)return[];const n=t.map((e=>({instance:e.interopId}))),r=Object.assign({operation:CLIENT_TO_PROVIDER_PROTOCOL_OPERATIONS.search,apiVersion:"1"},e);return((yield this.glue.interop.invoke(MAIN_PROVIDER_METHOD_NAME,r,n)).all_return_values||[]).map((e=>{var t;return{interopId:null===(t=e.executed_by)||void 0===t?void 0:t.instance,queryId:e.returned.id}}))}))}sendQueryCancelRequest(e,t){return __awaiter$1(this,void 0,void 0,(function*(){const n={operation:CLIENT_TO_PROVIDER_PROTOCOL_OPERATIONS.cancel,id:e.id};yield this.glue.interop.invoke(MAIN_PROVIDER_METHOD_NAME,n,t)}))}getAllProvidersInfo(){return __awaiter$1(this,void 0,void 0,(function*(){if(this.glue.interop.methods().every((e=>e.name!==MAIN_PROVIDER_METHOD_NAME)))return[];const e={operation:CLIENT_TO_PROVIDER_PROTOCOL_OPERATIONS.info},t=yield this.glue.interop.invoke(MAIN_PROVIDER_METHOD_NAME,e,"all");return(t.all_return_values||[]).map((e=>{var n,r,i,o,l;const s=void 0===e.returned.apiVersion?{supportedTypes:e.returned.supportedTypes,apiVersion:e.returned.apiVersion,providers:[{interopId:null===(n=e.executed_by)||void 0===n?void 0:n.instance,id:null===(r=e.executed_by)||void 0===r?void 0:r.instance,name:null===(i=e.executed_by)||void 0===i?void 0:i.instance,appName:null===(o=t.executed_by)||void 0===o?void 0:o.application,types:e.returned.supportedTypes.map((e=>({name:e})))}]}:e.returned;return{interopId:null===(l=e.executed_by)||void 0===l?void 0:l.instance,info:s}}))}))}checkMyMethodExists(e){return{exists:this.glue.interop.methodsForInstance({instance:this.glue.interop.instance.instance}).some((t=>t.name===e))}}};class MainController{constructor(e,t,n,r){this.logger=e,this.glueController=t,this.clientController=n,this.providerController=r}setDebounceMS(e){this.logger.info(`[${e.commandId}] Starting setDebounceMS operation with duration ${e.milliseconds}`),this.clientController.setDebounceMS(e),this.logger.info(`[${e.commandId}] Operation setDebounceMS with duration ${e.milliseconds} completed`)}getDebounceMS(e){return this.logger.info(`[${e.commandId}] Starting getDebounceMS operation.`),this.clientController.getDebounceMS(e)}query(e){return __awaiter$1(this,void 0,void 0,(function*(){if(this.logger.info(`[${e.commandId}] Starting query operation with config ${JSON.stringify(e.queryConfig)}`),Array.isArray(e.queryConfig.providers)&&!e.queryConfig.providers.length)throw new Error("Cannot sent a query with a defined empty array of providers, because this is an impossible query for complete.");if(Array.isArray(e.queryConfig.types)&&!e.queryConfig.types.length)throw new Error("Cannot sent a query with a defined empty array of types, because this is an impossible query for complete.");const t=yield this.clientController.query(e);return this.logger.info(`[${e.commandId}] Operation query with config ${JSON.stringify(e.queryConfig)} completed.`),t}))}registerProvider(e){return __awaiter$1(this,void 0,void 0,(function*(){this.logger.info(`[${e.commandId}] Starting registerProvider operation with config ${JSON.stringify(e.config)}`);const t=yield this.providerController.processRegisterProvider(e);return this.logger.info(`[${e.commandId}] Operation registerProvider with config ${JSON.stringify(e.config)} completed.`),t}))}providers(e){return __awaiter$1(this,void 0,void 0,(function*(){this.logger.info(`[${e.commandId}] Starting providers operation.`);const t=(yield this.glueController.getAllProvidersInfo()).flatMap((e=>e.info.providers));return this.logger.info(`[${e.commandId}] Operation providers completed.`),t}))}types(e){return __awaiter$1(this,void 0,void 0,(function*(){this.logger.info(`[${e.commandId}] Starting types operation.`);const t=(yield this.glueController.getAllProvidersInfo()).flatMap((e=>e.info.providers)).filter((e=>!!e.types)).flatMap((e=>e.types)),n=[...new Set(t)];return this.logger.info(`[${e.commandId}] Operation types completed.`),n}))}}const extractErrorMsg=e=>"string"==typeof e?e:e.message?JSON.stringify(e.message):JSON.stringify(e);class ProviderController{constructor(e,t,n,r,i){this.logger=e,this.glueController=t,this.sequelizer=n,this.limitsTracker=r,this.modelsFactory=i,this.registry=lib$2(),this.providersModels={},this.activeQueries={}}processRegisterProvider(e){return __awaiter$1(this,void 0,void 0,(function*(){const{config:t,commandId:n}=e;this.logger.info(`[${n}] enqueueing the provider registration process with config: ${JSON.stringify(t)}`);const r=yield this.sequelizer.enqueue((()=>__awaiter$1(this,void 0,void 0,(function*(){if((yield this.glueController.getAllProvidersInfo()).flatMap((e=>e.info.providers)).some((e=>e&&e.name===t.name)))throw new Error(`Cannot register a new provider with name: ${t.name}, because there already is a provider with this name`);yield this.glueController.registerMainProviderMethod(this.handleSearchQueryRequest.bind(this));const e={id:nanoid$1(10),name:t.name,interopId:this.glueController.myInteropId,appName:this.glueController.myAppName,types:t.types},n=this.modelsFactory.buildProviderModel(e,this);return this.providersModels[e.id]=n,n.exposeFacade()}))));return this.logger.info(`[${n}] the provider with name: ${t.name} has been registered.`),r}))}processProviderOnQuery(e){return this.registry.add(`on-search-query-${e.id}`,e.callback)}processProviderOnQueryCancel(e){return this.registry.add(`on-cancel-query-${e.id}`,e.callback)}processProviderUnregister(e){return __awaiter$1(this,void 0,void 0,(function*(){this.logger.info(`[${e.commandId}] enqueueing the provider un-registration with id: ${e.id}`),yield this.sequelizer.enqueue((()=>__awaiter$1(this,void 0,void 0,(function*(){this.cleanUpProvider(e.id,e.commandId),Object.keys(this.providersModels).length||(yield this.glueController.clearMainProviderMethod())})))),this.logger.info(`[${e.commandId}] the provider un-registration with id: ${e.id} completed`)}))}processProviderQueryDone(e){var t;return __awaiter$1(this,void 0,void 0,(function*(){const{commandId:n,identification:r}=e;null===(t=this.activeQueries[r.queryId])||void 0===t||t.publisher.syncSuspendProvider(r.providerId,n),yield this.sequelizer.enqueue((()=>__awaiter$1(this,void 0,void 0,(function*(){this.logger.trace(`[${n}] Processing a query done command with identification: ${JSON.stringify(r)}`);const e=this.activeQueries[r.queryId];e?(yield this.cleanUpProviderQuery(r.queryId,r.providerId,n),e.providersAtWork.length?this.logger.trace(`[${n}] Query done command completed, but there are more providers still at work.`):(this.cleanUpQuery(r.queryId,n),this.logger.trace(`[${n}] Query is completed, signalling.`))):this.logger.warn(`[${n}] Cannot mark provider: ${r.providerId} done with query ${r.queryId}, because there is no active query with this id`)}))))}))}processProviderQueryError(e){var t;const{commandId:n,identification:r,error:i}=e;return this.logger.warn(`[${n}] Processing an error sent by provider: ${r.providerId} for query id: ${r.queryId} -> ${i}`),null===(t=this.activeQueries[r.queryId])||void 0===t||t.publisher.markProviderError(e),this.processProviderQueryDone(e)}processProviderQueryResult(e){const{commandId:t,identification:n}=e,r=this.activeQueries[n.queryId];if(!r){const t=`Will not send this result to the client, because there is no active query with id ${n.queryId}. Most likely this query was cancelled.`;throw this.logger.warn(`[${e}] ${t}`),new Error(t)}if(r.publisher.checkProviderSuspended(n.providerId)){const t=`Will not send this result to the client, because there is no info about this provider in the active query with id ${n.queryId}. Most likely this query was marked as done by this provider already.`;throw this.logger.warn(`[${e}] ${t}`),new Error(t)}const i=r.requestedTypes;if(i&&i.every((t=>t.name!==e.result.type.name))){const t=`Will not send this result to the client, because this result has a defined type: ${e.result.type.name} which is not in the explicitly requested list of types by the client.`;throw this.logger.warn(`[${e}] ${t}`),new Error(t)}const o=this.limitsTracker.testResultLimit(e);if(null==o?void 0:o.maxLimitHit){const t=`Will not process this result from provider ${e.identification.providerId}, because this provider has reached the max results limit set by the client. This provider cannot send more result, marking it as done.`;throw this.logger.info(t),setTimeout((()=>this.processProviderQueryDone(e)),0),new Error(t)}if(null==o?void 0:o.maxLimitPerTypeHit){const t=`Will not process this result from provider ${e.identification.providerId}, because this provider has reached the max results limit per type as set by the client.`;throw this.logger.info(t),new Error(t)}this.logger.trace(`[${t}] An active query for query ${n.queryId} was found and the provider is within limits, queueing the result`),this.limitsTracker.update(e),r.publisher.queueResult(e),this.logger.trace(`[${t}] The query result was queued successfully.`)}handleSearchQueryRequest(e,t){return __awaiter$1(this,void 0,void 0,(function*(){const{operation:n}=e,r=operationDecoder.runWithException(n),i=nanoid$1(10);switch(r){case CLIENT_TO_PROVIDER_PROTOCOL_OPERATIONS.info:return this.handleInfoOperation({commandId:i});case CLIENT_TO_PROVIDER_PROTOCOL_OPERATIONS.search:return this.handleSearchOperation({args:e,commandId:i},t);case CLIENT_TO_PROVIDER_PROTOCOL_OPERATIONS.cancel:return this.handleCancelOperation({args:e,commandId:i});default:throw new Error(`Unrecognized operation: ${n}`)}}))}handleInfoOperation(e){return __awaiter$1(this,void 0,void 0,(function*(){this.logger.info(`[${e.commandId}] handling an info operation`);const t=Object.values(this.providersModels).flatMap((e=>e.myProviderData.types||[])),n=[...new Set(t)];Object.values(this.providersModels).some((e=>!e.myProviderData.types))&&n.push({name:"*"});const r=Object.values(this.providersModels).map((e=>e.myProviderData)),i={supportedTypes:n.map((e=>e.name)),providers:r,apiVersion:"1"};return this.logger.info(`[${e.commandId}] responding to an info operation with: ${JSON.stringify(i)}`),i}))}handleSearchOperation(e,t){return __awaiter$1(this,void 0,void 0,(function*(){const n=e.commandId,r=this.generateQueryId();this.logger.info(`[${n}] Processing search operation with queryId: ${r} request details: ${JSON.stringify(e.args)}`);const i=this.checkRequestLegacy(e.args),o=this.prepareRequest(e.args,i,n);return this.logger.info(`[${n}] Search operation with queryId: ${r} is validated. Creating an active query and enqueueing calling the providers.`),this.activeQueries[r]={queryId:r,callerInstanceId:t.instance,providersAtWork:[],requestedTypes:o.types,publisher:this.modelsFactory.buildPublisher(t.instance,r,i),staleTimer:this.setClearStaleQueryTimer(r)},o.providerLimits&&this.limitsTracker.enableTracking(o.providerLimits,r),setTimeout((()=>{this.sequelizer.enqueue((()=>__awaiter$1(this,void 0,void 0,(function*(){try{this.logger.info(`[${n}] Calling the providers.`),this.callProviders(o,r,n)}catch(e){this.logger.error(`[${n}] Error calling the providers: ${extractErrorMsg(e)}`)}}))))}),0),this.logger.info(`[${n}] Search operation with queryID: ${r} processed successfully.`),{id:r}}))}handleCancelOperation(e){return __awaiter$1(this,void 0,void 0,(function*(){yield this.sequelizer.enqueue((()=>__awaiter$1(this,void 0,void 0,(function*(){const t=searchCancelRequestDecoder.run(e.args);if(!t.ok){const n=`Cannot process a cancel request, because of validation error: ${JSON.stringify(t.error)}`;throw this.logger.warn(`[${e.commandId}] ${n}`),new Error(n)}const n=t.result,r=this.activeQueries[n.id];r&&(clearTimeout(r.staleTimer),r.publisher.cancel(e.commandId),delete this.activeQueries[n.id],r.providersAtWork.forEach((e=>this.registry.execute(`on-cancel-query-${e.myProviderData.id}`,{id:n.id}))))}))))}))}generateQueryId(){const e=nanoid$1(10);return this.activeQueries[e]?this.generateQueryId():e}translateLegacySearchRequest(e){var t;return{search:e.search,types:null===(t=e.types)||void 0===t?void 0:t.map((e=>({name:e}))),providerLimits:{maxResults:e.limit,maxResultsPerType:e.categoryLimit}}}checkRequestLegacy(e){return void 0===e.apiVersion}callProviders(e,t,n){let r=e.providers?this.getFilteredProviderModels(e.providers):Object.values(this.providersModels);this.logger.trace(`[${n}] initial providers filtration yielded: ${JSON.stringify(r.map((e=>e.myProviderData.name)).join(", "))}`),r=e.types?this.getFilteredProvidersBySearchTypes(r,e.types):r,this.logger.trace(`[${n}] search type providers filtration yielded: ${JSON.stringify(r.map((e=>e.myProviderData.name)).join(", "))}`),this.activeQueries[t].publisher.configureProviders(r),this.activeQueries[t].providersAtWork.push(...r),r.forEach((r=>this.callProvider(r,e,t,n)))}callProvider(e,t,n,r){const i=this.modelsFactory.buildProviderQueryModel(t,{queryId:n,providerId:e.myProviderData.id},this).exposeFacade();this.logger.info(`[${r}] The query facade for provider: ${e.myProviderData.id} with name ${e.myProviderData.name} is ready, raising the event for query ID: ${n}.`),this.registry.execute(`on-search-query-${e.myProviderData.id}`,i)}getFilteredProviderModels(e){const t=e.reduce(((e,t)=>(this.providersModels[t.id]&&e.push(this.providersModels[t.id]),e)),[]);return t}getFilteredProvidersBySearchTypes(e,t){return e.filter((e=>{var n;return!e.myProviderData.types||!e.myProviderData.types.length||(null===(n=e.myProviderData.types)||void 0===n?void 0:n.some((e=>t.some((t=>t.name===e.name)))))}))}setClearStaleQueryTimer(e){return setTimeout((()=>{const t=nanoid$1(10);this.logger.info(`[${t}] Stale query timer is activated for queryId: ${e}`);this.activeQueries[e]?(this.logger.info(`[${t}] force-marking the query as done`),this.cleanUpQuery(e,t),this.logger.info(`[${t}] the stale query was cleared.`)):this.logger.info(`[${t}] No active query was found, this was a false activation.`)}),STALE_QUERY_TIMEOUT_MS)}prepareRequest(e,t,n){const r=t?this.translateLegacySearchRequest(e):e,i=queryConfigDecoder.run(r);if(!i.ok){const e=`Cannot process a search request, because of validation error: ${JSON.stringify(i.error)}`;throw this.logger.warn(`[${n}] ${e}`),new Error(e)}return i.result}cleanUpQuery(e,t){const n=this.activeQueries[e];clearTimeout(n.staleTimer),n.publisher.cleanPublisher(t),delete this.activeQueries[e],this.limitsTracker.cleanTracking(e)}cleanUpProvider(e,t){this.registry.clearKey(`on-search-query-${e}`),this.registry.clearKey(`on-cancel-query-${e}`),delete this.providersModels[e];Object.values(this.activeQueries).filter((t=>!t.publisher.checkProviderSuspended(e))).forEach((n=>{this.processProviderQueryDone({identification:{queryId:n.queryId,providerId:e},commandId:t})}))}cleanUpProviderQuery(e,t,n){return __awaiter$1(this,void 0,void 0,(function*(){const r=this.activeQueries[e];r?(r.providersAtWork=r.providersAtWork.filter((e=>e.myProviderData.id!==t)),yield r.publisher.markProviderDone(t,n)):this.logger.warn(`[${n}] Cannot clean up a provider query ${e} for provider ${t} because there is no such active query`)}))}}var version$3="2.2.0";class SearchFacade{constructor(e){this.main=e}exposeApi(){const e={version:version$3,setDebounceMS:this.setDebounceMS.bind(this),getDebounceMS:this.getDebounceMS.bind(this),listProviders:this.providers.bind(this),listTypes:this.types.bind(this),query:this.query.bind(this),registerProvider:this.registerProvider.bind(this)};return Object.freeze(e)}setDebounceMS(e){nonNegativeNumberDecoder.runWithException(e);const t=nanoid$1(10);return this.main.setDebounceMS({milliseconds:e,commandId:t})}getDebounceMS(){const e=nanoid$1(10);return this.main.getDebounceMS({commandId:e})}providers(){return __awaiter$1(this,void 0,void 0,(function*(){const e=nanoid$1(10);return this.main.providers({commandId:e})}))}types(){return __awaiter$1(this,void 0,void 0,(function*(){const e=nanoid$1(10);return this.main.types({commandId:e})}))}query(e){return __awaiter$1(this,void 0,void 0,(function*(){const t=queryConfigDecoder.runWithException(e),n=nanoid$1(10);return this.main.query({queryConfig:t,commandId:n})}))}registerProvider(e){return __awaiter$1(this,void 0,void 0,(function*(){const t=providerRegistrationConfig.runWithException(e),n=nanoid$1(10);return this.main.registerProvider({config:t,commandId:n})}))}}let AsyncSequelizer$2=class{constructor(e=0){this.minSequenceInterval=e,this.queue=[],this.isExecutingQueue=!1}enqueue(e){return new Promise(((t,n)=>{this.queue.push({action:e,resolve:t,reject:n}),this.executeQueue()}))}executeQueue(){return __awaiter$1(this,void 0,void 0,(function*(){if(!this.isExecutingQueue){for(this.isExecutingQueue=!0;this.queue.length;){const e=this.queue.shift();if(!e)return void(this.isExecutingQueue=!1);try{const t=yield e.action();e.resolve(t)}catch(t){e.reject(t)}yield this.intervalBreak()}this.isExecutingQueue=!1}}))}intervalBreak(){return new Promise((e=>setTimeout(e,this.minSequenceInterval)))}};class LimitsTracker{constructor(){this.limitsLookup={},this.limitsData={}}enableTracking(e,t){this.limitsLookup[t]={},this.limitsData[t]={maxResults:e.maxResults?e.maxResults:Number.MAX_SAFE_INTEGER,maxResultsPerType:e.maxResultsPerType?e.maxResultsPerType:Number.MAX_SAFE_INTEGER}}testResultLimit(e){const t=this.limitsLookup[e.identification.queryId],n=this.limitsData[e.identification.queryId];if(!t||!n)return;let r=t[e.identification.providerId];if(r||(r={total:0},t[e.identification.providerId]=r),r.total+1>n.maxResults)return{maxLimitHit:!0};const i=e.result.type.name;if(!i)return;return(r[i]||0)+1>n.maxResultsPerType?{maxLimitPerTypeHit:!0}:void 0}update(e){const t=this.limitsLookup[e.identification.queryId],n=this.limitsData[e.identification.queryId];if(!t||!n)return;const r=t[e.identification.providerId];r.total+=1;const i=e.result.type.name;i&&(r[i]=r[i]?r[i]+1:1)}cleanTracking(e){delete this.limitsLookup[e],delete this.limitsData[e]}}class ClientQuery{constructor(e,t,n){this.controller=e,this.logger=t,this.masterQueryId=n}exposeFacade(){const e={cancel:this.cancel.bind(this),onResults:this.onResults.bind(this),onCompleted:this.onCompleted.bind(this),onError:this.onError.bind(this)};return Object.freeze(e)}cancel(){return __awaiter$1(this,void 0,void 0,(function*(){const e=nanoid$1(10);this.logger.info(`[${e}] received a valid query cancel request, forwarding to the controller.`),yield this.controller.cancelQuery(this.masterQueryId,e),this.logger.info(`[${e}] the cancel request was completed.`)}))}onResults(e){if("function"!=typeof e)throw new Error("onQuery requires a callback of type function");const t=nanoid$1(10);this.logger.info(`[${t}] received a valid query onResults request, forwarding to the controller.`);const n=this.controller.processClientOnResults({callback:e,masterQueryId:this.masterQueryId,commandId:t});return this.logger.info(`[${t}] the onResults request was completed.`),n}onCompleted(e){if("function"!=typeof e)throw new Error("onQuery requires a callback of type function");const t=nanoid$1(10);this.logger.info(`[${t}] received a valid query onCompleted request, forwarding to the controller.`);const n=this.controller.processClientOnCompleted({callback:e,masterQueryId:this.masterQueryId,commandId:t});return this.logger.info(`[${t}] the onCompleted request was completed.`),n}onError(e){if("function"!=typeof e)throw new Error("onQuery requires a callback of type function");const t=nanoid$1(10);this.logger.info(`[${t}] received a valid query onError request, forwarding to the controller.`);const n=this.controller.processClientOnError({callback:e,masterQueryId:this.masterQueryId,commandId:t});return this.logger.info(`[${t}] the onError request was completed.`),n}}class ProviderModel{constructor(e,t,n){this.myData=e,this.controller=t,this.logger=n}get id(){return this.myData.id}get name(){return this.myData.name}get appName(){return this.myData.appName}get types(){return this.myData.types}get myProviderData(){return Object.assign({},this.myData)}exposeFacade(){const e={interopId:this.myData.interopId,id:this.id,name:this.name,appName:this.appName,types:this.types,onQuery:this.onQuery.bind(this),onQueryCancel:this.onQueryCancel.bind(this),unregister:this.unregister.bind(this)};return Object.freeze(e)}onQuery(e){if("function"!=typeof e)throw new Error("onQuery requires a callback of type function");const t=nanoid$1(10);this.logger.info(`[${t}] received a valid onQuery request, forwarding to the controller.`);const n=this.controller.processProviderOnQuery({callback:e,id:this.id,commandId:t});return this.logger.info(`[${t}] the onQuery request was completed.`),n}onQueryCancel(e){if("function"!=typeof e)throw new Error("onQuery requires a callback of type function");const t=nanoid$1(10);this.logger.info(`[${t}] received a valid onQueryCancel request, forwarding to the controller.`);const n=this.controller.processProviderOnQueryCancel({callback:e,id:this.id,commandId:t});return this.logger.info(`[${t}] the onQueryCancel request was completed.`),n}unregister(){return __awaiter$1(this,void 0,void 0,(function*(){const e=nanoid$1(10);this.logger.info(`[${e}] received a valid unregister request, forwarding to the controller.`),yield this.controller.processProviderUnregister({id:this.id,commandId:e}),this.logger.info(`[${e}] the unregister request was completed.`)}))}}class ProviderQueryModel{constructor(e,t,n,r){this.myData=e,this.controller=t,this.logger=n,this.identification=r}get id(){return this.identification.queryId}get search(){return this.myData.search}get providers(){return this.myData.providers}get types(){return this.myData.types}get providerLimits(){return this.myData.providerLimits}get myQueryData(){return Object.assign({},this.myData)}exposeFacade(){const e={id:this.id,search:this.search,providers:this.providers,types:this.types,providerLimits:this.providerLimits,sendResult:this.sendResult.bind(this),error:this.error.bind(this),done:this.done.bind(this)};return Object.freeze(e)}sendResult(e){queryResultDecoder.runWithException(e);const t=nanoid$1(10);return this.logger.trace(`[${t}] Received a valid result, forwarding to the controller`),this.controller.processProviderQueryResult({identification:this.identification,result:e,commandId:t})}error(e){const t=nanoid$1(10);nonEmptyStringDecoder.runWithException(e),this.logger.trace(`[${t}] Received a valid error, forwarding to the controller`),this.controller.processProviderQueryError({identification:this.identification,error:e,commandId:t}).catch((e=>this.logger.warn(`Error processing the error signal for this provider: ${this.id}, error: ${extractErrorMsg(e)}`)))}done(){const e=nanoid$1(10);this.logger.trace(`[${e}] Received a valid done, forwarding to the controller`),this.controller.processProviderQueryDone({identification:this.identification,commandId:e}).catch((e=>this.logger.warn(`Error processing the done signal for this provider: ${this.identification.providerId}, error: ${extractErrorMsg(e)}`)))}}class QueryResultsPublisher{constructor(e,t,n,r,i,o){this.sequelizer=e,this.glueController=t,this.logger=n,this.clientInstanceId=r,this.queryId=i,this.isLegacy=o,this.queues={}}checkProviderSuspended(e){return!!this.queues[e]&&!!this.queues[e].suspended}syncSuspendProvider(e,t){const n=this.queues[e];n?n.suspended=!0:this.logger.warn(`[${t}] Cannot suspend provider: ${e}, because there is no provider queue. This happens when the provider queue was already cancelled or completed`)}configureProviders(e){e.forEach((e=>{this.queues[e.myProviderData.id]={providerData:e,pendingResults:[]}}))}queueResult(e){const{commandId:t,identification:n}=e;this.logger.trace(`[${t}] Queuing a new result from provider: ${n.providerId}`);const r=this.queues[n.providerId];if(!r)return void this.logger.warn(`[${t}] Cannot queue this result, because there is no provider queue. This happens when the provider queue was already cancelled or completed`);const i=this.isLegacy?this.translateLegacySearchItem(e.result):e.result;if(r.pendingResults.push(i),clearTimeout(r.flushTimer),10===r.pendingResults.length)return this.logger.trace(`[${t}] Reached the limit in the queue buffer, flushing to the client.`),void this.flushProviderQueue(n.providerId,t);this.logger.trace(`[${t}] The limit in the queue buffer is not reached yet, setting a flush timer.`),r.flushTimer=setTimeout((()=>{this.logger.trace(`[${t}] Reached the time limit in the queue buffer, flushing to the client.`),this.flushProviderQueue(n.providerId,t)}),FLUSH_TIMEOUT_MS)}cancel(e){this.logger.trace(`[${e}] Cancelling queue ${this.queryId}.`),Object.values(this.queues).forEach((e=>clearTimeout(e.flushTimer))),this.queues={},this.logger.trace(`[${e}] Queue ${this.queryId} publisher cancelled.`)}markProviderDone(e,t){return __awaiter$1(this,void 0,void 0,(function*(){this.logger.trace(`[${t}] Marking provider ${e} as done.`);const n=this.queues[e];n?(clearTimeout(n.flushTimer),yield this.flushProviderQueue(e,t),delete this.queues[e],this.logger.trace(`[${t}] Provider ${e} marked as done.`)):this.logger.info(`[${t}] Cannot mark this queue as done, because there is no provider queue. This happens when the provider queue was already cancelled, completed or the provider sent an error`)}))}markProviderError(e){const t=this.queues[e.identification.providerId];t?this.glueController.sendClientErrorMessage(e.error,this.clientInstanceId,this.queryId,t.providerData.myProviderData).catch((t=>this.logger.warn(`[${e.commandId}] The client errored when handling error message for query: ${this.queryId} -> ${extractErrorMsg(t)}`))):this.logger.warn(`[${e.commandId}] Cannot mark this provider as errored, because there is no provider queue. This happens when the provider queue was already cancelled, completed or the provider sent and error`)}cleanPublisher(e){Object.values(this.queues).forEach((e=>clearTimeout(e.flushTimer))),this.queues={},this.glueController.sendClientQueueCompleted(this.clientInstanceId,this.queryId).catch((t=>this.logger.warn(`[${e}] The client errored when handling search end message for query: ${this.queryId} -> ${extractErrorMsg(t)}`)))}flushProviderQueue(e,t){return __awaiter$1(this,void 0,void 0,(function*(){yield this.sequelizer.enqueue((()=>__awaiter$1(this,void 0,void 0,(function*(){const n=this.queues[e];if(!n)return void this.logger.warn(`[${t}] Cannot flush this queue, because there is no provider queue. This happens when the provider queue was already cancelled, completed or the provider sent and error`);if(!n.pendingResults.length)return void this.logger.info(`[${t}] This provider does not have any pending results to flush.`);const r={results:n.pendingResults,provider:n.providerData.myProviderData};n.pendingResults=[];try{yield this.glueController.sendClientResultsBatch(r,this.clientInstanceId,this.queryId)}catch(e){this.logger.warn(`[${t}] The client errored when handling search results for query: ${this.queryId} -> ${extractErrorMsg(e)}`)}}))))}))}translateLegacySearchItem(e){return{type:e.type.name,category:e.type.displayName,id:e.id,displayName:e.displayName,description:e.description,iconURL:e.iconURL,action:e.action}}}class ModelFactory{constructor(e,t,n){this.glueController=e,this.glue=t,this.flushSequelizer=n}buildProviderModel(e,t){return new ProviderModel(e,t,this.glue.logger.subLogger(`search.provider.model.${e.name}`))}buildProviderQueryModel(e,t,n){return new ProviderQueryModel(e,n,this.glue.logger.subLogger(`search.provider.${t.providerId}.query.${t.queryId}`),t)}buildPublisher(e,t,n){return new QueryResultsPublisher(this.flushSequelizer,this.glueController,this.glue.logger.subLogger(`search.results.publisher.${t}`),e,t,n)}buildClientQueryModel(e,t){return new ClientQuery(t,this.glue.logger.subLogger(`search.provider.model.${e}`),e)}}let IoC$1=class{constructor(e,t){this.glue=e,this.config=t}get glueController(){return this._glueController||(this._glueController=new GlueController$1(this.glue)),this._glueController}get main(){return this._mainController||(this._mainController=new MainController(this.glue.logger.subLogger("search.main.controller"),this.glueController,this.clientController,this.providerController)),this._mainController}get clientController(){return this._clientController||(this._clientController=new ClientController(this.glue.logger.subLogger("search.client.controller"),this.glueController,this.modelFactory)),this._clientController}get providerController(){return this._providerController||(this._providerController=new ProviderController(this.glue.logger.subLogger("search.provider.controller"),this.glueController,this.sequelizer,this.limitsTracker,this.modelFactory)),this._providerController}get facade(){return this._facade||(this._facade=new SearchFacade(this.main)),this._facade}get sequelizer(){return this._asyncSequelizer||(this._asyncSequelizer=new AsyncSequelizer$2(SEQUELIZER_INTERVAL_MS)),this._asyncSequelizer}get flushSequelizer(){return this._flushSequelizer||(this._flushSequelizer=new AsyncSequelizer$2(FLUSH_SEQUELIZER_INTERVAL_MS)),this._flushSequelizer}get limitsTracker(){return this._limitsTracker||(this._limitsTracker=new LimitsTracker),this._limitsTracker}get modelFactory(){return this._modelFactory||(this._modelFactory=new ModelFactory(this.glueController,this.glue,this.flushSequelizer)),this._modelFactory}};const factoryFunction=(e,t)=>__awaiter$1(void 0,void 0,void 0,(function*(){const n=new IoC$1(e,t);e.search=n.facade.exposeApi()}));"undefined"!=typeof window&&(window.IOSearch=factoryFunction);let nanoid=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"");class Platform{constructor(e,t,n,r){this.controller=e,this.session=t,this.localStorage=n,this.config=r}ready(){return __awaiter$7(this,void 0,void 0,(function*(){this.session.start(),this.checkSingleton(),this.processConfig(this.config),yield this.controller.start(this.platformConfig)}))}getClientGlue(){return this.controller.getClientGlue()}getPlatformApi(){return this.controller.platformApi}checkSingleton(){const e=window.glue42core||window.iobrowser;if(e&&e.platformStarted)throw new Error("The Glue42 Core Platform has already been started for this application.")}processConfig(e){var t,n,r,i,o,l;if(!e)throw new Error("Cannot start the IoConnect Browser Platform without a config object.");const s=platformConfigDecoder.runWithException(e);this.addSearch(s),this.validatePlugins(s),this.platformConfig=deepMerge(defaultPlatformConfig,s);const a=deepMerge(defaultNotificationsConfig,s.notifications||{}),u=this.session.getSystemSettings()||{systemInstanceId:nanoid(),ctxTrackInstanceId:nanoid()};this.session.setSystemSettings(u),this.localStorage.start(this.platformConfig.user);const c=this.localStorage.getNotificationsConfig()||a;this.localStorage.setNotificationsConfig(c),this.platformConfig.workspacesFrameCache="boolean"!=typeof(null===(t=s.workspaces)||void 0===t?void 0:t.frameCache)||(null===(n=s.workspaces)||void 0===n?void 0:n.frameCache),this.transferPromiseObjects(s);const h={isPlatformFrame:!!(null===(r=s.workspaces)||void 0===r?void 0:r.isFrame),initAsEmptyFrame:!!(null===(i=s.workspaces)||void 0===i?void 0:i.initAsEmpty),workspacesFrameCache:this.platformConfig.workspacesFrameCache,platformStarted:!0,environment:Object.assign({},this.platformConfig.environment,{extension:void 0}),communicationId:u.systemInstanceId,workspaces:{frameCache:this.platformConfig.workspacesFrameCache,isPlatform:!!(null===(o=s.workspaces)||void 0===o?void 0:o.isFrame),initAsEmpty:!!(null===(l=s.workspaces)||void 0===l?void 0:l.initAsEmpty)}};window.iobrowser=h}transferPromiseObjects(e){var t;if(void 0!==(null===(t=e.serviceWorker)||void 0===t?void 0:t.registrationPromise)&&(this.platformConfig.serviceWorker.registrationPromise=e.serviceWorker.registrationPromise),e.plugins&&e.plugins.definitions.length){e.plugins.definitions.forEach((e=>{var t;const n=null===(t=this.platformConfig.plugins)||void 0===t?void 0:t.definitions.find((t=>t.name===e.name));n&&(n.config=e.config)}))}}validatePlugins(e){var t;if(!(null===(t=e.plugins)||void 0===t?void 0:t.definitions))return;const n=e.plugins.definitions.reduce(((e,t)=>{const n=typeof t.start,r=typeof t.stop,i=t.name;return("function"!==n||t.stop&&"function"!==r)&&e.push({name:i,startType:n,stopType:r}),e}),[]);if(n.length){const e=n.map((e=>`The start and stop functions for plugin ${e.name} were expected to be of type function, but was provided start: ${e.startType} and stop: ${e.stopType}`)).join("\n");throw new Error(e)}}addSearch(e){e.browser?e.browser.libraries?e.browser.libraries.push(factoryFunction):e.browser.libraries||(e.browser.libraries=[factoryFunction]):e.browser={libraries:[factoryFunction]}}}var extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},extendStatics(e,t)};function __extends(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var __assign=function(){return __assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},__assign.apply(this,arguments)};function __awaiter(e,t,n,r){return new(n||(n=Promise))((function(i,o){function l(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,s)}a((r=r.apply(e,t||[])).next())}))}function __generator(e,t){var n,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(l=0)),l;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return l.label++,{value:s[1],done:!1};case 5:l.label++,r=s[1],s=[0];continue;case 7:s=l.ops.pop(),l.trys.pop();continue;default:if(!(i=l.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){l=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){l.label=s[1];break}if(6===s[0]&&l.label<i[1]){l.label=i[1],i=s;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(s);break}i[2]&&l.ops.pop(),l.trys.pop();continue}s=t.call(e,l)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function __spreadArray(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var MetricTypes={STRING:1,NUMBER:2,TIMESTAMP:3,OBJECT:4};function getMetricTypeByValue(e){return e.type===MetricTypes.TIMESTAMP?"timestamp":e.type===MetricTypes.NUMBER?"number":e.type===MetricTypes.STRING?"string":e.type===MetricTypes.OBJECT?"object":"unknown"}function getTypeByValue(e){return e.constructor===Date?"timestamp":"number"==typeof e?"number":"string"==typeof e?"string":"object"==typeof e?"object":"string"}function serializeMetric(e){var t={},n=getMetricTypeByValue(e);if("object"===n){var r=Object.keys(e.value).reduce((function(t,n){var r=getTypeByValue(e.value[n]);if("object"===r){var i=defineNestedComposite(e.value[n]);t[n]={type:"object",description:"",context:{},composite:i}}else t[n]={type:r,description:"",context:{}};return t}),{});t.composite=r}return t.name=normalizeMetricName(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function defineNestedComposite(e){return Object.keys(e).reduce((function(t,n){var r=getTypeByValue(e[n]);return t[n]="object"===r?{type:"object",description:"",context:{},composite:defineNestedComposite(e[n])}:{type:r,description:"",context:{}},t}),{})}function normalizeMetricName(e){return void 0!==e&&e.length>0&&"/"!==e[0]?"/"+e:e}function getMetricValueByType(e){return"timestamp"===getMetricTypeByValue(e)?Date.now():publishNestedComposite(e.value)}function publishNestedComposite(e){return"object"!=typeof e?e:Object.keys(e).reduce((function(t,n){var r=e[n];return"object"==typeof r&&r.constructor!==Date?t[n]=publishNestedComposite(r):r.constructor===Date?t[n]=new Date(r).getTime():r.constructor===Boolean?t[n]=r.toString():t[n]=r,t}),{})}function flatten(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?flatten(t):t)}),[])}function getHighestState(e){return e.sort((function(e,t){return e.state?t.state?t.state-e.state:-1:1}))[0]}function aggregateDescription(e){var t="";return e.forEach((function(e,n,r){var i=e.path.join(".");n===r.length-1?t+=i+"."+e.name+": "+e.description:t+=i+"."+e.name+": "+e.description+","})),t.length>100?t.slice(0,100)+"...":t}function composeMsgForRootStateMetric(e){var t=flatten(e.root.getAggregateState()),n=getHighestState(t);return{description:aggregateDescription(t),value:n.state}}function gw3(e,t){var n,r,i=this;if(!e||"object"!=typeof e)throw new Error("Connection is required parameter");var o=function(e){l(e.root)},l=function(e){s(e),e.metrics.forEach((function(e){a(e)})),e.subSystems.forEach((function(e){l(e)}))},s=function(e){return __awaiter(i,void 0,void 0,(function(){var t,i;return __generator(this,(function(o){switch(o.label){case 0:return void 0===e.parent?[2]:[4,n];case 1:return o.sent(),t={name:normalizeMetricName(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},i={type:"define",metrics:[t]},r.send(i),[2]}}))}))},a=function(e){return __awaiter(i,void 0,void 0,(function(){var t,i,o;return __generator(this,(function(l){switch(l.label){case 0:return t=c(e),[4,n];case 1:return l.sent(),i=serializeMetric(t),o={type:"define",metrics:[i]},r.send(o),void 0!==t.value&&u(t),[2]}}))}))},u=function(e){if(h()){var t=getMetricValueByType(e),n={type:"publish",values:[{name:normalizeMetricName(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};return r.sendFireAndForget(n)}return Promise.resolve()},c=function(e){var t=__assign({},e);return"object"==typeof e.value&&null!==e.value&&(t.value=__assign({},e.value)),t},h=function(){var e;try{return(null!==(e=t.canUpdateMetric)&&void 0!==e?e:function(){return!0})()}catch(e){return!0}};return{init:function(i){var l;n=new Promise((function(e){l=e})),(r=e.domain("metrics")).onJoined((function(e){!e&&l&&(l(),l=void 0);var t={type:"define",metrics:[{name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}}]};r.send(t),e&&o(i)})),r.join({system:t.system,service:t.service,instance:t.instance})},createSystem:s,updateSystem:function(t,o){return __awaiter(i,void 0,void 0,(function(){var i,l,s;return __generator(this,(function(a){switch(a.label){case 0:return[4,n];case 1:return a.sent(),i={type:"publish",values:[{name:normalizeMetricName(t.path.join("/")+"/"+t.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]},r.send(i),l=composeMsgForRootStateMetric(t),s={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:l.description,Value:l.value},timestamp:Date.now()}]},r.send(s),[2]}}))}))},createMetric:a,updateMetric:function(e){return __awaiter(i,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return t=c(e),[4,n];case 1:return r.sent(),u(t),[2]}}))}))}}}var Helpers={validate:function(e,t,n){if(null===e||"object"!=typeof e)throw new Error("Missing definition");if(null===t||"object"!=typeof t)throw new Error("Missing parent");if(null===n||"object"!=typeof n)throw new Error("Missing transport")}},BaseMetric=function(){function e(e,t,n,r,i){this.definition=e,this.system=t,this.transport=n,this.value=r,this.type=i,this.path=[],Helpers.validate(e,t,n),this.path=t.path.slice(0),this.path.push(t.name),this.name=e.name,this.description=e.description,n.createMetric(this)}return Object.defineProperty(e.prototype,"repo",{get:function(){var e;return null===(e=this.system)||void 0===e?void 0:e.repo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return"".concat(this.system.path,"/").concat(name)},enumerable:!1,configurable:!0}),e.prototype.update=function(e){return this.value=e,this.transport.updateMetric(this)},e}(),NumberMetric=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,MetricTypes.NUMBER)||this}return __extends(t,e),t.prototype.incrementBy=function(e){this.update(this.value+e)},t.prototype.increment=function(){this.incrementBy(1)},t.prototype.decrement=function(){this.incrementBy(-1)},t.prototype.decrementBy=function(e){this.incrementBy(-1*e)},t}(BaseMetric),ObjectMetric=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,MetricTypes.OBJECT)||this}return __extends(t,e),t.prototype.update=function(e){return this.mergeValues(e),this.transport.updateMetric(this)},t.prototype.mergeValues=function(e){var t=this;return Object.keys(this.value).forEach((function(n){void 0!==e[n]&&(t.value[n]=e[n])}))},t}(BaseMetric),StringMetric=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,MetricTypes.STRING)||this}return __extends(t,e),t}(BaseMetric),TimestampMetric=function(e){function t(t,n,r,i){return e.call(this,t,n,r,i,MetricTypes.TIMESTAMP)||this}return __extends(t,e),t.prototype.now=function(){this.update(new Date)},t}(BaseMetric);function system(e,t,n,r,i){if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var o,l,s=n,a=e,u=i||"",c=t,h=r,d=function e(t){if(!t||!t.parent)return[];var n=e(t.parent);return n.push(t.name),n}(r),f={},p=(l="/",((o=d)&&o.length>0?o.join(l):"")+e),g=t.root,w=[],m=[];function v(e,t,n,r){var i={name:""};i="string"==typeof e?{name:e}:e;var o=m.filter((function(e){return e.name===i.name}));if(o.length>0){var l=o[0];if(l.type!==t)throw new Error("A metric named ".concat(i.name," is already defined with different type."));return void 0!==n&&l.update(n).catch((function(){})),l}var s=r(i);return m.push(s),s}var y={get name(){return a},get description(){return u},get repo(){return c},get parent(){return h},path:d,id:p,root:g,get subSystems(){return w},get metrics(){return m},subSystem:function(e,t){if(!e||0===e.length)throw new Error("name is required");var n=w.filter((function(t){return t.name===e}));if(n.length>0)return n[0];var r=system(e,c,s,y,t);return w.push(r),r},getState:function(){return f},setState:function(e,t){f={state:e,description:t},s.updateSystem(y,f)},stringMetric:function(e,t){return v(e,MetricTypes.STRING,t,(function(e){return new StringMetric(e,y,s,t)}))},timestampMetric:function(e,t){return v(e,MetricTypes.TIMESTAMP,t,(function(e){return new TimestampMetric(e,y,s,t)}))},objectMetric:function(e,t){return v(e,MetricTypes.OBJECT,t,(function(e){return new ObjectMetric(e,y,s,t)}))},numberMetric:function(e,t){return v(e,MetricTypes.NUMBER,t,(function(e){return new NumberMetric(e,y,s,t)}))},getAggregateState:function(){var e=[];return Object.keys(f).length>0&&e.push({name:a,path:d,state:f.state,description:f.description}),w.forEach((function(t){var n=t.getAggregateState();n.length>0&&e.push.apply(e,n)})),e}};return s.createSystem(y),y}var Repository=function(){function e(e,t){t.init(this),this.root=system("",this,t),this.addSystemMetrics(this.root,e.clickStream||void 0===e.clickStream)}return e.prototype.addSystemMetrics=function(e,t){if("undefined"!=typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!=typeof document){var n=e.subSystem("ClickStream"),r=function(e){var t;if(e.target){var r=e.target,i=r&&null!==(t=r.getAttribute("class"))&&void 0!==t?t:"";n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:i,id:r.id,type:"<"+r.tagName.toLowerCase()+">",href:r.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",r):document.attachEvent("onclick",r)}e.stringMetric("StartTime",(new Date).toString());var i=e.stringMetric("StartURL",""),o=e.stringMetric("AppName","");if("undefined"!=typeof window){if(void 0!==window.location){var l=window.location.href;i.update(l)}void 0!==window.glue42gd&&o.update(window.glue42gd.appName)}},e}(),NullProtocol=function(){function e(){}return e.prototype.init=function(e){},e.prototype.createSystem=function(e){return Promise.resolve()},e.prototype.updateSystem=function(e,t){return Promise.resolve()},e.prototype.createMetric=function(e){return Promise.resolve()},e.prototype.updateMetric=function(e){return Promise.resolve()},e}(),PerfTracker=function(){function e(e,t,n){this.api=e,this.lastCount=0,this.initialPublishTimeout=1e4,this.publishInterval=6e4,this.initialPublishTimeout=null!=t?t:this.initialPublishTimeout,this.publishInterval=null!=n?n:this.publishInterval,this.scheduleCollection(),this.system=this.api.subSystem("performance","Performance data published by the web application")}return e.prototype.scheduleCollection=function(){var e=this;setTimeout((function(){e.collect(),setInterval((function(){e.collect()}),e.publishInterval)}),this.initialPublishTimeout)},e.prototype.collect=function(){try{this.collectMemory(),this.collectEntries()}catch(e){}},e.prototype.collectMemory=function(){var e=window.performance.memory;this.system.stringMetric("memory",JSON.stringify({totalJSHeapSize:e.totalJSHeapSize,usedJSHeapSize:e.usedJSHeapSize}))},e.prototype.collectEntries=function(){var e=window.performance.getEntries();if(!(e.length<=this.lastCount)){this.lastCount=e.length;var t=e.map((function(e){return e.toJSON()}));this.system.stringMetric("entries",JSON.stringify(t))}},e}(),metrics=function(e){var t;t=e.connection&&"object"==typeof e.connection?gw3(e.connection,e):new NullProtocol;var n=new Repository(e,t).root;e.disableAutoAppSystem||(n=n.subSystem("App"));var r=addFAVSupport(n);return initPerf(r,e.pagePerformanceMetrics),r};function initPerf(e,t){var n,r;if("undefined"!=typeof window){var i=null===(r=null===(n=null===window||void 0===window?void 0:window.glue42gd)||void 0===n?void 0:n.metrics)||void 0===r?void 0:r.pagePerformanceMetrics;i&&(t=i),(null==t?void 0:t.enabled)&&new PerfTracker(e,t.initialPublishTimeout,t.publishInterval)}}function addFAVSupport(e){var t,n=e.subSystem("reporting"),r={name:"features"};return e.featureMetric=function(e,i,o){if(void 0===e||""===e)throw new Error("name is mandatory");if(void 0===i||""===i)throw new Error("action is mandatory");if(void 0===o||""===o)throw new Error("payload is mandatory");t?t.update({name:e,action:i,payload:o}):t=n.objectMetric(r,{name:e,action:i,payload:o})},e}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createRegistry(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};function r(n,r){var i=n instanceof Error?n:new Error(n);if(t)t(i);else{var o='[ERROR] callback-registry: User callback for key "'+r+'" failed: '+i.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t,i){var o=n[e];return o||(o=[],n[e]=o),o.push(t),i&&setTimeout((function(){i.forEach((function(i){var o;if(null===(o=n[e])||void 0===o?void 0:o.includes(t))try{Array.isArray(i)?t.apply(void 0,i):t.apply(void 0,[i])}catch(t){r(t,e)}}))}),0),function(){var r=n[e];r&&(0===(r=r.reduce((function(e,n,r){return n===t&&e.length===r||e.push(n),e}),[])).length?delete n[e]:n[e]=r)}},execute:function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=n[e];if(!o||0===o.length)return[];var l=[];return o.forEach((function(n){try{var i=n.apply(void 0,t);l.push(i)}catch(t){l.push(void 0),r(t,e)}})),l},clear:function(){n={}},clearKey:function(e){n[e]&&delete n[e]}}}createRegistry.default=createRegistry;var lib$1=createRegistry,InProcTransport=function(){function e(e,t){var n=this;this.registry=lib$1(),this.gw=e.facade,this.gw.connect((function(e,t){n.messageHandler(t)})).then((function(e){n.client=e}))}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return this.client?(this.client.send(e),Promise.resolve(void 0)):Promise.reject("not connected")},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"in-memory"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),SharedWorkerTransport=function(){function e(e,t){var n=this;this.logger=t,this.registry=lib$1(),this.worker=new SharedWorker(e),this.worker.port.onmessage=function(e){n.messageHandler(e.data)}}return Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return this.worker.port.postMessage(e),Promise.resolve()},e.prototype.send=function(e){return Promise.reject("not supported")},e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.onConnectedChanged=function(e){return e(!0),function(){}},e.prototype.close=function(){return Promise.resolve()},e.prototype.open=function(){return Promise.resolve()},e.prototype.name=function(){return"shared-worker"},e.prototype.reconnect=function(){return Promise.resolve()},e.prototype.messageHandler=function(e){this.registry.execute("onMessage",e)},e}(),Utils=function(){function e(){}return e.isNode=function(){if(void 0!==e._isNode)return e._isNode;if("undefined"!=typeof window)return e._isNode=!1,!1;try{e._isNode="[object process]"===Object.prototype.toString.call(global.process)}catch(t){e._isNode=!1}return e._isNode},e}(),PromiseWrapper=function(){function e(){var e=this;this.rejected=!1,this.resolved=!1,this.promise=new Promise((function(t,n){e.resolve=function(n){e.resolved=!0,t(n)},e.reject=function(t){e.rejected=!0,n(t)}}))}return e.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Object.defineProperty(e.prototype,"ended",{get:function(){return this.rejected||this.resolved},enumerable:!1,configurable:!0}),e}(),timers={};function getAllTimers(){return timers}function timer(e){var t=timers[e];if(t)return t;var n=[];function r(){return(new Date).getTime()}var i,o,l=r();function s(e,t){var i=null!=t?t:r(),o=0;n.length>0&&(o=i-n[n.length-1].time),n.push({name:e,time:i,diff:o})}s("start",l);var a={get startTime(){return l},get endTime(){return i},get period(){return o},stop:function(){return s("end",i=r()),o=i-l},mark:s,marks:n};return timers[e]=a,a}var WebSocketConstructor=Utils.isNode()?require("ws"):window.WebSocket,WS=function(){function e(e,t){if(this.startupTimer=timer("connection"),this._running=!0,this._registry=lib$1(),this.wsRequests=[],this.settings=e,this.logger=t,!this.settings.ws)throw new Error("ws is missing")}return e.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},e.prototype.send=function(e,t){var n=this;return new Promise((function(t,r){n.waitForSocketConnection((function(){var i;try{null===(i=n.ws)||void 0===i||i.send(e),t()}catch(e){r(e)}}),r)}))},e.prototype.open=function(){var e=this;return this.logger.info("opening ws..."),this._running=!0,new Promise((function(t,n){e.waitForSocketConnection(t,n)}))},e.prototype.close=function(){return this._running=!1,this.ws&&this.ws.close(),Promise.resolve()},e.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},e.prototype.name=function(){return this.settings.ws},e.prototype.reconnect=function(){var e;null===(e=this.ws)||void 0===e||e.close();var t=new PromiseWrapper;return this.waitForSocketConnection((function(){t.resolve()})),t.promise},e.prototype.waitForSocketConnection=function(e,t){var n;t=null!=t?t:function(){},this._running?1!==(null===(n=this.ws)||void 0===n?void 0:n.readyState)?(this.wsRequests.push({callback:e,failed:t}),this.wsRequests.length>1||this.openSocket()):e():t("wait for socket on ".concat(this.settings.ws," failed - socket closed by user"))},e.prototype.openSocket=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n=this;return __generator(this,(function(r){switch(r.label){case 0:if(this.startupTimer.mark("opening-socket"),void 0===e&&(e=this.settings.reconnectInterval),void 0===t&&(t=this.settings.reconnectAttempts),void 0!==t){if(0===t)return this.notifyForSocketState("wait for socket on ".concat(this.settings.ws," failed - no more retries left")),[2];this.logger.debug("will retry ".concat(t," more times (every ").concat(e," ms)"))}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.initiateSocket()];case 2:return r.sent(),this.startupTimer.mark("socket-initiated"),this.notifyForSocketState(),[3,4];case 3:return r.sent(),setTimeout((function(){var r=void 0===t?void 0:t-1;n.openSocket(e,r)}),e),[3,4];case 4:return[2]}}))}))},e.prototype.initiateSocket=function(){var e=this,t=new PromiseWrapper;return this.logger.debug("initiating ws to ".concat(this.settings.ws,"...")),this.ws=new WebSocketConstructor(this.settings.ws||""),this.ws.onerror=function(n){var r="";try{r=JSON.stringify(n)}catch(e){var i=new WeakSet;r=JSON.stringify(n,(function(e,t){if("object"==typeof t&&null!==t){if(i.has(t))return;i.add(t)}return t}))}t.reject("error"),e.notifyStatusChanged(!1,r)},this.ws.onclose=function(n){e.logger.info("ws closed ".concat(n)),t.reject("closed"),e.notifyStatusChanged(!1)},this.ws.onopen=function(){var n;e.startupTimer.mark("ws-opened"),e.logger.info("ws opened ".concat(null===(n=e.settings.identity)||void 0===n?void 0:n.application)),t.resolve(),e.notifyStatusChanged(!0)},this.ws.onmessage=function(t){e._registry.execute("onMessage",t.data)},t.promise},e.prototype.notifyForSocketState=function(e){this.wsRequests.forEach((function(t){e?t.failed&&t.failed(e):t.callback()})),this.wsRequests=[]},e.prototype.notifyStatusChanged=function(e,t){this._registry.execute("onConnectedChanged",e,t)},e}(),shortidExports={},shortid$1={get exports(){return shortidExports},set exports(e){shortidExports=e}},libExports={},lib={get exports(){return libExports},set exports(e){libExports=e}},seed=1;function getNextValue(){return(seed=(9301*seed+49297)%233280)/233280}function setSeed$1(e){seed=e}var randomFromSeed$1={nextValue:getNextValue,seed:setSeed$1},randomFromSeed=randomFromSeed$1,ORIGINAL="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",alphabet$2,previousSeed,shuffled;function reset(){shuffled=!1}function setCharacters(e){if(e){if(e!==alphabet$2){if(e.length!==ORIGINAL.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+ORIGINAL.length+" unique characters. These characters were not unique: "+t.join(", "));alphabet$2=e,reset()}}else alphabet$2!==ORIGINAL&&(alphabet$2=ORIGINAL,reset())}function characters(e){return setCharacters(e),alphabet$2}function setSeed(e){randomFromSeed.seed(e),previousSeed!==e&&(reset(),previousSeed=e)}function shuffle(){alphabet$2||setCharacters(ORIGINAL);for(var e,t=alphabet$2.split(""),n=[],r=randomFromSeed.nextValue();t.length>0;)r=randomFromSeed.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function getShuffled(){return shuffled||(shuffled=shuffle())}function lookup(e){return getShuffled()[e]}function get(){return alphabet$2||ORIGINAL}var alphabet_1={get:get,characters:characters,seed:setSeed,lookup:lookup,shuffled:getShuffled},crypto$2="object"==typeof window&&(window.crypto||window.msCrypto),randomByte;randomByte=crypto$2&&crypto$2.getRandomValues?function(e){return crypto$2.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t};var randomByteBrowser=randomByte,format_browser=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*r*n/t.length),o="";;)for(var l=e(i),s=i;s--;)if((o+=t[l[s]&r]||"").length===+n)return o},alphabet$1=alphabet_1,random=randomByteBrowser,format=format_browser;function generate$1(e){for(var t,n=0,r="";!t;)r+=format(random,alphabet$1.get(),1),t=e<Math.pow(16,n+1),n++;return r}var generate_1=generate$1,generate=generate_1,REDUCE_TIME=1567752802062,version$1=7,counter,previousSeconds;function build(e){var t="",n=Math.floor(.001*(Date.now()-REDUCE_TIME));return n===previousSeconds?counter++:(counter=0,previousSeconds=n),t+=generate(version$1),t+=generate(e),counter>0&&(t+=generate(counter)),t+=generate(n)}var build_1=build,alphabet=alphabet_1;function isShortId(e){return!(!e||"string"!=typeof e||e.length<6)&&!new RegExp("[^"+alphabet.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}var isValid=isShortId;!function(e){var t=alphabet_1,n=build_1,r=isValid,i=0;function o(){return n(i)}e.exports=o,e.exports.generate=o,e.exports.seed=function(n){return t.seed(n),e.exports},e.exports.worker=function(t){return i=t,e.exports},e.exports.characters=function(e){return void 0!==e&&t.characters(e),t.shuffled()},e.exports.isValid=r}(lib),function(e){e.exports=libExports}(shortid$1);var shortid=getDefaultExportFromCjs(shortidExports);function domainSession(e,t,n,r,i){null==e&&(e="global"),r=r||["success"],i=i||["error"];var o,l=!1,s=!1,a=!1,u=lib$1();t.disconnected((function(){a=!1,n.debug("connection is down"),l=!1,s=!0,u.execute("onLeft",{disconnected:!0})})),t.loggedIn((function(){a=!0,s&&(n.debug("connection is now up - trying to reconnect..."),h(o))})),t.on("success",(function(e){return f(e)})),t.on("error",(function(e){return d(e)})),t.on("result",(function(e){return f(e)})),r&&r.forEach((function(e){t.on(e,(function(e){return f(e)}))})),i&&i.forEach((function(e){t.on(e,(function(e){return d(e)}))}));var c={};function h(t){return o=t,new Promise((function(r,i){if(l)r({});else{var o;if("global"===e)o=a?Promise.resolve({}):Promise.reject("not connected to gateway");else n.debug("joining domain ".concat(e)),o=g({type:"join",destination:e,domain:"global",options:t});o.then((function(){!function(){n.debug("did join "+e),l=!0;var t=s;s=!1,u.execute("onJoined",t)}(),r({})})).catch((function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),i(t)}))}}))}function d(t){if(e===t.domain){var n=t.request_id;if(n){var r=c[n];r&&r.error(t)}}}function f(t){if(t.domain===e){var n=t.request_id;if(n){var r=c[n];r&&r.success(t)}}}function p(){return shortid()}function g(r,i,o){o=o||{},r.request_id=r.request_id||p(),r.domain=r.domain||e,o.skipPeerId||(r.peer_id=t.peerId);var l=r.request_id;return new Promise((function(e,s){c[l]={success:function(t){delete c[l],t._tag=i,e(t)},error:function(e){n.warn("GW error - ".concat(JSON.stringify(e)," for request ").concat(JSON.stringify(r))),delete c[l],e._tag=i,s(e)}},t.send(r,o).catch((function(e){c[l].error({err:e})}))}))}return{join:h,leave:function(){return"global"===e?Promise.resolve():(n.debug("stopping session "+e+"..."),s=!1,g({type:"leave",destination:e,domain:"global"}).then((function(){l=!1,u.execute("onLeft")})).catch((function(){l=!1,u.execute("onLeft")})))},onJoined:function(e){return l&&e(!1),u.add("onJoined",e)},onLeft:function(e){return l||e(),u.add("onLeft",e)},send:g,sendFireAndForget:function(n){return n.request_id=n.request_id?n.request_id:p(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(n)},on:function(r,i){t.on(r,(function(t){if(t.domain===e)try{i(t)}catch(e){n.error("Callback  failed: ".concat(e," \n ").concat(e.stack," \n msg was: ").concat(JSON.stringify(t)),e)}}))},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId},get domain(){return e}}}var GW3ProtocolImpl=function(){function e(e,t,n){var r=this;this.connection=e,this.settings=t,this.logger=n,this.protocolVersion=3,this.datePrefix="#T42_DATE#",this.datePrefixLen=this.datePrefix.length,this.dateMinLen=this.datePrefixLen+1,this.datePrefixFirstChar=this.datePrefix[0],this.registry=lib$1(),this._isLoggedIn=!1,this.shouldTryLogin=!0,this.initialLogin=!0,this.initialLoginAttempts=3,this.sessions=[],e.disconnected((function(){r.handleDisconnected()})),this.ping()}return Object.defineProperty(e.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!1,configurable:!0}),e.prototype.processStringMessage=function(e){var t=this,n=JSON.parse(e,(function(e,n){if("string"!=typeof n)return n;if(n.length<t.dateMinLen)return n;if(n[0]!==t.datePrefixFirstChar)return n;if(n.substring(0,t.datePrefixLen)!==t.datePrefix)return n;try{var r=parseInt(n.substring(t.datePrefixLen,n.length),10);return isNaN(r)?n:new Date(r)}catch(e){return n}}));return{msg:n,msgType:n.type}},e.prototype.createStringMessage=function(e){var t=Date.prototype.toJSON;try{var n=this.datePrefix;return Date.prototype.toJSON=function(){return n+this.getTime()},JSON.stringify(e)}finally{Date.prototype.toJSON=t}},e.prototype.processObjectMessage=function(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}},e.prototype.createObjectMessage=function(e){return e},e.prototype.login=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i,o,l,s,a,u,c,h;return __generator(this,(function(d){switch(d.label){case 0:if(this.logger.debug("logging in..."),this.loginConfig=e,this.loginConfig||(this.loginConfig={username:"",password:""}),this.shouldTryLogin=!0,n={},this.connection.gatewayToken=e.gatewayToken,!e.gatewayToken)return[3,5];if(!t)return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.getNewGWToken()];case 2:return u=d.sent(),e.gatewayToken=u,[3,4];case 3:return r=d.sent(),this.logger.warn("failed to get GW token when reconnecting ".concat((null==r?void 0:r.message)||r)),[3,4];case 4:return n.method="gateway-token",n.token=e.gatewayToken,this.connection.gatewayToken=e.gatewayToken,[3,10];case 5:return"sspi"!==e.flowName?[3,9]:(n.provider="win",n.method="access-token",e.flowCallback&&e.sessionId?(i=n,[4,e.flowCallback(e.sessionId,null)]):[3,7]);case 6:return i.token=d.sent().data.toString("base64"),[3,8];case 7:throw new Error("Invalid SSPI config");case 8:return[3,10];case 9:if(e.token)n.method="access-token",n.token=e.token;else if(e.username)n.method="secret",n.login=e.username,n.secret=e.password;else{if(!e.provider)throw new Error("invalid auth message"+JSON.stringify(e));n.provider=e.provider,n.providerContext=e.providerContext}d.label=10;case 10:o={type:"hello",identity:this.settings.identity,authentication:n},e.sessionId&&(o.request_id=e.sessionId),this.globalDomain=domainSession("global",this.connection,this.logger.subLogger("global-domain"),["welcome","token","authentication-request"]),l={skipPeerId:!0},this.initialLogin&&(l.retryInterval=this.settings.reconnectInterval,l.maxRetries=this.settings.reconnectAttempts),d.label=11;case 11:d.trys.push([11,19,20,21]),s=void 0,d.label=12;case 12:return[4,this.globalDomain.send(o,void 0,l)];case 13:return"authentication-request"!==(a=d.sent()).type?[3,16]:(u=Buffer.from(a.authentication.token,"base64"),e.flowCallback&&e.sessionId?(c=o.authentication,[4,e.flowCallback(e.sessionId,u)]):[3,15]);case 14:c.token=d.sent().data.toString("base64"),d.label=15;case 15:return o.request_id=e.sessionId,[3,12];case 16:if("welcome"===a.type)return s=a,[3,18];throw"error"===a.type?new Error("Authentication failed: "+a.reason):new Error("Unexpected message type during authentication: "+a.type);case 17:return[3,12];case 18:return this.initialLogin=!1,this.logger.debug("login successful with peerId "+s.peer_id),this.connection.peerId=s.peer_id,this.connection.resolvedIdentity=s.resolved_identity,this.connection.availableDomains=s.available_domains,s.options&&(this.connection.token=s.options.access_token,this.connection.info=s.options.info),this.setLoggedIn(!0),[2,s.resolved_identity];case 19:throw h=d.sent(),this.logger.error("error sending hello message - "+(h.message||h.msg||h.reason||h),h),h;case 20:return e&&e.flowCallback&&e.sessionId&&e.flowCallback(e.sessionId,null),[7];case 21:return[2]}}))}))},e.prototype.logout=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return this.logger.debug("logging out..."),this.shouldTryLogin=!1,this.pingTimer&&clearTimeout(this.pingTimer),e=this.sessions.map((function(e){e.leave()})),[4,Promise.all(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this._isLoggedIn&&e(),this.registry.add("onLoggedIn",e)},e.prototype.domain=function(e,t,n,r){var i=this.sessions.filter((function(t){return t.domain===e}))[0];return i||(i=domainSession(e,this.connection,t,n,r),this.sessions.push(i)),i},e.prototype.handleDisconnected=function(){var e=this;if(this.setLoggedIn(!1),this.shouldTryLogin&&this.initialLogin){if(this.initialLoginAttempts<=0)return;this.initialLoginAttempts--}if(this.logger.debug("disconnected - will try new login?"+this.shouldTryLogin),this.shouldTryLogin){if(!this.loginConfig)throw new Error("no login info");this.connection.login(this.loginConfig,!0).catch((function(){setTimeout(e.handleDisconnected.bind(e),e.settings.reconnectInterval||1e3)}))}},e.prototype.setLoggedIn=function(e){this._isLoggedIn=e,this._isLoggedIn&&this.registry.execute("onLoggedIn")},e.prototype.ping=function(){var e=this;this.shouldTryLogin&&(this._isLoggedIn&&this.connection.send({type:"ping"}),this.pingTimer=setTimeout((function(){e.ping()}),3e4))},e.prototype.authToken=function(){return this.globalDomain?this.globalDomain.send({type:"create-token"}).then((function(e){return e.token})):Promise.reject(new Error("no global domain session"))},e.prototype.getNewGWToken=function(){if("undefined"!=typeof window){var e=window.glue42gd;if(e)return e.getGWToken()}return Promise.reject(new Error("not running in GD"))},e}(),MessageReplayerImpl=function(){function e(e){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var t=0,n=e;t<n.length;t++){var r=n[t];this.specs[r.name]=r,this.specsNames.push(r.name)}}return e.prototype.init=function(e){var t=this;this.connection=e;for(var n=0,r=this.specsNames;n<r.length;n++)for(var i=r[n],o=function(n){var r=l.subsRefCount[n];if(r||(r=0),r+=1,l.subsRefCount[n]=r,r>1)return"continue";var i=e.on(n,(function(e){return t.processMessage(n,e)}));l.subs[n]=i},l=this,s=0,a=this.specs[i].types;s<a.length;s++){o(a[s])}},e.prototype.processMessage=function(e,t){if(!this.isDone&&t)for(var n=0,r=this.specsNames;n<r.length;n++){var i=r[n];if(-1!==this.specs[i].types.indexOf(e)){var o=this.messages[i]||[];this.messages[i]=o,o.push(t)}}},e.prototype.drain=function(e,t){var n;t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(var r=0,i=this.specs[e].types;r<i.length;r++){var o=i[r];this.subsRefCount[o]-=1,this.subsRefCount[o]<=0&&(null===(n=this.connection)||void 0===n||n.off(this.subs[o]),delete this.subs[o],delete this.subsRefCount[o])}delete this.specs[e],this.specs.length||(this.isDone=!0)},e}(),PromisePlus$1=function(e,t,n){return new Promise((function(r,i){var o=setTimeout((function(){var e=n||"Promise timeout hit: ".concat(t);i(e)}),t);new Promise(e).then((function(e){clearTimeout(o),r(e)})).catch((function(e){clearTimeout(o),i(e)}))}))},WebPlatformTransport=function(){function e(e,t,n){this.settings=e,this.logger=t,this.identity=n,this.iAmConnected=!1,this.parentReady=!1,this.rejected=!1,this.children=[],this.extContentAvailable=!1,this.extContentConnecting=!1,this.extContentConnected=!1,this.parentInExtMode=!1,this.webNamespace="g42_core_web",this.parentPingTimeout=5e3,this.connectionRequestTimeout=7e3,this.defaultTargetString="*",this.registry=lib$1(),this.messages={connectionAccepted:{name:"connectionAccepted",handle:this.handleConnectionAccepted.bind(this)},connectionRejected:{name:"connectionRejected",handle:this.handleConnectionRejected.bind(this)},connectionRequest:{name:"connectionRequest",handle:this.handleConnectionRequest.bind(this)},parentReady:{name:"parentReady",handle:function(){}},parentPing:{name:"parentPing",handle:this.handleParentPing.bind(this)},platformPing:{name:"platformPing",handle:this.handlePlatformPing.bind(this)},platformReady:{name:"platformReady",handle:this.handlePlatformReady.bind(this)},clientUnload:{name:"clientUnload",handle:this.handleClientUnload.bind(this)},manualUnload:{name:"manualUnload",handle:this.handleManualUnload.bind(this)},extConnectionResponse:{name:"extConnectionResponse",handle:this.handleExtConnectionResponse.bind(this)},extSetupRequest:{name:"extSetupRequest",handle:this.handleExtSetupRequest.bind(this)},gatewayDisconnect:{name:"gatewayDisconnect",handle:this.handleGatewayDisconnect.bind(this)},gatewayInternalConnect:{name:"gatewayInternalConnect",handle:this.handleGatewayInternalConnect.bind(this)}},this.extContentAvailable=!!window.glue42ext,this.setUpMessageListener(),this.setUpUnload(),this.setupPlatformUnloadListener(),this.parentType=window.name.includes("#wsp")?"workspace":void 0}return e.prototype.manualSetReadyState=function(){this.iAmConnected=!0,this.parentReady=!0},Object.defineProperty(e.prototype,"transportWindowId",{get:function(){return this.publicWindowId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"communicationId",{get:function(){return this._communicationId},enumerable:!1,configurable:!0}),e.prototype.sendObject=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(this.extContentConnected)return[2,window.postMessage({glue42ExtOut:e},this.defaultTargetString)];if(!this.port)throw new Error("Cannot send message, because the port was not opened yet");return this.port.postMessage(e),[2]}))}))},Object.defineProperty(e.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},e.prototype.send=function(){return Promise.reject("not supported")},e.prototype.onConnectedChanged=function(e){return this.registry.add("onConnectedChanged",e)},e.prototype.open=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.logger.debug("opening a connection to the web platform gateway."),[4,this.connect()];case 1:return e.sent(),this.notifyStatusChanged(!0),[2]}}))}))},e.prototype.close=function(){var e,t,n={glue42core:{type:this.messages.gatewayDisconnect.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};return null===(t=this.port)||void 0===t||t.postMessage(n),this.parentReady=!1,this.notifyStatusChanged(!1,"manual reconnection"),Promise.resolve()},e.prototype.name=function(){return"web-platform"},e.prototype.reconnect=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.close()];case 1:return e.sent(),[2,Promise.resolve()]}}))}))},e.prototype.initiateInternalConnection=function(){var e=this;return new Promise((function(t,n){e.logger.debug("opening an internal web platform connection"),e.port=e.settings.port,e.iAmConnected?e.logger.warn("cannot open a new connection, because this client is currently connected"):(e.port.onmessage=function(r){var i,o;if(!e.iAmConnected||(null===(i=r.data)||void 0===i?void 0:i.glue42core)){var l=null===(o=r.data)||void 0===o?void 0:o.glue42core;l&&(l.type===e.messages.gatewayInternalConnect.name&&l.success&&(e.publicWindowId=e.settings.windowId,e.identity&&e.publicWindowId&&(e.identity.windowId=e.publicWindowId,e.identity.instance=e.publicWindowId),t()),l.type===e.messages.gatewayInternalConnect.name&&l.error&&n(l.error))}else e.registry.execute("onMessage",r.data)},e.port.postMessage({glue42core:{type:e.messages.gatewayInternalConnect.name}}))}))},e.prototype.initiateRemoteConnection=function(e){var t=this;return PromisePlus$1((function(n,r){var i;t.connectionResolve=n,t.connectionReject=r,t.myClientId=null!==(i=t.myClientId)&&void 0!==i?i:shortid();var o=t.getMyWindowId()||shortid(),l={glue42core:{type:t.messages.connectionRequest.name,clientId:t.myClientId,clientType:"child",bridgeInstanceId:o,selfAssignedWindowId:t.selfAssignedWindowId}};if(t.logger.debug("sending connection request"),t.extContentConnecting)return l.glue42core.clientType="child",l.glue42core.bridgeInstanceId=t.myClientId,l.glue42core.parentWindowId=t.parentWindowId,window.postMessage(l,t.defaultTargetString);if(!e)throw new Error("Cannot send a connection request, because no glue target was specified!");e.postMessage(l,t.defaultTargetString)}),this.connectionRequestTimeout,"The connection to the target glue window timed out")},e.prototype.isParentCheckSuccess=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e];case 1:return t.sent(),[2,{success:!0}];case 2:return t.sent(),[2,{success:!1}];case 3:return[2]}}))}))},e.prototype.setUpMessageListener=function(){var e=this;this.settings.port?this.logger.debug("skipping generic message listener, because this is an internal client"):window.addEventListener("message",(function(t){var n,r=null===(n=t.data)||void 0===n?void 0:n.glue42core;if(r&&!e.rejected){var i=e.settings.allowedOrigins||[];if(!i.length||i.includes(t.origin))if(e.checkMessageTypeValid(r.type)){var o=r.type;e.logger.debug("received valid glue42core message of type: ".concat(o)),e.messages[o].handle(t)}else e.logger.error("cannot handle the incoming glue42 core message, because the type is invalid: ".concat(r.type));else e.logger.warn("received a message from an origin which is not in the allowed list: ".concat(t.origin))}}))},e.prototype.setUpUnload=function(){var e=this;this.settings.port?this.logger.debug("skipping unload event listener, because this is an internal client"):window.addEventListener("beforeunload",(function(){var t,n;if(!e.extContentConnected){var r={glue42core:{type:e.messages.clientUnload.name,data:{clientId:e.myClientId,ownWindowId:null===(t=e.identity)||void 0===t?void 0:t.windowId}}};e.parent&&e.parent.postMessage(r,e.defaultTargetString),null===(n=e.port)||void 0===n||n.postMessage(r)}}))},e.prototype.handlePlatformReady=function(e){this.logger.debug("the web platform gave the ready signal"),this.parentReady=!0,this.parentPingResolve&&(this.parentPingResolve(),delete this.parentPingResolve),this.parentPingInterval&&(clearInterval(this.parentPingInterval),delete this.parentPingInterval),this.parent=e.source,this.parentType=window.name.includes("#wsp")?"workspace":"window"},e.prototype.handleConnectionAccepted=function(e){var t,n=null===(t=e.data)||void 0===t?void 0:t.glue42core;return this.myClientId===n.clientId?this.handleAcceptanceOfMyRequest(n):this.handleAcceptanceOfGrandChildRequest(n,e)},e.prototype.handleAcceptanceOfMyRequest=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me."),this.isPreferredActivated=e.isPreferredActivated,this.extContentConnecting)return this.processExtContentConnection(e);if(e.port){if(this.publicWindowId=this.getMyWindowId(),this.identity&&(this.identity.windowId=this.publicWindowId,this.identity.instance=this.identity.instance?this.identity.instance:this.publicWindowId||shortid()),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),this._communicationId=e.communicationId,this.port=e.port,this.port.onmessage=function(e){return t.registry.execute("onMessage",e.data)},this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve;this.logger.error("unable to call the connection resolve, because no connection promise was found")}else this.logger.error("cannot set up my connection, because I was not provided with a port")},e.prototype.processExtContentConnection=function(e){var t=this;if(this.logger.debug("handling a connection accepted signal targeted at me for extension content connection."),this.extContentConnecting=!1,this.extContentConnected=!0,this.publicWindowId=this.parentWindowId||this.myClientId,this.extContentConnecting&&this.identity&&(this.identity.windowId=this.publicWindowId),this.identity&&e.appName&&(this.identity.application=e.appName,this.identity.applicationName=e.appName),window.addEventListener("message",(function(e){var n,r=null===(n=e.data)||void 0===n?void 0:n.glue42ExtInc;if(r){var i=t.settings.allowedOrigins||[];!i.length||i.includes(e.origin)?t.registry.execute("onMessage",r):t.logger.warn("received a message from an origin which is not in the allowed list: ".concat(e.origin))}})),this.connectionResolve)return this.logger.debug("my connection is set up, calling the connection resolve."),this.connectionResolve(),void delete this.connectionResolve},e.prototype.handleAcceptanceOfGrandChildRequest=function(e,t){if(this.extContentConnecting||this.extContentConnected)this.logger.debug("cannot process acceptance of a grandchild, because I am connected to a content script");else{this.logger.debug("handling a connection accepted signal targeted at a grandchild: ".concat(e.clientId));var n=this.children.find((function(t){return t.grandChildId===e.clientId}));n?(n.connected=!0,this.logger.debug("the grandchild connection for ".concat(e.clientId," is set up, forwarding the success message and the gateway port")),e.parentWindowId=this.publicWindowId,n.source.postMessage(t.data,n.origin,[e.port])):this.logger.error("cannot handle connection accepted for grandchild: ".concat(e.clientId,", because there is no grandchild with this id"))}},e.prototype.handleConnectionRejected=function(){this.logger.debug("handling a connection rejection. Most likely the reason is that this window was not created by a glue API call"),this.connectionReject&&(this.connectionReject("The platform connection was rejected. Most likely because this window was not created by a glue API call"),delete this.connectionReject)},e.prototype.handleConnectionRequest=function(e){if(this.extContentConnecting)this.logger.debug("This connection request event is targeted at the extension content");else{var t=e.source,n=e.data.glue42core;if(!n.clientType||"grandChild"!==n.clientType)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source was not opened by a glue API call");if(!n.clientId)return this.rejectConnectionRequest(t,e.origin,"rejecting a connection request, because the source did not provide a valid id");if(!this.parent)return this.rejectConnectionRequest(t,e.origin,"Cannot forward the connection request, because no direct connection to the platform was found");this.logger.debug("handling a connection request for a grandchild: ".concat(n.clientId)),this.children.push({grandChildId:n.clientId,source:t,connected:!1,origin:e.origin}),this.logger.debug("grandchild: ".concat(n.clientId," is prepared, forwarding connection request to the platform")),this.parent.postMessage(e.data,this.defaultTargetString)}},e.prototype.handleParentPing=function(e){if(this.parentReady)if(this.iAmConnected){var t={glue42core:{type:this.messages.parentReady.name}};this.extContentConnected&&(t.glue42core.extMode={windowId:this.myClientId});var n=e.source;this.logger.debug("responding to a parent ping with a ready message"),n.postMessage(t,e.origin)}else this.logger.debug("i am not fully connected yet, I am ignoring the parent ping");else this.logger.debug("my parent is not ready, I am ignoring the parent ping")},e.prototype.setupPlatformUnloadListener=function(){var e=this;this.onMessage((function(t){"platformUnload"===t.type&&(e.logger.debug("detected a web platform unload"),e.parentReady=!1,e.notifyStatusChanged(!1,"Gateway unloaded"))}))},e.prototype.handleManualUnload=function(){var e,t,n={glue42core:{type:this.messages.clientUnload.name,data:{clientId:this.myClientId,ownWindowId:null===(e=this.identity)||void 0===e?void 0:e.windowId}}};if(this.extContentConnected)return window.postMessage({glue42ExtOut:n},this.defaultTargetString);null===(t=this.port)||void 0===t||t.postMessage(n)},e.prototype.handleClientUnload=function(e){var t=e.data.glue42core,n=null==t?void 0:t.data.clientId;n?this.children.find((function(e){return e.grandChildId===n}))?(this.logger.debug("handling grandchild unload for id: ".concat(n)),this.children=this.children.filter((function(e){return e.grandChildId!==n}))):this.logger.warn("cannot process grand child unload, because this client is unaware of this grandchild"):this.logger.warn("cannot process grand child unload, because the provided id was not valid")},e.prototype.handlePlatformPing=function(){},e.prototype.notifyStatusChanged=function(e,t){this.iAmConnected=e,this.registry.execute("onConnectedChanged",e,t)},e.prototype.checkMessageTypeValid=function(e){return"string"==typeof e&&!!this.messages[e]},e.prototype.rejectConnectionRequest=function(e,t,n){this.rejected=!0,this.logger.error(n);var r={glue42core:{type:this.messages.connectionRejected.name}};e.postMessage(r,t)},e.prototype.requestConnectionPermissionFromExt=function(){var e=this;return this.waitForContentScript().then((function(){return PromisePlus$1((function(t,n){e.extConnectionResolve=t,e.extConnectionReject=n;e.logger.debug("permission request to the extension content script was sent"),window.postMessage({glue42core:{type:"extSetupRequest"}},e.defaultTargetString)}),e.parentPingTimeout,"Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection timed out")}))},e.prototype.handleExtConnectionResponse=function(e){var t;if(!(null===(t=e.data)||void 0===t?void 0:t.glue42core).approved)return this.extConnectionReject?this.extConnectionReject("Cannot initialize glue, because this app was not opened or created by a Glue Client and the request for extension connection was rejected"):void 0;this.extConnectionResolve&&(this.extConnectionResolve(),delete this.extConnectionResolve),this.extContentConnecting=!0,this.parentType="extension",this.logger.debug("The extension connection was approved, proceeding.")},e.prototype.handleExtSetupRequest=function(){},e.prototype.handleGatewayDisconnect=function(){},e.prototype.handleGatewayInternalConnect=function(){},e.prototype.waitForContentScript=function(){var e;return!!(null===(e=window.glue42ext)||void 0===e?void 0:e.content)?Promise.resolve():PromisePlus$1((function(e){window.addEventListener("Glue42EXTReady",(function(){e()}))}),this.connectionRequestTimeout,"The content script was available, but was never heard to be ready")},e.prototype.connect=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.settings.port?[4,this.initiateInternalConnection()]:[3,2];case 1:return e.sent(),this.logger.debug("internal web platform connection completed"),[2];case 2:return this.logger.debug("opening a client web platform connection"),[4,this.findParent()];case 3:return e.sent(),[4,this.initiateRemoteConnection(this.parent)];case 4:return e.sent(),this.logger.debug("the client is connected"),[2]}}))}))},e.prototype.findParent=function(){var e;return __awaiter(this,void 0,void 0,(function(){var t,n,r,i;return __generator(this,(function(o){switch(o.label){case 0:if(t="Cannot initiate glue, because this window was not opened or created by a glue client",n=this.getPossibleParentsInWindow(window),r=this.getPossibleParentsOutsideWindow(null===(e=window.top)||void 0===e?void 0:e.opener,window.top),!(i=new Set(__spreadArray(__spreadArray([],n,!0),r,!0))).size&&!this.extContentAvailable)throw new Error(t);return i.size||!this.extContentAvailable?[3,2]:[4,this.requestConnectionPermissionFromExt()];case 1:case 4:return o.sent(),[2];case 2:return[4,this.isParentCheckSuccess(this.confirmParent(Array.from(i)))];case 3:if(o.sent().success)return this.logger.debug("The default parent was found!"),[2];if(!this.extContentAvailable)throw new Error(t);return[4,this.requestConnectionPermissionFromExt()]}}))}))},e.prototype.getPossibleParentsInWindow=function(e){return e&&e!==e.top?__spreadArray([e.parent],this.getPossibleParentsInWindow(e.parent),!0):[]},e.prototype.getPossibleParentsOutsideWindow=function(e,t){return e&&t&&e!==t?__spreadArray(__spreadArray([e],this.getPossibleParentsInWindow(e),!0),this.getPossibleParentsOutsideWindow(e.opener,e),!0):[]},e.prototype.confirmParent=function(e){var t=this,n=PromisePlus$1((function(n){t.parentPingResolve=n;var r={glue42core:{type:t.messages.platformPing.name}};t.parentPingInterval=setInterval((function(){e.forEach((function(e){e.postMessage(r,t.defaultTargetString)}))}),1e3)}),this.parentPingTimeout,"Cannot initiate glue, because this window was not opened or created by a glue client");return n.catch((function(){t.parentPingInterval&&(clearInterval(t.parentPingInterval),delete t.parentPingInterval)})),n},e.prototype.getMyWindowId=function(){var e;return"workspace"===this.parentType?window.name.substring(0,window.name.indexOf("#wsp")):window===window.top?(null===(e=window.name)||void 0===e?void 0:e.includes("g42"))?window.name:(this.selfAssignedWindowId=this.selfAssignedWindowId||"g42-".concat(shortid()),this.selfAssignedWindowId):void 0},e}(),waitForInvocations=function(e,t){var n=e;return function(){0===--n&&t()}},AsyncSequelizer$1=function(){function e(e){void 0===e&&(e=0),this.minSequenceInterval=e,this.queue=[],this.isExecutingQueue=!1}return e.prototype.enqueue=function(e){var t=this;return new Promise((function(n,r){t.queue.push({action:e,resolve:n,reject:r}),t.executeQueue()}))},e.prototype.executeQueue=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n;return __generator(this,(function(r){switch(r.label){case 0:if(this.isExecutingQueue)return[2];this.isExecutingQueue=!0,r.label=1;case 1:if(!this.queue.length)return[3,7];if(!(e=this.queue.shift()))return this.isExecutingQueue=!1,[2];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,e.action()];case 3:return t=r.sent(),e.resolve(t),[3,5];case 4:return n=r.sent(),e.reject(n),[3,5];case 5:return[4,this.intervalBreak()];case 6:return r.sent(),[3,1];case 7:return this.isExecutingQueue=!1,[2]}}))}))},e.prototype.intervalBreak=function(){var e=this;return new Promise((function(t){return setTimeout(t,e.minSequenceInterval)}))},e}(),Connection=function(){function e(e,t){if(this.settings=e,this.logger=t,this.messageHandlers={},this.ids=1,this.registry=lib$1(),this._connected=!1,this.isTrace=!1,this._swapTransport=!1,this._switchInProgress=!1,this._transportSubscriptions=[],this._sequelizer=new AsyncSequelizer$1,(e=e||{}).reconnectAttempts=e.reconnectAttempts||10,e.reconnectInterval=e.reconnectInterval||1e3,e.inproc)this.transport=new InProcTransport(e.inproc,t.subLogger("inMemory"));else if(e.sharedWorker)this.transport=new SharedWorkerTransport(e.sharedWorker,t.subLogger("shared-worker"));else if(e.webPlatform)this.transport=new WebPlatformTransport(e.webPlatform,t.subLogger("web-platform"),e.identity);else{if(void 0===e.ws)throw new Error("No connection information specified");this.transport=new WS(e,t.subLogger("ws"))}this.isTrace=t.canPublish("trace"),t.debug("starting with ".concat(this.transport.name()," transport")),this.protocol=new GW3ProtocolImpl(this,e,t.subLogger("protocol"));var n=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),r=this.transport.onMessage(this.handleTransportMessage.bind(this));this._transportSubscriptions.push(n),this._transportSubscriptions.push(r),this._defaultTransport=this.transport}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;return null===(e=this.protocol)||void 0===e?void 0:e.protocolVersion},enumerable:!1,configurable:!0}),e.prototype.switchTransport=function(e){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(n){return[2,this._sequelizer.enqueue((function(){return __awaiter(t,void 0,void 0,(function(){var t,n,r;return __generator(this,(function(i){switch(i.label){case 0:if(!e||"object"!=typeof e)throw new Error("Cannot switch transports, because the settings are missing or invalid.");if(void 0===e.type)throw new Error("Cannot switch the transport, because the type is not defined");return this.logger.trace("Starting transport switch with settings: ".concat(JSON.stringify(e))),t="secondary"===e.type?this.getNewSecondaryTransport(e):this._defaultTransport,this._targetTransport=t,this._targetAuth="secondary"===e.type?this.getNewSecondaryAuth(e):this._defaultAuth,n=this.verifyConnection(),this._swapTransport=!0,this._switchInProgress=!0,this.logger.trace("The new transport has been set, closing the current transport"),[4,this.transport.close()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,n];case 3:return i.sent(),r=this.transport===t,this.logger.info("The reconnection after the switch was completed. Was the switch a success: ".concat(r)),this._switchInProgress=!1,[2,{success:r}];case 4:return i.sent(),this.logger.info("The reconnection after the switch timed out, reverting back to the default transport."),this.switchTransport({type:"default"}),this._switchInProgress=!1,[2,{success:!1}];case 5:return[2]}}))}))}))]}))}))},e.prototype.onLibReAnnounced=function(e){return this.registry.add("libReAnnounced",e)},e.prototype.setLibReAnnounced=function(e){this.registry.execute("libReAnnounced",e)},e.prototype.send=function(e,t){if(this.transport.sendObject&&this.transport.isObjectBasedTransport){var n=this.protocol.createObjectMessage(e);return this.isTrace&&this.logger.trace(">> ".concat(JSON.stringify(n))),this.transport.sendObject(n,t)}var r=this.protocol.createStringMessage(e);return this.isTrace&&this.logger.trace(">> ".concat(r)),this.transport.send(r,t)},e.prototype.on=function(e,t){e=e.toLowerCase(),void 0===this.messageHandlers[e]&&(this.messageHandlers[e]={});var n=this.ids++;return this.messageHandlers[e][n]=t,{type:e,id:n}},e.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.protocol.isLoggedIn},enumerable:!1,configurable:!0}),e.prototype.connected=function(e){var t=this;return this.protocol.loggedIn((function(){var n=t.transport.name();e(n)}))},e.prototype.disconnected=function(e){return this.registry.add("disconnected",e)},e.prototype.login=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i;return __generator(this,(function(o){switch(o.label){case 0:this._defaultAuth||(this._defaultAuth=e),this._swapTransport&&(this.logger.trace("Detected a transport swap, swapping transports"),n=this.transportSwap(),e=null!=n?n:e),this.logger.trace("Starting login for transport: ".concat(this.transport.name()," and auth ").concat(JSON.stringify(e))),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this.transport.open()];case 2:return o.sent(),this.logger.trace("Transport: ".concat(this.transport.name()," opened, logging in")),timer("connection").mark("transport-opened"),[4,this.protocol.login(e,t)];case 3:return r=o.sent(),this.logger.trace("Logged in with identity: ".concat(JSON.stringify(r))),timer("connection").mark("protocol-logged-in"),[2,r];case 4:throw i=o.sent(),this._switchInProgress&&(this.logger.trace("An error while logging in after a transport swap, preparing a default swap."),this.prepareDefaultSwap()),new Error(i);case 5:return[2]}}))}))},e.prototype.logout=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.protocol.logout()];case 1:return e.sent(),[4,this.transport.close()];case 2:return e.sent(),[2]}}))}))},e.prototype.loggedIn=function(e){return this.protocol.loggedIn(e)},e.prototype.domain=function(e,t,n){return this.protocol.domain(e,this.logger.subLogger("domain=".concat(e)),t,n)},e.prototype.authToken=function(){return this.protocol.authToken()},e.prototype.reconnect=function(){return this.transport.reconnect()},e.prototype.distributeMessage=function(e,t){var n=this,r=this.messageHandlers[t.toLowerCase()];void 0!==r&&Object.keys(r).forEach((function(t){var i=r[t];if(void 0!==i)try{i(e)}catch(e){try{n.logger.error("Message handler failed with ".concat(e.stack),e)}catch(t){console.log("Message handler failed",e)}}}))},e.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?(this.settings.replaySpecs&&this.settings.replaySpecs.length&&(this.replayer=new MessageReplayerImpl(this.settings.replaySpecs),this.replayer.init(this)),this.registry.execute("connected")):this.registry.execute("disconnected"))},e.prototype.handleTransportMessage=function(e){var t;t="string"==typeof e?this.protocol.processStringMessage(e):this.protocol.processObjectMessage(e),this.isTrace&&this.logger.trace("<< ".concat(JSON.stringify(t))),this.distributeMessage(t.msg,t.msgType)},e.prototype.verifyConnection=function(){var e=this;return PromisePlus$1((function(t){var n,r=waitForInvocations(2,(function(){n&&n(),t()}));n=e.onLibReAnnounced((function(e){return"interop"===e.name||"contexts"===e.name?r():void 0}))}),1e4,"Transport switch timed out waiting for all libraries to be re-announced")},e.prototype.getNewSecondaryTransport=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.url))throw new Error("Missing secondary transport URL.");return new WS(Object.assign({},this.settings,{ws:e.transportConfig.url,reconnectAttempts:1}),this.logger.subLogger("ws-secondary"))},e.prototype.getNewSecondaryAuth=function(e){var t;if(!(null===(t=e.transportConfig)||void 0===t?void 0:t.auth))throw new Error("Missing secondary transport auth information.");return e.transportConfig.auth},e.prototype.transportSwap=function(){if(this._swapTransport=!1,this._targetTransport&&this._targetAuth){this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport=this._targetTransport;var e=this.transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),t=this.transport.onMessage(this.handleTransportMessage.bind(this));return this._transportSubscriptions.push(e),this._transportSubscriptions.push(t),this._targetAuth}this.logger.warn("Error while switching transports - either the target transport or auth is not defined: transport defined -> ".concat(!!this._defaultTransport,", auth defined -> ").concat(!!this._targetAuth,". Staying on the current one."))},e.prototype.prepareDefaultSwap=function(){var e=this;this._transportSubscriptions.forEach((function(e){return e()})),this._transportSubscriptions=[],this.transport.close().catch((function(t){return e.logger.warn("Error closing the ".concat(e.transport.name()," transport after a failed connection attempt: ").concat(JSON.stringify(t)))})),this._targetTransport=this._defaultTransport,this._targetAuth=this._defaultAuth,this._swapTransport=!0},e}(),order=["trace","debug","info","warn","error","off"],Logger=function(){function e(e,t,n){this.name=e,this.parent=t,this.subLoggers=[],this.logFn=console,this.customLogFn=!1,this.name=e,this.path=t?"".concat(t.path,".").concat(e):e,this.loggerFullName="[".concat(this.path,"]"),this.includeTimeAndLevel=!n,n&&(this.logFn=n,this.customLogFn=!0)}return e.prototype.subLogger=function(t){var n=this.subLoggers.filter((function(e){return e.name===t}))[0];if(void 0!==n)return n;Object.keys(this).forEach((function(e){if(e===t)throw new Error("This sub logger name is not allowed.")}));var r=new e(t,this,this.customLogFn?this.logFn:void 0);return this.subLoggers.push(r),r},e.prototype.publishLevel=function(e){var t;return e&&(this._publishLevel=e),this._publishLevel||(null===(t=this.parent)||void 0===t?void 0:t.publishLevel())},e.prototype.consoleLevel=function(e){var t;return e&&(this._consoleLevel=e),this._consoleLevel||(null===(t=this.parent)||void 0===t?void 0:t.consoleLevel())},e.prototype.log=function(e,t,n){this.publishMessage(t||"info",e,n)},e.prototype.trace=function(e){this.log(e,"trace")},e.prototype.debug=function(e){this.log(e,"debug")},e.prototype.info=function(e){this.log(e,"info")},e.prototype.warn=function(e){this.log(e,"warn")},e.prototype.error=function(e,t){this.log(e,"error")},e.prototype.canPublish=function(e,t){return order.indexOf(e)>=order.indexOf(t||this.consoleLevel()||"trace")},e.prototype.publishMessage=function(t,n,r){var i=this.loggerFullName;if("error"===t&&!r){var o=new Error;o.stack&&(n=n+"\n"+o.stack.split("\n").slice(3).join("\n"))}if(this.canPublish(t,this.publishLevel())){var l=e.Interop;if(l)try{l.methods({name:e.InteropMethodName}).length>0&&l.invoke(e.InteropMethodName,{msg:"".concat(n),logger:i,level:t})}catch(e){}}if(this.canPublish(t)){var s="";if(this.includeTimeAndLevel){var a=new Date,u="".concat(a.getHours(),":").concat(a.getMinutes(),":").concat(a.getSeconds(),":").concat(a.getMilliseconds());s="[".concat(u,"] [").concat(t,"] ")}var c="".concat(s).concat(i,": ").concat(n);switch(t){case"trace":this.logFn.debug(c);break;case"debug":this.logFn.debug?this.logFn.debug(c):this.logFn.log(c);break;case"info":this.logFn.info(c);break;case"warn":this.logFn.warn(c);break;case"error":this.logFn.error(c,r)}}},e.InteropMethodName="T42.AppLogger.Log",e}(),GW_MESSAGE_CREATE_CONTEXT="create-context",GW_MESSAGE_ACTIVITY_CREATED="created",GW_MESSAGE_ACTIVITY_DESTROYED="destroyed",GW_MESSAGE_CONTEXT_CREATED="context-created",GW_MESSAGE_CONTEXT_ADDED="context-added",GW_MESSAGE_SUBSCRIBE_CONTEXT="subscribe-context",GW_MESSAGE_SUBSCRIBED_CONTEXT="subscribed-context",GW_MESSAGE_UNSUBSCRIBE_CONTEXT="unsubscribe-context",GW_MESSAGE_DESTROY_CONTEXT="destroy-context",GW_MESSAGE_CONTEXT_DESTROYED="context-destroyed",GW_MESSAGE_UPDATE_CONTEXT="update-context",GW_MESSAGE_CONTEXT_UPDATED="context-updated",GW_MESSAGE_JOINED_ACTIVITY="joined",ContextMessageReplaySpec={get name(){return"context"},get types(){return[GW_MESSAGE_CREATE_CONTEXT,GW_MESSAGE_ACTIVITY_CREATED,GW_MESSAGE_ACTIVITY_DESTROYED,GW_MESSAGE_CONTEXT_CREATED,GW_MESSAGE_CONTEXT_ADDED,GW_MESSAGE_SUBSCRIBE_CONTEXT,GW_MESSAGE_SUBSCRIBED_CONTEXT,GW_MESSAGE_UNSUBSCRIBE_CONTEXT,GW_MESSAGE_DESTROY_CONTEXT,GW_MESSAGE_CONTEXT_DESTROYED,GW_MESSAGE_UPDATE_CONTEXT,GW_MESSAGE_CONTEXT_UPDATED,GW_MESSAGE_JOINED_ACTIVITY]}},version$2="6.2.0";function prepareConfig(e,t,n){var r,i,o,l,s;if(Utils.isNode()){var a=process.env._GD_STARTING_CONTEXT_;if(a)try{s=JSON.parse(a)}catch(e){}}function u(){if(e.application)return e.application;if(n)return n.applicationName;if("undefined"!=typeof window&&void 0!==window.glue42electron)return window.glue42electron.application;var t=shortid();return Utils.isNode()?s?s.applicationConfig.name:"NodeJS"+t:"undefined"!=typeof window&&"undefined"!=typeof document?document.title+" (".concat(t,")"):t}var c=function(){var r,i,o,l,a,c,h,d,f,p,g,w=e.gateway,m=null!==(r=null==w?void 0:w.protocolVersion)&&void 0!==r?r:3,v=null==w?void 0:w.reconnectInterval,y=null==w?void 0:w.reconnectAttempts,b=null==w?void 0:w.ws,S=null==w?void 0:w.sharedWorker,$=null==w?void 0:w.inproc,C=null!==(i=null==w?void 0:w.webPlatform)&&void 0!==i?i:void 0;n&&(b=n.gwURL),Utils.isNode()&&s&&s.gwURL&&(b=s.gwURL),b||S||$||(b="ws://localhost:8385");var I=u(),x=I;void 0!==n?(d=n.windowId,f=n.pid,n.env&&(p=n.env.env,g=n.env.region),x=null!==(o=n.application)&&void 0!==o?o:"glue-app",h=n.appInstanceId):Utils.isNode()?(f=process.pid,s&&(p=s.env,g=s.region,h=s.instanceId)):void 0!==(null===window||void 0===window?void 0:window.glue42electron)&&(d=null===window||void 0===window?void 0:window.glue42electron.instanceId,f=null===window||void 0===window?void 0:window.glue42electron.pid,p=null===window||void 0===window?void 0:window.glue42electron.env,g=null===window||void 0===window?void 0:window.glue42electron.region,x=null!==(l=null===window||void 0===window?void 0:window.glue42electron.application)&&void 0!==l?l:"glue-app",h=null===window||void 0===window?void 0:window.glue42electron.instanceId);var E=null!==(c=null===(a=e.gateway)||void 0===a?void 0:a.replaySpecs)&&void 0!==c?c:[];E.push(ContextMessageReplaySpec);var D={application:x,applicationName:I,windowId:d,instance:h,process:f,region:g,environment:p,api:t.version||version$2};return e.identity&&(D=Object.assign(D,e.identity)),{identity:D,reconnectInterval:v,ws:b,sharedWorker:S,webPlatform:C,inproc:$,protocolVersion:m,reconnectAttempts:y,replaySpecs:E}}(),h=u();if("undefined"!=typeof window){var d=window,f=d.htmlContainer?"".concat(d.htmlContainer.containerName,".").concat(d.htmlContainer.application):null===(r=null==d?void 0:d.glue42gd)||void 0===r?void 0:r.application;f&&(h=f)}return{bus:null!==(i=e.bus)&&void 0!==i&&i,application:h,auth:function(){var t,n,r;return"string"==typeof e.auth?{token:e.auth}:e.auth?e.auth:Utils.isNode()&&s&&s.gwToken?{gatewayToken:s.gwToken}:(null===(t=e.gateway)||void 0===t?void 0:t.webPlatform)||(null===(n=e.gateway)||void 0===n?void 0:n.inproc)||(null===(r=e.gateway)||void 0===r?void 0:r.sharedWorker)?{username:"glue42",password:"glue42"}:void 0}(),logger:function(){var t,r,i,o=e.logger,l="warn";return o||(o=l),n&&(i=n.consoleLogLevel),"string"==typeof o?{console:null!=i?i:o,publish:l}:{console:null!==(t=null!=i?i:o.console)&&void 0!==t?t:l,publish:null!==(r=o.publish)&&void 0!==r?r:l}}(),connection:c,metrics:null===(o=e.metrics)||void 0===o||o,contexts:void 0===e.contexts||"boolean"==typeof e.contexts&&e.contexts?{reAnnounceKnownContexts:!0}:"object"==typeof e.contexts&&Object.assign({},{reAnnounceKnownContexts:!0},e.contexts),version:t.version||version$2,libs:null!==(l=t.libs)&&void 0!==l?l:[],customLogger:e.customLogger}}var GW3ContextData=function(){function e(e,t,n,r){this.updateCallbacks={},this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=r,this.context={}}return e.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},e.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},e}(),lodash_clonedeepExports={},lodash_clonedeep={get exports(){return lodash_clonedeepExports},set exports(e){lodash_clonedeepExports=e}};!function(e,t){var n="__lodash_hash_undefined__",r=9007199254740991,i="[object Arguments]",o="[object Boolean]",l="[object Date]",s="[object Function]",a="[object GeneratorFunction]",u="[object Map]",c="[object Number]",h="[object Object]",d="[object Promise]",f="[object RegExp]",p="[object Set]",g="[object String]",w="[object Symbol]",m="[object WeakMap]",v="[object ArrayBuffer]",y="[object DataView]",b="[object Float32Array]",S="[object Float64Array]",$="[object Int8Array]",C="[object Int16Array]",I="[object Int32Array]",x="[object Uint8Array]",E="[object Uint8ClampedArray]",D="[object Uint16Array]",A="[object Uint32Array]",k=/\w*$/,_=/^\[object .+?Constructor\]$/,j=/^(?:0|[1-9]\d*)$/,N={};N[i]=N["[object Array]"]=N[v]=N[y]=N[o]=N[l]=N[b]=N[S]=N[$]=N[C]=N[I]=N[u]=N[c]=N[h]=N[f]=N[p]=N[g]=N[w]=N[x]=N[E]=N[D]=N[A]=!0,N["[object Error]"]=N[s]=N[m]=!1;var R="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,T="object"==typeof self&&self&&self.Object===Object&&self,P=R||T||Function("return this")(),O=t&&!t.nodeType&&t,F=O&&e&&!e.nodeType&&e,B=F&&F.exports===O;function M(e,t){return e.set(t[0],t[1]),e}function Q(e,t){return e.add(t),e}function G(e,t,n,r){var i=-1,o=e?e.length:0;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function U(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function J(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function W(e,t){return function(n){return e(t(n))}}function q(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var L,K=Array.prototype,H=Function.prototype,z=Object.prototype,V=P["__core-js_shared__"],X=(L=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+L:"",Z=H.toString,Y=z.hasOwnProperty,ee=z.toString,te=RegExp("^"+Z.call(Y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ne=B?P.Buffer:void 0,re=P.Symbol,ie=P.Uint8Array,oe=W(Object.getPrototypeOf,Object),le=Object.create,se=z.propertyIsEnumerable,ae=K.splice,ue=Object.getOwnPropertySymbols,ce=ne?ne.isBuffer:void 0,he=W(Object.keys,Object),de=Fe(P,"DataView"),fe=Fe(P,"Map"),pe=Fe(P,"Promise"),ge=Fe(P,"Set"),we=Fe(P,"WeakMap"),me=Fe(Object,"create"),ve=Ue(de),ye=Ue(fe),be=Ue(pe),Se=Ue(ge),$e=Ue(we),Ce=re?re.prototype:void 0,Ie=Ce?Ce.valueOf:void 0;function xe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ee(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function De(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ae(e){this.__data__=new Ee(e)}function ke(e,t){var n=We(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&qe(e)}(e)&&Y.call(e,"callee")&&(!se.call(e,"callee")||ee.call(e)==i)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,o=!!r;for(var l in e)!t&&!Y.call(e,l)||o&&("length"==l||Qe(l,r))||n.push(l);return n}function _e(e,t,n){var r=e[t];Y.call(e,t)&&Je(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function je(e,t){for(var n=e.length;n--;)if(Je(e[n][0],t))return n;return-1}function Ne(e,t,n,r,d,m,_){var j;if(r&&(j=m?r(e,d,m,_):r(e)),void 0!==j)return j;if(!He(e))return e;var R=We(e);if(R){if(j=function(e){var t=e.length,n=e.constructor(t);t&&"string"==typeof e[0]&&Y.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!t)return function(e,t){var n=-1,r=e.length;t||(t=Array(r));for(;++n<r;)t[n]=e[n];return t}(e,j)}else{var T=Me(e),P=T==s||T==a;if(Le(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if(T==h||T==i||P&&!m){if(U(e))return m?e:{};if(j=function(e){return"function"!=typeof e.constructor||Ge(e)?{}:(t=oe(e),He(t)?le(t):{});var t}(P?{}:e),!t)return function(e,t){return Pe(e,Be(e),t)}(e,function(e,t){return e&&Pe(t,ze(t),e)}(j,e))}else{if(!N[T])return m?e:{};j=function(e,t,n,r){var i=e.constructor;switch(t){case v:return Te(e);case o:case l:return new i(+e);case y:return function(e,t){var n=t?Te(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case b:case S:case $:case C:case I:case x:case E:case D:case A:return function(e,t){var n=t?Te(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case u:return function(e,t,n){var r=t?n(J(e),!0):J(e);return G(r,M,new e.constructor)}(e,r,n);case c:case g:return new i(e);case f:return function(e){var t=new e.constructor(e.source,k.exec(e));return t.lastIndex=e.lastIndex,t}(e);case p:return function(e,t,n){var r=t?n(q(e),!0):q(e);return G(r,Q,new e.constructor)}(e,r,n);case w:return s=e,Ie?Object(Ie.call(s)):{}}var s}(e,T,Ne,t)}}_||(_=new Ae);var O=_.get(e);if(O)return O;if(_.set(e,j),!R)var F=n?function(e){return function(e,t,n){var r=t(e);return We(e)?r:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(r,n(e))}(e,ze,Be)}(e):ze(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(F||e,(function(i,o){F&&(i=e[o=i]),_e(j,o,Ne(i,t,n,r,o,e,_))})),j}function Re(e){return!(!He(e)||(t=e,X&&X in t))&&(Ke(e)||U(e)?te:_).test(Ue(e));var t}function Te(e){var t=new e.constructor(e.byteLength);return new ie(t).set(new ie(e)),t}function Pe(e,t,n,r){n||(n={});for(var i=-1,o=t.length;++i<o;){var l=t[i],s=r?r(n[l],e[l],l,n,e):void 0;_e(n,l,void 0===s?e[l]:s)}return n}function Oe(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Fe(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Re(n)?n:void 0}xe.prototype.clear=function(){this.__data__=me?me(null):{}},xe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},xe.prototype.get=function(e){var t=this.__data__;if(me){var r=t[e];return r===n?void 0:r}return Y.call(t,e)?t[e]:void 0},xe.prototype.has=function(e){var t=this.__data__;return me?void 0!==t[e]:Y.call(t,e)},xe.prototype.set=function(e,t){return this.__data__[e]=me&&void 0===t?n:t,this},Ee.prototype.clear=function(){this.__data__=[]},Ee.prototype.delete=function(e){var t=this.__data__,n=je(t,e);return!(n<0)&&(n==t.length-1?t.pop():ae.call(t,n,1),!0)},Ee.prototype.get=function(e){var t=this.__data__,n=je(t,e);return n<0?void 0:t[n][1]},Ee.prototype.has=function(e){return je(this.__data__,e)>-1},Ee.prototype.set=function(e,t){var n=this.__data__,r=je(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},De.prototype.clear=function(){this.__data__={hash:new xe,map:new(fe||Ee),string:new xe}},De.prototype.delete=function(e){return Oe(this,e).delete(e)},De.prototype.get=function(e){return Oe(this,e).get(e)},De.prototype.has=function(e){return Oe(this,e).has(e)},De.prototype.set=function(e,t){return Oe(this,e).set(e,t),this},Ae.prototype.clear=function(){this.__data__=new Ee},Ae.prototype.delete=function(e){return this.__data__.delete(e)},Ae.prototype.get=function(e){return this.__data__.get(e)},Ae.prototype.has=function(e){return this.__data__.has(e)},Ae.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ee){var r=n.__data__;if(!fe||r.length<199)return r.push([e,t]),this;n=this.__data__=new De(r)}return n.set(e,t),this};var Be=ue?W(ue,Object):function(){return[]},Me=function(e){return ee.call(e)};function Qe(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||j.test(e))&&e>-1&&e%1==0&&e<t}function Ge(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||z)}function Ue(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Je(e,t){return e===t||e!=e&&t!=t}(de&&Me(new de(new ArrayBuffer(1)))!=y||fe&&Me(new fe)!=u||pe&&Me(pe.resolve())!=d||ge&&Me(new ge)!=p||we&&Me(new we)!=m)&&(Me=function(e){var t=ee.call(e),n=t==h?e.constructor:void 0,r=n?Ue(n):void 0;if(r)switch(r){case ve:return y;case ye:return u;case be:return d;case Se:return p;case $e:return m}return t});var We=Array.isArray;function qe(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}(e.length)&&!Ke(e)}var Le=ce||function(){return!1};function Ke(e){var t=He(e)?ee.call(e):"";return t==s||t==a}function He(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function ze(e){return qe(e)?ke(e):function(e){if(!Ge(e))return he(e);var t=[];for(var n in Object(e))Y.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}e.exports=function(e){return Ne(e,!0,!0)}}(lodash_clonedeep,lodash_clonedeepExports);var cloneDeep=lodash_clonedeepExports;function applyContextDelta(e,t,n){try{if((null==n?void 0:n.canPublish("trace"))&&(null==n||n.trace("applying context delta ".concat(JSON.stringify(t)," on context ").concat(JSON.stringify(e)))),!t)return e;if(t.reset)return e=__assign({},t.reset);if(e=deepClone(e,void 0),t.commands){for(var r=0,i=t.commands;r<i.length;r++){var o=i[r];"remove"===o.type?deletePath(e,o.path):"set"===o.type&&setValueToPath(e,o.value,o.path)}return e}var l=t.added,s=t.updated,a=t.removed;return l&&Object.keys(l).forEach((function(t){e[t]=l[t]})),s&&Object.keys(s).forEach((function(t){mergeObjectsProperties(t,e,s)})),a&&a.forEach((function(t){delete e[t]})),e}catch(r){return null==n||n.error("error applying context delta ".concat(JSON.stringify(t)," on context ").concat(JSON.stringify(e)),r),e}}function deepClone(e,t){return cloneDeep(e)}var mergeObjectsProperties=function(e,t,n){var r=n[e];if(void 0===r)return t;var i=t[e];return i&&r?"string"==typeof i||"number"==typeof i||"boolean"==typeof i||"string"==typeof r||"number"==typeof r||"boolean"==typeof r||Array.isArray(i)||Array.isArray(r)?(t[e]=r,t):(t[e]=Object.assign({},i,r),t):(t[e]=r,t)};function deepEqual(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!=typeof e[n])return!1;if(!deepEqual(e[n],t[n]))return!1}}for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}function setValueToPath(e,t,n){var r,i=n.split(".");for(r=0;r<i.length-1;r++)e[i[r]]||(e[i[r]]={}),"object"!=typeof e[i[r]]&&(e[i[r]]={}),e=e[i[r]];e[i[r]]=t}function isSubset(e,t){return Object.keys(t).every((function(n){return"object"==typeof t[n]?isSubset((null==e?void 0:e[n])||{},t[n]||{}):t[n]===(null==e?void 0:e[n])}))}function deletePath(e,t){var n,r=t.split(".");for(n=0;n<r.length-1;n++){if(!e[r[n]])return;e=e[r[n]]}delete e[r[n]]}var GW3Bridge=function(){function e(e){var t,n=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._creationPromises={},this._contextNameToId={},this._contextIdToName={},this._protocolVersion=void 0,this._contextsTempCache={},this._contextsSubscriptionsCache=[],this._connection=e.connection,this._logger=e.logger,this._trackAllContexts=e.trackAllContexts,this._reAnnounceKnownContexts=e.reAnnounceKnownContexts,this._gw3Session=this._connection.domain("global",[GW_MESSAGE_CONTEXT_CREATED,GW_MESSAGE_SUBSCRIBED_CONTEXT,GW_MESSAGE_CONTEXT_DESTROYED,GW_MESSAGE_CONTEXT_UPDATED]),this._gw3Session.disconnected(this.resetState.bind(this)),this._gw3Session.onJoined((function(e){if(e)return n._reAnnounceKnownContexts?void n.reInitiateState().then((function(){return n._connection.setLibReAnnounced({name:"contexts"})})):n._connection.setLibReAnnounced({name:"contexts"})})),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(t=this._connection.replayer)||void 0===t||t.drain(ContextMessageReplaySpec.name,(function(e){var t=e.type;t&&(t===GW_MESSAGE_CONTEXT_CREATED||t===GW_MESSAGE_CONTEXT_ADDED||t===GW_MESSAGE_ACTIVITY_CREATED?n.handleContextCreatedMessage(e):t===GW_MESSAGE_SUBSCRIBED_CONTEXT||t===GW_MESSAGE_CONTEXT_UPDATED||t===GW_MESSAGE_JOINED_ACTIVITY?n.handleContextUpdatedMessage(e):t!==GW_MESSAGE_CONTEXT_DESTROYED&&t!==GW_MESSAGE_ACTIVITY_DESTROYED||n.handleContextDestroyedMessage(e))}))}return Object.defineProperty(e.prototype,"protocolVersion",{get:function(){var e;if(!this._protocolVersion){var t=this._connection.availableDomains.find((function(e){return"context"===e.uri}));this._protocolVersion=null!==(e=null==t?void 0:t.version)&&void 0!==e?e:1}return this._protocolVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this.protocolVersion>=2},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){for(var e=0,t=this._gw3Subscriptions;e<t.length;e++){var n=t[e];this._connection.off(n)}for(var r in this._gw3Subscriptions.length=0,this._contextNameToData)this._contextNameToId.hasOwnProperty(r)&&delete this._contextNameToData[r]},e.prototype.createContext=function(e,t){var n=this;return e in this._creationPromises||(this._creationPromises[e]=this._gw3Session.send({type:GW_MESSAGE_CREATE_CONTEXT,domain:"global",name:e,data:t,lifetime:"retained"}).then((function(r){n._contextNameToId[e]=r.context_id,n._contextIdToName[r.context_id]=e;var i=n._contextNameToData[e]||new GW3ContextData(r.context_id,e,!0,void 0);return i.isAnnounced=!0,i.name=e,i.contextId=r.context_id,i.context=r.data||deepClone(t),i.hasReceivedSnapshot=!0,n._contextNameToData[e]=i,delete n._creationPromises[e],r.context_id}))),this._creationPromises[e]},e.prototype.all=function(){var e=this;return Object.keys(this._contextNameToData).filter((function(t){return e._contextNameToData[t].isAnnounced}))},e.prototype.update=function(e,t){var n;return __awaiter(this,void 0,void 0,(function(){var r,i,o,l=this;return __generator(this,(function(s){switch(s.label){case 0:return t&&(t=deepClone(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:s.sent(),s.label=2;case 2:return(r=this._contextNameToData[e])&&r.isAnnounced?(i=r.context,r.hasCallbacks()?[3,4]:[4,this.get(r.name)]):[2,this.createContext(e,t)];case 3:i=s.sent(),s.label=4;case 4:return o=this.setPathSupported?this.calculateContextDeltaV2(i,t):this.calculateContextDeltaV1(i,t),Object.keys(o.added).length||Object.keys(o.updated).length||o.removed.length||(null===(n=o.commands)||void 0===n?void 0:n.length)?[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:r.contextId,delta:o},{},{skipPeerId:!1}).then((function(e){l.handleUpdated(r,o,{updaterId:e.peer_id})}))]:[2,Promise.resolve()]}}))}))},e.prototype.set=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r=this;return __generator(this,(function(i){switch(i.label){case 0:return t&&(t=deepClone(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:i.sent(),i.label=2;case 2:return(n=this._contextNameToData[e])&&n.isAnnounced?[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:n.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then((function(e){r.handleUpdated(n,{reset:t,added:{},removed:[],updated:{}},{updaterId:e.peer_id})}))]:[2,this.createContext(e,t)]}}))}))},e.prototype.setPath=function(e,t,n){return this.setPathSupported?this.setPaths(e,[{path:t,value:n}]):Promise.reject("glue.contexts.setPath operation is not supported, use Glue42 3.10 or later")},e.prototype.setPaths=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i,o,l,s,a,u,c=this;return __generator(this,(function(h){switch(h.label){case 0:return this.setPathSupported?(t&&(t=deepClone(t)),e in this._creationPromises?[4,this._creationPromises[e]]:[3,2]):[2,Promise.reject("glue.contexts.setPaths operation is not supported, use Glue42 3.10 or later")];case 1:h.sent(),h.label=2;case 2:if(!(n=this._contextNameToData[e])||!n.isAnnounced){for(r={},i=0,o=t;i<o.length;i++)u=o[i],setValueToPath(r,u.value,u.path);return[2,this.createContext(e,r)]}for(l=[],s=0,a=t;s<a.length;s++)null===(u=a[s]).value?l.push({type:"remove",path:u.path}):l.push({type:"set",path:u.path,value:u.value});return[2,this._gw3Session.send({type:GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:n.contextId,delta:{commands:l}},{},{skipPeerId:!1}).then((function(e){c.handleUpdated(n,{added:{},removed:[],updated:{},commands:l},{updaterId:e.peer_id})}))]}}))}))},e.prototype.get=function(e){var t;return __awaiter(this,void 0,void 0,(function(){var n,r,i=this;return __generator(this,(function(o){switch(o.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:o.sent(),o.label=2;case 2:return(n=this._contextNameToData[e])&&n.isAnnounced?!n||n.hasCallbacks()&&n.hasReceivedSnapshot?(r=null!==(t=null==n?void 0:n.context)&&void 0!==t?t:{},[2,Promise.resolve(deepClone(r))]):[2,new Promise((function(t){i.subscribe(e,(function(e,n,r,o){i.unsubscribe(o),t(e)}))}))]:[2,Promise.resolve({})]}}))}))},e.prototype.subscribe=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,o,l,s=this;return __generator(this,(function(a){switch(a.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:a.sent(),a.label=2;case 2:return r=void 0===n?this._nextCallbackSubscriptionNumber:n,void 0===n&&(this._nextCallbackSubscriptionNumber+=1),this._contextsSubscriptionsCache.every((function(e){return e.subKey!==s._nextCallbackSubscriptionNumber}))&&this._contextsSubscriptionsCache.push({contextName:e,subKey:r,callback:t}),(i=this._contextNameToData[e])&&i.isAnnounced?(o=i.hasCallbacks(),i.updateCallbacks[r]=t,o||i.joinedActivity||i.context&&i.sentExplicitSubscription?(i.hasReceivedSnapshot&&(l=deepClone(i.context),t(l,l,[],r)),[2,Promise.resolve(r)]):[2,this.sendSubscribe(i).then((function(){return r}))]):(i=i||new GW3ContextData(void 0,e,!1,void 0),this._contextNameToData[e]=i,i.updateCallbacks[r]=t,[2,Promise.resolve(r)])}}))}))},e.prototype.unsubscribe=function(e){this._contextsSubscriptionsCache=this._contextsSubscriptionsCache.filter((function(t){return t.subKey!==e}));for(var t=0,n=Object.keys(this._contextNameToData);t<n.length;t++){var r=n[t],i=this._contextNameToData[r];if(!i)return;var o=i.hasCallbacks();delete i.updateCallbacks[e],i.isAnnounced&&o&&!i.hasCallbacks()&&i.sentExplicitSubscription&&this.sendUnsubscribe(i),i.isAnnounced||i.hasCallbacks()||delete this._contextNameToData[r]}},e.prototype.destroy=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return e in this._creationPromises?[4,this._creationPromises[e]]:[3,2];case 1:n.sent(),n.label=2;case 2:return(t=this._contextNameToData[e])?[2,this._gw3Session.send({type:GW_MESSAGE_DESTROY_CONTEXT,domain:"global",context_id:t.contextId}).then((function(e){}))]:[2,Promise.reject("context with ".concat(e," does not exist"))]}}))}))},e.prototype.handleUpdated=function(e,t,n){var r=e.context;e.context=applyContextDelta(e.context,t,this._logger),e.hasReceivedSnapshot=!0,this._contextNameToData[e.name]!==e||deepEqual(r,e.context)||this.invokeUpdateCallbacks(e,t,n)},e.prototype.subscribeToContextCreatedMessages=function(){for(var e=0,t=[GW_MESSAGE_CONTEXT_ADDED,GW_MESSAGE_CONTEXT_CREATED,GW_MESSAGE_ACTIVITY_CREATED];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextCreatedMessage=function(e){var t=this,n=e.type;n===GW_MESSAGE_ACTIVITY_CREATED?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):n===GW_MESSAGE_CONTEXT_ADDED&&(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name);var r=this._contextIdToName[e.context_id];if(!r)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[r])throw new Error("Received created event for context with unknown id: "+e.context_id);var i=this._contextNameToData[r];if(i){if(i.isAnnounced)return;if(!i.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");i.isAnnounced=!0,i.contextId=e.context_id,i.activityId=e.activity_id,i.sentExplicitSubscription||this.sendSubscribe(i)}else this._contextNameToData[r]=i=new GW3ContextData(e.context_id,r,!0,e.activity_id),this._trackAllContexts&&this.subscribe(r,(function(){})).then((function(e){return t._systemContextsSubKey=e}))},e.prototype.subscribeToContextUpdatedMessages=function(){for(var e=0,t=[GW_MESSAGE_CONTEXT_UPDATED,GW_MESSAGE_SUBSCRIBED_CONTEXT,GW_MESSAGE_JOINED_ACTIVITY];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextUpdatedMessage=function(e){var t=e.type,n=e.context_id,r=this._contextNameToData[this._contextIdToName[n]],i=!r||!r.isAnnounced;if(t===GW_MESSAGE_JOINED_ACTIVITY)r||(r=this._contextNameToData[e.activity_id]||new GW3ContextData(n,e.activity_id,!0,e.activity_id)),this._contextNameToData[e.activity_id]=r,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n,r.contextId=n,r.isAnnounced=!0,r.activityId=e.activity_id,r.joinedActivity=!0;else if(!r||!r.isAnnounced)return void(t===GW_MESSAGE_SUBSCRIBED_CONTEXT?((r=r||new GW3ContextData(n,e.name,!0,void 0)).sentExplicitSubscription=!0,this._contextNameToData[e.name]=r,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error("Received 'update' for unknown context: ".concat(n)));var o=r.context;if(r.hasReceivedSnapshot=!0,t===GW_MESSAGE_SUBSCRIBED_CONTEXT)r.context=e.data||{};else if(t===GW_MESSAGE_JOINED_ACTIVITY)r.context=e.context_snapshot||{};else{if(t!==GW_MESSAGE_CONTEXT_UPDATED)throw new Error("Unrecognized context update message "+t);r.context=applyContextDelta(r.context,e.delta,this._logger)}!i&&deepEqual(r.context,o)&&t!==GW_MESSAGE_SUBSCRIBED_CONTEXT||this.invokeUpdateCallbacks(r,e.delta,{updaterId:e.updater_id})},e.prototype.invokeUpdateCallbacks=function(e,t,n){if((t=t||{added:{},updated:{},reset:{},removed:[]}).commands){t.added=t.updated=t.reset={},t.removed=[];for(var r=0,i=t.commands;r<i.length;r++){var o=i[r];"remove"===o.type?(-1===o.path.indexOf(".")&&t.removed.push(o.path),setValueToPath(t.updated,null,o.path)):"set"===o.type&&setValueToPath(t.updated,o.value,o.path)}}for(var l in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(l))try{(0,e.updateCallbacks[l])(deepClone(e.context),deepClone(Object.assign({},t.added||{},t.updated||{},t.reset||{})),t.removed,parseInt(l,10),n)}catch(e){this._logger.debug("callback error: "+JSON.stringify(e))}},e.prototype.subscribeToContextDestroyedMessages=function(){for(var e=0,t=[GW_MESSAGE_CONTEXT_DESTROYED,GW_MESSAGE_ACTIVITY_DESTROYED];e<t.length;e++){var n=t[e],r=this._connection.on(n,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},e.prototype.handleContextDestroyedMessage=function(e){var t,n;if(e.type===GW_MESSAGE_ACTIVITY_DESTROYED){if(n=e.activity_id,!(t=this._contextNameToId[n]))return void this._logger.error("Received 'destroyed' for unknown activity: ".concat(e.activity_id))}else if(t=e.context_id,!(n=this._contextIdToName[t]))return void this._logger.error("Received 'destroyed' for unknown context: ".concat(e.context_id));delete this._contextIdToName[t],delete this._contextNameToId[n];var r=this._contextNameToData[n];delete this._contextNameToData[n],r&&r.isAnnounced||this._logger.error("Received 'destroyed' for unknown context: ".concat(t))},e.prototype.sendSubscribe=function(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:GW_MESSAGE_SUBSCRIBE_CONTEXT,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.sendUnsubscribe=function(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:GW_MESSAGE_UNSUBSCRIBE_CONTEXT,domain:"global",context_id:e.contextId}).then((function(e){}))},e.prototype.calculateContextDeltaV1=function(e,t){var n={added:{},updated:{},removed:[],reset:void 0};if(e)for(var r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];-1===Object.keys(t).indexOf(o)||null===t[o]||deepEqual(e[o],t[o])||(n.updated[o]=t[o])}for(var l=0,s=Object.keys(t);l<s.length;l++){o=s[l];e&&-1!==Object.keys(e).indexOf(o)?null===t[o]&&n.removed.push(o):null!==t[o]&&(n.added[o]=t[o])}return n},e.prototype.calculateContextDeltaV2=function(e,t){for(var n,r,i={added:{},updated:{},removed:[],reset:void 0,commands:[]},o=0,l=Object.keys(t);o<l.length;o++){var s=l[o];if(null!==t[s])deepEqual(e?e[s]:null,t[s])||null===(n=i.commands)||void 0===n||n.push({type:"set",path:s,value:t[s]});else null===(r=i.commands)||void 0===r||r.push({type:"remove",path:s})}return i},e.prototype.resetState=function(){for(var e=this,t=0,n=this._gw3Subscriptions;t<n.length;t++){var r=n[t];this._connection.off(r)}this._systemContextsSubKey&&(this.unsubscribe(this._systemContextsSubKey),delete this._systemContextsSubKey),this._gw3Subscriptions=[],this._contextNameToId={},this._contextIdToName={},delete this._protocolVersion,this._contextsTempCache=Object.keys(this._contextNameToData).reduce((function(t,n){return t[n]=e._contextNameToData[n].context,t}),{}),this._contextNameToData={}},e.prototype.reInitiateState=function(){var e;return __awaiter(this,void 0,void 0,(function(){var t,n,r,i,o,l,s=this;return __generator(this,(function(a){switch(a.label){case 0:return this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),null===(e=this._connection.replayer)||void 0===e||e.drain(ContextMessageReplaySpec.name,(function(e){var t=e.type;t&&(t===GW_MESSAGE_CONTEXT_CREATED||t===GW_MESSAGE_CONTEXT_ADDED||t===GW_MESSAGE_ACTIVITY_CREATED?s.handleContextCreatedMessage(e):t===GW_MESSAGE_SUBSCRIBED_CONTEXT||t===GW_MESSAGE_CONTEXT_UPDATED||t===GW_MESSAGE_JOINED_ACTIVITY?s.handleContextUpdatedMessage(e):t!==GW_MESSAGE_CONTEXT_DESTROYED&&t!==GW_MESSAGE_ACTIVITY_DESTROYED||s.handleContextDestroyedMessage(e))})),[4,Promise.all(this._contextsSubscriptionsCache.map((function(e){return s.subscribe(e.contextName,e.callback,e.subKey)})))];case 1:return a.sent(),[4,this.flushQueue()];case 2:for(r in a.sent(),t=this._contextsTempCache,n=[],t)n.push(r);i=0,a.label=3;case 3:return i<n.length?(r=n[i])in t?(o=r,"object"!=typeof this._contextsTempCache[o]||0===Object.keys(this._contextsTempCache[o]).length?[3,6]:(l=this._contextsTempCache[o],this._logger.info("Re-announcing known context: ".concat(o)),[4,this.flushQueue()])):[3,6]:[3,7];case 4:return a.sent(),[4,this.update(o,l)];case 5:a.sent(),a.label=6;case 6:return i++,[3,3];case 7:return this._contextsTempCache={},this._logger.info("Contexts are re-announced"),[2]}}))}))},e.prototype.flushQueue=function(){return new Promise((function(e){return setTimeout((function(){return e()}),0)}))},e}(),ContextsModule=function(){function e(e){this._bridge=new GW3Bridge(e)}return e.prototype.all=function(){return this._bridge.all()},e.prototype.update=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.update(e,t)},e.prototype.set=function(e,t){return this.checkName(e),this.checkData(t),this._bridge.set(e,t)},e.prototype.setPath=function(e,t,n){return this.checkName(e),this.checkPath(t),""===t?(this.checkData(n),this.set(e,n)):this._bridge.setPath(e,t,n)},e.prototype.setPaths=function(e,t){if(this.checkName(e),!Array.isArray(t))throw new Error("Please provide the paths as an array of PathValues!");for(var n=0,r=t;n<r.length;n++){var i=r[n],o=i.path,l=i.value;this.checkPath(o),""===o&&this.checkData(l)}return this._bridge.setPaths(e,t)},e.prototype.subscribe=function(e,t){var n=this;if(this.checkName(e),"function"!=typeof t)throw new Error("Please provide the callback as a function!");return this._bridge.subscribe(e,(function(e,r,i,o,l){return t(e,r,i,(function(){return n._bridge.unsubscribe(o)}),l)})).then((function(e){return function(){n._bridge.unsubscribe(e)}}))},e.prototype.get=function(e){return this.checkName(e),this._bridge.get(e)},e.prototype.ready=function(){return Promise.resolve(this)},e.prototype.destroy=function(e){return this.checkName(e),this._bridge.destroy(e)},Object.defineProperty(e.prototype,"setPathSupported",{get:function(){return this._bridge.setPathSupported},enumerable:!1,configurable:!0}),e.prototype.checkName=function(e){if("string"!=typeof e||""===e)throw new Error("Please provide the name as a non-empty string!")},e.prototype.checkPath=function(e){if("string"!=typeof e)throw new Error("Please provide the path as a dot delimited string!")},e.prototype.checkData=function(e){if("object"!=typeof e)throw new Error("Please provide the data as an object!")},e}(),InvokeStatus;function promisify(e,t,n){return"function"!=typeof t&&"function"!=typeof n?e:("function"!=typeof t?t=function(){}:"function"!=typeof n&&(n=function(){}),e.then(t,n))}function rejectAfter(e,t,n){var r;void 0===e&&(e=0);var i=function(){r&&clearTimeout(r)};return t.then((function(){i()})).catch((function(){i()})),new Promise((function(t,i){r=setTimeout((function(){return i(n)}),e)}))}!function(e){e[e.Success=0]="Success",e[e.Error=1]="Error"}(InvokeStatus||(InvokeStatus={}));var Client=function(){function e(e,t,n,r){this.protocol=e,this.repo=t,this.instance=n,this.configuration=r}return e.prototype.subscribe=function(e,t,n,r,i){var o=this,l=function(e,n,r,l){var s;t.methodResponseTimeout=null!==(s=t.methodResponseTimeout)&&void 0!==s?s:t.waitTimeoutMs,o.protocol.client.subscribe(n,t,e,r,l,i)},s=new Promise((function(n,r){var i,s=function(e){n(e)},a=function(e){r(e)};if(e)if((i="string"==typeof e?{name:e}:e).name){void 0===t&&(t={});var u=t.target;if(void 0===u&&(u="best"),"string"!=typeof u||"all"===u||"best"===u){void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=t.method_response_timeout,void 0===t.methodResponseTimeout&&(t.methodResponseTimeout=o.configuration.methodResponseTimeout)),void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=t.wait_for_method_timeout,void 0===t.waitTimeoutMs&&(t.waitTimeoutMs=o.configuration.waitTimeoutMs));var c=0,h=o.getServerMethodsByFilterAndTarget(i,u);if(h.length>0)l(h,h[0].methods[0],s,a);else{var d=function(){if(u&&t.waitTimeoutMs)if(c+=500,(h=o.getServerMethodsByFilterAndTarget(i,u)).length>0){var n=h[0].methods[0];l(h,n,s,a)}else if(c>=t.waitTimeoutMs){l(h,"string"==typeof e?{name:e}:e,s,a)}else setTimeout(d,500)};setTimeout(d,500)}}else r(new Error('"'.concat(u,'" is not a valid target. Valid targets are "all", "best", or an instance.')))}else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");else r("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")}));return promisify(s,n,r)},e.prototype.servers=function(e){var t=void 0===e?void 0:__assign({},e);return this.getServers(t).map((function(e){return e.server.instance}))},e.prototype.methods=function(e){return e="string"==typeof e?{name:e}:__assign({},e),this.getMethods(e)},e.prototype.methodsForInstance=function(e){return this.getMethodsForInstance(e)},e.prototype.methodAdded=function(e){return this.repo.onMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.repo.onMethodRemoved(e)},e.prototype.serverAdded=function(e){return this.repo.onServerAdded(e)},e.prototype.serverRemoved=function(e){return this.repo.onServerRemoved((function(t,n){e(t,n)}))},e.prototype.serverMethodAdded=function(e){return this.repo.onServerMethodAdded((function(t,n){e({server:t,method:n})}))},e.prototype.serverMethodRemoved=function(e){return this.repo.onServerMethodRemoved((function(t,n){e({server:t,method:n})}))},e.prototype.invoke=function(e,t,n,r,i,o){return __awaiter(this,void 0,void 0,(function(){var l,s=this;return __generator(this,(function(a){return l=function(){return __awaiter(s,void 0,void 0,(function(){var i,o,l,s,a,u,c,h,d,f,p,g,w=this;return __generator(this,(function(m){switch(m.label){case 0:if(!(i="string"==typeof e?{name:e}:__assign({},e)).name)return[2,Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.")];if(t||(t={}),n||(n="best"),"string"==typeof n&&"all"!==n&&"best"!==n&&"skipMine"!==n)return[2,Promise.reject(new Error('"'.concat(n,'" is not a valid target. Valid targets are "all" and "best".')))];if(r||(r={}),void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=r.method_response_timeout,void 0===r.methodResponseTimeoutMs&&(r.methodResponseTimeoutMs=this.configuration.methodResponseTimeout)),void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=r.wait_for_method_timeout,void 0===r.waitTimeoutMs&&(r.waitTimeoutMs=this.configuration.waitTimeoutMs)),void 0!==r.waitTimeoutMs&&"number"!=typeof r.waitTimeoutMs)return[2,Promise.reject(new Error('"'.concat(r.waitTimeoutMs,'" is not a valid number for "waitTimeoutMs" ')))];if("object"!=typeof t)return[2,Promise.reject(new Error("The method arguments must be an object. method: ".concat(i.name)))];if(0!==(o=this.getServerMethodsByFilterAndTarget(i,n)).length)return[3,4];m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this.tryToAwaitForMethods(i,n,r)];case 2:return o=m.sent(),[3,4];case 3:return m.sent(),l=__assign(__assign({},i),{getServers:function(){return[]},supportsStreaming:!1,objectTypes:null!==(f=i.objectTypes)&&void 0!==f?f:[],flags:null!==(g=null===(p=i.flags)||void 0===p?void 0:p.metadata)&&void 0!==g?g:{}}),s={method:l,called_with:t,message:"Can not find a method matching ".concat(JSON.stringify(e)," with server filter ").concat(JSON.stringify(n)),executed_by:void 0,returned:void 0,status:void 0},[2,Promise.reject(s)];case 4:return a=r.methodResponseTimeoutMs,u=r,c=o.map((function(e){var n=shortid(),r=e.methods[0],i=e.server,o=w.protocol.client.invoke(n,r,t,i,u);return Promise.race([o,rejectAfter(a,o,{invocationId:n,message:"Invocation timeout (".concat(a," ms) reached for method name: ").concat(null==r?void 0:r.name,", target instance: ").concat(JSON.stringify(i.instance),", options: ").concat(JSON.stringify(u)),status:InvokeStatus.Error})])})),[4,Promise.all(c)];case 5:return h=m.sent(),d=this.getInvocationResultObj(h,i,t),h.every((function(e){return e.status===InvokeStatus.Error}))?[2,Promise.reject(d)]:[2,d]}}))}))},[2,promisify(l(),i,o)]}))}))},e.prototype.getInvocationResultObj=function(e,t,n){var r=e.filter((function(e){return e.status===InvokeStatus.Success})).reduce((function(e,r){return e=__spreadArray(__spreadArray([],e,!0),[{executed_by:r.instance,returned:r.result,called_with:n,method:t,message:r.message,status:r.status}],!1)}),[]),i=e.filter((function(e){return e.status===InvokeStatus.Error})).reduce((function(e,r){return e=__spreadArray(__spreadArray([],e,!0),[{executed_by:r.instance,called_with:n,name:t.name,message:r.message}],!1)}),[]),o=e[0];return{method:t,called_with:n,returned:o.result,executed_by:o.instance,all_return_values:r,all_errors:i,message:o.message,status:o.status}},e.prototype.tryToAwaitForMethods=function(e,t,n){var r=this;return new Promise((function(i,o){if(0!==n.waitTimeoutMs)var l=0,s=setInterval((function(){l+=500;var a=r.getServerMethodsByFilterAndTarget(e,t);if(a.length>0)clearInterval(s),i(a);else if(l>=(n.waitTimeoutMs||1e4))return clearInterval(s),void o()}),500);else o()}))},e.prototype.filterByTarget=function(e,t){var n=this;if("string"!=typeof e){return(Array.isArray(e)?e:[e]).reduce((function(e,r){var i=t.filter((function(e){return n.instanceMatch(r,e.server.instance)}));return e.concat(i)}),[])}if("all"===e)return __spreadArray([],t,!0);if("best"===e){var r=t.find((function(e){return e.server.instance.isLocal}));if(r)return[r];if(void 0!==t[0])return[t[0]]}else if("skipMine"===e)return t.filter((function(e){return e.server.instance.peerId!==n.instance.peerId}));return[]},e.prototype.instanceMatch=function(e,t){return this.containsProps(e,t)},e.prototype.methodMatch=function(e,t){return this.containsProps(e,t)},e.prototype.containsProps=function(e,t){return Object.keys(e).filter((function(t){return void 0!==e[t]&&null!==e[t]&&"function"!=typeof e[t]&&"object_types"!==t&&"display_name"!==t&&"id"!==t&&"gatewayId"!==t&&"identifier"!==t&&"_"!==t[0]})).every((function(n){var r,i=e[n],o=t[n];switch(n){case"objectTypes":r=(i||[]).every((function(e){return(o||[]).includes(e)}));break;case"flags":r=isSubset(o||{},i||{});break;default:r=String(i).toLowerCase()===String(o).toLowerCase()}return r}))},e.prototype.getMethods=function(e){var t=this;return void 0===e?this.repo.getMethods():this.repo.getMethods().filter((function(n){return t.methodMatch(e,n)}))},e.prototype.getMethodsForInstance=function(e){var t=this,n=this.repo.getServers().filter((function(n){return t.instanceMatch(e,n.instance)}));if(0===n.length)return[];var r={};return 1===n.length?r=n[0].methods:n.forEach((function(e){Object.keys(e.methods).forEach((function(t){var n=e.methods[t];r[n.identifier]=n}))})),Object.keys(r).map((function(e){return r[e]}))},e.prototype.getServers=function(e){var t=this,n=this.repo.getServers();return void 0===e?n.map((function(e){return{server:e,methods:[]}})):n.reduce((function(n,r){var i=Object.values(r.methods).filter((function(n){return t.methodMatch(e,n)}));return i.length>0&&n.push({server:r,methods:i}),n}),[])},e.prototype.getServerMethodsByFilterAndTarget=function(e,t){var n=this.getServers(e);return this.filterByTarget(t,n)},e}(),ServerSubscription=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.subscription=n}return Object.defineProperty(e.prototype,"stream",{get:function(){if(!this.repoMethod.stream)throw new Error("no stream");return this.repoMethod.stream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instance",{get:function(){if(!this.subscription.instance)throw new Error("no instance");return this.subscription.instance},enumerable:!1,configurable:!0}),e.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},e.prototype.push=function(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)},e}(),Request$1=function(){function e(e,t,n){this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}return e.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},e.prototype.acceptOnBranch=function(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)},e.prototype.reject=function(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)},e}(),ServerStreaming$1=function(){function e(e,t){var n=this;this.protocol=e,this.server=t,e.server.onSubRequest((function(e,t){return n.handleSubRequest(e,t)})),e.server.onSubAdded((function(e,t){return n.handleSubAdded(e,t)})),e.server.onSubRemoved((function(e,t){return n.handleSubRemoved(e,t)}))}return e.prototype.handleSubRequest=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRequestHandler){var n=new Request$1(this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}},e.prototype.handleSubAdded=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionAddedHandler){var n=new ServerSubscription(this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}},e.prototype.handleSubRemoved=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRemovedHandler){var n=new ServerSubscription(this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},e}(),ServerBranch=function(){function e(e,t,n){this.key=e,this.protocol=t,this.repoMethod=n}return e.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map((function(t){return new ServerSubscription(e.protocol,e.repoMethod,t)}))},e.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},e.prototype.push=function(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])},e}(),ServerStream=function(){function e(e,t,n){this._protocol=e,this._repoMethod=t,this._server=n,this.name=this._repoMethod.definition.name}return e.prototype.branches=function(e){var t=this,n=this._protocol.server.getBranchList(this._repoMethod);return e?n.indexOf(e)>-1?new ServerBranch(e,this._protocol,this._repoMethod):void 0:n.map((function(e){return new ServerBranch(e,t._protocol,t._repoMethod)}))},e.prototype.branch=function(e){return this.branches(e)},e.prototype.subscriptions=function(){var e=this;return this._protocol.server.getSubscriptionList(this._repoMethod).map((function(t){return new ServerSubscription(e._protocol,e._repoMethod,t)}))},Object.defineProperty(e.prototype,"definition",{get:function(){var e,t=this._repoMethod.definition;return{accepts:t.accepts,description:t.description,displayName:t.displayName,name:t.name,objectTypes:t.objectTypes,returns:t.returns,supportsStreaming:t.supportsStreaming,flags:null===(e=t.flags)||void 0===e?void 0:e.metadata}},enumerable:!1,configurable:!0}),e.prototype.close=function(){this._protocol.server.closeAllSubscriptions(this._repoMethod),this._server.unregister(this._repoMethod.definition,!0)},e.prototype.push=function(e,t){if("string"!=typeof t&&!Array.isArray(t)&&void 0!==t)throw new Error("invalid branches should be string or string array");if("object"!=typeof e)throw new Error("Invalid arguments. Data must be an object.");this._protocol.server.pushData(this._repoMethod,e,t)},e.prototype.updateRepoMethod=function(e){this._repoMethod=e},e}(),Server=function(){function e(e,t){this.protocol=e,this.serverRepository=t,this.invocations=0,this.currentlyUnregistering={},this.streaming=new ServerStreaming$1(e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return e.prototype.createStream=function(e,t,n,r,i){var o=this,l=new Promise((function(n,r){if(e){var l;if(!(l="string"==typeof e?{name:""+e}:__assign({},e)).name)return r("The name property is required for the streamDefinition object and must be unique. Stream definition: ".concat(JSON.stringify(l)));if(o.serverRepository.getList().some((function(e){return e.definition.name===l.name})))return r('A stream with the name "'.concat(l.name,'" already exists! Please, provide a unique name for the stream.'));l.supportsStreaming=!0,t||(t={}),"function"!=typeof t.subscriptionRequestHandler&&(t.subscriptionRequestHandler=function(e){e.accept()});var s=o.serverRepository.add({definition:l,streamCallbacks:t,protocolState:{}});o.protocol.server.createStream(s).then((function(){var e;i?(e=i,i.updateRepoMethod(s)):e=new ServerStream(o.protocol,s,o),s.stream=e,n(e)})).catch((function(e){s.repoId&&o.serverRepository.remove(s.repoId),r(e)}))}else r("The stream name must be unique! Please, provide either a unique string for a stream name to glue.interop.createStream() or a methodDefinition object with a unique name property for the stream.")}));return promisify(l,n,r)},e.prototype.register=function(e,t){var n=this;if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof t)return Promise.reject("The second parameter must be a callback function. Method: ".concat("string"==typeof e?e:e.name));var r=function(e,r){return __awaiter(n,void 0,void 0,(function(){var n,i,o;return __generator(this,(function(l){switch(l.label){case 0:return l.trys.push([0,4,,5]),(n=t(e.args,e.instance))&&"function"==typeof n.then?[4,n]:[3,2];case 1:return i=l.sent(),r(void 0,i),[3,3];case 2:r(void 0,n),l.label=3;case 3:return[3,5];case 4:return o=l.sent(),r(null!=o?o:"",null!=o?o:""),[3,5];case 5:return[2]}}))}))};return r.userCallback=t,this.registerCore(e,r)},e.prototype.registerAsync=function(e,t){var n=this;if(!e)return Promise.reject("Method definition is required. Please, provide either a unique string for a method name or a methodDefinition object with a required name property.");if("function"!=typeof t)return Promise.reject("The second parameter must be a callback function. Method: ".concat("string"==typeof e?e:e.name));var r=function(e,r){return __awaiter(n,void 0,void 0,(function(){var n,i,o,l;return __generator(this,(function(s){try{n=!1,i=function(e){n||r(void 0,e),n=!0},o=function(e){n||(e||(e=""),r(e,e)),n=!0},(l=t(e.args,e.instance,i,o))&&"function"==typeof l.then&&l.then(i).catch(o)}catch(e){r(e,void 0)}return[2]}))}))};return r.userCallbackAsync=t,this.registerCore(e,r)},e.prototype.unregister=function(e,t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:return void 0===e?[2,Promise.reject("Please, provide either a unique string for a name or an object containing a name property.")]:"function"!=typeof e?[3,2]:[4,this.unregisterWithPredicate(e,t)];case 1:case 3:return i.sent(),[2];case 2:return void 0===(n="string"==typeof e?{name:e}:e).name?[2,Promise.reject("Method name is required. Cannot find a method if the method name is undefined!")]:(r=this.serverRepository.getList().find((function(e){return e.definition.name===n.name&&(e.definition.supportsStreaming||!1)===t})))?[4,this.removeMethodsOrStreams([r])]:[2,Promise.reject('Method with a name "'.concat(n.name,'" does not exist or is not registered by your application!'))]}}))}))},e.prototype.unregisterWithPredicate=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return(n=this.serverRepository.getList().filter((function(t){return e(t.definition)})).filter((function(e){return(e.definition.supportsStreaming||!1)===t})))&&0!==n.length?[4,this.removeMethodsOrStreams(n)]:[2,Promise.reject("Could not find a ".concat(t?"stream":"method"," matching the specified condition!"))];case 1:return r.sent(),[2]}}))}))},e.prototype.removeMethodsOrStreams=function(e){var t=this,n=[];return e.forEach((function(e){var r=t.protocol.server.unregister(e).then((function(){e.repoId&&t.serverRepository.remove(e.repoId)}));n.push(r),t.addAsCurrentlyUnregistering(e.definition.name,r)})),Promise.all(n)},e.prototype.addAsCurrentlyUnregistering=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r=this;return __generator(this,(function(i){return n=new Promise((function(e){return setTimeout(e,5e3)})),this.currentlyUnregistering[e]=Promise.race([t,n]).then((function(){delete r.currentlyUnregistering[e]})),[2]}))}))},e.prototype.registerCore=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r,i,o=this;return __generator(this,(function(l){switch(l.label){case 0:return(n="string"==typeof e?{name:""+e}:__assign({},e)).name?void 0===(r=this.currentlyUnregistering[n.name])?[3,2]:[4,r]:[2,Promise.reject("Please, provide a (unique) string value for the name property in the methodDefinition object: ".concat(JSON.stringify(e)))];case 1:l.sent(),l.label=2;case 2:return this.serverRepository.getList().some((function(e){return e.definition.name===n.name}))?[2,Promise.reject('A method with the name "'.concat(n.name,'" already exists! Please, provide a unique name for the method.'))]:n.supportsStreaming?[2,Promise.reject("When you create methods with glue.interop.register() or glue.interop.registerAsync() the property supportsStreaming cannot be true. If you want ".concat(n.name," to be a stream, please use the glue.interop.createStream() method."))]:(i=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}}),[2,this.protocol.server.register(i).catch((function(e){throw(null==i?void 0:i.repoId)&&o.serverRepository.remove(i.repoId),e}))])}}))}))},e.prototype.onMethodInvoked=function(e,t,n){var r=this;e&&e.theFunction&&e.theFunction(n,(function(n,i){if(null!=n)if(n.message&&"string"==typeof n.message)n=n.message;else if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n="un-stringifyable error in onMethodInvoked! Top level prop names: ".concat(Object.keys(n))}i?("object"!=typeof i||Array.isArray(i))&&(i={_value:i}):i={},r.protocol.server.methodInvocationResult(e,t,n,i)}))},e}(),InstanceWrapper=function(){function e(e,t,n){var r=this;this.wrapped={},this.wrapped.getMethods=function(){return e.methodsForInstance(this)},this.wrapped.getStreams=function(){return e.methodsForInstance(this).filter((function(e){return e.supportsStreaming}))},t&&this.refreshWrappedObject(t),n&&(n.loggedIn((function(){r.refresh(n)})),this.refresh(n))}return e.prototype.unwrap=function(){return this.wrapped},e.prototype.refresh=function(e){if(e){var t=null==e?void 0:e.resolvedIdentity,n=Object.assign({},null!=t?t:{},{peerId:null==e?void 0:e.peerId});this.refreshWrappedObject(n)}},e.prototype.refreshWrappedObject=function(e){var t,n,r,i,o=this;Object.keys(e).forEach((function(t){o.wrapped[t]=e[t]})),this.wrapped.user=e.user,this.wrapped.instance=e.instance,this.wrapped.application=null!==(t=e.application)&&void 0!==t?t:shortid(),this.wrapped.applicationName=e.applicationName,this.wrapped.pid=null!==(r=null!==(n=e.pid)&&void 0!==n?n:e.process)&&void 0!==r?r:Math.floor(1e10*Math.random()),this.wrapped.machine=e.machine,this.wrapped.environment=e.environment,this.wrapped.region=e.region,this.wrapped.windowId=e.windowId,this.wrapped.isLocal=null===(i=e.isLocal)||void 0===i||i,this.wrapped.api=e.api,this.wrapped.service=e.service,this.wrapped.peerId=e.peerId},e}(),hideMethodSystemFlags=function(e){return __assign(__assign({},e),{flags:e.flags.metadata||{}})},ClientRepository=function(){function e(e,t){this.logger=e,this.API=t,this.servers={},this.methodsCount={},this.callbacks=lib$1();var n=this.API.instance.peerId;this.myServer={id:n,methods:{},instance:this.API.instance,wrapper:this.API.unwrappedInstance},this.servers[n]=this.myServer}return e.prototype.addServer=function(e,t){this.logger.debug("adding server ".concat(t));var n=this.servers[t];if(n)return n.id;var r=new InstanceWrapper(this.API,e),i={id:t,methods:{},instance:r.unwrap(),wrapper:r};return this.servers[t]=i,this.callbacks.execute("onServerAdded",i.instance),t},e.prototype.removeServerById=function(e,t){var n=this,r=this.servers[e];r?(this.logger.debug("removing server ".concat(e)),Object.keys(r.methods).forEach((function(t){n.removeServerMethod(e,t)})),delete this.servers[e],this.callbacks.execute("onServerRemoved",r.instance,t)):this.logger.warn("not aware of server ".concat(e,", my state ").concat(JSON.stringify(Object.keys(this.servers))))},e.prototype.addServerMethod=function(e,t){var n,r=this.servers[e];if(!r)throw new Error("server does not exists");if(!r.methods[t.id]){var i=this.createMethodIdentifier(t),o=this,l={identifier:i,gatewayId:t.id,name:t.name,displayName:t.display_name,description:t.description,version:t.version,objectTypes:t.object_types||[],accepts:t.input_signature,returns:t.result_signature,supportsStreaming:void 0!==t.flags&&t.flags.streaming,flags:null!==(n=t.flags)&&void 0!==n?n:{},getServers:function(){return o.getServersByMethod(i)}};l.object_types=l.objectTypes,l.display_name=l.displayName,l.version=l.version,r.methods[t.id]=l;var s=hideMethodSystemFlags(l);return this.methodsCount[i]||(this.methodsCount[i]=0,this.callbacks.execute("onMethodAdded",s)),this.methodsCount[i]=this.methodsCount[i]+1,this.callbacks.execute("onServerMethodAdded",r.instance,s),l}},e.prototype.removeServerMethod=function(e,t){var n=this.servers[e];if(!n)throw new Error("server does not exists");var r=n.methods[t];delete n.methods[t];var i=hideMethodSystemFlags(r);this.methodsCount[r.identifier]=this.methodsCount[r.identifier]-1,0===this.methodsCount[r.identifier]&&this.callbacks.execute("onMethodRemoved",i),this.callbacks.execute("onServerMethodRemoved",n.instance,i)},e.prototype.getMethods=function(){return this.extractMethodsFromServers(Object.values(this.servers)).map(hideMethodSystemFlags)},e.prototype.getServers=function(){return Object.values(this.servers).map(this.hideServerMethodSystemFlags)},e.prototype.onServerAdded=function(e){var t=this.callbacks.add("onServerAdded",e),n=this.getServers().map((function(e){return e.instance}));return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onMethodAdded=function(e){var t=this.callbacks.add("onMethodAdded",e),n=this.getMethods();return this.returnUnsubWithDelayedReplay(t,n,e)},e.prototype.onServerMethodAdded=function(e){var t=this.callbacks.add("onServerMethodAdded",e),n=!1,r=this.getServers();return setTimeout((function(){r.forEach((function(t){var r=t.methods;Object.keys(r).forEach((function(i){n||e(t.instance,r[i])}))}))}),0),function(){n=!0,t()}},e.prototype.onMethodRemoved=function(e){return this.callbacks.add("onMethodRemoved",e)},e.prototype.onServerRemoved=function(e){return this.callbacks.add("onServerRemoved",e)},e.prototype.onServerMethodRemoved=function(e){return this.callbacks.add("onServerMethodRemoved",e)},e.prototype.getServerById=function(e){return this.hideServerMethodSystemFlags(this.servers[e])},e.prototype.reset=function(){var e,t=this;Object.keys(this.servers).forEach((function(e){t.removeServerById(e,"reset")})),this.servers=((e={})[this.myServer.id]=this.myServer,e),this.methodsCount={}},e.prototype.createMethodIdentifier=function(e){var t,n,r=null!==(t=e.input_signature)&&void 0!==t?t:"",i=null!==(n=e.result_signature)&&void 0!==n?n:"";return(e.name+r+i).toLowerCase()},e.prototype.getServersByMethod=function(e){var t=[];return Object.values(this.servers).forEach((function(n){Object.values(n.methods).forEach((function(r){r.identifier===e&&t.push(n.instance)}))})),t},e.prototype.returnUnsubWithDelayedReplay=function(e,t,n){var r=!1;return setTimeout((function(){t.forEach((function(e){r||n(e)}))}),0),function(){r=!0,e()}},e.prototype.hideServerMethodSystemFlags=function(e){var t={};return Object.entries(e.methods).forEach((function(e){var n=e[0],r=e[1];t[n]=hideMethodSystemFlags(r)})),__assign(__assign({},e),{methods:t})},e.prototype.extractMethodsFromServers=function(e){return Object.values(e).reduce((function(e,t){return __spreadArray(__spreadArray([],e,!0),Object.values(t.methods),!0)}),[])},e}(),ServerRepository=function(){function e(){this.nextId=0,this.methods=[]}return e.prototype.add=function(e){return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e},e.prototype.remove=function(e){if("string"!=typeof e)return new TypeError("Expecting a string");this.methods=this.methods.filter((function(t){return t.repoId!==e}))},e.prototype.getById=function(e){if("string"==typeof e)return this.methods.find((function(t){return t.repoId===e}))},e.prototype.getList=function(){return this.methods.map((function(e){return e}))},e.prototype.length=function(){return this.methods.length},e.prototype.reset=function(){this.methods=[]},e}(),SUBSCRIPTION_REQUEST="onSubscriptionRequest",SUBSCRIPTION_ADDED="onSubscriptionAdded",SUBSCRIPTION_REMOVED="onSubscriptionRemoved",ServerStreaming=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.serverRepository=n,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=lib$1(),this.nextStreamId=0,e.on("add-interest",(function(e){r.handleAddInterest(e)})),e.on("remove-interest",(function(e){r.handleRemoveInterest(e)}))}return e.prototype.acceptRequestOnBranch=function(e,t,n){if("string"!=typeof n&&(n=""),"object"!=typeof t.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var r=this.getStreamId(t,n),i=e.msg.subscription_id,o={id:i,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:r,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[i]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:i,stream_id:r}),this.callbacks.execute(SUBSCRIPTION_ADDED,o,t)},e.prototype.rejectRequest=function(e,t,n){"string"!=typeof n&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)},e.prototype.pushData=function(e,t,n){var r=this;if("object"==typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=[]),e.protocolState.branchKeyToStreamIdMap.filter((function(e){return!n||0===n.length||n.indexOf(e.key)>=0})).map((function(e){return e.streamId})).forEach((function(e){var n={type:"publish",stream_id:e,data:t};r.session.sendFireAndForget(n)}))}},e.prototype.pushDataToSingle=function(e,t,n){if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");var r={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(r)},e.prototype.closeSingleSubscription=function(e,t){e.protocolState.subscriptionsMap&&delete e.protocolState.subscriptionsMap[t.id];var n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n),t.instance,this.callbacks.execute(SUBSCRIPTION_REMOVED,t,e)},e.prototype.closeMultipleSubscriptions=function(e,t){var n=this;if("object"==typeof e&&"object"==typeof e.protocolState.subscriptionsMap&&e.protocolState.subscriptionsMap){var r=e.protocolState.subscriptionsMap,i=Object.keys(r).map((function(e){return r[e]}));"string"==typeof t&&(i=i.filter((function(e){return e.branchKey===t}))),i.forEach((function(e){delete r[e.id];var t={type:"drop-subscription",subscription_id:e.id,reason:"Server dropping all subscriptions on stream_id: "+e.streamId};n.session.sendFireAndForget(t)}))}},e.prototype.getSubscriptionList=function(e,t){if("object"!=typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var n=e.protocolState.subscriptionsMap,r=Object.keys(n).map((function(e){return n[e]}));return"string"!=typeof t?r:r.filter((function(e){return e.branchKey===t}))},e.prototype.getBranchList=function(e){if("object"!=typeof e)return[];if(!e.protocolState.subscriptionsMap)return[];var t=e.protocolState.subscriptionsMap,n=Object.keys(t).map((function(e){return t[e]})),r=[];return n.forEach((function(e){var t="";"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),-1===r.indexOf(t)&&r.push(t)})),r},e.prototype.onSubAdded=function(e){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED,e)},e.prototype.onSubRequest=function(e){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST,e)},e.prototype.onSubRemoved=function(e){this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED,e)},e.prototype.handleRemoveInterest=function(e){var t=this.serverRepository.getById(e.method_id);if("string"==typeof e.subscription_id&&"object"==typeof t&&t.protocolState.subscriptionsMap&&"object"==typeof t.protocolState.subscriptionsMap[e.subscription_id]){var n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute(SUBSCRIPTION_REMOVED,n,t)}},e.prototype.onSubscriptionLifetimeEvent=function(e,t){this.callbacks.add(e,t)},e.prototype.getNextStreamId=function(){return this.nextStreamId+++""},e.prototype.handleAddInterest=function(e){var t=this.repository.getServerById(e.caller_id).instance,n={msg:e,arguments:e.arguments_kv||{},instance:t},r=this.serverRepository.getById(e.method_id);if(void 0!==r)r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[e.subscription_id]?this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id):this.callbacks.execute(SUBSCRIPTION_REQUEST,n,r);else{var i="No method with id "+e.method_id+" on this server.";this.sendSubscriptionFailed(i,e.subscription_id)}},e.prototype.sendSubscriptionFailed=function(e,t){var n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)},e.prototype.getStreamId=function(e,t){if("string"!=typeof t&&(t=""),!e.protocolState.branchKeyToStreamIdMap)throw new Error("streaming ".concat(e.definition.name," method without protocol state"));var n=e.protocolState.branchKeyToStreamIdMap.filter((function(e){return e.key===t}))[0],r=n?n.streamId:void 0;return"string"==typeof r&&""!==r||(r=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:r})),r},e}(),ServerProtocol=function(){function e(e,t,n,r){var i=this;this.session=e,this.clientRepository=t,this.serverRepository=n,this.logger=r,this.callbacks=lib$1(),this.streaming=new ServerStreaming(e,t,n),this.session.on("invoke",(function(e){return i.handleInvokeMessage(e)}))}return e.prototype.createStream=function(e){return e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,!0)},e.prototype.register=function(e,t){var n,r=this,i=e.definition,o=Object.assign({},{metadata:null!==(n=i.flags)&&void 0!==n?n:{}},{streaming:t||!1}),l={type:"register",methods:[{id:e.repoId,name:i.name,display_name:i.displayName,description:i.description,version:i.version,flags:o,object_types:i.objectTypes||i.object_types,input_signature:i.accepts,result_signature:i.returns,restrictions:void 0}]};return this.session.send(l,{methodId:e.repoId}).then((function(){r.logger.debug("registered method "+e.definition.name+" with id "+e.repoId)})).catch((function(t){throw r.logger.warn("failed to register method ".concat(e.definition.name," with id ").concat(e.repoId," - ").concat(JSON.stringify(t))),t}))},e.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},e.prototype.methodInvocationResult=function(e,t,n,r){var i;i=n||""===n?{type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:r,peer_id:void 0}:{type:"yield",invocation_id:t,peer_id:this.session.peerId,result:r,request_id:void 0},this.session.sendFireAndForget(i)},e.prototype.unregister=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t={type:"unregister",methods:[e.repoId]},[4,this.session.send(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.getBranchList=function(e){return this.streaming.getBranchList(e)},e.prototype.getSubscriptionList=function(e,t){return this.streaming.getSubscriptionList(e,t)},e.prototype.closeAllSubscriptions=function(e,t){this.streaming.closeMultipleSubscriptions(e,t)},e.prototype.pushData=function(e,t,n){this.streaming.pushData(e,t,n)},e.prototype.pushDataToSingle=function(e,t,n){this.streaming.pushDataToSingle(e,t,n)},e.prototype.closeSingleSubscription=function(e,t){this.streaming.closeSingleSubscription(e,t)},e.prototype.acceptRequestOnBranch=function(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)},e.prototype.rejectRequest=function(e,t,n){this.streaming.rejectRequest(e,t,n)},e.prototype.onSubRequest=function(e){this.streaming.onSubRequest(e)},e.prototype.onSubAdded=function(e){this.streaming.onSubAdded(e)},e.prototype.onSubRemoved=function(e){this.streaming.onSubRemoved(e)},e.prototype.handleInvokeMessage=function(e){var t=e.invocation_id,n=e.caller_id,r=e.method_id,i=e.arguments_kv,o=this.serverRepository.getList().filter((function(e){return e.repoId===r}))[0];if(void 0!==o){var l={args:i,instance:this.clientRepository.getServerById(n).instance};this.callbacks.execute("onInvoked",o,t,l)}},e}(),UserSubscription=function(){function e(e,t){this.repository=e,this.subscriptionData=t}return Object.defineProperty(e.prototype,"requestArguments",{get:function(){return this.subscriptionData.params.arguments||{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"servers",{get:function(){var e=this;return this.subscriptionData.trackedServers.filter((function(e){return e.subscriptionId})).map((function(t){return e.repository.getServerById(t.serverId).instance}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverInstance",{get:function(){return this.servers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this.subscriptionData.method},enumerable:!1,configurable:!0}),e.prototype.onData=function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");this.subscriptionData.handlers.onData.push(e),1===this.subscriptionData.handlers.onData.length&&this.subscriptionData.queued.data.length>0&&this.subscriptionData.queued.data.forEach((function(t){e(t)}))},e.prototype.onClosed=function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onClosed.push(e)},e.prototype.onFailed=function(e){},e.prototype.onConnected=function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.subscriptionData.handlers.onConnected.push(e)},e.prototype.close=function(){this.subscriptionData.close()},e.prototype.setNewSubscription=function(e){this.subscriptionData=e},e}(),TimedCache=function(){function e(e){this.config=e,this.cache=[],this.timeoutIds=[]}return e.prototype.add=function(e){var t=this,n=shortid();this.cache.push({id:n,element:e});var r=setTimeout((function(){var e=t.cache.findIndex((function(e){return e.id===n}));e<0||t.cache.splice(e,1)}),this.config.ELEMENT_TTL_MS);this.timeoutIds.push(r)},e.prototype.flush=function(){var e=this.cache.map((function(e){return e.element}));return this.timeoutIds.forEach((function(e){return clearInterval(e)})),this.cache=[],this.timeoutIds=[],e},e}(),STATUS_AWAITING_ACCEPT="awaitingAccept",STATUS_SUBSCRIBED="subscribed",ERR_MSG_SUB_FAILED="Subscription failed.",ERR_MSG_SUB_REJECTED="Subscription rejected.",ON_CLOSE_MSG_SERVER_INIT="ServerInitiated",ON_CLOSE_MSG_CLIENT_INIT="ClientInitiated",ClientStreaming=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.logger=n,this.subscriptionsList={},this.timedCache=new TimedCache({ELEMENT_TTL_MS:1e4}),this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(e){var t=e._tag,n=t.subLocalKey,i=r.subscriptionsList[n];if("object"==typeof i&&(i.trackedServers=i.trackedServers.filter((function(e){return e.serverId!==t.serverId})),i.trackedServers.length<=0)){if(clearTimeout(i.timeoutId),i.status===STATUS_AWAITING_ACCEPT){var o="string"==typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",l="object"==typeof i.params.arguments?JSON.stringify(i.params.arguments):"{}";i.error({message:ERR_MSG_SUB_REJECTED+o+" Called with:"+l,called_with:i.params.arguments,method:i.method})}else i.status===STATUS_SUBSCRIBED&&r.callOnClosedHandlers(i);delete r.subscriptionsList[n]}},this.handleSubscribed=function(e){var t=e._tag.subLocalKey,n=r.subscriptionsList[t];if("object"==typeof n){var i=e._tag.serverId,o=n.trackedServers.filter((function(e){return e.serverId===i}))[0];if("object"==typeof o){o.subscriptionId=e.subscription_id,r.subscriptionIdToLocalKeyMap[e.subscription_id]=t;var l=n.status===STATUS_AWAITING_ACCEPT;if(n.status=STATUS_SUBSCRIBED,l){var s=!1,a=n.subscription;a?(a.setNewSubscription(n),n.success(a),s=!0):(a=new UserSubscription(r.repository,n),n.subscription=a,n.success(a));for(var u=0,c=n.handlers.onConnected;u<c.length;u++){var h=c[u];try{h(a.serverInstance,s)}catch(e){}}}}}},this.handleEventData=function(e){var t=r.subscriptionIdToLocalKeyMap[e.subscription_id];if(void 0!==t){var n=r.subscriptionsList[t];if("object"==typeof n){var i=n.trackedServers.filter((function(t){return t.subscriptionId===e.subscription_id}));if(1===i.length){var o=e.oob,l=i[0].serverId,s=function(){return{data:e.data,server:r.repository.getServerById(l).instance,requestArguments:n.params.arguments,message:void 0,private:o}},a=n.handlers.onData,u=n.queued.data;a.length>0?a.forEach((function(e){"function"==typeof e&&e(s())})):u.push(s())}}}},this.handleSubscriptionCancelled=function(e){var t=r.subscriptionIdToLocalKeyMap[e.subscription_id];if(void 0!==t){var n=r.subscriptionsList[t];if("object"==typeof n){var i=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter((function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)})),n.trackedServers.length===i&&(n.trackedServers.length<=0&&(r.timedCache.add(n),clearTimeout(n.timeoutId),r.callOnClosedHandlers(n),delete r.subscriptionsList[t]),delete r.subscriptionIdToLocalKeyMap[e.subscription_id])}}},e.on("subscribed",this.handleSubscribed),e.on("event",this.handleEventData),e.on("subscription-cancelled",this.handleSubscriptionCancelled)}return e.prototype.subscribe=function(e,t,n,r,i,o){var l=this;if(0!==n.length){var s=this.getNextSubscriptionLocalKey(),a=this.registerSubscription(s,e,t,r,i,t.methodResponseTimeout||1e4,o);"object"==typeof a?n.forEach((function(n){var r=n.server.id,i=n.methods.find((function(t){return t.name===e.name}));if(i){a.trackedServers.push({serverId:r,subscriptionId:void 0});var o={type:"subscribe",server_id:r,method_id:i.gatewayId,arguments_kv:t.arguments};l.session.send(o,{serverId:r,subLocalKey:s}).then((function(e){return l.handleSubscribed(e)})).catch((function(e){return l.handleErrorSubscribing(e)}))}else l.logger.error("can not find method ".concat(e.name," for target ").concat(n.server.id))})):i({method:e,called_with:t.arguments,message:ERR_MSG_SUB_FAILED+" Unable to register the user callbacks."})}else i({method:e,called_with:t.arguments,message:ERR_MSG_SUB_FAILED+" No available servers matched the target params."})},e.prototype.drainSubscriptions=function(){var e=Object.values(this.subscriptionsList);return this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},e},e.prototype.drainSubscriptionsCache=function(){return this.timedCache.flush()},e.prototype.getNextSubscriptionLocalKey=function(){var e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e},e.prototype.registerSubscription=function(e,t,n,r,i,o,l){var s=this,a={localKey:e,status:STATUS_AWAITING_ACCEPT,method:t,params:n,success:r,error:i,trackedServers:[],handlers:{onData:(null==l?void 0:l.handlers.onData)||[],onClosed:(null==l?void 0:l.handlers.onClosed)||[],onConnected:(null==l?void 0:l.handlers.onConnected)||[]},queued:{data:[],closers:[]},timeoutId:void 0,close:function(){return s.closeSubscription(e)},subscription:null==l?void 0:l.subscription};return l||(n.onData&&a.handlers.onData.push(n.onData),n.onClosed&&a.handlers.onClosed.push(n.onClosed),n.onConnected&&a.handlers.onConnected.push(n.onConnected)),this.subscriptionsList[e]=a,a.timeoutId=setTimeout((function(){if(void 0!==s.subscriptionsList[e]){var r=s.subscriptionsList[e];r.status===STATUS_AWAITING_ACCEPT?(i({method:t,called_with:n.arguments,message:ERR_MSG_SUB_FAILED+" Subscription attempt timed out after "+o+" ms."}),delete s.subscriptionsList[e]):r.status===STATUS_SUBSCRIBED&&r.trackedServers.length>0&&(r.trackedServers=r.trackedServers.filter((function(e){return void 0!==e.subscriptionId})),delete r.timeoutId,r.trackedServers.length<=0&&(s.callOnClosedHandlers(r),delete s.subscriptionsList[e]))}}),o),a},e.prototype.callOnClosedHandlers=function(e,t){var n,r=e.queued.closers.length,i=r>0?e.queued.closers[r-1]:null;void 0!==i&&"string"==typeof i&&(n=this.repository.getServerById(i).instance),e.handlers.onClosed.forEach((function(r){"function"==typeof r&&r({message:t||ON_CLOSE_MSG_SERVER_INIT,requestArguments:e.params.arguments||{},server:n,stream:e.method})}))},e.prototype.closeSubscription=function(e){var t=this,n=this.subscriptionsList[e];"object"==typeof n&&(n.trackedServers.forEach((function(e){void 0!==e.subscriptionId&&(n.queued.closers.push(e.serverId),t.session.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:ON_CLOSE_MSG_CLIENT_INIT}),delete t.subscriptionIdToLocalKeyMap[e.subscriptionId])})),n.trackedServers=[],this.callOnClosedHandlers(n,ON_CLOSE_MSG_CLIENT_INIT),delete this.subscriptionsList[e])},e}(),ClientProtocol=function(){function e(e,t,n){var r=this;this.session=e,this.repository=t,this.logger=n,e.on("peer-added",(function(e){return r.handlePeerAdded(e)})),e.on("peer-removed",(function(e){return r.handlePeerRemoved(e)})),e.on("methods-added",(function(e){return r.handleMethodsAddedMessage(e)})),e.on("methods-removed",(function(e){return r.handleMethodsRemovedMessage(e)})),this.streaming=new ClientStreaming(e,t,n)}return e.prototype.subscribe=function(e,t,n,r,i,o){this.streaming.subscribe(e,t,n,r,i,o)},e.prototype.invoke=function(e,t,n,r){var i=this,o=r.id,l={type:"call",server_id:o,method_id:t.gatewayId,arguments_kv:n};return this.session.send(l,{invocationId:e,serverId:o}).then((function(e){return i.handleResultMessage(e)})).catch((function(e){return i.handleInvocationError(e)}))},e.prototype.drainSubscriptions=function(){return this.streaming.drainSubscriptions()},e.prototype.drainSubscriptionsCache=function(){return this.streaming.drainSubscriptionsCache()},e.prototype.handlePeerAdded=function(e){var t=e.new_peer_id,n=e.identity,r=!e.meta||e.meta.local,i=Number(n.process),o={machine:n.machine,pid:isNaN(i)?n.process:i,instance:n.instance,application:n.application,applicationName:n.applicationName,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t,api:n.api,isLocal:r};this.repository.addServer(o,t)},e.prototype.handlePeerRemoved=function(e){var t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)},e.prototype.handleMethodsAddedMessage=function(e){var t=this,n=e.server_id;e.methods.forEach((function(e){t.repository.addServerMethod(n,e)}))},e.prototype.handleMethodsRemovedMessage=function(e){var t=this,n=e.server_id,r=e.methods,i=this.repository.getServerById(n);Object.keys(i.methods).forEach((function(e){var o=i.methods[e];r.indexOf(o.gatewayId)>-1&&t.repository.removeServerMethod(n,e)}))},e.prototype.handleResultMessage=function(e){var t=e._tag.invocationId,n=e.result,r=e._tag.serverId;return{invocationId:t,result:n,instance:this.repository.getServerById(r).instance,status:InvokeStatus.Success,message:""}},e.prototype.handleInvocationError=function(e){if(this.logger.debug("handle invocation error ".concat(JSON.stringify(e))),"_tag"in e){var t=e._tag.invocationId,n=e._tag.serverId,r=this.repository.getServerById(n),i=e.reason;return{invocationId:t,result:e.context,instance:r.instance,status:InvokeStatus.Error,message:i}}return{invocationId:"",message:e.message,status:InvokeStatus.Error,error:e}},e}();function gW3ProtocolFactory(e,t,n,r,i,o){var l,s=i.logger.subLogger("gw3-protocol"),a=new Promise((function(e){l=e})),u=t.domain("agm",["subscribed"]),c=new ServerProtocol(u,n,r,s.subLogger("server")),h=new ClientProtocol(u,n,s.subLogger("client"));return u.onJoined((function(i){n.addServer(e,t.peerId),i?function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,i,l,a,u,c,d,f,p;return __generator(this,(function(g){switch(g.label){case 0:for(s.info("reconnected - will replay registered methods and subscriptions"),h.drainSubscriptionsCache().forEach((function(e){var t=e.method,n=Object.assign({},e.params);s.info("trying to soft-re-subscribe to method ".concat(t.name,", with params: ").concat(JSON.stringify(n))),o.client.subscribe(t,n,void 0,void 0,e).then((function(){return s.info("soft-subscribing to method ".concat(t.name," DONE"))})).catch((function(e){return s.warn("subscribing to method ".concat(t.name," failed: ").concat(JSON.stringify(e),"}"))}))})),e=[],t=h.drainSubscriptions(),n=function(t){var n=t.method,r=Object.assign({},t.params);s.info("trying to re-subscribe to method ".concat(n.name,", with params: ").concat(JSON.stringify(r))),e.push(o.client.subscribe(n,r,void 0,void 0,t).then((function(){return s.info("subscribing to method ".concat(n.name," DONE"))})))},i=0,l=t;i<l.length;i++)a=l[i],n(a);for(u=r.getList(),r.reset(),c=function(t){var n=t.definition;s.info("re-publishing method ".concat(n.name)),t.stream?e.push(o.server.createStream(n,t.streamCallbacks,void 0,void 0,t.stream).then((function(){return s.info("subscribing to method ".concat(n.name," DONE"))}))):t.theFunction&&t.theFunction.userCallback?e.push(o.register(n,t.theFunction.userCallback).then((function(){return s.info("subscribing to method ".concat(n.name," DONE"))}))):t.theFunction&&t.theFunction.userCallbackAsync&&e.push(o.registerAsync(n,t.theFunction.userCallbackAsync).then((function(){return s.info("subscribing to method ".concat(n.name," DONE"))}))),s.info("re-publishing method ".concat(n.name," DONE"))},d=0,f=u;d<f.length;d++)p=f[d],c(p);return[4,Promise.all(e)];case 1:return g.sent(),s.info("Interop is re-announced"),[2]}}))}))}().then((function(){return t.setLibReAnnounced({name:"interop"})})).catch((function(e){return s.warn("Error while re-announcing interop: ".concat(JSON.stringify(e)))})):l&&(l({client:h,server:c}),l=void 0)})),u.onLeft((function(){n.reset()})),u.join(),a}var Interop=function(){function e(e){var t=this;if(void 0===e)throw new Error("configuration is required");if(void 0===e.connection)throw new Error("configuration.connections is required");var n,r=e.connection;if("number"!=typeof e.methodResponseTimeout&&(e.methodResponseTimeout=3e4),"number"!=typeof e.waitTimeoutMs&&(e.waitTimeoutMs=3e4),this.unwrappedInstance=new InstanceWrapper(this,void 0,r),this.instance=this.unwrappedInstance.unwrap(),this.clientRepository=new ClientRepository(e.logger.subLogger("cRep"),this),this.serverRepository=new ServerRepository,3!==r.protocolVersion)throw new Error("protocol ".concat(r.protocolVersion," not supported"));n=gW3ProtocolFactory(this.instance,r,this.clientRepository,this.serverRepository,e,this),this.readyPromise=n.then((function(n){return t.protocol=n,t.client=new Client(t.protocol,t.clientRepository,t.instance,e),t.server=new Server(t.protocol,t.serverRepository),t}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.serverRemoved=function(e){return this.client.serverRemoved(e)},e.prototype.serverAdded=function(e){return this.client.serverAdded(e)},e.prototype.serverMethodRemoved=function(e){return this.client.serverMethodRemoved(e)},e.prototype.serverMethodAdded=function(e){return this.client.serverMethodAdded(e)},e.prototype.methodRemoved=function(e){return this.client.methodRemoved(e)},e.prototype.methodAdded=function(e){return this.client.methodAdded(e)},e.prototype.methodsForInstance=function(e){return this.client.methodsForInstance(e)},e.prototype.methods=function(e){return this.client.methods(e)},e.prototype.servers=function(e){return this.client.servers(e)},e.prototype.subscribe=function(e,t,n,r){return this.client.subscribe(e,t,n,r)},e.prototype.createStream=function(e,t,n,r){return this.server.createStream(e,t,n,r)},e.prototype.unregister=function(e){return this.server.unregister(e)},e.prototype.registerAsync=function(e,t){return this.server.registerAsync(e,t)},e.prototype.register=function(e,t){return this.server.register(e,t)},e.prototype.invoke=function(e,t,n,r,i,o){return this.client.invoke(e,t,n,r,i,o)},e.prototype.waitForMethod=function(e){var t=new PromiseWrapper,n=this.client.methodAdded((function(r){r.name===e&&(n(),t.resolve(r))}));return t.promise},e}(),successMessages=["subscribed","success"],MessageBus=function(){function e(e,t){var n=this;this.publish=function(e,t,r){var i=r||{},o=i.routingKey,l=i.target,s=n.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:n.peerId,routing_key:o,target_identity:l});n.session.send(s)},this.subscribe=function(e,t,r){return new Promise((function(i,o){var l=r||{},s=l.routingKey,a=l.target,u=n.removeEmptyValues({type:"subscribe",topic:e,peer_id:n.peerId,routing_key:s,source:a});n.session.send(u).then((function(r){var o=r.subscription_id;n.subscriptions.push({subscription_id:o,topic:e,callback:t,source:a}),i({unsubscribe:function(){return n.session.send({type:"unsubscribe",subscription_id:o,peer_id:n.peerId}),n.subscriptions=n.subscriptions.filter((function(e){return e.subscription_id!==o})),Promise.resolve()}})})).catch((function(e){return o(e)}))}))},this.watchOnEvent=function(){n.session.on("event",(function(e){var t=e.data,r=e.subscription_id,i=e["publisher-identity"],o=n.subscriptions.find((function(e){return e.subscription_id===r}));o&&(o.source?n.keysMatch(o.source,i)&&o.callback(t,o.topic,i):o.callback(t,o.topic,i))}))},this.connection=e,this.logger=t,this.peerId=e.peerId,this.subscriptions=[],this.session=e.domain("bus",successMessages),this.readyPromise=this.session.join(),this.readyPromise.then((function(){n.watchOnEvent()}))}return e.prototype.ready=function(){return this.readyPromise},e.prototype.removeEmptyValues=function(e){var t={};return Object.keys(e).forEach((function(n){void 0!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t},e.prototype.keysMatch=function(e,t){var n=Object.keys(e),r=!0;return n.forEach((function(n){e[n]!==t[n]&&(r=!1)})),r},e}(),IOConnectCoreFactory=function(e,t){var n,r,i,o,l,s,a,u,c,h="object"==typeof window?null!==(n=window.iodesktop)&&void 0!==n?n:window.glue42gd:void 0,d="object"==typeof window&&null!==(r=window.gdPreloadPromise)&&void 0!==r?r:Promise.resolve(),f=timer("glue"),p=prepareConfig(e=e||{},t=t||{},h),g={};function w(e,t,n){(c=l.canPublish("trace"))&&l.trace("registering ".concat(e," module"));var r=function(){t.initTime=n.stop(),t.initEndTime=n.endTime,t.marks=n.marks,c&&l.trace("".concat(e," is ready - ").concat(n.endTime-n.startTime))};t.initStartTime=n.startTime,t.ready?t.ready().then((function(){r()})):r(),Array.isArray(e)||(e=[e]),e.forEach((function(e){g[e]=t,IOConnectCoreFactory[e]=t}))}function m(){var e,t,n,r,o,a=timer("metrics"),u=p.metrics,c=null==h?void 0:h.getMetricsPublishingEnabled,d=p.connection.identity,f=c||function(){return!0},g=null!==(e="boolean"!=typeof u&&u.disableAutoAppSystem)&&void 0!==e&&e;return w("metrics",s=metrics({connection:u?i:void 0,logger:l.subLogger("metrics"),canUpdateMetric:f,system:"Glue42",service:null!==(n=null!==(t=null==d?void 0:d.service)&&void 0!==t?t:null==h?void 0:h.applicationName)&&void 0!==n?n:p.application,instance:null!==(o=null!==(r=null==d?void 0:d.instance)&&void 0!==r?r:null==d?void 0:d.windowId)&&void 0!==o?o:shortid(),disableAutoAppSystem:g,pagePerformanceMetrics:"boolean"!=typeof u?null==u?void 0:u.pagePerformanceMetrics:void 0}),a),Promise.resolve()}function v(){var e=p.activities&&3===i.protocolVersion;if(p.contexts||e){var t=timer("contexts");return w("contexts",a=new ContextsModule({connection:i,logger:l.subLogger("contexts"),trackAllContexts:"object"==typeof p.contexts&&p.contexts.trackAllContexts,reAnnounceKnownContexts:"object"==typeof p.contexts&&p.contexts.reAnnounceKnownContexts}),t),a}var n=i.replayer;n&&n.drain(ContextMessageReplaySpec.name)}function y(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){return p.bus?(e=timer("bus"),w("bus",u=new MessageBus(i,l.subLogger("bus")),e),[2,Promise.resolve()]):[2,Promise.resolve()]}))}))}function b(e){try{return e.forEach((function(e){!function(e,t){var n=timer(e),r=t(g);r&&w(e,r,n)}(e.name,e.create)})),Promise.resolve()}catch(e){return Promise.reject(e)}}return d.then((function(){var e,t=timer("logger");return(l=new Logger("".concat(null===(e=p.connection.identity)||void 0===e?void 0:e.application),void 0,p.customLogger)).consoleLevel(p.logger.console),l.publishLevel(p.logger.publish),l.canPublish("debug")&&l.debug("initializing glue..."),w("logger",l,t),Promise.resolve(void 0)})).then((function(){var e=timer("connection");i=new Connection(p.connection,l.subLogger("connection"));var t=Promise.resolve(p.auth);return p.connection&&!p.auth&&(h?t=h.getGWToken().then((function(e){return{gatewayToken:e}})):"undefined"!=typeof window&&(null===window||void 0===window?void 0:window.glue42electron)?"string"==typeof window.glue42electron.gwToken&&(t=Promise.resolve({gatewayToken:window.glue42electron.gwToken})):t=Promise.reject("You need to provide auth information")),t.then((function(t){var n;if(e.mark("auth-promise-resolved"),"[object Object]"!==Object.prototype.toString.call(t))throw new Error("Invalid auth object - "+JSON.stringify(t));return n=t,i.login(n)})).then((function(){return w("connection",i,e),p})).catch((function(e){throw i&&i.logout(),e}))})).then((function(){return Promise.all([m(),(e=timer("interop"),t={connection:i,logger:l.subLogger("interop")},o=new Interop(t),Logger.Interop=o,w(["interop","agm"],o,e),Promise.resolve()),v(),y()]);var e,t})).then((function(){return o.readyPromise})).then((function(){return function(){return __awaiter(this,void 0,void 0,(function(){var t,n,r;return __generator(this,(function(i){switch(i.label){case 0:if(t="T42.ACS.RegisterInstance",!Utils.isNode()||void 0!==process.env._GD_STARTING_CONTEXT_||void 0===(null==e?void 0:e.application))return[3,4];if(!(o.methods({name:t}).length>0))return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o.invoke(t,{appName:null==e?void 0:e.application,pid:process.pid})];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),r=n,l.error("Cannot register as an instance: ".concat(JSON.stringify(r.message))),[3,4];case 4:return[2]}}))}))}()})).then((function(){return b(p.libs||[])})).then((function(){var e=Object.keys(g).map((function(e){var t=g[e];return t.ready?t.ready():Promise.resolve()}));return Promise.all(e)})).then((function(){var n={coreVersion:version$2,version:p.version};f.stop();var r={feedback:function(e){o&&o.invoke("T42.ACS.Feedback",e,"best")},info:n,logger:l,interop:o,agm:o,connection:i,metrics:s,contexts:a,bus:u,version:p.version,userConfig:e,done:function(){return null==l||l.info("done called by user..."),i.logout()}};if(r.performance={get glueVer(){return p.version},get glueConfig(){return JSON.stringify(e)},get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var e=getAllTimers();return Object.keys(e).map((function(t){var n=e[t];return{name:t,duration:n.endTime-n.startTime,marks:n.marks,startTime:n.startTime,endTime:n.endTime}}))}},Object.keys(g).forEach((function(e){var t=g[e];r[e]=t})),r.config={},Object.keys(p).forEach((function(e){r.config[e]=p[e]})),t&&t.extOptions&&Object.keys(t.extOptions).forEach((function(e){r.config[e]=null==t?void 0:t.extOptions[e]})),(null==t?void 0:t.enrichGlue)&&t.enrichGlue(r),h&&h.updatePerfData&&h.updatePerfData(r.performance),r.agm){var c=function(e,t,n){return function(){return r.logger.warn("glue.js - 'glue.agm.".concat(t,"' method is deprecated, use 'glue.interop.").concat(n,"' instead.")),e.apply(r.agm,arguments)}},d=r.agm;d.method_added=c(r.agm.methodAdded,"method_added","methodAdded"),d.method_removed=c(r.agm.methodRemoved,"method_removed","methodRemoved"),d.server_added=c(r.agm.serverAdded,"server_added","serverAdded"),d.server_method_aded=c(r.agm.serverMethodAdded,"server_method_aded","serverMethodAdded"),d.server_method_removed=c(r.agm.serverMethodRemoved,"server_method_removed","serverMethodRemoved")}return r})).catch((function(e){return Promise.reject({err:e,libs:g})}))};"undefined"!=typeof window&&(window.IOConnectCore=IOConnectCoreFactory),IOConnectCoreFactory.version=version$2,IOConnectCoreFactory.default=IOConnectCoreFactory;const PromiseWrap=(e,t,n)=>new Promise(((r,i)=>{let o=!0;const l=setTimeout((()=>{if(!o)return;o=!1;i(n||`Promise timeout hit: ${t}`)}),t);e().then((e=>{o&&(o=!1,clearTimeout(l),r(e))})).catch((e=>{o&&(o=!1,clearTimeout(l),i(e))}))})),PromisePlus=(e,t,n)=>new Promise(((r,i)=>{const o=setTimeout((()=>{i(n||`Promise timeout hit: ${t}`)}),t);new Promise(e).then((e=>{clearTimeout(o),r(e)})).catch((e=>{clearTimeout(o),i(e)}))}));var version="3.2.0";class GlueController{constructor(e,t){this.portsBridge=e,this.sessionStorage=t}get logger(){return logger.get("glue.controller")}get workspaces(){if(!this._clientGlue.workspaces)throw new Error("Cannot access the Workspaces API");return this._clientGlue.workspaces}get isWorkspacesEnabled(){return!!this._clientGlue.workspaces}get me(){return this._clientGlue.interop.instance}get platformVersion(){return version}get clientGlue(){return this._clientGlue}get contextsTrackingGlue(){return this._contextsTrackingGlue}get systemGlue(){return this._systemGlue}get platformWindowId(){return this._platformClientWindowId.slice()}start(e){return __awaiter$7(this,void 0,void 0,(function*(){this._config=e;const t=this.sessionStorage.getSystemSettings();if(!t)throw new Error("Cannot initiate the glue controller, because the system settings are not defined");this._systemSettings=t,this._systemGlue=yield this.initSystemGlue(e.browser),logger.setLogger(this._systemGlue.logger),this._contextsTrackingGlue=yield this.setUpCtxTracking(e)}))}initClientGlue(e,t,n,r){return __awaiter$7(this,void 0,void 0,(function*(){const i=yield this.portsBridge.createInternalClient();this.registerClientWindow(n);const o={application:"Platform",gateway:{webPlatform:{port:i,windowId:this.platformWindowId}}},l=Object.assign({},e,o);return this._clientGlue=t?yield t(l):yield iOConnectBrowserFactory(l),this._clientGlue.webPlatform=r,this._clientGlue}))}createPlatformSystemMethod(e){return __awaiter$7(this,void 0,void 0,(function*(){yield this.createMethodAsync(GlueWebPlatformControlName,e)}))}createPlatformSystemStream(){return __awaiter$7(this,void 0,void 0,(function*(){this._systemStream=yield this.createStream(GlueWebPlatformStreamName)}))}createSystemStream(e){return __awaiter$7(this,void 0,void 0,(function*(){return this.createStream(e)}))}createWorkspacesStream(){return __awaiter$7(this,void 0,void 0,(function*(){this._workspacesStream=yield this.createStream(GlueWebPlatformWorkspacesStreamName)}))}createWorkspacesEventsReceiver(e){return __awaiter$7(this,void 0,void 0,(function*(){yield this._systemGlue.interop.register(GlueWorkspacesEventsReceiverName,(t=>e(t)))}))}pushSystemMessage(e,t,n){if(!this._systemStream)throw new Error(`Cannot push data to domain: ${e}, because the system stream is not created`);this._systemStream.push({domain:e,operation:t,data:n})}pushWorkspacesMessage(e){if(!this._workspacesStream)throw new Error("Cannot push data to domain: workspaces, because the workspaces stream is not created");this._workspacesStream.push({data:e})}callFrame(e,t,n){return __awaiter$7(this,void 0,void 0,(function*(){const r={operation:e.name,operationArguments:t},i=`Internal Platform->Frame Communication Error. Attempted calling workspace frame: ${n} for operation ${e.name} `;if(e.dataDecoder){const t=e.dataDecoder.run(r.operationArguments);if(!t.ok)throw new Error(`${i} OutBound validation failed: ${JSON.stringify(t.error)}`)}const o=GlueWorkspaceFrameClientControlName,l=yield this.transmitMessage(o,r,i,{windowId:n},{methodResponseTimeoutMs:3e4,waitTimeoutMs:3e4});if(e.resultDecoder){const t=e.resultDecoder.run(l);if(!t.ok)throw new Error(`${i} Result validation failed: ${JSON.stringify(t.error)}`)}return l}))}isValidWindowId(e){return!(!e||!this.clientGlue.windows.findById(e))}sendShutDownSignals(){return __awaiter$7(this,void 0,void 0,(function*(){const e=this.clientGlue.windows.list().filter((e=>e.id!==this.platformWindowId));yield Promise.all(e.map((e=>e.close())));const t={domain:"system",operation:"platformShutdown"},n=`Internal Platform-> ${t.domain} Domain Communication Error. Attempted sending shutdown signal to all clients.`,r=this.clientGlue.interop.servers().filter((t=>e.every((e=>e.id!==t.windowId)))).map((e=>({instance:e.instance})));try{yield this.transmitMessage(GlueClientControlName,t,n,r,{methodResponseTimeoutMs:3e4,waitTimeoutMs:3e4})}catch(e){console.warn("Failed to send shutdown signal to all clients",e)}}))}shutdown(){var e;this.systemGlue.connection.logout(),null===(e=this.contextsTrackingGlue)||void 0===e||e.connection.logout(),this.clientGlue.connection.logout()}callWindow(e,t,n,r){return __awaiter$7(this,void 0,void 0,(function*(){const i=t.name,o={domain:e,operation:i,data:n},l=`Internal Platform-> ${e} Domain Communication Error. Attempted calling client window: ${JSON.stringify(r)} for operation ${i}. `;if(t.dataDecoder){const e=t.dataDecoder.run(o.data);if(!e.ok)throw new Error(`${l} OutBound validation failed: ${JSON.stringify(e.error)}`)}const s=yield this.transmitMessage(GlueClientControlName,o,l,r,{methodResponseTimeoutMs:3e4,waitTimeoutMs:3e4});if(t.resultDecoder){const e=t.resultDecoder.run(s);if(!e.ok)throw new Error(`${l} Result validation failed when calling window: ${JSON.stringify(r)} for operation ${i}: ${JSON.stringify(e.error)}`)}return s}))}setStartContext(e,t,n){return PromisePlus(((r,i)=>{let o;const l=waitFor(2,(()=>{r(),o()})),s=`___${n}___${e}`;(this._clientGlue.contexts.all().some((e=>e===s))?this.waitContextDestroy(s):Promise.resolve()).then((()=>this._clientGlue.contexts.subscribe(s,l))).then((e=>(o=e,this._systemGlue.contexts.set(s,t)))).then(l).catch(i)}),1e4,`Timed out waiting to set the ${n} context for: ${e}`)}waitContextDestroy(e){return new Promise(((t,n)=>{let r=0;const i=setInterval((()=>{const o=this._clientGlue.contexts.all().some((t=>t===e));if(++r,!o)return clearInterval(i),void t();50===r&&(clearInterval(i),n(`Timed out waiting for context: ${e} to disappear`))}),100)}))}clearContext(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=`___${t}___${e}`;this._systemGlue.contexts.all().some((e=>e===n))&&(yield this._systemGlue.contexts.destroy(n))}))}preserveAllWorkspaceWindowsContext(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=this.sessionStorage.pickWorkspaceClients((t=>t.workspaceId===e));for(const e of t){const t=yield this._systemGlue.contexts.get(`___window___${e.windowId}`);t&&("object"!=typeof t||Object.keys(t).length)&&(yield this._systemGlue.contexts.set(`___window-hibernation___${e.windowId}`,t))}}))}pullHibernatedContext(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=`___window-hibernation___${e}`;if(!this._systemGlue.contexts.all().some((e=>e===t)))return;const n=yield this._systemGlue.contexts.get(t);return yield this._systemGlue.contexts.destroy(t),n}))}getServers(){return this._clientGlue.interop.servers()}subscribeForServerAdded(e){return this._clientGlue.interop.serverAdded(e)}subscribeForMethodAdded(e){return this._clientGlue.interop.methodAdded(e)}invokeMethod(e,t,n,r,i,o){return this._clientGlue.interop.invoke(e,t,n,r,i,o)}setContext(e,t){return this._systemGlue.contexts.set(e,t)}switchTransport(e,t){if("contextsTrack"===t)return this._contextsTrackingGlue?this._contextsTrackingGlue.connection.switchTransport(e):Promise.resolve({success:!0});return("system"===t?this._systemGlue:this._clientGlue).connection.switchTransport(e)}onDisconnected(e){return this._systemGlue.connection.disconnected(e)}getSystemGlueTransportName(){return this._systemGlue.connection.transport.name()}importLayout(e){return __awaiter$7(this,void 0,void 0,(function*(){yield this._clientGlue.layouts.import([e],"merge")}))}getLayout(e){return __awaiter$7(this,void 0,void 0,(function*(){return yield this._clientGlue.layouts.get(e,"Global")}))}openWindow(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){this._clientGlue.windows.list().find((t=>t.name===e.name))&&(e.name=`${e.name}-${nanoid(7)}`);const o={context:e.context,top:null===(t=e.bounds)||void 0===t?void 0:t.top,left:null===(n=e.bounds)||void 0===n?void 0:n.left,width:null===(r=e.bounds)||void 0===r?void 0:r.width,height:null===(i=e.bounds)||void 0===i?void 0:i.height,layoutComponentId:e.layoutComponentId};yield this._clientGlue.windows.open(e.name,e.url,o)}))}startApp(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){const o={waitForAGMReady:!1,top:null===(t=e.bounds)||void 0===t?void 0:t.top,left:null===(n=e.bounds)||void 0===n?void 0:n.left,width:null===(r=e.bounds)||void 0===r?void 0:r.width,height:null===(i=e.bounds)||void 0===i?void 0:i.height,layoutComponentId:e.layoutComponentId};yield this._clientGlue.appManager.application(e.name).start(e.context,o)}))}getOrCreateWorkspaceFrame({bounds:e,layoutComponentId:t,frameId:n}){return __awaiter$7(this,void 0,void 0,(function*(){return n?yield this.workspaces.getFrame((e=>e.id===n)):yield this.workspaces.createEmptyFrame({frameConfig:{bounds:e||void 0},layoutComponentId:t||void 0})}))}getAppNameByInstanceId(e){var t;return null===(t=this._clientGlue.interop.servers().find((t=>t.instance===e)))||void 0===t?void 0:t.application}getAllWindowNames(){return this._clientGlue.windows.list().map((e=>e.name))}getAllOpenedIds(){return this._clientGlue.windows.list().map((e=>e.id))}getAllOtherNonPlatformWindows(e){return this._clientGlue.windows.list().filter((t=>"Platform"!==t.name&&t.id!==e))}getAllOpenedFrameIds(){return __awaiter$7(this,void 0,void 0,(function*(){return(yield this.workspaces.getAllFrames()).map((e=>e.id))}))}getAllApplicationNames(){return this._clientGlue.appManager.applications().map((e=>e.name))}getAllApplications(){return this._clientGlue.appManager.applications()}getAllLayoutsSummaries(){return this._clientGlue.layouts.getAll("Global")}getAllWorkspacesSummaries(){return this._clientGlue.layouts.getAll("Workspace")}getWorkspaceWindowById(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){return null===(t=this._clientGlue.workspaces)||void 0===t?void 0:t.getWindow((t=>t.id===e))}))}getWindowById(e){return this._clientGlue.windows.list().find((t=>t.id===e))}getAllWorkspacesFrames(){return __awaiter$7(this,void 0,void 0,(function*(){return yield this.workspaces.getAllFrames()}))}getWorkspacesByFrameId(e){return __awaiter$7(this,void 0,void 0,(function*(){return yield this.workspaces.getAllWorkspaces((t=>t.frameId===e))}))}registerProvider(e){if(!this._clientGlue.search)throw new Error("Cannot start the search provider for Glue42 Core Plus, because the Search API is missing");return this._clientGlue.search.registerProvider(e)}processServerApplicationsData(e){return __awaiter$7(this,void 0,void 0,(function*(){if(!e||!e.data)return;const t=e.data,n=yield this._clientGlue.appManager.inMemory.import(t,"merge");n.errors&&n.errors.length&&n.errors.forEach((e=>{var t;null===(t=this.logger)||void 0===t||t.warn(`App: ${e.app} was not imported, because of error: ${e.error}`)}))}))}initSystemGlue(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){const r=yield this.portsBridge.createInternalClient(),i=null!==(n=null===(t=null==e?void 0:e.systemLogger)||void 0===t?void 0:t.level)&&void 0!==n?n:"warn";return yield IOConnectCoreFactory({application:"Platform-System",gateway:{webPlatform:{port:r}},logger:i,identity:{instance:this._systemSettings.systemInstanceId}})}))}setUpCtxTracking(e){return __awaiter$7(this,void 0,void 0,(function*(){if(this._config.connection.preferred)return yield this.initContextsTrackingGlue({reAnnounceKnownContexts:!0,trackAllContexts:!0},e)}))}initContextsTrackingGlue(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){const o=yield this.portsBridge.createInternalClient();return yield IOConnectCoreFactory({application:"Platform-Contexts-Track",gateway:{webPlatform:{port:o}},logger:null!==(i=null===(r=null===(n=null==t?void 0:t.browser)||void 0===n?void 0:n.systemLogger)||void 0===r?void 0:r.level)&&void 0!==i?i:"warn",contexts:e,identity:{instance:this._systemSettings.ctxTrackInstanceId}})}))}registerClientWindow(e){if(e){const e=this.sessionStorage.getPlatformFrame();if(this._platformClientWindowId=e?e.windowId:window.name?window.name:`g42-${shortid$2.generate()}`,!e){const e={windowId:this.platformWindowId,active:!0,isPlatform:!0};this.sessionStorage.saveFrameData(e)}return void(window.name=this.platformWindowId)}const t=this.sessionStorage.getWindowDataByName("Platform");this._platformClientWindowId=t?t.windowId:window.name?window.name:`g42-${shortid$2.generate()}`,t||this.sessionStorage.saveWindowData({name:"Platform",windowId:this.platformWindowId}),window.name=this.platformWindowId}createMethodAsync(e,t){return __awaiter$7(this,void 0,void 0,(function*(){yield this._systemGlue.interop.registerAsync(e,t)}))}createStream(e){return __awaiter$7(this,void 0,void 0,(function*(){return this._systemGlue.interop.createStream(e)}))}transmitMessage(e,t,n,r,i){return __awaiter$7(this,void 0,void 0,(function*(){let o;try{if(o=yield this._systemGlue.interop.invoke(e,t,r,i),!o)throw new Error(`${n} Received unsupported result from the client - empty result`);if(!Array.isArray(o.all_return_values)||0===o.all_return_values.length)throw new Error(`${n} Received unsupported result from the client - empty values collection`)}catch(e){if(e&&e.all_errors&&e.all_errors.length){const t=e.all_errors[0].message;throw new Error(`${n} -> Inner message: ${t}`)}throw new Error(`${n} -> Inner message: ${e.message}`)}return o.all_return_values[0].returned}))}}class PortsBridge{constructor(e,t,n){this.gateway=e,this.sessionStorage=t,this.ioc=n,this.registry=CallbackRegistryFactory(),this.allPorts={},this.allClients=[],this.unLoadStarted=!1,this.isPreferredActivated=!1,this.transactionsController=this.ioc.transactionsController}get logger(){return logger.get("ports.bridge.controller")}shutdown(){window.removeEventListener("message",this._genericMessageHandler),window.removeEventListener("unload",this._unloaderHandler),this.registry.clear(),this.allPorts={},this.allClients=[],this.isPreferredActivated=!1,this.unLoadStarted=!1}configure(e){return __awaiter$7(this,void 0,void 0,(function*(){this.startUpPromise=new Promise((e=>{this.startupResolve=e}));const t=this.sessionStorage.getSystemSettings();if(!t)throw new Error("Cannot initiate the platform port bridge, because the system settings are not defined");this._communicationId=t.systemInstanceId,yield this.gateway.start(null==e?void 0:e.gateway),this.setupListeners()}))}start(){this.startupResolve()}createInternalClient(){return __awaiter$7(this,void 0,void 0,(function*(){const e=this.ioc.createMessageChannel();return yield this.gateway.setupInternalClient(e.port1),e.port2}))}onClientUnloaded(e){return this.registry.add("client-unloaded",e)}handleExtConnectionRequest(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){const r=e.glue42core;if(!!!r.parentWindowId){const e=r.clientId,t={windowId:e,name:e};yield this.ioc.windowsController.processNewWindow(t)}yield this.gateway.connectExtClient(t,this.removeClient.bind(this));const i=null===(n=this.sessionStorage.getWindowDataByName("Platform"))||void 0===n?void 0:n.windowId,o={glue42core:{type:Glue42CoreMessageTypes.connectionAccepted.name,parentWindowId:i,appName:"ext-no-app",clientId:r.clientId,clientType:"child"}};this.allPorts[r.clientId]=t,t.postMessage(o)}))}setActivePreferredTransportConfig(e){"secondary"!==e.type?delete this.activePreferredTransportConfig:this.activePreferredTransportConfig=e}setPreferredActivated(){this.isPreferredActivated=!0}switchAllClientsTransport(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=Object.keys(this.allPorts).map((t=>this.sendClientPortRequest({type:Glue42CoreMessageTypes.transportSwitchRequest.name,timeout:defaultClientPortRequestTimeoutMS,clientId:t,args:{switchSettings:e}})));yield Promise.all(t)}))}checkClientsPreferredLogic(){return __awaiter$7(this,void 0,void 0,(function*(){const e=Object.keys(this.allPorts).map((e=>this.sendClientPortRequest({type:Glue42CoreMessageTypes.checkPreferredLogic.name,timeout:defaultClientPreferredLogicTestTimeoutMS,clientId:e})));try{return yield Promise.all(e),{success:!0}}catch(e){return{success:!1}}}))}checkClientsPreferredConnection(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=Object.keys(this.allPorts).map((t=>this.sendClientPortRequest({type:Glue42CoreMessageTypes.checkPreferredConnection.name,args:{url:e},timeout:defaultClientPortRequestTimeoutMS,clientId:t})));try{return yield Promise.all(t),{success:!0}}catch(e){return{success:!1}}}))}removeGwClient(e){const t=this.allClients.find((t=>t.bridgeInstanceId===e));t&&(this.allClients=this.allClients.filter((t=>t.bridgeInstanceId!==e)),t.client.disconnect(),this.allPorts[t.clientId]&&delete this.allPorts[t.clientId])}unloader(){this.unLoadStarted=!0;for(const e in this.allPorts)this.allPorts[e].postMessage({type:"platformUnload"})}genericMessageHandler(e){var t;const n=null===(t=e.data)||void 0===t?void 0:t.glue42core;if(n&&!this.unLoadStarted)if(n.type!==Glue42CoreMessageTypes.clientUnload.name)n.type!==Glue42CoreMessageTypes.connectionRequest.name?n.type!==Glue42CoreMessageTypes.platformPing.name?n.type!==Glue42CoreMessageTypes.parentPing.name||this.startUpPromise.then((()=>this.handleParentPing(e.source,e.origin))):this.startUpPromise.then((()=>this.handlePlatformPing(e.source,e.origin))):this.startUpPromise.then((()=>this.handleRemoteConnectionRequest(e.source,e.origin,n.clientId,n.clientType,n.bridgeInstanceId,n.selfAssignedWindowId)));else{const t={windowId:n.data.ownWindowId,win:e.source};this.registry.execute("client-unloaded",t)}}handleRemoteConnectionRequest(e,t,n,r,i,o){var l;return __awaiter$7(this,void 0,void 0,(function*(){const s=this.ioc.createMessageChannel(),a=yield this.gateway.connectClient(s.port1);this.setupGwClientPort({client:a,clientId:n,clientPort:s.port1}),this.allClients.push({client:a,bridgeInstanceId:i,clientId:n});const u=this.sessionStorage.getBridgeInstanceData(i),c=null==u?void 0:u.appName,h=null===(l=this.sessionStorage.getWindowDataByName("Platform"))||void 0===l?void 0:l.windowId,d={glue42core:{type:Glue42CoreMessageTypes.connectionAccepted.name,port:s.port2,communicationId:this._communicationId,isPreferredActivated:this.isPreferredActivated,parentWindowId:h,appName:c,clientId:n,clientType:r}};o&&(yield this.ioc.windowsController.registerSelfAssignedWindow({windowId:o,name:o},o)),e.postMessage(d,t,[s.port2])}))}handleParentPing(e,t){const n={glue42core:{type:Glue42CoreMessageTypes.parentReady.name}};e.postMessage(n,t)}handlePlatformPing(e,t){const n={glue42core:{type:Glue42CoreMessageTypes.platformReady.name}};e.postMessage(n,t)}removeClient(e,t,n){if(!e)return;if(this.allPorts[e]&&!n&&delete this.allPorts[e],!t)return;const r={windowId:e};this.registry.execute("client-unloaded",r)}setupGwClientPort(e){this.allPorts[e.clientId]&&this.allPorts[e.clientId].onmessage&&(this.allPorts[e.clientId].onmessage=null),this.allPorts[e.clientId]=e.clientPort,e.clientPort.onmessage=t=>{var n,r;const i=null===(n=t.data)||void 0===n?void 0:n.glue42core;if(i&&(i.type===Glue42CoreMessageTypes.clientUnload.name||i.type===Glue42CoreMessageTypes.gatewayDisconnect.name))return this.removeClient(i.data.clientId,!1,i.type===Glue42CoreMessageTypes.gatewayDisconnect.name),void(this.allClients.some((e=>e.clientId===i.data.clientId))&&(this.allClients=this.allClients.filter((e=>e.clientId!==i.data.clientId)),e.client.disconnect()));if(i&&i.type===Glue42CoreMessageTypes.transportSwitchResponse.name){i.args.success?this.transactionsController.completeTransaction(i.transactionId):this.transactionsController.failTransaction(i.transactionId,`The client: ${e.clientId} could not connect using the provided transport config.`)}else if(i&&i.type===Glue42CoreMessageTypes.getCurrentTransport.name){const t=i.transactionId;e.clientPort.postMessage({type:Glue42CoreMessageTypes.getCurrentTransportResponse.name,args:{transportState:this.getCurrentTransportState()},transactionId:t})}else{if(i&&i.type===Glue42CoreMessageTypes.checkPreferredLogicResponse.name)return this.transactionsController.completeTransaction(i.transactionId);if(i&&i.type===Glue42CoreMessageTypes.checkPreferredConnectionResponse.name){const t=i.args;return t.error?this.transactionsController.failTransaction(i.transactionId,t.error):t.live?this.transactionsController.completeTransaction(i.transactionId):this.transactionsController.failTransaction(i.transactionId,`Client ${e.clientId} could not connect to the preferred WS.`)}this.allClients.every((t=>t.client!==e.client))?null===(r=this.logger)||void 0===r||r.trace(`Ignoring a protocol message, because the destination client has been disconnected: ${JSON.stringify(t.data)}`):e.client.send(t.data)}}}getCurrentTransportState(){var e;const t=this.ioc.glueController.getSystemGlueTransportName();return{transportName:t,type:t===webPlatformTransportName?"default":"secondary",transportConfig:t===webPlatformTransportName||null===(e=this.activePreferredTransportConfig)||void 0===e?void 0:e.transportConfig}}sendClientPortRequest(e){const t=this.allPorts[e.clientId];if(!t)throw new Error(`Cannot sent port request: ${e.type} to ${e.clientId}, because there is no such client`);const n=this.transactionsController.createTransaction(e.type,e.timeout||defaultClientPortRequestTimeoutMS),r=e.type,i=e.args;return t.postMessage({type:r,args:i,transactionId:n.id}),n.lock}setupListeners(){this._genericMessageHandler=this.genericMessageHandler.bind(this),window.addEventListener("message",this._genericMessageHandler),this._unloaderHandler=this.unloader.bind(this),window.addEventListener("unload",this._unloaderHandler)}}const windowOperationDecoder=oneOf$1(constant$1("openWindow"),constant$1("windowHello"),constant$1("getUrl"),constant$1("getTitle"),constant$1("setTitle"),constant$1("moveResize"),constant$1("focus"),constant$1("close"),constant$1("getBounds"),constant$1("getFrameBounds"),constant$1("registerWorkspaceWindow"),constant$1("unregisterWorkspaceWindow"),constant$1("operationCheck"),constant$1("focusChange"),constant$1("getChannel")),openWindowConfigDecoder=object$1({name:nonEmptyStringDecoder$1,url:nonEmptyStringDecoder$1,options:optional$1(windowOpenSettingsDecoder)});object$1({windowId:nonEmptyStringDecoder$1,name:nonEmptyStringDecoder$1});const simpleWindowDecoder=object$1({windowId:nonEmptyStringDecoder$1}),windowBoundsResultDecoder=object$1({windowId:nonEmptyStringDecoder$1,bounds:windowBoundsDecoder}),frameWindowBoundsResultDecoder=object$1({bounds:windowBoundsDecoder}),windowUrlResultDecoder=object$1({windowId:nonEmptyStringDecoder$1,url:nonEmptyStringDecoder$1}),windowMoveResizeConfigDecoder=object$1({windowId:nonEmptyStringDecoder$1,top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1),relative:optional$1(boolean())}),windowTitleConfigDecoder=object$1({windowId:nonEmptyStringDecoder$1,title:string$1()}),windowChannelResultDecoder=object$1({channel:optional$1(nonEmptyStringDecoder$1)}),workspacesOperationDecoder=oneOf$1(constant$1("isWindowInWorkspace"),constant$1("createWorkspace"),constant$1("createFrame"),constant$1("initFrame"),constant$1("getAllFramesSummaries"),constant$1("getFrameSummary"),constant$1("getAllWorkspacesSummaries"),constant$1("getWorkspaceSnapshot"),constant$1("getAllLayoutsSummaries"),constant$1("openWorkspace"),constant$1("deleteLayout"),constant$1("saveLayout"),constant$1("importLayout"),constant$1("exportAllLayouts"),constant$1("restoreItem"),constant$1("maximizeItem"),constant$1("focusItem"),constant$1("closeItem"),constant$1("resizeItem"),constant$1("moveFrame"),constant$1("getFrameSnapshot"),constant$1("forceLoadWindow"),constant$1("ejectWindow"),constant$1("setItemTitle"),constant$1("moveWindowTo"),constant$1("addWindow"),constant$1("addContainer"),constant$1("bundleWorkspace"),constant$1("bundleItem"),constant$1("changeFrameState"),constant$1("getFrameState"),constant$1("getFrameBounds"),constant$1("frameHello"),constant$1("hibernateWorkspace"),constant$1("resumeWorkspace"),constant$1("getWorkspacesConfig"),constant$1("lockWorkspace"),constant$1("lockContainer"),constant$1("lockWindow"),constant$1("pinWorkspace"),constant$1("unpinWorkspace"),constant$1("getWorkspaceIcon"),constant$1("setWorkspaceIcon"),constant$1("checkStarted"),constant$1("getPlatformFrameId"),constant$1("getWorkspaceWindowsOnLayoutSaveContext"),constant$1("getWorkspacesLayouts"),constant$1("setMaximizationBoundary"),constant$1("operationCheck"),constant$1("getWorkspaceWindowFrameBounds"),constant$1("focusChange")),frameHelloDecoder=object$1({windowId:optional$1(nonEmptyStringDecoder$1)}),workspaceWindowDataDecoder=object$1({name:nonEmptyStringDecoder$1,windowId:nonEmptyStringDecoder$1,frameId:nonEmptyStringDecoder$1,workspaceId:optional$1(nonEmptyStringDecoder$1),appName:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1()),title:optional$1(nonEmptyStringDecoder$1)}),isWindowInSwimlaneResultDecoder=object$1({inWorkspace:boolean()}),allParentDecoder=oneOf$1(constant$1("workspace"),constant$1("row"),constant$1("column"),constant$1("group")),subParentDecoder=oneOf$1(constant$1("row"),constant$1("column"),constant$1("group")),frameStateDecoder=oneOf$1(constant$1("maximized"),constant$1("minimized"),constant$1("normal"));object$1({saveLayout:optional$1(boolean())});const deleteLayoutConfigDecoder=object$1({name:nonEmptyStringDecoder$1}),swimlaneWindowDefinitionDecoder=object$1({type:optional$1(constant$1("window")),appName:optional$1(nonEmptyStringDecoder$1),windowId:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1())}),strictSwimlaneWindowDefinitionDecoder=object$1({type:constant$1("window"),appName:optional$1(nonEmptyStringDecoder$1),windowId:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1())}),parentDefinitionDecoder=object$1({type:optional$1(subParentDecoder),children:optional$1(lazy((()=>array$1(oneOf$1(swimlaneWindowDefinitionDecoder,parentDefinitionDecoder))))),config:optional$1(anyJson$1())}),groupDefinitionConfigDecoder=object$1({minWidth:optional$1(number$1()),maxWidth:optional$1(number$1()),minHeight:optional$1(number$1()),maxHeight:optional$1(number$1()),allowExtract:optional$1(boolean()),allowReorder:optional$1(boolean()),allowDrop:optional$1(boolean()),allowDropHeader:optional$1(boolean()),allowDropLeft:optional$1(boolean()),allowDropTop:optional$1(boolean()),allowDropRight:optional$1(boolean()),allowDropBottom:optional$1(boolean()),showMaximizeButton:optional$1(boolean()),showEjectButton:optional$1(boolean()),showAddWindowButton:optional$1(boolean())}),rowDefinitionConfigDecoder=object$1({minHeight:optional$1(number$1()),maxHeight:optional$1(number$1()),allowDrop:optional$1(boolean()),allowSplitters:optional$1(boolean()),isPinned:optional$1(boolean()),maximizationBoundary:optional$1(boolean())}),columnDefinitionConfigDecoder=object$1({minWidth:optional$1(number$1()),maxWidth:optional$1(number$1()),allowDrop:optional$1(boolean()),allowSplitters:optional$1(boolean()),isPinned:optional$1(boolean()),maximizationBoundary:optional$1(boolean())}),strictColumnDefinitionDecoder=object$1({type:constant$1("column"),children:optional$1(lazy((()=>array$1(oneOf$1(strictSwimlaneWindowDefinitionDecoder,strictParentDefinitionDecoder))))),config:optional$1(columnDefinitionConfigDecoder)}),strictRowDefinitionDecoder=object$1({type:constant$1("row"),children:optional$1(lazy((()=>array$1(oneOf$1(strictSwimlaneWindowDefinitionDecoder,strictParentDefinitionDecoder))))),config:optional$1(rowDefinitionConfigDecoder)}),strictGroupDefinitionDecoder=object$1({type:constant$1("group"),children:optional$1(lazy((()=>array$1(oneOf$1(strictSwimlaneWindowDefinitionDecoder,strictParentDefinitionDecoder))))),config:optional$1(groupDefinitionConfigDecoder)}),strictParentDefinitionDecoder=oneOf$1(strictGroupDefinitionDecoder,strictColumnDefinitionDecoder,strictRowDefinitionDecoder);oneOf$1(string$1().where((e=>"maximized"===e.toLowerCase()),"Expected a case insensitive variation of 'maximized'"),string$1().where((e=>"normal"===e.toLowerCase()),"Expected a case insensitive variation of 'normal'"));const newFrameConfigDecoder=object$1({bounds:optional$1(object$1({left:optional$1(number$1()),top:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1)})),frameId:optional$1(nonEmptyStringDecoder$1)}),loadStrategyDecoder=oneOf$1(constant$1("direct"),constant$1("delayed"),constant$1("lazy")),restoreWorkspaceConfigDecoder=object$1({app:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1()),loadStrategy:optional$1(loadStrategyDecoder),title:optional$1(nonEmptyStringDecoder$1),reuseWorkspaceId:optional$1(nonEmptyStringDecoder$1),frameId:optional$1(nonEmptyStringDecoder$1),lockdown:optional$1(boolean()),activateFrame:optional$1(boolean()),newFrame:optional$1(oneOf$1(newFrameConfigDecoder,boolean())),noTabHeader:optional$1(boolean()),inMemoryLayout:optional$1(boolean()),isPinned:optional$1(boolean()),icon:optional$1(nonEmptyStringDecoder$1),isSelected:optional$1(boolean()),positionIndex:optional$1(nonNegativeNumberDecoder$1)}),openWorkspaceConfigDecoder=object$1({name:nonEmptyStringDecoder$1,restoreOptions:optional$1(restoreWorkspaceConfigDecoder)}),workspaceDefinitionDecoder=object$1({children:optional$1(array$1(oneOf$1(swimlaneWindowDefinitionDecoder,parentDefinitionDecoder))),context:optional$1(anyJson$1()),config:optional$1(object$1({title:optional$1(nonEmptyStringDecoder$1),position:optional$1(nonNegativeNumberDecoder$1),isFocused:optional$1(boolean()),loadStrategy:optional$1(loadStrategyDecoder),noTabHeader:optional$1(boolean()),allowDrop:optional$1(boolean()),allowDropLeft:optional$1(boolean()),allowDropTop:optional$1(boolean()),allowDropRight:optional$1(boolean()),allowDropBottom:optional$1(boolean()),allowExtract:optional$1(boolean()),allowWindowReorder:optional$1(boolean()),allowSystemHibernation:optional$1(boolean()),showSaveButton:optional$1(boolean()),allowWorkspaceTabReorder:optional$1(boolean()),allowWorkspaceTabExtract:optional$1(boolean()),showCloseButton:optional$1(boolean()),allowSplitters:optional$1(boolean()),positionIndex:optional$1(nonNegativeNumberDecoder$1)})),frame:optional$1(object$1({reuseFrameId:optional$1(nonEmptyStringDecoder$1),newFrame:optional$1(oneOf$1(boolean(),newFrameConfigDecoder))}))});object$1({type:allParentDecoder,definition:optional$1(oneOf$1(workspaceDefinitionDecoder,parentDefinitionDecoder))});const workspaceCreateConfigDecoder=intersection(workspaceDefinitionDecoder,object$1({saveConfig:optional$1(object$1({saveLayout:optional$1(boolean())}))})),getFrameSummaryConfigDecoder=object$1({itemId:nonEmptyStringDecoder$1}),frameSummaryDecoder=object$1({id:nonEmptyStringDecoder$1,isFocused:optional$1(boolean()),isInitialized:optional$1(boolean()),initializationContext:optional$1(object$1({context:optional$1(anyJson$1())}))});object$1({id:nonEmptyStringDecoder$1,frameId:nonEmptyStringDecoder$1,positionIndex:number$1(),title:nonEmptyStringDecoder$1,focused:boolean(),layoutName:optional$1(nonEmptyStringDecoder$1),isSelected:optional$1(boolean())}),object$1({type:subParentDecoder,id:nonEmptyStringDecoder$1,frameId:nonEmptyStringDecoder$1,workspaceId:nonEmptyStringDecoder$1,positionIndex:number$1()});const eventTypeDecoder=oneOf$1(constant$1("frame"),constant$1("workspace"),constant$1("container"),constant$1("window"));object$1({type:eventTypeDecoder,branch:nonEmptyStringDecoder$1}),oneOf$1(constant$1("opened"),constant$1("closing"),constant$1("closed"),constant$1("focus"),constant$1("added"),constant$1("loaded"),constant$1("removed"),constant$1("childrenUpdate"),constant$1("containerChange"),constant$1("maximized"),constant$1("restored"),constant$1("minimized"),constant$1("normal"),constant$1("selected"),constant$1("lock-configuration-changed"),constant$1("hibernated"),constant$1("resumed"));const workspaceConfigResultDecoder=object$1({frameId:nonEmptyStringDecoder$1,title:nonEmptyStringDecoder$1,positionIndex:nonNegativeNumberDecoder$1,name:nonEmptyStringDecoder$1,layoutName:optional$1(nonEmptyStringDecoder$1),isHibernated:boolean(),isSelected:boolean(),lastActive:number$1(),allowDrop:optional$1(boolean()),allowExtract:optional$1(boolean()),allowWindowReorder:optional$1(boolean()),allowSystemHibernation:optional$1(boolean()),allowSplitters:optional$1(boolean()),showCloseButton:optional$1(boolean()),showSaveButton:optional$1(boolean()),allowWorkspaceTabReorder:optional$1(boolean()),allowDropLeft:optional$1(boolean()),allowDropTop:optional$1(boolean()),allowDropRight:optional$1(boolean()),allowDropBottom:optional$1(boolean()),showAddWindowButtons:optional$1(boolean()),showEjectButtons:optional$1(boolean()),showWindowCloseButtons:optional$1(boolean()),minWidth:optional$1(number$1()),maxWidth:optional$1(number$1()),minHeight:optional$1(number$1()),maxHeight:optional$1(number$1()),widthInPx:optional$1(number$1()),heightInPx:optional$1(number$1())}),baseChildSnapshotConfigDecoder=object$1({frameId:nonEmptyStringDecoder$1,workspaceId:nonEmptyStringDecoder$1,positionIndex:number$1()}),parentSnapshotConfigDecoder=anyJson$1(),swimlaneWindowSnapshotConfigDecoder=intersection(baseChildSnapshotConfigDecoder,object$1({windowId:optional$1(nonEmptyStringDecoder$1),isMaximized:optional$1(boolean()),isFocused:boolean(),isSelected:optional$1(boolean()),title:optional$1(string$1()),appName:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1())})),childSnapshotResultDecoder=object$1({id:optional$1(nonEmptyStringDecoder$1),config:oneOf$1(parentSnapshotConfigDecoder,swimlaneWindowSnapshotConfigDecoder),children:optional$1(lazy((()=>array$1(childSnapshotResultDecoder)))),type:oneOf$1(constant$1("window"),constant$1("row"),constant$1("column"),constant$1("group"))}),workspaceSnapshotResultDecoder=object$1({id:nonEmptyStringDecoder$1,config:workspaceConfigResultDecoder,children:array$1(childSnapshotResultDecoder),frameSummary:frameSummaryDecoder,context:optional$1(anyJson$1())}),customWorkspaceChildSnapshotDecoder=object$1({id:nonEmptyStringDecoder$1,config:oneOf$1(parentSnapshotConfigDecoder,swimlaneWindowSnapshotConfigDecoder),children:optional$1(lazy((()=>array$1(customWorkspaceChildSnapshotDecoder)))),type:oneOf$1(constant$1("window"),constant$1("row"),constant$1("column"),constant$1("group"))}),groupLayoutItemDecoder=object$1({type:constant$1("group"),config:anyJson$1(),children:array$1(oneOf$1(windowLayoutItemDecoder))}),columnLayoutItemDecoder=object$1({type:constant$1("column"),config:anyJson$1(),children:array$1(oneOf$1(groupLayoutItemDecoder,windowLayoutItemDecoder,lazy((()=>columnLayoutItemDecoder)),lazy((()=>rowLayoutItemDecoder))))}),rowLayoutItemDecoder=object$1({type:constant$1("row"),config:anyJson$1(),children:array$1(oneOf$1(columnLayoutItemDecoder,groupLayoutItemDecoder,windowLayoutItemDecoder,lazy((()=>rowLayoutItemDecoder))))}),workspaceLayoutDecoder=object$1({name:nonEmptyStringDecoder$1,type:constant$1("Workspace"),metadata:optional$1(anyJson$1()),components:array$1(object$1({type:constant$1("Workspace"),application:optional$1(nonEmptyStringDecoder$1),state:object$1({config:anyJson$1(),context:anyJson$1(),children:array$1(oneOf$1(rowLayoutItemDecoder,columnLayoutItemDecoder,groupLayoutItemDecoder,windowLayoutItemDecoder))})}))}),workspacesLayoutImportConfigDecoder=object$1({layout:workspaceLayoutDecoder,mode:oneOf$1(constant$1("replace"),constant$1("merge"))}),exportedLayoutsResultDecoder=object$1({layouts:array$1(workspaceLayoutDecoder)}),frameSummaryResultDecoder=frameSummaryDecoder,frameSummariesResultDecoder=object$1({summaries:array$1(frameSummaryResultDecoder)}),workspaceSummaryResultDecoder=object$1({id:nonEmptyStringDecoder$1,config:workspaceConfigResultDecoder}),workspaceSummariesResultDecoder=object$1({summaries:array$1(workspaceSummaryResultDecoder)}),frameSnapshotResultDecoder=object$1({id:nonEmptyStringDecoder$1,config:anyJson$1(),workspaces:array$1(workspaceSnapshotResultDecoder)}),layoutSummaryDecoder=object$1({name:nonEmptyStringDecoder$1}),layoutSummariesDecoder=object$1({summaries:array$1(layoutSummaryDecoder)}),simpleWindowOperationSuccessResultDecoder=object$1({windowId:nonEmptyStringDecoder$1}),voidResultDecoder=anyJson$1(),frameStateResultDecoder=object$1({state:frameStateDecoder}),frameBoundsDecoder=object$1({top:number$1(),left:number$1(),width:nonNegativeNumberDecoder$1,height:nonNegativeNumberDecoder$1}),frameBoundsResultDecoder=object$1({bounds:frameBoundsDecoder}),resizeConfigDecoder=object$1({width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1),relative:optional$1(boolean())}),moveConfigDecoder=object$1({top:optional$1(number$1()),left:optional$1(number$1()),relative:optional$1(boolean())}),simpleItemConfigDecoder=object$1({itemId:nonEmptyStringDecoder$1}),frameSnapshotConfigDecoder=object$1({itemId:nonEmptyStringDecoder$1,excludeIds:optional$1(boolean())}),frameStateConfigDecoder=object$1({frameId:nonEmptyStringDecoder$1,requestedState:frameStateDecoder}),setItemTitleConfigDecoder=object$1({itemId:nonEmptyStringDecoder$1,title:nonEmptyStringDecoder$1}),moveWindowConfigDecoder=object$1({itemId:nonEmptyStringDecoder$1,containerId:nonEmptyStringDecoder$1}),resizeItemConfigDecoder=intersection(simpleItemConfigDecoder,resizeConfigDecoder),moveFrameConfigDecoder=intersection(simpleItemConfigDecoder,moveConfigDecoder);object$1({id:nonEmptyStringDecoder$1,type:subParentDecoder});const addWindowConfigDecoder=object$1({definition:swimlaneWindowDefinitionDecoder,parentId:nonEmptyStringDecoder$1,parentType:allParentDecoder}),addContainerConfigDecoder=object$1({definition:strictParentDefinitionDecoder,parentId:nonEmptyStringDecoder$1,parentType:allParentDecoder}),addItemResultDecoder=object$1({itemId:nonEmptyStringDecoder$1,windowId:optional$1(nonEmptyStringDecoder$1)});object$1({live:boolean()});const bundleWorkspaceConfigDecoder=object$1({type:oneOf$1(constant$1("row"),constant$1("column")),workspaceId:nonEmptyStringDecoder$1}),bundleItemConfigDecoder=object$1({type:oneOf$1(constant$1("row"),constant$1("column")),itemId:nonEmptyStringDecoder$1}),workspaceSelectorDecoder=object$1({workspaceId:nonEmptyStringDecoder$1}),containerSummaryResultDecoder=object$1({itemId:nonEmptyStringDecoder$1,config:parentSnapshotConfigDecoder});object$1({frameSummary:frameSummaryDecoder,frameBounds:optional$1(frameBoundsDecoder)}),object$1({workspaceSummary:workspaceSummaryResultDecoder,frameSummary:frameSummaryDecoder,frameBounds:optional$1(frameBoundsDecoder)}),object$1({containerSummary:containerSummaryResultDecoder}),object$1({windowSummary:object$1({itemId:nonEmptyStringDecoder$1,parentId:nonEmptyStringDecoder$1,config:swimlaneWindowSnapshotConfigDecoder})});const workspaceLayoutSaveConfigDecoder=object$1({name:nonEmptyStringDecoder$1,workspaceId:nonEmptyStringDecoder$1,saveContext:optional$1(boolean())}),lockWorkspaceDecoder=object$1({workspaceId:nonEmptyStringDecoder$1,config:optional$1(object$1({allowDrop:optional$1(boolean()),allowDropLeft:optional$1(boolean()),allowDropTop:optional$1(boolean()),allowDropRight:optional$1(boolean()),allowDropBottom:optional$1(boolean()),allowExtract:optional$1(boolean()),allowWindowReorder:optional$1(boolean()),allowSystemHibernation:optional$1(boolean()),allowSplitters:optional$1(boolean()),showCloseButton:optional$1(boolean()),showSaveButton:optional$1(boolean()),allowWorkspaceTabReorder:optional$1(boolean()),showWindowCloseButtons:optional$1(boolean()),showEjectButtons:optional$1(boolean()),showAddWindowButtons:optional$1(boolean())}))}),lockWindowDecoder=object$1({windowPlacementId:nonEmptyStringDecoder$1,config:optional$1(object$1({allowExtract:optional$1(boolean()),allowReorder:optional$1(boolean()),showCloseButton:optional$1(boolean())}))}),lockRowDecoder=object$1({itemId:nonEmptyStringDecoder$1,type:constant$1("row"),config:optional$1(object$1({allowDrop:optional$1(boolean()),allowSplitters:optional$1(boolean())}))}),lockColumnDecoder=object$1({itemId:nonEmptyStringDecoder$1,type:constant$1("column"),config:optional$1(object$1({allowDrop:optional$1(boolean()),allowSplitters:optional$1(boolean())}))}),lockGroupDecoder=object$1({itemId:nonEmptyStringDecoder$1,type:constant$1("group"),config:optional$1(object$1({allowExtract:optional$1(boolean()),allowReorder:optional$1(boolean()),allowDrop:optional$1(boolean()),allowDropHeader:optional$1(boolean()),allowDropLeft:optional$1(boolean()),allowDropTop:optional$1(boolean()),allowDropRight:optional$1(boolean()),allowDropBottom:optional$1(boolean()),showMaximizeButton:optional$1(boolean()),showEjectButton:optional$1(boolean()),showAddWindowButton:optional$1(boolean())}))}),lockContainerDecoder=oneOf$1(lockColumnDecoder,lockGroupDecoder,lockRowDecoder),pinWorkspaceDecoder=object$1({workspaceId:nonEmptyStringDecoder$1,icon:optional$1(nonEmptyStringDecoder$1)}),setWorkspaceIconDecoder=object$1({workspaceId:nonEmptyStringDecoder$1,icon:optional$1(nonEmptyStringDecoder$1)}),workspaceIconDecoder=object$1({icon:optional$1(nonEmptyStringDecoder$1)});object$1({applicationName:optional$1(string$1()),frameConfig:optional$1(newFrameConfigDecoder),context:optional$1(object$1()),layoutComponentId:optional$1(nonEmptyStringDecoder$1)});const restoreWorkspaceDefinitionDecoder=object$1({name:nonEmptyStringDecoder$1,restoreOptions:optional$1(restoreWorkspaceConfigDecoder)});object$1({frameId:nonEmptyStringDecoder$1,workspaces:array$1(oneOf$1(workspaceDefinitionDecoder,restoreWorkspaceDefinitionDecoder))});const getWorkspaceWindowsOnLayoutSaveContextConfigDecoder=object$1({layoutType:oneOf$1(constant$1("Global"),constant$1("Workspace")),layoutName:nonEmptyStringDecoder$1,windowIds:array$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1()),instances:optional$1(array$1(nonEmptyStringDecoder$1)),ignoreInstances:optional$1(array$1(nonEmptyStringDecoder$1))}),setMaximizationBoundaryConfigDecoder=object$1({itemId:nonEmptyStringDecoder$1,enabled:boolean()}),workspaceWindowOnSaveDataDecoder=object$1({windowId:nonEmptyStringDecoder$1,windowContext:optional$1(anyJson$1())}),getWorkspaceWindowsOnLayoutSaveContextResult=object$1({windowsOnSaveData:array$1(workspaceWindowOnSaveDataDecoder)}),getWorkspacesLayoutsConfigDecoder=object$1({frameId:nonEmptyStringDecoder$1,layoutName:nonEmptyStringDecoder$1,layoutType:oneOf$1(constant$1("Global"),constant$1("Workspace")),context:optional$1(anyJson$1())}),getWorkspacesLayoutsResponseDecoder=object$1({workspaces:array$1(workspaceSnapshotResultDecoder)});class WindowsController{constructor(e,t,n,r){this.glueController=e,this.sessionController=t,this.stateController=n,this.ioc=r,this.started=!1,this.operations={openWindow:{name:"openWindow",execute:this.openWindow.bind(this),dataDecoder:openWindowConfigDecoder},windowHello:{name:"windowHello",execute:this.handleWindowHello.bind(this)},getBounds:{name:"getBounds",dataDecoder:simpleWindowDecoder,resultDecoder:windowBoundsResultDecoder,execute:this.handleGetBounds.bind(this)},getFrameBounds:{name:"getFrameBounds",dataDecoder:simpleWindowDecoder,resultDecoder:frameWindowBoundsResultDecoder,execute:this.handleGetBounds.bind(this)},getUrl:{name:"getUrl",dataDecoder:simpleWindowDecoder,resultDecoder:windowUrlResultDecoder,execute:this.handleGetUrl.bind(this)},moveResize:{name:"moveResize",dataDecoder:windowMoveResizeConfigDecoder,execute:this.handleMoveResize.bind(this)},focus:{name:"focus",dataDecoder:simpleWindowDecoder,execute:this.handleFocus.bind(this)},close:{name:"close",dataDecoder:simpleWindowDecoder,execute:this.handleClose.bind(this)},getTitle:{name:"getTitle",dataDecoder:simpleWindowDecoder,resultDecoder:windowTitleConfigDecoder,execute:this.handleGetTitle.bind(this)},setTitle:{name:"setTitle",dataDecoder:windowTitleConfigDecoder,execute:this.handleSetTitle.bind(this)},registerWorkspaceWindow:{name:"registerWorkspaceWindow",dataDecoder:workspaceWindowDataDecoder,execute:this.registerWorkspaceWindow.bind(this)},unregisterWorkspaceWindow:{name:"unregisterWorkspaceWindow",dataDecoder:simpleWindowDecoder,execute:this.handleWorkspaceClientRemoval.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)},focusChange:{name:"focusChange",dataDecoder:focusEventDataDecoder,execute:this.handleFocusEvent.bind(this)},getChannel:{name:"getChannel",dataDecoder:simpleWindowDecoder,resultDecoder:windowChannelResultDecoder,execute:this.handleGetChannel.bind(this)}}}get logger(){return logger.get("windows.controller")}get moveResizeOperation(){return this.operations.moveResize}get getFrameBoundsOperation(){return this.operations.getFrameBounds}get setTitleOperation(){return this.operations.setTitle}get getBoundsOperation(){return this.operations.getBounds}handlePlatformShutdown(){this.started=!1}start(e){return __awaiter$7(this,void 0,void 0,(function*(){this.clientResponseTimeoutMs=e.windows.windowResponseTimeoutMs,this.defaultBounds=e.windows.defaultWindowOpenBounds,this.started=!0,this.stateController.onWindowDisappeared(this.cleanUpWindow.bind(this))}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this windows control message, because the controller has not been started");const o=e.data,l=e.commandId,s=windowOperationDecoder.run(e.operation);if(!s.ok)throw new Error(`This window request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Windows request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Windows request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}getWindowTitle(e,t){return __awaiter$7(this,void 0,void 0,(function*(){return(yield this.handleGetTitle({windowId:e},t)).title}))}getWindowBounds(e,t){return __awaiter$7(this,void 0,void 0,(function*(){return(yield this.handleGetBounds({windowId:e},t)).bounds}))}processNewWindow(e,t,n){var r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`processing a new window with id: ${e.windowId} and name: ${e.name}`),this.sessionController.saveWindowData(e),n&&this.stateController.add(n,e.windowId),t&&(null===(i=this.logger)||void 0===i||i.trace(`setting the context for window ${e.windowId}`),yield this.glueController.setStartContext(e.windowId,t,"window")),this.emitStreamData("windowAdded",e)}))}handleWorkspaceClientRemoval(e){return __awaiter$7(this,void 0,void 0,(function*(){this.cleanUpWindow(e.windowId),this.ioc.portsBridge.removeGwClient(e.windowId)}))}handleClientUnloaded(e,t){var n,r,i;if(null===(n=this.logger)||void 0===n||n.trace(`handling unloading of ${e}`),e){if(!t||t.closed)return null===(r=this.logger)||void 0===r||r.trace(`${e} detected as closed, processing window cleanup`),this.cleanUpWindow(e);null===(i=this.logger)||void 0===i||i.trace(`${e} detected as not closed, adding to state controller`),this.stateController.add(t,e)}}cleanUpWindow(e){this.stateController.remove(e);this.sessionController.fullWindowClean(e)&&(this.glueController.clearContext(e,"window").catch((()=>{})),this.emitStreamData("windowRemoved",{windowId:e}))}registerSelfAssignedWindow(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling workspace window registration with id: ${e.windowId} and name: ${e.name}`),this.sessionController.saveWindowData({windowId:e.windowId,name:e.name,selfAssigned:!0}),this.sessionController.saveNonGlue({windowId:e.windowId}),this.emitStreamData("windowAdded",{windowId:e.windowId,name:e.name}),null===(r=this.logger)||void 0===r||r.trace(`[${t}] workspace window registered successfully with id ${e.windowId} and name ${e.name}`)}))}registerWorkspaceWindow(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling workspace window registration with id: ${e.windowId} and name: ${e.name}`),this.sessionController.saveWindowData({windowId:e.windowId,name:e.name}),this.sessionController.saveWorkspaceClient({windowId:e.windowId,frameId:e.frameId,initialTitle:e.title,workspaceId:e.workspaceId}),this.sessionController.saveNonGlue({windowId:e.windowId});const i=yield this.glueController.pullHibernatedContext(e.windowId),o=e.context||i;o&&(yield this.glueController.setStartContext(e.windowId,o,"window")),this.emitStreamData("windowAdded",{windowId:e.windowId,name:e.name}),null===(r=this.logger)||void 0===r||r.trace(`[${t}] workspace window registered successfully with id ${e.windowId} and name ${e.name}`)}))}handleFocusEvent(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling focus event from window id: ${e.windowId} and hasFocus: ${e.hasFocus}`),this.emitStreamData("focusChange",e),null===(r=this.logger)||void 0===r||r.trace(`[${t}] focus event from window id: ${e.windowId} and hasFocus: ${e.hasFocus} handled`)}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}emitStreamData(e,t){var n;null===(n=this.logger)||void 0===n||n.trace(`sending notification of event: ${e} with data: ${JSON.stringify(t)}`),this.glueController.pushSystemMessage("windows",e,t)}openWindow(e,t){var n,r,i,o,l,s,a,u;return __awaiter$7(this,void 0,void 0,(function*(){if(this.sessionController.getWindowDataByName(e.name))throw new Error(`Cannot open a window with name: ${e.name}, because a window with that name already exists.`);null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling open command with a valid name: ${e.name}, url: ${e.url} and options: ${JSON.stringify(e.options)}`);const c=yield this.getStartingBounds(e,t),h=null!==(i=null===(r=e.options)||void 0===r?void 0:r.windowId)&&void 0!==i?i:`g42-${shortid$2.generate()}`,d={name:e.name,windowId:h,initialBounds:c,initialUrl:e.url,initialContext:null===(o=e.options)||void 0===o?void 0:o.context,layoutComponentId:null===(l=e.options)||void 0===l?void 0:l.layoutComponentId},f=`left=${c.left},top=${c.top},width=${c.width},height=${c.height}`;null===(s=this.logger)||void 0===s||s.trace(`[${t}] calling native window open with bounds: ${f}`);const p=window.open(e.url,d.windowId,f);if(!p)throw new Error(`Cannot open window with url: ${e.url} and name: ${e.name}. The most likely reason is that the user has not approved popups or has a blocker.`);return yield this.processNewWindow(d,null===(a=e.options)||void 0===a?void 0:a.context,p),null===(u=this.logger)||void 0===u||u.trace(`[${t}] the new window is opened, saved in session, state and announced, responding to the caller`),d}))}handleWindowHello(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){if(null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a hello message from a real windowId: ${e.windowId}`),e.windowId){this.stateController.remove(e.windowId),this.sessionController.removeNonGlue({windowId:e.windowId});const n=this.sessionController.getWorkspaceClientById(e.windowId);if(n&&n.initialTitle){const r=e.windowId,i=n.initialTitle;PromiseWrap((()=>this.glueController.callWindow("windows",this.operations.setTitle,{windowId:r,title:i},{windowId:r})),this.clientResponseTimeoutMs).catch((e=>{var n;return null===(n=this.logger)||void 0===n?void 0:n.trace(`[${t}] error while setting the workspace window title: ${e.message}`)}))}}const i=!(!e.windowId||!this.sessionController.getFrameData(e.windowId)),o=this.sessionController.getAllWindowsData().map((e=>({windowId:e.windowId,name:e.name})));return null===(r=this.logger)||void 0===r||r.trace(`[${t}] a full list of all current windows has been compiled, sending it to the caller`),{windows:o,isWorkspaceFrame:i}}))}handleGetUrl(e,t){var n;if(!this.sessionController.getWindowDataById(e.windowId))throw new Error(`Cannot get the url of window: ${e.windowId}, because it does not exist for the platform`);null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a get url request for window ${e.windowId}`);const r=`Cannot get the url of window: ${e.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;return PromiseWrap((()=>this.glueController.callWindow("windows",this.operations.getUrl,e,{windowId:e.windowId})),this.clientResponseTimeoutMs,r)}handleGetTitle(e,t){var n;if(!this.sessionController.getWindowDataById(e.windowId))throw new Error(`Cannot get the title of window: ${e.windowId}, because it does not exist for the platform`);null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a get title request for window ${e.windowId}`);const r=`Cannot get the title of window: ${e.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;return PromiseWrap((()=>this.glueController.callWindow("windows",this.operations.getTitle,e,{windowId:e.windowId})),this.clientResponseTimeoutMs,r)}handleSetTitle(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.sessionController.getWindowDataById(e.windowId))throw new Error(`Cannot set the title of window: ${e.windowId}, because it does not exist for the platform`);this.sessionController.getWorkspaceClientById(e.windowId)&&(yield this.ioc.workspacesController.setItemTitle({itemId:e.windowId,title:e.title},t)),null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a set title request for window ${e.windowId} and title: ${e.title}`);const r=`Cannot set the title of window: ${e.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;yield PromiseWrap((()=>this.glueController.callWindow("windows",this.operations.setTitle,e,{windowId:e.windowId})),this.clientResponseTimeoutMs,r)}))}handleMoveResize(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){if(this.sessionController.getWorkspaceClientById(e.windowId))throw new Error(`Cannot move resize window id ${e.windowId}, because it is in a workspace. Consider using the workspaces API to get more control`);const r=this.sessionController.getWindowDataById(e.windowId);if(!r)throw new Error(`Cannot move resize window: ${e.windowId}, because it does not exist for the platform`);if("Platform"===r.name)throw new Error("Move-resizing the main application is not allowed");null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a move resize request for window ${e.windowId} and data: ${JSON.stringify(e)}`);const i=`Cannot move resize window: ${e.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;yield PromiseWrap((()=>this.glueController.callWindow("windows",this.operations.moveResize,e,{windowId:e.windowId})),this.clientResponseTimeoutMs,i),yield this.pause(500)}))}handleGetBounds(e,t){var n;if(this.sessionController.getWorkspaceClientById(e.windowId))throw new Error(`Cannot get bounds of window id ${e.windowId}, because it is in a workspace. Consider using the workspaces API to get more info`);if(!this.sessionController.getWindowDataById(e.windowId))throw new Error(`Cannot get the bounds of window: ${e.windowId}, because it does not exist for the platform`);null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a get bounds request for window ${e.windowId}`);const r=`Cannot get the bounds of window: ${e.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;return PromiseWrap((()=>this.glueController.callWindow("windows",this.operations.getBounds,e,{windowId:e.windowId})),this.clientResponseTimeoutMs,r)}handleFocus(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){if(this.sessionController.getWorkspaceClientById(e.windowId))throw new Error(`Cannot focus window id ${e.windowId}, because it is in a workspace. Consider using the workspaces API to get more control`);const r=this.sessionController.getWindowDataById(e.windowId);if(!r)throw new Error(`Cannot focus window: ${e.windowId}, because it is not known by the platform`);null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a focus request for window ${e.windowId}`),window.open(void 0,r.windowId)}))}handleClose(e,t){var n,r,i,o,l;return __awaiter$7(this,void 0,void 0,(function*(){if(this.sessionController.getWorkspaceClientById(e.windowId))return null===(n=this.logger)||void 0===n||n.trace(`[${t}] this window is detected as a workspace window, closing via the workspaces controller`),void(yield this.ioc.workspacesController.closeItem({itemId:e.windowId},t));if(this.sessionController.getInstanceData(e.windowId))return null===(r=this.logger)||void 0===r||r.trace(`[${t}] this window is detected as an application instance, closing via the appManager controller`),void(yield this.ioc.applicationsController.handleInstanceStop({id:e.windowId},t));const s=this.sessionController.getWindowDataById(e.windowId);if(!s)throw new Error(`Cannot close window: ${e.windowId}, because it is not known by the platform`);if("Platform"===s.name)throw new Error("Closing the main application is not allowed");if(s.selfAssigned)throw new Error("Closing self-assigned windows (windows not opened by the Glue API) is not allowed");null===(i=this.logger)||void 0===i||i.trace(`[${t}] handling a close request for window ${e.windowId}`),null===(o=window.open(void 0,s.windowId))||void 0===o||o.close(),this.cleanUpWindow(s.windowId),null===(l=this.logger)||void 0===l||l.trace(`[${t}] window ${e.windowId} has been closed, removed from session, state and announced`)}))}getStartingBounds(e,t){var n,r,i,o,l,s,a,u,c,h;return __awaiter$7(this,void 0,void 0,(function*(){const d={top:null!==(r=null===(n=e.options)||void 0===n?void 0:n.top)&&void 0!==r?r:this.defaultBounds.top,left:null!==(o=null===(i=e.options)||void 0===i?void 0:i.left)&&void 0!==o?o:this.defaultBounds.left,height:null!==(s=null===(l=e.options)||void 0===l?void 0:l.height)&&void 0!==s?s:this.defaultBounds.height,width:null!==(u=null===(a=e.options)||void 0===a?void 0:a.width)&&void 0!==u?u:this.defaultBounds.width};if(!(null===(c=e.options)||void 0===c?void 0:c.relativeTo))return d;const f=e.options.relativeTo,p=this.sessionController.getWindowDataById(f);if(!p)return d;try{const n=(yield this.handleGetBounds({windowId:p.windowId},t)).bounds,r=null!==(h=e.options.relativeDirection)&&void 0!==h?h:"right";return getRelativeBounds(d,n,r)}catch(e){return d}}))}pause(e){return new Promise((t=>setTimeout(t,e)))}handleGetChannel(e,t){var n;if(!this.sessionController.getWindowDataById(e.windowId))throw new Error(`Cannot get the channel of window: ${e.windowId}, because it does not exist for the platform`);null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a get channel request for window ${e.windowId}`);const r=`Cannot get the channel of window: ${e.windowId}, because it is either a non-glue window or it hasn't initiated it's glue yet`;return PromiseWrap((()=>this.glueController.callWindow("windows",this.operations.getChannel,e,{windowId:e.windowId})),this.clientResponseTimeoutMs,r)}}class SessionStorageController{constructor(){this.windowsNamespace="g42_core_windows",this.instancesNamespace="g42_core_instances",this.bridgeInstancesNamespace="g42_core_bridge",this.nonGlueNamespace="g42_core_nonglue",this.workspaceWindowsNamespace="g42_core_workspace_clients",this.workspaceFramesNamespace="g42_core_workspace_frames",this.workspaceHibernationNamespace="g42_core_workspace_hibernation",this.globalLayoutsNamespace="g42_core_layouts_global",this.workspaceLayoutsNamespace="g42_core_layouts_workspace",this.appDefsNamespace="g42_core_app_definitions",this.appDefsInmemoryNamespace="g42_core_app_definitions_inmemory",this.notificationsNamespace="g42_core_notifications",this.systemNamespace="g42_system",this.workspaceFrameCache="g42_workspace_frame_cache",this.allNamespaces=[this.bridgeInstancesNamespace,this.windowsNamespace,this.instancesNamespace,this.nonGlueNamespace,this.workspaceWindowsNamespace,this.workspaceFramesNamespace,this.globalLayoutsNamespace,this.workspaceLayoutsNamespace,this.appDefsNamespace,this.workspaceHibernationNamespace,this.appDefsInmemoryNamespace,this.notificationsNamespace,this.workspaceFrameCache]}get logger(){return logger.get("session.storage")}start(){this.sessionStorage=window.sessionStorage,this.allNamespaces.forEach((e=>{this.sessionStorage.getItem(e)||this.sessionStorage.setItem(e,JSON.stringify([]))}))}shutdown(){this.allNamespaces.forEach((e=>{this.sessionStorage.setItem(e,JSON.stringify([]))})),this.sessionStorage.removeItem(this.systemNamespace)}getSystemSettings(){const e=this.sessionStorage.getItem(this.systemNamespace);if(e)return JSON.parse(e)}setSystemSettings(e){this.sessionStorage.setItem(this.systemNamespace,JSON.stringify(e))}getTimeout(e){var t;return null===(t=JSON.parse(this.sessionStorage.getItem(this.workspaceHibernationNamespace)).find((t=>t.workspaceId===e)))||void 0===t?void 0:t.timeout}removeTimeout(e){const t=JSON.parse(this.sessionStorage.getItem(this.workspaceHibernationNamespace));t.find((t=>t.workspaceId===e))&&this.sessionStorage.setItem(this.workspaceHibernationNamespace,JSON.stringify(t.filter((t=>t.workspaceId!==e))))}saveTimeout(e,t){const n=JSON.parse(this.sessionStorage.getItem(this.workspaceHibernationNamespace));n.some((t=>t.workspaceId===e))||(n.push({workspaceId:e,timeout:t}),this.sessionStorage.setItem(this.workspaceHibernationNamespace,JSON.stringify(n)))}exportClearTimeouts(){const e=JSON.parse(this.sessionStorage.getItem(this.workspaceHibernationNamespace));return this.sessionStorage.setItem(this.workspaceHibernationNamespace,JSON.stringify([])),e}getAllApps(e){const t="remote"===e?this.appDefsNamespace:this.appDefsInmemoryNamespace;return JSON.parse(this.sessionStorage.getItem(t))}overwriteApps(e,t){const n="remote"===t?this.appDefsNamespace:this.appDefsInmemoryNamespace;this.sessionStorage.setItem(n,JSON.stringify(e))}removeApp(e,t){const n="remote"===t?this.appDefsNamespace:this.appDefsInmemoryNamespace,r=this.getAllApps(t),i=r.find((t=>t.name===e));return i&&this.sessionStorage.setItem(n,JSON.stringify(r.filter((t=>t.name!==e)))),i}getLayoutSnapshot(e){const t="Global"===e?this.globalLayoutsNamespace:this.workspaceLayoutsNamespace;return{layouts:JSON.parse(this.sessionStorage.getItem(t))}}saveLayoutSnapshot(e,t){const n="Global"===t?this.globalLayoutsNamespace:this.workspaceLayoutsNamespace;this.sessionStorage.setItem(n,JSON.stringify(e.layouts))}saveFrameData(e){const t=JSON.parse(this.sessionStorage.getItem(this.workspaceFramesNamespace));t.some((t=>t.windowId===e.windowId))||(t.push(e),this.sessionStorage.setItem(this.workspaceFramesNamespace,JSON.stringify(t)))}getPlatformFrame(){return this.getAllFrames().find((e=>e.isPlatform))}getAllFrames(){return JSON.parse(this.sessionStorage.getItem(this.workspaceFramesNamespace))}getFrameData(e){return JSON.parse(this.sessionStorage.getItem(this.workspaceFramesNamespace)).find((t=>t.windowId===e))}setFrameActive(e){const t=JSON.parse(this.sessionStorage.getItem(this.workspaceFramesNamespace)),n=t.find((t=>t.windowId===e));n&&!n.active&&(n.active=!0,this.sessionStorage.setItem(this.workspaceFramesNamespace,JSON.stringify(t)))}removeFrameData(e){return!!e&&this.doRemove(e,this.workspaceFramesNamespace)}saveWorkspaceClient(e){const t=JSON.parse(this.sessionStorage.getItem(this.workspaceWindowsNamespace));t.some((t=>t.windowId===e.windowId))||(t.push(e),this.sessionStorage.setItem(this.workspaceWindowsNamespace,JSON.stringify(t)))}getWorkspaceClientById(e){return JSON.parse(this.sessionStorage.getItem(this.workspaceWindowsNamespace)).find((t=>t.windowId===e))}pickWorkspaceClients(e){return JSON.parse(this.sessionStorage.getItem(this.workspaceWindowsNamespace)).filter(e)}removeWorkspaceClient(e){return!!e&&this.doRemove(e,this.workspaceWindowsNamespace)}getAllNonGlue(){return JSON.parse(this.sessionStorage.getItem(this.nonGlueNamespace))}saveNonGlue(e){var t,n;const r=JSON.parse(this.sessionStorage.getItem(this.nonGlueNamespace));return r.some((t=>t.windowId===e.windowId))?(null===(t=this.logger)||void 0===t||t.trace(`did not save this data: ${JSON.stringify(e)}, because an entry with this id already exists`),!1):(null===(n=this.logger)||void 0===n||n.trace(`saving non glue window with id: ${e.windowId}`),r.push(e),this.sessionStorage.setItem(this.nonGlueNamespace,JSON.stringify(r)),!0)}removeNonGlue(e){var t;return!(!e||!e.windowId)&&(null===(t=this.logger)||void 0===t||t.trace(`removing non glue window with id: ${e.windowId}`),this.doRemove(e.windowId,this.nonGlueNamespace))}saveBridgeInstanceData(e){var t,n;const r=JSON.parse(this.sessionStorage.getItem(this.bridgeInstancesNamespace));r.some((t=>t.windowId===e.windowId))?null===(t=this.logger)||void 0===t||t.trace(`did not save this data: ${JSON.stringify(e)}, because an entry with this id already exists`):(null===(n=this.logger)||void 0===n||n.trace(`saving new instance with id: ${e.windowId} and app name: ${e.appName}`),r.push(e),this.sessionStorage.setItem(this.bridgeInstancesNamespace,JSON.stringify(r)))}getBridgeInstanceData(e){return JSON.parse(this.sessionStorage.getItem(this.bridgeInstancesNamespace)).find((t=>t.windowId===e))}removeBridgeInstanceData(e){const t=JSON.parse(this.sessionStorage.getItem(this.bridgeInstancesNamespace));this.sessionStorage.setItem(this.bridgeInstancesNamespace,JSON.stringify(t.filter((t=>t.windowId!==e))))}saveInstanceData(e){var t,n;const r=JSON.parse(this.sessionStorage.getItem(this.instancesNamespace));r.some((t=>t.id===e.id))?null===(t=this.logger)||void 0===t||t.trace(`did not save this data: ${JSON.stringify(e)}, because an entry with this id already exists`):(null===(n=this.logger)||void 0===n||n.trace(`saving new instance with id: ${e.id} and app name: ${e.applicationName}`),r.push(e),this.sessionStorage.setItem(this.instancesNamespace,JSON.stringify(r)))}removeInstance(e){var t;null===(t=this.logger)||void 0===t||t.trace(`removing instance with id: ${e}`);const n=this.getAllInstancesData();this.sessionStorage.setItem(this.instancesNamespace,JSON.stringify(n.filter((t=>t.id!==e)))),this.removeBridgeInstanceData(e)}getInstanceData(e){return this.getAllInstancesData().find((t=>t.id===e))}getAllInstancesData(){return JSON.parse(this.sessionStorage.getItem(this.instancesNamespace))}removeNotification(e){const t=JSON.parse(this.sessionStorage.getItem(this.notificationsNamespace));t.find((t=>t.id===e))&&this.sessionStorage.setItem(this.notificationsNamespace,JSON.stringify(t.filter((t=>t.id!==e))))}saveNewNotification(e){var t;const n=JSON.parse(this.sessionStorage.getItem(this.notificationsNamespace));if(n.some((t=>t.id===e.id)))throw new Error(`Notification with id ${e.id} already exists`);null===(t=this.logger)||void 0===t||t.trace(`saving notification with id: ${e.id}`),n.push(e),this.sessionStorage.setItem(this.notificationsNamespace,JSON.stringify(n))}updateNotification(e){var t;const n=this.getAllNotifications(),r=n.findIndex((t=>t.id===e.id));if(-1===r)throw new Error(`Notification with id ${e.id} does not exist`);null===(t=this.logger)||void 0===t||t.trace(`updating notification with id: ${e.id}`),n[r]=e,this.sessionStorage.setItem(this.notificationsNamespace,JSON.stringify(n))}getNotification(e){return this.getAllNotifications().find((t=>t.id===e))}getAllNotifications(){return JSON.parse(this.sessionStorage.getItem(this.notificationsNamespace))}saveWindowData(e){var t,n;const r=JSON.parse(this.sessionStorage.getItem(this.windowsNamespace));r.some((t=>t.name===e.name))?null===(t=this.logger)||void 0===t||t.trace(`did not save this data: ${JSON.stringify(e)}, because an entry with this name already exists`):(null===(n=this.logger)||void 0===n||n.trace(`saving window with id: ${e.windowId} and name: ${e.name}`),r.push(e),this.sessionStorage.setItem(this.windowsNamespace,JSON.stringify(r)))}getAllWindowsData(){return JSON.parse(this.sessionStorage.getItem(this.windowsNamespace))}getWindowDataById(e){return this.getAllWindowsData().find((t=>t.windowId===e))}getWindowDataByName(e){return this.getAllWindowsData().find((t=>t.name===e))}removeWindowData(e){var t;return!!e&&(null===(t=this.logger)||void 0===t||t.trace(`removing window with id: ${e}`),this.doRemove(e,this.windowsNamespace))}fullWindowClean(e){const t=this.removeWindowData(e),n=this.removeNonGlue({windowId:e}),r=this.removeWorkspaceClient(e);return t||n||r}doRemove(e,t){const n=JSON.parse(this.sessionStorage.getItem(t)).reduce(((t,n)=>(n.windowId===e?t.removed=!0:t.newData.push(n),t)),{removed:!1,newData:[]});return this.sessionStorage.setItem(t,JSON.stringify(n.newData)),n.removed}}class WindowsStateController{constructor(e){this.sessionStorage=e,this.registry=CallbackRegistryFactory(),this.checkIntervalMs=500,this.childrenToCheck=[],this.checkerCancelled=!1}get logger(){return logger.get("state.controller")}start(){this.checkerCancelled=!1;this.sessionStorage.getAllNonGlue().forEach((e=>{var t;null===(t=this.logger)||void 0===t||t.trace(`detected non glue window with id ${e.windowId} from previous session, attempting reference refresh`);const n=window.open(void 0,e.windowId);n&&this.childrenToCheck.push({window:n,windowId:e.windowId})})),this.checkWindows()}add(e,t){var n;null===(n=this.logger)||void 0===n||n.trace(`adding window id: ${t} to non glue state checking`);this.sessionStorage.saveNonGlue({windowId:t})&&this.childrenToCheck.push({window:e,windowId:t})}remove(e){var t;null===(t=this.logger)||void 0===t||t.trace(`removing window id: ${e} from non glue state checking`),this.sessionStorage.removeNonGlue({windowId:e}),this.childrenToCheck=this.childrenToCheck.filter((t=>t.windowId!==e))}cancel(){this.currentTimeout&&clearTimeout(this.currentTimeout),this.checkerCancelled=!0,this.registry.clear()}onWindowDisappeared(e){return this.registry.add("window-disappear",e)}checkWindows(){this.checkerCancelled||(this.childrenToCheck.forEach((e=>{var t;if(!e.window||e.window.closed)return null===(t=this.logger)||void 0===t||t.trace(`non glue window ${e.windowId} has disappeared, removing from collections and announcing.`),this.remove(e.windowId),void this.registry.execute("window-disappear",e.windowId)})),this.currentTimeout=setTimeout(this.checkWindows.bind(this),this.checkIntervalMs))}}const appManagerOperationTypesDecoder=oneOf$1(constant$1("appHello"),constant$1("applicationStart"),constant$1("instanceStop"),constant$1("registerWorkspaceApp"),constant$1("unregisterWorkspaceApp"),constant$1("export"),constant$1("import"),constant$1("remove"),constant$1("clear"),constant$1("registerRemoteApps"),constant$1("operationCheck")),basicInstanceDataDecoder=object$1({id:nonEmptyStringDecoder$1}),instanceDataDecoder=object$1({id:nonEmptyStringDecoder$1,applicationName:nonEmptyStringDecoder$1}),applicationDataDecoder=object$1({name:nonEmptyStringDecoder$1,type:nonEmptyStringDecoder$1.where((e=>"window"===e),"Expected a value of window"),createOptions:applicationDetailsDecoder,instances:array$1(instanceDataDecoder),userProperties:optional$1(anyJson$1()),title:optional$1(nonEmptyStringDecoder$1),version:optional$1(nonEmptyStringDecoder$1),icon:optional$1(nonEmptyStringDecoder$1),caption:optional$1(nonEmptyStringDecoder$1)});object$1({name:nonEmptyStringDecoder$1,type:nonEmptyStringDecoder$1.where((e=>"window"===e),"Expected a value of window"),createOptions:applicationDetailsDecoder,userProperties:optional$1(anyJson$1()),title:optional$1(nonEmptyStringDecoder$1),version:optional$1(nonEmptyStringDecoder$1),icon:optional$1(nonEmptyStringDecoder$1),caption:optional$1(nonEmptyStringDecoder$1)});const appHelloSuccessDecoder=object$1({apps:array$1(applicationDataDecoder),initialChannelId:optional$1(nonEmptyStringDecoder$1)}),appHelloDecoder=object$1({windowId:optional$1(nonEmptyStringDecoder$1)}),applicationStartConfigDecoder=object$1({name:nonEmptyStringDecoder$1,id:optional$1(nonEmptyStringDecoder$1),context:optional$1(anyJson$1()),top:optional$1(number$1()),left:optional$1(number$1()),width:optional$1(nonNegativeNumberDecoder$1),height:optional$1(nonNegativeNumberDecoder$1),relativeTo:optional$1(nonEmptyStringDecoder$1),relativeDirection:optional$1(oneOf$1(constant$1("top"),constant$1("left"),constant$1("right"),constant$1("bottom"))),waitForAGMReady:optional$1(boolean()),forceChromeTab:optional$1(boolean()),layoutComponentId:optional$1(nonEmptyStringDecoder$1),channelId:optional$1(nonEmptyStringDecoder$1)}),appsImportOperationDecoder=object$1({definitions:array$1(allApplicationDefinitionsDecoder),mode:oneOf$1(constant$1("replace"),constant$1("merge"))}),appRemoveConfigDecoder=object$1({name:nonEmptyStringDecoder$1}),appsExportOperationDecoder=object$1({definitions:array$1(glueCoreAppDefinitionDecoder)}),appsRemoteRegistrationDecoder=object$1({definitions:array$1(allApplicationDefinitionsDecoder)});class ApplicationsController{constructor(e,t,n,r,i){this.glueController=e,this.sessionStorage=t,this.stateController=n,this.appDirectory=r,this.ioc=i,this.applicationStartTimeoutMs=15e3,this.started=!1,this.locks={},this.operations={appHello:{name:"appHello",dataDecoder:appHelloDecoder,resultDecoder:appHelloSuccessDecoder,execute:this.handleAppHello.bind(this)},applicationStart:{name:"applicationStart",dataDecoder:applicationStartConfigDecoder,resultDecoder:instanceDataDecoder,execute:this.handleApplicationStart.bind(this)},instanceStop:{name:"instanceStop",dataDecoder:basicInstanceDataDecoder,execute:this.handleInstanceStop.bind(this)},registerWorkspaceApp:{name:"registerWorkspaceApp",dataDecoder:workspaceWindowDataDecoder,execute:this.registerWorkspaceApp.bind(this)},unregisterWorkspaceApp:{name:"unregisterWorkspaceApp",dataDecoder:simpleWindowDecoder,execute:this.unregisterWorkspaceApp.bind(this)},import:{name:"import",dataDecoder:appsImportOperationDecoder,execute:this.handleImport.bind(this)},remove:{name:"remove",dataDecoder:appRemoveConfigDecoder,execute:this.handleRemove.bind(this)},export:{name:"export",resultDecoder:appsExportOperationDecoder,execute:this.handleExport.bind(this)},clear:{name:"clear",execute:this.handleClear.bind(this)},registerRemoteApps:{name:"registerRemoteApps",dataDecoder:appsRemoteRegistrationDecoder,execute:this.handleRegisterRemoteApps.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)}}}get logger(){return logger.get("applications.controller")}handlePlatformShutdown(){this.locks={},this.started=!1,this.appDirectory.stop()}start(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){this.defaultBounds=e.windows.defaultWindowOpenBounds,null===(t=this.logger)||void 0===t||t.trace("initializing applications"),this.config=e.applications,yield this.appDirectory.start({config:e.applications,appsStateChange:e=>this.emitStreamData("appDirectoryStateChange",e),sequelizer:this.ioc.createSequelizer()}),this.started=!0,this.stateController.onWindowDisappeared(this.processInstanceClosed.bind(this)),null===(n=this.logger)||void 0===n||n.trace("initialization is completed")}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this windows control message, because the controller has not been started");const o=e.data,l=e.commandId,s=appManagerOperationTypesDecoder.run(e.operation);if(!s.ok)throw new Error(`This appManager request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`AppManager request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`AppManager request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleClientUnloaded(e,t){var n,r,i;if(null===(n=this.logger)||void 0===n||n.trace(`handling unloading of ${e}`),e)return!t||t.closed?(null===(r=this.logger)||void 0===r||r.trace(`${e} detected as closed, processing instance closed`),this.processInstanceClosed(e)):void(null===(i=this.logger)||void 0===i||i.trace(`${e} detected as not closed, skipping instance closed procedure`))}unregisterWorkspaceApp(e){return __awaiter$7(this,void 0,void 0,(function*(){this.processInstanceClosed(e.windowId),this.ioc.windowsController.cleanUpWindow(e.windowId),this.ioc.portsBridge.removeGwClient(e.windowId)}))}handleApplicationStart(e,t){var n,r,i,o,l,s,a,u;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling application start command for application: ${e.name}`);const c=(yield this.appDirectory.getAll()).find((t=>t.name===e.name));if(!c)throw new Error(`Cannot start an instance of application: ${e.name}, because it is not found.`);const h={id:null!==(r=e.id)&&void 0!==r?r:`g42-${shortid$2.generate()}`,applicationName:e.name},d=yield this.getStartingBounds(c.createOptions,e,t),f=e.forceChromeTab?void 0:`left=${d.left},top=${d.top},width=${d.width},height=${d.height}`;null===(i=this.logger)||void 0===i||i.trace(`[${t}] open arguments are valid, opening to bounds: ${f}`);const p=window.open(c.createOptions.url,h.id,f);if(!p)throw new Error(`Cannot an instance with url: ${c.createOptions.url} for application: ${e.name}. The most likely reason is that the user has not approved popups or has a blocker.`);this.sessionStorage.saveBridgeInstanceData({windowId:h.id,appName:h.applicationName});const g={data:h,context:e.context};if(yield this.processNewInstance(g),null===(o=this.logger)||void 0===o||o.trace(`[${t}] the new window has been opened successfully with id: ${h.id}, checking for AGM ready and notifying windows`),e.waitForAGMReady&&(null===(l=this.logger)||void 0===l||l.trace(`[${t}] wait for AGM is set, configuring the lock`),this.setLock(h.id)),yield this.notifyWindows(c.createOptions.url,h,d,e.context,p,e.layoutComponentId,e.channelId),this.locks[h.id])try{yield PromiseWrap((()=>{var e;return null===(e=this.locks[h.id])||void 0===e?void 0:e.keyOne}),this.applicationStartTimeoutMs)}catch(t){throw delete this.locks[h.id],new Error(`Application start for ${e.name} timed out waiting for client to initialize Glue`)}return null===(s=this.logger)||void 0===s||s.trace(`[${t}] the windows controller has been successfully notified`),null===(a=this.logger)||void 0===a||a.trace(`[${t}] the new instance with id ${h.id} has been saved, announced and context set, lifting key two and responding to caller`),null===(u=this.locks[h.id])||void 0===u||u.openKeyTwo(),h}))}processInstanceClosed(e){if(!e)return;const t=this.sessionStorage.getInstanceData(e);t&&(delete this.locks[t.id],this.glueController.clearContext(e,"instance").catch((()=>{})),this.sessionStorage.removeInstance(t.id),this.emitStreamData("instanceStopped",t))}notifyWindows(e,t,n,r,i,o,l){return __awaiter$7(this,void 0,void 0,(function*(){const s={windowId:t.id,name:`${t.applicationName}_${t.id}`,initialUrl:e,initialContext:r,initialBounds:n,layoutComponentId:o,initialChannelId:l};yield this.ioc.windowsController.processNewWindow(s,r,i)}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}handleAppHello(e,t){var n,r,i,o,l;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling hello message for id: ${e.windowId}`),e.windowId&&this.locks[e.windowId]&&(null===(r=this.logger)||void 0===r||r.trace(`[${t}] found an app lock, unlocking key one and waiting for the second one`),this.locks[e.windowId].openKeyOne(),yield this.locks[e.windowId].keyTwo,delete this.locks[e.windowId],null===(i=this.logger)||void 0===i||i.trace(`[${t}] the lock is lifted, proceeding`));const s=this.sessionStorage.getAllInstancesData(),a=(yield this.appDirectory.getAll()).map((e=>{const t=s.filter((t=>t.applicationName===e.name));return Object.assign({},e,{instances:t})}));if(e.windowId){null===(o=this.logger)||void 0===o||o.trace(`[${t}] there is a valid windowId, removing ${e.windowId} from the state controller`),this.stateController.remove(e.windowId);const n=a.find((t=>t.instances.some((t=>t.id===e.windowId))));if(n&&n.title){const r=e.windowId,i=n.title;PromiseWrap((()=>this.glueController.callWindow("windows",this.ioc.windowsController.setTitleOperation,{windowId:r,title:i},{windowId:r})),2e4).catch((e=>{var n;return null===(n=this.logger)||void 0===n?void 0:n.trace(`[${t}] error while setting the application instance title: ${e.message}`)}))}}const u=e.windowId?this.sessionStorage.getWindowDataById(e.windowId):void 0,c={apps:a,initialChannelId:null==u?void 0:u.initialChannelId};return null===(l=this.logger)||void 0===l||l.trace(`[${t}] compiled a list of all active applications and instances and returning it to the caller`),c}))}handleInstanceStop(e,t){var n,r,i,o;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling stop command for instance: ${e.id}`);if(this.sessionStorage.getWorkspaceClientById(e.id))return null===(r=this.logger)||void 0===r||r.trace(`[${t}] this instance is detected as a workspace window, closing via the workspaces controller`),void(yield this.ioc.workspacesController.closeItem({itemId:e.id},t));if(!this.sessionStorage.getInstanceData(e.id))throw new Error(`Cannot close instance: ${e.id}, because it is not known by the platform`);const l=this.sessionStorage.getWindowDataById(e.id);if(!l)throw new Error(`Cannot close instance: ${e.id}, because it's window is not known by the platform`);null===(i=window.open(void 0,l.windowId))||void 0===i||i.close(),this.processInstanceClosed(e.id),this.ioc.windowsController.cleanUpWindow(e.id),null===(o=this.logger)||void 0===o||o.trace(`[${t}] instance ${e.id} has been closed, removed from store, announced stopped and notified windows, responding to caller`)}))}handleRegisterRemoteApps(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){if(null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling remote bypass command`),this.config.remote)throw new Error(`[${t}] cannot accept remote apps from the protocol, because there is an active remote configuration.`);yield this.appDirectory.processAppDefinitions(e.definitions,{mode:"replace",type:"remote"}),null===(r=this.logger)||void 0===r||r.trace(`[${t}] remote bypass command completed`)}))}handleImport(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling import command`),yield this.appDirectory.processAppDefinitions(e.definitions,{type:"inmemory",mode:e.mode}),null===(r=this.logger)||void 0===r||r.trace(`[${t}] import command completed`)}))}handleRemove(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling remove command for ${e.name}`);const i=yield this.appDirectory.removeInMemory(e.name);i&&(null===(r=this.logger)||void 0===r||r.trace(`definition ${i.name} removed successfully`),this.emitStreamData("appDirectoryStateChange",{appsRemoved:[i],appsAdded:[],appsChanged:[]}))}))}handleExport(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling export command`);const e=yield this.appDirectory.exportInMemory();return null===(r=this.logger)||void 0===r||r.trace(`[${t}] export command successful`),{definitions:e}}))}handleClear(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling clear command`),yield this.appDirectory.processAppDefinitions([],{type:"inmemory",mode:"replace"}),null===(r=this.logger)||void 0===r||r.trace(`[${t}] all in-memory apps are cleared`)}))}setLock(e){const t={},n=new Promise((e=>{t.openKeyOne=e})),r=new Promise((e=>{t.openKeyTwo=e}));t.keyOne=n,t.keyTwo=r,this.locks[e]=t}registerWorkspaceApp(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){if(!e.appName)throw new Error(`Cannot register application with config: ${JSON.stringify(e)}, because no app name was found`);const i=yield this.appDirectory.getAll();if(e.appName===defaultNoAppWindowComponentAppName$1)return yield this.ioc.windowsController.registerWorkspaceWindow(e,t);if(!i.some((t=>t.name===e.appName)))throw new Error(`Cannot register application with config: ${JSON.stringify(e)}, because no app with this name name was found`);this.sessionStorage.saveBridgeInstanceData({windowId:e.windowId,appName:e.appName}),null===(n=this.logger)||void 0===n||n.trace(`[${t}] processing valid workspace application registration with id ${e.windowId}, app name ${e.appName} and frame ${e.frameId}`),e.context&&(yield this.glueController.setStartContext(e.windowId,e.context,"instance"));const o={id:e.windowId,applicationName:e.appName};this.sessionStorage.saveInstanceData(o),this.emitStreamData("instanceStarted",o),null===(r=this.logger)||void 0===r||r.trace(`[${t}] instance registration is completed and announced, calling windows registration`),yield this.ioc.windowsController.registerWorkspaceWindow(e,t)}))}processNewInstance(e){return __awaiter$7(this,void 0,void 0,(function*(){e.context&&(yield this.glueController.setStartContext(e.data.id,e.context,"instance")),this.sessionStorage.saveInstanceData(e.data),this.emitStreamData("instanceStarted",e.data)}))}emitStreamData(e,t){var n;null===(n=this.logger)||void 0===n||n.trace(`sending notification of event: ${e} with data: ${JSON.stringify(t)}`),this.glueController.pushSystemMessage("appManager",e,t)}getStartingBounds(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){const i={top:t.top||e.top||this.defaultBounds.top,left:t.left||e.left||this.defaultBounds.left,width:t.width||e.width||this.defaultBounds.width,height:t.height||e.height||this.defaultBounds.height};if(!t.relativeTo)return i;try{const e=yield this.ioc.windowsController.getWindowBounds(t.relativeTo,n),o=null!==(r=t.relativeDirection)&&void 0!==r?r:"right";return getRelativeBounds(i,e,o)}catch(e){return i}}))}}const layoutsOperationTypesDecoder=oneOf$1(constant$1("get"),constant$1("getAll"),constant$1("export"),constant$1("import"),constant$1("remove"),constant$1("save"),constant$1("restore"),constant$1("getGlobalPermissionState"),constant$1("checkGlobalActivated"),constant$1("requestGlobalPermission"),constant$1("operationCheck"),constant$1("getDefaultGlobal"),constant$1("setDefaultGlobal"),constant$1("clearDefaultGlobal")),newLayoutOptionsDecoder=object$1({name:nonEmptyStringDecoder$1,context:optional$1(anyJson$1()),metadata:optional$1(anyJson$1()),instances:optional$1(array$1(nonEmptyStringDecoder$1)),ignoreInstances:optional$1(array$1(nonEmptyStringDecoder$1))}),restoreOptionsDecoder=object$1({name:nonEmptyStringDecoder$1,context:optional$1(anyJson$1()),closeRunningInstance:optional$1(boolean()),closeMe:optional$1(boolean()),timeout:optional$1(nonNegativeNumberDecoder$1)}),simpleLayoutConfigDecoder=object$1({name:nonEmptyStringDecoder$1,type:layoutTypeDecoder}),getAllLayoutsConfigDecoder=object$1({type:layoutTypeDecoder}),saveLayoutConfigDecoder=object$1({layout:newLayoutOptionsDecoder}),restoreLayoutConfigDecoder=object$1({layout:restoreOptionsDecoder}),allLayoutsFullConfigDecoder=object$1({layouts:array$1(glueLayoutDecoder)}),importModeDecoder=oneOf$1(constant$1("replace"),constant$1("merge")),layoutsImportConfigDecoder=object$1({layouts:array$1(glueLayoutDecoder),mode:importModeDecoder,isManagerOperation:optional$1(boolean())}),allLayoutsSummariesResultDecoder=object$1({summaries:array$1(layoutSummaryDecoder$1)});object$1({layout:glueLayoutDecoder});const optionalSimpleLayoutResult=object$1({layout:optional$1(glueLayoutDecoder)}),setDefaultGlobalConfigDecoder=object$1({name:nonEmptyStringDecoder$1});object$1({layoutType:oneOf$1(constant$1("Global"),constant$1("Workspace")),layoutName:nonEmptyStringDecoder$1,context:optional$1(anyJson$1()),instances:optional$1(array$1(nonEmptyStringDecoder$1)),ignoreInstances:optional$1(array$1(nonEmptyStringDecoder$1))}),object$1({windowContext:optional$1(anyJson$1())});const fullSaveRequestResponseDecoder=object$1({bounds:windowBoundsDecoder,windowContext:optional$1(anyJson$1()),url:nonEmptyStringDecoder$1,name:nonEmptyStringDecoder$1,application:nonEmptyStringDecoder$1,windowId:nonEmptyStringDecoder$1,initialContext:optional$1(anyJson$1())});object$1({windowContext:optional$1(anyJson$1()),windowId:nonEmptyStringDecoder$1,frameId:nonEmptyStringDecoder$1}),object$1({windows:array$1(fullSaveRequestResponseDecoder)});const permissionStateResultDecoder=object$1({state:oneOf$1(constant$1("prompt"),constant$1("denied"),constant$1("granted"))}),simpleAvailabilityResultDecoder=object$1({isAvailable:boolean()}),defaultNoAppWindowComponentAppName="no-app-window",defaultPermissionTimeoutMS=25e3;class LayoutsController{constructor(e,t,n,r,i,o,l,s){this.glueController=e,this.idbController=t,this.sessionStore=n,this.localStore=r,this.globalBuilder=i,this.globalRestorer=o,this.registry=l,this.getManager=s,this.started=!1,this.operations={get:{name:"get",dataDecoder:simpleLayoutConfigDecoder,resultDecoder:optionalSimpleLayoutResult,execute:this.handleGetLayout.bind(this)},getAll:{name:"getAll",dataDecoder:getAllLayoutsConfigDecoder,resultDecoder:allLayoutsSummariesResultDecoder,execute:this.handleGetAll.bind(this)},export:{name:"export",dataDecoder:getAllLayoutsConfigDecoder,resultDecoder:allLayoutsFullConfigDecoder,execute:this.handleExport.bind(this)},import:{name:"import",dataDecoder:layoutsImportConfigDecoder,execute:this.handleImport.bind(this)},remove:{name:"remove",dataDecoder:simpleLayoutConfigDecoder,execute:this.handleRemove.bind(this)},save:{name:"save",dataDecoder:saveLayoutConfigDecoder,execute:this.handleSave.bind(this)},restore:{name:"restore",dataDecoder:restoreLayoutConfigDecoder,execute:this.handleRestore.bind(this)},getGlobalPermissionState:{name:"getGlobalPermissionState",resultDecoder:permissionStateResultDecoder,execute:this.handleGetGlobalPermissionState.bind(this)},requestGlobalPermission:{name:"requestGlobalPermission",resultDecoder:simpleAvailabilityResultDecoder,execute:this.handleRequestGlobalPermission.bind(this)},checkGlobalActivated:{name:"checkGlobalActivated",resultDecoder:simpleAvailabilityResultDecoder,execute:this.handleCheckGlobalActivated.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)},getDefaultGlobal:{name:"getDefaultGlobal",resultDecoder:optionalSimpleLayoutResult,execute:this.handleGetDefaultGlobal.bind(this)},setDefaultGlobal:{name:"setDefaultGlobal",dataDecoder:setDefaultGlobalConfigDecoder,execute:this.handleSetDefaultGlobal.bind(this)},clearDefaultGlobal:{name:"clearDefaultGlobal",execute:this.handleClearDefaultGlobal.bind(this)}}}get logger(){return logger.get("layouts.controller")}handlePlatformShutdown(){this.started=!1,this.registry.clear(),"idb"===this.config.mode&&(this.idbController.clearLayouts("Global").catch((e=>{var t;return null===(t=this.logger)||void 0===t?void 0:t.warn(extractErrorMsg$1(e))})),this.idbController.clearLayouts("Workspace").catch((e=>{var t;return null===(t=this.logger)||void 0===t?void 0:t.warn(extractErrorMsg$1(e))})))}start(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){if(this.config=e.layouts,null===(t=this.logger)||void 0===t||t.trace(`initializing with mode: ${this.config.mode}`),this.config.local&&this.config.local.length){const e=this.config.local.filter((e=>"Global"===e.type)),t=this.config.local.filter((e=>"Workspace"===e.type));yield Promise.all([this.mergeImport(e,"Global"),this.mergeImport(t,"Workspace")])}this.manager=this.getManager(),this.started=!0,null===(n=this.logger)||void 0===n||n.trace("initialization is completed")}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this windows control message, because the controller has not been started");const o=e.data,l=e.commandId,s=layoutsOperationTypesDecoder.run(e.operation);if(!s.ok)throw new Error(`This layouts request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Layouts request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l,e.callerId,e.callerType),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Layouts request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleSave(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling save layout with config: ${JSON.stringify(e)}`),yield this.checkRequestPermission("save"),null===(r=this.logger)||void 0===r||r.trace(`[${t}] the required permissions are granted, proceeding.`);const o=yield this.globalBuilder.saveGlobalLayout(e,t);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] layout ${e.layout.name} was saved successfully`),{layout:o}}))}handleRestore(e,t,n,r){var i,o;return __awaiter$7(this,void 0,void 0,(function*(){null===(i=this.logger)||void 0===i||i.trace(`[${t}] handling restore layout with config: ${JSON.stringify(e)}`),yield this.checkRequestPermission("restore",e.layout.timeout),yield this.globalRestorer.restoreGlobalLayout(e,t,n,r),null===(o=this.logger)||void 0===o||o.trace(`[${t}] layout ${e.layout.name} was restored successfully`)}))}handleGetAll(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling get all layout summaries request for type: ${e.type}`);const i=(yield this.getAll(e.type)).map((e=>({name:e.name,type:e.type,context:e.context,metadata:e.metadata})));return null===(r=this.logger)||void 0===r||r.trace(`[${t}] all summaries have been compiled, responding to caller`),{summaries:i}}))}handleExport(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling get all layout full request for type: ${e.type}`);const i=yield this.getAll(e.type);return null===(r=this.logger)||void 0===r||r.trace(`[${t}] full layouts collection have been compiled, responding to caller`),{layouts:i}}))}handleImport(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling mass import request for layout names: ${e.layouts.map((e=>e.name)).join(", ")}`);const o="merge"===e.mode?this.mergeImport.bind(this):this.replaceImport.bind(this);null===(r=this.logger)||void 0===r||r.trace(`[${t}] importing the layouts in ${e.mode} mode`);const l=e.layouts.filter((e=>"Workspace"===e.type)),s=e.layouts.filter((e=>"Global"===e.type));yield Promise.all([o(s,"Global",e.isManagerOperation),o(l,"Workspace",e.isManagerOperation)]),null===(i=this.logger)||void 0===i||i.trace(`[${t}] mass import completed, responding to caller`)}))}handleRemove(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling remove request for ${JSON.stringify(e)}`);const i=(yield this.getAll(e.type)).find((t=>t.name===e.name&&t.type===e.type));i&&(yield this.delete(e.name,e.type),this.emitStreamData("layoutRemoved",i));const o=i?"has been removed":"has not been removed, because it does not exist";null===(r=this.logger)||void 0===r||r.trace(`[${t}] ${e.name} of type ${e.type} ${o}`)}))}handleGetLayout(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling get layout request for name: ${e.name} and type: ${e.type}`);const i=(yield this.getAll(e.type)).find((t=>t.name===e.name));return null===(r=this.logger)||void 0===r||r.trace(`[${t}] request completed, responding to the caller`),{layout:i}}))}onUserLayoutEvent(e){return this.registry.add("layoutEvent",e)}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}handleGetGlobalPermissionState(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Get Global Permission State request`);const{state:e}=yield navigator.permissions.query({name:"window-placement"});return null===(r=this.logger)||void 0===r||r.trace(`[${t}] request completed with state: ${e}, responding to the caller`),{state:e}}))}handleRequestGlobalPermission(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Request Global Permission command`);const{state:e}=yield navigator.permissions.query({name:"window-placement"});if("granted"===e)return{isAvailable:!0};if("denied"===e)return{isAvailable:!1};try{return yield window.getScreenDetails(),null===(r=this.logger)||void 0===r||r.trace(`[${t}] request completed, responding to the caller`),{isAvailable:!0}}catch(e){return null===(i=this.logger)||void 0===i||i.trace(`[${t}] request completed, responding to the caller`),{isAvailable:!1}}}))}handleCheckGlobalActivated(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){return null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Check Global Activated request`),null===(r=this.logger)||void 0===r||r.trace(`[${t}] request completed, responding to the caller`),{isAvailable:!0}}))}createGetDefaultGlobalLogMessage(e,t){return t?`[${e}] request completed, responding to the caller with layout with name ${t}`:`[${e}] request completed, no default global layout found, responding to the caller`}handleGetDefaultGlobal(e,t){var n,r,i,o,l,s;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Get Default Global request`);const e=this.localStore.getDefaultGlobalLayoutName(),a=yield this.getAll("Global");if(!this.manager.isStarted)return null===(r=this.logger)||void 0===r||r.trace(this.createGetDefaultGlobalLogMessage(t,e)),{layout:a.find((t=>t.name===e))};try{const n=null===(i=yield this.manager.getDefaultGlobal(t))||void 0===i?void 0:i.name;return n&&n!==e&&this.localStore.saveDefaultGlobalLayout(n),null===(o=this.logger)||void 0===o||o.trace(this.createGetDefaultGlobalLogMessage(t,n)),{layout:a.find((e=>e.name===n))}}catch(n){if(this.manager.isCritical)throw new Error(n);return null===(l=this.logger)||void 0===l||l.trace(`[${t}] ${n}`),null===(s=this.logger)||void 0===s||s.trace(this.createGetDefaultGlobalLogMessage(t,e)),{layout:a.find((t=>t.name===e))}}}))}handleSetDefaultGlobal(e,t){var n,r,i,o;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Set Default Global request for name: ${e.name}`);const l=(yield this.getAll("Global")).find((t=>t.name===e.name)),s=`[${t}] request completed for global layout with name ${e.name}, responding to the caller`;if(!l)throw new Error(`Layout ${e.name} does not exist`);if(this.localStore.saveDefaultGlobalLayout(e.name),this.manager.isStarted){try{(yield this.manager.getLayoutId(e.name))?yield this.manager.setDefaultGlobal(e.name,t):yield this.manager.saveLayout(l,{default:!0})}catch(e){if(this.manager.isCritical)throw new Error(e);null===(i=this.logger)||void 0===i||i.trace(`[${t}] ${e}`)}null===(o=this.logger)||void 0===o||o.trace(s)}else null===(r=this.logger)||void 0===r||r.trace(s)}))}handleClearDefaultGlobal(e,t){var n,r,i,o;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Clear Default Global request`),this.localStore.clearDefaultGlobalLayout();const e=`[${t}] request completed, responding to the caller`;if(this.manager.isStarted){try{yield this.manager.clearDefaultGlobal(t)}catch(e){if(this.manager.isCritical)throw new Error(e);null===(i=this.logger)||void 0===i||i.trace(`[${t}] ${e}`)}null===(o=this.logger)||void 0===o||o.trace(e)}else null===(r=this.logger)||void 0===r||r.trace(e)}))}emitStreamData(e,t,n){var r;null===(r=this.logger)||void 0===r||r.trace(`sending notification of event: ${e} with data: ${JSON.stringify(t)}`),this.glueController.pushSystemMessage("layouts",e,t),n||this.registry.execute("layoutEvent",{operation:e,layout:t})}mergeImport(e,t,n){var r,i;return __awaiter$7(this,void 0,void 0,(function*(){const o=yield this.getAll(t),l=[];for(const t of e){const e=o.findIndex((e=>e.name===t.name));e>-1&&!objEqual(t,o[e])?(null===(r=this.logger)||void 0===r||r.trace(`change detected at layout ${t.name}`),l.push({operation:"layoutChanged",layout:t}),o[e]=t):e<0&&(null===(i=this.logger)||void 0===i||i.trace(`new layout: ${t.name} detected, adding and announcing`),l.push({operation:"layoutAdded",layout:t}),o.push(t))}yield this.cleanSave(o,t),yield this.announceEvents(l,n)}))}replaceImport(e,t,n){var r,i;return __awaiter$7(this,void 0,void 0,(function*(){const o=yield this.getAll(t),l=[];for(const t of e){const e=o.findIndex((e=>e.name===t.name));e<0?(null===(r=this.logger)||void 0===r||r.trace(`new layout: ${t.name} detected, adding and announcing`),l.push({operation:"layoutAdded",layout:t})):(objEqual(t,o[e])||(null===(i=this.logger)||void 0===i||i.trace(`change detected at layout ${t.name}`),l.push({operation:"layoutChanged",layout:t})),o.splice(e,1))}o.forEach((e=>{var t;null===(t=this.logger)||void 0===t||t.trace(`layout ${e.name} missing, removing and announcing`),l.push({operation:"layoutRemoved",layout:e})})),yield this.cleanSave(e,t),yield this.announceEvents(l,n)}))}announceEvents(e,t){return __awaiter$7(this,void 0,void 0,(function*(){let n=0;for(const r of e)++n,n%10==0&&(yield this.waitEventFlush()),this.emitStreamData(r.operation,r.layout,t)}))}getAll(e){return __awaiter$7(this,void 0,void 0,(function*(){let t;return t="idb"===this.config.mode?yield this.idbController.getAllLayouts(e):this.sessionStore.getLayoutSnapshot(e).layouts,t}))}cleanSave(e,t){return __awaiter$7(this,void 0,void 0,(function*(){if("idb"!==this.config.mode)this.sessionStore.saveLayoutSnapshot({layouts:e},t);else{yield this.idbController.clearLayouts(t);for(const t of e)yield this.idbController.storeLayout(t,t.type)}}))}delete(e,t){return __awaiter$7(this,void 0,void 0,(function*(){if("idb"===this.config.mode)return void(yield this.idbController.deleteLayout(e,t));const n=this.sessionStore.getLayoutSnapshot(t).layouts,r=n.findIndex((t=>t.name===e));r>-1&&n.splice(r,1),this.sessionStore.saveLayoutSnapshot({layouts:n},t)}))}waitEventFlush(){return new Promise((e=>setTimeout(e,10)))}checkRequestPermission(e,t=defaultPermissionTimeoutMS){return __awaiter$7(this,void 0,void 0,(function*(){if(window.gtf)return;const{state:n}=yield navigator.permissions.query({name:"window-placement"});switch(n){case"granted":return;case"prompt":try{return void(yield PromiseWrap((()=>window.getScreenDetails()),t,"Timeout waiting for user permission for Multi-Screen Window Placement"))}catch(t){throw new Error(`Cannot complete operation ${e} for Global Layouts, because the user has not granted the Multi-Screen Window Placement permission`)}case"denied":throw new Error(`Cannot complete operation ${e} for Global Layouts, because the user has denied the Multi-Screen Window Placement permission`)}}))}}const instanceOfAny=(e,t)=>t.some((t=>e instanceof t));let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(wrap(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&cursorRequestMap.set(t,e)})).catch((()=>{})),reverseTransformCache.set(t,e),t}function cacheDonePromiseForTransaction(e){if(transactionDoneMap.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));transactionDoneMap.set(e,t)}let idbProxyTraps={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return transactionDoneMap.get(e);if("objectStoreNames"===t)return e.objectStoreNames||transactionStoreNamesMap.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return wrap(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function replaceTraps(e){idbProxyTraps=e(idbProxyTraps)}function wrapFunction(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?getCursorAdvanceMethods().includes(e)?function(...t){return e.apply(unwrap(this),t),wrap(cursorRequestMap.get(this))}:function(...t){return wrap(e.apply(unwrap(this),t))}:function(t,...n){const r=e.call(unwrap(this),t,...n);return transactionStoreNamesMap.set(r,t.sort?t.sort():[t]),wrap(r)}}function transformCachableValue(e){return"function"==typeof e?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes())?new Proxy(e,idbProxyTraps):e)}function wrap(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(transformCache.has(e))return transformCache.get(e);const t=transformCachableValue(e);return t!==e&&(transformCache.set(e,t),reverseTransformCache.set(t,e)),t}const unwrap=e=>reverseTransformCache.get(e);function openDB(e,t,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const l=indexedDB.open(e,t),s=wrap(l);return r&&l.addEventListener("upgradeneeded",(e=>{r(wrap(l.result),e.oldVersion,e.newVersion,wrap(l.transaction),e)})),n&&l.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),s.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),s}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(cachedMethods.get(t))return cachedMethods.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=writeMethods.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!readMethods.includes(n))return;const o=async function(e,...t){const o=this.transaction(e,i?"readwrite":"readonly");let l=o.store;return r&&(l=l.index(t.shift())),(await Promise.all([l[n](...t),i&&o.done]))[0]};return cachedMethods.set(t,o),o}replaceTraps((e=>({...e,get:(t,n,r)=>getMethod(t,n)||e.get(t,n,r),has:(t,n)=>!!getMethod(t,n)||e.has(t,n)})));class IDBController{constructor(){if(this.defaultDBName="glue42core",this.dbName=this.defaultDBName,this.dbVersion=3,this.globalLayoutsObjectStoreName="globalLayouts",this.prefsObjectStoreName="prefs",this.serviceWorkerObjectStoreName="serviceWorker",this.workspaceLayoutsObjectStoreName="workspaceLayouts",!("indexedDB"in window))throw new Error("Cannot initialize the local storage, because IndexedDB is not supported")}get database(){if(!this._database)throw new Error("There is no open database");return this._database}start(e){return __awaiter$7(this,void 0,void 0,(function*(){(null==e?void 0:e.username)&&(this.dbName=e.username);const t=yield openDB(this.dbName,this.dbVersion,{upgrade:this.setUpDB.bind(this)});this._database=t}))}stop(){this.database.close(),delete this._database,this.dbName=this.defaultDBName}getAllLayouts(e){switch(e){case"Workspace":return this.database.getAll(this.workspaceLayoutsObjectStoreName);case"Global":return this.database.getAll(this.globalLayoutsObjectStoreName);default:throw new Error(`The provided layout type is not recognized: ${e}`)}}deleteLayout(e,t){switch(t){case"Workspace":return this.database.delete(this.workspaceLayoutsObjectStoreName,e);case"Global":return this.database.delete(this.globalLayoutsObjectStoreName,e);default:throw new Error(`The provided layout type is not recognized: ${t}`)}}clearLayouts(e){switch(e){case"Workspace":return this.database.clear(this.workspaceLayoutsObjectStoreName);case"Global":return this.database.clear(this.globalLayoutsObjectStoreName);default:throw new Error(`The provided layout type is not recognized: ${e}`)}}getLayout(e,t){switch(t){case"Workspace":return this.database.get(this.workspaceLayoutsObjectStoreName,e);case"Global":return this.database.get(this.globalLayoutsObjectStoreName,e);default:throw new Error(`The provided layout type is not recognized: ${t}`)}}storeLayout(e,t){switch(glueLayoutDecoder.runWithException(e),layoutTypeDecoder.runWithException(t),t){case"Workspace":return this.database.put(this.workspaceLayoutsObjectStoreName,e,e.name);case"Global":return this.database.put(this.globalLayoutsObjectStoreName,e,e.name);default:throw new Error(`The provided layout type is not recognized: ${t}`)}}clearServiceWorker(){return this.database.clear(this.serviceWorkerObjectStoreName)}storeServiceWorker(e){return this.database.put(this.serviceWorkerObjectStoreName,e,"workerData")}clearAllPrefs(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=(yield this.getAllPrefs()).map((({app:t})=>({app:t,data:{},lastUpdate:e}))),n=this.database.transaction(this.prefsObjectStoreName,"readwrite");return yield Promise.all([...t.map((e=>n.store.put(e,e.app))),n.done]),t}))}getAllPrefs(){return this.database.getAll(this.prefsObjectStoreName)}getPrefs(e){return this.database.get(this.prefsObjectStoreName,e)}deletePrefs(e){return this.database.delete(this.prefsObjectStoreName,e)}replaceAllPrefs(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=this.database.transaction(this.prefsObjectStoreName,"readwrite");return yield t.store.clear(),yield Promise.all([...e.map((e=>t.store.put(e,e.app))),t.done]),e}))}setPrefs(e){return __awaiter$7(this,void 0,void 0,(function*(){return yield this.database.put(this.prefsObjectStoreName,e,e.app),e}))}updatePrefs(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=yield this.database.get(this.prefsObjectStoreName,e.app),n=t?{app:e.app,data:Object.assign(Object.assign({},t.data),e.data),lastUpdate:e.lastUpdate}:e;return this.setPrefs(n)}))}setUpDB(e){e.objectStoreNames.contains(this.workspaceLayoutsObjectStoreName)||e.createObjectStore(this.workspaceLayoutsObjectStoreName),e.objectStoreNames.contains(this.globalLayoutsObjectStoreName)||e.createObjectStore(this.globalLayoutsObjectStoreName),e.objectStoreNames.contains(this.serviceWorkerObjectStoreName)||e.createObjectStore(this.serviceWorkerObjectStoreName),e.objectStoreNames.contains(this.prefsObjectStoreName)||e.createObjectStore(this.prefsObjectStoreName)}}const defaultLoadingConfig={defaultStrategy:"direct",delayed:{batch:1,initialOffsetInterval:1e3,interval:5e3},showDelayedIndicator:!1};class WorkspacesController{constructor(e,t,n,r,i){this.framesController=e,this.glueController=t,this.stateController=n,this.hibernationWatcher=r,this.ioc=i,this.started=!1,this.operations={frameHello:{name:"frameHello",dataDecoder:frameHelloDecoder,execute:this.handleFrameHello.bind(this)},isWindowInWorkspace:{name:"isWindowInWorkspace",dataDecoder:simpleItemConfigDecoder,resultDecoder:isWindowInSwimlaneResultDecoder,execute:this.isWindowInWorkspace.bind(this)},createWorkspace:{name:"createWorkspace",dataDecoder:workspaceCreateConfigDecoder,resultDecoder:workspaceSnapshotResultDecoder,execute:this.createWorkspace.bind(this)},createFrame:{name:"createFrame",resultDecoder:frameSummaryResultDecoder,execute:this.createFrame.bind(this)},initFrame:{name:"initFrame",resultDecoder:voidResultDecoder,execute:this.initFrame.bind(this)},getAllFramesSummaries:{name:"getAllFramesSummaries",resultDecoder:frameSummariesResultDecoder,execute:this.getAllFramesSummaries.bind(this)},getFrameSummary:{name:"getFrameSummary",dataDecoder:getFrameSummaryConfigDecoder,resultDecoder:frameSummaryDecoder,execute:this.getFrameSummary.bind(this)},getAllWorkspacesSummaries:{name:"getAllWorkspacesSummaries",resultDecoder:workspaceSummariesResultDecoder,execute:this.getAllWorkspacesSummaries.bind(this)},getWorkspaceSnapshot:{name:"getWorkspaceSnapshot",dataDecoder:simpleItemConfigDecoder,resultDecoder:workspaceSnapshotResultDecoder,execute:this.getWorkspaceSnapshot.bind(this)},getAllLayoutsSummaries:{name:"getAllLayoutsSummaries",resultDecoder:layoutSummariesDecoder,execute:this.getAllLayoutsSummaries.bind(this)},openWorkspace:{name:"openWorkspace",dataDecoder:openWorkspaceConfigDecoder,resultDecoder:workspaceSnapshotResultDecoder,execute:this.openWorkspace.bind(this)},deleteLayout:{name:"deleteLayout",dataDecoder:deleteLayoutConfigDecoder,resultDecoder:voidResultDecoder,execute:this.deleteLayout.bind(this)},saveLayout:{name:"saveLayout",dataDecoder:workspaceLayoutSaveConfigDecoder,resultDecoder:workspaceLayoutDecoder,execute:this.saveLayout.bind(this)},importLayout:{name:"importLayout",dataDecoder:workspacesLayoutImportConfigDecoder,resultDecoder:voidResultDecoder,execute:this.importLayout.bind(this)},exportAllLayouts:{name:"exportAllLayouts",resultDecoder:exportedLayoutsResultDecoder,execute:this.exportAllLayouts.bind(this)},restoreItem:{name:"restoreItem",dataDecoder:simpleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.restoreItem.bind(this)},maximizeItem:{name:"maximizeItem",dataDecoder:simpleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.maximizeItem.bind(this)},focusItem:{name:"focusItem",dataDecoder:simpleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.focusItem.bind(this)},closeItem:{name:"closeItem",dataDecoder:simpleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.closeItem.bind(this)},resizeItem:{name:"resizeItem",dataDecoder:resizeItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.resizeItem.bind(this)},changeFrameState:{name:"changeFrameState",dataDecoder:frameStateConfigDecoder,resultDecoder:voidResultDecoder,execute:this.changeFrameState.bind(this)},getFrameState:{name:"getFrameState",dataDecoder:simpleItemConfigDecoder,resultDecoder:frameStateResultDecoder,execute:this.getFrameState.bind(this)},getFrameBounds:{name:"getFrameBounds",dataDecoder:simpleItemConfigDecoder,resultDecoder:frameBoundsResultDecoder,execute:this.getFrameBounds.bind(this)},moveFrame:{name:"moveFrame",dataDecoder:moveFrameConfigDecoder,resultDecoder:voidResultDecoder,execute:this.moveFrame.bind(this)},getFrameSnapshot:{name:"getFrameSnapshot",dataDecoder:frameSnapshotConfigDecoder,resultDecoder:frameSnapshotResultDecoder,execute:this.getFrameSnapshot.bind(this)},forceLoadWindow:{name:"forceLoadWindow",dataDecoder:simpleItemConfigDecoder,resultDecoder:simpleWindowOperationSuccessResultDecoder,execute:this.forceLoadWindow.bind(this)},ejectWindow:{name:"ejectWindow",dataDecoder:simpleItemConfigDecoder,resultDecoder:simpleWindowOperationSuccessResultDecoder,execute:this.ejectWindow.bind(this)},setItemTitle:{name:"setItemTitle",dataDecoder:setItemTitleConfigDecoder,resultDecoder:voidResultDecoder,execute:this.setItemTitle.bind(this)},moveWindowTo:{name:"moveWindowTo",dataDecoder:moveWindowConfigDecoder,resultDecoder:voidResultDecoder,execute:this.moveWindowTo.bind(this)},addWindow:{name:"addWindow",dataDecoder:addWindowConfigDecoder,resultDecoder:addItemResultDecoder,execute:this.addWindow.bind(this)},addContainer:{name:"addContainer",dataDecoder:addContainerConfigDecoder,resultDecoder:addItemResultDecoder,execute:this.addContainer.bind(this)},bundleWorkspace:{name:"bundleWorkspace",dataDecoder:bundleWorkspaceConfigDecoder,resultDecoder:voidResultDecoder,execute:this.bundleWorkspace.bind(this)},bundleItem:{name:"bundleItem",dataDecoder:bundleItemConfigDecoder,resultDecoder:voidResultDecoder,execute:this.bundleItem.bind(this)},hibernateWorkspace:{name:"hibernateWorkspace",dataDecoder:workspaceSelectorDecoder,resultDecoder:voidResultDecoder,execute:this.hibernateWorkspace.bind(this)},resumeWorkspace:{name:"resumeWorkspace",dataDecoder:workspaceSelectorDecoder,resultDecoder:voidResultDecoder,execute:this.resumeWorkspace.bind(this)},getWorkspacesConfig:{name:"getWorkspacesConfig",resultDecoder:workspacesConfigDecoder,execute:this.getWorkspacesConfiguration.bind(this)},lockWorkspace:{name:"lockWorkspace",dataDecoder:lockWorkspaceDecoder,resultDecoder:voidResultDecoder,execute:this.lockWorkspace.bind(this)},lockWindow:{name:"lockWindow",dataDecoder:lockWindowDecoder,resultDecoder:voidResultDecoder,execute:this.lockWindow.bind(this)},lockContainer:{name:"lockContainer",dataDecoder:lockContainerDecoder,resultDecoder:voidResultDecoder,execute:this.lockContainer.bind(this)},pinWorkspace:{name:"pinWorkspace",dataDecoder:pinWorkspaceDecoder,resultDecoder:voidResultDecoder,execute:this.pinWorkspace.bind(this)},unpinWorkspace:{name:"unpinWorkspace",dataDecoder:workspaceSelectorDecoder,resultDecoder:voidResultDecoder,execute:this.unpinWorkspace.bind(this)},getWorkspaceIcon:{name:"getWorkspaceIcon",dataDecoder:workspaceSelectorDecoder,resultDecoder:workspaceIconDecoder,execute:this.getWorkspaceIcon.bind(this)},setWorkspaceIcon:{name:"setWorkspaceIcon",dataDecoder:setWorkspaceIconDecoder,resultDecoder:voidResultDecoder,execute:this.setWorkspaceIcon.bind(this)},checkStarted:{name:"checkStarted",execute:this.handleCheckStarted.bind(this)},getPlatformFrameId:{name:"getPlatformFrameId",execute:this.handleGetPlatformFrameId.bind(this)},getWorkspacesLayouts:{name:"getWorkspacesLayouts",dataDecoder:getWorkspacesLayoutsConfigDecoder,resultDecoder:getWorkspacesLayoutsResponseDecoder,execute:this.handleGetWorkspacesLayouts.bind(this)},getWorkspaceWindowsOnLayoutSaveContext:{name:"getWorkspaceWindowsOnLayoutSaveContext",dataDecoder:getWorkspaceWindowsOnLayoutSaveContextConfigDecoder,resultDecoder:getWorkspaceWindowsOnLayoutSaveContextResult,execute:this.handleGetWorkspaceWindowsOnLayoutSaveContext.bind(this)},setMaximizationBoundary:{name:"setMaximizationBoundary",dataDecoder:setMaximizationBoundaryConfigDecoder,resultDecoder:voidResultDecoder,execute:this.handleSetMaximizationBoundary.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)},getWorkspaceWindowFrameBounds:{name:"getWorkspaceWindowFrameBounds",resultDecoder:frameBoundsResultDecoder,dataDecoder:simpleItemConfigDecoder,execute:this.getWorkspaceWindowFrameBounds.bind(this)},focusChange:{name:"focusChange",dataDecoder:focusEventDataDecoder,execute:this.handleFocusEvent.bind(this)}}}handlePlatformShutdown(){this.started=!1,this.hibernationWatcher.stop(),this.framesController.stop()}start(e){return __awaiter$7(this,void 0,void 0,(function*(){e.workspaces?(this.settings=this.applyDefaults(e.workspaces),this.settings.hibernation&&this.hibernationWatcher.start(this,this.settings.hibernation),yield Promise.all([this.glueController.createWorkspacesStream(),this.glueController.createWorkspacesEventsReceiver(this.bridgeWorkspaceEvent.bind(this))]),yield this.framesController.start(e.workspaces,e.windows.defaultWindowOpenBounds,this.operations.getFrameSummary),this.stateController.onWindowDisappeared((e=>this.framesController.handleFrameDisappeared(e))),this.started=!0):this.started=!1}))}get logger(){return logger.get("workspaces.controller")}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this workspaces control message, because the controller has not been started");const o=e.data,l=e.commandId,s=workspacesOperationDecoder.run(e.operation);if(!s.ok)throw new Error(`This workspace request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Workspace request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Workspace request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleClientUnloaded(e,t){var n,r;null===(n=this.logger)||void 0===n||n.trace(`handling unloading of ${e}`),t&&!t.closed||(null===(r=this.logger)||void 0===r||r.trace(`${e} detected as closed, checking if frame and processing close`),this.framesController.handleFrameDisappeared(e))}bridgeWorkspaceEvent(e){this.glueController.pushWorkspacesMessage(e),"closed"===e.action&&"workspace"===e.type&&this.glueController.clearContext(e.payload.workspaceSummary.id,"workspace"),this.settings.hibernation&&this.hibernationWatcher.notifyEvent(e)}closeItem(e,t){var n,r,i,o,l,s;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling closeItem request with config ${JSON.stringify(e)}`);const a=this.framesController.getAll().find((t=>t.windowId===e.itemId));if(a)return null===(r=this.logger)||void 0===r||r.trace(`[${t}] this is targeted at a frame, closing the frame`),null===(i=window.open(void 0,a.windowId))||void 0===i||i.close(),void(null===(o=this.logger)||void 0===o||o.trace(`[${t}] the frame window is closed`));const u=yield this.framesController.getFrameInstance(e);null===(l=this.logger)||void 0===l||l.trace(`[${t}] targeting frame ${u.windowId}`),yield this.glueController.callFrame(this.operations.closeItem,e,u.windowId),null===(s=this.logger)||void 0===s||s.trace(`[${t}] frame ${u.windowId} gave a success signal, responding to caller`)}))}setItemTitle(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling setItemTitle request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.setItemTitle,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}hibernateWorkspace(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling hibernateWorkspace request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.preserveAllWorkspaceWindowsContext(e.workspaceId),yield this.glueController.callFrame(this.operations.hibernateWorkspace,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}getWorkspacesConfiguration(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){return null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getWorkspacesConfiguration request`),this.settings}))}getWorkspaceWindowFrameBounds(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getWorkspaceWindowFrameBounds request with config ${JSON.stringify(e)}`);const i=yield this.framesController.getFrameInstance({itemId:e.itemId}),o=yield this.glueController.callWindow("windows",this.ioc.windowsController.getFrameBoundsOperation,{windowId:i.windowId},{windowId:i.windowId});return null===(r=this.logger)||void 0===r||r.trace(`[${t}] getWorkspaceWindowFrameBounds completed`),{bounds:o.bounds}}))}getAllFramesSummaries(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getAllFramesSummaries request`),!this.started)return{summaries:[]};const e=yield this.framesController.getAll();null===(r=this.logger)||void 0===r||r.trace(`[${t}] sending getFrameSummary to all known frames: ${e.join(", ")}`);const o=(yield Promise.all(e.map((e=>this.glueController.callFrame(this.operations.getFrameSummary,{itemId:e.windowId},e.windowId))))).filter((e=>"none"!==e.id));return null===(i=this.logger)||void 0===i||i.trace(`[${t}] all frames responded, returning to caller`),{summaries:o}}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}handleFrameHello(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling handleFrameHello command with config: ${JSON.stringify(e)}`),e.windowId&&this.framesController.processNewHello(e.windowId)}))}isWindowInWorkspace(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling isWindowInWorkspace command with config: ${JSON.stringify(e)}`);const o=this.framesController.getAll();null===(r=this.logger)||void 0===r||r.trace(`[${t}] sending isWindowInWorkspace to all known frames: ${JSON.stringify(o.join(", "))}`);const l=(yield Promise.all(o.map((t=>this.glueController.callFrame(this.operations.isWindowInWorkspace,e,t.windowId))))).some((e=>e.inWorkspace));return null===(i=this.logger)||void 0===i||i.trace(`[${t}] all frames responded, returning ${l} to the caller`),{inWorkspace:l}}))}createWorkspace(e,t){var n,r,i,o,l,s;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling createWorkspace command`);const a={frameId:null===(r=e.frame)||void 0===r?void 0:r.reuseFrameId,newFrame:null===(i=e.frame)||void 0===i?void 0:i.newFrame,itemId:null===(o=e.config)||void 0===o?void 0:o.reuseWorkspaceId},u=yield this.framesController.getFrameInstance(a);null===(l=this.logger)||void 0===l||l.trace(`[${t}] calling frame: ${u.windowId}, based on selection config: ${JSON.stringify(a)}`);const c=yield this.glueController.callFrame(this.operations.createWorkspace,e,u.windowId);return null===(s=this.logger)||void 0===s||s.trace(`[${t}] frame ${u.windowId} responded with a valid snapshot, returning to caller`),c}))}createFrame(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling createFrame command`);const o=yield this.framesController.openFrame(e.frameConfig,e.layoutComponentId);null===(r=this.logger)||void 0===r||r.trace(`[${t}] calling frame: ${o.windowId}}`);const l=yield this.glueController.callFrame(this.operations.createFrame,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} responded returning to caller`),l}))}initFrame(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling initFrame command`);const o={frameId:e.frameId},l=yield this.framesController.getFrameInstance(o);null===(r=this.logger)||void 0===r||r.trace(`[${t}] calling frame: ${l.windowId}, based on selection config: ${JSON.stringify(o)}`),yield this.glueController.callFrame(this.operations.initFrame,e,l.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${l.windowId} responded returning to caller`)}))}getFrameSummary(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getFrameSummary request for config: ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] forwarding getFrameSummary to frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.getFrameSummary,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} responded with a valid summary, returning to caller`),l}))}getAllWorkspacesSummaries(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getAllWorkspacesSummaries request`);const e=this.framesController.getAll();null===(r=this.logger)||void 0===r||r.trace(`[${t}] sending getAllWorkspacesSummaries to all known frames: ${e.join(", ")}`);const o=(yield Promise.all(e.map((e=>this.glueController.callFrame(this.operations.getAllWorkspacesSummaries,{},e.windowId))))).reduce(((e,t)=>(e.push(...t.summaries),e)),[]);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] all frames responded, results were aggregated, returning to caller`),{summaries:o}}))}getWorkspaceSnapshot(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getWorkspaceSnapshot for config: ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.getWorkspaceSnapshot,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} responded with a valid snapshot, retuning to caller`),l}))}handleCheckStarted(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){return null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling handleCheckStarted request`),null===(r=this.logger)||void 0===r||r.trace(`[${t}] the controller has been started, responding to caller`),{started:!0}}))}handleGetPlatformFrameId(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling GetPlatformFrameId request`);const e=this.framesController.getPlatformFrameSessionData();return null===(r=this.logger)||void 0===r||r.trace(`[${t}] GetPlatformFrameId completed, responding to caller`),{id:null==e?void 0:e.windowId}}))}getFrameSessionData(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getFrameSessionData request`);const i=this.framesController.getFrameConfig(e.frameId);return null===(r=this.logger)||void 0===r||r.trace(`[${t}] getFrameSessionData completed, responding to caller`),i}))}handleGetWorkspacesLayouts(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling handleGetWorkspacesLayouts request for frame: ${e.frameId} for layout: ${e.layoutName} of type: ${e.layoutType}`);const i=yield this.glueController.callFrame(this.operations.getWorkspacesLayouts,e,e.frameId);return null===(r=this.logger)||void 0===r||r.trace(`[${t}] handleGetWorkspacesLayouts request completed for frame: ${e.frameId} for layout: ${e.layoutName} of type: ${e.layoutType}`),i}))}getFrameBounds(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getFrameBounds request with config ${JSON.stringify(e)}`);const i=yield this.framesController.getFrameInstance({frameId:e.itemId}),o=yield this.glueController.callWindow("windows",this.ioc.windowsController.getFrameBoundsOperation,{windowId:i.windowId},{windowId:i.windowId});return null===(r=this.logger)||void 0===r||r.trace(`[${t}] getFrameBounds completed`),{bounds:o.bounds}}))}getAllLayoutsSummaries(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getAllLayoutsSummaries command`);const e=(yield this.ioc.layoutsController.handleGetAll({type:"Workspace"},t)).summaries.map((e=>({name:e.name})));return null===(r=this.logger)||void 0===r||r.trace(`[${t}] all layouts retrieved and mapped, returning to caller`),{summaries:e}}))}openWorkspace(e,t){var n,r,i,o;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling openWorkspace command for name: ${e.name}`);const l={frameId:null===(r=e.restoreOptions)||void 0===r?void 0:r.frameId,newFrame:null===(i=e.restoreOptions)||void 0===i?void 0:i.newFrame,itemId:null===(o=e.restoreOptions)||void 0===o?void 0:o.reuseWorkspaceId},s=yield this.framesController.getFrameInstance(l);return yield this.glueController.callFrame(this.operations.openWorkspace,e,s.windowId)}))}deleteLayout(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling deleteLayout request for name: ${e.name}`),yield this.ioc.layoutsController.handleRemove({name:e.name,type:"Workspace"},t),null===(r=this.logger)||void 0===r||r.trace(`[${t}] layouts reported this layout as deleted, responding to caller`)}))}saveLayout(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling saveLayout request for workspace ${e.workspaceId} and name ${e.name}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] forwarding request to frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.saveLayout,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} responded with a valid layout, returning to caller`),l}))}importLayout(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling importLayout command for layout ${e.layout.name}`),yield this.ioc.layoutsController.handleImport({layouts:[e.layout],mode:e.mode},t),null===(r=this.logger)||void 0===r||r.trace(`[${t}] the layouts controller successfully imported the layout, responding to caller`)}))}exportAllLayouts(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling exportAllLayouts request`);return yield this.ioc.layoutsController.handleExport({type:"Workspace"},t)}))}restoreItem(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling restoreItem request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.restoreItem,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}maximizeItem(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling maximizeItem request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.maximizeItem,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}focusItem(e,t){var n,r,i,o;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling focusItem request with config ${JSON.stringify(e)}`);const l=this.framesController.getAll().find((t=>t.windowId===e.itemId));if(l)return null===(r=this.logger)||void 0===r||r.trace(`[${t}] this is targeted at a frame, focusing the frame`),void window.open(void 0,l.windowId);const s=yield this.framesController.getFrameInstance(e);null===(i=this.logger)||void 0===i||i.trace(`[${t}] targeting frame ${s.windowId}`),yield this.glueController.callFrame(this.operations.focusItem,e,s.windowId),null===(o=this.logger)||void 0===o||o.trace(`[${t}] frame ${s.windowId} gave a success signal, responding to caller`)}))}resizeItem(e,t){var n,r,i,o,l;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling resizeItem request with config ${JSON.stringify(e)}`);const s=this.framesController.getAll().find((t=>t.windowId===e.itemId));if(s){null===(r=this.logger)||void 0===r||r.trace(`[${t}] detected targeted item is frame, building window resize config`);const n={windowId:e.itemId,width:e.width,height:e.height,relative:e.relative};return yield this.glueController.callWindow("windows",this.ioc.windowsController.moveResizeOperation,n,{windowId:s.windowId}),void(null===(i=this.logger)||void 0===i||i.trace(`[${t}] window resize responded with success, returning to caller`))}const a=yield this.framesController.getFrameInstance(e);null===(o=this.logger)||void 0===o||o.trace(`[${t}] targeted item is not a frame, it is located in frame ${a.windowId}`),yield this.glueController.callFrame(this.operations.resizeItem,e,a.windowId),null===(l=this.logger)||void 0===l||l.trace(`[${t}] frame ${a.windowId} gave a success signal, responding to caller`)}))}getFrameSnapshot(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getFrameSnapshot request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.getFrameSnapshot,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`),l}))}forceLoadWindow(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling forceLoadWindow request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.forceLoadWindow,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`),l}))}ejectWindow(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling ejectWindow request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.ejectWindow,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`),l}))}moveWindowTo(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling moveWindowTo request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.moveWindowTo,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}addWindow(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling addWindow request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.parentId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.addWindow,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal: ${JSON.stringify(l)}, responding to caller`),l}))}addContainer(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling addContainer request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.parentId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.addContainer,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal: ${JSON.stringify(l)}, responding to caller`),l}))}bundleWorkspace(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling bundleWorkspace request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.bundleWorkspace,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}bundleItem(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling bundleItem request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.itemId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.bundleItem,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}resumeWorkspace(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling resumeWorkspace request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.resumeWorkspace,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}lockWorkspace(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling lockWorkspace request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.lockWorkspace,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}lockContainer(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling lockContainer request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.itemId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.lockContainer,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}lockWindow(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling lockWindow request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.windowPlacementId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.lockWindow,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}pinWorkspace(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling pinWorkspace request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.pinWorkspace,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}unpinWorkspace(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling unpinWorkspace request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.unpinWorkspace,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}getWorkspaceIcon(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling getWorkspaceIcon request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`);const l=yield this.glueController.callFrame(this.operations.getWorkspaceIcon,e,o.windowId);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`),l}))}setWorkspaceIcon(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling setWorkspaceIcon request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance({itemId:e.workspaceId});null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.setWorkspaceIcon,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}handleGetWorkspaceWindowsOnLayoutSaveContext(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling GetWorkspaceWindowsOnLayoutSaveContext request with config: ${JSON.stringify(e)}`);const i=yield Promise.all(e.windowIds.map((t=>__awaiter$7(this,void 0,void 0,(function*(){return{windowId:t,windowContext:yield this.getWorkspaceWindowOnLayoutSaveData(t,e)}})))));return null===(r=this.logger)||void 0===r||r.trace(`[${t}] operation GetWorkspaceWindowsOnLayoutSaveContext completed responding`),{windowsOnSaveData:i}}))}handleSetMaximizationBoundary(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling setMaximizationBoundary request with config ${JSON.stringify(e)}`);const o=yield this.framesController.getFrameInstance(e);null===(r=this.logger)||void 0===r||r.trace(`[${t}] targeting frame ${o.windowId}`),yield this.glueController.callFrame(this.operations.setMaximizationBoundary,e,o.windowId),null===(i=this.logger)||void 0===i||i.trace(`[${t}] frame ${o.windowId} gave a success signal, responding to caller`)}))}changeFrameState(e,t){return __awaiter$7(this,void 0,void 0,(function*(){throw new Error("Frame states are not supported in Glue42 Core")}))}getFrameState(e,t){return __awaiter$7(this,void 0,void 0,(function*(){throw new Error("Frame states are not supported in Glue42 Core")}))}handleFocusEvent(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling focus event from frame id: ${e.windowId} and hasFocus: ${e.hasFocus}`);try{yield this.framesController.getFrameInstance({frameId:e.windowId})}catch(n){return void(null===(r=this.logger)||void 0===r||r.trace(`[${t}] ignoring focus event for unrecognized frame with id: ${e.windowId}`))}const o={type:"frame",action:"focus",payload:{frameSummary:{id:e.windowId,isFocused:e.hasFocus}}};this.bridgeWorkspaceEvent(o),null===(i=this.logger)||void 0===i||i.trace(`[${t}] focus event from frame id: ${e.windowId} and hasFocus: ${e.hasFocus} handled`)}))}moveFrame(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling moveFrame command with config: ${JSON.stringify(e)}`);const i=yield this.framesController.getFrameInstance({frameId:e.itemId}),o={windowId:e.itemId,top:e.top,left:e.left,relative:e.relative};yield this.glueController.callWindow("windows",this.ioc.windowsController.moveResizeOperation,o,{windowId:i.windowId}),null===(r=this.logger)||void 0===r||r.trace(`[${t}] frame with id ${i.windowId} was successfully moved, responding to caller`)}))}applyDefaults(e){const t=(null==e?void 0:e.hibernation)||{},n=(null==e?void 0:e.loadingStrategy)||{},r=deepMerge(defaultLoadingConfig,n);return Object.assign(Object.assign({},e),{loadingStrategy:r,hibernation:t})}getWorkspaceWindowOnLayoutSaveData(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){if(this.ioc.sessionController.getAllNonGlue().some((t=>t.windowId===e)))return{};if(!this.ioc.sessionController.getWorkspaceClientById(e))throw new Error(`Cannot ask window: ${e} for on layout save request, because it is not a known workspace window`);const r=`Cannot fetch the on layout save context from: ${e}, because of timeout`,i=yield PromiseWrap((()=>__awaiter$7(this,void 0,void 0,(function*(){try{return yield this.glueController.callWindow("layouts",{name:"clientSaveRequest",execute:()=>__awaiter$7(this,void 0,void 0,(function*(){}))},t,{windowId:e})}catch(e){return{}}}))),15e3,r);return null!==(n=null==i?void 0:i.windowContext)&&void 0!==n?n:{}}))}}const intentsOperationTypesDecoder=oneOf$1(constant$1("findIntent"),constant$1("getIntents"),constant$1("raiseIntent"),constant$1("raise"),constant$1("operationCheck"),constant$1("filterHandlers"),constant$1("getIntentsByHandler")),intentHandlerDecoder=object$1({applicationName:nonEmptyStringDecoder$1,applicationTitle:optional$1(string$1()),applicationDescription:optional$1(string$1()),applicationIcon:optional$1(string$1()),type:oneOf$1(constant$1("app"),constant$1("instance")),displayName:optional$1(string$1()),contextTypes:optional$1(array$1(nonEmptyStringDecoder$1)),instanceId:optional$1(string$1()),instanceTitle:optional$1(string$1()),resultType:optional$1(nonEmptyStringDecoder$1)}),intentDecoder=object$1({name:nonEmptyStringDecoder$1,handlers:array$1(intentHandlerDecoder)}),intentTargetDecoder=oneOf$1(constant$1("startNew"),constant$1("reuse"),object$1({app:optional$1(nonEmptyStringDecoder$1),instance:optional$1(nonEmptyStringDecoder$1)})),intentContextDecoder=object$1({type:optional$1(nonEmptyStringDecoder$1),data:optional$1(object$1())}),intentsDecoder=array$1(intentDecoder),wrappedIntentsDecoder=object$1({intents:intentsDecoder}),wrappedIntentFilterDecoder=object$1({filter:optional$1(object$1({name:optional$1(nonEmptyStringDecoder$1),contextType:optional$1(nonEmptyStringDecoder$1),resultType:optional$1(nonEmptyStringDecoder$1)}))});object$1({applicationName:nonEmptyStringDecoder$1,applicationIcon:optional$1(string$1()),instanceId:optional$1(string$1())});const intentRequestDecoder=object$1({intent:nonEmptyStringDecoder$1,target:optional$1(intentTargetDecoder),context:optional$1(intentContextDecoder),options:optional$1(windowOpenSettingsDecoder),handlers:optional$1(array$1(intentHandlerDecoder)),timeout:optional$1(nonNegativeNumberDecoder$1),waitUserResponseIndefinitely:optional$1(boolean())}),resolverConfigDecoder=object$1({enabled:optional$1(boolean()),appName:string$1(),waitResponseTimeout:number$1()}),raiseIntentRequestDecoder=object$1({intentRequest:intentRequestDecoder,resolverConfig:resolverConfigDecoder}),intentResultDecoder=object$1({request:intentRequestDecoder,handler:intentHandlerDecoder,result:anyJson$1()}),raiseIntentResolverResponseDecoder=object$1({intent:nonEmptyStringDecoder$1,handler:intentHandlerDecoder}),filterHandlersResolverResponseDecoder=object$1({handler:intentHandlerDecoder}),handlersFilterDecoder=object$1({title:optional$1(nonEmptyStringDecoder$1),openResolver:optional$1(boolean()),timeout:optional$1(nonNegativeNumberDecoder$1),intent:optional$1(nonEmptyStringDecoder$1),contextTypes:optional$1(array$1(nonEmptyStringDecoder$1)),resultType:optional$1(nonEmptyStringDecoder$1),applicationNames:optional$1(array$1(nonEmptyStringDecoder$1))}),filterHandlersResultDecoder=object$1({handlers:array$1(intentHandlerDecoder)}),filterHandlersWithResolverConfigDecoder=object$1({filterHandlersRequest:handlersFilterDecoder,resolverConfig:resolverConfigDecoder}),intentInfoDecoder=object$1({intent:nonEmptyStringDecoder$1,contextTypes:optional$1(array$1(nonEmptyStringDecoder$1)),description:optional$1(nonEmptyStringDecoder$1),displayName:optional$1(nonEmptyStringDecoder$1),icon:optional$1(nonEmptyStringDecoder$1),resultType:optional$1(nonEmptyStringDecoder$1)}),getIntentsResultDecoder=object$1({intents:array$1(intentInfoDecoder)}),INTENTS_RESOLVER_INTEROP_PREFIX="T42.Intents.Resolver.Control.",INTENTS_RESOLVER_WIDTH=400,INTENTS_RESOLVER_HEIGHT=440,DEFAULT_METHOD_RESPONSE_TIMEOUT_MS=6e4,DEFAULT_RAISE_TIMEOUT_MS=9e4,DEFAULT_PICK_HANDLER_BY_TIMEOUT_MS=9e4,ERRORS=errors.intents;class IntentsController{constructor(e,t,n,r){this.glueController=e,this.resolverHelper=t,this.appDirectory=n,this.ioc=r,this.operations={getIntents:{name:"getIntents",resultDecoder:wrappedIntentsDecoder,execute:this.getWrappedIntents.bind(this)},findIntent:{name:"findIntent",dataDecoder:wrappedIntentFilterDecoder,resultDecoder:wrappedIntentsDecoder,execute:this.findIntent.bind(this)},raiseIntent:{name:"raiseIntent",dataDecoder:intentRequestDecoder,resultDecoder:intentResultDecoder,execute:this.handleRaiseIntent.bind(this)},raise:{name:"raise",dataDecoder:raiseIntentRequestDecoder,resultDecoder:intentResultDecoder,execute:this.raise.bind(this)},filterHandlers:{name:"filterHandlers",dataDecoder:filterHandlersWithResolverConfigDecoder,resultDecoder:filterHandlersResultDecoder,execute:this.filterHandlers.bind(this)},getIntentsByHandler:{name:"getIntentsByHandler",dataDecoder:intentHandlerDecoder,resultDecoder:getIntentsResultDecoder,execute:this.getIntentsByHandler.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)}},this.started=!1}get logger(){return logger.get("intents.controller")}handlePlatformShutdown(){this.started=!1}start(){return __awaiter$7(this,void 0,void 0,(function*(){this.started=!0}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this intents control message, because the controller has not been started");const o=e.data,l=e.commandId,s=e.callerId,a=intentsOperationTypesDecoder.run(e.operation);if(!a.ok)throw new Error(`This intents request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(a.error)}`);const u=a.result,c=null===(t=this.operations[u].dataDecoder)||void 0===t?void 0:t.run(o);if(c&&!c.ok)throw new Error(`Intents request for ${u} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(c.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${u} command is valid with data: ${JSON.stringify(o)}`);const h=yield this.operations[u].execute(o,l,s),d=null===(r=this.operations[u].resultDecoder)||void 0===r?void 0:r.run(h);if(d&&!d.ok)throw new Error(`Intents request for ${u} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(d.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${u} command was executed successfully`),h}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}extractAppIntents(e){const t={},n=e.filter((e=>e.intents.length>0));for(const e of n)for(const n of e.intents){t[n.name]||(t[n.name]=[]);const r={applicationName:e.name,applicationTitle:e.title,applicationDescription:e.caption,displayName:n.displayName,contextTypes:n.contexts,applicationIcon:e.icon,type:"app",resultType:n.resultType};t[n.name].push(r)}return t}getInstanceIntents(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){const r={};for(const i of this.glueController.getServers()){const o=((null===(n=i.getMethods)||void 0===n?void 0:n.call(i))||[]).filter((e=>e.name.startsWith(GlueWebIntentsPrefix)));yield Promise.all(o.map((n=>__awaiter$7(this,void 0,void 0,(function*(){const o=n.name.replace(GlueWebIntentsPrefix,"");r[o]||(r[o]=[]);const l=n.flags.intent,s=e.find((e=>e.name===i.application));let a,u;s&&s.intents&&(a=s.intents.find((e=>e.name===o))),this.glueController.isValidWindowId(i.windowId)&&(u=yield this.ioc.windowsController.getWindowTitle(i.windowId,t));const c={instanceId:i.windowId||i.instance,applicationName:i.application||"",applicationIcon:l.icon||(null==s?void 0:s.icon),applicationTitle:(null==s?void 0:s.title)||"",applicationDescription:l.description||(null==s?void 0:s.caption),displayName:l.displayName||(null==a?void 0:a.displayName),contextTypes:l.contextTypes||(null==a?void 0:a.contexts),instanceTitle:u,type:"instance",resultType:(null==a?void 0:a.resultType)||l.resultType};r[o].push(c)})))))}return r}))}mergeIntentStores(e,t){const n={};for(const r of new Set([...Object.keys(e),...Object.keys(t)]))n[r]=[...e[r]||[],...t[r]||[]];return n}wrapIntents(e){return{intents:e}}getIntents(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){const r=(yield this.appDirectory.getAll()).map((e=>({name:e.name,title:e.title||"",icon:e.icon,caption:e.caption,intents:e.userProperties.intents||[]}))),i=this.extractAppIntents(r);null===(t=this.logger)||void 0===t||t.trace(`[${e}] got app intents`);const o=yield this.getInstanceIntents(r,e);null===(n=this.logger)||void 0===n||n.trace(`[${e}] got instance intents`);const l=this.mergeIntentStores(i,o);return Object.keys(l).map((e=>({name:e,handlers:l[e]})))}))}getWrappedIntents(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling getIntents command`);const r=yield this.getIntents(e);return null===(n=this.logger)||void 0===n||n.trace(`[${e}] getIntents command completed`),this.wrapIntents(r)}))}findIntent(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling findIntent command`);const i=e.filter;let o=yield this.getIntents(t);if(!i)return this.wrapIntents(o);if("string"==typeof i)return this.wrapIntents(o.filter((e=>e.name===i)));if(i.contextType){const e=i.contextType.toLowerCase();o=o.filter((t=>t.handlers.some((t=>{var n;return null===(n=t.contextTypes)||void 0===n?void 0:n.some((t=>t.toLowerCase()===e))}))))}if(i.name&&(o=o.filter((e=>e.name===i.name))),i.resultType){const e=i.resultType.toLowerCase();o=o.filter((t=>t.handlers.some((t=>{var n;return(null===(n=t.resultType)||void 0===n?void 0:n.toLowerCase())===e}))))}return null===(r=this.logger)||void 0===r||r.trace(`[${t}] findIntent command completed`),this.wrapIntents(o)}))}getIntent(e,t){return __awaiter$7(this,void 0,void 0,(function*(){return(yield this.getIntents(t)).find((t=>t.name===e))}))}startApp(e,t){return __awaiter$7(this,void 0,void 0,(function*(){return(yield this.ioc.applicationsController.handleApplicationStart(e,t)).id}))}handleRaiseIntent(e,t,n){return this.raiseIntent(e,t,n)}raiseIntent(e,t,n,r){var i,o;return __awaiter$7(this,void 0,void 0,(function*(){null===(i=this.logger)||void 0===i||i.trace(`[${t}] handling raiseIntent command with intentRequest: ${JSON.stringify(e)}`);const l=e.intent,s=yield this.getIntent(l,t);if(!s)throw new Error(`Intent ${l} not found!`);null===(o=this.logger)||void 0===o||o.trace(`Raised intent definition: ${JSON.stringify(s)}`);const a=e.handlers?this.findHandlerByFilter(e.handlers,{type:"app"}):this.findHandlerByFilter(s.handlers,{type:"app"}),u=e.handlers?this.findHandlerByFilter(e.handlers,{type:"instance"}):this.findHandlerByFilter(s.handlers,{type:"instance"});let c;if(e.target&&"reuse"!==e.target||(c=u||a),"startNew"===e.target&&(c=a),"object"==typeof e.target&&e.target.app&&(c=this.findHandlerByFilter(s.handlers,{app:e.target.app})),"object"==typeof e.target&&e.target.instance&&(c=this.findHandlerByFilter(s.handlers,{instance:e.target.instance,app:e.target.app})),!c)throw new Error(`Can not raise intent for request ${JSON.stringify(e)} - can not find intent handler!`);return yield this.raiseIntentToTargetHandler({request:e,handler:c,commandId:t,callerId:n,timeout:r})}))}findHandlerByFilter(e,t){return t.type?e.find((e=>e.type===t.type)):t.instance?e.find((e=>t.app?e.applicationName===t.app&&e.instanceId===t.instance:e.instanceId===t.instance)):t.app?e.find((e=>e.applicationName===t.app)):void 0}raiseIntentToTargetHandler({handler:e,request:t,callerId:n,commandId:r,timeout:i}){var o,l,s;return __awaiter$7(this,void 0,void 0,(function*(){null===(o=this.logger)||void 0===o||o.trace(`Raising intent to target handler:${JSON.stringify(e)}`);const a=e.instanceId?Promise.resolve(e.instanceId):this.startApp(Object.assign(Object.assign({name:e.applicationName},t.options),{context:t.context}),r).catch((e=>{const t=e instanceof Error||"string"==typeof e?e:JSON.stringify(e);throw new Error(`${ERRORS.TARGET_INSTANCE_UNAVAILABLE}. Reason: ${t}`)})),u=yield a,c=`${GlueWebIntentsPrefix}${t.intent}`;null===(l=this.logger)||void 0===l||l.trace(`Searching for interop server offering method ${c}`);const h={methodResponseTimeoutMs:i?i+1e3:DEFAULT_METHOD_RESPONSE_TIMEOUT_MS,waitTimeoutMs:i?i+1e3:DEFAULT_METHOD_RESPONSE_TIMEOUT_MS},d=this.glueController.invokeMethod(c,Object.assign(Object.assign({},t.context),{_initialCallerId:n}),{instance:u},h).catch((e=>{throw new Error(`${ERRORS.INTENT_HANDLER_REJECTION}. Reason: ${e instanceof Error?e:JSON.stringify(e)}`)})),f=yield d;return null===(s=this.logger)||void 0===s||s.trace(`[${r}] raiseIntent command completed. Returning result: ${JSON.stringify(f)}`),{request:t,handler:Object.assign(Object.assign({},e),{instanceId:u,type:"instance"}),result:f.returned}}))}raise(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){if(null===(r=this.logger)||void 0===r||r.trace(`[${t}] Receive raise command with config: ${JSON.stringify(e)}`),!n)throw new Error(`${ERRORS.CALLER_NOT_DEFINED} for 'raise' command with request ${JSON.stringify(e)}`);const i=e.intentRequest.timeout||DEFAULT_RAISE_TIMEOUT_MS,o={instanceId:void 0},l=this.coreRaiseIntent.bind(this,{request:e,resolverInstance:o,timeout:i,commandId:t,callerId:n});if(e.intentRequest.waitUserResponseIndefinitely)return l();const s=PromiseWrap(l,i,`${ERRORS.TIMEOUT_HIT} - waited ${i}ms for 'raise' to resolve`);return s.catch((()=>this.handleRaiseOnError(o.instanceId))),s}))}coreRaiseIntent({request:e,resolverInstance:t,timeout:n,commandId:r,callerId:i}){var o,l,s,a,u;return __awaiter$7(this,void 0,void 0,(function*(){const{resolverConfig:c,intentRequest:h}=e,d=(yield this.findIntent({filter:{name:h.intent}},r)).intents.find((e=>e.name===h.intent));if(!d)throw new Error(`${ERRORS.INTENT_NOT_FOUND} with name ${h.intent}`);null===(o=this.logger)||void 0===o||o.trace(`[${r}] Intent to be handled: ${JSON.stringify(d)}`);const{open:f,reason:p}=this.checkIfResolverShouldBeOpenedForRaise(d,h,c);if(!f)return null===(l=this.logger)||void 0===l||l.trace(`[${r}] Intent Resolver UI won't be used. Reason: ${p}`),h.waitUserResponseIndefinitely?PromiseWrap((()=>this.raiseIntent(h,r,i,n)),n,`${ERRORS.TIMEOUT_HIT} - waited ${n}ms for 'raise' to resolve`):this.raiseIntent(h,r,i,n);null===(s=this.logger)||void 0===s||s.trace(`[${r}] Starting Intent Resolver app for intent request: ${e}`);const g=yield this.resolverHelper.startResolverApp({request:e.intentRequest,resolverConfig:e.resolverConfig,callerId:i,commandId:r,resolverInstance:t,method:"raise"});if(null===(a=this.logger)||void 0===a||a.trace(`Raising intent to target handler: ${JSON.stringify(g)} ${e.intentRequest.waitUserResponseIndefinitely?`with timeout of ${e.intentRequest.timeout||DEFAULT_RAISE_TIMEOUT_MS}`:""}`),h.waitUserResponseIndefinitely)return PromiseWrap((()=>this.raiseIntentToTargetHandler({request:h,handler:g,commandId:r,timeout:n,callerId:i})),n,`${ERRORS.TIMEOUT_HIT} - waited ${n}ms for 'raise' to resolve`);const w=yield this.raiseIntentToTargetHandler({request:e.intentRequest,handler:g,commandId:r,callerId:i,timeout:n});return null===(u=this.logger)||void 0===u||u.trace(`Result from raise() method for intent ${JSON.stringify(e.intentRequest.intent)}: ${JSON.stringify(w)}`),w}))}handleRaiseOnError(e){e&&this.resolverHelper.stopResolverInstance(e)}checkIfIntentHasMoreThanOneHandler(e,t){return t.target?"reuse"===t.target?t.handlers?t.handlers.filter((e=>"instance"===e.type&&e.instanceId)).length>1||t.handlers.filter((e=>"app"===e.type)).length>1:e.handlers.filter((e=>"instance"===e.type&&e.instanceId)).length>1||e.handlers.filter((e=>"app"===e.type)).length>1:"startNew"===t.target?t.handlers?t.handlers.filter((e=>"app"===e.type)).length>1:e.handlers.filter((e=>"app"===e.type)).length>1:(t.target,!1):t.handlers?t.handlers.length>1:e.handlers.length>1}checkIfResolverShouldBeOpenedForRaise(e,t,n){const r=this.checkIfResolverShouldBeOpenByResolverConfig(n);if(!r.open)return r;return this.checkIfIntentHasMoreThanOneHandler(e,t)?{open:!0}:{open:!1,reason:"Raised intent has only one handler"}}checkIfResolverShouldBeOpenedForFilterHandlers(e,t,n){return 1===e.length?{open:!1,reason:`There's only one valid intent handler for filter ${JSON.stringify(t)}`}:this.checkIfResolverShouldBeOpenByResolverConfig(n)}checkIfResolverShouldBeOpenByResolverConfig(e){if(!e.enabled)return{open:!1,reason:"Intent Resolver is disabled. Raising intent to first found handler"};return this.glueController.clientGlue.appManager.application(e.appName)?{open:!0}:{open:!1,reason:`Application with name ${e.appName} not found`}}filterHandlers(e,t,n){var r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(null===(r=this.logger)||void 0===r||r.trace(`[${t}] Receive 'filterHandlers' command with request: ${JSON.stringify(e)}`),!n)throw new Error("Cannot preform 'filterHandlers' - callerId is not defined");const{filterHandlersRequest:o,resolverConfig:l}=e,s=this.filterHandlersBy(yield this.getIntents(t),o);if(!(null==s?void 0:s.length))return{handlers:[]};const{open:a,reason:u}=this.checkIfResolverShouldBeOpenedForFilterHandlers(s,o,l);if(!a)return null===(i=this.logger)||void 0===i||i.trace(`[${t}] Intent Resolver UI won't be used. Reason: ${u}`),{handlers:s};const c={instanceId:void 0},h=o.timeout||DEFAULT_PICK_HANDLER_BY_TIMEOUT_MS;return{handlers:[yield PromiseWrap((()=>this.resolverHelper.startResolverApp({request:o,resolverConfig:l,commandId:t,callerId:n,resolverInstance:c,method:"filterHandlers"})),h,`Timeout of ${h}ms hit for 'filterHandlers' request with filter: ${JSON.stringify(e.filterHandlersRequest)}`)]}}))}filterHandlersBy(e,t){const n=e.filter((e=>{if(!t.intent||t.intent===e.name){if(t.resultType){const n=e.handlers.filter((e=>e.resultType&&e.resultType===t.resultType));if(!n.length)return;e.handlers=n}if(t.contextTypes){const n=e.handlers.filter((e=>{var n;return null===(n=t.contextTypes)||void 0===n?void 0:n.every((t=>{var n;return null===(n=e.contextTypes)||void 0===n?void 0:n.includes(t)}))}));if(!n.length)return;e.handlers=n}if(t.applicationNames){const n=e.handlers.filter((e=>{var n;return null===(n=t.applicationNames)||void 0===n?void 0:n.includes(e.applicationName)}));if(!n.length)return;e.handlers=n}return e}})).map((e=>e.handlers)).flat(1);return n.filter(((e,t)=>t===n.findIndex((t=>e.instanceId?e.instanceId===t.instanceId:!t.instanceId&&t.applicationName===e.applicationName))))}getIntentsByHandler(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.log(`[${t}] - Receive 'getIntents' command with request: ${JSON.stringify(e)}`);const o=intentHandlerDecoder.runWithException(e),l=yield this.getIntents(t);clearNullUndefined(o),null===(r=this.logger)||void 0===r||r.info(`[${t}] - extracting valid intents for the passed handler`);const s=this.extractIntentsWithInfoByHandler(l,o);return null===(i=this.logger)||void 0===i||i.info(`[${t}] - returning intents for handler ${JSON.stringify(e)}`),{intents:s}}))}extractIntentsWithInfoByHandler(e,t){return e.reduce(((e,n)=>(n.handlers.forEach((r=>{if(!Object.keys(t).every((e=>{var n;return"contextTypes"===e?null===(n=t.contextTypes)||void 0===n?void 0:n.every((e=>{var t;return null===(t=r.contextTypes)||void 0===t?void 0:t.includes(e)})):r[e]===t[e]})))return;const i={intent:n.name,contextTypes:r.contextTypes,description:r.applicationDescription,displayName:r.displayName,icon:r.applicationIcon,resultType:r.resultType};e.push(i)})),e)),[])}}const channelOperationDecoder=oneOf$1(constant$1("addChannel"),constant$1("operationCheck"),constant$1("getMyChannel"),constant$1("getWindowIdsOnChannel"),constant$1("getWindowIdsWithChannels"),constant$1("joinChannel")),channelContextDecoder=object$1({name:nonEmptyStringDecoder$1,meta:object$1({color:nonEmptyStringDecoder$1}),data:optional$1(anyJson$1())}),getMyChanelResultDecoder=object$1({channel:optional$1(nonEmptyStringDecoder$1)}),getWindowIdsOnChannelDataDecoder=object$1({channel:nonEmptyStringDecoder$1}),getWindowIdsOnChannelResultDecoder=object$1({windowIds:array$1(nonEmptyStringDecoder$1)}),getWindowIdsWithChannelsResultDecoder=object$1({windowIdsWithChannels:array$1(object$1({application:nonEmptyStringDecoder$1,channel:optional$1(nonEmptyStringDecoder$1),windowId:nonEmptyStringDecoder$1}))}),windowWithChannelFilterDecoder=object$1({application:optional$1(nonEmptyStringDecoder$1),channels:optional$1(array$1(nonEmptyStringDecoder$1)),windowIds:optional$1(array$1(nonEmptyStringDecoder$1))}),wrappedWindowWithChannelFilterDecoder=object$1({filter:optional$1(windowWithChannelFilterDecoder)}),joinChannelDataDecoder=object$1({channel:nonEmptyStringDecoder$1,windowId:nonEmptyStringDecoder$1});class ChannelsController{constructor(e){this.glueController=e,this.operations={addChannel:{name:"addChannel",execute:this.addChannel.bind(this),dataDecoder:channelContextDecoder},getMyChannel:{name:"getMyChannel",execute:()=>__awaiter$7(this,void 0,void 0,(function*(){})),resultDecoder:getMyChanelResultDecoder},getWindowIdsOnChannel:{name:"getWindowIdsOnChannel",execute:this.handleGetWindowIdsOnChannel.bind(this),dataDecoder:getWindowIdsOnChannelDataDecoder,resultDecoder:getWindowIdsOnChannelResultDecoder},getWindowIdsWithChannels:{name:"getWindowIdsWithChannels",execute:this.handleGetWindowIdsWithChannels.bind(this),dataDecoder:wrappedWindowWithChannelFilterDecoder,resultDecoder:getWindowIdsWithChannelsResultDecoder},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)},joinChannel:{name:"joinChannel",dataDecoder:joinChannelDataDecoder,execute:this.handleJoinChannel.bind(this)}}}get logger(){return logger.get("channels.controller")}start(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){const r=e.channels.definitions;null===(t=this.logger)||void 0===t||t.trace("initializing channels"),yield this.setupChannels(r),null===(n=this.logger)||void 0===n||n.trace("initialization is completed")}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){const o=e.data,l=e.commandId,s=channelOperationDecoder.run(e.operation);if(!s.ok)throw new Error(`This channels request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Channels request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Channels request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}setupChannels(e){return __awaiter$7(this,void 0,void 0,(function*(){yield Promise.all(e.map((e=>this.addChannel(e))))}))}addChannel(e,t){return __awaiter$7(this,void 0,void 0,(function*(){this.trace(`[${t}] handling addChannel command with a valid name: ${e.name}, color: ${e.meta.color} and data: ${JSON.stringify(e.data)}`,t);const n={name:e.name,meta:e.meta,data:e.data||{}},r=this.createContextName(n.name);this.trace(`[${t}] setting a new channel context with name: ${r}`,t),yield this.glueController.setContext(r,n),this.trace(`[${t}] channel context with name: ${r} created successfully`,t)}))}getWindowChannel(e){return this.glueController.callWindow("channels",this.operations.getMyChannel,{},{windowId:e})}handleGetWindowIdsOnChannel({channel:e},t){return __awaiter$7(this,void 0,void 0,(function*(){this.trace(`[${t}] handling getWindowIdsOnChannel command with channel: ${e}`,t);const n=this.glueController.getServers().reduce(((e,{windowId:t})=>t?[...e,t]:e),[]);this.trace(`[${t}] compiled a list of the IDs of all the windows that will be called: [${n.join(", ")}]`,t);const r=yield Promise.all(n.map((e=>__awaiter$7(this,void 0,void 0,(function*(){const{channel:t}=yield this.getWindowChannel(e);return{channel:t,windowId:e}}))))),i=r.filter((t=>t.channel===e)).map((({windowId:e})=>e));return this.trace(`[${t}] compiled a list of all windowIds that are on the "${e}" channel and returning it to the caller: [${i.join(", ")}]`),{windowIds:i}}))}handleGetWindowIdsWithChannels({filter:e},t){return __awaiter$7(this,void 0,void 0,(function*(){this.trace(`[${t}] handling getWindowIdsWithChannels command with filter: ${JSON.stringify(e)}`,t);const n=this.glueController.getServers(),r=this.glueController.getAllApplicationNames(),i=n.filter((({windowId:e})=>e));this.trace(`[${t}] compiled a list of the IDs of all the windows that will be called: [${i.map((({windowId:e})=>e)).join(", ")}]`,t);const o=yield Promise.all(i.map((({applicationName:e,windowId:t})=>__awaiter$7(this,void 0,void 0,(function*(){const{channel:n}=yield this.getWindowChannel(t),i=e&&r.includes(e)?e:"no-app-window";return Object.assign(Object.assign({application:i},n?{channel:n}:{}),{windowId:t})})))));let l=o;return e?(e.application&&(this.trace(`[${t}] filtering windows by application: ${e.application}`,t),l=l.filter((({application:t})=>t===e.application))),e.channels&&(this.trace(`[${t}] filtering windows by channels: [${e.channels.join(", ")}]`,t),l=l.filter((({channel:t})=>{var n;return t&&(null===(n=e.channels)||void 0===n?void 0:n.includes(t))}))),e.windowIds&&(this.trace(`[${t}] filtering windows by windowIds: [${e.windowIds.join(", ")}]`,t),l=l.filter((({windowId:t})=>{var n;return null===(n=e.windowIds)||void 0===n?void 0:n.includes(t)}))),this.trace(`[${t}] compiled a list of all windowIds with channels and returning it to the caller: ${JSON.stringify(l)}`),{windowIdsWithChannels:l}):(this.trace(`[${t}] compiled a list of all windowIds with channels and returning it to the caller: ${JSON.stringify(l)}`),{windowIdsWithChannels:l})}))}handleJoinChannel({channel:e,windowId:t},n){return __awaiter$7(this,void 0,void 0,(function*(){if(this.trace(`[${n}] handling joinChannel command with channel: ${e} and windowId: ${t}`,n),!this.glueController.isValidWindowId(t))throw new Error(`Failed to join "${e}" channel on window with ID "${t}", because the provided windowId is invalid`);yield this.glueController.callWindow("channels",this.operations.joinChannel,{channel:e,windowId:t},{windowId:t}),this.trace(`[${n}] successfully joined "${e}" channel on window with ID "${t}"`,n)}))}createContextName(e){return`${ChannelContextPrefix}${e}`}trace(e,t){var n;t&&(null===(n=this.logger)||void 0===n||n.trace(e))}}class FramesController{constructor(e,t,n){this.sessionController=e,this.glueController=t,this.ioc=n,this.locks={},this.defaultFrameHelloTimeoutMs=15e3}stop(){this._handleUnload&&window.removeEventListener("unload",this._handleUnload)}start(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){this.config=e,this.defaultBounds=t,this.frameSummaryOperation=n,e.isFrame&&(this.myFrameId=null===(r=this.sessionController.getAllFrames().find((e=>e.isPlatform)))||void 0===r?void 0:r.windowId,this._handleUnload=this.handleUnload.bind(this),window.addEventListener("unload",this._handleUnload))}))}openFrame(e,t){var n,r,i,o,l;return __awaiter$7(this,void 0,void 0,(function*(){const s="object"==typeof e&&null!==(n=e.bounds)&&void 0!==n?n:{},a=null!==(r=s.top)&&void 0!==r?r:this.defaultBounds.top,u=null!==(i=s.left)&&void 0!==i?i:this.defaultBounds.left,c=null!==(o=s.width)&&void 0!==o?o:this.defaultBounds.width,h=null!==(l=s.height)&&void 0!==l?l:this.defaultBounds.height,d="object"==typeof e&&(null==e?void 0:e.frameId)?e.frameId:`g42-${shortid$2.generate()}`;if(this.sessionController.getAllFrames().some((e=>e.windowId===d)))throw new Error(`Cannot open a frame with id: ${d}, because a frame with this id already exists`);const f={windowId:d,active:!1,isPlatform:!1,layoutComponentId:t},p=`left=${u},top=${a},width=${c},height=${h}`,g=`${(yield this.getWorkspacesUrls()).workspacesUrl.current}?emptyFrame=true`;if(!window.open(g,f.windowId,p))throw new Error("Cannot open a new workspace frame, because the user has not allowed popups or uses a blocker");this.sessionController.saveFrameData(f);try{return yield this.waitHello(f.windowId),{windowId:f.windowId}}catch(e){throw delete this.locks[f.windowId],new Error("Cannot open a new frame, because the workspace frame app did not send a hello in time")}}))}closeFrame(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.sessionController.getFrameData(e))throw new Error(`Cannot close a frame with id: ${e}, because it is not known by the platform`);this.handleFrameDisappeared(e),null===(t=window.open(void 0,e))||void 0===t||t.close()}))}processNewHello(e){var t;this.sessionController.getFrameData(e)&&(this.sessionController.setFrameActive(e),null===(t=this.locks[e])||void 0===t||t.lift())}handleFrameDisappeared(e){this.sessionController.getFrameData(e)&&(this.sessionController.removeFrameData(e),this.clearAllWorkspaceWindows(e))}getAll(){return this.sessionController.getAllFrames().filter((e=>e.active)).map((e=>({windowId:e.windowId})))}getFrameInstance(e){return __awaiter$7(this,void 0,void 0,(function*(){if(e){if(["frameId","itemId","newFrame"].reduce(((t,n)=>(e[n]&&t.push(n),t)),[]).length>1)throw new Error(`Cannot retrieve the frame, because of over-specification: the provided selection object must have either 1 or none of the possible properties: ${JSON.stringify(e)}`)}const t=this.getAll();if(null==e?void 0:e.frameId){const n=t.find((t=>t.windowId===e.frameId));if(!n)throw new Error(`Cannot retrieve a frame with Id: ${e.frameId}, because it is not known by the platform`);return n}return(null==e?void 0:e.itemId)?this.getFrameByItemId(e.itemId,t):(null==e?void 0:e.newFrame)?this.openFrame(e.newFrame):t.length?this.getLastOpenedFrame():this.openFrame()}))}getPlatformFrameSessionData(){return this.sessionController.getAllFrames().find((e=>e.isPlatform))}getFrameConfig(e){return this.sessionController.getAllFrames().find((t=>t.windowId===e))}clearAllWorkspaceWindows(e){const t=this.sessionController.pickWorkspaceClients((t=>t.frameId===e));t.forEach((e=>{this.ioc.applicationsController.unregisterWorkspaceApp({windowId:e.windowId})}))}waitHello(e){return __awaiter$7(this,void 0,void 0,(function*(){return PromisePlus((t=>{this.locks[e]={lift:t}}),this.defaultFrameHelloTimeoutMs,"Frame hello timed out")}))}getLastOpenedFrame(){const e=this.sessionController.getAllFrames().filter((e=>e.active));return e[e.length-1]}getFrameByItemId(e,t){return __awaiter$7(this,void 0,void 0,(function*(){if(!t.length)throw new Error(`Cannot get frame by item id for: ${e}, because not frames were found`);for(const n of t){if("none"!==(yield this.glueController.callFrame(this.frameSummaryOperation,{itemId:e},n.windowId)).id)return n}throw new Error(`Cannot find frame for item: ${e}`)}))}getWorkspacesUrls(){return new URL(window.location.href).protocol.includes("extension")?new Promise((e=>{chrome.storage.local.get("workspacesUrl",(t=>{e(t)}))})):Promise.resolve({workspacesUrl:{current:this.config.src,default:this.config.src}})}handleUnload(){this.myFrameId&&this.clearAllWorkspaceWindows(this.myFrameId)}}class WorkspaceHibernationWatcher{constructor(e,t){this.session=e,this.sequelizer=t}get logger(){return logger.get("workspaces.hibernation")}stop(){this.running=!1}start(e,t){var n,r,i,o;null===(n=this.logger)||void 0===n||n.trace(`starting the hibernation watcher with following settings: ${JSON.stringify(this.settings)}`),this.running=!0,this.workspacesController=e,this.settings=t;const l=this.session.exportClearTimeouts();(null===(i=null===(r=this.settings)||void 0===r?void 0:r.idleWorkspaces)||void 0===i?void 0:i.idleMSThreshold)&&l.forEach((e=>this.buildTimer(e.workspaceId))),null===(o=this.logger)||void 0===o||o.trace("The hibernation watcher has started successfully")}notifyEvent(e){"window"===e.type&&this.handleWorkspaceWindowEvent(e),"workspace"===e.type&&this.handleWorkspaceEvent(e)}handleWorkspaceWindowEvent(e){("opened"===e.action||"added"===e.action)&&(this.sequelizer.enqueue((()=>this.checkMaximumAmountCore())),this.addTimersForWorkspacesInFrame(e.payload.windowSummary.config.frameId))}handleWorkspaceEvent(e){const t="selected"===e.action,n="lock-configuration-changed"===e.action,r=e.payload;if(!("selected"===e.action||"opened"===e.action||"lock-configuration-changed"===e.action))return;this.sequelizer.enqueue((()=>this.checkMaximumAmountCore()));const i=r.workspaceSummary.config.allowSystemHibernation;if(!(t||n&&i))return;const o=this.session.getTimeout(r.workspaceSummary.id);o&&(clearTimeout(o),this.session.removeTimeout(r.workspaceSummary.id)),this.addTimersForWorkspacesInFrame(r.frameSummary.id)}compare(e,t){return e.config.lastActive>t.config.lastActive?1:e.config.lastActive<t.config.lastActive?-1:0}checkMaximumAmountCore(){var e,t,n,r;return __awaiter$7(this,void 0,void 0,(function*(){const i=null===(t=null===(e=this.settings)||void 0===e?void 0:e.maximumActiveWorkspaces)||void 0===t?void 0:t.threshold;if(null===(n=this.logger)||void 0===n||n.trace(`Checking for maximum active workspaces rule. The threshold is ${i}`),"number"!=typeof i)return;const o=shortid$2.generate(),l=(yield this.workspacesController.getAllWorkspacesSummaries({},o)).summaries.map((e=>this.workspacesController.getWorkspaceSnapshot({itemId:e.id},o))),s=(yield Promise.all(l)).filter((e=>!this.isWorkspaceHibernated(e.config)&&!this.isWorkspaceEmpty(e))),a=s.filter((e=>this.isSystemHibernationAllowed(e)));if(s.length<=i)return;null===(r=this.logger)||void 0===r||r.trace(`Found ${a.length} eligible for hibernation workspaces`);const u=a.sort(this.compare).slice(0,s.length-i).map((e=>this.tryHibernateWorkspace(e.id)));yield Promise.all(u)}))}tryHibernateWorkspace(e){var t,n,r;return __awaiter$7(this,void 0,void 0,(function*(){try{const r=yield this.workspacesController.getWorkspaceSnapshot({itemId:e},shortid$2.generate());if(!this.canBeHibernated(r))return;null===(t=this.logger)||void 0===t||t.trace(`trying to hibernate workspace ${e}`),yield this.workspacesController.hibernateWorkspace({workspaceId:e},shortid$2.generate()),null===(n=this.logger)||void 0===n||n.trace(`workspace ${e} was hibernated successfully`)}catch(e){null===(r=this.logger)||void 0===r||r.trace(e)}}))}canBeHibernated(e){const t=this.isWorkspaceHibernated(e.config),n=this.isWorkspaceSelected(e.config),r=this.isWorkspaceEmpty(e),i=this.isSystemHibernationAllowed(e);return!t&&!n&&!r&&i}isWorkspaceHibernated(e){return e.isHibernated}isWorkspaceSelected(e){return e.isSelected}isWorkspaceEmpty(e){return!e.children.length}isSystemHibernationAllowed(e){const{allowSystemHibernation:t}=e.config;return"boolean"!=typeof t||t}getWorkspacesInFrame(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=(yield this.workspacesController.getAllWorkspacesSummaries({},shortid$2.generate())).summaries.reduce(((t,n)=>(n.config.frameId===e&&t.push(this.workspacesController.getWorkspaceSnapshot({itemId:n.id},shortid$2.generate())),t)),[]);return yield Promise.all(t)}))}addTimersForWorkspacesInFrame(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){if(!(null===(n=null===(t=this.settings)||void 0===t?void 0:t.idleWorkspaces)||void 0===n?void 0:n.idleMSThreshold))return;(yield this.getWorkspacesInFrame(e)).forEach((e=>{var t,n,r;this.canBeHibernated(e)&&!this.session.getTimeout(e.id)&&(this.buildTimer(e.id),null===(t=this.logger)||void 0===t||t.trace(`Starting workspace idle timer ( ${null===(r=null===(n=this.settings)||void 0===n?void 0:n.idleWorkspaces)||void 0===r?void 0:r.idleMSThreshold}ms ) for workspace ${e.id}`))}))}))}buildTimer(e){var t,n;const r=window.setTimeout((()=>{var t;this.running&&(null===(t=this.logger)||void 0===t||t.trace(`Timer triggered will try to hibernated ${e}`),this.tryHibernateWorkspace(e),this.session.removeTimeout(e))}),null===(n=null===(t=this.settings)||void 0===t?void 0:t.idleWorkspaces)||void 0===n?void 0:n.idleMSThreshold);this.session.saveTimeout(e,r)}}class SystemController{constructor(e){this.session=e,this.base={},this.started=!1,this.platformOperations=["cleanupClientsOnWorkspaceFrameUnregister"],this.operations={getEnvironment:{name:"getEnvironment",resultDecoder:anyDecoder,execute:this.handleGetEnvironment.bind(this)},getBase:{name:"getBase",resultDecoder:anyDecoder,execute:this.handleGetBase.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)}}}get logger(){return logger.get("applications.controller")}start(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){this.environment=e.environment,this.base={workspaces:{frameCache:e.workspacesFrameCache},workspacesFrameCache:e.workspacesFrameCache,communicationId:null===(t=this.session.getSystemSettings())||void 0===t?void 0:t.systemInstanceId,platformVersion:version},this.started=!0}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this system control message, because the controller has not been started");const o=e.data,l=e.commandId,s=systemOperationTypesDecoder.run(e.operation);if(!s.ok)throw new Error(`This system request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`System request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`System request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase())),n=this.platformOperations.some((t=>t.toLowerCase()===e.operation.toLowerCase()));return{isSupported:t||n}}))}handleGetEnvironment(){return __awaiter$7(this,void 0,void 0,(function*(){return this.environment}))}handleGetBase(){return __awaiter$7(this,void 0,void 0,(function*(){return this.base}))}}class AppDirectory{constructor(e,t){this.sessionStorage=e,this.remoteWatcher=t,this.maxAllowedApplicationsInStore=1e4,this.baseEventFlushDurationMs=10}stop(){this.remoteWatcher.stop()}start(e){var t,n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace("Starting the application directory"),this.appsStateChange=e.appsStateChange,this.sequelizer=e.sequelizer,e.config.local&&e.config.local.length&&(null===(n=this.logger)||void 0===n||n.trace("Detected local applications, parsing..."),yield this.processAppDefinitions(e.config.local,{type:"inmemory",mode:"merge"})),e.config.remote&&(null===(r=this.logger)||void 0===r||r.trace("Detected remote app store configuration, starting the watcher..."),this.remoteWatcher.start(e.config.remote,(e=>this.processAppDefinitions(e,{type:"remote",mode:"replace"}))))}))}processAppDefinitions(e,t){return this.sequelizer.enqueue((()=>__awaiter$7(this,void 0,void 0,(function*(){const n=e.map((e=>this.parseDefinition(e))),r=this.sessionStorage.getAllApps(t.type),i=this[t.mode](r,n);if(i.readyApps.length>this.maxAllowedApplicationsInStore)throw new Error("Cannot save the app definitions, because the total number exceeds 10000, which is the limit.");this.sessionStorage.overwriteApps(i.readyApps,t.type),yield this.announceApps(i)}))))}getAll(){return this.sequelizer.enqueue((()=>__awaiter$7(this,void 0,void 0,(function*(){const e=this.sessionStorage.getAllApps("inmemory"),t=this.sessionStorage.getAllApps("remote");return e.concat(t)}))))}exportInMemory(){return this.sequelizer.enqueue((()=>__awaiter$7(this,void 0,void 0,(function*(){return this.sessionStorage.getAllApps("inmemory").map(this.reverseParseDefinition)}))))}removeInMemory(e){return this.sequelizer.enqueue((()=>__awaiter$7(this,void 0,void 0,(function*(){return this.sessionStorage.removeApp(e,"inmemory")}))))}merge(e,t){const n={readyApps:[],addedApps:[],changedApps:[],removedApps:[]},r=e.reduce(((e,t)=>(e[t.name]=t,e)),{});return t.forEach((e=>r[e.name]&&!objEqualFast(e,r[e.name])?(r[e.name]=e,void n.changedApps.push(e)):r[e.name]?void 0:(r[e.name]=e,void n.addedApps.push(e)))),n.readyApps=Object.values(r),n}replace(e,t){const n={readyApps:[],addedApps:[],changedApps:[],removedApps:[]},r=e.reduce(((e,t)=>(e[t.name]=t,e)),{});return t.forEach((e=>{r[e.name]||n.addedApps.push(e),r[e.name]&&!objEqualFast(e,r[e.name])&&n.changedApps.push(e),r[e.name]&&(r[e.name].isChecked=!0)})),n.removedApps=e.filter((e=>!e.isChecked)),n.readyApps=t,n}reverseParseDefinition(e){const t=e.userProperties.details,n=__rest$4(e.userProperties,["details"]),r={name:e.name,type:e.type||"window",title:e.title,version:e.version,icon:e.icon,caption:e.caption,details:t,customProperties:n};return e.fdc3&&(r.fdc3=e.fdc3),r}parseDefinition(e){const t=["name","title","version","customProperties","icon","caption","type"],n=Object.fromEntries(Object.entries(e).filter((([e])=>!t.includes(e)))),{isFdc3:r}=fdc3.isFdc3Definition(e);let i;if(r)i=fdc3.parseToBrowserBaseAppData(e);else{const t=e.details;i={createOptions:t,type:e.type||"window",name:e.name,title:e.title,version:e.version,icon:e.icon,caption:e.caption,userProperties:Object.assign(Object.assign({},n),e.customProperties)},i.userProperties.details||(i.userProperties.details=t)}return Object.keys(i).forEach((e=>void 0===i[e]&&delete i[e])),i}get logger(){return logger.get("applications.remote.directory")}announceApps(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){const n={appsAdded:e.addedApps,appsChanged:e.changedApps,appsRemoved:e.removedApps};null===(t=this.logger)||void 0===t||t.trace(`announcing a change in the app directory state: ${JSON.stringify(n)}`),this.appsStateChange(n),yield this.waitEventFlush()}))}waitEventFlush(){return new Promise((e=>setTimeout(e,this.baseEventFlushDurationMs)))}}const fetchTimeout=(e,t=defaultFetchTimeoutMs)=>new Promise(((n,r)=>{let i=!1;const o=setTimeout((()=>{i=!0,r(new Error(`Fetch request for: ${JSON.stringify(e)} timed out at: ${t} milliseconds`))}),t);fetch(e).then((e=>{i||(clearTimeout(o),n(e))})).catch((e=>{i||(clearTimeout(o),r(e))}))})),defaultRemoteWatcherHeaders={"Content-Type":"application/json",Accept:"application/json"},defaultRemoteWatcherRequestTimeoutMS=3e3;class RemoteWatcher{start(e,t){var n;this.url=e.url,this.handleApps=t,this.requestTimeout=e.requestTimeout||defaultRemoteWatcherRequestTimeoutMS,this.pollingInterval=e.pollingInterval,this.setRequest(e.customHeaders),null===(n=this.logger)||void 0===n||n.trace(`Remote watcher configured with timeout: ${this.requestTimeout} and interval: ${this.pollingInterval}`),this.running=!0,this.poll()}stop(){this.running=!1}poll(){var e,t;return __awaiter$7(this,void 0,void 0,(function*(){if(this.running)try{const t=yield fetchTimeout(this.request,this.requestTimeout);if(!this.running)return;const n=yield t.json();if(!n||!Array.isArray(n.applications))throw new Error("The remote response was either empty or did not contain an applications collection");null===(e=this.logger)||void 0===e||e.trace("There is a valid response from the app store, processing definitions...");const r=n.applications.reduce(((e,t)=>{var n;const r=allApplicationDefinitionsDecoder.run(t);return r.ok?e.push(t):null===(n=this.logger)||void 0===n||n.warn(`Removing applications definition with name: ${t.name} from the remote response, because of validation error: ${JSON.stringify(r.error)}`),e}),[]);yield this.handleApps(r)}catch(e){const n="string"==typeof e?e:JSON.stringify(e.message);null===(t=this.logger)||void 0===t||t.warn(n)}finally{this.pollingInterval&&(yield this.waitInterval(),this.poll())}}))}setRequest(e={}){var t;const n=new Headers;for(const e in defaultRemoteWatcherHeaders)n.append(e,defaultRemoteWatcherHeaders[e]);for(const r in e)null===(t=this.logger)||void 0===t||t.trace("Custom headers detected and set"),n.append(r,e[r]);this.request=new Request(this.url,{method:"GET",headers:n,mode:"cors",cache:"default"})}waitInterval(){return new Promise((e=>setTimeout(e,this.pollingInterval)))}get logger(){return logger.get("applications.remote.directory")}}class ServiceWorkerController{constructor(e){this.idbController=e,this.registry=CallbackRegistryFactory()}get logger(){return logger.get("service.worker.web.platform")}get serviceWorkerRegistration(){if(!this._serviceWorkerRegistration)throw new Error("Accessing missing service worker registration object. This is caused because the application is trying to raise a persistent notification, which requires a service worker. Please provide a service worker config when initializing GlueWebPlatform.");return this._serviceWorkerRegistration}shutdown(){var e;null===(e=this.channel)||void 0===e||e.removeEventListener("message",this._broadcastMessageHandler),this.registry.clear()}connect(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){if(e.serviceWorker){if(null===(t=this.logger)||void 0===t||t.info("Detected service worker definition, connecting..."),!e.serviceWorker.url&&void 0===e.serviceWorker.registrationPromise)throw new Error("The service worker config is defined, but it is missing a url or a registration promise, please provide one or the other");if(e.serviceWorker.url&&void 0!==e.serviceWorker.registrationPromise)throw new Error("The service worker is over-specified, there is both defined url and a registration promise, please provide one or the other");yield this.prepareSwDb(),this._serviceWorkerRegistration=e.serviceWorker.url?yield this.registerWorker(e.serviceWorker.url):yield this.waitRegistration(e.serviceWorker.registrationPromise),this._serviceWorkerRegistration&&this.setUpBroadcastChannelConnection(),null===(n=this.logger)||void 0===n||n.info("Service worker connection completed.")}}))}showNotification(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){const r=Object.assign({},e,{title:void 0,clickInterop:void 0,actions:void 0});r.actions=null===(n=e.actions)||void 0===n?void 0:n.map((e=>({action:e.action,title:e.title,icon:e.icon})));const i={focusPlatformOnDefaultClick:e.focusPlatformOnDefaultClick,clickInterop:e.clickInterop,actions:e.actions,id:t};r.data?r.data.glueData=i:r.data={glueData:i},yield this.serviceWorkerRegistration.showNotification(e.title,r)}))}notifyReady(){this._serviceWorkerRegistration&&this.channel.postMessage({platformStarted:!0})}onNotificationClick(e){return this.registry.add("notification-click",e)}onNotificationClose(e){return this.registry.add("notification-close",e)}setUpBroadcastChannelConnection(){this.channel=new BroadcastChannel(serviceWorkerBroadcastChannelName),this._broadcastMessageHandler=this.broadcastMessageHandler.bind(this),this.channel.addEventListener("message",this._broadcastMessageHandler)}broadcastMessageHandler(e){var t;const n=e.data,r=null==n?void 0:n.messageType;if(r)if("ping"!==r)if("notificationClick"!==r)if("notificationClose"!==r)"notificationError"!==r||null===(t=this.logger)||void 0===t||t.error(`Service worker error when raising notification: ${n.error}`);else{const e=n.action,t=n.glueData;this.registry.execute("notification-close",{action:e,glueData:t})}else{const e=n.action,t=n.glueData;this.registry.execute("notification-click",{action:e,glueData:t})}else this.channel.postMessage({pong:!0})}registerWorker(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){if("serviceWorker"in navigator)try{return yield navigator.serviceWorker.register(e)}catch(e){const t="string"==typeof e?e:JSON.stringify(e.message);null===(n=this.logger)||void 0===n||n.warn(t)}else null===(t=this.logger)||void 0===t||t.warn(`A defined service worker has not been registered at ${e} because this browser does not support it.`)}))}waitRegistration(e){return __awaiter$7(this,void 0,void 0,(function*(){if("function"!=typeof e.then||"function"!=typeof e.catch)throw new Error("The provided service worker registration promise is not a promise");const t=yield e;if("function"!=typeof t.showNotification)throw new Error("The provided registration promise is a promise, but it resolved with an object which does not appear to be a ServiceWorkerRegistration");return t}))}prepareSwDb(){return __awaiter$7(this,void 0,void 0,(function*(){yield this.idbController.clearServiceWorker(),yield this.idbController.storeServiceWorker({platformUrl:window.location.href})}))}}const setNotificationDefaults=e=>{e.showToast="boolean"!=typeof e.showToast||e.showToast,e.showInPanel="boolean"!=typeof e.showInPanel||e.showInPanel,e.timestamp=void 0===e.timestamp?Date.now():e.timestamp,e.state=void 0===e.state?"Active":e.state},notificationsOperationDecoder=oneOf$1(constant$1("raiseNotification"),constant$1("requestPermission"),constant$1("getPermission"),constant$1("operationCheck"),constant$1("list"),constant$1("clear"),constant$1("click"),constant$1("clearAll"),constant$1("configure"),constant$1("getConfiguration"),constant$1("setState"),constant$1("clearOld")),interopActionSettingsDecoder=object$1({method:nonEmptyStringDecoder$1,arguments:optional$1(anyJson$1()),target:optional$1(oneOf$1(constant$1("all"),constant$1("best")))}),glue42NotificationActionDecoder=object$1({action:string$1(),title:nonEmptyStringDecoder$1,icon:optional$1(string$1()),interop:optional$1(interopActionSettingsDecoder)}),notificationStateDecoder=oneOf$1(constant$1("Active"),constant$1("Acknowledged"),constant$1("Seen"),constant$1("Closed"),constant$1("Stale"),constant$1("Snoozed"),constant$1("Processing")),glue42NotificationOptionsDecoder=object$1({title:nonEmptyStringDecoder$1,clickInterop:optional$1(interopActionSettingsDecoder),actions:optional$1(array$1(glue42NotificationActionDecoder)),focusPlatformOnDefaultClick:optional$1(boolean()),badge:optional$1(string$1()),body:optional$1(string$1()),data:optional$1(anyJson$1()),dir:optional$1(oneOf$1(constant$1("auto"),constant$1("ltr"),constant$1("rtl"))),icon:optional$1(string$1()),image:optional$1(string$1()),lang:optional$1(string$1()),renotify:optional$1(boolean()),requireInteraction:optional$1(boolean()),silent:optional$1(boolean()),tag:optional$1(string$1()),timestamp:optional$1(nonNegativeNumberDecoder$1),vibrate:optional$1(array$1(number$1())),severity:optional$1(oneOf$1(constant$1("Low"),constant$1("None"),constant$1("Medium"),constant$1("High"),constant$1("Critical"))),showToast:optional$1(boolean()),showInPanel:optional$1(boolean()),state:optional$1(notificationStateDecoder)}),glue42NotificationOptionsWithDefaultsDecoder=object$1({title:nonEmptyStringDecoder$1,clickInterop:optional$1(interopActionSettingsDecoder),actions:optional$1(array$1(glue42NotificationActionDecoder)),focusPlatformOnDefaultClick:optional$1(boolean()),badge:optional$1(string$1()),body:optional$1(string$1()),data:optional$1(anyJson$1()),dir:optional$1(oneOf$1(constant$1("auto"),constant$1("ltr"),constant$1("rtl"))),icon:optional$1(string$1()),image:optional$1(string$1()),lang:optional$1(string$1()),renotify:optional$1(boolean()),requireInteraction:optional$1(boolean()),silent:optional$1(boolean()),tag:optional$1(string$1()),timestamp:nonNegativeNumberDecoder$1,vibrate:optional$1(array$1(number$1())),severity:optional$1(oneOf$1(constant$1("Low"),constant$1("None"),constant$1("Medium"),constant$1("High"),constant$1("Critical"))),showToast:boolean(),showInPanel:boolean(),state:optional$1(notificationStateDecoder)}),raiseNotificationDecoder=object$1({settings:glue42NotificationOptionsDecoder,id:nonEmptyStringDecoder$1}),raiseNotificationResultDecoder=object$1({settings:glue42NotificationOptionsWithDefaultsDecoder}),permissionRequestResultDecoder=object$1({permissionGranted:boolean()}),permissionQueryResultDecoder=object$1({permission:oneOf$1(constant$1("default"),constant$1("granted"),constant$1("denied"))}),simpleNotificationSelectDecoder=object$1({id:nonEmptyStringDecoder$1}),notificationClickConfigDecoder=object$1({id:nonEmptyStringDecoder$1,action:optional$1(nonEmptyStringDecoder$1)}),notificationsDataDecoder=object$1({id:nonEmptyStringDecoder$1,title:nonEmptyStringDecoder$1,clickInterop:optional$1(interopActionSettingsDecoder),actions:optional$1(array$1(glue42NotificationActionDecoder)),focusPlatformOnDefaultClick:optional$1(boolean()),badge:optional$1(string$1()),body:optional$1(string$1()),data:optional$1(anyJson$1()),dir:optional$1(oneOf$1(constant$1("auto"),constant$1("ltr"),constant$1("rtl"))),icon:optional$1(string$1()),image:optional$1(string$1()),lang:optional$1(string$1()),renotify:optional$1(boolean()),requireInteraction:optional$1(boolean()),silent:optional$1(boolean()),tag:optional$1(string$1()),timestamp:optional$1(nonNegativeNumberDecoder$1),vibrate:optional$1(array$1(number$1())),severity:optional$1(oneOf$1(constant$1("Low"),constant$1("None"),constant$1("Medium"),constant$1("High"),constant$1("Critical"))),showToast:optional$1(boolean()),showInPanel:optional$1(boolean()),state:optional$1(notificationStateDecoder)}),allNotificationsDataDecoder=object$1({notifications:array$1(notificationsDataDecoder)}),notificationsConfigurationDecoder=object$1({enable:optional$1(boolean()),enableToasts:optional$1(boolean()),sourceFilter:optional$1(notificationFilterDecoder)}),notificationsConfigurationProtocolDecoder=object$1({configuration:notificationsConfigurationDecoder}),notificationSetStateRequestDecoder=object$1({id:nonEmptyStringDecoder$1,state:notificationStateDecoder});class NotificationsController{constructor(e,t,n,r){this.glueController=e,this.serviceWorkerController=t,this.session=n,this.localStorage=r,this.started=!1,this.isInExtension=!1,this.systemUnsubFuncs=[],this.operations={raiseNotification:{name:"raiseNotification",execute:this.handleRaiseNotification.bind(this),dataDecoder:raiseNotificationDecoder,resultDecoder:raiseNotificationResultDecoder},requestPermission:{name:"requestPermission",resultDecoder:permissionRequestResultDecoder,execute:this.handleRequestPermission.bind(this)},getPermission:{name:"getPermission",resultDecoder:permissionQueryResultDecoder,execute:this.handleGetPermission.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)},list:{name:"list",resultDecoder:allNotificationsDataDecoder,execute:this.handleList.bind(this)},click:{name:"click",dataDecoder:notificationClickConfigDecoder,execute:this.handleClick.bind(this)},clear:{name:"clear",dataDecoder:simpleNotificationSelectDecoder,execute:this.handleClear.bind(this)},clearAll:{name:"clearAll",execute:this.handleClearAll.bind(this)},configure:{name:"configure",dataDecoder:notificationsConfigurationProtocolDecoder,execute:this.handleConfigure.bind(this)},getConfiguration:{name:"getConfiguration",resultDecoder:notificationsConfigurationProtocolDecoder,execute:this.handleGetConfiguration.bind(this)},setState:{name:"setState",dataDecoder:notificationSetStateRequestDecoder,execute:this.handleSetState.bind(this)},clearOld:{name:"clearOld",execute:this.handleClearOld.bind(this)}}}get logger(){return logger.get("notifications.controller")}get config(){const e=this.localStorage.getNotificationsConfig();if(!e)throw new Error("The notifications configuration has not been set.");return e}get currentActiveCount(){return this.session.getAllNotifications().reduce(((e,t)=>"Active"===t.state?e+1:e),0)}handlePlatformShutdown(){this.started=!1;new URL(window.location.href).protocol.includes("extension")&&this.removeExtensionNotificationsListeners(),this.systemUnsubFuncs.forEach((e=>e())),this.systemUnsubFuncs=[]}start(){return __awaiter$7(this,void 0,void 0,(function*(){this.clearNotificationOnClick=this.config.clearNotificationOnClick;new URL(window.location.href).protocol.includes("extension")&&(yield this.setupExtensionNotifications()),this.listenForServiceWorkerNotificationEvents(),this.started=!0}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this notifications control message, because the controller has not been started");const o=e.data,l=e.commandId,s=e.callerId,a=notificationsOperationDecoder.run(e.operation);if(!a.ok)throw new Error(`This notifications request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(a.error)}`);const u=a.result,c=null===(t=this.operations[u].dataDecoder)||void 0===t?void 0:t.run(o);if(c&&!c.ok)throw new Error(`Notifications request for ${u} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(c.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${u} command is valid with data: ${JSON.stringify(o)}`);const h=yield this.operations[u].execute(o,l,s),d=null===(r=this.operations[u].resultDecoder)||void 0===r?void 0:r.run(h);if(d&&!d.ok)throw new Error(`Notifications request for ${u} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(d.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${u} command was executed successfully`),h}))}handleConfigure({configuration:e},t,n=""){var r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`[${t}] handling a notification configure message with data: ${JSON.stringify(e)}`),this.validateServiceAccess(n,!0),this.localStorage.updateNotificationsConfig(e),this.glueController.pushSystemMessage("notifications","configurationChanged",{configuration:this.config}),null===(i=this.logger)||void 0===i||i.trace(`[${t}] handling a notification configure message completed`)}))}handleGetConfiguration(e,t,n=""){var r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`[${t}] handling a get notification configure message`),this.validateServiceAccess(n,!0);const e=Object.assign({},this.config);return null===(i=this.logger)||void 0===i||i.trace(`[${t}] handling a get notification configure message completed`),{configuration:e}}))}handleList(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a list notification message`);const e=this.session.getAllNotifications();return null===(r=this.logger)||void 0===r||r.trace(`[${t}] list notification message completed`),{notifications:e}}))}handleSetState({id:e,state:t},n){var r;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`[${n}] handling a set state notification message with data: ${JSON.stringify({id:e,state:t})}`);const i=this.session.getNotification(e);if(!i)throw new Error(`Cannot set state of a notification: ${e}, because it doesn't exist`);const o=this.currentActiveCount;i.state=t,this.session.updateNotification(i),this.glueController.pushSystemMessage("notifications","stateChange",{id:e,state:t}),this.syncActiveCount(o)}))}handleClick(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a click notification message with data: ${JSON.stringify(e)}`);const o=this.session.getNotification(e.id);if(!o)throw new Error(`Cannot click a notification: ${e.id}, because it doesn't exist`);if(e.action&&(null===(r=o.actions)||void 0===r?void 0:r.every((t=>t.action!==e.action))))throw new Error(`Cannot click action ${e.action} of  ${e.id}, because that notification does not have that action`);this.handleNotificationClick({notification:o,action:e.action}),null===(i=this.logger)||void 0===i||i.trace(`[${t}] handling a click notification message completed`)}))}handleClear(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a clear notification message with data: ${JSON.stringify(e)}`);const i=this.currentActiveCount;this.removeNotification(e.id),this.syncActiveCount(i),null===(r=this.logger)||void 0===r||r.trace(`[${t}] handling a clear notification message completed`)}))}handleClearAll(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a clearAll notifications message`);const e=this.session.getAllNotifications(),i=e.reduce(((e,t)=>"Active"===t.state?e+1:e),0);e.forEach((e=>this.removeNotification(e.id))),this.syncActiveCount(i),null===(r=this.logger)||void 0===r||r.trace(`[${t}] handling a clearAll notification message completed`)}))}handleClearOld(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a clearOld notifications message`);const e=this.session.getAllNotifications(),i=e.reduce(((e,t)=>"Active"===t.state?e+1:e),0);e.filter((e=>"Active"!==e.state)).forEach((e=>this.removeNotification(e.id))),this.syncActiveCount(i),null===(r=this.logger)||void 0===r||r.trace(`[${t}] handling a clearOld notification message completed`)}))}handleRaiseNotification({settings:e,id:t},n,r=""){var i,o;return __awaiter$7(this,void 0,void 0,(function*(){if(null===(i=this.logger)||void 0===i||i.trace(`[${n}] handling a raise notification message with a title: ${e.title}`),!this.config.enable)throw new Error("Cannot raise a notification, because the notifications service is disabled");this.validateServiceAccess(r);const l=this.currentActiveCount;setNotificationDefaults(e),this.processNewNotification(e,t);const s=this.config.enableToasts?!!e.showToast:this.config.enableToasts;yield this.showToast({settings:e,id:t},s,n);const a={definition:Object.assign({},e,{title:void 0,clickInterop:void 0,actions:void 0}),id:t};return setTimeout((()=>this.glueController.pushSystemMessage("notifications","notificationShow",a)),0),null===(o=this.logger)||void 0===o||o.trace(`[${n}] notification with a title: ${e.title} was successfully raised`),this.syncActiveCount(l),{settings:e}}))}showToast({settings:e,id:t},n,r){return __awaiter$7(this,void 0,void 0,(function*(){if(!n)return;if(this.isInExtension)return void(yield this.raiseExtensionToast(e,t,r));e.actions&&e.actions.length?yield this.raiseActionsToast(e,t,r):this.raiseSimpleToast(e,t,r)}))}handleGetPermission(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a get permission message`);const e=Notification.permission;return null===(r=this.logger)||void 0===r||r.trace(`[${t}] permission for raising notifications is: ${e}`),{permission:e}}))}handleRequestPermission(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a request permission message`);let e=Notification.permission;"granted"!==e&&(e=yield Notification.requestPermission());const i="granted"===e;return null===(r=this.logger)||void 0===r||r.trace(`[${t}] permission for raising notifications is: ${e}`),{permissionGranted:i}}))}validateServiceAccess(e,t){const n=this.glueController.getAppNameByInstanceId(e)||"";if(t&&e===this.glueController.me.instance)return;if(this.config.sourceFilter.blocked.includes(n))throw new Error(`Cannot complete the notifications operation, because the caller app: ${n} is blocked from the notifications service`);const r=this.config.sourceFilter.allowed.includes("*"),i=this.config.sourceFilter.allowed.includes(n);if(!r&&!i)throw new Error(`Cannot complete the notifications operation, because the caller app: ${n} is not present in the allowed list of the notifications service`)}raiseSimpleToast(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`[${n}] notification with a title: ${e.title} was found to be non-persistent and therefore will be raised with the native notifications API`);const i=Object.assign({},e,{title:void 0,clickInterop:void 0}),o=new Notification(e.title,i);o.onclick=()=>{e.focusPlatformOnDefaultClick&&window.focus();const n=this.session.getNotification(t);n&&this.handleNotificationClick({action:"",notification:n})},o.onclose=()=>{const e=this.currentActiveCount;this.removeNotification(t),this.syncActiveCount(e)}}))}raiseActionsToast(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`[${n}] notification with a title: ${e.title} was found to be persistent and therefore the service worker will be instructed to raise it.`),yield this.serviceWorkerController.showNotification(e,t)}))}raiseExtensionToast(e,t,n){return new Promise(((r,i)=>{var o;if(null===(o=this.logger)||void 0===o||o.trace(`[${n}] notification with a title: ${e.title} will be raised with the native extension notifications API, because the platform is running in extension mode`),!this.extNotificationConfig)return i("Cannot raise a notification, because the environment settings for the extension mode are missing.");const l=e.actions?e.actions.map((e=>({title:e.title,iconUrl:e.icon}))):void 0,s={type:"basic",iconUrl:e.icon||this.extNotificationConfig.defaultIcon,title:e.title,message:e.body||this.extNotificationConfig.defaultMessage,silent:e.silent,requireInteraction:e.requireInteraction,imageUrl:e.image,buttons:l};chrome.notifications.create(t,s,(()=>r()))}))}setupExtensionNotifications(){return __awaiter$7(this,void 0,void 0,(function*(){this.isInExtension=!0,this.extNotificationConfig=(yield this.getExtNotificationsConfig()).notifications,this.listenForExtensionNotificationsEvents()}))}listenForExtensionNotificationsEvents(){this._chromeClickedHandler=this.chromeClickedHandler.bind(this),chrome.notifications.onClicked.addListener(this._chromeClickedHandler),this._chromeButtonClickedHandler=this.chromeButtonClickedHandler.bind(this),chrome.notifications.onButtonClicked.addListener(this._chromeButtonClickedHandler),this._chromeClosedHandler=this.chromeClosedHandler.bind(this),chrome.notifications.onClosed.addListener(this._chromeClosedHandler)}removeExtensionNotificationsListeners(){chrome.notifications.onClicked.removeListener(this._chromeClickedHandler),chrome.notifications.onButtonClicked.removeListener(this._chromeButtonClickedHandler),chrome.notifications.onClosed.removeListener(this._chromeClosedHandler)}chromeClickedHandler(e){const t=this.session.getNotification(e);t&&this.handleNotificationClick({notification:t})}chromeButtonClickedHandler(e,t){const n=this.session.getNotification(e);if(!n)return;if(!n.actions)return;const r=n.actions[t].action;this.handleNotificationClick({action:r,notification:n})}chromeClosedHandler(e){const t=this.currentActiveCount;this.removeNotification(e),this.syncActiveCount(t)}listenForServiceWorkerNotificationEvents(){const e=this.serviceWorkerController.onNotificationClick((e=>{const t=this.session.getNotification(e.glueData.id);t&&this.handleNotificationClick({action:e.action,notification:t})})),t=this.serviceWorkerController.onNotificationClose((e=>{const t=this.currentActiveCount;this.removeNotification(e.glueData.id),this.syncActiveCount(t)}));this.systemUnsubFuncs.push(e),this.systemUnsubFuncs.push(t)}getExtNotificationsConfig(){return new Promise((e=>{chrome.storage.local.get("notifications",(t=>{e(t)}))}))}handleNotificationClick(e){var t,n;!e.action&&e.notification.clickInterop&&this.callDefinedInterop(e.notification.clickInterop);const r=e.action?null===(t=e.notification.actions)||void 0===t?void 0:t.find((t=>t.action===e.action)):null;r&&r.interop&&this.callDefinedInterop(r.interop),(null===(n=e.notification.data)||void 0===n?void 0:n.glueData)&&delete e.notification.data.glueData;const i={definition:e.notification,action:e.action,id:e.notification.id};if(this.clearNotificationOnClick){const t=this.currentActiveCount;this.removeNotification(e.notification.id),this.syncActiveCount(t)}this.glueController.pushSystemMessage("notifications","notificationClick",i)}callDefinedInterop(e){const t=e.method,n=e.arguments,r=e.target;this.glueController.invokeMethod(t,n,r).catch((e=>{var t;const n="string"==typeof e?e:JSON.stringify(e.message);null===(t=this.logger)||void 0===t||t.warn(`The interop invocation defined in the clickInterop was rejected, reason: ${n}`)}))}processNewNotification(e,t){const n=Object.assign({id:t},e);this.session.saveNewNotification(n),this.glueController.pushSystemMessage("notifications","notificationRaised",{notification:n})}removeNotification(e){this.session.removeNotification(e),this.glueController.pushSystemMessage("notifications","notificationClosed",{id:e})}syncActiveCount(e){const t=this.currentActiveCount;e!==t&&this.glueController.pushSystemMessage("notifications","activeCountChange",{count:t})}}const extensionOperationTypesDecoder=oneOf$1(constant$1("clientHello"),constant$1("operationCheck")),clientHelloResponseDecoder=object$1({widget:object$1({inject:boolean()})}),clientHelloDecoder=object$1({windowId:optional$1(nonEmptyStringDecoder$1)});class ExtensionController{constructor(e){this.session=e,this.started=!1,this.operations={clientHello:{name:"appHello",resultDecoder:clientHelloResponseDecoder,dataDecoder:clientHelloDecoder,execute:this.handleClientHello.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)}}}get logger(){return logger.get("extension.controller")}handlePlatformShutdown(){this.started=!1}start(){var e;return __awaiter$7(this,void 0,void 0,(function*(){this.started=!0,null===(e=this.logger)||void 0===e||e.trace("initialization is completed")}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this extension control message, because the controller has not been started");const o=e.data,l=e.commandId,s=extensionOperationTypesDecoder.run(e.operation);if(!s.ok)throw new Error(`This extension request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Extension request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Extension request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleClientHello(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling client hello command`);const i=(yield this.getWidgetConfig()).widget,o={widget:{inject:!(!!e.windowId&&!!this.session.getFrameData(e.windowId))&&(!!i&&i.enable)}};return null===(r=this.logger)||void 0===r||r.trace(`[${t}] responding to client hello command with: ${JSON.stringify(o)}`),o}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}getWidgetConfig(){return new URL(window.location.href).protocol.includes("extension")?new Promise((e=>{chrome.storage.local.get("widget",(t=>{e(t)}))})):Promise.resolve({widget:{enable:!1}})}}class AsyncSequelizer{constructor(e=0){this.minSequenceInterval=e,this.queue=[],this.isExecutingQueue=!1}enqueue(e){return new Promise(((t,n)=>{this.queue.push({action:e,resolve:t,reject:n}),this.executeQueue()}))}executeQueue(){return __awaiter$7(this,void 0,void 0,(function*(){if(!this.isExecutingQueue){for(this.isExecutingQueue=!0;this.queue.length;){const e=this.queue.shift();if(!e)return void(this.isExecutingQueue=!1);try{const t=yield e.action();e.resolve(t)}catch(t){e.reject(t)}yield this.intervalBreak()}this.isExecutingQueue=!1}}))}intervalBreak(){return new Promise((e=>setTimeout(e,this.minSequenceInterval)))}}class PreferredConnectionController{constructor(e,t,n){this.glueController=e,this.portsBridge=t,this.sequelizer=n,this.registry=CallbackRegistryFactory(),this.stopped=!1}get logger(){return logger.get("preferred.connection.controller")}shutdown(){this.stopped=!0,this.registry.clear()}start(e){var t,n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`Starting the preferred connection with config: ${JSON.stringify(e)}`),this.stopped=!1,this.portsBridge.setPreferredActivated(),e.preferred&&(this.preferredUrl=e.preferred.url,this.preferredAuth=Object.assign({},{provider:"core"},e.preferred.auth),this.shouldForceTransfer="boolean"==typeof e.preferred.forceIncompleteSwitch&&e.preferred.forceIncompleteSwitch,this.discoveryInterval="number"==typeof e.preferred.discoveryIntervalMS?e.preferred.discoveryIntervalMS:defaultPreferredDiscoveryIntervalMS,null===(n=this.logger)||void 0===n||n.trace("Starting the initial preferred connection check"),yield this.connectPreferred(),null===(r=this.logger)||void 0===r||r.trace("The preferred connection controller initiated."))}))}onReconnect(e){return this.registry.add("system-reconnect",e)}connectPreferred(e,t,n){var r,i,o,l,s,a;return __awaiter$7(this,void 0,void 0,(function*(){if(this.stopped&&!e)return;const u=yield this.checkPreFlight(t);if(!u.ready&&e)throw new Error("The provided preferred connection is not ready.");if(!u.ready)return null===(r=this.logger)||void 0===r||r.trace("The preflight is not ready, restarting the preferred tracking."),void wait(this.discoveryInterval).then((()=>this.connectPreferred(e,t,n)));const c={type:"secondary",transportConfig:Object.assign({url:t||this.preferredUrl},{auth:n||this.preferredAuth})};if(null===(i=this.logger)||void 0===i||i.trace("Switching the system glue."),this.stopped)return;if(!(yield this.glueController.switchTransport(c,"system")).success)return null===(o=this.logger)||void 0===o||o.trace("The switch attempt was not successful, revered to default."),void wait(this.discoveryInterval).then((()=>this.connectPreferred(e,t,n)));this.portsBridge.setActivePreferredTransportConfig(c),null===(l=this.logger)||void 0===l||l.trace("The switch to the preferred connection was successful, transferring all children.");try{yield this.changeClientsConnection(c)}catch(r){return null===(s=this.logger)||void 0===s||s.warn(`Some platform clients could not connect to the preferred connection, reverting all to the default connection. Reason: ${JSON.stringify(r)}`),void this.fullDefaultRevert().then((()=>wait(this.discoveryInterval).then((()=>this.connectPreferred(e,t,n))))).catch((()=>wait(this.discoveryInterval).then((()=>this.connectPreferred(e,t,n)))))}null===(a=this.logger)||void 0===a||a.trace("The platform is now fully connected to the preferred connection, hooking up disconnection logic."),this.registry.execute("system-reconnect");const h=this.glueController.onDisconnected((()=>this.handleDisconnected(h,e)));this.unsub=h}))}revertToDefault(){return __awaiter$7(this,void 0,void 0,(function*(){this.unsub&&(this.unsub(),delete this.unsub),yield this.fullDefaultRevert()}))}fullDefaultRevert(){return __awaiter$7(this,void 0,void 0,(function*(){yield this.glueController.switchTransport({type:"default"},"system"),this.portsBridge.setActivePreferredTransportConfig({type:"default"}),yield this.changeClientsConnection({type:"default"})}))}handleDisconnected(e,t){var n;null===(n=this.logger)||void 0===n||n.trace("The platform has been disconnected from the preferred transport, reverting all to the default one."),e(),this.fullDefaultRevert().then((()=>{var e;this.registry.execute("system-reconnect"),null===(e=this.logger)||void 0===e||e.trace("The platform reversion to default completed, restarting the preferred tracking."),t||wait(this.discoveryInterval).then((()=>this.connectPreferred()))})).catch((()=>wait(this.discoveryInterval).then((()=>this.connectPreferred()))))}changeClientsConnection(e){return this.sequelizer.enqueue((()=>__awaiter$7(this,void 0,void 0,(function*(){var t,n,r;try{yield Promise.all([this.glueController.switchTransport(e,"client"),this.portsBridge.switchAllClientsTransport(e)])}catch(e){if(null===(t=this.logger)||void 0===t||t.trace(`Some clients could not connect to the preferred transport with error: ${JSON.stringify(e)}`),!this.shouldForceTransfer)throw null===(n=this.logger)||void 0===n||n.trace("The platform is not forcing a transfer in cases of errors, re-throwing."),new Error(e);null===(r=this.logger)||void 0===r||r.trace("The platform is forcing a transfer regardless of the errors.")}yield this.glueController.switchTransport(e,"contextsTrack")}))))}checkPreferredConnection(e){return new Promise((t=>{const n=new WebSocket(e);n.onerror=()=>t({live:!1}),n.onopen=()=>{n.close(),t({live:!0})}}))}checkPreFlight(e){var t,n,r,i,o,l,s,a,u;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace("Starting the preflight check");if(!(yield this.checkPreferredConnection(e||this.preferredUrl)).live)return null===(n=this.logger)||void 0===n||n.trace("The preferred connection is not live."),{ready:!1};null===(r=this.logger)||void 0===r||r.trace(`Found a live preferred connection at: ${e||this.preferredUrl}, testing the availability of transport switching logic in all current clients`);const c=yield this.portsBridge.checkClientsPreferredLogic();if(null===(i=this.logger)||void 0===i||i.trace(`The logic check returned: ${JSON.stringify(c)}`),!c.success&&!this.shouldForceTransfer)return null===(o=this.logger)||void 0===o||o.trace("The preflight check is marked as not ready"),{ready:!1};null===(l=this.logger)||void 0===l||l.trace("Checking the possibility of all clients to connect to the preferred connection");const h=yield this.portsBridge.checkClientsPreferredConnection(e||this.preferredUrl);return null===(s=this.logger)||void 0===s||s.trace(`The connection check returned: ${JSON.stringify(h)}`),h.success||this.shouldForceTransfer?(null===(u=this.logger)||void 0===u||u.trace("The preflight check is marked as ready"),{ready:!0}):(null===(a=this.logger)||void 0===a||a.trace("The preflight check is marked as not ready"),{ready:!1})}))}}class TransactionsController{constructor(){this.transactionLocks={}}get logger(){return logger.get("transactions.controller")}completeTransaction(e,t){var n;if("string"!=typeof e)throw new Error(`Cannot complete the transaction, because the provided id is not a string: ${JSON.stringify(e)}`);const r=this.transactionLocks[e];r?r.lift(t):null===(n=this.logger)||void 0===n||n.warn(`Cannot mark a transaction as complete, because there is not lock with id ${e}`)}failTransaction(e,t){var n;const r=this.transactionLocks[e];r?r.fail(t):null===(n=this.logger)||void 0===n||n.warn(`Cannot mark a transaction as failed, because there is not lock with id ${e}`)}createTransaction(e,t){const n={},r=shortid$2.generate(),i=new Promise(((i,o)=>{let l=!0;n.lift=e=>{l=!1,delete this.transactionLocks[r],i(e)},n.fail=e=>{l=!1,delete this.transactionLocks[r],o(e)},setTimeout((()=>{var t;l&&(l=!1,null===(t=this.logger)||void 0===t||t.warn(`Transaction for operation: ${e} timed out.`),delete this.transactionLocks[r],o(`Transaction for operation: ${e} timed out.`))}),t)}));return n.lock=i,n.id=r,this.transactionLocks[r]=n,n}}class InterceptionController{constructor(){this.interceptions=[]}shutdown(){this.interceptions=[]}registerInterceptor(e,t){return __awaiter$7(this,void 0,void 0,(function*(){interceptorRegistrationRequestDecoder.runWithException(e),nonEmptyStringDecoder$1.runWithException(t);const n=e.interceptions.reduce(((e,t)=>(this.interceptions.some((e=>e.domain===t.domain&&e.operation===t.operation))&&e.push({domain:t.domain,operation:t.operation}),e)),[]);if(n.length){const e=n.map((e=>`${e.domain} - ${e.operation}`)).join(", ");throw new Error(`Interception registration is rejected, because the following collisions where found: ${e}`)}e.interceptions.forEach((n=>{this.interceptions.push({domain:n.domain,operation:n.operation,callInterceptor:e.callInterceptor,registrantName:t})}))}))}getOperationInterceptor(e){const t=this.interceptions.find((t=>t.domain===e.domain&&t.operation===e.operation));if(t)return{name:t.registrantName,intercept:t.callInterceptor}}}class PluginsController{constructor(e,t){this.interceptionController=e,this.glueController=t,this.registeredPlugins=[]}get logger(){return logger.get("plugins.controller")}shutdown(){return __awaiter$7(this,void 0,void 0,(function*(){this.allPlugins.forEach((e=>{var t;if(e.stop)try{e.stop()}catch(n){null===(t=this.logger)||void 0===t||t.warn(`Plugin: ${e.name} threw while onPlatformShutdown -> ${extractErrorMsg$1(n)}`)}})),this.allPlugins=[],this.registeredPlugins=[]}))}start(e){return __awaiter$7(this,void 0,void 0,(function*(){if(!e.plugins)return;if(this.allPlugins=e.plugins,this.handlePluginMessage=e.handlePluginMessage,this.platformApi=e.api,!e.plugins||!e.plugins.length)return;const t=[];for(const n of e.plugins){const e=this.startPlugin(n);n.critical&&t.push(e)}yield Promise.all(t)}))}startPlugin(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){try{const n=this.buildPlatformControls(e.name,this.platformApi);yield e.start(this.glueController.clientGlue,e.config,n),this.registerPlugin(e.name,null!==(t=e.version)&&void 0!==t?t:"N/A")}catch(t){const r="string"==typeof t?t:JSON.stringify(t.message),i=`Plugin: ${e.name} threw while initiating: ${r}`;if(e.critical)throw new Error(i);null===(n=this.logger)||void 0===n||n.warn(i)}}))}buildPlatformControls(e,t){return{control:t=>this.handlePluginMessage(t,e),logger:logger.get(e),platformApi:t,interception:{register:t=>this.interceptionController.registerInterceptor(t,e)},system:{sendControl:t=>this.handlePluginMessage(t,e)}}}registerPlugin(e,t){if("string"!=typeof e||!e.length)return;this.registeredPlugins.some((t=>t.name===e))||this.registeredPlugins.push({name:e,version:t})}}class DomainsController{constructor(e,t,n,r,i,o,l,s,a,u,c,h,d){this.systemController=e,this.windowsController=t,this.applicationsController=n,this.layoutsController=r,this.workspacesController=i,this.intentsController=o,this.channelsController=l,this.notificationsController=s,this.extensionController=a,this.searchController=u,this.themesController=c,this.managerController=h,this.prefsController=d,this.defaultDomainNames=["system","windows","appManager","layouts","workspaces","intents","channels","notifications","extension","search","themes","prefs"],this.domains={system:{name:"system",libController:this.systemController},windows:{name:"windows",libController:this.windowsController},appManager:{name:"appManager",libController:this.applicationsController},layouts:{name:"layouts",libController:this.layoutsController},workspaces:{name:"workspaces",libController:this.workspacesController},intents:{name:"intents",libController:this.intentsController},channels:{name:"channels",libController:this.channelsController},notifications:{name:"notifications",libController:this.notificationsController},extension:{name:"extension",libController:this.extensionController},search:{name:"search",libController:this.searchController},themes:{name:"themes",libController:this.themesController},manager:{name:"manager",libController:this.managerController},prefs:{name:"prefs",libController:this.prefsController}}}get logger(){return logger.get("domains.controller")}shutdown(){Object.values(this.domains).forEach((e=>e.libController.handlePlatformShutdown?e.libController.handlePlatformShutdown():null)),this.domains={system:{name:"system",libController:this.systemController},windows:{name:"windows",libController:this.windowsController},appManager:{name:"appManager",libController:this.applicationsController},layouts:{name:"layouts",libController:this.layoutsController},workspaces:{name:"workspaces",libController:this.workspacesController},intents:{name:"intents",libController:this.intentsController},channels:{name:"channels",libController:this.channelsController},notifications:{name:"notifications",libController:this.notificationsController},extension:{name:"extension",libController:this.extensionController},search:{name:"search",libController:this.searchController},themes:{name:"themes",libController:this.themesController},prefs:{name:"prefs",libController:this.prefsController}}}validateDomain(e){const t=this.domains[e];if(!t)throw new Error(`Accessing a missing domain: ${e}.`);const n=t.domainNameDecoder?t.domainNameDecoder:libDomainDecoder;null==n||n.runWithException(e)}startAllDomains(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace("Starting all domains lib controllers"),yield Promise.all(Object.values(this.domains).map((t=>t.libController.start(e)))),null===(n=this.logger)||void 0===n||n.trace("All domains have been initialized")}))}configurePostStartAllDomains(){var e,t;return __awaiter$7(this,void 0,void 0,(function*(){null===(e=this.logger)||void 0===e||e.trace("Starting all domains lib controllers"),yield Promise.all(Object.values(this.domains).filter((e=>!!e.libController.configurePostStart)).map((e=>e.libController.configurePostStart&&e.libController.configurePostStart()))),null===(t=this.logger)||void 0===t||t.trace("All domains have been initialized")}))}notifyDomainsClientUnloaded(e){var t;null===(t=this.logger)||void 0===t||t.trace(`detected unloading of client: ${e.windowId}, notifying all controllers`),Object.values(this.domains).forEach((t=>{var n,r,i;try{null===(r=(n=t.libController).handleClientUnloaded)||void 0===r||r.call(n,e.windowId,e.win)}catch(n){const r="string"==typeof n?n:JSON.stringify(n.message),o=t.name;null===(i=this.logger)||void 0===i||i.error(`${o} controller threw when handling unloaded client ${e.windowId} with error message: ${r}`)}}))}executeControlMessage(e){const t=this.domains[e.domain];if(!t)throw new Error(`Cannot process message for domain: ${e.domain} and operation ${e.operation}, because no domain can service it.`);return t.libController.handleControl(e)}registerDynamicDomain(e){if(Object.values(this.domains).map((e=>e.name)).some((t=>t===e.name)))throw new Error(`Cannot register a domain with name: ${e.name}, because it is already registered`);if(!(e.libController&&e.libController.start&&e.libController.handleControl&&e.libController.handleClientUnloaded))throw new Error(`Cannot register a domain with name: ${e.name}, because it does not have a valid libController`);if(!e.domainNameDecoder)throw new Error(`Cannot register a domain with name: ${e.name}, because it does not have a domain decoder`);this.domains[e.name]=e}unregisterDynamicDomain(e){if(this.defaultDomainNames.some((t=>t===e)))throw new Error(`Cannot unregister a domain: ${e}, because it is a reserved default domain`);delete this.domains[e]}}class IntentsResolverHelper{constructor(e,t,n){this.glueController=e,this.workspacesController=t,this.windowsController=n,this.intentsResolverResponsePromises={}}get logger(){return logger.get("intents.resolver.controller")}startResolverApp({request:e,resolverConfig:t,commandId:n,callerId:r,resolverInstance:i,method:o}){var l,s,a,u;return __awaiter$7(this,void 0,void 0,(function*(){null===(l=this.logger)||void 0===l||l.trace(`[${n}] Intents Resolver UI with app name ${t.appName} will be used for request: ${JSON.stringify(e)}`);const c=yield this.registerResponseMethod(o);null===(s=this.logger)||void 0===s||s.trace(`[${n}] Registered interop method ${c}`);const h=this.buildStartContext(o,e,c),d=yield this.buildStartOptions(r,n);null===(a=this.logger)||void 0===a||a.trace(`[${n}] Starting Intents Resolver UI with context: ${JSON.stringify(h)} and options: ${d}`);const f=this.glueController.clientGlue.appManager.application(t.appName).start(h,d).catch((e=>{throw new Error(`${ERRORS.RESOLVER_UNAVAILABLE}. Reason: ${e instanceof Error||"string"==typeof e?e:JSON.stringify(e)}`)})),p=yield f;i.instanceId=p.id,null===(u=this.logger)||void 0===u||u.trace(`[${n}] Intents Resolver instance with id ${p.id} opened`),this.subscribeOnInstanceStopped(p,o);const g="raise"===o?`for intent request ${JSON.stringify(e)}`:`for '${o}' method with filter ${JSON.stringify(e)}`,w=`${ERRORS.RESOLVER_TIMEOUT} - waited ${t.waitResponseTimeout}ms for the user the choose a handler ${g}`;this.createResponsePromise({intent:"raise"===o?e.intent:void 0,instanceId:p.id,responseMethodName:c,timeout:t.waitResponseTimeout,errorMsg:w});return yield this.handleInstanceResponse(p.id,o,n)}))}stopResolverInstance(e){const t=this.glueController.clientGlue.appManager.instances().find((t=>t.id===e));t&&t.stop().catch((e=>{var t;return null===(t=this.logger)||void 0===t?void 0:t.warn(e)}))}handleInstanceResponse(e,t,n){var r,i;return __awaiter$7(this,void 0,void 0,(function*(){try{const o=yield this.intentsResolverResponsePromises[e].promise,l="raise"===t?`for intent ${o.intent} `:"";return null===(r=this.logger)||void 0===r||r.trace(`[${n}] Intent handler chosen ${l}: ${JSON.stringify(o.handler)}. Stopping resolver instance with id ${e}`),this.stopResolverInstance(e),null===(i=this.logger)||void 0===i||i.trace(`[${n}] Instance with id ${e} successfully stopped`),o.handler}catch(t){throw this.stopResolverInstance(e),new Error(t)}}))}registerResponseMethod(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=INTENTS_RESOLVER_INTEROP_PREFIX+shortid$3();return yield this.glueController.clientGlue.interop.register(t,((t,n)=>this.responseHandler(t,n,e))),t}))}createResponsePromise({instanceId:e,intent:t,responseMethodName:n,timeout:r,errorMsg:i}){let o=()=>{},l=()=>{};const s=PromisePlus(((e,t)=>{o=e,l=t}),r,i);this.intentsResolverResponsePromises[e]={intent:t,resolve:o,reject:l,promise:s,methodName:n}}buildStartContext(e,t,n){const r={callerId:this.glueController.clientGlue.interop.instance.instance,methodName:n};return"raise"===e?Object.assign(Object.assign({},r),{intent:t}):Object.assign(Object.assign({},r),{handlerFilter:t})}buildStartOptions(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=yield this.getTargetBounds(e,t);if(!n)throw new Error(`[${t}] Cannot find window with id: ${e} - the client which sent the "raise" command is no longer opened`);return{top:(n.height-INTENTS_RESOLVER_HEIGHT)/2+n.top,left:(n.width-INTENTS_RESOLVER_WIDTH)/2+n.left,width:INTENTS_RESOLVER_WIDTH,height:INTENTS_RESOLVER_HEIGHT}}))}getTargetBounds(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){const i=(yield this.tryGetWindowBasedBounds(e,t))||(yield this.tryGetWorkspaceBasedBounds(e,t));if(i)return null===(n=this.logger)||void 0===n||n.trace(`[${t}] Opening Intents Resolver UI with bounds: ${JSON.stringify(i)}`),i;const o={top:window.screen.availTop||0,left:window.screen.availLeft||0,width:window.screen.width,height:window.screen.height};return null===(r=this.logger)||void 0===r||r.trace(`[${t}] Opening Intents Resolver UI relative to my screen bounds: ${JSON.stringify(o)}`),o}))}tryGetWindowBasedBounds(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){const i=this.glueController.clientGlue.windows.findById(e),o=this.getServerInstanceByWindowId(e);if(!i&&!o)throw new Error(`Client with id "${e}" does not exist`);if(!i&&o)return this.getWindowBoundsByServerInstance(o,e,t);if(!i)throw new Error(`Client with id "${e}" does not exist`);try{const r=yield i.getBounds();return null===(n=this.logger)||void 0===n||n.trace(`[${t}] Opening the resolver UI with bounds: ${JSON.stringify(r)}, relative to a window with id: ${e}`),r}catch(n){return void(null===(r=this.logger)||void 0===r||r.trace(`[${t}] Failure to get bounds of a window with id ${e}. Error: ${JSON.stringify(n)}`))}}))}getServerInstanceByWindowId(e){return this.glueController.clientGlue.interop.servers().find((t=>t.instance===e))}getWindowBoundsByServerInstance(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){try{const{bounds:n}=yield this.glueController.callWindow("windows",this.windowsController.getBoundsOperation,{windowId:t},{instance:e.instance});return n}catch(t){null===(r=this.logger)||void 0===r||r.trace(`[${n}] Failure to get bounds of a window with instance ${e.instance}. Error: ${JSON.stringify(t)}`)}}))}tryGetWorkspaceBasedBounds(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){try{const{bounds:r}=yield this.workspacesController.getWorkspaceWindowFrameBounds({itemId:e},t);return null===(n=this.logger)||void 0===n||n.trace(`[${t}] Opening the resolver UI relative to my workspace frame window bounds: ${JSON.stringify(r)}`),r}catch(e){null===(r=this.logger)||void 0===r||r.trace(`[${t}] Failure to get my workspace frame window bounds. Error: ${JSON.stringify(e)}`)}}))}responseHandler(e,t,n){var r,i;const o=("raise"===n?raiseIntentResolverResponseDecoder:filterHandlersResolverResponseDecoder).run(e),l=t.instance;if(!l)throw new Error("Cannot find instance id for the response of the intent resolver");if(o.ok)return null===(r=this.logger)||void 0===r||r.trace(`Intent Resolver instance with id ${l} send a valid response: ${JSON.stringify(o.result)}`),this.intentsResolverResponsePromises[l].resolve(e);null===(i=this.logger)||void 0===i||i.trace(`Intent Resolver instance with id ${l} sent an invalid response. Error: ${JSON.stringify(o.error)}`),this.intentsResolverResponsePromises[l].reject(o.error.message),this.stopResolverInstance(l)}subscribeOnInstanceStopped(e,t){const{application:n}=e,r=n.onInstanceStopped((n=>{if(n.id!==e.id)return;const i=this.intentsResolverResponsePromises[n.id];if(!i)return r();const o="raise"===t?`raised intent ${i.intent}`:`'${t}' method`,l=`${ERRORS.USER_CANCELLED} for ${o}`;i.reject(l),this.cleanUpIntentResolverPromise(n.id),r()}))}cleanUpIntentResolverPromise(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=this.intentsResolverResponsePromises[e];if(!t)return;this.glueController.clientGlue.interop.unregister(t.methodName).catch((e=>{var t;return null===(t=this.logger)||void 0===t?void 0:t.warn(e)})),delete this.intentsResolverResponsePromises[e]}))}}var navigator$1={userAgent:!1},window$1={},CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),o=r.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var l=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=l<<24-(r+o)%4*8}else for(o=0;o<i;o+=4)t[r+o>>>2]=n[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),l=n.enc={},s=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},a=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},u=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},c=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,l=this.blockSize,s=i/(4*l),a=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*l,u=e.min(4*a,i);if(a){for(var c=0;c<a;c+=l)this._doProcessBlock(r,c);var h=r.splice(0,a);n.sigBytes-=u}return new o.init(h,u)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=c.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math),h,j,k,m,l,d,b;!function(e){var t,n=(t=CryptoJS).lib,r=n.Base,i=n.WordArray;(t=t.x64={}).Word=r.extend({init:function(e,t){this.high=e,this.low=t}}),t.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var o=e[r];n.push(o.high),n.push(o.low)}return i.create(n,this.sigBytes)},clone:function(){for(var e=r.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}})}(),CryptoJS.lib.Cipher||function(e){var t=(f=CryptoJS).lib,n=t.Base,r=t.WordArray,i=t.BufferedBlockAlgorithm,o=f.enc.Base64,l=f.algo.EvpKDF,s=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?p:d).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?p:d).decrypt(e,t,n,r)}}}});t.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var a=f.mode={},u=function(e,t,n){var r=this._iv;r?this._iv=undefined:r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]},c=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();c.Encryptor=c.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;u.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),c.Decryptor=c.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),u.call(this,e,t,r),this._prevBlock=i}}),a=a.CBC=c,c=(f.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,o=[],l=0;l<n;l+=4)o.push(i);n=r.create(o,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=s.extend({cfg:s.cfg.extend({mode:a,padding:c}),reset:function(){s.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),d=(a=(f.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){var t=(e=o.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:a}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,h.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),f=(f.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=r.random(8)),e=l.create({keySize:t+n}).compute(e,i),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,h.create({key:e,iv:n,salt:i})}},p=t.PasswordBasedCipher=d.extend({cfg:d.cfg.extend({kdf:f}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=d.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,d.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=CryptoJS,t=e.lib.BlockCipher,n=e.algo,r=[],i=[],o=[],l=[],s=[],a=[],u=[],c=[],h=[],d=[],f=[],p=0;256>p;p++)f[p]=128>p?p<<1:p<<1^283;var g=0,w=0;for(p=0;256>p;p++){var m=(m=w^w<<1^w<<2^w<<3^w<<4)>>>8^255&m^99;r[g]=m,i[m]=g;var v=f[g],y=f[v],b=f[y],S=257*f[m]^16843008*m;o[g]=S<<24|S>>>8,l[g]=S<<16|S>>>16,s[g]=S<<8|S>>>24,a[g]=S,S=16843009*b^65537*y^257*v^16843008*g,u[m]=S<<24|S>>>8,c[m]=S<<16|S>>>16,h[m]=S<<8|S>>>24,d[m]=S,g?(g=v^f[f[f[b^v]]],w^=f[f[w]]):g=w=1}var $=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],o=0;o<n;o++)if(o<t)i[o]=e[o];else{var l=i[o-1];o%t?6<t&&4==o%t&&(l=r[l>>>24]<<24|r[l>>>16&255]<<16|r[l>>>8&255]<<8|r[255&l]):(l=r[(l=l<<8|l>>>24)>>>24]<<24|r[l>>>16&255]<<16|r[l>>>8&255]<<8|r[255&l],l^=$[o/t|0]<<24),i[o]=i[o-t]^l}for(e=this._invKeySchedule=[],t=0;t<n;t++)o=n-t,l=t%4?i[o]:i[o-4],e[t]=4>t||4>=o?l:u[r[l>>>24]]^c[r[l>>>16&255]]^h[r[l>>>8&255]]^d[r[255&l]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,l,s,a,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,u,c,h,d,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,o,l,s){for(var a=this._nRounds,u=e[t]^n[0],c=e[t+1]^n[1],h=e[t+2]^n[2],d=e[t+3]^n[3],f=4,p=1;p<a;p++){var g=r[u>>>24]^i[c>>>16&255]^o[h>>>8&255]^l[255&d]^n[f++],w=r[c>>>24]^i[h>>>16&255]^o[d>>>8&255]^l[255&u]^n[f++],m=r[h>>>24]^i[d>>>16&255]^o[u>>>8&255]^l[255&c]^n[f++];d=r[d>>>24]^i[u>>>16&255]^o[c>>>8&255]^l[255&h]^n[f++],u=g,c=w,h=m}g=(s[u>>>24]<<24|s[c>>>16&255]<<16|s[h>>>8&255]<<8|s[255&d])^n[f++],w=(s[c>>>24]<<24|s[h>>>16&255]<<16|s[d>>>8&255]<<8|s[255&u])^n[f++],m=(s[h>>>24]<<24|s[d>>>16&255]<<16|s[u>>>8&255]<<8|s[255&c])^n[f++],d=(s[d>>>24]<<24|s[u>>>16&255]<<16|s[c>>>8&255]<<8|s[255&h])^n[f++],e[t]=g,e[t+1]=w,e[t+2]=m,e[t+3]=d},keySize:8});e.AES=t._createHelper(n)}(),function(){function e(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function t(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}var n=CryptoJS,r=(i=n.lib).WordArray,i=i.BlockCipher,o=n.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],a=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],c=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=o.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;56>n;n++){var r=l[n]-1;t[n]=e[r>>>5]>>>31-r%32&1}for(e=this._subKeys=[],r=0;16>r;r++){var i=e[r]=[],o=a[r];for(n=0;24>n;n++)i[n/6|0]|=t[(s[n]-1+o)%28]<<31-n%6,i[4+(n/6|0)]|=t[28+(s[n+24]-1+o)%28]<<31-n%6;for(i[0]=i[0]<<1|i[0]>>>31,n=1;7>n;n++)i[n]>>>=4*(n-1)+3;i[7]=i[7]<<5|i[7]>>>27}for(t=this._invSubKeys=[],n=0;16>n;n++)t[n]=e[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(n,r,i){this._lBlock=n[r],this._rBlock=n[r+1],e.call(this,4,252645135),e.call(this,16,65535),t.call(this,2,858993459),t.call(this,8,16711935),e.call(this,1,1431655765);for(var o=0;16>o;o++){for(var l=i[o],s=this._lBlock,a=this._rBlock,h=0,d=0;8>d;d++)h|=u[d][((a^l[d])&c[d])>>>0];this._lBlock=a,this._rBlock=s^h}i=this._lBlock,this._lBlock=this._rBlock,this._rBlock=i,e.call(this,1,1431655765),t.call(this,8,16711935),t.call(this,2,858993459),e.call(this,16,65535),e.call(this,4,252645135),n[r]=this._lBlock,n[r+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});n.DES=i._createHelper(h),o=o.TripleDES=i.extend({_doReset:function(){var e=this._key.words;this._des1=h.createEncryptor(r.create(e.slice(0,2))),this._des2=h.createEncryptor(r.create(e.slice(2,4))),this._des3=h.createEncryptor(r.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2}),n.TripleDES=i._createHelper(o)}(),h=CryptoJS,j=h.lib.WordArray,h.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,l=0;4>l&&i+.75*l<n;l++)e.push(r.charAt(o>>>6*(3-l)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(r=n.charAt(64))&&-1!=(r=e.indexOf(r))&&(t=r);for(var r=[],i=0,o=0;o<t;o++)if(o%4){var l=n.indexOf(e.charAt(o-1))<<o%4*2,s=n.indexOf(e.charAt(o))>>>6-o%4*2;r[i>>>2]|=(l|s)<<24-i%4*8,i++}return j.create(r,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,n,r,i,o,l){return((e=e+(t&n|~t&r)+i+l)<<o|e>>>32-o)+t}function n(e,t,n,r,i,o,l){return((e=e+(t&r|n&~r)+i+l)<<o|e>>>32-o)+t}function r(e,t,n,r,i,o,l){return((e=e+(t^n^r)+i+l)<<o|e>>>32-o)+t}function i(e,t,n,r,i,o,l){return((e=e+(n^(t|~r))+i+l)<<o|e>>>32-o)+t}for(var o=CryptoJS,l=(a=o.lib).WordArray,s=a.Hasher,a=o.algo,u=[],c=0;64>c;c++)u[c]=4294967296*e.abs(e.sin(c+1))|0;a=a.MD5=s.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,o){for(var l=0;16>l;l++){var s=e[a=o+l];e[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}l=this._hash.words;var a=e[o+0],c=(s=e[o+1],e[o+2]),h=e[o+3],d=e[o+4],f=e[o+5],p=e[o+6],g=e[o+7],w=e[o+8],m=e[o+9],v=e[o+10],y=e[o+11],b=e[o+12],S=e[o+13],$=e[o+14],C=e[o+15],I=t(I=l[0],D=l[1],E=l[2],x=l[3],a,7,u[0]),x=t(x,I,D,E,s,12,u[1]),E=t(E,x,I,D,c,17,u[2]),D=t(D,E,x,I,h,22,u[3]);I=t(I,D,E,x,d,7,u[4]),x=t(x,I,D,E,f,12,u[5]),E=t(E,x,I,D,p,17,u[6]),D=t(D,E,x,I,g,22,u[7]),I=t(I,D,E,x,w,7,u[8]),x=t(x,I,D,E,m,12,u[9]),E=t(E,x,I,D,v,17,u[10]),D=t(D,E,x,I,y,22,u[11]),I=t(I,D,E,x,b,7,u[12]),x=t(x,I,D,E,S,12,u[13]),E=t(E,x,I,D,$,17,u[14]),I=n(I,D=t(D,E,x,I,C,22,u[15]),E,x,s,5,u[16]),x=n(x,I,D,E,p,9,u[17]),E=n(E,x,I,D,y,14,u[18]),D=n(D,E,x,I,a,20,u[19]),I=n(I,D,E,x,f,5,u[20]),x=n(x,I,D,E,v,9,u[21]),E=n(E,x,I,D,C,14,u[22]),D=n(D,E,x,I,d,20,u[23]),I=n(I,D,E,x,m,5,u[24]),x=n(x,I,D,E,$,9,u[25]),E=n(E,x,I,D,h,14,u[26]),D=n(D,E,x,I,w,20,u[27]),I=n(I,D,E,x,S,5,u[28]),x=n(x,I,D,E,c,9,u[29]),E=n(E,x,I,D,g,14,u[30]),I=r(I,D=n(D,E,x,I,b,20,u[31]),E,x,f,4,u[32]),x=r(x,I,D,E,w,11,u[33]),E=r(E,x,I,D,y,16,u[34]),D=r(D,E,x,I,$,23,u[35]),I=r(I,D,E,x,s,4,u[36]),x=r(x,I,D,E,d,11,u[37]),E=r(E,x,I,D,g,16,u[38]),D=r(D,E,x,I,v,23,u[39]),I=r(I,D,E,x,S,4,u[40]),x=r(x,I,D,E,a,11,u[41]),E=r(E,x,I,D,h,16,u[42]),D=r(D,E,x,I,p,23,u[43]),I=r(I,D,E,x,m,4,u[44]),x=r(x,I,D,E,b,11,u[45]),E=r(E,x,I,D,C,16,u[46]),I=i(I,D=r(D,E,x,I,c,23,u[47]),E,x,a,6,u[48]),x=i(x,I,D,E,g,10,u[49]),E=i(E,x,I,D,$,15,u[50]),D=i(D,E,x,I,f,21,u[51]),I=i(I,D,E,x,b,6,u[52]),x=i(x,I,D,E,h,10,u[53]),E=i(E,x,I,D,v,15,u[54]),D=i(D,E,x,I,s,21,u[55]),I=i(I,D,E,x,w,6,u[56]),x=i(x,I,D,E,C,10,u[57]),E=i(E,x,I,D,p,15,u[58]),D=i(D,E,x,I,S,21,u[59]),I=i(I,D,E,x,d,6,u[60]),x=i(x,I,D,E,y,10,u[61]),E=i(E,x,I,D,c,15,u[62]),D=i(D,E,x,I,m,21,u[63]);l[0]=l[0]+I|0,l[1]=l[1]+D|0,l[2]=l[2]+E|0,l[3]=l[3]+x|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=s._createHelper(a),o.HmacMD5=s._createHmacHelper(a)}(Math),k=CryptoJS,m=(b=k.lib).WordArray,l=b.Hasher,d=[],b=k.algo.SHA1=l.extend({_doReset:function(){this._hash=new m.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],l=n[3],s=n[4],a=0;80>a;a++){if(16>a)d[a]=0|e[t+a];else{var u=d[a-3]^d[a-8]^d[a-14]^d[a-16];d[a]=u<<1|u>>>31}u=(r<<5|r>>>27)+s+d[a],u=20>a?u+(1518500249+(i&o|~i&l)):40>a?u+(1859775393+(i^o^l)):60>a?u+((i&o|i&l|o&l)-1894007588):u+((i^o^l)-899497514),s=l,l=o,o=i<<30|i>>>2,i=r,r=u}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+l|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=l.clone.call(this);return e._hash=this._hash.clone(),e}}),k.SHA1=l._createHelper(b),k.HmacSHA1=l._createHmacHelper(b),function(e){for(var t=CryptoJS,n=(i=t.lib).WordArray,r=i.Hasher,i=t.algo,o=[],l=[],s=function(e){return 4294967296*(e-(0|e))|0},a=2,u=0;64>u;){var c;e:{c=a;for(var h=e.sqrt(c),d=2;d<=h;d++)if(!(c%d)){c=!1;break e}c=!0}c&&(8>u&&(o[u]=s(e.pow(a,.5))),l[u]=s(e.pow(a,1/3)),u++),a++}var f=[];i=i.SHA256=r.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],u=n[5],c=n[6],h=n[7],d=0;64>d;d++){if(16>d)f[d]=0|e[t+d];else{var p=f[d-15],g=f[d-2];f[d]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+f[d-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+f[d-16]}p=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&u^~a&c)+l[d]+f[d],g=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&o^i&o),h=c,c=u,u=a,a=s+p|0,s=o,o=i,i=r,r=p+g|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+u|0,n[6]=n[6]+c|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(i),t.HmacSHA256=r._createHmacHelper(i)}(Math),function(){var e=CryptoJS,t=e.lib.WordArray,n=(r=e.algo).SHA256,r=r.SHA224=n.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=n._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=n._createHelper(r),e.HmacSHA224=n._createHmacHelper(r)}(),function(){function e(){return r.create.apply(r,arguments)}for(var t=CryptoJS,n=t.lib.Hasher,r=(o=t.x64).Word,i=o.WordArray,o=t.algo,l=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],s=[],a=0;80>a;a++)s[a]=e();o=o.SHA512=n.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=(h=this._hash.words)[0],r=h[1],i=h[2],o=h[3],a=h[4],u=h[5],c=h[6],h=h[7],d=n.high,f=n.low,p=r.high,g=r.low,w=i.high,m=i.low,v=o.high,y=o.low,b=a.high,S=a.low,$=u.high,C=u.low,I=c.high,x=c.low,E=h.high,D=h.low,A=d,k=f,_=p,j=g,N=w,R=m,T=v,P=y,O=b,F=S,B=$,M=C,Q=I,G=x,U=E,J=D,W=0;80>W;W++){var q=s[W];if(16>W)var L=q.high=0|e[t+2*W],K=q.low=0|e[t+2*W+1];else{L=((K=(L=s[W-15]).high)>>>1|(H=L.low)<<31)^(K>>>8|H<<24)^K>>>7;var H=(H>>>1|K<<31)^(H>>>8|K<<24)^(H>>>7|K<<25),z=((K=(z=s[W-2]).high)>>>19|(V=z.low)<<13)^(K<<3|V>>>29)^K>>>6,V=(V>>>19|K<<13)^(V<<3|K>>>29)^(V>>>6|K<<26),X=(K=s[W-7]).high,Z=(Y=s[W-16]).high,Y=Y.low;L=(L=(L=L+X+((K=H+K.low)>>>0<H>>>0?1:0))+z+((K=K+V)>>>0<V>>>0?1:0))+Z+((K=K+Y)>>>0<Y>>>0?1:0);q.high=L,q.low=K}X=O&B^~O&Q,Y=F&M^~F&G,q=A&_^A&N^_&N;var ee=k&j^k&R^j&R,te=(H=(A>>>28|k<<4)^(A<<30|k>>>2)^(A<<25|k>>>7),z=(k>>>28|A<<4)^(k<<30|A>>>2)^(k<<25|A>>>7),(V=l[W]).high),ne=V.low;Z=U+((O>>>14|F<<18)^(O>>>18|F<<14)^(O<<23|F>>>9))+((V=J+((F>>>14|O<<18)^(F>>>18|O<<14)^(F<<23|O>>>9)))>>>0<J>>>0?1:0),U=Q,J=G,Q=B,G=M,B=O,M=F,O=T+(Z=(Z=(Z=Z+X+((V=V+Y)>>>0<Y>>>0?1:0))+te+((V=V+ne)>>>0<ne>>>0?1:0))+L+((V=V+K)>>>0<K>>>0?1:0))+((F=P+V|0)>>>0<P>>>0?1:0)|0,T=N,P=R,N=_,R=j,_=A,j=k,A=Z+(q=H+q+((K=z+ee)>>>0<z>>>0?1:0))+((k=V+K|0)>>>0<V>>>0?1:0)|0}f=n.low=f+k,n.high=d+A+(f>>>0<k>>>0?1:0),g=r.low=g+j,r.high=p+_+(g>>>0<j>>>0?1:0),m=i.low=m+R,i.high=w+N+(m>>>0<R>>>0?1:0),y=o.low=y+P,o.high=v+T+(y>>>0<P>>>0?1:0),S=a.low=S+F,a.high=b+O+(S>>>0<F>>>0?1:0),C=u.low=C+M,u.high=$+B+(C>>>0<M>>>0?1:0),x=c.low=x+G,c.high=I+Q+(x>>>0<G>>>0?1:0),D=h.low=D+J,h.high=E+U+(D>>>0<J>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=n._createHelper(o),t.HmacSHA512=n._createHmacHelper(o)}(),function(){var e=CryptoJS,t=(i=e.x64).Word,n=i.WordArray,r=(i=e.algo).SHA512,i=i.SHA384=r.extend({_doReset:function(){this._hash=new n.init([new t.init(3418070365,3238371032),new t.init(1654270250,914150663),new t.init(2438529370,812702999),new t.init(355462360,4144912697),new t.init(1731405415,4290775857),new t.init(2394180231,1750603025),new t.init(3675008525,1694076839),new t.init(1203062813,3204075428)])},_doFinalize:function(){var e=r._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=r._createHelper(i),e.HmacSHA384=r._createHmacHelper(i)}(),function(){var e=CryptoJS,t=(r=e.lib).WordArray,n=r.Hasher,r=e.algo,i=t.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=t.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=t.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),s=t.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),a=t.create([0,1518500249,1859775393,2400959708,2840853838]),u=t.create([1352829926,1548603684,1836072691,2053994217,0]);r=r.RIPEMD160=n.extend({_doReset:function(){this._hash=t.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;16>n;n++){var r=e[b=t+n];e[b]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var c,h,d,f,p,g,w,m,v,y,b=this._hash.words,S=(r=a.words,u.words),$=i.words,C=o.words,I=l.words,x=s.words;g=c=b[0],w=h=b[1],m=d=b[2],v=f=b[3],y=p=b[4];var E;for(n=0;80>n;n+=1)E=c+e[t+$[n]]|0,E=16>n?E+((h^d^f)+r[0]):32>n?E+((h&d|~h&f)+r[1]):48>n?E+(((h|~d)^f)+r[2]):64>n?E+((h&f|d&~f)+r[3]):E+((h^(d|~f))+r[4]),E=(E=(E|=0)<<I[n]|E>>>32-I[n])+p|0,c=p,p=f,f=d<<10|d>>>22,d=h,h=E,E=g+e[t+C[n]]|0,E=16>n?E+((w^(m|~v))+S[0]):32>n?E+((w&v|m&~v)+S[1]):48>n?E+(((w|~m)^v)+S[2]):64>n?E+((w&m|~w&v)+S[3]):E+((w^m^v)+S[4]),E=(E=(E|=0)<<x[n]|E>>>32-x[n])+y|0,g=y,y=v,v=m<<10|m>>>22,m=w,w=E;E=b[1]+d+v|0,b[1]=b[2]+f+y|0,b[2]=b[3]+p+g|0,b[3]=b[4]+c+w|0,b[4]=b[0]+h+m|0,b[0]=E},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;for(t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process(),t=(e=this._hash).words,n=0;5>n;n++)r=t[n],t[n]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8);return e},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.RIPEMD160=n._createHelper(r),e.HmacRIPEMD160=n._createHmacHelper(r)}(),function(){var e=CryptoJS,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,i=4*r;n.sigBytes>i&&(n=e.finalize(n)),n.clamp();for(var o=this._oKey=n.clone(),l=this._iKey=n.clone(),s=o.words,a=l.words,u=0;u<r;u++)s[u]^=1549556828,a[u]^=909522486;o.sigBytes=l.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e,t=CryptoJS,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).HMAC,o=e.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:e.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var n=this.cfg,o=i.create(n.hasher,e),l=r.create(),s=r.create([1]),a=l.words,u=s.words,c=n.keySize;for(n=n.iterations;a.length<c;){var h=o.update(t).finalize(s);o.reset();for(var d=h.words,f=d.length,p=h,g=1;g<n;g++){p=o.finalize(p),o.reset();for(var w=p.words,m=0;m<f;m++)d[m]^=w[m]}l.concat(h),u[0]++}return l.sigBytes=4*c,l}});t.PBKDF2=function(e,t,n){return o.create(n).compute(e,t)}}();
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
     */
var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64pad="=",dbits;function hex2b64(e){var t,n,r="";for(t=0;t+3<=e.length;t+=3)n=parseInt(e.substring(t,t+3),16),r+=b64map.charAt(n>>6)+b64map.charAt(63&n);for(t+1==e.length?(n=parseInt(e.substring(t,t+1),16),r+=b64map.charAt(n<<2)):t+2==e.length&&(n=parseInt(e.substring(t,t+2),16),r+=b64map.charAt(n>>2)+b64map.charAt((3&n)<<4));(3&r.length)>0;)r+=b64pad;return r}function b64tohex(e){var t,n,r,i="",o=0;for(t=0;t<e.length&&e.charAt(t)!=b64pad;++t)(r=b64map.indexOf(e.charAt(t)))<0||(0==o?(i+=int2char(r>>2),n=3&r,o=1):1==o?(i+=int2char(n<<2|r>>4),n=15&r,o=2):2==o?(i+=int2char(n),i+=int2char(r>>2),n=3&r,o=3):(i+=int2char(n<<2|r>>4),i+=int2char(15&r),o=0));return 1==o&&(i+=int2char(n<<2)),i}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
     */function BigInteger(e,t,n){null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger(null)}function am1(e,t,n,r,i,o){for(;--o>=0;){var l=t*this[e++]+n[r]+i;i=Math.floor(l/67108864),n[r++]=67108863&l}return i}function am2(e,t,n,r,i,o){for(var l=32767&t,s=t>>15;--o>=0;){var a=32767&this[e],u=this[e++]>>15,c=s*a+u*l;i=((a=l*a+((32767&c)<<15)+n[r]+(1073741823&i))>>>30)+(c>>>15)+s*u+(i>>>30),n[r++]=1073741823&a}return i}function am3(e,t,n,r,i,o){for(var l=16383&t,s=t>>14;--o>=0;){var a=16383&this[e],u=this[e++]>>14,c=s*a+u*l;i=((a=l*a+((16383&c)<<14)+n[r]+i)>>28)+(c>>14)+s*u,n[r++]=268435455&a}return i}"Microsoft Internet Explorer"==navigator$1.appName?(BigInteger.prototype.am=am2,dbits=30):"Netscape"!=navigator$1.appName?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;for(rr="0".charCodeAt(0),vv=0;vv<=9;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){var n=BI_RC[e.charCodeAt(t)];return null==n?-1:n}function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function bnpFromInt(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function nbv(e){var t=nbi();return t.fromInt(e),t}function bnpFromString(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var r=e.length,i=!1,o=0;--r>=0;){var l=8==n?255&e[r]:intAt(e,r);l<0?"-"==e.charAt(r)&&(i=!0):(i=!1,0==o?this[this.t++]=l:o+n>this.DB?(this[this.t-1]|=(l&(1<<this.DB-o)-1)<<o,this[this.t++]=l>>this.DB-o):this[this.t-1]|=l<<o,(o+=n)>=this.DB&&(o-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),i&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,i=!1,o="",l=this.t,s=this.DB-l*this.DB%t;if(l-- >0)for(s<this.DB&&(n=this[l]>>s)>0&&(i=!0,o=int2char(n));l>=0;)s<t?(n=(this[l]&(1<<s)-1)<<t-s,n|=this[--l]>>(s+=this.DB-t)):(n=this[l]>>(s-=t)&r,s<=0&&(s+=this.DB,--l)),n>0&&(i=!0),i&&(o+=int2char(n));return i?o:"0"}function bnNegate(){var e=nbi();return BigInteger.ZERO.subTo(this,e),e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0}function nbits(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function bnpDRShiftTo(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function bnpLShiftTo(e,t){var n,r=e%this.DB,i=this.DB-r,o=(1<<i)-1,l=Math.floor(e/this.DB),s=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)t[n+l+1]=this[n]>>i|s,s=(this[n]&o)<<r;for(n=l-1;n>=0;--n)t[n]=0;t[l]=s,t.t=this.t+l+1,t.s=this.s,t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,i=this.DB-r,o=(1<<r)-1;t[0]=this[n]>>r;for(var l=n+1;l<this.t;++l)t[l-n-1]|=(this[l]&o)<<i,t[l-n]=this[l]>>r;r>0&&(t[this.t-n-1]|=(this.s&o)<<i),t.t=this.t-n,t.clamp()}}function bnpSubTo(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function bnpMultiplyTo(e,t){var n=this.abs(),r=e.abs(),i=n.t;for(t.t=i+r.t;--i>=0;)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&BigInteger.ZERO.subTo(t,t)}function bnpSquareTo(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function bnpDivRemTo(e,t,n){var r=e.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=nbi());var o=nbi(),l=this.s,s=e.s,a=this.DB-nbits(r[r.t-1]);a>0?(r.lShiftTo(a,o),i.lShiftTo(a,n)):(r.copyTo(o),i.copyTo(n));var u=o.t,c=o[u-1];if(0!=c){var h=c*(1<<this.F1)+(u>1?o[u-2]>>this.F2:0),d=this.FV/h,f=(1<<this.F1)/h,p=1<<this.F2,g=n.t,w=g-u,m=null==t?nbi():t;for(o.dlShiftTo(w,m),n.compareTo(m)>=0&&(n[n.t++]=1,n.subTo(m,n)),BigInteger.ONE.dlShiftTo(u,m),m.subTo(o,o);o.t<u;)o[o.t++]=0;for(;--w>=0;){var v=n[--g]==c?this.DM:Math.floor(n[g]*d+(n[g-1]+p)*f);if((n[g]+=o.am(0,v,n,w,0,u))<v)for(o.dlShiftTo(w,m),n.subTo(m,n);n[g]<--v;)n.subTo(m,n)}null!=t&&(n.drShiftTo(u,t),l!=s&&BigInteger.ZERO.subTo(t,t)),n.t=u,n.clamp(),a>0&&n.rShiftTo(a,n),l<0&&BigInteger.ZERO.subTo(n,n)}}}function bnMod(e){var t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t),t}function Classic(e){this.m=e}function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function cRevert(e){return e}function cReduce(e){e.divRemTo(this.m,null,e)}function cMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function cSqrTo(e,t){e.squareTo(t),this.reduce(t)}function bnpInvDigit(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function montConvert(e){var t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(e){var t=nbi();return e.copyTo(t),this.reduce(t),t}function montReduce(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[n=t+this.m.t]+=this.m.am(0,r,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t),this.reduce(t)}function montMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnpIsEven(){return 0==(this.t>0?1&this[0]:this.s)}function bnpExp(e,t){if(e>4294967295||e<1)return BigInteger.ONE;var n=nbi(),r=nbi(),i=t.convert(this),o=nbits(e)-1;for(i.copyTo(n);--o>=0;)if(t.sqrTo(n,r),(e&1<<o)>0)t.mulTo(r,i,n);else{var l=n;n=r,r=l}return t.revert(n)}function bnModPowInt(e,t){var n;return n=e<256||t.isEven()?new Classic(t):new Montgomery(t),this.exp(e,n)}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
     */
function bnClone(){var e=nbi();return this.copyTo(e),e}function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function bnpToRadix(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=nbv(n),i=nbi(),o=nbi(),l="";for(this.divRemTo(r,i,o);i.signum()>0;)l=(n+o.intValue()).toString(e).substr(1)+l,i.divRemTo(r,i,o);return o.intValue().toString(e)+l}function bnpFromRadix(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,o=0,l=0,s=0;s<e.length;++s){var a=intAt(e,s);a<0?"-"==e.charAt(s)&&0==this.signum()&&(i=!0):(l=t*l+a,++o>=n&&(this.dMultiply(r),this.dAddOffset(l,0),o=0,l=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(l,0)),i&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(e-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(BigInteger.ONE.shiftLeft(e-1),this);else{var r=new Array,i=7&e;r.length=1+(e>>3),t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function bnToByteArray(){var e=this.t,t=new Array;t[0]=this.s;var n,r=this.DB-e*this.DB%8,i=0;if(e-- >0)for(r<this.DB&&(n=this[e]>>r)!=(this.s&this.DM)>>r&&(t[i++]=n|this.s<<this.DB-r);e>=0;)r<8?(n=(this[e]&(1<<r)-1)<<8-r,n|=this[--e]>>(r+=this.DB-8)):(n=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(t[i++]=n);return t}function bnEquals(e){return 0==this.compareTo(e)}function bnMin(e){return this.compareTo(e)<0?this:e}function bnMax(e){return this.compareTo(e)>0?this:e}function bnpBitwiseTo(e,t,n){var r,i,o=Math.min(e.t,this.t);for(r=0;r<o;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){for(i=e.s&this.DM,r=o;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=o;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function op_and(e,t){return e&t}function bnAnd(e){var t=nbi();return this.bitwiseTo(e,op_and,t),t}function op_or(e,t){return e|t}function bnOr(e){var t=nbi();return this.bitwiseTo(e,op_or,t),t}function op_xor(e,t){return e^t}function bnXor(e){var t=nbi();return this.bitwiseTo(e,op_xor,t),t}function op_andnot(e,t){return e&~t}function bnAndNot(e){var t=nbi();return this.bitwiseTo(e,op_andnot,t),t}function bnNot(){for(var e=nbi(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function bnShiftLeft(e){var t=nbi();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function bnShiftRight(e){var t=nbi();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function lbit(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function bnGetLowestSetBit(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+lbit(this[e]);return this.s<0?this.t*this.DB:-1}function cbit(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function bnBitCount(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=cbit(this[n]^t);return e}function bnTestBit(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)}function bnpChangeBit(e,t){var n=BigInteger.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function bnSetBit(e){return this.changeBit(e,op_or)}function bnClearBit(e){return this.changeBit(e,op_andnot)}function bnFlipBit(e){return this.changeBit(e,op_xor)}function bnpAddTo(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function bnAdd(e){var t=nbi();return this.addTo(e,t),t}function bnSubtract(e){var t=nbi();return this.subTo(e,t),t}function bnMultiply(e){var t=nbi();return this.multiplyTo(e,t),t}function bnSquare(){var e=nbi();return this.squareTo(e),e}function bnDivide(e){var t=nbi();return this.divRemTo(e,t,null),t}function bnRemainder(e){var t=nbi();return this.divRemTo(e,null,t),t}function bnDivideAndRemainder(e){var t=nbi(),n=nbi();return this.divRemTo(e,t,n),new Array(t,n)}function bnpDMultiply(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}}function NullExp(){}function nNop(e){return e}function nMulTo(e,t,n){e.multiplyTo(t,n)}function nSqrTo(e,t){e.squareTo(t)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(e,t,n){var r,i=Math.min(this.t+e.t,t);for(n.s=0,n.t=i;i>0;)n[--i]=0;for(r=n.t-this.t;i<r;++i)n[i+this.t]=this.am(0,e[i],n,i,0,this.t);for(r=Math.min(e.t,t);i<r;++i)this.am(0,e[i],n,i,0,t-i);n.clamp()}function bnpMultiplyUpperTo(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Barrett(e){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function barrettConvert(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=nbi();return e.copyTo(t),this.reduce(t),t}function barrettRevert(e){return e}function barrettReduce(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function barrettSqrTo(e,t){e.squareTo(t),this.reduce(t)}function barrettMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnModPow(e,t){var n,r,i=e.bitLength(),o=nbv(1);if(i<=0)return o;n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new Classic(t):t.isEven()?new Barrett(t):new Montgomery(t);var l=new Array,s=3,a=n-1,u=(1<<n)-1;if(l[1]=r.convert(this),n>1){var c=nbi();for(r.sqrTo(l[1],c);s<=u;)l[s]=nbi(),r.mulTo(c,l[s-2],l[s]),s+=2}var h,d,f=e.t-1,p=!0,g=nbi();for(i=nbits(e[f])-1;f>=0;){for(i>=a?h=e[f]>>i-a&u:(h=(e[f]&(1<<i+1)-1)<<a-i,f>0&&(h|=e[f-1]>>this.DB+i-a)),s=n;0==(1&h);)h>>=1,--s;if((i-=s)<0&&(i+=this.DB,--f),p)l[h].copyTo(o),p=!1;else{for(;s>1;)r.sqrTo(o,g),r.sqrTo(g,o),s-=2;s>0?r.sqrTo(o,g):(d=o,o=g,g=d),r.mulTo(g,l[h],o)}for(;f>=0&&0==(e[f]&1<<i);)r.sqrTo(o,g),d=o,o=g,g=d,--i<0&&(i=this.DB-1,--f)}return r.revert(o)}function bnGCD(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),o=n.getLowestSetBit();if(o<0)return t;for(i<o&&(o=i),o>0&&(t.rShiftTo(o,t),n.rShiftTo(o,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return o>0&&n.lShiftTo(o,n),n}function bnpModInt(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function bnModInverse(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return BigInteger.ZERO;for(var n=e.clone(),r=this.clone(),i=nbv(1),o=nbv(0),l=nbv(0),s=nbv(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(i.isEven()&&o.isEven()||(i.addTo(this,i),o.subTo(e,o)),i.rShiftTo(1,i)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;r.isEven();)r.rShiftTo(1,r),t?(l.isEven()&&s.isEven()||(l.addTo(this,l),s.subTo(e,s)),l.rShiftTo(1,l)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(l,i),o.subTo(s,o)):(r.subTo(n,r),t&&l.subTo(i,l),s.subTo(o,s))}return 0!=r.compareTo(BigInteger.ONE)?BigInteger.ZERO:s.compareTo(e)>=0?s.subtract(e):s.signum()<0?(s.addTo(e,s),s.signum()<0?s.add(e):s):s}Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(e){var t,n=this.abs();if(1==n.t&&n[0]<=lowprimes[lowprimes.length-1]){for(t=0;t<lowprimes.length;++t)if(n[0]==lowprimes[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<lowprimes.length;){for(var r=lowprimes[t],i=t+1;i<lowprimes.length&&r<lplim;)r*=lowprimes[i++];for(r=n.modInt(r);t<i;)if(r%lowprimes[t++]==0)return!1}return n.millerRabin(e)}function bnpMillerRabin(e){var t=this.subtract(BigInteger.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);(e=e+1>>1)>lowprimes.length&&(e=lowprimes.length);for(var i=nbi(),o=0;o<e;++o){i.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var l=i.modPow(r,this);if(0!=l.compareTo(BigInteger.ONE)&&0!=l.compareTo(t)){for(var s=1;s++<n&&0!=l.compareTo(t);)if(0==(l=l.modPowInt(2,this)).compareTo(BigInteger.ONE))return!1;if(0!=l.compareTo(t))return!1}}return!0}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
     */
function Arcfour(){this.i=0,this.j=0,this.S=new Array}function ARC4init(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;for(n=0,t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0}function ARC4next(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]}function prng_newstate(){return new Arcfour}BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare,Arcfour.prototype.init=ARC4init,Arcfour.prototype.next=ARC4next;var rng_psize=256,rng_state,rng_pool,rng_pptr;
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
     */function rng_seed_int(e){rng_pool[rng_pptr++]^=255&e,rng_pool[rng_pptr++]^=e>>8&255,rng_pool[rng_pptr++]^=e>>16&255,rng_pool[rng_pptr++]^=e>>24&255,rng_pptr>=rng_psize&&(rng_pptr-=rng_psize)}function rng_seed_time(){rng_seed_int((new Date).getTime())}if(null==rng_pool){var t;if(rng_pool=new Array,rng_pptr=0,void 0!==window$1&&(void 0!==window$1.crypto||void 0!==window$1.msCrypto)){var crypto$1=window$1.crypto||window$1.msCrypto;if(crypto$1.getRandomValues){var ua=new Uint8Array(32);for(crypto$1.getRandomValues(ua),t=0;t<32;++t)rng_pool[rng_pptr++]=ua[t]}else if("Netscape"==navigator$1.appName&&navigator$1.appVersion<"5"){var z=window$1.crypto.random(32);for(t=0;t<z.length;++t)rng_pool[rng_pptr++]=255&z.charCodeAt(t)}}for(;rng_pptr<rng_psize;)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=t>>>8,rng_pool[rng_pptr++]=255&t;rng_pptr=0,rng_seed_time()}function rng_get_byte(){if(null==rng_state){for(rng_seed_time(),(rng_state=prng_newstate()).init(rng_pool),rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(e){var t;for(t=0;t<e.length;++t)e[t]=rng_get_byte()}function SecureRandom(){}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
     */
function parseBigInt(e,t){return new BigInteger(e,t)}function pkcs1pad2(e,t){if(t<e.length+11)throw"Message too long for RSA";for(var n=new Array,r=e.length-1;r>=0&&t>0;){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=63&i|128,n[--t]=i>>6|192):(n[--t]=63&i|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;for(var o=new SecureRandom,l=new Array;t>2;){for(l[0]=0;0==l[0];)o.nextBytes(l);n[--t]=l[0]}return n[--t]=2,n[--t]=0,new BigInteger(n)}function oaep_mgf1_arr(e,t,n){for(var r="",i=0;r.length<t;)r+=n(String.fromCharCode.apply(String,e.concat([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i]))),i+=1;return r}function oaep_pad(e,t,n,r){var i=KJUR.crypto.MessageDigest,o=KJUR.crypto.Util,l=null;if(n||(n="sha1"),"string"==typeof n&&(l=i.getCanonicalAlgName(n),r=i.getHashLength(l),n=function(e){return hextorstr(o.hashHex(rstrtohex(e),l))}),e.length+2*r+2>t)throw"Message too long for RSA";var s,a="";for(s=0;s<t-e.length-2*r-2;s+=1)a+="\0";var u=n("")+a+""+e,c=new Array(r);(new SecureRandom).nextBytes(c);var h=oaep_mgf1_arr(c,u.length,n),d=[];for(s=0;s<u.length;s+=1)d[s]=u.charCodeAt(s)^h.charCodeAt(s);var f=oaep_mgf1_arr(d,c.length,n),p=[0];for(s=0;s<c.length;s+=1)p[s+1]=c[s]^f.charCodeAt(s);return new BigInteger(p.concat(d))}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(e,t){if(this.isPublic=!0,this.isPrivate=!1,"string"!=typeof e)this.n=e,this.e=t;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA public key";this.n=parseBigInt(e,16),this.e=parseInt(t,16)}}function RSADoPublic(e){return e.modPowInt(this.e,this.n)}function RSAEncrypt(e){var t=pkcs1pad2(e,this.n.bitLength()+7>>3);if(null==t)return null;var n=this.doPublic(t);if(null==n)return null;var r=n.toString(16);return 0==(1&r.length)?r:"0"+r}function RSAEncryptOAEP(e,t,n){var r=this.n.bitLength()+7>>3,i=oaep_pad(e,r,t,n);if(null==i)return null;var o=this.doPublic(i);if(null==o)return null;for(var l=o.toString(16);l.length<2*r;)l="0"+l;return l}
/*! (c) Tom Wu, Kenji Urushima | http://www-cs-students.stanford.edu/~tjw/jsbn/
     */
function pkcs1unpad2(e,t){for(var n=e.toByteArray(),r=0;r<n.length&&0==n[r];)++r;if(n.length-r!=t-1||2!=n[r])return null;for(++r;0!=n[r];)if(++r>=n.length)return null;for(var i="";++r<n.length;){var o=255&n[r];o<128?i+=String.fromCharCode(o):o>191&&o<224?(i+=String.fromCharCode((31&o)<<6|63&n[r+1]),++r):(i+=String.fromCharCode((15&o)<<12|(63&n[r+1])<<6|63&n[r+2]),r+=2)}return i}function oaep_mgf1_str(e,t,n){for(var r="",i=0;r.length<t;)r+=n(e+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])),i+=1;return r}function oaep_unpad(e,t,n,r){var i=KJUR.crypto.MessageDigest,o=KJUR.crypto.Util,l=null;for(n||(n="sha1"),"string"==typeof n&&(l=i.getCanonicalAlgName(n),r=i.getHashLength(l),n=function(e){return hextorstr(o.hashHex(rstrtohex(e),l))}),e=e.toByteArray(),s=0;s<e.length;s+=1)e[s]&=255;for(;e.length<t;)e.unshift(0);if((e=String.fromCharCode.apply(String,e)).length<2*r+2)throw"Cipher too short";var s,a=e.substr(1,r),u=e.substr(r+1),c=oaep_mgf1_str(u,r,n),h=[];for(s=0;s<a.length;s+=1)h[s]=a.charCodeAt(s)^c.charCodeAt(s);var d=oaep_mgf1_str(String.fromCharCode.apply(String,h),e.length-r,n),f=[];for(s=0;s<u.length;s+=1)f[s]=u.charCodeAt(s)^d.charCodeAt(s);if((f=String.fromCharCode.apply(String,f)).substr(0,r)!==n(""))throw"Hash mismatch";var p=(f=f.substr(r)).indexOf("");if((-1!=p?f.substr(0,p).lastIndexOf("\0"):-1)+1!=p)throw"Malformed data";return f.substr(p+1)}function RSASetPrivate(e,t,n){if(this.isPrivate=!0,"string"!=typeof e)this.n=e,this.e=t,this.d=n;else{if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA private key";this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16)}}function RSASetPrivateEx(e,t,n,r,i,o,l,s){if(this.isPrivate=!0,this.isPublic=!1,null==e)throw"RSASetPrivateEx N == null";if(null==t)throw"RSASetPrivateEx E == null";if(0==e.length)throw"RSASetPrivateEx N.length == 0";if(0==t.length)throw"RSASetPrivateEx E.length == 0";if(!(null!=e&&null!=t&&e.length>0&&t.length>0))throw"Invalid RSA private key in RSASetPrivateEx";this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16),this.p=parseBigInt(r,16),this.q=parseBigInt(i,16),this.dmp1=parseBigInt(o,16),this.dmq1=parseBigInt(l,16),this.coeff=parseBigInt(s,16)}function RSAGenerate(e,t){var n=new SecureRandom,r=e>>1;this.e=parseInt(t,16);for(var i=new BigInteger(t,16),o=e/2-100,l=BigInteger.ONE.shiftLeft(o);;){for(;this.p=new BigInteger(e-r,1,n),0!=this.p.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(r,1,n),0!=this.q.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var a=this.q.subtract(this.p).abs();if(!(a.bitLength()<o||a.compareTo(l)<=0)){var u=this.p.subtract(BigInteger.ONE),c=this.q.subtract(BigInteger.ONE),h=u.multiply(c);if(0==h.gcd(i).compareTo(BigInteger.ONE)&&(this.n=this.p.multiply(this.q),this.n.bitLength()==e)){this.d=i.modInverse(h),this.dmp1=this.d.mod(u),this.dmq1=this.d.mod(c),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0}function RSADoPrivate(e){if(null==this.p||null==this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(n)<0;)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function RSADecrypt(e){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var t=parseBigInt(e,16),n=this.doPrivate(t);return null==n?null:pkcs1unpad2(n,this.n.bitLength()+7>>3)}function RSADecryptOAEP(e,t,n){if(e.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var r=parseBigInt(e,16),i=this.doPrivate(r);return null==i?null:oaep_unpad(i,this.n.bitLength()+7>>3,t,n)}
/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
     */
function ECFieldElementFp(e,t){this.x=t,this.q=e}function feFpEquals(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)}function feFpToBigInteger(){return this.x}function feFpNegate(){return new ECFieldElementFp(this.q,this.x.negate().mod(this.q))}function feFpAdd(e){return new ECFieldElementFp(this.q,this.x.add(e.toBigInteger()).mod(this.q))}function feFpSubtract(e){return new ECFieldElementFp(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))}function feFpMultiply(e){return new ECFieldElementFp(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))}function feFpSquare(){return new ECFieldElementFp(this.q,this.x.square().mod(this.q))}function feFpDivide(e){return new ECFieldElementFp(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))}function ECPointFp(e,t,n,r){this.curve=e,this.x=t,this.y=n,this.z=null==r?BigInteger.ONE:r,this.zinv=null}function pointFpGetX(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function pointFpGetY(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function pointFpEquals(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(BigInteger.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(BigInteger.ZERO))}function pointFpIsInfinity(){return null==this.x&&null==this.y||this.z.equals(BigInteger.ZERO)&&!this.y.toBigInteger().equals(BigInteger.ZERO)}function pointFpNegate(){return new ECPointFp(this.curve,this.x,this.y.negate(),this.z)}function pointFpAdd(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),n=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(BigInteger.ZERO.equals(n))return BigInteger.ZERO.equals(t)?this.twice():this.curve.getInfinity();var r=new BigInteger("3"),i=this.x.toBigInteger(),o=this.y.toBigInteger();e.x.toBigInteger(),e.y.toBigInteger();var l=n.square(),s=l.multiply(n),a=i.multiply(l),u=t.square().multiply(this.z),c=u.subtract(a.shiftLeft(1)).multiply(e.z).subtract(s).multiply(n).mod(this.curve.q),h=a.multiply(r).multiply(t).subtract(o.multiply(s)).subtract(u.multiply(t)).multiply(e.z).add(t.multiply(s)).mod(this.curve.q),d=s.multiply(this.z).multiply(e.z).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(c),this.curve.fromBigInteger(h),d)}function pointFpTwice(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=new BigInteger("3"),t=this.x.toBigInteger(),n=this.y.toBigInteger(),r=n.multiply(this.z),i=r.multiply(n).mod(this.curve.q),o=this.curve.a.toBigInteger(),l=t.square().multiply(e);BigInteger.ZERO.equals(o)||(l=l.add(this.z.square().multiply(o)));var s=(l=l.mod(this.curve.q)).square().subtract(t.shiftLeft(3).multiply(i)).shiftLeft(1).multiply(r).mod(this.curve.q),a=l.multiply(e).multiply(t).subtract(i.shiftLeft(1)).shiftLeft(2).multiply(i).subtract(l.square().multiply(l)).mod(this.curve.q),u=r.square().multiply(r).shiftLeft(3).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(s),this.curve.fromBigInteger(a),u)}function pointFpMultiply(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,n=e,r=n.multiply(new BigInteger("3")),i=this.negate(),o=this,l=this.curve.q.subtract(e),s=l.multiply(new BigInteger("3")),a=new ECPointFp(this.curve,this.x,this.y),u=a.negate();for(t=r.bitLength()-2;t>0;--t){o=o.twice();var c=r.testBit(t);c!=n.testBit(t)&&(o=o.add(c?this:i))}for(t=s.bitLength()-2;t>0;--t){a=a.twice();var h=s.testBit(t);h!=l.testBit(t)&&(a=a.add(h?a:u))}return o}function pointFpMultiplyTwo(e,t,n){var r;r=e.bitLength()>n.bitLength()?e.bitLength()-1:n.bitLength()-1;for(var i=this.curve.getInfinity(),o=this.add(t);r>=0;)i=i.twice(),e.testBit(r)?i=n.testBit(r)?i.add(o):i.add(this):n.testBit(r)&&(i=i.add(t)),--r;return i}function ECCurveFp(e,t,n){this.q=e,this.a=this.fromBigInteger(t),this.b=this.fromBigInteger(n),this.infinity=new ECPointFp(this,null,null)}function curveFpGetQ(){return this.q}function curveFpGetA(){return this.a}function curveFpGetB(){return this.b}function curveFpEquals(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)}function curveFpGetInfinity(){return this.infinity}function curveFpFromBigInteger(e){return new ECFieldElementFp(this.q,e)}function curveFpDecodePointHex(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var t=e.substr(0,2);e.substr(2);var n=this.fromBigInteger(new BigInteger(s,16)),r=this.getA(),i=this.getB(),o=n.square().add(r).multiply(n).add(i).sqrt();return"03"==t&&(o=o.negate()),new ECPointFp(this,n,o);case 4:case 6:case 7:var l=(e.length-2)/2,s=e.substr(2,l),a=e.substr(l+2,l);return new ECPointFp(this,this.fromBigInteger(new BigInteger(s,16)),this.fromBigInteger(new BigInteger(a,16)));default:return null}}SecureRandom.prototype.nextBytes=rng_get_bytes,RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,RSAKey.prototype.encryptOAEP=RSAEncryptOAEP,RSAKey.prototype.type="RSA",RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt,RSAKey.prototype.decryptOAEP=RSADecryptOAEP,ECFieldElementFp.prototype.equals=feFpEquals,ECFieldElementFp.prototype.toBigInteger=feFpToBigInteger,ECFieldElementFp.prototype.negate=feFpNegate,ECFieldElementFp.prototype.add=feFpAdd,ECFieldElementFp.prototype.subtract=feFpSubtract,ECFieldElementFp.prototype.multiply=feFpMultiply,ECFieldElementFp.prototype.square=feFpSquare,ECFieldElementFp.prototype.divide=feFpDivide,ECFieldElementFp.prototype.sqrt=function(){return new ECFieldElementFp(this.q,this.x.sqrt().mod(this.q))},ECPointFp.prototype.getX=pointFpGetX,ECPointFp.prototype.getY=pointFpGetY,ECPointFp.prototype.equals=pointFpEquals,ECPointFp.prototype.isInfinity=pointFpIsInfinity,ECPointFp.prototype.negate=pointFpNegate,ECPointFp.prototype.add=pointFpAdd,ECPointFp.prototype.twice=pointFpTwice,ECPointFp.prototype.multiply=pointFpMultiply,ECPointFp.prototype.multiplyTwo=pointFpMultiplyTwo,ECCurveFp.prototype.getQ=curveFpGetQ,ECCurveFp.prototype.getA=curveFpGetA,ECCurveFp.prototype.getB=curveFpGetB,ECCurveFp.prototype.equals=curveFpEquals,ECCurveFp.prototype.getInfinity=curveFpGetInfinity,ECCurveFp.prototype.fromBigInteger=curveFpFromBigInteger,ECCurveFp.prototype.decodePointHex=curveFpDecodePointHex,
/*! (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
     */
ECFieldElementFp.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},ECPointFp.prototype.getEncoded=function(e){var t=function(e,t){var n=e.toByteArrayUnsigned();if(t<n.length)n=n.slice(n.length-t);else for(;t>n.length;)n.unshift(0);return n},n=this.getX().toBigInteger(),r=this.getY().toBigInteger(),i=t(n,32);return e?r.isEven()?i.unshift(2):i.unshift(3):(i.unshift(4),i=i.concat(t(r,32))),i},ECPointFp.decodeFrom=function(e,t){t[0];var n=t.length-1,r=t.slice(1,1+n/2),i=t.slice(1+n/2,1+n);r.unshift(0),i.unshift(0);var o=new BigInteger(r),l=new BigInteger(i);return new ECPointFp(e,e.fromBigInteger(o),e.fromBigInteger(l))},ECPointFp.decodeFromHex=function(e,t){t.substr(0,2);var n=t.length-2,r=t.substr(2,n/2),i=t.substr(2+n/2,n/2),o=new BigInteger(r,16),l=new BigInteger(i,16);return new ECPointFp(e,e.fromBigInteger(o),e.fromBigInteger(l))},ECPointFp.prototype.add2D=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;if(this.x.equals(e.x))return this.y.equals(e.y)?this.twice():this.curve.getInfinity();var t=e.x.subtract(this.x),n=e.y.subtract(this.y).divide(t),r=n.square().subtract(this.x).subtract(e.x),i=n.multiply(this.x.subtract(r)).subtract(this.y);return new ECPointFp(this.curve,r,i)},ECPointFp.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var e=this.curve.fromBigInteger(BigInteger.valueOf(2)),t=this.curve.fromBigInteger(BigInteger.valueOf(3)),n=this.x.square().multiply(t).add(this.curve.a).divide(this.y.multiply(e)),r=n.square().subtract(this.x.multiply(e)),i=n.multiply(this.x.subtract(r)).subtract(this.y);return new ECPointFp(this.curve,r,i)},ECPointFp.prototype.multiply2D=function(e){if(this.isInfinity())return this;if(0==e.signum())return this.curve.getInfinity();var t,n=e,r=n.multiply(new BigInteger("3")),i=this.negate(),o=this;for(t=r.bitLength()-2;t>0;--t){o=o.twice();var l=r.testBit(t);l!=n.testBit(t)&&(o=o.add2D(l?this:i))}return o},ECPointFp.prototype.isOnCurve=function(){var e=this.getX().toBigInteger(),t=this.getY().toBigInteger(),n=this.curve.getA().toBigInteger(),r=this.curve.getB().toBigInteger(),i=this.curve.getQ(),o=t.multiply(t).mod(i),l=e.multiply(e).multiply(e).add(n.multiply(e)).add(r).mod(i);return o.equals(l)},ECPointFp.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},ECPointFp.prototype.validate=function(){var e=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var t=this.getX().toBigInteger(),n=this.getY().toBigInteger();if(t.compareTo(BigInteger.ONE)<0||t.compareTo(e.subtract(BigInteger.ONE))>0)throw new Error("x coordinate out of bounds");if(n.compareTo(BigInteger.ONE)<0||n.compareTo(e.subtract(BigInteger.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(e).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};
/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
     */
var jsonParse=function(){var e=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),t=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),n={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function r(e,t,r){return t?n[t]:String.fromCharCode(parseInt(r,16))}var i=new String(""),o=Object.hasOwnProperty;return function(n,l){var s,a,u=n.match(e),c=u[0],h=!1;"{"===c?s={}:"["===c?s=[]:(s=[],h=!0);for(var d=[s],f=1-h,p=u.length;f<p;++f){var g;switch((c=u[f]).charCodeAt(0)){default:(g=d[0])[a||g.length]=+c,a=void 0;break;case 34:if(-1!==(c=c.substring(1,c.length-1)).indexOf("\\")&&(c=c.replace(t,r)),g=d[0],!a){if(!(g instanceof Array)){a=c||i;break}a=g.length}g[a]=c,a=void 0;break;case 91:g=d[0],d.unshift(g[a||g.length]=[]),a=void 0;break;case 93:case 125:d.shift();break;case 102:(g=d[0])[a||g.length]=!1,a=void 0;break;case 110:(g=d[0])[a||g.length]=null,a=void 0;break;case 116:(g=d[0])[a||g.length]=!0,a=void 0;break;case 123:g=d[0],d.unshift(g[a||g.length]={}),a=void 0}}if(h){if(1!==d.length)throw new Error;s=s[0]}else if(d.length)throw new Error;if(l){var w=function(e,t){var n=e[t];if(n&&"object"==typeof n){var r=null;for(var i in n)if(o.call(n,i)&&n!==e){var s=w(n,i);void 0!==s?n[i]=s:(r||(r=[]),r.push(i))}if(r)for(var a=r.length;--a>=0;)delete n[r[a]]}return l.call(e,t,n)};s=w({"":s},"")}return s}}();void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),KJUR.asn1.ASN1Util=new function(){this.integerToByteHex=function(e){var t=e.toString(16);return t.length%2==1&&(t="0"+t),t},this.bigIntToMinTwosComplementsHex=function(e){var t=e.toString(16);if("-"!=t.substr(0,1))t.length%2==1?t="0"+t:t.match(/^[0-7]/)||(t="00"+t);else{var n=t.substr(1).length;n%2==1?n+=1:t.match(/^[0-7]/)||(n+=2);for(var r="",i=0;i<n;i++)r+="f";t=new BigInteger(r,16).xor(e).add(BigInteger.ONE).toString(16).replace(/^-/,"")}return t},this.getPEMStringFromHex=function(e,t){return hextopem(e,t)},this.newObject=function(e){var t=KJUR.asn1,n=t.ASN1Object,r=t.DERBoolean,i=t.DERInteger,o=t.DERBitString,l=t.DEROctetString,s=t.DERNull,a=t.DERObjectIdentifier,u=t.DEREnumerated,c=t.DERUTF8String,h=t.DERNumericString,d=t.DERPrintableString,f=t.DERTeletexString,p=t.DERIA5String,g=t.DERUTCTime,w=t.DERGeneralizedTime,m=t.DERVisibleString,v=t.DERBMPString,y=t.DERSequence,b=t.DERSet,S=t.DERTaggedObject,$=t.ASN1Util.newObject;if(e instanceof t.ASN1Object)return e;var C=Object.keys(e);if(1!=C.length)throw new Error("key of param shall be only one.");var I=C[0];if(-1==":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+I+":"))throw new Error("undefined key: "+I);if("bool"==I)return new r(e[I]);if("int"==I)return new i(e[I]);if("bitstr"==I)return new o(e[I]);if("octstr"==I)return new l(e[I]);if("null"==I)return new s(e[I]);if("oid"==I)return new a(e[I]);if("enum"==I)return new u(e[I]);if("utf8str"==I)return new c(e[I]);if("numstr"==I)return new h(e[I]);if("prnstr"==I)return new d(e[I]);if("telstr"==I)return new f(e[I]);if("ia5str"==I)return new p(e[I]);if("utctime"==I)return new g(e[I]);if("gentime"==I)return new w(e[I]);if("visstr"==I)return new m(e[I]);if("bmpstr"==I)return new v(e[I]);if("asn1"==I)return new n(e[I]);if("seq"==I){for(var x=e[I],E=[],D=0;D<x.length;D++){var A=$(x[D]);E.push(A)}return new y({array:E})}if("set"==I){for(x=e[I],E=[],D=0;D<x.length;D++){A=$(x[D]);E.push(A)}return new b({array:E})}if("tag"==I){var k=e[I];if("[object Array]"===Object.prototype.toString.call(k)&&3==k.length){var _=$(k[2]);return new S({tag:k[0],explicit:k[1],obj:_})}return new S(k)}},this.jsonToASN1HEX=function(e){return this.newObject(e).tohex()}},KJUR.asn1.ASN1Util.oidHexToInt=function(e){for(var t="",n=parseInt(e.substr(0,2),16),r=(t=Math.floor(n/40)+"."+n%40,""),i=2;i<e.length;i+=2){var o=("00000000"+parseInt(e.substr(i,2),16).toString(2)).slice(-8);if(r+=o.substr(1,7),"0"==o.substr(0,1))t=t+"."+new BigInteger(r,2).toString(10),r=""}return t},KJUR.asn1.ASN1Util.oidIntToHex=function(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},n=function(e){var n="",r=new BigInteger(e,10).toString(2),i=7-r.length%7;7==i&&(i=0);for(var o="",l=0;l<i;l++)o+="0";r=o+r;for(l=0;l<r.length-1;l+=7){var s=r.substr(l,7);l!=r.length-7&&(s="1"+s),n+=t(parseInt(s,2))}return n};if(!e.match(/^[0-9.]+$/))throw"malformed oid string: "+e;var r="",i=e.split("."),o=40*parseInt(i[0])+parseInt(i[1]);r+=t(o),i.splice(0,2);for(var l=0;l<i.length;l++)r+=n(i[l]);return r},KJUR.asn1.ASN1Object=function(e){this.params=null,this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n=0,v="+this.hV);var e=this.hV.length/2,t=e.toString(16);if(t.length%2==1&&(t="0"+t),e<128)return t;var n=t.length/2;if(n>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+e.toString(16));return(128+n).toString(16)+t},this.tohex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(e){this.params=e},null!=e&&null!=e.tlv&&(this.hTLV=e.tlv,this.isModified=!1)},KJUR.asn1.DERAbstractString=function(e){KJUR.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=utf8tohex(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e?this.setString(e):void 0!==e.str?this.setString(e.str):void 0!==e.hex&&this.setStringHex(e.hex))},extendClass(KJUR.asn1.DERAbstractString,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractTime=function(e){KJUR.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){var t=e.getTime()+6e4*e.getTimezoneOffset();return new Date(t)},this.formatDate=function(e,t,n){var r=this.zeroPadding,i=this.localDateToUTC(e),o=String(i.getFullYear());"utc"==t&&(o=o.substr(2,2));var l=o+r(String(i.getMonth()+1),2)+r(String(i.getDate()),2)+r(String(i.getHours()),2)+r(String(i.getMinutes()),2)+r(String(i.getSeconds()),2);if(!0===n){var s=i.getMilliseconds();if(0!=s){var a=r(String(s),3);l=l+"."+(a=a.replace(/[0]+$/,""))}}return l+"Z"},this.zeroPadding=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},this.setByParam=function(e){this.hV=null,this.hTLV=null,this.params=e},this.getString=function(){},this.setString=function(e){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.str=e},this.setByDate=function(e){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.date=e},this.setByDateValue=function(e,t,n,r,i,o){var l=new Date(Date.UTC(e,t-1,n,r,i,o,0));this.setByDate(l)},this.getFreshValueHex=function(){return this.hV}},extendClass(KJUR.asn1.DERAbstractTime,KJUR.asn1.ASN1Object),KJUR.asn1.DERAbstractStructured=function(e){KJUR.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,void 0!==e&&void 0!==e.array&&(this.asn1Array=e.array)},extendClass(KJUR.asn1.DERAbstractStructured,KJUR.asn1.ASN1Object),KJUR.asn1.DERBoolean=function(e){KJUR.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=0==e?"010100":"0101ff"},extendClass(KJUR.asn1.DERBoolean,KJUR.asn1.ASN1Object),KJUR.asn1.DERInteger=function(e){KJUR.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var t=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex;this.setByBigInteger=function(e){this.isModified=!0,this.params={bigint:e}},this.setByInteger=function(e){this.isModified=!0,this.params=e},this.setValueHex=function(e){this.isModified=!0,this.params={hex:e}},this.getFreshValueHex=function(){var e=this.params,n=null;if(null==e)throw new Error("value not set");if("object"==typeof e&&null!=e.hex)return this.hV=e.hex,this.hV;if("number"==typeof e)n=new BigInteger(String(e),10);else if(null!=e.int)n=new BigInteger(String(e.int),10);else{if(null==e.bigint)throw new Error("wrong parameter");n=e.bigint}return this.hV=t(n),this.hV},null!=e&&(this.params=e)},extendClass(KJUR.asn1.DERInteger,KJUR.asn1.ASN1Object),KJUR.asn1.DERBitString=function(e){if(void 0!==e&&void 0!==e.obj){var t=KJUR.asn1.ASN1Util.newObject(e.obj);e.hex="00"+t.tohex()}KJUR.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(e){this.hTLV=null,this.isModified=!0,this.hV=e},this.setUnusedBitsAndHexValue=function(e,t){if(e<0||7<e)throw"unused bits shall be from 0 to 7: u = "+e;var n="0"+e;this.hTLV=null,this.isModified=!0,this.hV=n+t},this.setByBinaryString=function(e){var t=8-(e=e.replace(/0+$/,"")).length%8;8==t&&(t=0),e+="0000000".substr(0,t);for(var n="",r=0;r<e.length-1;r+=8){var i=e.substr(r,8),o=parseInt(i,2).toString(16);1==o.length&&(o="0"+o),n+=o}this.hTLV=null,this.isModified=!0,this.hV="0"+t+n},this.setByBooleanArray=function(e){for(var t="",n=0;n<e.length;n++)1==e[n]?t+="1":t+="0";this.setByBinaryString(t)},this.newFalseArray=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=!1;return t},this.getFreshValueHex=function(){return this.hV},void 0!==e&&("string"==typeof e&&e.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(e):void 0!==e.hex?this.setHexValueIncludingUnusedBits(e.hex):void 0!==e.bin?this.setByBinaryString(e.bin):void 0!==e.array&&this.setByBooleanArray(e.array))},extendClass(KJUR.asn1.DERBitString,KJUR.asn1.ASN1Object),KJUR.asn1.DEROctetString=function(e){if(void 0!==e&&void 0!==e.obj){var t=KJUR.asn1.ASN1Util.newObject(e.obj);e.hex=t.tohex()}KJUR.asn1.DEROctetString.superclass.constructor.call(this,e),this.hT="04"},extendClass(KJUR.asn1.DEROctetString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNull=function(){KJUR.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},extendClass(KJUR.asn1.DERNull,KJUR.asn1.ASN1Object),KJUR.asn1.DERObjectIdentifier=function(e){KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var t=oidtohex(e);if(null==t)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueName=function(e){var t=KJUR.asn1.x509.OID.name2oid(e);if(""===t)throw new Error("DERObjectIdentifier oidName undefined: "+e);this.setValueOidString(t)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){"string"==typeof e?this.setValueNameOrOid(e):void 0!==e.oid?this.setValueNameOrOid(e.oid):void 0!==e.name?this.setValueNameOrOid(e.name):void 0!==e.hex&&this.setValueHex(e.hex)},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.DERObjectIdentifier,KJUR.asn1.ASN1Object),KJUR.asn1.DEREnumerated=function(e){KJUR.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var t=new BigInteger(String(e),10);this.setByBigInteger(t)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},void 0!==e&&(void 0!==e.int?this.setByInteger(e.int):"number"==typeof e?this.setByInteger(e):void 0!==e.hex&&this.setValueHex(e.hex))},extendClass(KJUR.asn1.DEREnumerated,KJUR.asn1.ASN1Object),KJUR.asn1.DERUTF8String=function(e){KJUR.asn1.DERUTF8String.superclass.constructor.call(this,e),this.hT="0c"},extendClass(KJUR.asn1.DERUTF8String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERNumericString=function(e){KJUR.asn1.DERNumericString.superclass.constructor.call(this,e),this.hT="12"},extendClass(KJUR.asn1.DERNumericString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERPrintableString=function(e){KJUR.asn1.DERPrintableString.superclass.constructor.call(this,e),this.hT="13"},extendClass(KJUR.asn1.DERPrintableString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERTeletexString=function(e){KJUR.asn1.DERTeletexString.superclass.constructor.call(this,e),this.hT="14"},extendClass(KJUR.asn1.DERTeletexString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERIA5String=function(e){KJUR.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="16"},extendClass(KJUR.asn1.DERIA5String,KJUR.asn1.DERAbstractString),KJUR.asn1.DERVisibleString=function(e){KJUR.asn1.DERIA5String.superclass.constructor.call(this,e),this.hT="1a"},extendClass(KJUR.asn1.DERVisibleString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERBMPString=function(e){KJUR.asn1.DERBMPString.superclass.constructor.call(this,e),this.hT="1e"},extendClass(KJUR.asn1.DERBMPString,KJUR.asn1.DERAbstractString),KJUR.asn1.DERUTCTime=function(e){KJUR.asn1.DERUTCTime.superclass.constructor.call(this,e),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var e=this.params;if(null==this.params&&(e={date:new Date}),"string"==typeof e){if(!e.match(/^[0-9]{12}Z$/)&&!e.match(/^[0-9]{12}\.[0-9]+Z$/))throw new Error("malformed string for UTCTime: "+e);this.hV=stohex(e)}else if(null!=e.str)this.hV=stohex(e.str);else if(null==e.date&&1==e.millis){var t=new Date;this.hV=stohex(this.formatDate(t,"utc",!0))}else if(null!=e.date&&e.date instanceof Date){var n=!0===e.millis;this.hV=stohex(this.formatDate(e.date,"utc",n))}else e instanceof Date&&(this.hV=stohex(this.formatDate(e,"utc")));if(null==this.hV)throw new Error("parameter not specified properly for UTCTime");return this.hV},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.DERUTCTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERGeneralizedTime=function(e){KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this,e),this.hT="18",this.params=e,this.getFreshValueHex=function(){var e=this.params;if(null==this.params&&(e={date:new Date}),"string"==typeof e){if(!e.match(/^[0-9]{14}Z$/)&&!e.match(/^[0-9]{14}\.[0-9]+Z$/))throw new Error("malformed string for GeneralizedTime: "+e);this.hV=stohex(e)}else if(null!=e.str)this.hV=stohex(e.str);else if(null==e.date&&1==e.millis){var t=new Date;this.hV=stohex(this.formatDate(t,"gen",!0))}else if(null!=e.date&&e.date instanceof Date){var n=!0===e.millis;this.hV=stohex(this.formatDate(e.date,"gen",n))}else e instanceof Date&&(this.hV=stohex(this.formatDate(e,"gen")));if(null==this.hV)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.DERGeneralizedTime,KJUR.asn1.DERAbstractTime),KJUR.asn1.DERSequence=function(e){KJUR.asn1.DERSequence.superclass.constructor.call(this,e),this.hT="30",this.getFreshValueHex=function(){for(var e="",t=0;t<this.asn1Array.length;t++){e+=this.asn1Array[t].tohex()}return this.hV=e,this.hV}},extendClass(KJUR.asn1.DERSequence,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERSet=function(e){KJUR.asn1.DERSet.superclass.constructor.call(this,e),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,t=0;t<this.asn1Array.length;t++){var n=this.asn1Array[t];e.push(n.tohex())}return 1==this.sortFlag&&e.sort(),this.hV=e.join(""),this.hV},void 0!==e&&void 0!==e.sortflag&&0==e.sortflag&&(this.sortFlag=!1)},extendClass(KJUR.asn1.DERSet,KJUR.asn1.DERAbstractStructured),KJUR.asn1.DERTaggedObject=function(e){KJUR.asn1.DERTaggedObject.superclass.constructor.call(this);var t=KJUR.asn1,n=ASN1HEX,r=n.getV;n.isASN1HEX;var i=t.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(e,t,n){this.params={tag:t,explicit:e,obj:n}},this.getFreshValueHex=function(){var e=this.params;if(null==e.explicit&&(e.explicit=!0),null!=e.tage&&(e.tag=e.tage,e.explicit=!0),null!=e.tagi&&(e.tag=e.tagi,e.explicit=!1),null!=e.str)this.hV=utf8tohex(e.str);else if(null!=e.hex)this.hV=e.hex;else{if(null==e.obj)throw new Error("str, hex nor obj not specified");var n;e.obj instanceof t.ASN1Object?n=e.obj.tohex():"object"==typeof e.obj&&(n=i(e.obj).tohex()),e.explicit?this.hV=n:this.hV=r(n,0)}return null==e.tag&&(e.tag="a0"),this.hT=e.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.DERTaggedObject,KJUR.asn1.ASN1Object);var ASN1HEX=new function(){},KJUR,utf8tob64u,b64utoutf8;function stoBA(e){for(var t=new Array,n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function BAtohex(e){for(var t="",n=0;n<e.length;n++){var r=e[n].toString(16);1==r.length&&(r="0"+r),t+=r}return t}function stohex(e){return BAtohex(stoBA(e))}function b64tob64u(e){return e=(e=(e=e.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function b64utob64(e){return e.length%4==2?e+="==":e.length%4==3&&(e+="="),e=(e=e.replace(/-/g,"+")).replace(/_/g,"/")}function hextob64u(e){return e.length%2==1&&(e="0"+e),b64tob64u(hex2b64(e))}function b64utohex(e){return b64tohex(b64utob64(e))}function utf8tohex(e){return uricmptohex(encodeURIComponentAll(e)).toLowerCase()}function hextoutf8(e){try{return decodeURIComponent(hextouricmp(e))}catch(e){return null}}function iso88591hextoutf8(e){return hextoutf8(iso88591hextoutf8hex(e))}function iso88591hextoutf8hex(e){for(var t=e.match(/.{1,2}/g),n=[],r=0;r<t.length;r++){var i=parseInt(t[r],16);161<=i&&i<=191?(n.push("c2"),n.push(t[r])):192<=i&&i<=255?(n.push("c3"),n.push((i-64).toString(16))):n.push(t[r])}return n.join("")}function hextorstr(e){for(var t="",n=0;n<e.length-1;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t}function rstrtohex(e){for(var t="",n=0;n<e.length;n++)t+=("0"+e.charCodeAt(n).toString(16)).slice(-2);return t}function hextob64(e){return hex2b64(e)}function foldnl(e,t){return e=(e=e.replace(new RegExp("(.{"+t+"})","g"),"$1\r\n")).replace(/\s+$/,"")}function b64nltohex(e){return b64tohex(e.replace(/[^0-9A-Za-z\/+=]*/g,""))}function hextopem(e,t){return"-----BEGIN "+t+"-----\r\n"+foldnl(hextob64(e),64)+"\r\n-----END "+t+"-----\r\n"}function pemtohex(e,t){if(-1==e.indexOf("-----BEGIN "))throw new Error("can't find PEM header");return b64nltohex(e=void 0!==t?(e=e.replace(new RegExp("^[^]*-----BEGIN "+t+"-----"),"")).replace(new RegExp("-----END "+t+"-----[^]*$"),""):(e=e.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function zulutomsec(e){var t,n,r,i,o,l,s,a,u,c;if(c=(e=timetogen(e)).match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return t=parseInt(c[1]),n=parseInt(c[2])-1,r=parseInt(c[3]),i=parseInt(c[4]),o=parseInt(c[5]),l=parseInt(c[6]),s=0,""!==(a=c[7])&&(u=(a.substr(1)+"00").substr(0,3),s=parseInt(u)),Date.UTC(t,n,r,i,o,l,s);throw new Error("unsupported zulu format: "+e)}function zulutosec(e){return Math.round(zulutomsec(e)/1e3)}function timetogen(e){return e.match(/^[0-9]{12}Z$/)||e.match(/^[0-9]{12}[.][0-9]*Z$/)?e.match(/^[0-4]/)?"20"+e:"19"+e:e}function uricmptohex(e){return e.replace(/%/g,"")}function hextouricmp(e){return e.replace(/(..)/g,"%$1")}function ipv6tohex(e){var t="malformed IPv6 address";if(!e.match(/^[0-9A-Fa-f:]+$/))throw t;var n=(e=e.toLowerCase()).split(":").length-1;if(n<2)throw t;var r=":".repeat(7-n+2),i=(e=e.replace("::",r)).split(":");if(8!=i.length)throw t;for(var o=0;o<8;o++)i[o]=("0000"+i[o]).slice(-4);return i.join("")}function hextoipv6(e){if(!e.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+e);var t=(e=e.toLowerCase()).match(/.{1,4}/g),n=(e=":"+(t=(t=t.map((function(e){return e.replace(/^0+/,"")}))).map((function(e){return""==e?"0":e}))).join(":")+":").match(/:(0:){2,}/g);if(null==n)return e.slice(1,-1);var r=n.sort().slice(-1)[0];return"::"!=(e=e.replace(r.substr(0,r.length-1),":")).substr(0,2)&&(e=e.substr(1)),"::"!=e.substr(-2,2)&&(e=e.substr(0,e.length-1)),e}function hextoip(e){var t=new Error("malformed hex value");if(!e.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw t;if(8==e.length){try{return parseInt(e.substr(0,2),16)+"."+parseInt(e.substr(2,2),16)+"."+parseInt(e.substr(4,2),16)+"."+parseInt(e.substr(6,2),16)}catch(e){throw t}}else{if(16!=e.length){if(32==e.length)return hextoipv6(e);if(64==e.length){try{return hextoipv6(e.substr(0,32))+"/"+ipprefixlen(e.substr(32))}catch(e){throw t}return}return e}try{return hextoip(e.substr(0,8))+"/"+ipprefixlen(e.substr(8))}catch(e){throw t}}}function ipprefixlen(e){var t,n=new Error("malformed mask");try{t=new BigInteger(e,16).toString(2)}catch(e){throw n}if(!t.match(/^1*0*$/))throw n;return t.replace(/0+$/,"").length}function iptohex(e){var t=new Error("malformed IP address");if(!(e=e.toLowerCase(e)).match(/^[0-9a-f.:/]+$/))throw t;if(!e.match(/^[0-9.]+$/)){var n;if(e.match(/^[0-9.]+\/[0-9]+$/))return iptohex((n=e.split("/"))[0])+ipnetmask(parseInt(n[1]),32);if(e.match(/^[0-9a-f:]+$/)&&-1!==e.indexOf(":"))return ipv6tohex(e);if(e.match(/^[0-9a-f:]+\/[0-9]+$/)&&-1!==e.indexOf(":"))return ipv6tohex((n=e.split("/"))[0])+ipnetmask(parseInt(n[1]),128);throw t}var r=e.split(".");if(4!==r.length)throw t;var i="";try{for(var o=0;o<4;o++){i+=("0"+parseInt(r[o]).toString(16)).slice(-2)}return i}catch(e){throw t}}function ipnetmask(e,t){return 32==t&&0==e?"00000000":128==t&&0==e?"00000000000000000000000000000000":new BigInteger(Array(e+1).join("1")+Array(t-e+1).join("0"),2).toString(16)}function ucs2hextoutf8(e){var t=e.match(/.{4}/g).map((function(e){var t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2),16);if(0==t&n<128)return String.fromCharCode(n);if(t<8){var r=128|63&n;return hextoutf8((192|(7&t)<<3|(192&n)>>6).toString(16)+r.toString(16))}r=128|(15&t)<<2|(192&n)>>6;var i=128|63&n;return hextoutf8((224|(240&t)>>4).toString(16)+r.toString(16)+i.toString(16))}));return t.join("")}function encodeURIComponentAll(e){for(var t=encodeURIComponent(e),n="",r=0;r<t.length;r++)"%"==t[r]?(n+=t.substr(r,3),r+=2):n=n+"%"+stohex(t[r]);return n}function ishex(e){return!(e.length%2!=0||!e.match(/^[0-9a-f]+$/)&&!e.match(/^[0-9A-F]+$/))}function isBase64URLDot(e){return!!e.match(/^[0-9A-Za-z-_.]+$/)}function hextoposhex(e){return e.length%2==1?"0"+e:e.substr(0,1)>"7"?"00"+e:e}function oidtohex(e){var t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t},n=function(e){var n="",r=parseInt(e,10).toString(2),i=7-r.length%7;7==i&&(i=0);for(var o="",l=0;l<i;l++)o+="0";r=o+r;for(l=0;l<r.length-1;l+=7){var s=r.substr(l,7);l!=r.length-7&&(s="1"+s),n+=t(parseInt(s,2))}return n};try{if(!e.match(/^[0-9.]+$/))return null;var r="",i=e.split("."),o=40*parseInt(i[0],10)+parseInt(i[1],10);r+=t(o),i.splice(0,2);for(var l=0;l<i.length;l++)r+=n(i[l]);return r}catch(e){return null}}function hextooid(e){if(!ishex(e))return null;try{var t=[],n=e.substr(0,2),r=parseInt(n,16);t[0]=new String(Math.floor(r/40)),t[1]=new String(r%40);for(var i=e.substr(2),o=[],l=0;l<i.length/2;l++)o.push(parseInt(i.substr(2*l,2),16));var s=[],a="";for(l=0;l<o.length;l++)128&o[l]?a+=strpad((127&o[l]).toString(2),7):(a+=strpad((127&o[l]).toString(2),7),s.push(new String(parseInt(a,2))),a="");var u=t.join(".");return s.length>0&&(u=u+"."+s.join(".")),u}catch(e){return null}}ASN1HEX.getLblen=function(e,t){if("8"!=e.substr(t+2,1))return 1;var n=parseInt(e.substr(t+3,1));return 0==n?-1:0<n&&n<10?n+1:-2},ASN1HEX.getL=function(e,t){var n=ASN1HEX.getLblen(e,t);return n<1?"":e.substr(t+2,2*n)},ASN1HEX.getVblen=function(e,t){var n;return""==(n=ASN1HEX.getL(e,t))?-1:("8"===n.substr(0,1)?new BigInteger(n.substr(2),16):new BigInteger(n,16)).intValue()},ASN1HEX.getVidx=function(e,t){var n=ASN1HEX.getLblen(e,t);return n<0?n:t+2*(n+1)},ASN1HEX.getV=function(e,t){var n=ASN1HEX.getVidx(e,t),r=ASN1HEX.getVblen(e,t);return e.substr(n,2*r)},ASN1HEX.getTLV=function(e,t){return e.substr(t,2)+ASN1HEX.getL(e,t)+ASN1HEX.getV(e,t)},ASN1HEX.getTLVblen=function(e,t){return 2+2*ASN1HEX.getLblen(e,t)+2*ASN1HEX.getVblen(e,t)},ASN1HEX.getNextSiblingIdx=function(e,t){return ASN1HEX.getVidx(e,t)+2*ASN1HEX.getVblen(e,t)},ASN1HEX.getChildIdx=function(e,t){var n,r,i,o=ASN1HEX,l=[];n=o.getVidx(e,t),r=2*o.getVblen(e,t),"03"==e.substr(t,2)&&(n+=2,r-=2),i=0;for(var s=n;i<=r;){var a=o.getTLVblen(e,s);if((i+=a)<=r&&l.push(s),s+=a,i>=r)break}return l},ASN1HEX.getNthChildIdx=function(e,t,n){return ASN1HEX.getChildIdx(e,t)[n]},ASN1HEX.getIdxbyList=function(e,t,n,r){var i,o,l=ASN1HEX;return 0==n.length?void 0!==r&&e.substr(t,2)!==r?-1:t:(i=n.shift())>=(o=l.getChildIdx(e,t)).length?-1:l.getIdxbyList(e,o[i],n,r)},ASN1HEX.getIdxbyListEx=function(e,t,n,r){var i,o,l=ASN1HEX;if(0==n.length)return void 0!==r&&e.substr(t,2)!==r?-1:t;i=n.shift(),o=l.getChildIdx(e,t);for(var s=0,a=0;a<o.length;a++){var u=e.substr(o[a],2);if("number"==typeof i&&!l.isContextTag(u)&&s==i||"string"==typeof i&&l.isContextTag(u,i))return l.getIdxbyListEx(e,o[a],n,r);l.isContextTag(u)||s++}return-1},ASN1HEX.getTLVbyList=function(e,t,n,r){var i=ASN1HEX,o=i.getIdxbyList(e,t,n,r);return-1==o||o>=e.length?null:i.getTLV(e,o)},ASN1HEX.getTLVbyListEx=function(e,t,n,r){var i=ASN1HEX,o=i.getIdxbyListEx(e,t,n,r);return-1==o?null:i.getTLV(e,o)},ASN1HEX.getVbyList=function(e,t,n,r,i){var o,l,s=ASN1HEX;return-1==(o=s.getIdxbyList(e,t,n,r))||o>=e.length?null:(l=s.getV(e,o),!0===i&&(l=l.substr(2)),l)},ASN1HEX.getVbyListEx=function(e,t,n,r,i){var o,l,s=ASN1HEX;return-1==(o=s.getIdxbyListEx(e,t,n,r))?null:(l=s.getV(e,o),"03"==e.substr(o,2)&&!1!==i&&(l=l.substr(2)),l)},ASN1HEX.getInt=function(e,t,n){null==n&&(n=-1);try{var r=e.substr(t,2);if("02"!=r&&"03"!=r)return n;var i=ASN1HEX.getV(e,t);return"02"==r?parseInt(i,16):bitstrtoint(i)}catch(e){return n}},ASN1HEX.getOID=function(e,t,n){null==n&&(n=null);try{return"06"!=e.substr(t,2)?n:hextooid(ASN1HEX.getV(e,t))}catch(e){return n}},ASN1HEX.getOIDName=function(e,t,n){null==n&&(n=null);try{var r=ASN1HEX.getOID(e,t,n);if(r==n)return n;var i=KJUR.asn1.x509.OID.oid2name(r);return""==i?r:i}catch(e){return n}},ASN1HEX.getString=function(e,t,n){null==n&&(n=null);try{return hextorstr(ASN1HEX.getV(e,t))}catch(e){return n}},ASN1HEX.hextooidstr=function(e){var t=function(e,t){return e.length>=t?e:new Array(t-e.length+1).join("0")+e},n=[],r=e.substr(0,2),i=parseInt(r,16);n[0]=new String(Math.floor(i/40)),n[1]=new String(i%40);for(var o=e.substr(2),l=[],s=0;s<o.length/2;s++)l.push(parseInt(o.substr(2*s,2),16));var a=[],u="";for(s=0;s<l.length;s++)128&l[s]?u+=t((127&l[s]).toString(2),7):(u+=t((127&l[s]).toString(2),7),a.push(new String(parseInt(u,2))),u="");var c=n.join(".");return a.length>0&&(c=c+"."+a.join(".")),c},ASN1HEX.dump=function(e,t,n,r){var i=ASN1HEX,o=i.getV,l=i.dump,s=i.getChildIdx,a=e;e instanceof KJUR.asn1.ASN1Object&&(a=e.tohex());var u=function(e,t){return e.length<=2*t?e:e.substr(0,t)+"..(total "+e.length/2+"bytes).."+e.substr(e.length-t,t)};void 0===t&&(t={ommit_long_octet:32}),void 0===n&&(n=0),void 0===r&&(r="");var c,h=t.ommit_long_octet;if("01"==(c=a.substr(n,2)))return"00"==(d=o(a,n))?r+"BOOLEAN FALSE\n":r+"BOOLEAN TRUE\n";if("02"==c)return r+"INTEGER "+u(d=o(a,n),h)+"\n";if("03"==c){var d=o(a,n);if(i.isASN1HEX(d.substr(2))){var f=r+"BITSTRING, encapsulates\n";return f+=l(d.substr(2),t,0,r+"  ")}return r+"BITSTRING "+u(d,h)+"\n"}if("04"==c){d=o(a,n);if(i.isASN1HEX(d)){f=r+"OCTETSTRING, encapsulates\n";return f+=l(d,t,0,r+"  ")}return r+"OCTETSTRING "+u(d,h)+"\n"}if("05"==c)return r+"NULL\n";if("06"==c){var p=o(a,n),g=KJUR.asn1.ASN1Util.oidHexToInt(p),w=KJUR.asn1.x509.OID.oid2name(g),m=g.replace(/\./g," ");return""!=w?r+"ObjectIdentifier "+w+" ("+m+")\n":r+"ObjectIdentifier ("+m+")\n"}if("0a"==c)return r+"ENUMERATED "+parseInt(o(a,n))+"\n";if("0c"==c)return r+"UTF8String '"+hextoutf8(o(a,n))+"'\n";if("13"==c)return r+"PrintableString '"+hextoutf8(o(a,n))+"'\n";if("14"==c)return r+"TeletexString '"+hextoutf8(o(a,n))+"'\n";if("16"==c)return r+"IA5String '"+hextoutf8(o(a,n))+"'\n";if("17"==c)return r+"UTCTime "+hextoutf8(o(a,n))+"\n";if("18"==c)return r+"GeneralizedTime "+hextoutf8(o(a,n))+"\n";if("1a"==c)return r+"VisualString '"+hextoutf8(o(a,n))+"'\n";if("1e"==c)return r+"BMPString '"+ucs2hextoutf8(o(a,n))+"'\n";if("30"==c){if("3000"==a.substr(n,4))return r+"SEQUENCE {}\n";f=r+"SEQUENCE\n";var v=t;if((2==(S=s(a,n)).length||3==S.length)&&"06"==a.substr(S[0],2)&&"04"==a.substr(S[S.length-1],2)){w=i.oidname(o(a,S[0]));var y=JSON.parse(JSON.stringify(t));y.x509ExtName=w,v=y}for(var b=0;b<S.length;b++)f+=l(a,v,S[b],r+"  ");return f}if("31"==c){f=r+"SET\n";var S=s(a,n);for(b=0;b<S.length;b++)f+=l(a,t,S[b],r+"  ");return f}if(0!=(128&(c=parseInt(c,16)))){var $=31&c;if(0!=(32&c)){for(f=r+"["+$+"]\n",S=s(a,n),b=0;b<S.length;b++)f+=l(a,t,S[b],r+"  ");return f}d=o(a,n);if(ASN1HEX.isASN1HEX(d)){var f=r+"["+$+"]\n";return f+=l(d,t,0,r+"  ")}return("68747470"==d.substr(0,8)||"subjectAltName"===t.x509ExtName&&2==$)&&(d=hextoutf8(d)),f=r+"["+$+"] "+d+"\n"}return r+"UNKNOWN("+c+") "+o(a,n)+"\n"},ASN1HEX.parse=function(e){var t=ASN1HEX,n=t.parse,r=t.isASN1HEX,i=t.getV,o=t.getTLV,l=t.getChildIdx,s=KJUR.asn1,a=s.ASN1Util.oidHexToInt,u=s.x509.OID.oid2name,c=hextoutf8,h=ucs2hextoutf8,d=iso88591hextoutf8,f={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},p=e.substr(0,2),g={},w=i(e,0);if("01"==p)return"0101ff"==e?{bool:!0}:{bool:!1};if("02"==p)return{int:{hex:w}};if("03"==p)try{if("00"!=w.substr(0,2))throw"not encap";var m=w.substr(2);if(!r(m))throw"not encap";return{bitstr:{obj:n(m)}}}catch(e){var v=null;return w.length<=10&&(v=bitstrtobinstr(w)),null==v?{bitstr:{hex:w}}:{bitstr:{bin:v}}}else if("04"==p)try{if(!r(w))throw"not encap";return{octstr:{obj:n(w)}}}catch(e){return{octstr:{hex:w}}}else{if("05"==p)return{null:""};if("06"==p){var y=a(w),b=u(y);return""==b?{oid:y}:{oid:b}}if("0a"==p)return w.length>4?{enum:{hex:w}}:{enum:parseInt(w,16)};if("30"==p||"31"==p)return g[f[p]]=function(e){for(var t=[],r=l(e,0),i=0;i<r.length;i++){var s=r[i],a=o(e,s),u=n(a);t.push(u)}return t}(e),g;if("14"==p){var S=d(w);return g[f[p]]={str:S},g}if("1e"==p){S=h(w);return g[f[p]]={str:S},g}if(-1!=":0c:12:13:16:17:18:1a:".indexOf(p)){S=c(w);return g[f[p]]={str:S},g}if(p.match(/^8[0-9]$/))return null==(S=c(w))|""==S||null!=S.match(/[\x00-\x1F\x7F-\x9F]/)||null!=S.match(/[\u0000-\u001F\u0080\u009F]/)?{tag:{tag:p,explicit:!1,hex:w}}:{tag:{tag:p,explicit:!1,str:S}};if(!p.match(/^a[0-9]$/)){var $=new KJUR.asn1.ASN1Object;return $.hV=w,{asn1:{tlv:p+$.getLengthHexFromValue()+w}}}try{if(!r(w))throw new Error("not encap");return{tag:{tag:p,explicit:!0,obj:n(w)}}}catch(e){return{tag:{tag:p,explicit:!0,hex:w}}}}},ASN1HEX.isContextTag=function(e,t){var n,r;e=e.toLowerCase();try{n=parseInt(e,16)}catch(e){return-1}if(void 0===t)return 128==(192&n);try{return null!=t.match(/^\[[0-9]+\]$/)&&(!((r=parseInt(t.substr(1,t.length-1),10))>31)&&(128==(192&n)&&(31&n)==r))}catch(e){return!1}},ASN1HEX.isASN1HEX=function(e){var t=ASN1HEX;if(e.length%2==1)return!1;var n=t.getVblen(e,0),r=e.substr(0,2),i=t.getL(e,0);return e.length-r.length-i.length==2*n},ASN1HEX.checkStrictDER=function(e,t,n,r,i){var o=ASN1HEX;if(void 0===n){if("string"!=typeof e)throw new Error("not hex string");if(e=e.toLowerCase(),!KJUR.lang.String.isHex(e))throw new Error("not hex string");n=e.length,i=(r=e.length/2)<128?1:Math.ceil(r.toString(16))+1}if(o.getL(e,t).length>2*i)throw new Error("L of TLV too long: idx="+t);var l=o.getVblen(e,t);if(l>r)throw new Error("value of L too long than hex: idx="+t);var s=o.getTLV(e,t),a=s.length-2-o.getL(e,t).length;if(a!==2*l)throw new Error("V string length and L's value not the same:"+a+"/"+2*l);if(0===t&&e.length!=s.length)throw new Error("total length and TLV length unmatch:"+e.length+"!="+s.length);var u=e.substr(t,2);if("02"===u){var c=o.getVidx(e,t);if("00"==e.substr(c,2)&&e.charCodeAt(c+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(u,16)){for(var h=o.getVblen(e,t),d=0,f=o.getChildIdx(e,t),p=0;p<f.length;p++){d+=o.getTLV(e,f[p]).length,o.checkStrictDER(e,f[p],n,r,i)}if(2*h!=d)throw new Error("sum of children's TLV length and L unmatch: "+2*h+"!="+d)}},ASN1HEX.oidname=function(e){var t=KJUR.asn1;KJUR.lang.String.isHex(e)&&(e=t.ASN1Util.oidHexToInt(e));var n=t.x509.OID.oid2name(e);return""===n&&(n=e),n},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),void 0!==KJUR.asn1.x509&&KJUR.asn1.x509||(KJUR.asn1.x509={}),KJUR.asn1.x509.Certificate=function(e){KJUR.asn1.x509.Certificate.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERBitString,r=t.DERSequence,i=t.x509,o=i.TBSCertificate,l=i.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(e){this.params=e},this.sign=function(){var e=this.params,t=e.sigalg;null!=e.sigalg.name&&(t=e.sigalg.name);var n=e.tbsobj.tohex(),r=new KJUR.crypto.Signature({alg:t});r.init(e.cakey),r.updateHex(n),e.sighex=r.sign()},this.getPEM=function(){return hextopem(this.tohex(),"CERTIFICATE")},this.tohex=function(){var e=this.params;if(null!=e.tbsobj&&null!=e.tbsobj||(e.tbsobj=new o(e)),null==e.sighex&&null!=e.cakey&&this.sign(),null==e.sighex)throw new Error("sighex or cakey parameter not defined");var t=[];return t.push(e.tbsobj),t.push(new l({name:e.sigalg})),t.push(new n({hex:"00"+e.sighex})),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&(this.params=e)},extendClass(KJUR.asn1.x509.Certificate,KJUR.asn1.ASN1Object),KJUR.asn1.x509.TBSCertificate=function(e){KJUR.asn1.x509.TBSCertificate.superclass.constructor.call(this);var t=KJUR.asn1,n=t.x509,r=t.DERTaggedObject,i=t.DERInteger,o=t.DERSequence,l=n.AlgorithmIdentifier,s=n.Time,a=n.X500Name,u=n.Extensions,c=n.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=[],t=this.params;if(null!=t.version||1!=t.version){var n=2;null!=t.version&&(n=t.version-1);var h=new r({obj:new i({int:n})});e.push(h)}return e.push(new i(t.serial)),e.push(new l({name:t.sigalg})),e.push(new a(t.issuer)),e.push(new o({array:[new s(t.notbefore),new s(t.notafter)]})),e.push(new a(t.subject)),e.push(new c(KEYUTIL.getKey(t.sbjpubkey))),void 0!==t.ext&&t.ext.length>0&&e.push(new r({tag:"a3",obj:new u(t.ext)})),new KJUR.asn1.DERSequence({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.TBSCertificate,KJUR.asn1.ASN1Object),KJUR.asn1.x509.Extensions=function(e){KJUR.asn1.x509.Extensions.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERSequence,r=t.x509;this.aParam=[],this.setByParam=function(e){this.aParam=e},this.tohex=function(){for(var e=[],t=0;t<this.aParam.length;t++){var i=this.aParam[t],o=i.extname,l=null;if(null!=i.extn)l=new r.PrivateExtension(i);else if("subjectKeyIdentifier"==o)l=new r.SubjectKeyIdentifier(i);else if("keyUsage"==o)l=new r.KeyUsage(i);else if("subjectAltName"==o)l=new r.SubjectAltName(i);else if("issuerAltName"==o)l=new r.IssuerAltName(i);else if("basicConstraints"==o)l=new r.BasicConstraints(i);else if("nameConstraints"==o)l=new r.NameConstraints(i);else if("cRLDistributionPoints"==o)l=new r.CRLDistributionPoints(i);else if("certificatePolicies"==o)l=new r.CertificatePolicies(i);else if("policyMappings"==o)l=new r.PolicyMappings(i);else if("policyConstraints"==o)l=new r.PolicyConstraints(i);else if("inhibitAnyPolicy"==o)l=new r.InhibitAnyPolicy(i);else if("authorityKeyIdentifier"==o)l=new r.AuthorityKeyIdentifier(i);else if("extKeyUsage"==o)l=new r.ExtKeyUsage(i);else if("authorityInfoAccess"==o)l=new r.AuthorityInfoAccess(i);else if("cRLNumber"==o)l=new r.CRLNumber(i);else if("cRLReason"==o)l=new r.CRLReason(i);else if("ocspNonce"==o)l=new r.OCSPNonce(i);else if("ocspNoCheck"==o)l=new r.OCSPNoCheck(i);else if("adobeTimeStamp"==o)l=new r.AdobeTimeStamp(i);else{if("subjectDirectoryAttributes"!=o)throw new Error("extension not supported:"+JSON.stringify(i));l=new r.SubjectDirectoryAttributes(i)}null!=l&&e.push(l)}return new n({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.Extensions,KJUR.asn1.ASN1Object),KJUR.asn1.x509.Extension=function(e){KJUR.asn1.x509.Extension.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERObjectIdentifier,r=t.DEROctetString;t.DERBitString;var i=t.DERBoolean,o=t.DERSequence;this.tohex=function(){var e=new n({oid:this.oid}),t=new r({hex:this.getExtnValueHex()}),l=new Array;return l.push(e),this.critical&&l.push(new i),l.push(t),new o({array:l}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,void 0!==e&&void 0!==e.critical&&(this.critical=e.critical)},extendClass(KJUR.asn1.x509.Extension,KJUR.asn1.ASN1Object),KJUR.asn1.x509.KeyUsage=function(e){KJUR.asn1.x509.KeyUsage.superclass.constructor.call(this,e);var t=Error,n={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var e=this.getBinValue();return this.asn1ExtnValue=new KJUR.asn1.DERBitString({bin:e}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var e=this.params;if("object"!=typeof e||"object"!=typeof e.names&&"string"!=typeof e.bin)throw new t("parameter not yet set");if(null!=e.names)return namearraytobinstr(e.names,n);if(null!=e.bin)return e.bin;throw new t("parameter not set properly")},this.oid="2.5.29.15",void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.KeyUsage,KJUR.asn1.x509.Extension),KJUR.asn1.x509.BasicConstraints=function(e){KJUR.asn1.x509.BasicConstraints.superclass.constructor.call(this,e);var t=KJUR.asn1,n=t.DERBoolean,r=t.DERInteger,i=t.DERSequence;this.getExtnValueHex=function(){var e=new Array;this.cA&&e.push(new n),this.pathLen>-1&&e.push(new r({int:this.pathLen}));var t=new i({array:e});return this.asn1ExtnValue=t,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,void 0!==e&&(void 0!==e.cA&&(this.cA=e.cA),void 0!==e.pathLen&&(this.pathLen=e.pathLen))},extendClass(KJUR.asn1.x509.BasicConstraints,KJUR.asn1.x509.Extension),KJUR.asn1.x509.CRLDistributionPoints=function(e){KJUR.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,e);var t=KJUR.asn1,n=t.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(e){for(var r=[],i=0;i<e.length;i++)if(e[i]instanceof KJUR.asn1.ASN1Object)r.push(e[i]);else{var o=new n.DistributionPoint(e[i]);r.push(o)}this.asn1ExtnValue=new t.DERSequence({array:r})},this.setByOneURI=function(e){var t=new n.DistributionPoint({fulluri:e});this.setByDPArray([t])},this.oid="2.5.29.31",void 0!==e&&(void 0!==e.array?this.setByDPArray(e.array):void 0!==e.uri&&this.setByOneURI(e.uri))},extendClass(KJUR.asn1.x509.CRLDistributionPoints,KJUR.asn1.x509.Extension),KJUR.asn1.x509.DistributionPoint=function(e){KJUR.asn1.x509.DistributionPoint.superclass.constructor.call(this);var t=KJUR.asn1,n=t.x509.DistributionPointName;this.tohex=function(){var e=new t.DERSequence;if(null!=this.asn1DP){var n=new t.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});e.appendASN1Object(n)}return this.hTLV=e.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.dpobj?this.asn1DP=e.dpobj:void 0!==e.dpname?this.asn1DP=new n(e.dpname):void 0!==e.fulluri&&(this.asn1DP=new n({full:[{uri:e.fulluri}]})))},extendClass(KJUR.asn1.x509.DistributionPoint,KJUR.asn1.ASN1Object),KJUR.asn1.x509.DistributionPointName=function(e){KJUR.asn1.x509.DistributionPointName.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERTaggedObject;if(this.tohex=function(){if("full"!=this.type)throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new n({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e)if(t.x509.GeneralNames.prototype.isPrototypeOf(e))this.type="full",this.tag="a0",this.asn1V=e;else{if(void 0===e.full)throw new Error("This class supports GeneralNames only as argument");this.type="full",this.tag="a0",this.asn1V=new t.x509.GeneralNames(e.full)}},extendClass(KJUR.asn1.x509.DistributionPointName,KJUR.asn1.ASN1Object),KJUR.asn1.x509.CertificatePolicies=function(e){KJUR.asn1.x509.CertificatePolicies.superclass.constructor.call(this,e);var t=KJUR.asn1,n=t.x509,r=t.DERSequence,i=n.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var e=[],t=0;t<this.params.array.length;t++)e.push(new i(this.params.array[t]));var n=new r({array:e});return this.asn1ExtnValue=n,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.CertificatePolicies,KJUR.asn1.x509.Extension),KJUR.asn1.x509.PolicyInformation=function(e){KJUR.asn1.x509.PolicyInformation.superclass.constructor.call(this,e);var t=KJUR.asn1,n=t.DERSequence,r=t.DERObjectIdentifier,i=t.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(void 0===this.params.policyoid&&void 0===this.params.array)throw new Error("parameter oid and array missing");var e=[new r(this.params.policyoid)];if(void 0!==this.params.array){for(var t=[],o=0;o<this.params.array.length;o++)t.push(new i(this.params.array[o]));t.length>0&&e.push(new n({array:t}))}return new n({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.PolicyInformation,KJUR.asn1.ASN1Object),KJUR.asn1.x509.PolicyQualifierInfo=function(e){KJUR.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,e);var t=KJUR.asn1,n=t.DERSequence,r=t.DERIA5String,i=t.DERObjectIdentifier,o=t.x509.UserNotice;this.params=null,this.tohex=function(){return void 0!==this.params.cps?new n({array:[new i({oid:"1.3.6.1.5.5.7.2.1"}),new r({str:this.params.cps})]}).tohex():null!=this.params.unotice?new n({array:[new i({oid:"1.3.6.1.5.5.7.2.2"}),new o(this.params.unotice)]}).tohex():void 0},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.PolicyQualifierInfo,KJUR.asn1.ASN1Object),KJUR.asn1.x509.UserNotice=function(e){KJUR.asn1.x509.UserNotice.superclass.constructor.call(this,e);var t=KJUR.asn1.DERSequence;KJUR.asn1.DERInteger;var n=KJUR.asn1.x509.DisplayText,r=KJUR.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var e=[];return void 0!==this.params.noticeref&&e.push(new r(this.params.noticeref)),void 0!==this.params.exptext&&e.push(new n(this.params.exptext)),new t({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.UserNotice,KJUR.asn1.ASN1Object),KJUR.asn1.x509.NoticeReference=function(e){KJUR.asn1.x509.NoticeReference.superclass.constructor.call(this,e);var t=KJUR.asn1.DERSequence,n=KJUR.asn1.DERInteger,r=KJUR.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var e=[];if(void 0!==this.params.org&&e.push(new r(this.params.org)),void 0!==this.params.noticenum){for(var i=[],o=this.params.noticenum,l=0;l<o.length;l++)i.push(new n(o[l]));e.push(new t({array:i}))}if(0==e.length)throw new Error("parameter is empty");return new t({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.NoticeReference,KJUR.asn1.ASN1Object),KJUR.asn1.x509.DisplayText=function(e){KJUR.asn1.x509.DisplayText.superclass.constructor.call(this,e),this.hT="0c",void 0!==e&&("ia5"===e.type?this.hT="16":"vis"===e.type?this.hT="1a":"bmp"===e.type&&(this.hT="1e"))},extendClass(KJUR.asn1.x509.DisplayText,KJUR.asn1.DERAbstractString),KJUR.asn1.x509.PolicyMappings=function(e){KJUR.asn1.x509.PolicyMappings.superclass.constructor.call(this,e);var t=KJUR.asn1;t.x509;var n=t.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var e=this.params,t=[],r=0;r<e.array.length;r++){var i=e.array[r];t.push({seq:[{oid:i[0]},{oid:i[1]}]})}return this.asn1ExtnValue=n({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.PolicyMappings,KJUR.asn1.x509.Extension),KJUR.asn1.x509.PolicyConstraints=function(e){KJUR.asn1.x509.PolicyConstraints.superclass.constructor.call(this,e);var t=KJUR.asn1;t.x509;var n=t.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[];return null!=e.reqexp&&t.push({tag:{tagi:"80",obj:{int:e.reqexp}}}),null!=e.inhibit&&t.push({tag:{tagi:"81",obj:{int:e.inhibit}}}),this.asn1ExtnValue=n({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.PolicyConstraints,KJUR.asn1.x509.Extension),KJUR.asn1.x509.InhibitAnyPolicy=function(e){KJUR.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,e);var t=KJUR.asn1;t.x509;var n=t.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=n({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.InhibitAnyPolicy,KJUR.asn1.x509.Extension),KJUR.asn1.x509.NameConstraints=function(e){KJUR.asn1.x509.NameConstraints.superclass.constructor.call(this,e);var t=KJUR.asn1,n=t.x509,r=t.ASN1Util.newObject,i=n.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[];if(null!=e.permit&&null!=e.permit.length){for(var n=[],o=0;o<e.permit.length;o++)n.push(new i(e.permit[o]));t.push({tag:{tagi:"a0",obj:{seq:n}}})}if(null!=e.exclude&&null!=e.exclude.length){var l=[];for(o=0;o<e.exclude.length;o++)l.push(new i(e.exclude[o]));t.push({tag:{tagi:"a1",obj:{seq:l}}})}return this.asn1ExtnValue=r({seq:t}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.NameConstraints,KJUR.asn1.x509.Extension),KJUR.asn1.x509.GeneralSubtree=function(e){KJUR.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var t=KJUR.asn1,n=t.x509.GeneralName,r=t.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params,t=[new n(e)];return null!=e.min&&t.push({tag:{tagi:"80",obj:{int:e.min}}}),null!=e.max&&t.push({tag:{tagi:"81",obj:{int:e.max}}}),r({seq:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.GeneralSubtree,KJUR.asn1.ASN1Object),KJUR.asn1.x509.ExtKeyUsage=function(e){KJUR.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,e);var t=KJUR.asn1;this.setPurposeArray=function(e){this.asn1ExtnValue=new t.DERSequence;for(var n=0;n<e.length;n++){var r=new t.DERObjectIdentifier(e[n]);this.asn1ExtnValue.appendASN1Object(r)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",void 0!==e&&void 0!==e.array&&this.setPurposeArray(e.array)},extendClass(KJUR.asn1.x509.ExtKeyUsage,KJUR.asn1.x509.Extension),KJUR.asn1.x509.AuthorityKeyIdentifier=function(e){KJUR.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,e);var t=KJUR,n=t.asn1,r=n.DERTaggedObject,i=n.x509.GeneralNames;t.crypto.Util.isKey,this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var e=new Array;this.asn1KID&&e.push(new r({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&e.push(new r({explicit:!1,tag:"a1",obj:new i([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&e.push(new r({explicit:!1,tag:"82",obj:this.asn1CertSN}));var t=new n.DERSequence({array:e});return this.asn1ExtnValue=t,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(e){if(void 0!==e.str||void 0!==e.hex)this.asn1KID=new KJUR.asn1.DEROctetString(e);else if("object"==typeof e&&KJUR.crypto.Util.isKey(e)||"string"==typeof e&&-1!=e.indexOf("BEGIN ")){var t=e;"string"==typeof e&&(t=KEYUTIL.getKey(e));var n=KEYUTIL.getKeyID(t);this.asn1KID=new KJUR.asn1.DEROctetString({hex:n})}},this.setCertIssuerByParam=function(e){void 0!==e.str||void 0!==e.ldapstr||void 0!==e.hex||void 0!==e.certsubject||void 0!==e.certissuer?this.asn1CertIssuer=new KJUR.asn1.x509.X500Name(e):"string"==typeof e&&-1!=e.indexOf("BEGIN ")&&-1!=e.indexOf("CERTIFICATE")&&(this.asn1CertIssuer=new KJUR.asn1.x509.X500Name({certissuer:e}))},this.setCertSNByParam=function(e){if(void 0!==e.str||void 0!==e.bigint||void 0!==e.hex)this.asn1CertSN=new KJUR.asn1.DERInteger(e);else if("string"==typeof e&&-1!=e.indexOf("BEGIN ")&&e.indexOf("CERTIFICATE")){var t=new X509;t.readCertPEM(e);var n=t.getSerialNumberHex();this.asn1CertSN=new KJUR.asn1.DERInteger({hex:n})}},this.oid="2.5.29.35",void 0!==e&&(void 0!==e.kid&&this.setKIDByParam(e.kid),void 0!==e.issuer&&this.setCertIssuerByParam(e.issuer),void 0!==e.sn&&this.setCertSNByParam(e.sn),void 0!==e.issuersn&&"string"==typeof e.issuersn&&-1!=e.issuersn.indexOf("BEGIN ")&&e.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(e.issuersn),this.setCertIssuerByParam(e.issuersn)))},extendClass(KJUR.asn1.x509.AuthorityKeyIdentifier,KJUR.asn1.x509.Extension),KJUR.asn1.x509.SubjectKeyIdentifier=function(e){KJUR.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,e);var t=KJUR.asn1.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(e){if(void 0!==e.str||void 0!==e.hex)this.asn1KID=new t(e);else if("object"==typeof e&&KJUR.crypto.Util.isKey(e)||"string"==typeof e&&-1!=e.indexOf("BEGIN")){var n=e;"string"==typeof e&&(n=KEYUTIL.getKey(e));var r=KEYUTIL.getKeyID(n);this.asn1KID=new KJUR.asn1.DEROctetString({hex:r})}},this.oid="2.5.29.14",void 0!==e&&void 0!==e.kid&&this.setKIDByParam(e.kid)},extendClass(KJUR.asn1.x509.SubjectKeyIdentifier,KJUR.asn1.x509.Extension),KJUR.asn1.x509.AuthorityInfoAccess=function(e){KJUR.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,e),this.setAccessDescriptionArray=function(e){for(var t=new Array,n=KJUR.asn1,r=n.DERSequence,i=n.DERObjectIdentifier,o=n.x509.GeneralName,l=0;l<e.length;l++){var s,a=e[l];if(void 0!==a.ocsp)s=new r({array:[new i({oid:"1.3.6.1.5.5.7.48.1"}),new o({uri:a.ocsp})]});else{if(void 0===a.caissuer)throw new Error("unknown AccessMethod parameter: "+JSON.stringify(a));s=new r({array:[new i({oid:"1.3.6.1.5.5.7.48.2"}),new o({uri:a.caissuer})]})}t.push(s)}this.asn1ExtnValue=new r({array:t})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",void 0!==e&&void 0!==e.array&&this.setAccessDescriptionArray(e.array)},extendClass(KJUR.asn1.x509.AuthorityInfoAccess,KJUR.asn1.x509.Extension),KJUR.asn1.x509.SubjectAltName=function(e){KJUR.asn1.x509.SubjectAltName.superclass.constructor.call(this,e),this.setNameArray=function(e){this.asn1ExtnValue=new KJUR.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},extendClass(KJUR.asn1.x509.SubjectAltName,KJUR.asn1.x509.Extension),KJUR.asn1.x509.IssuerAltName=function(e){KJUR.asn1.x509.IssuerAltName.superclass.constructor.call(this,e),this.setNameArray=function(e){this.asn1ExtnValue=new KJUR.asn1.x509.GeneralNames(e)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",void 0!==e&&void 0!==e.array&&this.setNameArray(e.array)},extendClass(KJUR.asn1.x509.IssuerAltName,KJUR.asn1.x509.Extension),KJUR.asn1.x509.SubjectDirectoryAttributes=function(e){KJUR.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,e);var t=KJUR.asn1,n=t.DERSequence,r=t.ASN1Util.newObject,i=t.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var e=[],t=0;t<this.params.array.length;t++){var o=this.params.array[t];if(null==o.attr||null==o.array){var l={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if("dateOfBirth"==o.attr)l.seq[0].oid=i(o.attr),l.seq[1].set[0]={gentime:o.str};else if("placeOfBirth"==o.attr)l.seq[0].oid=i(o.attr),l.seq[1].set[0]={utf8str:o.str};else if("gender"==o.attr)l.seq[0].oid=i(o.attr),l.seq[1].set[0]={prnstr:o.str};else if("countryOfCitizenship"==o.attr)l.seq[0].oid=i(o.attr),l.seq[1].set[0]={prnstr:o.str};else{if("countryOfResidence"!=o.attr)throw new Error("unsupported attribute: "+o.attr);l.seq[0].oid=i(o.attr),l.seq[1].set[0]={prnstr:o.str}}e.push(new r(l))}else{var s={seq:[{oid:o.attr},{set:o.array}]};e.push(r(s))}}var a=new n({array:e});return this.asn1ExtnValue=a,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.x509.SubjectDirectoryAttributes,KJUR.asn1.x509.Extension),KJUR.asn1.x509.PrivateExtension=function(e){KJUR.asn1.x509.PrivateExtension.superclass.constructor.call(this,e);var t=KJUR,n=t.lang.String.isHex,r=t.asn1,i=r.x509.OID.name2oid,o=r.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.oid=i(e.extname),this.params=e},this.getExtnValueHex=function(){if(null==this.params.extname||null==this.params.extn)throw new Error("extname or extnhex not specified");var e=this.params.extn;if("string"==typeof e&&n(e))return e;if("object"==typeof e)try{return o(e).tohex()}catch(e){}throw new Error("unsupported extn value")},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.PrivateExtension,KJUR.asn1.x509.Extension),KJUR.asn1.x509.CRL=function(e){KJUR.asn1.x509.CRL.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERSequence,r=t.DERBitString,i=t.x509,o=i.AlgorithmIdentifier,l=i.TBSCertList;this.params=void 0,this.setByParam=function(e){this.params=e},this.sign=function(){var e=new l(this.params).tohex(),t=new KJUR.crypto.Signature({alg:this.params.sigalg});t.init(this.params.cakey),t.updateHex(e);var n=t.sign();this.params.sighex=n},this.getPEM=function(){return hextopem(this.tohex(),"X509 CRL")},this.tohex=function(){var e=this.params;if(null==e.tbsobj&&(e.tbsobj=new l(e)),null==e.sighex&&null!=e.cakey&&this.sign(),null==e.sighex)throw new Error("sighex or cakey parameter not defined");var t=[];return t.push(e.tbsobj),t.push(new o({name:e.sigalg})),t.push(new r({hex:"00"+e.sighex})),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&(this.params=e)},extendClass(KJUR.asn1.x509.CRL,KJUR.asn1.ASN1Object),KJUR.asn1.x509.TBSCertList=function(e){KJUR.asn1.x509.TBSCertList.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERInteger,r=t.DERSequence,i=t.DERTaggedObject;t.DERObjectIdentifier;var o=t.x509,l=o.AlgorithmIdentifier,s=o.Time,a=o.Extensions,u=o.X500Name;this.params=null,this.setByParam=function(e){this.params=e},this.getRevCertSequence=function(){for(var e=[],t=this.params.revcert,i=0;i<t.length;i++){var o=[new n(t[i].sn),new s(t[i].date)];null!=t[i].ext&&o.push(new a(t[i].ext)),e.push(new r({array:o}))}return new r({array:e})},this.tohex=function(){var e=[],t=this.params;if(null!=t.version){var o=t.version-1,c=new n({int:o});e.push(c)}if(e.push(new l({name:t.sigalg})),e.push(new u(t.issuer)),e.push(new s(t.thisupdate)),null!=t.nextupdate&&e.push(new s(t.nextupdate)),null!=t.revcert&&e.push(this.getRevCertSequence()),null!=t.ext){var h=new a(t.ext);e.push(new i({tag:"a0",explicit:!0,obj:h}))}return new r({array:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.TBSCertList,KJUR.asn1.ASN1Object),KJUR.asn1.x509.CRLEntry=function(e){KJUR.asn1.x509.CRLEntry.superclass.constructor.call(this);var t=KJUR.asn1;this.setCertSerial=function(e){this.sn=new t.DERInteger(e)},this.setRevocationDate=function(e){this.time=new t.x509.Time(e)},this.tohex=function(){var e=new t.DERSequence({array:[this.sn,this.time]});return this.TLV=e.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.time&&this.setRevocationDate(e.time),void 0!==e.sn&&this.setCertSerial(e.sn))},extendClass(KJUR.asn1.x509.CRLEntry,KJUR.asn1.ASN1Object),KJUR.asn1.x509.CRLNumber=function(e){KJUR.asn1.x509.CRLNumber.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new KJUR.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",null!=e&&(this.params=e)},extendClass(KJUR.asn1.x509.CRLNumber,KJUR.asn1.x509.Extension),KJUR.asn1.x509.CRLReason=function(e){KJUR.asn1.x509.CRLReason.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new KJUR.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",null!=e&&(this.params=e)},extendClass(KJUR.asn1.x509.CRLReason,KJUR.asn1.x509.Extension),KJUR.asn1.x509.OCSPNonce=function(e){KJUR.asn1.x509.OCSPNonce.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new KJUR.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",null!=e&&(this.params=e)},extendClass(KJUR.asn1.x509.OCSPNonce,KJUR.asn1.x509.Extension),KJUR.asn1.x509.OCSPNoCheck=function(e){KJUR.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,e),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new KJUR.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",null!=e&&(this.params=e)},extendClass(KJUR.asn1.x509.OCSPNoCheck,KJUR.asn1.x509.Extension),KJUR.asn1.x509.AdobeTimeStamp=function(e){KJUR.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,e);var t=KJUR.asn1,n=t.DERInteger,r=t.DERBoolean,i=t.DERSequence,o=t.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var e=this.params,t=[new n(1)];return t.push(new o({uri:e.uri})),null!=e.reqauth&&t.push(new r(e.reqauth)),this.asn1ExtnValue=new i({array:t}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.AdobeTimeStamp,KJUR.asn1.x509.Extension),KJUR.asn1.x509.X500Name=function(e){KJUR.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var t=KJUR.asn1,n=t.x509,r=n.RDN;this.setByString=function(e,t){void 0!==t&&(this.sRule=t);var n=e.split("/");n.shift();for(var i=[],o=0;o<n.length;o++)if(n[o].match(/^[^=]+=.+$/))i.push(n[o]);else{var l=i.length-1;i[l]=i[l]+"/"+n[o]}for(o=0;o<i.length;o++)this.asn1Array.push(new r({str:i[o],rule:this.sRule}))},this.setByLdapString=function(e,t){void 0!==t&&(this.sRule=t);var r=n.X500Name.ldapToCompat(e);this.setByString(r,t)},this.setByObject=function(e,t){for(var n in void 0!==t&&(this.sRule=t),e)if(e.hasOwnProperty(n)){var i=new r({str:n+"="+e[n],rule:this.sRule});this.asn1Array?this.asn1Array.push(i):this.asn1Array=[i]}},this.setByParam=function(e){var t;(void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.array)?this.paramArray=e.array:void 0!==e.str?this.setByString(e.str):void 0!==e.ldapstr?this.setByLdapString(e.ldapstr):void 0!==e.hex?this.hTLV=e.hex:void 0!==e.certissuer?((t=new X509).readCertPEM(e.certissuer),this.hTLV=t.getIssuerHex()):void 0!==e.certsubject?((t=new X509).readCertPEM(e.certsubject),this.hTLV=t.getSubjectHex()):"object"==typeof e&&void 0===e.certsubject&&void 0===e.certissuer&&this.setByObject(e)},this.tohex=function(){if("string"==typeof this.hTLV)return this.hTLV;if(0==this.asn1Array.length&&this.paramArray.length>0)for(var e=0;e<this.paramArray.length;e++){var n={array:this.paramArray[e]};"utf8"!=this.sRule&&(n.rule=this.sRule);var i=new r(n);this.asn1Array.push(i)}var o=new t.DERSequence({array:this.asn1Array});return this.hTLV=o.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.X500Name,KJUR.asn1.ASN1Object),KJUR.asn1.x509.X500Name.compatToLDAP=function(e){if("/"!==e.substr(0,1))throw"malformed input";var t=(e=e.substr(1)).split("/");return t.reverse(),(t=t.map((function(e){return e.replace(/,/,"\\,")}))).join(",")},KJUR.asn1.x509.X500Name.onelineToLDAP=function(e){return KJUR.asn1.x509.X500Name.compatToLDAP(e)},KJUR.asn1.x509.X500Name.ldapToCompat=function(e){for(var t=e.split(","),n=!1,r=[],i=0;t.length>0;i++){var o=t.shift();if(!0===n){var l=(r.pop()+","+o).replace(/\\,/g,",");r.push(l),n=!1}else r.push(o);"\\"===o.substr(-1,1)&&(n=!0)}return(r=r.map((function(e){return e.replace("/","\\/")}))).reverse(),"/"+r.join("/")},KJUR.asn1.x509.X500Name.ldapToOneline=function(e){return KJUR.asn1.x509.X500Name.ldapToCompat(e)},KJUR.asn1.x509.RDN=function(e){KJUR.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var t=KJUR.asn1.x509.AttributeTypeAndValue;this.setByParam=function(e){void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.str&&this.addByMultiValuedString(e.str),void 0!==e.array&&(this.paramArray=e.array)},this.addByString=function(e){this.asn1Array.push(new KJUR.asn1.x509.AttributeTypeAndValue({str:e,rule:this.sRule}))},this.addByMultiValuedString=function(e){for(var t=KJUR.asn1.x509.RDN.parseString(e),n=0;n<t.length;n++)this.addByString(t[n])},this.tohex=function(){if(0==this.asn1Array.length&&this.paramArray.length>0)for(var e=0;e<this.paramArray.length;e++){var n=this.paramArray[e];void 0!==n.rule&&"utf8"!=this.sRule&&(n.rule=this.sRule);var r=new t(n);this.asn1Array.push(r)}var i=new KJUR.asn1.DERSet({array:this.asn1Array});return this.TLV=i.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.RDN,KJUR.asn1.ASN1Object),KJUR.asn1.x509.RDN.parseString=function(e){for(var t=e.split(/\+/),n=!1,r=[],i=0;t.length>0;i++){var o=t.shift();if(!0===n){var l=(r.pop()+"+"+o).replace(/\\\+/g,"+");r.push(l),n=!1}else r.push(o);"\\"===o.substr(-1,1)&&(n=!0)}var s=!1,a=[];for(i=0;r.length>0;i++){o=r.shift();if(!0===s){var u=a.pop();if(o.match(/"$/)){l=(u+"+"+o).replace(/^([^=]+)="(.*)"$/,"$1=$2");a.push(l),s=!1}else a.push(u+"+"+o)}else a.push(o);o.match(/^[^=]+="/)&&(s=!0)}return a},KJUR.asn1.x509.AttributeTypeAndValue=function(e){KJUR.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var t=KJUR,n=t.asn1,r=n.DERSequence,i=n.DERUTF8String,o=n.DERPrintableString,l=n.DERTeletexString,s=n.DERIA5String,a=n.DERVisibleString,u=n.DERBMPString,c=t.lang.String.isMail,h=t.lang.String.isPrintable;this.setByParam=function(e){if(void 0!==e.rule&&(this.sRule=e.rule),void 0!==e.ds&&(this.dsType=e.ds),void 0===e.value&&void 0!==e.str){var t=e.str.match(/^([^=]+)=(.+)$/);if(!t)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.sType=t[1],this.sValue=t[2]}else this.sType=e.type,this.sValue=e.value},this.setByString=function(e,t){void 0!==t&&(this.sRule=t);var n=e.match(/^([^=]+)=(.+)$/);if(!n)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.setByAttrTypeAndValueStr(n[1],n[2])},this._getDsType=function(){var e=this.sType,t=this.sValue,n=this.sRule;return"prn"===n?"CN"==e&&c(t)?"ia5":h(t)?"prn":"utf8":"utf8"===n?"CN"==e&&c(t)?"ia5":"C"==e?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(e,t,n){void 0!==n&&(this.sRule=n),this.sType=e,this.sValue=t},this.getValueObj=function(e,t){if("utf8"==e)return new i({str:t});if("prn"==e)return new o({str:t});if("tel"==e)return new l({str:t});if("ia5"==e)return new s({str:t});if("vis"==e)return new a({str:t});if("bmp"==e)return new u({str:t});throw new Error("unsupported directory string type: type="+e+" value="+t)},this.tohex=function(){null==this.dsType&&(this.dsType=this._getDsType());var e=KJUR.asn1.x509.OID.atype2obj(this.sType),t=this.getValueObj(this.dsType,this.sValue),n=new r({array:[e,t]});return this.TLV=n.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.AttributeTypeAndValue,KJUR.asn1.ASN1Object),KJUR.asn1.x509.SubjectPublicKeyInfo=function(e){KJUR.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var t=KJUR,n=t.asn1,r=n.DERInteger,i=n.DERBitString,o=n.DERObjectIdentifier,l=n.DERSequence,s=n.ASN1Util.newObject,a=n.x509.AlgorithmIdentifier,u=t.crypto;u.ECDSA,u.DSA,this.getASN1Object=function(){if(null==this.asn1AlgId||null==this.asn1SubjPKey)throw"algId and/or subjPubKey not set";return new l({array:[this.asn1AlgId,this.asn1SubjPKey]})},this.tohex=function(){var e=this.getASN1Object();return this.hTLV=e.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(e){try{if(e instanceof RSAKey){var t=s({seq:[{int:{bigint:e.n}},{int:{int:e.e}}]}).tohex();this.asn1AlgId=new a({name:"rsaEncryption"}),this.asn1SubjPKey=new i({hex:"00"+t})}}catch(e){}try{if(e instanceof KJUR.crypto.ECDSA){var n=new o({name:e.curveName});this.asn1AlgId=new a({name:"ecPublicKey",asn1params:n}),this.asn1SubjPKey=new i({hex:"00"+e.pubKeyHex})}}catch(e){}try{if(e instanceof KJUR.crypto.DSA){n=new s({seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]});this.asn1AlgId=new a({name:"dsa",asn1params:n});var l=new r({bigint:e.y});this.asn1SubjPKey=new i({hex:"00"+l.tohex()})}}catch(e){}},void 0!==e&&this.setPubKey(e)},extendClass(KJUR.asn1.x509.SubjectPublicKeyInfo,KJUR.asn1.ASN1Object),KJUR.asn1.x509.Time=function(e){KJUR.asn1.x509.Time.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERUTCTime,r=t.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(e){this.timeParams=e},this.setByParam=function(e){this.params=e},this.getType=function(e){return e.match(/^[0-9]{12}Z$/)?"utc":e.match(/^[0-9]{14}Z$/)?"gen":e.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":e.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var e=this.params,t=null;if("string"==typeof e&&(e={str:e}),null==e||!e.str||null!=e.type&&null!=e.type||(e.type=this.getType(e.str)),null!=e&&e.str?("utc"==e.type&&(t=new n(e.str)),"gen"==e.type&&(t=new r(e.str))):t="gen"==this.type?new r:new n,null==t)throw new Error("wrong setting for Time");return this.TLV=t.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},KJUR.asn1.x509.Time_bak=function(e){KJUR.asn1.x509.Time_bak.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERUTCTime,r=t.DERGeneralizedTime;this.setTimeParams=function(e){this.timeParams=e},this.tohex=function(){var e=null;return e=null!=this.timeParams?"utc"==this.type?new n(this.timeParams):new r(this.timeParams):"utc"==this.type?new n:new r,this.TLV=e.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",void 0!==e&&(void 0!==e.type?this.type=e.type:void 0!==e.str&&(e.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),e.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=e)},extendClass(KJUR.asn1.x509.Time,KJUR.asn1.ASN1Object),KJUR.asn1.x509.AlgorithmIdentifier=function(e){KJUR.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var t=KJUR.asn1,n=t.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(null===this.nameAlg&&null===this.asn1Alg)throw new Error("algorithm not specified");if(null!==this.nameAlg){var e=null;for(var r in n)r===this.nameAlg&&(e=n[r]);if(null!==e)return this.hTLV=e,this.hTLV}null!==this.nameAlg&&null===this.asn1Alg&&(this.asn1Alg=t.x509.OID.name2obj(this.nameAlg));var i=[this.asn1Alg];null!==this.asn1Params&&i.push(this.asn1Params);var o=new t.DERSequence({array:i});return this.hTLV=o.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&(void 0!==e.name&&(this.nameAlg=e.name),void 0!==e.asn1params&&(this.asn1Params=e.asn1params),void 0!==e.paramempty&&(this.paramEmpty=e.paramempty)),null===this.asn1Params&&!1===this.paramEmpty&&null!==this.nameAlg){void 0!==this.nameAlg.name&&(this.nameAlg=this.nameAlg.name);var r=this.nameAlg.toLowerCase();"withdsa"!==r.substr(-7,7)&&"withecdsa"!==r.substr(-9,9)&&(this.asn1Params=new t.DERNull)}},extendClass(KJUR.asn1.x509.AlgorithmIdentifier,KJUR.asn1.ASN1Object),KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},KJUR.asn1.x509.GeneralName=function(e){KJUR.asn1.x509.GeneralName.superclass.constructor.call(this);var t=KJUR.asn1,n=t.x509,r=n.X500Name,i=n.OtherName,o=t.DERIA5String;t.DERPrintableString;var l=t.DEROctetString,s=t.DERTaggedObject,a=t.ASN1Object,u=Error;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e,t,n=this.params,c=!1;if(void 0!==n.other)e="a0",t=new i(n.other);else if(void 0!==n.rfc822)e="81",t=new o({str:n.rfc822});else if(void 0!==n.dns)e="82",t=new o({str:n.dns});else if(void 0!==n.dn)e="a4",c=!0,t="string"==typeof n.dn?new r({str:n.dn}):n.dn instanceof KJUR.asn1.x509.X500Name?n.dn:new r(n.dn);else if(void 0!==n.ldapdn)e="a4",c=!0,t=new r({ldapstr:n.ldapdn});else if(void 0!==n.certissuer||void 0!==n.certsubj){var h,d;e="a4",c=!0;var f=null;if(void 0!==n.certsubj?(h=!1,d=n.certsubj):(h=!0,d=n.certissuer),d.match(/^[0-9A-Fa-f]+$/),-1!=d.indexOf("-----BEGIN ")&&(f=pemtohex(d)),null==f)throw new Error("certsubj/certissuer not cert");var p,g=new X509;g.hex=f,p=h?g.getIssuerHex():g.getSubjectHex(),(t=new a).hTLV=p}else if(void 0!==n.uri)e="86",t=new o({str:n.uri});else{if(void 0===n.ip)throw new u("improper params");var w;e="87";var m=n.ip;try{if(m.match(/^[0-9a-f]+$/)){var v=m.length;if(8!=v&&16!=v&&32!=v&&64!=v)throw"err";w=m}else w=iptohex(m)}catch(e){throw new u("malformed IP address: "+n.ip+":"+e.message)}t=new l({hex:w})}return new s({tag:e,explicit:c,obj:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.GeneralName,KJUR.asn1.ASN1Object),KJUR.asn1.x509.GeneralNames=function(e){KJUR.asn1.x509.GeneralNames.superclass.constructor.call(this);var t=KJUR.asn1;this.setByParamArray=function(e){for(var n=0;n<e.length;n++){var r=new t.x509.GeneralName(e[n]);this.asn1Array.push(r)}},this.tohex=function(){return new t.DERSequence({array:this.asn1Array}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,void 0!==e&&this.setByParamArray(e)},extendClass(KJUR.asn1.x509.GeneralNames,KJUR.asn1.ASN1Object),KJUR.asn1.x509.OtherName=function(e){KJUR.asn1.x509.OtherName.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERObjectIdentifier,r=t.DERSequence,i=t.ASN1Util.newObject;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if(null==e.oid||null==e.value)throw new Error("oid or value not specified");var t=new n({oid:e.oid}),o=i({tag:{tag:"a0",explicit:!0,obj:e.value}});return new r({array:[t,o]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.x509.OtherName,KJUR.asn1.ASN1Object),KJUR.asn1.x509.OID=new function(){var e=KJUR.asn1.DERObjectIdentifier;this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];if(void 0===this.name2oidList[t])throw"Name of ObjectIdentifier not defined: "+t;var n=this.name2oidList[t],r=new e({oid:n});return this.objCache[t]=r,r},this.atype2obj=function(t){if(void 0!==this.objCache[t])return this.objCache[t];var n;if(t.match(/^\d+\.\d+\.[0-9.]+$/))n=t;else if(void 0!==this.atype2oidList[t])n=this.atype2oidList[t];else{if(void 0===this.name2oidList[t])throw new Error("AttributeType name undefined: "+t);n=this.name2oidList[t]}var r=new e({oid:n});return this.objCache[t]=r,r},this.registerOIDs=function(e){if(this.checkOIDs(e))for(var t in e)this.name2oidList[t]=e[t]},this.checkOIDs=function(e){try{var t=Object.keys(e);return 0!=t.length&&(t.map((function(e,t,n){if(!this[e].match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")}),e),!0)}catch(e){return!1}}},KJUR.asn1.x509.OID.oid2name=function(e){var t=KJUR.asn1.x509.OID.name2oidList;for(var n in t)if(t[n]==e)return n;return""},KJUR.asn1.x509.OID.oid2atype=function(e){var t=KJUR.asn1.x509.OID.atype2oidList;for(var n in t)if(t[n]==e)return n;return e},KJUR.asn1.x509.OID.name2oid=function(e){if(e.match(/^[0-9.]+$/))return e;var t=KJUR.asn1.x509.OID.name2oidList;return void 0===t[e]?"":t[e]},KJUR.asn1.x509.X509Util={},KJUR.asn1.x509.X509Util.newCertPEM=function(e){var t=KJUR.asn1.x509;return t.TBSCertificate,new(0,t.Certificate)(e).getPEM()},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),void 0!==KJUR.asn1.cms&&KJUR.asn1.cms||(KJUR.asn1.cms={}),KJUR.asn1.cms.Attribute=function(e){var t=Error,n=KJUR.asn1,r=n.DERSequence,i=n.DERSet,o=n.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(e){this.params=e},this.getValueArray=function(){throw new t("not yet implemented abstract")},this.tohex=function(){var e=new o({oid:this.typeOid}),t=new i({array:this.getValueArray()});return new r({array:[e,t]}).tohex()},this.getEncodedHex=function(){return this.tohex()}},extendClass(KJUR.asn1.cms.Attribute,KJUR.asn1.ASN1Object),KJUR.asn1.cms.ContentType=function(e){var t=KJUR.asn1;t.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){return[new t.DERObjectIdentifier(this.params.type)]},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.ContentType,KJUR.asn1.cms.Attribute),KJUR.asn1.cms.MessageDigest=function(e){var t=KJUR.asn1,n=t.DEROctetString;t.cms.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){return[new n(this.params)]},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.MessageDigest,KJUR.asn1.cms.Attribute),KJUR.asn1.cms.SigningTime=function(e){var t=KJUR.asn1;t.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){return[new t.x509.Time(this.params)]},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.SigningTime,KJUR.asn1.cms.Attribute),KJUR.asn1.cms.SigningCertificate=function(e){var t=Error,n=KJUR,r=n.asn1,i=r.DERSequence,o=r.cms,l=o.ESSCertID;n.crypto,o.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new t("parameter 'array' not specified");for(var n=this.params.array,r=[],o=0;o<n.length;o++){var s=n[o];0!=e.hasis||"string"!=typeof s||-1==s.indexOf("-----BEGIN")&&!ASN1HEX.isASN1HEX(s)||(s={cert:s}),0!=s.hasis&&0==e.hasis&&(s.hasis=!1),r.push(new l(s))}var a=new i({array:r});return[new i({array:[a]})]},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.SigningCertificate,KJUR.asn1.cms.Attribute),KJUR.asn1.cms.ESSCertID=function(e){KJUR.asn1.cms.ESSCertID.superclass.constructor.call(this);var t=Error,n=KJUR,r=n.asn1,i=r.DEROctetString,o=r.DERSequence,l=r.cms.IssuerSerial;this.params=null,this.getCertHash=function(e,r){if(null!=e.hash)return e.hash;if("string"==typeof e&&-1==e.indexOf("-----BEGIN")&&!ASN1HEX.isASN1HEX(e))return e;var i,o,l;if("string"==typeof e)i=e;else{if(null==e.cert)throw new t("hash nor cert unspecified");i=e.cert}if(o=-1!=i.indexOf("-----BEGIN")?pemtohex(i):i,"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?o=pemtohex(e):ASN1HEX.isASN1HEX(e)&&(o=e)),null!=e.alg)l=e.alg;else{if(null==r)throw new t("hash alg unspecified");l=r}return n.crypto.Util.hashHex(o,l)},this.tohex=function(){var e=this.params,t=this.getCertHash(e,"sha1"),n=[];return n.push(new i({hex:t})),("string"==typeof e&&-1!=e.indexOf("-----BEGIN")||null!=e.cert&&0!=e.hasis||null!=e.issuer&&null!=e.serial)&&n.push(new l(e)),new o({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.ESSCertID,KJUR.asn1.ASN1Object),KJUR.asn1.cms.SigningCertificateV2=function(e){var t=Error,n=KJUR,r=n.asn1,i=r.DERSequence;r.x509;var o=r.cms,l=o.ESSCertIDv2;n.crypto,o.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new t("parameter 'array' not specified");for(var n=this.params.array,r=[],o=0;o<n.length;o++){var s=n[o];null==e.alg&&0!=e.hasis||"string"!=typeof s||-1==s.indexOf("-----BEGIN")&&!ASN1HEX.isASN1HEX(s)||(s={cert:s}),null==s.alg&&null!=e.alg&&(s.alg=e.alg),0!=s.hasis&&0==e.hasis&&(s.hasis=!1),r.push(new l(s))}var a=new i({array:r});return[new i({array:[a]})]},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.SigningCertificateV2,KJUR.asn1.cms.Attribute),KJUR.asn1.cms.ESSCertIDv2=function(e){KJUR.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DEROctetString,r=t.DERSequence,i=t.cms.IssuerSerial,o=t.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var e=this.params,t=this.getCertHash(e,"sha256"),l=[];return null!=e.alg&&"sha256"!=e.alg&&l.push(new o({name:e.alg})),l.push(new n({hex:t})),("string"==typeof e&&-1!=e.indexOf("-----BEGIN")||null!=e.cert&&0!=e.hasis||null!=e.issuer&&null!=e.serial)&&l.push(new i(e)),new r({array:l}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.ESSCertIDv2,KJUR.asn1.cms.ESSCertID),KJUR.asn1.cms.IssuerSerial=function(e){var t=Error,n=KJUR.asn1,r=n.DERInteger,i=n.DERSequence,o=n.cms,l=n.x509.GeneralNames,s=X509;o.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(e){this.params=e},this.tohex=function(){var e,n,o=this.params;if("string"==typeof o&&-1!=o.indexOf("-----BEGIN")||null!=o.cert){var a;a=null!=o.cert?o.cert:o;var u=new s;u.readCertPEM(a),e=u.getIssuer(),n={hex:u.getSerialNumberHex()}}else{if(null==o.issuer||!o.serial)throw new t("cert or issuer and serial parameter not specified");e=o.issuer,n=o.serial}var c=new l([{dn:e}]),h=new r(n);return new i({array:[c,h]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.IssuerSerial,KJUR.asn1.ASN1Object),KJUR.asn1.cms.SignerIdentifier=function(e){var t=KJUR.asn1;t.DERInteger,t.DERSequence;var n=t.cms,r=n.IssuerAndSerialNumber,i=n.SubjectKeyIdentifier;t.x509.X500Name,n.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if("isssn"==e.type)return new r(e).tohex();if("skid"==e.type)return new i(e).tohex();throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.SignerIdentifier,KJUR.asn1.ASN1Object),KJUR.asn1.cms.IssuerAndSerialNumber=function(e){var t=KJUR.asn1,n=t.DERInteger,r=t.DERSequence,i=t.cms,o=t.x509.X500Name,l=X509,s=Error;i.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e,t,i=this.params;if("string"==typeof i&&-1!=i.indexOf("-----BEGIN")||null!=i.cert){var a;a=null!=i.cert?i.cert:i;var u=new l;u.readCertPEM(a),e=u.getIssuer(),t={hex:u.getSerialNumberHex()}}else{if(null==i.issuer||!i.serial)throw new s("cert or issuer and serial parameter not specified");e=i.issuer,t=i.serial}var c=new o(e),h=new n(t);return new r({array:[c,h]}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.IssuerAndSerialNumber,KJUR.asn1.ASN1Object),KJUR.asn1.cms.SubjectKeyIdentifier=function(e){var t=KJUR.asn1;t.DERInteger,t.DERSequence;var n=t.ASN1Util.newObject,r=t.cms;r.IssuerAndSerialName,r.SubjectKeyIdentifier,t.x509.X500Name;var i=X509,o=Error;r.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var e,t=this.params;if(null==t.cert&&null==t.skid)throw new o("property cert nor skid undefined");null!=t.cert?e=new i(t.cert).getExtSubjectKeyIdentifier().kid.hex:null!=t.skid&&(e=t.skid);return n({tag:{tage:"a0",obj:{octstr:{hex:e}}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.SubjectKeyIdentifier,KJUR.asn1.ASN1Object),KJUR.asn1.cms.AttributeList=function(e){var t=Error,n=KJUR.asn1,r=n.DERSet,i=n.cms;i.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if(null!=this.hTLV)return this.hTLV;var n=!0;null!=e.sortflag&&(n=e.sortflag);for(var o=e.array,l=[],s=0;s<o.length;s++){var a=o[s],u=a.attr;if("contentType"==u)l.push(new i.ContentType(a));else if("messageDigest"==u)l.push(new i.MessageDigest(a));else if("signingTime"==u)l.push(new i.SigningTime(a));else if("signingCertificate"==u)l.push(new i.SigningCertificate(a));else if("signingCertificateV2"==u)l.push(new i.SigningCertificateV2(a));else if("signaturePolicyIdentifier"==u)l.push(new KJUR.asn1.cades.SignaturePolicyIdentifier(a));else{if("signatureTimeStamp"!=u&&"timeStampToken"!=u)throw new t("unknown attr: "+u);l.push(new KJUR.asn1.cades.SignatureTimeStamp(a))}}var c=new r({array:l,sortflag:n});return this.hTLV=c.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.AttributeList,KJUR.asn1.ASN1Object),KJUR.asn1.cms.SignerInfo=function(e){var t=Error,n=KJUR,r=n.asn1,i=r.DERInteger,o=r.DEROctetString,l=r.DERSequence,s=r.DERTaggedObject,a=r.cms,u=a.SignerIdentifier,c=a.AttributeList;a.ContentType,a.EncapsulatedContentInfo,a.MessageDigest,a.SignedData;var h=r.x509.AlgorithmIdentifier,d=n.crypto,f=KEYUTIL;a.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var e=this.params,t=e.sigalg,n=new c(e.sattrs).tohex(),r=f.getKey(e.signkey),i=new d.Signature({alg:t});i.init(r),i.updateHex(n);var o=i.sign();e.sighex=o},this.tohex=function(){var e=this.params,n=[];if(n.push(new i({int:e.version})),n.push(new u(e.id)),n.push(new h({name:e.hashalg})),null!=e.sattrs){var r=new c(e.sattrs);try{n.push(new s({tag:"a0",explicit:!1,obj:r}))}catch(e){throw new t("si sattr error: "+e)}}if(null!=e.sigalgfield?n.push(new h({name:e.sigalgfield})):n.push(new h({name:e.sigalg})),null==e.sighex&&null!=e.signkey&&this.sign(),n.push(new o({hex:e.sighex})),null!=e.uattrs){r=new c(e.uattrs);try{n.push(new s({tag:"a1",explicit:!1,obj:r}))}catch(e){throw new t("si uattr error: "+e)}}return new l({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.SignerInfo,KJUR.asn1.ASN1Object),KJUR.asn1.cms.EncapsulatedContentInfo=function(e){var t=KJUR.asn1,n=t.DERTaggedObject,r=t.DERSequence,i=t.DERObjectIdentifier,o=t.DEROctetString;t.cms.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];if(t.push(new i(e.type)),null!=e.content&&(null!=e.content.hex||null!=e.content.str)&&1!=e.isDetached){var l=new o(e.content),s=new n({tag:"a0",explicit:!0,obj:l});t.push(s)}return new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.EncapsulatedContentInfo,KJUR.asn1.ASN1Object),KJUR.asn1.cms.ContentInfo=function(e){var t=KJUR.asn1,n=t.DERTaggedObject,r=t.DERSequence,i=t.DERObjectIdentifier;t.x509.OID.name2obj,KJUR.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];t.push(new i(e.type));var o=new n({tag:"a0",explicit:!0,obj:e.obj});return t.push(o),new r({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.ContentInfo,KJUR.asn1.ASN1Object),KJUR.asn1.cms.SignedData=function(e){var t=KJUR.asn1;t.ASN1Object;var n=t.DERInteger,r=t.DERSet,i=t.DERSequence;t.DERTaggedObject;var o=t.cms,l=o.EncapsulatedContentInfo,s=o.SignerInfo,a=o.ContentInfo,u=o.CertificateSet,c=o.RevocationInfoChoices,h=t.x509.AlgorithmIdentifier;KJUR.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var e=this.params;this._setDigestAlgs(e),this._setContentTypeByEContent(e),this._setMessageDigestByEContent(e),this._setSignerInfoVersion(e),this._setSignedDataVersion(e)},this._setDigestAlgs=function(e){for(var t={},n=e.sinfos,r=0;r<n.length;r++){t[n[r].hashalg]=1}e.hashalgs=Object.keys(t).sort()},this._setContentTypeByEContent=function(e){for(var t=e.econtent.type,n=e.sinfos,r=0;r<n.length;r++){var i=n[r];this._getAttrParamByName(i,"contentType").type=t}},this._setMessageDigestByEContent=function(e){var t=e.econtent;e.econtent.type;var n=t.content.hex;null==n&&"data"==t.type&&null!=t.content.str&&(n=rstrtohex(t.content.str));for(var r=e.sinfos,i=0;i<r.length;i++){var o=r[i],l=o.hashalg,s=this._getAttrParamByName(o,"messageDigest"),a=KJUR.crypto.Util.hashHex(n,l);s.hex=a}},this._getAttrParamByName=function(e,t){for(var n=e.sattrs.array,r=0;r<n.length;r++)if(n[r].attr==t)return n[r]},this._setSignerInfoVersion=function(e){for(var t=e.sinfos,n=0;n<t.length;n++){var r=t[n],i=1;"skid"==r.id.type&&(i=3),r.version=i}},this._setSignedDataVersion=function(e){var t=this._getSignedDataVersion(e);e.version=t},this._getSignedDataVersion=function(e){if(null!=e.revinfos)for(var t=e.revinfos,n=0;n<t.length;n++){if(null!=t[n].ocsp)return 5}var r=e.sinfos;for(n=0;n<r.length;n++){if(3==e.sinfos[n].version)return 3}return"data"!=e.econtent.type?3:1},this.tohex=function(){var e=this.params;null!=this.getEncodedHexPrepare&&this.getEncodedHexPrepare(),1!=e.fixed&&this.checkAndFixParam();var t=[];t.push(new n({int:e.version}));for(var o=[],a=0;a<e.hashalgs.length;a++){var d=e.hashalgs[a];o.push(new h({name:d}))}t.push(new r({array:o})),t.push(new l(e.econtent)),null!=e.certs&&t.push(new u(e.certs)),null!=e.revinfos&&t.push(new c(e.revinfos));var f=[];for(a=0;a<e.sinfos.length;a++){var p=e.sinfos[a];f.push(new s(p))}return t.push(new r({array:f})),new i({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){return new a({type:"signed-data",obj:this})},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.SignedData,KJUR.asn1.ASN1Object),KJUR.asn1.cms.CertificateSet=function(e){KJUR.asn1.cms.CertificateSet.superclass.constructor.call(this);var t=Error,n=KJUR.asn1,r=n.DERTaggedObject,i=n.DERSet,o=n.ASN1Object;this.params=null,this.tohex=function(){var e,n=this.params,l=[];if(n instanceof Array)e=n;else{if(null==n.array)throw new t("cert array not specified");e=n.array}for(var s=0;s<e.length;s++){var a=pemtohex(e[s]),u=new o;u.hTLV=a,l.push(u)}var c={array:l};0==n.sortflag&&(c.sortflag=!1);var h=new i(c);return new r({tag:"a0",explicit:!1,obj:h}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.CertificateSet,KJUR.asn1.ASN1Object),KJUR.asn1.cms.RevocationInfoChoices=function(e){KJUR.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new Error("params is not array");for(var t=[],n=0;n<e.length;n++)t.push(new KJUR.asn1.cms.RevocationInfoChoice(e[n]));return KJUR.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:t}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.RevocationInfoChoices,KJUR.asn1.ASN1Object),KJUR.asn1.cms.RevocationInfoChoice=function(e){KJUR.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(null!=e.crl&&"string"==typeof e.crl){var t=e.crl;return-1!=e.crl.indexOf("-----BEGIN")&&(t=pemtohex(e.crl)),t}if(null!=e.ocsp)return KJUR.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new KJUR.asn1.cms.OtherRevocationFormat(e)}}).tohex();throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.RevocationInfoChoice,KJUR.asn1.ASN1Object),KJUR.asn1.cms.OtherRevocationFormat=function(e){KJUR.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var t=Error,n=KJUR,r=n.asn1.ASN1Util.newObject,i=n.lang.String.isHex;this.params=null,this.tohex=function(){var e=this.params;if(null==e.ocsp)throw new t("property ocsp not specified");if(!i(e.ocsp)||!ASN1HEX.isASN1HEX(e.ocsp))throw new t("ocsp value not ASN.1 hex string");return r({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:e.ocsp}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cms.OtherRevocationFormat,KJUR.asn1.ASN1Object),KJUR.asn1.cms.CMSUtil=new function(){},KJUR.asn1.cms.CMSUtil.newSignedData=function(e){return new KJUR.asn1.cms.SignedData(e)},KJUR.asn1.cms.CMSUtil.verifySignedData=function(e){var t=KJUR,n=t.asn1,r=n.cms;r.SignerInfo,r.SignedData,r.SigningTime,r.SigningCertificate,r.SigningCertificateV2,n.cades.SignaturePolicyIdentifier;var i=t.lang.String.isHex,o=ASN1HEX,l=o.getVbyList,s=o.getTLVbyList,a=o.getIdxbyList,u=o.getChildIdx,c=o.getTLV,h=o.oidname,d=t.crypto.Util.hashHex;void 0===e.cms&&i(e.cms);var f=e.cms,p=function(e,t){var n=t.idx;t.signerid_issuer1=s(e,n,[1,0],"30"),t.signerid_serial1=l(e,n,[1,1],"02"),t.hashalg=h(l(e,n,[2,0],"06"));var r=a(e,n,[3],"a0");t.idxSignedAttrs=r,g(e,t,r);var i=u(e,n).length;if(i<6)throw"malformed SignerInfo";t.sigalg=h(l(e,n,[i-2,0],"06")),t.sigval=l(e,n,[i-1],"04")},g=function(e,t,n){var r=u(e,n);t.signedAttrIdxList=r;for(var i=0;i<r.length;i++){var o,s=r[i],a=l(e,s,[0],"06");"2a864886f70d010905"===a?(o=hextoutf8(l(e,s,[1,0])),t.saSigningTime=o):"2a864886f70d010904"===a&&(o=l(e,s,[1,0],"04"),t.saMessageDigest=o)}},w=function(e,t,n,r){n.verifyDetail={};var i=n.verifyDetail,o=t.parse.econtent,l=n.hashalg,s=n.saMessageDigest;i.validMessageDigest=!1,d(o,l)===s&&(i.validMessageDigest=!0),function(e,t,n,r){var i,o=t.parse.certsIdx;if(void 0===t.certs){i=[],t.certkeys=[];for(var l=u(e,o),s=0;s<l.length;s++){var a=c(e,l[s]),h=new X509;h.readCertHex(a),i[s]=h,t.certkeys[s]=h.getPublicKey()}t.certs=i}else i=t.certs;for(t.cccc=i.length,t.cccci=l.length,s=0;s<i.length;s++){var d=h.getIssuerHex(),f=h.getSerialNumberHex();n.signerid_issuer1===d&&n.signerid_serial1===f&&(n.certkey_idx=s)}}(e,t,n),i.validSignatureValue=!1;var a=n.sigalg,h="31"+c(e,n.idxSignedAttrs).substr(2);n.signedattrshex=h;var f=t.certs[n.certkey_idx].getPublicKey(),p=new KJUR.crypto.Signature({alg:a});p.init(f),p.updateHex(h);var g=p.verify(n.sigval);i.validSignatureValue_isValid=g,!0===g&&(i.validSignatureValue=!0),n.isValid=!1,i.validMessageDigest&&i.validSignatureValue&&(n.isValid=!0)},m={isValid:!1,parse:{}};return function(e,t){if("2a864886f70d010702"!==l(e,0,[0],"06"))return t;t.cmsType="signedData",t.econtent=l(e,0,[1,0,2,1,0]),function(e,t){for(var n,r=3;r<6;r++)if(void 0!==(n=a(e,0,[1,0,r]))){var i=e.substr(n,2);"a0"===i&&(t.certsIdx=n),"a1"===i&&(t.revinfosIdx=n),"31"===i&&(t.signerinfosIdx=n)}}(e,t),t.signerInfos=[],function(e,t){var n=t.signerinfosIdx;if(void 0!==n){var r=u(e,n);t.signerInfoIdxList=r;for(var i=0;i<r.length;i++){var o={idx:r[i]};p(e,o),t.signerInfos.push(o)}}}(e,t)}(f,m.parse),function(e,t){for(var n=t.parse.signerInfos,r=n.length,i=!0,o=0;o<r;o++){var l=n[o];w(e,t,l),l.isValid||(i=!1)}t.isValid=i}(f,m),m},KJUR.asn1.cms.CMSParser=function(){var e=Error,t=X509,n=new t,r=ASN1HEX,i=r.getV,o=r.getTLV;r.getIdxbyList;var l=r.getTLVbyList,s=r.getTLVbyListEx,a=r.getVbyList,u=r.getVbyListEx,c=r.getChildIdx;this.getCMSSignedData=function(e){var t=l(e,0,[1,0]);return this.getSignedData(t)},this.getSignedData=function(e){var t=c(e,0),n={},r=i(e,t[0]),l=parseInt(r,16);n.version=l;var a=o(e,t[1]);n.hashalgs=this.getHashAlgArray(a);var u=o(e,t[2]);n.econtent=this.getEContent(u);var h=s(e,0,["[0]"]);null!=h&&(n.certs=this.getCertificateSet(h)),s(e,0,["[1]"]);var d=s(e,0,[3]);return n.sinfos=this.getSignerInfos(d),n},this.getHashAlgArray=function(e){for(var n=c(e,0),r=new t,i=[],l=0;l<n.length;l++){var s=o(e,n[l]),a=r.getAlgorithmIdentifierName(s);i.push(a)}return i},this.getEContent=function(e){var t={},n=a(e,0,[0]),r=a(e,0,[1,0]);return t.type=KJUR.asn1.x509.OID.oid2name(ASN1HEX.hextooidstr(n)),t.content={hex:r},t},this.getSignerInfos=function(e){for(var t=[],n=c(e,0),r=0;r<n.length;r++){var i=o(e,n[r]),l=this.getSignerInfo(i);t.push(l)}return t},this.getSignerInfo=function(e){var t={},i=c(e,0),l=r.getInt(e,i[0],-1);-1!=l&&(t.version=l);var a=o(e,i[1]),h=this.getIssuerAndSerialNumber(a);t.id=h;var d=o(e,i[2]),f=n.getAlgorithmIdentifierName(d);t.hashalg=f;var p=s(e,0,["[0]"]);if(null!=p){var g=this.getAttributeList(p);t.sattrs=g}var w=s(e,0,[3]),m=n.getAlgorithmIdentifierName(w);t.sigalg=m;var v=u(e,0,[4]);t.sighex=v;var y=s(e,0,["[1]"]);if(null!=y){var b=this.getAttributeList(y);t.uattrs=b}return t},this.getSignerIdentifier=function(e){if("30"==e.substr(0,2))return this.getIssuerAndSerialNumber(e);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(e){var t={type:"isssn"},r=c(e,0),l=o(e,r[0]);t.issuer=n.getX500Name(l);var s=i(e,r[1]);return t.serial={hex:s},t},this.getAttributeList=function(e){for(var t=[],n=c(e,0),r=0;r<n.length;r++){var i=o(e,n[r]),l=this.getAttribute(i);t.push(l)}return{array:t}},this.getAttribute=function(e){var t={},n=c(e,0),i=r.getOID(e,n[0]),l=KJUR.asn1.x509.OID.oid2name(i);t.attr=l;var s=o(e,n[1]),a=c(s,0);if(1==a.length)t.valhex=o(s,a[0]);else{for(var u=[],h=0;h<a.length;h++)u.push(o(s,a[h]));t.valhex=u}return"contentType"==l?this.setContentType(t):"messageDigest"==l?this.setMessageDigest(t):"signingTime"==l?this.setSigningTime(t):"signingCertificate"==l?this.setSigningCertificate(t):"signingCertificateV2"==l?this.setSigningCertificateV2(t):"signaturePolicyIdentifier"==l&&this.setSignaturePolicyIdentifier(t),t},this.setContentType=function(e){var t=r.getOIDName(e.valhex,0,null);null!=t&&(e.type=t,delete e.valhex)},this.setSigningTime=function(e){var t=hextoutf8(i(e.valhex,0));e.str=t,delete e.valhex},this.setMessageDigest=function(e){var t=i(e.valhex,0);e.hex=t,delete e.valhex},this.setSigningCertificate=function(e){var t=c(e.valhex,0);if(t.length>0){for(var n=o(e.valhex,t[0]),r=c(n,0),i=[],l=0;l<r.length;l++){var s=o(n,r[l]),a=this.getESSCertID(s);i.push(a)}e.array=i}if(t.length>1){var u=o(e.valhex,t[1]);e.polhex=u}delete e.valhex},this.setSignaturePolicyIdentifier=function(e){var n=c(e.valhex,0);if(n.length>0){var l=r.getOID(e.valhex,n[0]);e.oid=l}if(n.length>1){var s=new t,a=c(e.valhex,n[1]),u=o(e.valhex,a[0]),h=s.getAlgorithmIdentifierName(u);e.alg=h;var d=i(e.valhex,a[1]);e.hash=d}delete e.valhex},this.setSigningCertificateV2=function(e){var t=c(e.valhex,0);if(t.length>0){for(var n=o(e.valhex,t[0]),r=c(n,0),i=[],l=0;l<r.length;l++){var s=o(n,r[l]),a=this.getESSCertIDv2(s);i.push(a)}e.array=i}if(t.length>1){var u=o(e.valhex,t[1]);e.polhex=u}delete e.valhex},this.getESSCertID=function(e){var t={},n=c(e,0);if(n.length>0){var r=i(e,n[0]);t.hash=r}if(n.length>1){var l=o(e,n[1]),s=this.getIssuerSerial(l);null!=s.serial&&(t.serial=s.serial),null!=s.issuer&&(t.issuer=s.issuer)}return t},this.getESSCertIDv2=function(t){var r={},l=c(t,0);if(l.length<1||3<l.length)throw new e("wrong number of elements");var s=0;if("30"==t.substr(l[0],2)){var a=o(t,l[0]);r.alg=n.getAlgorithmIdentifierName(a),s++}else r.alg="sha256";var u=i(t,l[s]);if(r.hash=u,l.length>s+1){var h=o(t,l[s+1]),d=this.getIssuerSerial(h);r.issuer=d.issuer,r.serial=d.serial}return r},this.getIssuerSerial=function(e){var t={},r=c(e,0),l=o(e,r[0]),s=n.getGeneralNames(l)[0].dn;t.issuer=s;var a=i(e,r[1]);return t.serial={hex:a},t},this.getCertificateSet=function(e){for(var t=c(e,0),n=[],r=0;r<t.length;r++){var i=o(e,t[r]);if("30"==i.substr(0,2)){var l=hextopem(i,"CERTIFICATE");n.push(l)}}return{array:n,sortflag:!1}}},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),void 0!==KJUR.asn1.tsp&&KJUR.asn1.tsp||(KJUR.asn1.tsp={}),KJUR.asn1.tsp.TimeStampToken=function(e){var t=KJUR.asn1.tsp;t.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var e=new t.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=e.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.TimeStampToken,KJUR.asn1.cms.SignedData),KJUR.asn1.tsp.TSTInfo=function(e){var t=KJUR.asn1,n=t.DERSequence,r=t.DERInteger,i=t.DERBoolean,o=t.DERGeneralizedTime,l=t.DERObjectIdentifier,s=t.DERTaggedObject,a=t.tsp,u=a.MessageImprint,c=a.Accuracy;t.x509.X500Name;var h=t.x509.GeneralName;if(a.TSTInfo.superclass.constructor.call(this),this.dVersion=new r({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var e=[this.dVersion];if(null==this.dPolicy)throw new Error("policy shall be specified.");if(e.push(this.dPolicy),null==this.dMessageImprint)throw new Error("messageImprint shall be specified.");if(e.push(this.dMessageImprint),null==this.dSerial)throw new Error("serialNumber shall be specified.");if(e.push(this.dSerial),null==this.dGenTime)throw new Error("genTime shall be specified.");e.push(this.dGenTime),null!=this.dAccuracy&&e.push(this.dAccuracy),null!=this.dOrdering&&e.push(this.dOrdering),null!=this.dNonce&&e.push(this.dNonce),null!=this.dTsa&&e.push(this.dTsa);var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e){if("string"==typeof e.policy){if(!e.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new l({oid:e.policy})}void 0!==e.messageImprint&&(this.dMessageImprint=new u(e.messageImprint)),void 0!==e.serial&&(this.dSerial=new r(e.serial)),void 0!==e.genTime&&(this.dGenTime=new o(e.genTime)),void 0!==e.accuracy&&(this.dAccuracy=new c(e.accuracy)),void 0!==e.ordering&&1==e.ordering&&(this.dOrdering=new i),void 0!==e.nonce&&(this.dNonce=new r(e.nonce)),void 0!==e.tsa&&(this.dTsa=new s({tag:"a0",explicit:!0,obj:new h({dn:e.tsa})}))}},extendClass(KJUR.asn1.tsp.TSTInfo,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.Accuracy=function(e){var t=KJUR.asn1,n=t.ASN1Util.newObject;t.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return null!=e.seconds&&"number"==typeof e.seconds&&t.push({int:e.seconds}),null!=e.millis&&"number"==typeof e.millis&&t.push({tag:{tagi:"80",obj:{int:e.millis}}}),null!=e.micros&&"number"==typeof e.micros&&t.push({tag:{tagi:"81",obj:{int:e.micros}}}),n({seq:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.Accuracy,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.MessageImprint=function(e){var t=KJUR.asn1,n=t.DERSequence,r=t.DEROctetString,i=t.x509.AlgorithmIdentifier;t.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=new i({name:e.alg}),o=new r({hex:e.hash});return new n({array:[t,o]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.MessageImprint,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.TimeStampReq=function(e){var t=KJUR.asn1,n=t.DERSequence,r=t.DERInteger,i=t.DERBoolean;t.ASN1Object;var o=t.DERObjectIdentifier,l=t.tsp,s=l.MessageImprint;l.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return t.push(new r({int:1})),e.messageImprint instanceof KJUR.asn1.ASN1Object?t.push(e.messageImprint):t.push(new s(e.messageImprint)),null!=e.policy&&t.push(new o(e.policy)),null!=e.nonce&&t.push(new r(e.nonce)),1==e.certreq&&t.push(new i),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.TimeStampReq,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.TimeStampResp=function(e){var t=KJUR.asn1,n=t.DERSequence;t.ASN1Object;var r=t.tsp,i=r.PKIStatusInfo;r.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,o=[];if(null!=e.econtent||null!=e.tst)if(null!=e.statusinfo?o.push(new i(e.statusinfo)):o.push(new i("granted")),null!=e.econtent)o.push(new r.TimeStampToken(e).getContentInfo());else{if(!(e.tst instanceof t.ASN1Object))throw new Error("improper member tst value");o.push(e.tst)}else{if(null==e.statusinfo)throw new Error("parameter for token nor statusinfo not specified");o.push(new i(e.statusinfo))}return new n({array:o}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.TimeStampResp,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.PKIStatusInfo=function(e){var t=Error,n=KJUR.asn1,r=n.DERSequence,i=n.tsp,o=i.PKIStatus,l=i.PKIFreeText,s=i.PKIFailureInfo;i.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,n=[];if("string"==typeof e)n.push(new o(e));else{if(null==e.status)throw new t("property 'status' unspecified");n.push(new o(e.status)),null!=e.statusstr&&n.push(new l(e.statusstr)),null!=e.failinfo&&n.push(new s(e.failinfo))}return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.PKIStatusInfo,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.PKIStatus=function(e){var t=Error,n=KJUR.asn1,r=n.DERInteger;n.tsp.PKIStatus.superclass.constructor.call(this);var i={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var e,n=this.params;if("string"==typeof n)try{e=i[n]}catch(e){throw new t("undefined name: "+n)}else{if("number"!=typeof n)throw new t("unsupported params");e=n}return new r({int:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.PKIStatus,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.PKIFreeText=function(e){var t=Error,n=KJUR.asn1,r=n.DERSequence,i=n.DERUTF8String;n.tsp.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(!e instanceof Array)throw new t("wrong params: not array");for(var n=[],o=0;o<e.length;o++)n.push(new i({str:e[o]}));return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.PKIFreeText,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.PKIFailureInfo=function(e){var t=Error,n=KJUR.asn1,r=n.DERBitString,i=n.tsp.PKIFailureInfo,o={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};i.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var e=this.params,n=0;if("number"==typeof e&&0<=e&&e<=25){for(var r=(n|=1<<e).toString(2),i="",l=r.length-1;l>=0;l--)i+=r[l];return i}if("string"==typeof e&&null!=o[e])return namearraytobinstr([e],o);if("object"==typeof e&&null!=e.length)return namearraytobinstr(e,o);throw new t("wrong params")},this.tohex=function(){this.params;var e=this.getBinValue();return new r({bin:e}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.tsp.PKIFailureInfo,KJUR.asn1.ASN1Object),KJUR.asn1.tsp.AbstractTSAAdapter=function(e){this.getTSTHex=function(e,t){throw"not implemented yet"}},KJUR.asn1.tsp.SimpleTSAAdapter=function(e){var t=KJUR,n=t.asn1.tsp,r=t.crypto.Util.hashHex;n.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(e,t){var i=r(e,t);this.params.econtent.content.messageImprint={alg:t,hash:i},this.params.econtent.content.serial={int:this.serial++};var o=Math.floor(1e9*Math.random());return this.params.econtent.content.nonce={int:o},new n.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.tsp.SimpleTSAAdapter,KJUR.asn1.tsp.AbstractTSAAdapter),KJUR.asn1.tsp.FixedTSAAdapter=function(e){var t=KJUR,n=t.asn1.tsp,r=t.crypto.Util.hashHex;n.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(e,t){var i=r(e,t);return this.params.econtent.content.messageImprint={alg:t,hash:i},new n.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==e&&(this.params=e)},extendClass(KJUR.asn1.tsp.FixedTSAAdapter,KJUR.asn1.tsp.AbstractTSAAdapter),KJUR.asn1.tsp.TSPUtil=new function(){},KJUR.asn1.tsp.TSPUtil.newTimeStampToken=function(e){return new KJUR.asn1.tsp.TimeStampToken(e)},KJUR.asn1.tsp.TSPUtil.parseTimeStampReq=function(e){return(new KJUR.asn1.tsp.TSPParser).getTimeStampReq(e)},KJUR.asn1.tsp.TSPUtil.parseMessageImprint=function(e){return(new KJUR.asn1.tsp.TSPParser).getMessageImprint(e)},KJUR.asn1.tsp.TSPParser=function(){var e=new X509,t=ASN1HEX,n=t.getV,r=t.getTLV,i=t.getIdxbyList;t.getTLVbyListEx;var o=t.getChildIdx,l=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],s={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(e){var t=o(e,0);if(1==t.length)return this.getPKIStatusInfo(r(e,t[0]));if(t.length>1){var n=this.getPKIStatusInfo(r(e,t[0])),i=r(e,t[1]),l=this.getToken(i);return l.statusinfo=n,l}},this.getToken=function(e){var t=(new KJUR.asn1.cms.CMSParser).getCMSSignedData(e);return this.setTSTInfo(t),t},this.setTSTInfo=function(e){var t=e.econtent;if("tstinfo"==t.type){var n=t.content.hex,r=this.getTSTInfo(n);t.content=r}},this.getTSTInfo=function(t){var i={},l=o(t,0),s=n(t,l[1]);i.policy=hextooid(s);var a=r(t,l[2]);i.messageImprint=this.getMessageImprint(a);var u=n(t,l[3]);i.serial={hex:u};var c=n(t,l[4]);i.genTime={str:hextoutf8(c)};var h=0;if(l.length>5&&"30"==t.substr(l[5],2)){var d=r(t,l[5]);i.accuracy=this.getAccuracy(d),h++}l.length>5+h&&"01"==t.substr(l[5+h],2)&&("ff"==n(t,l[5+h])&&(i.ordering=!0),h++);if(l.length>5+h&&"02"==t.substr(l[5+h],2)){var f=n(t,l[5+h]);i.nonce={hex:f},h++}if(l.length>5+h&&"a0"==t.substr(l[5+h],2)){var p=r(t,l[5+h]);p="30"+p.substr(2),pGeneralNames=e.getGeneralNames(p);var g=pGeneralNames[0].dn;i.tsa=g,h++}if(l.length>5+h&&"a1"==t.substr(l[5+h],2)){var w=r(t,l[5+h]);w="30"+w.substr(2);var m=e.getExtParamArray(w);i.ext=m,h++}return i},this.getAccuracy=function(e){for(var t={},r=o(e,0),i=0;i<r.length;i++){var l=e.substr(r[i],2),s=n(e,r[i]),a=parseInt(s,16);"02"==l?t.seconds=a:"80"==l?t.millis=a:"81"==l&&(t.micros=a)}return t},this.getMessageImprint=function(e){if("30"!=e.substr(0,2))throw new Error("head of messageImprint hex shall be x30");var r={};o(e,0);var l=i(e,0,[0,0]),s=n(e,l),a=t.hextooidstr(s),u=KJUR.asn1.x509.OID.oid2name(a);if(""==u)throw new Error("hashAlg name undefined: "+a);var c=u,h=i(e,0,[1]);return r.alg=c,r.hash=n(e,h),r},this.getPKIStatusInfo=function(e){var t={},i=o(e,0),s=0;try{var a=n(e,i[0]),u=parseInt(a,16);t.status=l[u]}catch(e){}if(i.length>1&&"30"==e.substr(i[1],2)){var c=r(e,i[1]);t.statusstr=this.getPKIFreeText(c),s++}if(i.length>s&&"03"==e.substr(i[1+s],2)){var h=r(e,i[1+s]);t.failinfo=this.getPKIFailureInfo(h)}return t},this.getPKIFreeText=function(e){for(var n=[],r=o(e,0),i=0;i<r.length;i++)n.push(t.getString(e,r[i]));return n},this.getPKIFailureInfo=function(e){var n=t.getInt(e,0);return null!=s[n]?s[n]:n},this.getTimeStampReq=function(e){var i={certreq:!1},l=o(e,0);if(l.length<2)throw new Error("TimeStampReq must have at least 2 items");var s=r(e,l[1]);i.messageImprint=KJUR.asn1.tsp.TSPUtil.parseMessageImprint(s);for(var a=2;a<l.length;a++){var u=l[a],c=e.substr(u,2);if("06"==c){var h=n(e,u);i.policy=t.hextooidstr(h)}"02"==c&&(i.nonce=n(e,u)),"01"==c&&(i.certreq=!0)}return i}},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),void 0!==KJUR.asn1.cades&&KJUR.asn1.cades||(KJUR.asn1.cades={}),KJUR.asn1.cades.SignaturePolicyIdentifier=function(e){var t=KJUR.asn1.cades,n=t.SignaturePolicyId;t.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new n(this.params)]},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cades.SignaturePolicyIdentifier,KJUR.asn1.cms.Attribute),KJUR.asn1.cades.SignaturePolicyId=function(e){var t=KJUR.asn1,n=t.DERSequence,r=t.DERObjectIdentifier;t.x509.AlgorithmIdentifier;var i=t.cades,o=i.SignaturePolicyId,l=i.OtherHashAlgAndValue;o.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,t=[];return t.push(new r(e.oid)),t.push(new l(e)),new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cades.SignaturePolicyId,KJUR.asn1.ASN1Object),KJUR.asn1.cades.OtherHashAlgAndValue=function(e){var t=Error,n=KJUR.asn1,r=n.DERSequence,i=n.DEROctetString,o=n.x509.AlgorithmIdentifier;n.cades.OtherHashAlgAndValue.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if(null==e.alg)throw new t("property 'alg' not specified");if(null==e.hash&&null==e.cert)throw new t("property 'hash' nor 'cert' not specified");var n=null;if(null!=e.hash)n=e.hash;else if(null!=e.cert){if("string"!=typeof e.cert)throw new t("cert not string");var l=e.cert;-1!=e.cert.indexOf("-----BEGIN")&&(l=pemtohex(e.cert)),n=KJUR.crypto.Util.hashHex(l,e.alg)}var s=[];return s.push(new o({name:e.alg})),s.push(new i({hex:n})),new r({array:s}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cades.OtherHashAlgAndValue,KJUR.asn1.ASN1Object),KJUR.asn1.cades.OtherHashValue=function(e){KJUR.asn1.cades.OtherHashValue.superclass.constructor.call(this);var t=Error,n=KJUR;n.lang.String.isHex;var r=n.asn1.DEROctetString;n.crypto.Util.hashHex,this.params=null,this.tohex=function(){var e=this.params;if(null==e.hash&&null==e.cert)throw new t("hash or cert not specified");var n=null;if(null!=e.hash)n=e.hash;else if(null!=e.cert){if("string"!=typeof e.cert)throw new t("cert not string");var i=e.cert;-1!=e.cert.indexOf("-----BEGIN")&&(i=pemtohex(e.cert)),n=KJUR.crypto.Util.hashHex(i,"sha1")}return new r({hex:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cades.OtherHashValue,KJUR.asn1.ASN1Object),KJUR.asn1.cades.SignatureTimeStamp=function(e){var t=Error,n=KJUR,r=n.lang.String.isHex,i=n.asn1,o=i.ASN1Object;i.x509,i.cades.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var e=this.params;if(null!=e.tst){if(r(e.tst))return(n=new o).hTLV=e.tst,[n];if(e.tst instanceof o)return[e.tst];throw new t("params.tst has wrong value")}if(null!=e.res){var n,i=e.res;if(i instanceof o&&(i=i.tohex()),"string"!=typeof i||!r(i))throw new t("params.res has wrong value");return ASN1HEX.getTLVbyList(i,0,[1]),(n=new o).hTLV=e.tst,[n]}},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cades.SignatureTimeStamp,KJUR.asn1.cms.Attribute),KJUR.asn1.cades.CompleteCertificateRefs=function(e){var t=Error,n=KJUR,r=n.asn1,i=r.DERSequence,o=r.cades,l=o.OtherCertID,s=n.lang.String.isHex;o.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var e=this.params,n=[],r=0;r<e.array.length;r++){var o=e.array[r];if("string"==typeof o)if(-1!=o.indexOf("-----BEGIN"))o={cert:o};else{if(!s(o))throw new t("unsupported value: "+o);o={hash:o}}null!=e.alg&&null==o.alg&&(o.alg=e.alg),null!=e.hasis&&null==o.hasis&&(o.hasis=e.hasis);var a=new l(o);n.push(a)}return[new i({array:n})]},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cades.CompleteCertificateRefs,KJUR.asn1.cms.Attribute),KJUR.asn1.cades.OtherCertID=function(e){var t=KJUR.asn1,n=t.DERSequence,r=t.cms.IssuerSerial,i=t.cades,o=i.OtherHashValue,l=i.OtherHashAlgAndValue;i.OtherCertID.superclass.constructor.call(this),this.params=e,this.tohex=function(){var e=this.params;"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?e={cert:e}:_isHex(e)&&(e={hash:e}));var t=[],i=null;if(i=null!=e.alg?new l(e):new o(e),t.push(i),null!=e.cert&&1==e.hasis||null!=e.issuer&&null!=e.serial){var s=new r(e);t.push(s)}return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cades.OtherCertID,KJUR.asn1.ASN1Object),KJUR.asn1.cades.OtherHash=function(e){var t=KJUR,n=t.asn1;n.cms;var r=n.cades,i=r.OtherHashAlgAndValue,o=r.OtherHashValue;t.crypto.Util.hashHex;var l=t.lang.String.isHex;r.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?e={cert:e}:l(e)&&(e={hash:e}));return(null!=e.alg?new i(e):new o(e)).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.cades.OtherHash,KJUR.asn1.ASN1Object),KJUR.asn1.cades.CAdESUtil=new function(){},KJUR.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(e){return(new KJUR.asn1.cms.CMSParser).getCMSSignedData(e)},KJUR.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(e,t,n){var r=ASN1HEX,i=r.getChildIdx,o=r.getTLV,l=r.getV,s=KJUR.asn1,a=s.ASN1Object,u=s.cms,c=u.AttributeList,h=u.SignerInfo,d={},f=i(e,t);if(6!=f.length)throw"not supported items for SignerInfo (!=6)";var p=f.shift();d.version=o(e,p);var g=f.shift();d.si=o(e,g);var w=f.shift();d.digalg=o(e,w);var m=f.shift();d.sattrs=o(e,m);var v=f.shift();d.sigalg=o(e,v);var y=f.shift();d.sig=o(e,y),d.sigval=l(e,y);var b=null;return d.obj=new h,(b=new a).hTLV=d.version,d.obj.dCMSVersion=b,(b=new a).hTLV=d.si,d.obj.dSignerIdentifier=b,(b=new a).hTLV=d.digalg,d.obj.dDigestAlgorithm=b,(b=new a).hTLV=d.sattrs,d.obj.dSignedAttrs=b,(b=new a).hTLV=d.sigalg,d.obj.dSigAlg=b,(b=new a).hTLV=d.sig,d.obj.dSig=b,d.obj.dUnsignedAttrs=new c,d},void 0!==KJUR.asn1.csr&&KJUR.asn1.csr||(KJUR.asn1.csr={}),KJUR.asn1.csr.CertificationRequest=function(e){var t=KJUR.asn1,n=t.DERBitString,r=t.DERSequence,i=t.csr;t.x509;var o=i.CertificationRequestInfo;i.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(e){this.params=e},this.sign=function(){var e=new o(this.params).tohex(),t=new KJUR.crypto.Signature({alg:this.params.sigalg});t.init(this.params.sbjprvkey),t.updateHex(e);var n=t.sign();this.params.sighex=n},this.getPEM=function(){return hextopem(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var e=this.params,t=new KJUR.asn1.csr.CertificationRequestInfo(this.params),i=new KJUR.asn1.x509.AlgorithmIdentifier({name:e.sigalg});if(null==e.sighex&&null!=e.sbjprvkey&&this.sign(),null==e.sighex)throw new Error("sighex or sbjprvkey parameter not defined");var o=new n({hex:"00"+e.sighex});return new r({array:[t,i,o]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.csr.CertificationRequest,KJUR.asn1.ASN1Object),KJUR.asn1.csr.CertificationRequestInfo=function(e){var t=KJUR.asn1;t.DERBitString;var n=t.DERSequence,r=t.DERInteger,i=t.DERUTF8String,o=t.DERTaggedObject,l=t.ASN1Util.newObject,s=t.csr,a=t.x509,u=a.X500Name,c=a.Extensions,h=a.SubjectPublicKeyInfo;s.AttributeList,s.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(e){null!=e&&(this.params=e)},this.tohex=function(){var e=this.params,t=[];if(t.push(new r({int:0})),t.push(new u(e.subject)),t.push(new h(KEYUTIL.getKey(e.sbjpubkey))),null!=e.attrs){var s=function(e){for(var t=Error,n=KJUR.asn1.x509.Extensions,r=[],i=0;i<e.length;i++){var o=e[i],l=o.attr;if("extensionRequest"==l){var s={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[new n(o.ext)]}]};r.push(s)}else if("unstructuredName"==l){s={seq:[{oid:"1.2.840.113549.1.9.2"},{set:o.names}]};r.push(s)}else{if("challengePassword"!=l)throw new t("unknown CSR attribute");s={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:o.password}]}]};r.push(s)}}return{set:r}}(e.attrs),a=l({tag:{tage:"a0",obj:s}});t.push(a)}else if(null!=e.extreq){var d=new c(e.extreq);a=l({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[d]}]}}});t.push(a)}else t.push(new o({tag:"a0",explicit:!1,obj:new i({str:""})}));return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=e&&this.setByParam(e)},extendClass(KJUR.asn1.csr.CertificationRequestInfo,KJUR.asn1.ASN1Object),KJUR.asn1.csr.AttributeList=function(e){},extendClass(KJUR.asn1.csr.AttributeList,KJUR.asn1.ASN1Object),KJUR.asn1.csr.CSRUtil=new function(){},KJUR.asn1.csr.CSRUtil.newCSRPEM=function(e){return new KJUR.asn1.csr.CertificationRequest(e).getPEM()},KJUR.asn1.csr.CSRUtil.getParam=function(e,t){var n=ASN1HEX,r=n.getV,i=n.getIdxbyList,o=n.getTLVbyList,l=n.getTLVbyListEx,s=n.getVbyListEx,a={};if(-1==e.indexOf("-----BEGIN CERTIFICATE REQUEST"))throw new Error("argument is not PEM file");var u=pemtohex(e,"CERTIFICATE REQUEST");t&&(a.tbs=o(u,0,[0]));try{var c=l(u,0,[0,1]);if("3000"==c)a.subject={};else{var h=new X509;a.subject=h.getX500Name(c)}}catch(e){}var d=l(u,0,[0,2]),f=KEYUTIL.getKey(d,null,"pkcs8pub");a.sbjpubkey=KEYUTIL.getPEM(f,"PKCS8PUB");var p=function(e){var t=i(e,0,[0,3,0,0],"06");return"2a864886f70d01090e"!=r(e,t)?null:o(e,0,[0,3,0,1,0],"30")}(u);h=new X509;null!=p&&(a.extreq=h.getExtParamArray(p));try{var g=l(u,0,[1],"30");h=new X509;a.sigalg=h.getAlgorithmIdentifierName(g)}catch(e){}try{var w=s(u,0,[2]);a.sighex=w}catch(e){}return a},KJUR.asn1.csr.CSRUtil.verifySignature=function(e){try{var t=null;if("string"==typeof e&&-1!=e.indexOf("-----BEGIN CERTIFICATE REQUEST")?t=KJUR.asn1.csr.CSRUtil.getParam(e,!0):"object"==typeof e&&null!=e.sbjpubkey&&null!=e.sigalg&&null!=e.sighex&&null!=e.tbs&&(t=e),null==t)return!1;var n=new KJUR.crypto.Signature({alg:t.sigalg});return n.init(t.sbjpubkey),n.updateHex(t.tbs),n.verify(t.sighex)}catch(e){return alert(e),!1}},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.asn1&&KJUR.asn1||(KJUR.asn1={}),void 0!==KJUR.asn1.ocsp&&KJUR.asn1.ocsp||(KJUR.asn1.ocsp={}),KJUR.asn1.ocsp.DEFAULT_HASH="sha1",KJUR.asn1.ocsp.OCSPResponse=function(e){KJUR.asn1.ocsp.OCSPResponse.superclass.constructor.call(this),KJUR.asn1.DEREnumerated;var t=KJUR.asn1.ASN1Util.newObject,n=KJUR.asn1.ocsp.ResponseBytes,r=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var e=this.params.resstatus;return"number"==typeof e?e:"string"!=typeof e?-1:r.indexOf(e)},this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params,r=this._getStatusCode();if(-1==r)throw new Error("responseStatus not supported: "+e.resstatus);if(0!=r)return t({seq:[{enum:{int:r}}]}).tohex();var i=new n(e);return t({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:i}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.OCSPResponse,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.ResponseBytes=function(e){KJUR.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERSequence,r=t.DERObjectIdentifier,i=t.DEROctetString,o=t.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(e){this.params=e},this.tohex=function(){var e=this.params;if("ocspBasic"!=e.restype)throw new Error("not supported responseType: "+e.restype);var t=new o(e),l=[];return l.push(new r({name:"ocspBasic"})),l.push(new i({hex:t.tohex()})),new n({array:l}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.ResponseBytes,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.BasicOCSPResponse=function(e){KJUR.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var t=Error,n=KJUR.asn1,r=n.ASN1Object,i=n.DERSequence;n.DERGeneralizedTime;var o=n.DERTaggedObject,l=n.DERBitString;n.x509.Extensions;var s=n.x509.AlgorithmIdentifier,a=n.ocsp;a.ResponderID,_SingleResponseList=a.SingleResponseList,_ResponseData=a.ResponseData,this.params=null,this.setByParam=function(e){this.params=e},this.sign=function(){var e=this.params,t=e.tbsresp.tohex(),n=new KJUR.crypto.Signature({alg:e.sigalg});n.init(e.reskey),n.updateHex(t),e.sighex=n.sign()},this.tohex=function(){var e=this.params;null==e.tbsresp&&(e.tbsresp=new _ResponseData(e)),null==e.sighex&&null!=e.reskey&&this.sign();var n=[];if(n.push(e.tbsresp),n.push(new s({name:e.sigalg})),n.push(new l({hex:"00"+e.sighex})),null!=e.certs&&null!=e.certs.length){for(var a=[],u=0;u<e.certs.length;u++){var c=e.certs[u],h=null;if(ASN1HEX.isASN1HEX(c))h=c;else{if(!c.match(/-----BEGIN/))throw new t("certs["+u+"] not hex or PEM");h=pemtohex(c)}a.push(new r({tlv:h}))}var d=new i({array:a});n.push(new o({tag:"a0",explicit:!0,obj:d}))}return new i({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.BasicOCSPResponse,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.ResponseData=function(e){KJUR.asn1.ocsp.ResponseData.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERSequence,r=t.DERGeneralizedTime,i=t.DERTaggedObject,o=t.x509.Extensions,l=t.ocsp,s=l.ResponderID;_SingleResponseList=l.SingleResponseList,this.params=null,this.tohex=function(){var e=this.params;e.respid,e.prodat,e.array;var t=[];if(t.push(new s(e.respid)),t.push(new r(e.prodat)),t.push(new _SingleResponseList(e.array)),null!=e.ext){var l=new o(e.ext);t.push(new i({tag:"a1",explicit:!0,obj:l}))}return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.ResponseData,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.ResponderID=function(e){KJUR.asn1.ocsp.ResponderID.superclass.constructor.call(this);var t=KJUR,n=t.asn1,r=n.ASN1Util.newObject,i=n.x509.X500Name,o=t.lang.String.isHex,l=Error;this.params=null,this.tohex=function(){var e=this.params;if(null!=e.key){var t,n=null;if("string"==typeof e.key){if(o(e.key)&&(n=e.key),e.key.match(/-----BEGIN CERTIFICATE/))null!=(t=new X509(e.key).getExtSubjectKeyIdentifier())&&(n=t.kid.hex)}else if(e.key instanceof X509)null!=(t=e.key.getExtSubjectKeyIdentifier())&&(n=t.kid.hex);if(null==n)throw new l("wrong key member value");return r({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:n}}}}).tohex()}if(null!=e.name){var s=null;if("string"==typeof e.name&&e.name.match(/-----BEGIN CERTIFICATE/))s=new X509(e.name).getSubject();else e.name instanceof X509?s=e.name.getSubject():"object"!=typeof e.name||null==e.name.array&&null==e.name.str||(s=e.name);if(null==s)throw new l("wrong name member value");return r({tag:{tag:"a1",explicit:!0,obj:new i(s)}}).tohex()}throw new l("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.ResponderID,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.SingleResponseList=function(e){KJUR.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var t=KJUR.asn1,n=t.DERSequence,r=t.ocsp.SingleResponse;this.params=null,this.tohex=function(){var e=this.params;if("object"!=typeof e||null==e.length)throw new Error("params not specified properly");for(var t=[],i=0;i<e.length;i++)t.push(new r(e[i]));return new n({array:t}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.SingleResponseList,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.SingleResponse=function(e){var t=Error,n=KJUR.asn1,r=n.DERSequence,i=n.DERGeneralizedTime,o=n.DERTaggedObject,l=n.ocsp,s=l.CertID,a=l.CertStatus,u=n.x509.Extensions;l.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params,n=[];if(null==e.certid)throw new t("certid unspecified");if(null==e.status)throw new t("status unspecified");if(null==e.thisupdate)throw new t("thisupdate unspecified");if(n.push(new s(e.certid)),n.push(new a(e.status)),n.push(new i(e.thisupdate)),null!=e.nextupdate){var l=new i(e.nextupdate);n.push(new o({tag:"a0",explicit:!0,obj:l}))}if(null!=e.ext){var c=new u(e.ext);n.push(new o({tag:"a1",explicit:!0,obj:c}))}return new r({array:n}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.SingleResponse,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.CertID=function(e){var t=KJUR,n=t.asn1,r=n.DEROctetString,i=n.DERInteger,o=n.DERSequence,l=n.x509.AlgorithmIdentifier,s=n.ocsp;s.DEFAULT_HASH;var a=t.crypto.Util.hashHex,u=X509,c=ASN1HEX.getVbyList;s.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(e,t,n,r){null==r&&(r=this.DEFAULT_HASH),this.params={alg:r,issname:e,isskey:t,sbjsn:n}},this.setByCert=function(e,t,n){null==n&&(n=this.DEFAULT_HASH),this.params={alg:n,issuerCert:e,subjectCert:t}},this.getParamByCerts=function(e,t,n){null==n&&(n=this.DEFAULT_HASH);var r=new u(e),i=new u(t),o=a(r.getSubjectHex(),n),l=r.getPublicKeyHex();return{alg:n,issname:o,isskey:a(c(l,0,[1],"03",!0),n),sbjsn:i.getSerialNumberHex()}},this.tohex=function(){if("object"!=typeof this.params)throw new Error("params not set");var e,t,n,s,a=this.params;if(s=null==a.alg?this.DEFAULT_HASH:a.alg,null!=a.issuerCert&&null!=a.subjectCert){var u=this.getParamByCerts(a.issuerCert,a.subjectCert,s);e=u.issname,t=u.isskey,n=u.sbjsn}else{if(null==a.issname||null==a.isskey||null==a.sbjsn)throw new Error("required param members not defined");e=a.issname,t=a.isskey,n=a.sbjsn}var c=new l({name:s}),h=new r({hex:e}),d=new r({hex:t}),f=new i({hex:n}),p=new o({array:[c,h,d,f]});return this.hTLV=p.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.CertID,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.CertStatus=function(e){KJUR.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var e=this.params;if("good"==e.status)return"8000";if("unknown"==e.status)return"8200";if("revoked"==e.status){var t=[{gentime:{str:e.time}}];null!=e.reason&&t.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:e.reason}}}});var n={tag:"a1",explicit:!1,obj:{seq:t}};return KJUR.asn1.ASN1Util.newObject({tag:n}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(e){this.params=e},void 0!==e&&this.setByParam(e)},extendClass(KJUR.asn1.ocsp.CertStatus,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.Request=function(e){var t=KJUR.asn1,n=t.DERSequence,r=t.ocsp;if(r.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var e=[];if(null===this.dReqCert)throw"reqCert not set";e.push(this.dReqCert);var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e){var i=new r.CertID(e);this.dReqCert=i}},extendClass(KJUR.asn1.ocsp.Request,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.TBSRequest=function(e){var t=KJUR.asn1,n=t.DERSequence,r=t.ocsp;r.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(e){for(var t=[],n=0;n<e.length;n++){var i=new r.Request(e[0]);t.push(i)}this.dRequestList=t},this.tohex=function(){var e=[];if(0!==this.version)throw"not supported version: "+this.version;if(null!==this.dRequestorName)throw"requestorName not supported";var t=new n({array:this.dRequestList});if(e.push(t),null!==this.dRequestExt)throw"requestExtensions not supported";var r=new n({array:e});return this.hTLV=r.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList&&this.setRequestListByParam(e.reqList)},extendClass(KJUR.asn1.ocsp.TBSRequest,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.OCSPRequest=function(e){var t=KJUR.asn1,n=t.DERSequence,r=t.ocsp;if(r.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var e=[];if(null===this.dTbsRequest)throw"tbsRequest not set";if(e.push(this.dTbsRequest),null!==this.dOptionalSignature)throw"optionalSignature not supported";var t=new n({array:e});return this.hTLV=t.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==e&&void 0!==e.reqList){var i=new r.TBSRequest(e);this.dTbsRequest=i}},extendClass(KJUR.asn1.ocsp.OCSPRequest,KJUR.asn1.ASN1Object),KJUR.asn1.ocsp.OCSPUtil={},KJUR.asn1.ocsp.OCSPUtil.getRequestHex=function(e,t,n){var r=KJUR.asn1.ocsp;void 0===n&&(n=r.DEFAULT_HASH);var i={alg:n,issuerCert:e,subjectCert:t};return new r.OCSPRequest({reqList:[i]}).tohex()},KJUR.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(e){var t=ASN1HEX,n=t.getVbyList,r=t.getVbyListEx,i=t.getIdxbyList;t.getIdxbyListEx;var o=t.getV,l={};try{var s=r(e,0,[0],"0a");l.responseStatus=parseInt(s,16)}catch(e){}if(0!==l.responseStatus)return l;try{var a=i(e,0,[1,0,1,0,0,2,0,1]);"80"===e.substr(a,2)?l.certStatus="good":"a1"===e.substr(a,2)?(l.certStatus="revoked",l.revocationTime=hextoutf8(n(e,a,[0]))):"82"===e.substr(a,2)&&(l.certStatus="unknown")}catch(e){}try{var u=i(e,0,[1,0,1,0,0,2,0,2]);l.thisUpdate=hextoutf8(o(e,u))}catch(e){}try{var c=i(e,0,[1,0,1,0,0,2,0,3]);"a0"===e.substr(c,2)&&(l.nextUpdate=hextoutf8(n(e,c,[0])))}catch(e){}return l},KJUR.asn1.ocsp.OCSPParser=function(){var e=Error,t=X509,n=new t,r=ASN1HEX,i=r.getV,o=r.getTLV,l=r.getIdxbyList,s=r.getVbyList,a=r.getTLVbyList,u=r.getVbyListEx,c=r.getTLVbyListEx,h=r.getChildIdx;this.getOCSPRequest=function(t){var n=h(t,0);if(1!=n.length&&2!=n.length)throw new e("wrong number elements: "+n.length);return this.getTBSRequest(o(t,n[0]))},this.getTBSRequest=function(e){var t={},r=c(e,0,[0],"30");t.array=this.getRequestList(r);var i=c(e,0,["[2]",0],"30");return null!=i&&(t.ext=n.getExtParamArray(i)),t},this.getRequestList=function(e){for(var t=[],n=h(e,0),r=0;r<n.length;r++){e=o(e,n[r]);t.push(this.getRequest(e))}return t},this.getRequest=function(t){var r=h(t,0);if(1!=r.length&&2!=r.length)throw new e("wrong number elements: "+r.length);var i=this.getCertID(o(t,r[0]));if(2==r.length){var s=l(t,0,[1,0]);i.ext=n.getExtParamArray(o(t,s))}return i},this.getCertID=function(n){var r=h(n,0);if(4!=r.length)throw new e("wrong number elements: "+r.length);var l=new t,s={};return s.alg=l.getAlgorithmIdentifierName(o(n,r[0])),s.issname=i(n,r[1]),s.isskey=i(n,r[2]),s.sbjsn=i(n,r[3]),s},this.getOCSPResponse=function(e){var t,n=h(e,0),r=i(e,n[0]),o=parseInt(r);if(1==n.length)return{resstatus:o};var l=a(e,0,[1,0]);return(t=this.getResponseBytes(l)).resstatus=o,t},this.getResponseBytes=function(e){var t,n=h(e,0),r=a(e,0,[1,0]);t=this.getBasicOCSPResponse(r);var o=i(e,n[0]);return t.restype=KJUR.asn1.x509.OID.oid2name(hextooid(o)),t},this.getBasicOCSPResponse=function(e){var t,n=h(e,0);t=this.getResponseData(o(e,n[0]));var r=new X509;t.alg=r.getAlgorithmIdentifierName(o(e,n[1]));var l=i(e,n[2]);t.sighex=l.substr(2);var s=u(e,0,["[0]"]);if(null!=s){for(var a=h(s,0),c=[],d=0;d<a.length;d++){var f=o(s,a[d]);c.push(f)}t.certs=c}return t},this.getResponseData=function(e){var t=h(e,0),n=t.length,r={},l=0;"a0"==e.substr(t[0],2)&&l++,r.respid=this.getResponderID(o(e,t[l++]));var s=i(e,t[l++]);if(r.prodat=hextoutf8(s),r.array=this.getSingleResponseList(o(e,t[l++])),"a1"==e.substr(t[n-1],2)){var u=a(e,t[n-1],[0]),c=new X509;r.ext=c.getExtParamArray(u)}return r},this.getResponderID=function(e){var t={};if("a2"==e.substr(0,2)){var n=s(e,0,[0]);t.key=n}if("a1"==e.substr(0,2)){var r=a(e,0,[0]),i=new X509;t.name=i.getX500Name(r)}return t},this.getSingleResponseList=function(e){for(var t=h(e,0),n=[],r=0;r<t.length;r++){var i=this.getSingleResponse(o(e,t[r]));n.push(i)}return n},this.getSingleResponse=function(e){var t=h(e,0),n={},r=this.getCertID(o(e,t[0]));n.certid=r;var l=this.getCertStatus(o(e,t[1]));if(n.status=l,"18"==e.substr(t[2],2)){var u=i(e,t[2]);n.thisupdate=hextoutf8(u)}for(var c=3;c<t.length;c++){if("a0"==e.substr(t[c],2)){var d=s(e,t[c],[0],"18");n.nextupdate=hextoutf8(d)}if("a1"==e.substr(t[c],2)){var f=new X509,p=a(e,0,[c,0]);n.ext=f.getExtParamArray(p)}}return n},this.getCertStatus=function(e){var t={};if("8000"==e)return{status:"good"};if("8200"==e)return{status:"unknown"};if("a1"==e.substr(0,2)){t.status="revoked";var n=hextoutf8(s(e,0,[0]));t.time=n}return t}},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.lang&&KJUR.lang||(KJUR.lang={}),KJUR.lang.String=function(){},"function"==typeof Buffer?(utf8tob64u=function(e){return b64tob64u(Buffer.from(e,"utf8").toString("base64"))},b64utoutf8=function(e){return Buffer.from(b64utob64(e),"base64").toString("utf8")}):(utf8tob64u=function(e){return hextob64u(uricmptohex(encodeURIComponentAll(e)))},b64utoutf8=function(e){return decodeURIComponent(hextouricmp(b64utohex(e)))}),KJUR.lang.String.isInteger=function(e){return!!e.match(/^[0-9]+$/)||!!e.match(/^-[0-9]+$/)},KJUR.lang.String.isHex=function(e){return ishex(e)},KJUR.lang.String.isBase64=function(e){return!(!(e=e.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||e.length%4!=0)},KJUR.lang.String.isBase64URL=function(e){return!e.match(/[+/=]/)&&(e=b64utob64(e),KJUR.lang.String.isBase64(e))},KJUR.lang.String.isIntegerArray=function(e){return!!(e=e.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},KJUR.lang.String.isPrintable=function(e){return null!==e.match(/^[0-9A-Za-z '()+,-./:=?]*$/)},KJUR.lang.String.isIA5=function(e){return null!==e.match(/^[\x20-\x21\x23-\x7f]*$/)},KJUR.lang.String.isMail=function(e){return null!==e.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)};var strpad=function(e,t,n){return null==n&&(n="0"),e.length>=t?e:new Array(t-e.length+1).join(n)+e};function bitstrtoint(e){if(e.length%2!=0)return-1;if(null==(e=e.toLowerCase()).match(/^[0-9a-f]+$/))return-1;try{var t=e.substr(0,2);if("00"==t)return parseInt(e.substr(2),16);var n=parseInt(t,16);if(n>7)return-1;var r=e.substr(2),i=parseInt(r,16).toString(2);"0"==i&&(i="00000000"),i=i.slice(0,0-n);var o=parseInt(i,2);return NaN==o?-1:o}catch(e){return-1}}function bitstrtobinstr(e){if("string"!=typeof e)return null;if(e.length%2!=0)return null;if(!e.match(/^[0-9a-f]+$/))return null;try{var t=parseInt(e.substr(0,2),16);if(t<0||7<t)return null;for(var n=e.substr(2),r="",i=0;i<n.length;i+=2){var o=n.substr(i,2),l=parseInt(o,16).toString(2);r+=l=("0000000"+l).slice(-8)}return r.substr(0,r.length-t)}catch(e){return null}}function namearraytobinstr(e,t){for(var n=0,r=0;r<e.length;r++)n|=1<<t[e[r]];var i=n.toString(2),o="";for(r=i.length-1;r>=0;r--)o+=i[r];return o}function aryval(e,t,n){if("object"==typeof e){t=String(t).split(".");for(var r=0;r<t.length&&e;r++){var i=t[r];i.match(/^[0-9]+$/)&&(i=parseInt(i)),e=e[i]}return e||!1===e?e:n}}function extendClass(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)}void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:CryptoJS.algo.MD5,sha1:CryptoJS.algo.SHA1,sha224:CryptoJS.algo.SHA224,sha256:CryptoJS.algo.SHA256,sha384:CryptoJS.algo.SHA384,sha512:CryptoJS.algo.SHA512,ripemd160:CryptoJS.algo.RIPEMD160},this.getDigestInfoHex=function(e,t){if(void 0===this.DIGESTINFOHEAD[t])throw"alg not supported in Util.DIGESTINFOHEAD: "+t;return this.DIGESTINFOHEAD[t]+e},this.getPaddedDigestInfoHex=function(e,t,n){var r=this.getDigestInfoHex(e,t),i=n/4;if(r.length+22>i)throw"key is too short for SigAlg: keylen="+n+","+t;for(var o="0001",l="00"+r,s="",a=i-4-l.length,u=0;u<a;u+=2)s+="ff";return o+s+l},this.hashString=function(e,t){return new KJUR.crypto.MessageDigest({alg:t}).digestString(e)},this.hashHex=function(e,t){return new KJUR.crypto.MessageDigest({alg:t}).digestHex(e)},this.sha1=function(e){return this.hashString(e,"sha1")},this.sha256=function(e){return this.hashString(e,"sha256")},this.sha256Hex=function(e){return this.hashHex(e,"sha256")},this.sha512=function(e){return this.hashString(e,"sha512")},this.sha512Hex=function(e){return this.hashHex(e,"sha512")},this.isKey=function(e){return e instanceof RSAKey||e instanceof KJUR.crypto.DSA||e instanceof KJUR.crypto.ECDSA}},KJUR.crypto.Util.md5=function(e){return new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(e)},KJUR.crypto.Util.ripemd160=function(e){return new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(e)},KJUR.crypto.Util.SECURERANDOMGEN=new SecureRandom,KJUR.crypto.Util.getRandomHexOfNbytes=function(e){var t=new Array(e);return KJUR.crypto.Util.SECURERANDOMGEN.nextBytes(t),BAtohex(t)},KJUR.crypto.Util.getRandomBigIntegerOfNbytes=function(e){return new BigInteger(KJUR.crypto.Util.getRandomHexOfNbytes(e),16)},KJUR.crypto.Util.getRandomHexOfNbits=function(e){var t=e%8,n=new Array((e-t)/8+1);return KJUR.crypto.Util.SECURERANDOMGEN.nextBytes(n),n[0]=(255<<t&255^255)&n[0],BAtohex(n)},KJUR.crypto.Util.getRandomBigIntegerOfNbits=function(e){return new BigInteger(KJUR.crypto.Util.getRandomHexOfNbits(e),16)},KJUR.crypto.Util.getRandomBigIntegerZeroToMax=function(e){for(var t=e.bitLength();;){var n=KJUR.crypto.Util.getRandomBigIntegerOfNbits(t);if(-1!=e.compareTo(n))return n}},KJUR.crypto.Util.getRandomBigIntegerMinToMax=function(e,t){var n=e.compareTo(t);if(1==n)throw"biMin is greater than biMax";if(0==n)return e;var r=t.subtract(e);return KJUR.crypto.Util.getRandomBigIntegerZeroToMax(r).add(e)},KJUR.crypto.MessageDigest=function(e){this.setAlgAndProvider=function(e,t){if(null!==(e=KJUR.crypto.MessageDigest.getCanonicalAlgName(e))&&void 0===t&&(t=KJUR.crypto.Util.DEFAULTPROVIDER[e]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)&&"cryptojs"==t){try{this.md=KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(t){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+t}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=CryptoJS.enc.Hex.parse(e);this.md.update(t)},this.digest=function(){return this.md.finalize().toString(CryptoJS.enc.Hex)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}if(-1!=":sha256:".indexOf(e)&&"sjcl"==t){try{this.md=new sjcl.hash.sha256}catch(t){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+t}this.updateString=function(e){this.md.update(e)},this.updateHex=function(e){var t=sjcl.codec.hex.toBits(e);this.md.update(t)},this.digest=function(){var e=this.md.finalize();return sjcl.codec.hex.fromBits(e)},this.digestString=function(e){return this.updateString(e),this.digest()},this.digestHex=function(e){return this.updateHex(e),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==e&&void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},KJUR.crypto.MessageDigest.getCanonicalAlgName=function(e){return"string"==typeof e&&(e=(e=e.toLowerCase()).replace(/-/,"")),e},KJUR.crypto.MessageDigest.getHashLength=function(e){var t=KJUR.crypto.MessageDigest,n=t.getCanonicalAlgName(e);if(void 0===t.HASHLENGTH[n])throw"not supported algorithm: "+e;return t.HASHLENGTH[n]},KJUR.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},KJUR.crypto.Mac=function(e){this.setAlgAndProvider=function(e,t){if(null==(e=e.toLowerCase())&&(e="hmacsha1"),"hmac"!=(e=e.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+e;void 0===t&&(t=KJUR.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+t;var n=e.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(n)&&"cryptojs"==t){try{var r=KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[n];this.mac=CryptoJS.algo.HMAC.create(r,this.pass)}catch(e){throw"setAlgAndProvider hash alg set fail hashAlg="+n+"/"+e}this.updateString=function(e){this.mac.update(e)},this.updateHex=function(e){var t=CryptoJS.enc.Hex.parse(e);this.mac.update(t)},this.doFinal=function(){return this.mac.finalize().toString(CryptoJS.enc.Hex)},this.doFinalString=function(e){return this.updateString(e),this.doFinal()},this.doFinalHex=function(e){return this.updateHex(e),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if("string"==typeof e){var t=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(t=rstrtohex(e)),void(this.pass=CryptoJS.enc.Hex.parse(t))}if("object"!=typeof e)throw"KJUR.crypto.Mac unsupported password type: "+e;t=null;if(void 0!==e.hex){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;t=e.hex}if(void 0!==e.utf8&&(t=utf8tohex(e.utf8)),void 0!==e.rstr&&(t=rstrtohex(e.rstr)),void 0!==e.b64&&(t=b64tohex(e.b64)),void 0!==e.b64u&&(t=b64utohex(e.b64u)),null==t)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=CryptoJS.enc.Hex.parse(t)},void 0!==e&&(void 0!==e.pass&&this.setPassword(e.pass),void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},KJUR.crypto.Signature=function(e){var t=null;if(this._setAlgNames=function(){var e=this.algName.match(/^(.+)with(.+)$/);e&&(this.mdAlgName=e[1].toLowerCase(),this.pubkeyAlgName=e[2].toLowerCase(),"rsaandmgf1"==this.pubkeyAlgName&&"sha"==this.mdAlgName&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(e,t){for(var n="",r=t/4-e.length,i=0;i<r;i++)n+="0";return n+e},this.setAlgAndProvider=function(e,t){if(this._setAlgNames(),"cryptojs/jsrsa"!=t)throw new Error("provider not supported: "+t);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(e){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+e)}this.init=function(e,t){var n=null;try{n=void 0===t?KEYUTIL.getKey(e):KEYUTIL.getKey(e,t)}catch(e){throw"init failed:"+e}if(!0===n.isPrivate)this.prvKey=n,this.state="SIGN";else{if(!0!==n.isPublic)throw"init failed.:"+n;this.pubKey=n,this.state="VERIFY"}},this.updateString=function(e){this.md.updateString(e)},this.updateHex=function(e){this.md.updateHex(e)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0===this.prvKey&&void 0!==this.ecprvhex&&void 0!==this.eccurvename&&void 0!==KJUR.crypto.ECDSA&&(this.prvKey=new KJUR.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof RSAKey&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof RSAKey&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof KJUR.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof KJUR.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(e){return this.updateString(e),this.sign()},this.signHex=function(e){return this.updateHex(e),this.sign()},this.verify=function(e){if(this.sHashHex=this.md.digest(),void 0===this.pubKey&&void 0!==this.ecpubhex&&void 0!==this.eccurvename&&void 0!==KJUR.crypto.ECDSA&&(this.pubKey=new KJUR.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof RSAKey&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,e,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof RSAKey&&"rsa"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==KJUR.crypto.ECDSA&&this.pubKey instanceof KJUR.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);if(void 0!==KJUR.crypto.DSA&&this.pubKey instanceof KJUR.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,e);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(e,t){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(e){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(e){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(e){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(e){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=e,void 0!==e&&(void 0!==e.alg&&(this.algName=e.alg,void 0===e.prov?this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=e.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==e.psssaltlen&&(this.pssSaltLen=e.psssaltlen),void 0!==e.prvkeypem)){if(void 0!==e.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{t=KEYUTIL.getKey(e.prvkeypem);this.init(t)}catch(e){throw"fatal error to load pem private key: "+e}}},KJUR.crypto.Cipher=function(e){},KJUR.crypto.Cipher.encrypt=function(e,t,n){if(t instanceof RSAKey&&t.isPublic){var r=KJUR.crypto.Cipher.getAlgByKeyAndName(t,n);if("RSA"===r)return t.encrypt(e);if("RSAOAEP"===r)return t.encryptOAEP(e,"sha1");var i=r.match(/^RSAOAEP(\d+)$/);if(null!==i)return t.encryptOAEP(e,"sha"+i[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.encrypt: unsupported key or algorithm"},KJUR.crypto.Cipher.decrypt=function(e,t,n){if(t instanceof RSAKey&&t.isPrivate){var r=KJUR.crypto.Cipher.getAlgByKeyAndName(t,n);if("RSA"===r)return t.decrypt(e);if("RSAOAEP"===r)return t.decryptOAEP(e,"sha1");var i=r.match(/^RSAOAEP(\d+)$/);if(null!==i)return t.decryptOAEP(e,"sha"+i[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+n}throw"Cipher.decrypt: unsupported key or algorithm"},KJUR.crypto.Cipher.getAlgByKeyAndName=function(e,t){if(e instanceof RSAKey){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(t))return t;if(null==t)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+t}throw"getAlgByKeyAndName: not supported algorithm name: "+t},KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.ECDSA=function(e){var t=Error,n=BigInteger,r=ECPointFp,i=KJUR.crypto.ECDSA,o=KJUR.crypto.ECParameterDB,l=i.getName,s=ASN1HEX,a=s.getVbyListEx,u=s.isASN1HEX,c=new SecureRandom;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(e){return new n(e.bitLength(),c).mod(e.subtract(n.ONE)).add(n.ONE)},this.setNamedCurve=function(e){this.ecparams=o.getByName(e),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=e},this.setPrivateKeyHex=function(e){this.isPrivate=!0,this.prvKeyHex=e},this.setPublicKeyHex=function(e){this.isPublic=!0,this.pubKeyHex=e},this.getPublicKeyXYHex=function(){var e=this.pubKeyHex;if("04"!==e.substr(0,2))throw"this method supports uncompressed format(04) only";var t=this.ecparams.keycharlen;if(e.length!==2+2*t)throw"malformed public key hex length";var n={};return n.x=e.substr(2,t),n.y=e.substr(2+t),n},this.getShortNISTPCurveName=function(){var e=this.curveName;return"secp256r1"===e||"NIST P-256"===e||"P-256"===e||"prime256v1"===e?"P-256":"secp384r1"===e||"NIST P-384"===e||"P-384"===e?"P-384":"secp521r1"===e||"NIST P-521"===e||"P-521"===e?"P-521":null},this.generateKeyPairHex=function(){var e=this.ecparams.n,t=this.getBigRandom(e),n=this.ecparams.keycharlen,r=("0000000000"+t.toString(16)).slice(-n);return this.setPrivateKeyHex(r),{ecprvhex:r,ecpubhex:this.generatePublicKeyHex()}},this.generatePublicKeyHex=function(){var e=new n(this.prvKeyHex,16),t=this.ecparams.G.multiply(e),r=t.getX().toBigInteger(),i=t.getY().toBigInteger(),o=this.ecparams.keycharlen,l="04"+("0000000000"+r.toString(16)).slice(-o)+("0000000000"+i.toString(16)).slice(-o);return this.setPublicKeyHex(l),l},this.signWithMessageHash=function(e){return this.signHex(e,this.prvKeyHex)},this.signHex=function(e,t){var r=new n(t,16),o=this.ecparams.n,l=new n(e.substring(0,this.ecparams.keycharlen),16);do{var s=this.getBigRandom(o),a=this.ecparams.G.multiply(s).getX().toBigInteger().mod(o)}while(a.compareTo(n.ZERO)<=0);var u=s.modInverse(o).multiply(l.add(r.multiply(a))).mod(o);return i.biRSSigToASN1Sig(a,u)},this.sign=function(e,t){var r=t,i=this.ecparams.n,o=n.fromByteArrayUnsigned(e);do{var l=this.getBigRandom(i),s=this.ecparams.G.multiply(l).getX().toBigInteger().mod(i)}while(s.compareTo(BigInteger.ZERO)<=0);var a=l.modInverse(i).multiply(o.add(r.multiply(s))).mod(i);return this.serializeSig(s,a)},this.verifyWithMessageHash=function(e,t){return this.verifyHex(e,t,this.pubKeyHex)},this.verifyHex=function(e,t,o){try{var l,s,a=i.parseSigHex(t);l=a.r,s=a.s;var u=r.decodeFromHex(this.ecparams.curve,o),c=new n(e.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(c,l,s,u)}catch(e){return!1}},this.verify=function(e,t,i){var o,l,s;if(Bitcoin.Util.isArray(t)){var a=this.parseSig(t);o=a.r,l=a.s}else{if("object"!=typeof t||!t.r||!t.s)throw"Invalid value for signature";o=t.r,l=t.s}if(i instanceof ECPointFp)s=i;else{if(!Bitcoin.Util.isArray(i))throw"Invalid format for pubkey value, must be byte array or ECPointFp";s=r.decodeFrom(this.ecparams.curve,i)}var u=n.fromByteArrayUnsigned(e);return this.verifyRaw(u,o,l,s)},this.verifyRaw=function(e,t,r,i){var o=this.ecparams.n,l=this.ecparams.G;if(t.compareTo(n.ONE)<0||t.compareTo(o)>=0)return!1;if(r.compareTo(n.ONE)<0||r.compareTo(o)>=0)return!1;var s=r.modInverse(o),a=e.multiply(s).mod(o),u=t.multiply(s).mod(o);return l.multiply(a).add(i.multiply(u)).getX().toBigInteger().mod(o).equals(t)},this.serializeSig=function(e,t){var n=e.toByteArraySigned(),r=t.toByteArraySigned(),i=[];return i.push(2),i.push(n.length),(i=i.concat(n)).push(2),i.push(r.length),(i=i.concat(r)).unshift(i.length),i.unshift(48),i},this.parseSig=function(e){var t;if(48!=e[0])throw new Error("Signature not a valid DERSequence");if(2!=e[t=2])throw new Error("First element in signature must be a DERInteger");var r=e.slice(t+2,t+2+e[t+1]);if(2!=e[t+=2+e[t+1]])throw new Error("Second element in signature must be a DERInteger");var i=e.slice(t+2,t+2+e[t+1]);return t+=2+e[t+1],{r:n.fromByteArrayUnsigned(r),s:n.fromByteArrayUnsigned(i)}},this.parseSigCompact=function(e){if(65!==e.length)throw"Signature has the wrong length";var t=e[0]-27;if(t<0||t>7)throw"Invalid signature type";var r=this.ecparams.n;return{r:n.fromByteArrayUnsigned(e.slice(1,33)).mod(r),s:n.fromByteArrayUnsigned(e.slice(33,65)).mod(r),i:t}},this.readPKCS5PrvKeyHex=function(e){if(!1===u(e))throw new Error("not ASN.1 hex string");var t,n,r;try{t=a(e,0,["[0]",0],"06"),n=a(e,0,[1],"04");try{r=a(e,0,["[1]",0],"03")}catch(e){}}catch(e){throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=l(t),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(r),this.setPrivateKeyHex(n),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(e){if(!1===u(e))throw new t("not ASN.1 hex string");var n,r,i;try{a(e,0,[1,0],"06"),n=a(e,0,[1,1],"06"),r=a(e,0,[2,0,1],"04");try{i=a(e,0,[2,0,"[1]",0],"03")}catch(e){}}catch(e){throw new t("malformed PKCS#8 plain ECC private key")}if(this.curveName=l(n),void 0===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(i),this.setPrivateKeyHex(r),this.isPublic=!1},this.readPKCS8PubKeyHex=function(e){if(!1===u(e))throw new t("not ASN.1 hex string");var n,r;try{a(e,0,[0,0],"06"),n=a(e,0,[0,1],"06"),r=a(e,0,[1],"03")}catch(e){throw new t("malformed PKCS#8 ECC public key")}if(this.curveName=l(n),null===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(r)},this.readCertPubKeyHex=function(e,n){if(!1===u(e))throw new t("not ASN.1 hex string");var r,i;try{r=a(e,0,[0,5,0,1],"06"),i=a(e,0,[0,5,1],"03")}catch(e){throw new t("malformed X.509 certificate ECC public key")}if(this.curveName=l(r),null===this.curveName)throw new t("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(i)},void 0!==e&&void 0!==e.curve&&(this.curveName=e.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==e&&(void 0!==e.prv&&this.setPrivateKeyHex(e.prv),void 0!==e.pub&&this.setPublicKeyHex(e.pub))},KJUR.crypto.ECDSA.parseSigHex=function(e){var t=KJUR.crypto.ECDSA.parseSigHexInHexRS(e);return{r:new BigInteger(t.r,16),s:new BigInteger(t.s,16)}},KJUR.crypto.ECDSA.parseSigHexInHexRS=function(e){var t=ASN1HEX,n=t.getChildIdx,r=t.getV;if(t.checkStrictDER(e,0),"30"!=e.substr(0,2))throw new Error("signature is not a ASN.1 sequence");var i=n(e,0);if(2!=i.length)throw new Error("signature shall have two elements");var o=i[0],l=i[1];if("02"!=e.substr(o,2))throw new Error("1st item not ASN.1 integer");if("02"!=e.substr(l,2))throw new Error("2nd item not ASN.1 integer");return{r:r(e,o),s:r(e,l)}},KJUR.crypto.ECDSA.asn1SigToConcatSig=function(e){var t=KJUR.crypto.ECDSA.parseSigHexInHexRS(e),n=t.r,r=t.s;if(n.length>=130&&n.length<=134){if(n.length%2!=0)throw Error("unknown ECDSA sig r length error");if(r.length%2!=0)throw Error("unknown ECDSA sig s length error");"00"==n.substr(0,2)&&(n=n.substr(2)),"00"==r.substr(0,2)&&(r=r.substr(2));var i=Math.max(n.length,r.length);return(n=("000000"+n).slice(-i))+(r=("000000"+r).slice(-i))}if("00"==n.substr(0,2)&&n.length%32==2&&(n=n.substr(2)),"00"==r.substr(0,2)&&r.length%32==2&&(r=r.substr(2)),n.length%32==30&&(n="00"+n),r.length%32==30&&(r="00"+r),n.length%32!=0)throw Error("unknown ECDSA sig r length error");if(r.length%32!=0)throw Error("unknown ECDSA sig s length error");return n+r},KJUR.crypto.ECDSA.concatSigToASN1Sig=function(e){if(e.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var t=e.substr(0,e.length/2),n=e.substr(e.length/2);return KJUR.crypto.ECDSA.hexRSSigToASN1Sig(t,n)},KJUR.crypto.ECDSA.hexRSSigToASN1Sig=function(e,t){var n=new BigInteger(e,16),r=new BigInteger(t,16);return KJUR.crypto.ECDSA.biRSSigToASN1Sig(n,r)},KJUR.crypto.ECDSA.biRSSigToASN1Sig=function(e,t){var n=KJUR.asn1,r=new n.DERInteger({bigint:e}),i=new n.DERInteger({bigint:t});return new n.DERSequence({array:[r,i]}).tohex()},KJUR.crypto.ECDSA.getName=function(e){return"2b8104001f"===e?"secp192k1":"2a8648ce3d030107"===e?"secp256r1":"2b8104000a"===e?"secp256k1":"2b81040021"===e?"secp224r1":"2b81040022"===e?"secp384r1":"2b81040023"===e?"secp521r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(e)?"secp256r1":-1!=="|secp256k1|".indexOf(e)?"secp256k1":-1!=="|secp224r1|NIST P-224|P-224|".indexOf(e)?"secp224r1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(e)?"secp384r1":-1!=="|secp521r1|NIST P-521|P-521|".indexOf(e)?"secp521r1":null},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.ECParameterDB=new function(){var e={},t={};function n(e){return new BigInteger(e,16)}this.getByName=function(n){var r=n;if(void 0!==t[r]&&(r=t[n]),void 0!==e[r])return e[r];throw"unregistered EC curve name: "+r},this.regist=function(r,i,o,l,s,a,u,c,h,d,f,p){e[r]={};var g=n(o),w=n(l),m=n(s),v=n(a),y=n(u),b=new ECCurveFp(g,w,m),S=b.decodePointHex("04"+c+h);e[r].name=r,e[r].keylen=i,e[r].keycharlen=2*Math.ceil(i/8),e[r].curve=b,e[r].G=S,e[r].n=v,e[r].h=y,e[r].oid=f,e[r].info=p;for(var $=0;$<d.length;$++)t[d[$]]=r}},KJUR.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),KJUR.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),KJUR.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),KJUR.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),KJUR.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),KJUR.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),KJUR.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),KJUR.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),KJUR.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),KJUR.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.DSA=function(){var e=ASN1HEX;e.getVbyList;var t=e.getVbyListEx,n=e.isASN1HEX,r=BigInteger;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(e,t,n,r,i){this.isPrivate=!0,this.p=e,this.q=t,this.g=n,this.y=r,this.x=i},this.setPrivateHex=function(e,t,n,r,i){var o,l,s,a,u;o=new BigInteger(e,16),l=new BigInteger(t,16),s=new BigInteger(n,16),a="string"==typeof r&&r.length>1?new BigInteger(r,16):null,u=new BigInteger(i,16),this.setPrivate(o,l,s,a,u)},this.setPublic=function(e,t,n,r){this.isPublic=!0,this.p=e,this.q=t,this.g=n,this.y=r,this.x=null},this.setPublicHex=function(e,t,n,r){var i,o,l,s;i=new BigInteger(e,16),o=new BigInteger(t,16),l=new BigInteger(n,16),s=new BigInteger(r,16),this.setPublic(i,o,l,s)},this.signWithMessageHash=function(e){var t=this.p,n=this.q,r=this.g;this.y;var i=this.x,o=KJUR.crypto.Util.getRandomBigIntegerMinToMax(BigInteger.ONE.add(BigInteger.ONE),n.subtract(BigInteger.ONE)),l=new BigInteger(e.substr(0,n.bitLength()/4),16),s=r.modPow(o,t).mod(n),a=o.modInverse(n).multiply(l.add(i.multiply(s))).mod(n);return KJUR.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:s}},{int:{bigint:a}}]})},this.verifyWithMessageHash=function(e,t){var n=this.p,r=this.q,i=this.g,o=this.y,l=this.parseASN1Signature(t),s=l[0],a=l[1],u=new BigInteger(e.substr(0,r.bitLength()/4),16);if(BigInteger.ZERO.compareTo(s)>0||s.compareTo(r)>0)throw"invalid DSA signature";if(BigInteger.ZERO.compareTo(a)>=0||a.compareTo(r)>0)throw"invalid DSA signature";var c=a.modInverse(r),h=u.multiply(c).mod(r),d=s.multiply(c).mod(r);return 0==i.modPow(h,n).multiply(o.modPow(d,n)).mod(n).mod(r).compareTo(s)},this.parseASN1Signature=function(e){try{return[new r(t(e,0,[0],"02"),16),new r(t(e,0,[1],"02"),16)]}catch(e){throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(e){var r,i,o,l,s;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[1],"02"),i=t(e,0,[2],"02"),o=t(e,0,[3],"02"),l=t(e,0,[4],"02"),s=t(e,0,[5],"02")}catch(e){throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(r,i,o,l,s)},this.readPKCS8PrvKeyHex=function(e){var r,i,o,l;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[1,1,0],"02"),i=t(e,0,[1,1,1],"02"),o=t(e,0,[1,1,2],"02"),l=t(e,0,[2,0],"02")}catch(e){throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(r,i,o,null,l)},this.readPKCS8PubKeyHex=function(e){var r,i,o,l;if(!1===n(e))throw new Error("not ASN.1 hex string");try{r=t(e,0,[0,1,0],"02"),i=t(e,0,[0,1,1],"02"),o=t(e,0,[0,1,2],"02"),l=t(e,0,[1,0],"02")}catch(e){throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(r,i,o,l)},this.readCertPubKeyHex=function(e,r){var i,o,l,s;if(!1===n(e))throw new Error("not ASN.1 hex string");try{i=t(e,0,[0,5,0,1,0],"02"),o=t(e,0,[0,5,0,1,1],"02"),l=t(e,0,[0,5,0,1,2],"02"),s=t(e,0,[0,5,1,0],"02")}catch(e){throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(i,o,l,s)}};var KEYUTIL=function(){var e=function(e,n,r){return t(CryptoJS.AES,e,n,r)},t=function(e,t,n,r){var i=CryptoJS.enc.Hex.parse(t),o=CryptoJS.enc.Hex.parse(n),l=CryptoJS.enc.Hex.parse(r),s={};s.key=o,s.iv=l,s.ciphertext=i;var a=e.decrypt(s,o,{iv:l});return CryptoJS.enc.Hex.stringify(a)},n=function(e,t,n){return r(CryptoJS.AES,e,t,n)},r=function(e,t,n,r){var i=CryptoJS.enc.Hex.parse(t),o=CryptoJS.enc.Hex.parse(n),l=CryptoJS.enc.Hex.parse(r),s=e.encrypt(i,o,{iv:l}),a=CryptoJS.enc.Hex.parse(s.toString());return CryptoJS.enc.Base64.stringify(a)},i={"AES-256-CBC":{proc:e,eproc:n,keylen:32,ivlen:16},"AES-192-CBC":{proc:e,eproc:n,keylen:24,ivlen:16},"AES-128-CBC":{proc:e,eproc:n,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(e,n,r){return t(CryptoJS.TripleDES,e,n,r)},eproc:function(e,t,n){return r(CryptoJS.TripleDES,e,t,n)},keylen:24,ivlen:8},"DES-CBC":{proc:function(e,n,r){return t(CryptoJS.DES,e,n,r)},eproc:function(e,t,n){return r(CryptoJS.DES,e,t,n)},keylen:8,ivlen:8}},o=function(e){var t={},n=e.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));n&&(t.cipher=n[1],t.ivsalt=n[2]);var r=e.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));r&&(t.type=r[1]);var i=-1,o=0;-1!=e.indexOf("\r\n\r\n")&&(i=e.indexOf("\r\n\r\n"),o=2),-1!=e.indexOf("\n\n")&&(i=e.indexOf("\n\n"),o=1);var l=e.indexOf("-----END");if(-1!=i&&-1!=l){var s=e.substring(i+2*o,l-o);s=s.replace(/\s+/g,""),t.data=s}return t},l=function(e,t,n){for(var r=n.substring(0,16),o=CryptoJS.enc.Hex.parse(r),l=CryptoJS.enc.Utf8.parse(t),s=i[e].keylen+i[e].ivlen,a="",u=null;;){var c=CryptoJS.algo.MD5.create();if(null!=u&&c.update(u),c.update(l),c.update(o),u=c.finalize(),(a+=CryptoJS.enc.Hex.stringify(u)).length>=2*s)break}var h={};return h.keyhex=a.substr(0,2*i[e].keylen),h.ivhex=a.substr(2*i[e].keylen,2*i[e].ivlen),h},s=function(e,t,n,r){var o=CryptoJS.enc.Base64.parse(e),l=CryptoJS.enc.Hex.stringify(o);return(0,i[t].proc)(l,n,r)};return{version:"1.0.0",parsePKCS5PEM:function(e){return o(e)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(e,t,n){return l(e,t,n)},decryptKeyB64:function(e,t,n,r){return s(e,t,n,r)},getDecryptedKeyHex:function(e,t){var n=o(e),r=n.cipher,i=n.ivsalt,a=n.data,u=l(r,t,i).keyhex;return s(a,r,u,i)},getEncryptedPKCS5PEMFromPrvKeyHex:function(e,t,n,r,o){var s="";if(void 0!==r&&null!=r||(r="AES-256-CBC"),void 0===i[r])throw new Error("KEYUTIL unsupported algorithm: "+r);if(void 0===o||null==o){var a=function(e){var t=CryptoJS.lib.WordArray.random(e);return CryptoJS.enc.Hex.stringify(t)}(i[r].ivlen);o=a.toUpperCase()}var u=function(e,t,n,r){return(0,i[t].eproc)(e,n,r)}(t,r,l(r,n,o).keyhex,o);s="-----BEGIN "+e+" PRIVATE KEY-----\r\n";return s+="Proc-Type: 4,ENCRYPTED\r\n",s+="DEK-Info: "+r+","+o+"\r\n",s+="\r\n",s+=u.replace(/(.{64})/g,"$1\r\n"),s+="\r\n-----END "+e+" PRIVATE KEY-----\r\n"},parseHexOfEncryptedPKCS8:function(e){var t=ASN1HEX,n=t.getChildIdx,r=t.getV,i={},o=n(e,0);if(2!=o.length)throw new Error("malformed format: SEQUENCE(0).items != 2: "+o.length);i.ciphertext=r(e,o[1]);var l=n(e,o[0]);if(2!=l.length)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+l.length);if("2a864886f70d01050d"!=r(e,l[0]))throw new Error("this only supports pkcs5PBES2");var s=n(e,l[1]);if(2!=l.length)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+s.length);var a=n(e,s[1]);if(2!=a.length)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+a.length);if("2a864886f70d0307"!=r(e,a[0]))throw"this only supports TripleDES";i.encryptionSchemeAlg="TripleDES",i.encryptionSchemeIV=r(e,a[1]);var u=n(e,s[0]);if(2!=u.length)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+u.length);if("2a864886f70d01050c"!=r(e,u[0]))throw new Error("this only supports pkcs5PBKDF2");var c=n(e,u[1]);if(c.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+c.length);i.pbkdf2Salt=r(e,c[0]);var h=r(e,c[1]);try{i.pbkdf2Iter=parseInt(h,16)}catch(e){throw new Error("malformed format pbkdf2Iter: "+h)}return i},getPBKDF2KeyHexFromParam:function(e,t){var n=CryptoJS.enc.Hex.parse(e.pbkdf2Salt),r=e.pbkdf2Iter,i=CryptoJS.PBKDF2(t,n,{keySize:6,iterations:r});return CryptoJS.enc.Hex.stringify(i)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(e,t){var n=pemtohex(e,"ENCRYPTED PRIVATE KEY"),r=this.parseHexOfEncryptedPKCS8(n),i=KEYUTIL.getPBKDF2KeyHexFromParam(r,t),o={};o.ciphertext=CryptoJS.enc.Hex.parse(r.ciphertext);var l=CryptoJS.enc.Hex.parse(i),s=CryptoJS.enc.Hex.parse(r.encryptionSchemeIV),a=CryptoJS.TripleDES.decrypt(o,l,{iv:s});return CryptoJS.enc.Hex.stringify(a)},getKeyFromEncryptedPKCS8PEM:function(e,t){var n=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(e,t);return this.getKeyFromPlainPrivatePKCS8Hex(n)},parsePlainPrivatePKCS8Hex:function(e){var t=ASN1HEX,n=t.getChildIdx,r=t.getV,i={algparam:null};if("30"!=e.substr(0,2))throw new Error("malformed plain PKCS8 private key(code:001)");var o=n(e,0);if(o.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if("30"!=e.substr(o[1],2))throw new Error("malformed PKCS8 private key(code:003)");var l=n(e,o[1]);if(2!=l.length)throw new Error("malformed PKCS8 private key(code:004)");if("06"!=e.substr(l[0],2))throw new Error("malformed PKCS8 private key(code:005)");if(i.algoid=r(e,l[0]),"06"==e.substr(l[1],2)&&(i.algparam=r(e,l[1])),"04"!=e.substr(o[2],2))throw new Error("malformed PKCS8 private key(code:006)");return i.keyidx=t.getVidx(e,o[2]),i},getKeyFromPlainPrivatePKCS8PEM:function(e){var t=pemtohex(e,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(t)},getKeyFromPlainPrivatePKCS8Hex:function(e){var t,n=this.parsePlainPrivatePKCS8Hex(e);if("2a864886f70d010101"==n.algoid)t=new RSAKey;else if("2a8648ce380401"==n.algoid)t=new KJUR.crypto.DSA;else{if("2a8648ce3d0201"!=n.algoid)throw new Error("unsupported private key algorithm");t=new KJUR.crypto.ECDSA}return t.readPKCS8PrvKeyHex(e),t},_getKeyFromPublicPKCS8Hex:function(e){var t,n=ASN1HEX.getVbyList(e,0,[0,0],"06");if("2a864886f70d010101"===n)t=new RSAKey;else if("2a8648ce380401"===n)t=new KJUR.crypto.DSA;else{if("2a8648ce3d0201"!==n)throw new Error("unsupported PKCS#8 public key hex");t=new KJUR.crypto.ECDSA}return t.readPKCS8PubKeyHex(e),t},parsePublicRawRSAKeyHex:function(e){var t=ASN1HEX,n=t.getChildIdx,r=t.getV,i={};if("30"!=e.substr(0,2))throw new Error("malformed RSA key(code:001)");var o=n(e,0);if(2!=o.length)throw new Error("malformed RSA key(code:002)");if("02"!=e.substr(o[0],2))throw new Error("malformed RSA key(code:003)");if(i.n=r(e,o[0]),"02"!=e.substr(o[1],2))throw new Error("malformed RSA key(code:004)");return i.e=r(e,o[1]),i},parsePublicPKCS8Hex:function(e){var t=ASN1HEX,n=t.getChildIdx,r=t.getV,i={algparam:null},o=n(e,0);if(2!=o.length)throw new Error("outer DERSequence shall have 2 elements: "+o.length);var l=o[0];if("30"!=e.substr(l,2))throw new Error("malformed PKCS8 public key(code:001)");var s=n(e,l);if(2!=s.length)throw new Error("malformed PKCS8 public key(code:002)");if("06"!=e.substr(s[0],2))throw new Error("malformed PKCS8 public key(code:003)");if(i.algoid=r(e,s[0]),"06"==e.substr(s[1],2)?i.algparam=r(e,s[1]):"30"==e.substr(s[1],2)&&(i.algparam={},i.algparam.p=t.getVbyList(e,s[1],[0],"02"),i.algparam.q=t.getVbyList(e,s[1],[1],"02"),i.algparam.g=t.getVbyList(e,s[1],[2],"02")),"03"!=e.substr(o[1],2))throw new Error("malformed PKCS8 public key(code:004)");return i.key=r(e,o[1]).substr(2),i}}}();function _zeroPaddingOfSignature(e,t){for(var n="",r=t/4-e.length,i=0;i<r;i++)n+="0";return n+e}function pss_mgf1_str(e,t,n){for(var r="",i=0;r.length<t;)r+=hextorstr(n(rstrtohex(e+String.fromCharCode.apply(String,[(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i])))),i+=1;return r}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(e){for(var t in KJUR.crypto.Util.DIGESTINFOHEAD){var n=KJUR.crypto.Util.DIGESTINFOHEAD[t],r=n.length;if(e.substring(0,r)==n)return[t,e.substring(r)]}return[]}function X509(e){var t=ASN1HEX,n=t.getChildIdx,r=t.getV;t.dump;var i,o=t.parse,l=t.getTLV,s=t.getVbyList,a=t.getVbyListEx,u=t.getTLVbyList,c=t.getTLVbyListEx,h=t.getIdxbyList,d=t.getIdxbyListEx,f=t.getVidx,p=t.getInt,g=t.oidname,w=t.hextooidstr,m=pemtohex,v=Error;try{i=KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(e){}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(null===this.hex||0!==this.version)return this.version;var e=u(this.hex,0,[0,0]);if("a0"==e.substr(0,2)){var t=u(e,0,[0]),n=p(t,0);if(n<0||2<n)throw new Error("malformed version field");return this.version=n+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return a(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var e=c(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(e)},this.getAlgorithmIdentifierName=function(e){for(var t in i)if(e===i[t])return t;return g(a(e,0,[0],"06"))},this.getIssuer=function(e,t){return this.getX500Name(this.getIssuerHex(),e,t)},this.getIssuerHex=function(){return u(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(e,t){return this.getX500Name(this.getSubjectHex(),e,t)},this.getSubjectHex=function(){return u(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var e=s(this.hex,0,[0,4+this.foffset,0]);return e=e.replace(/(..)/g,"%$1"),e=decodeURIComponent(e)},this.getNotAfter=function(){var e=s(this.hex,0,[0,4+this.foffset,1]);return e=e.replace(/(..)/g,"%$1"),e=decodeURIComponent(e)},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return u(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var e=this.getSPKI();return null==e?null:s(e,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return h(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var e=this.getPublicKeyIdx();return h(this.hex,e,[1,0],"30")},this.getPublicKey=function(){return KEYUTIL.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var e=u(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(e)},this.getSignatureValueHex=function(){return s(this.hex,0,[2],"03",!0)},this.verifySignature=function(e){var t=this.getSignatureAlgorithmField(),n=this.getSignatureValueHex(),r=u(this.hex,0,[0],"30"),i=new KJUR.crypto.Signature({alg:t});return i.init(e),i.updateHex(r),i.verify(n)},this.parseExt=function(e){var i,o,l;if(void 0===e){if(l=this.hex,3!==this.version)return-1;i=h(l,0,[0,7,0],"30"),o=n(l,i)}else{l=pemtohex(e);var a=h(l,0,[0,3,0,0],"06");if("2a864886f70d01090e"!=r(l,a))return void(this.aExtInfo=new Array);i=h(l,0,[0,3,0,1,0],"30"),o=n(l,i),this.hex=l}this.aExtInfo=new Array;for(var u=0;u<o.length;u++){var c={critical:!1},d=0;3===n(l,o[u]).length&&(c.critical=!0,d=1),c.oid=t.hextooidstr(s(l,o[u],[0],"06"));var p=h(l,o[u],[1+d]);c.vidx=f(l,p),this.aExtInfo.push(c)}},this.getExtInfo=function(e){var t=this.aExtInfo,n=e;if(e.match(/^[0-9.]+$/)||(n=KJUR.asn1.x509.OID.name2oid(e)),""!==n)for(var r=0;r<t.length;r++)if(t[r].oid===n)return t[r]},this.getCriticalExtV=function(e,t,n){if(null!=t)return[t,n];var r=this.getExtInfo(e);return null==r?[null,null]:[l(this.hex,r.vidx),r.critical]},this.getExtBasicConstraints=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("basicConstraints");if(void 0===n)return;e=l(this.hex,n.vidx),t=n.critical}var i={extname:"basicConstraints"};if(t&&(i.critical=!0),"3000"===e)return i;if("30030101ff"===e)return i.cA=!0,i;if("30060101ff02"===e.substr(0,12)){var o=r(e,10),s=parseInt(o,16);return i.cA=!0,i.pathLen=s,i}throw new Error("hExtV parse error: "+e)},this.getExtNameConstraints=function(e,t){var r=this.getCriticalExtV("nameConstraints",e,t);if(e=r[0],t=r[1],null!=e){var i={extname:"nameConstraints"};t&&(i.critical=!0);for(var o=n(e,0),s=0;s<o.length;s++){for(var a=[],u=n(e,o[s]),c=0;c<u.length;c++){var h=l(e,u[c]),d=this.getGeneralSubtree(h);a.push(d)}var f=e.substr(o[s],2);"a0"==f?i.permit=a:"a1"==f&&(i.exclude=a)}return i}},this.getGeneralSubtree=function(e){var t=n(e,0),i=t.length;if(i<1||2<i)throw new Error("wrong num elements");for(var o=this.getGeneralName(l(e,t[0])),s=1;s<i;s++){var a=e.substr(t[s],2),u=r(e,t[s]),c=parseInt(u,16);"80"==a&&(o.min=c),"81"==a&&(o.max=c)}return o},this.getExtKeyUsage=function(e,t){var n=this.getCriticalExtV("keyUsage",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"keyUsage"};return t&&(r.critical=!0),r.names=this.getExtKeyUsageString(e).split(","),r}},this.getExtKeyUsageBin=function(e){if(void 0===e){var t=this.getExtInfo("keyUsage");if(void 0===t)return"";e=l(this.hex,t.vidx)}if(8!=e.length&&10!=e.length)throw new Error("malformed key usage value: "+e);var n="000000000000000"+parseInt(e.substr(6),16).toString(2);return 8==e.length&&(n=n.slice(-8)),10==e.length&&(n=n.slice(-16)),""==(n=n.replace(/0+$/,""))&&(n="0"),n},this.getExtKeyUsageString=function(e){for(var t=this.getExtKeyUsageBin(e),n=new Array,r=0;r<t.length;r++)"1"==t.substr(r,1)&&n.push(X509.KEYUSAGE_NAME[r]);return n.join(",")},this.getExtSubjectKeyIdentifier=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectKeyIdentifier");if(void 0===n)return;e=l(this.hex,n.vidx),t=n.critical}var i={extname:"subjectKeyIdentifier"};t&&(i.critical=!0);var o=r(e,0);return i.kid={hex:o},i},this.getExtAuthorityKeyIdentifier=function(e,t){if(void 0===e&&void 0===t){var i=this.getExtInfo("authorityKeyIdentifier");if(void 0===i)return;e=l(this.hex,i.vidx),t=i.critical}var o={extname:"authorityKeyIdentifier"};t&&(o.critical=!0);for(var s=n(e,0),a=0;a<s.length;a++){var u=e.substr(s[a],2);if("80"===u&&(o.kid={hex:r(e,s[a])}),"a1"===u){var c=l(e,s[a]),h=this.getGeneralNames(c);o.issuer=h[0].dn}"82"===u&&(o.sn={hex:r(e,s[a])})}return o},this.getExtExtKeyUsage=function(e,t){if(void 0===e&&void 0===t){var i=this.getExtInfo("extKeyUsage");if(void 0===i)return;e=l(this.hex,i.vidx),t=i.critical}var o={extname:"extKeyUsage",array:[]};t&&(o.critical=!0);for(var s=n(e,0),a=0;a<s.length;a++)o.array.push(g(r(e,s[a])));return o},this.getExtExtKeyUsageName=function(){var e=this.getExtInfo("extKeyUsage");if(void 0===e)return e;var t=new Array,i=l(this.hex,e.vidx);if(""===i)return t;for(var o=n(i,0),s=0;s<o.length;s++)t.push(g(r(i,o[s])));return t},this.getExtSubjectAltName=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectAltName");if(void 0===n)return;e=l(this.hex,n.vidx),t=n.critical}var r={extname:"subjectAltName",array:[]};return t&&(r.critical=!0),r.array=this.getGeneralNames(e),r},this.getExtIssuerAltName=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("issuerAltName");if(void 0===n)return;e=l(this.hex,n.vidx),t=n.critical}var r={extname:"issuerAltName",array:[]};return t&&(r.critical=!0),r.array=this.getGeneralNames(e),r},this.getGeneralNames=function(e){for(var t=n(e,0),r=[],i=0;i<t.length;i++){var o=this.getGeneralName(l(e,t[i]));void 0!==o&&r.push(o)}return r},this.getGeneralName=function(e){var t=e.substr(0,2),n=r(e,0),i=hextorstr(n);return"81"==t?{rfc822:i}:"82"==t?{dns:i}:"86"==t?{uri:i}:"87"==t?{ip:hextoip(n)}:"a4"==t?{dn:this.getX500Name(n)}:"a0"==t?{other:this.getOtherName(e)}:void 0},this.getExtSubjectAltName2=function(){var e,t,i,o=this.getExtInfo("subjectAltName");if(void 0===o)return o;for(var s=new Array,a=l(this.hex,o.vidx),u=n(a,0),c=0;c<u.length;c++)i=a.substr(u[c],2),e=r(a,u[c]),"81"===i&&(t=hextoutf8(e),s.push(["MAIL",t])),"82"===i&&(t=hextoutf8(e),s.push(["DNS",t])),"84"===i&&(t=X509.hex2dn(e,0),s.push(["DN",t])),"86"===i&&(t=hextoutf8(e),s.push(["URI",t])),"87"===i&&(t=hextoip(e),s.push(["IP",t]));return s},this.getExtCRLDistributionPoints=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("cRLDistributionPoints");if(void 0===r)return;e=l(this.hex,r.vidx),t=r.critical}var i={extname:"cRLDistributionPoints",array:[]};t&&(i.critical=!0);for(var o=n(e,0),s=0;s<o.length;s++){var a=l(e,o[s]);i.array.push(this.getDistributionPoint(a))}return i},this.getDistributionPoint=function(e){for(var t={},r=n(e,0),i=0;i<r.length;i++){var o=e.substr(r[i],2),s=l(e,r[i]);"a0"==o&&(t.dpname=this.getDistributionPointName(s))}return t},this.getDistributionPointName=function(e){for(var t={},r=n(e,0),i=0;i<r.length;i++){var o=e.substr(r[i],2),s=l(e,r[i]);"a0"==o&&(t.full=this.getGeneralNames(s))}return t},this.getExtCRLDistributionPointsURI=function(){var e=this.getExtCRLDistributionPoints();if(null==e)return e;for(var t=e.array,n=[],r=0;r<t.length;r++)try{null!=t[r].dpname.full[0].uri&&n.push(t[r].dpname.full[0].uri)}catch(e){}return n},this.getExtAIAInfo=function(){var e=this.getExtInfo("authorityInfoAccess");if(void 0===e)return e;for(var t={ocsp:[],caissuer:[]},r=n(this.hex,e.vidx),i=0;i<r.length;i++){var o=s(this.hex,r[i],[0],"06"),l=s(this.hex,r[i],[1],"86");"2b06010505073001"===o&&t.ocsp.push(hextoutf8(l)),"2b06010505073002"===o&&t.caissuer.push(hextoutf8(l))}return t},this.getExtAuthorityInfoAccess=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("authorityInfoAccess");if(void 0===r)return;e=l(this.hex,r.vidx),t=r.critical}var i={extname:"authorityInfoAccess",array:[]};t&&(i.critical=!0);for(var o=n(e,0),u=0;u<o.length;u++){var c=a(e,o[u],[0],"06"),h=hextoutf8(s(e,o[u],[1],"86"));if("2b06010505073001"==c)i.array.push({ocsp:h});else{if("2b06010505073002"!=c)throw new Error("unknown method: "+c);i.array.push({caissuer:h})}}return i},this.getExtCertificatePolicies=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("certificatePolicies");if(void 0===r)return;e=l(this.hex,r.vidx),t=r.critical}var i={extname:"certificatePolicies",array:[]};t&&(i.critical=!0);for(var o=n(e,0),s=0;s<o.length;s++){var a=l(e,o[s]),u=this.getPolicyInformation(a);i.array.push(u)}return i},this.getPolicyInformation=function(e){var t={},r=s(e,0,[0],"06");t.policyoid=g(r);var i=d(e,0,[1],"30");if(-1!=i){t.array=[];for(var o=n(e,i),a=0;a<o.length;a++){var u=l(e,o[a]),c=this.getPolicyQualifierInfo(u);t.array.push(c)}}return t},this.getOtherName=function(e){var t={},r=n(e,0),i=s(e,r[0],[],"06"),l=s(e,r[1],[]);return t.oid=g(i),t.value=o(l),t},this.getPolicyQualifierInfo=function(e){var t={},n=s(e,0,[0],"06");if("2b06010505070201"===n){var r=a(e,0,[1],"16");t.cps=hextorstr(r)}else if("2b06010505070202"===n){var i=u(e,0,[1],"30");t.unotice=this.getUserNotice(i)}return t},this.getUserNotice=function(e){var n=null;try{return n=t.parse(e),this._asn1ToUnotice(n)}catch(e){return}},this._asn1ToUnotice=function(e){try{for(var t={},n=aryval(e,"seq"),r=0;r<n.length;r++){var i=this._asn1ToNoticeRef(n[r]);null!=i&&(t.noticeref=i);var o=this.asn1ToDisplayText(n[r]);null!=o&&(t.exptext=o)}return Object.keys(t).length>0?t:void 0}catch(e){return}},this._asn1ToNoticeRef=function(e){try{for(var t={},n=aryval(e,"seq"),r=0;r<n.length;r++){var i=this._asn1ToNoticeNum(n[r]);null!=i&&(t.noticenum=i);var o=this.asn1ToDisplayText(n[r]);null!=o&&(t.org=o)}return Object.keys(t).length>0?t:void 0}catch(e){return}},this._asn1ToNoticeNum=function(e){try{for(var t=aryval(e,"seq"),n=[],r=0;r<t.length;r++){var i=t[r];n.push(parseInt(aryval(i,"int.hex"),16))}return n}catch(e){return}},this.getDisplayText=function(e){var t={};return t.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[e.substr(0,2)],t.str=hextorstr(r(e,0)),t},this.asn1ToDisplayText=function(e){return null!=e.utf8str?{type:"utf8",str:e.utf8str.str}:null!=e.ia5str?{type:"ia5",str:e.ia5str.str}:null!=e.visstr?{type:"vis",str:e.visstr.str}:null!=e.bmpstr?{type:"bmp",str:e.bmpstr.str}:null!=e.prnstr?{type:"prn",str:e.prnstr.str}:void 0},this.getExtPolicyMappings=function(e,t){var n=this.getCriticalExtV("policyMappings",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"policyMappings"};t&&(r.critical=!0);try{for(var i=o(e).seq,l=[],s=0;s<i.length;s++){var a=i[s].seq;l.push([a[0].oid,a[1].oid])}r.array=l}catch(e){throw new v("malformed policyMappings")}return r}},this.getExtPolicyConstraints=function(e,t){var n=this.getCriticalExtV("policyConstraints",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"policyConstraints"};t&&(r.critical=!0);var i=o(e);try{for(var l=i.seq,s=0;s<l.length;s++){var a=l[s].tag;0==a.explicit&&("80"==a.tag&&(r.reqexp=parseInt(a.hex,16)),"81"==a.tag&&(r.inhibit=parseInt(a.hex,16)))}}catch(e){return new v("malformed policyConstraints value")}return r}},this.getExtInhibitAnyPolicy=function(e,t){var n=this.getCriticalExtV("inhibitAnyPolicy",e,t);if(e=n[0],t=n[1],null!=e){var r={extname:"inhibitAnyPolicy"};t&&(r.critical=!0);var i=p(e,0);return-1==i?new v("wrong value"):(r.skip=i,r)}},this.getExtCRLNumber=function(e,t){var n={extname:"cRLNumber"};if(t&&(n.critical=!0),"02"==e.substr(0,2))return n.num={hex:r(e,0)},n;throw new v("hExtV parse error: "+e)},this.getExtCRLReason=function(e,t){var n={extname:"cRLReason"};if(t&&(n.critical=!0),"0a"==e.substr(0,2))return n.code=parseInt(r(e,0),16),n;throw new Error("hExtV parse error: "+e)},this.getExtOcspNonce=function(e,t){var n={extname:"ocspNonce"};t&&(n.critical=!0);var i=r(e,0);return n.hex=i,n},this.getExtOcspNoCheck=function(e,t){var n={extname:"ocspNoCheck"};return t&&(n.critical=!0),n},this.getExtAdobeTimeStamp=function(e,t){if(void 0===e&&void 0===t){var r=this.getExtInfo("adobeTimeStamp");if(void 0===r)return;e=l(this.hex,r.vidx),t=r.critical}var i={extname:"adobeTimeStamp"};t&&(i.critical=!0);var o=n(e,0);if(o.length>1){var s=l(e,o[1]),a=this.getGeneralName(s);null!=a.uri&&(i.uri=a.uri)}if(o.length>2){var u=l(e,o[2]);"0101ff"==u&&(i.reqauth=!0),"010100"==u&&(i.reqauth=!1)}return i},this.getExtSubjectDirectoryAttributes=function(e,t){if(void 0===e&&void 0===t){var n=this.getExtInfo("subjectDirectoryAttributes");if(void 0===n)return;e=l(this.hex,n.vidx),t=n.critical}var r={extname:"subjectDirectoryAttributes"};t&&(r.critical=!0);try{for(var i=o(e),s=[],a=0;a<i.seq.length;a++){var u=i.seq[a],c=aryval(u,"seq.0.oid"),h=aryval(u,"seq.1.set");if(null==c||null==h)throw"error";s.push({attr:c,array:h})}return r.array=s,r}catch(e){throw new Error("malformed subjectDirectoryAttributes extension value")}};var y=function(e){var t={};try{var n=e.seq[0].oid,r=KJUR.asn1.x509.OID.name2oid(n);t.type=KJUR.asn1.x509.OID.oid2atype(r);var i=e.seq[1];if(null!=i.utf8str)t.ds="utf8",t.value=i.utf8str.str;else if(null!=i.numstr)t.ds="num",t.value=i.numstr.str;else if(null!=i.telstr)t.ds="tel",t.value=i.telstr.str;else if(null!=i.prnstr)t.ds="prn",t.value=i.prnstr.str;else if(null!=i.ia5str)t.ds="ia5",t.value=i.ia5str.str;else if(null!=i.visstr)t.ds="vis",t.value=i.visstr.str;else{if(null==i.bmpstr)throw"error";t.ds="bmp",t.value=i.bmpstr.str}return t}catch(e){throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},b=function(e){try{return e.set.map((function(e){return y(e)}))}catch(e){throw new Error("improper ASN.1 parsed RDN: "+e)}};this.getX500NameRule=function(e){for(var t=null,n=[],r=0;r<e.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(i[o]);for(r=0;r<n.length;r++){var l=n[r],s=l.ds,a=l.value,u=l.type;if("prn"!=s&&"utf8"!=s&&"ia5"!=s)return"mixed";if("ia5"==s){if("CN"!=u)return"mixed";if(KJUR.lang.String.isMail(a))continue;return"mixed"}if("C"==u){if("prn"==s)continue;return"mixed"}if(null==t)t=s;else if(t!==s)return"mixed"}return null==t?"prn":t},this.getAttrTypeAndValue=function(e){var t=o(e);return y(t)},this.getRDN=function(e){var t=o(e);return b(t)},this.getX500NameArray=function(e){return function(e){try{return e.seq.map((function(e){return b(e)}))}catch(e){throw new Error("improper ASN.1 parsed X500Name: "+e)}}(o(e))},this.getX500Name=function(e,t,n){var r=this.getX500NameArray(e),i={str:this.dnarraytostr(r)};return i.array=r,1==n&&(i.hex=e),1==t&&(i.canon=this.c14nRDNArray(r)),i},this.readCertPEM=function(e){this.readCertHex(m(e))},this.readCertHex=function(e){this.hex=e,this.getVersion();try{h(this.hex,0,[0,7],"a3"),this.parseExt()}catch(e){}},this.getParam=function(e){var t={};return null==e&&(e={}),t.version=this.getVersion(),t.serial={hex:this.getSerialNumberHex()},t.sigalg=this.getSignatureAlgorithmField(),t.issuer=this.getIssuer(e.dncanon,e.dnhex),t.notbefore=this.getNotBefore(),t.notafter=this.getNotAfter(),t.subject=this.getSubject(e.dncanon,e.dnhex),t.sbjpubkey=hextopem(this.getPublicKeyHex(),"PUBLIC KEY"),null!=this.aExtInfo&&this.aExtInfo.length>0&&(t.ext=this.getExtParamArray()),t.sighex=this.getSignatureValueHex(),1==e.tbshex&&(t.tbshex=u(this.hex,0,[0])),1==e.nodnarray&&(delete t.issuer.array,delete t.subject.array),t},this.getExtParamArray=function(e){null==e&&(-1!=d(this.hex,0,[0,"[3]"])&&(e=c(this.hex,0,[0,"[3]",0],"30")));for(var t=[],r=n(e,0),i=0;i<r.length;i++){var o=l(e,r[i]),s=this.getExtParam(o);null!=s&&t.push(s)}return t},this.getExtParam=function(e){var t=n(e,0).length;if(2!=t&&3!=t)throw new Error("wrong number elements in Extension: "+t+" "+e);var r=w(s(e,0,[0],"06")),i=!1;3==t&&"0101ff"==u(e,0,[1])&&(i=!0);var l=u(e,0,[t-1,0]),a=void 0;if("2.5.29.14"==r?a=this.getExtSubjectKeyIdentifier(l,i):"2.5.29.15"==r?a=this.getExtKeyUsage(l,i):"2.5.29.17"==r?a=this.getExtSubjectAltName(l,i):"2.5.29.18"==r?a=this.getExtIssuerAltName(l,i):"2.5.29.19"==r?a=this.getExtBasicConstraints(l,i):"2.5.29.30"==r?a=this.getExtNameConstraints(l,i):"2.5.29.31"==r?a=this.getExtCRLDistributionPoints(l,i):"2.5.29.32"==r?a=this.getExtCertificatePolicies(l,i):"2.5.29.33"==r?a=this.getExtPolicyMappings(l,i):"2.5.29.35"==r?a=this.getExtAuthorityKeyIdentifier(l,i):"2.5.29.36"==r?a=this.getExtPolicyConstraints(l,i):"2.5.29.37"==r?a=this.getExtExtKeyUsage(l,i):"2.5.29.54"==r?a=this.getExtInhibitAnyPolicy(l,i):"1.3.6.1.5.5.7.1.1"==r?a=this.getExtAuthorityInfoAccess(l,i):"2.5.29.20"==r?a=this.getExtCRLNumber(l,i):"2.5.29.21"==r?a=this.getExtCRLReason(l,i):"2.5.29.9"==r?a=this.getExtSubjectDirectoryAttributes(l,i):"1.3.6.1.5.5.7.48.1.2"==r?a=this.getExtOcspNonce(l,i):"1.3.6.1.5.5.7.48.1.5"==r?a=this.getExtOcspNoCheck(l,i):"1.2.840.113583.1.1.9.1"==r?a=this.getExtAdobeTimeStamp(l,i):null!=X509.EXT_PARSER[r]&&(a=X509.EXT_PARSER[r](r,i,l)),null!=a)return a;var c={extname:r,extn:l};try{c.extn=o(l)}catch(e){}return i&&(c.critical=!0),c},this.findExt=function(e,t){for(var n=0;n<e.length;n++)if(e[n].extname==t)return e[n];return null},this.updateExtCDPFullURI=function(e,t){var n=this.findExt(e,"cRLDistributionPoints");if(null!=n&&null!=n.array)for(var r=n.array,i=0;i<r.length;i++)if(null!=r[i].dpname&&null!=r[i].dpname.full)for(var o=r[i].dpname.full,l=0;l<o.length;l++){var s=o[i];null!=s.uri&&(s.uri=t)}},this.updateExtAIAOCSP=function(e,t){var n=this.findExt(e,"authorityInfoAccess");if(null!=n&&null!=n.array)for(var r=n.array,i=0;i<r.length;i++)null!=r[i].ocsp&&(r[i].ocsp=t)},this.updateExtAIACAIssuer=function(e,t){var n=this.findExt(e,"authorityInfoAccess");if(null!=n&&null!=n.array)for(var r=n.array,i=0;i<r.length;i++)null!=r[i].caissuer&&(r[i].caissuer=t)},this.dnarraytostr=function(e){return"/"+e.map((function(e){return function(e){return e.map((function(e){return function(e){return e.type+"="+e.value}(e).replace(/\+/,"\\+")})).join("+")}(e).replace(/\//,"\\/")})).join("/")},this.setCanonicalizedDN=function(e){var t;if(null!=e.str&&null==e.array){var n=new KJUR.asn1.x509.X500Name({str:e.str}).tohex();t=this.getX500NameArray(n)}else t=e.array;null==e.canon&&(e.canon=this.c14nRDNArray(t))},this.c14nRDNArray=function(e){for(var t=[],n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++){var l=r[o],s=l.value;s=(s=(s=(s=s.replace(/^\s*/,"")).replace(/\s*$/,"")).replace(/\s+/g," ")).toLowerCase(),i.push(l.type.toLowerCase()+"="+s)}t.push(i.join("+"))}return"/"+t.join("/")},this.getInfo=function(){var e,t,n,r=function(e){for(var t="",n="    ",r="\n",i=e.array,o=0;o<i.length;o++){var l=i[o];if(null!=l.dn&&(t+=n+"dn: "+l.dn.str+r),null!=l.ip&&(t+=n+"ip: "+l.ip+r),null!=l.rfc822&&(t+=n+"rfc822: "+l.rfc822+r),null!=l.dns&&(t+=n+"dns: "+l.dns+r),null!=l.uri&&(t+=n+"uri: "+l.uri+r),null!=l.other)t+=n+"other: "+l.other.oid+"="+JSON.stringify(l.other.value).replace(/\"/g,"")+r}return t=t.replace(/\n$/,"")},i=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];if(t+="    policy oid: "+i.policyoid+"\n",void 0!==i.array)for(var o=0;o<i.array.length;o++){var l=i.array[o];void 0!==l.cps&&(t+="    cps: "+l.cps+"\n")}}return t},o=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];try{void 0!==i.dpname.full[0].uri&&(t+="    "+i.dpname.full[0].uri+"\n")}catch(e){}try{void 0!==i.dname.full[0].dn.hex&&(t+="    "+X509.hex2dn(i.dpname.full[0].dn.hex)+"\n")}catch(e){}}return t},l=function(e){for(var t="",n=e.array,r=0;r<n.length;r++){var i=n[r];void 0!==i.caissuer&&(t+="    caissuer: "+i.caissuer+"\n"),void 0!==i.ocsp&&(t+="    ocsp: "+i.ocsp+"\n")}return t};if(e="Basic Fields\n",e+="  serial number: "+this.getSerialNumberHex()+"\n",e+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",e+="  issuer: "+this.getIssuerString()+"\n",e+="  notBefore: "+this.getNotBefore()+"\n",e+="  notAfter: "+this.getNotAfter()+"\n",e+="  subject: "+this.getSubjectString()+"\n",e+="  subject public key info: \n",e+="    key algorithm: "+(t=this.getPublicKey()).type+"\n","RSA"===t.type&&(e+="    n="+hextoposhex(t.n.toString(16)).substr(0,16)+"...\n",e+="    e="+hextoposhex(t.e.toString(16))+"\n"),null!=(n=this.aExtInfo)){e+="X509v3 Extensions:\n";for(var s=0;s<n.length;s++){var a=n[s],u=KJUR.asn1.x509.OID.oid2name(a.oid);""===u&&(u=a.oid);var c="";if(!0===a.critical&&(c="CRITICAL"),e+="  "+u+" "+c+":\n","basicConstraints"===u){var h=this.getExtBasicConstraints();void 0===h.cA?e+="    {}\n":(e+="    cA=true",void 0!==h.pathLen&&(e+=", pathLen="+h.pathLen),e+="\n")}else{var d;if("policyMappings"==u)e+="    "+this.getExtPolicyMappings().array.map((function(e){var t=e;return t[0]+":"+t[1]})).join(", ")+"\n";else if("policyConstraints"==u)e+="    ",null!=(d=this.getExtPolicyConstraints()).reqexp&&(e+=" reqexp="+d.reqexp),null!=d.inhibit&&(e+=" inhibit="+d.inhibit),e+="\n";else if("inhibitAnyPolicy"==u)e+="    skip="+(d=this.getExtInhibitAnyPolicy()).skip+"\n";else if("keyUsage"==u)e+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"==u)e+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n";else if("authorityKeyIdentifier"==u){var f=this.getExtAuthorityKeyIdentifier();void 0!==f.kid&&(e+="    kid="+f.kid.hex+"\n")}else{if("extKeyUsage"==u)e+="    "+this.getExtExtKeyUsage().array.join(", ")+"\n";else if("subjectAltName"==u)e+=r(this.getExtSubjectAltName())+"\n";else if("cRLDistributionPoints"==u)e+=o(this.getExtCRLDistributionPoints());else if("authorityInfoAccess"==u)e+=l(this.getExtAuthorityInfoAccess());else"certificatePolicies"==u&&(e+=i(this.getExtCertificatePolicies()))}}}}return e+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n",e+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"},"string"==typeof e&&(-1!=e.indexOf("-----BEGIN")?this.readCertPEM(e):KJUR.lang.String.isHex(e)&&this.readCertHex(e))}KEYUTIL.getKey=function(e,t,n){var r=(w=ASN1HEX).getChildIdx;w.getV;var i=w.getVbyList,o=KJUR.crypto,l=o.ECDSA,s=o.DSA,a=RSAKey,u=pemtohex,c=KEYUTIL;if(void 0!==a&&e instanceof a)return e;if(void 0!==l&&e instanceof l)return e;if(void 0!==s&&e instanceof s)return e;if(void 0!==e.curve&&void 0!==e.xy&&void 0===e.d)return new l({pub:e.xy,curve:e.curve});if(void 0!==e.curve&&void 0!==e.d)return new l({prv:e.d,curve:e.curve});if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(D=new a).setPublic(e.n,e.e),D;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.co&&void 0===e.qi)return(D=new a).setPrivateEx(e.n,e.e,e.d,e.p,e.q,e.dp,e.dq,e.co),D;if(void 0===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0===e.p)return(D=new a).setPrivate(e.n,e.e,e.d),D;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0===e.x)return(D=new s).setPublic(e.p,e.q,e.g,e.y),D;if(void 0!==e.p&&void 0!==e.q&&void 0!==e.g&&void 0!==e.y&&void 0!==e.x)return(D=new s).setPrivate(e.p,e.q,e.g,e.y,e.x),D;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0===e.d)return(D=new a).setPublic(b64utohex(e.n),b64utohex(e.e)),D;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d&&void 0!==e.p&&void 0!==e.q&&void 0!==e.dp&&void 0!==e.dq&&void 0!==e.qi)return(D=new a).setPrivateEx(b64utohex(e.n),b64utohex(e.e),b64utohex(e.d),b64utohex(e.p),b64utohex(e.q),b64utohex(e.dp),b64utohex(e.dq),b64utohex(e.qi)),D;if("RSA"===e.kty&&void 0!==e.n&&void 0!==e.e&&void 0!==e.d)return(D=new a).setPrivate(b64utohex(e.n),b64utohex(e.e),b64utohex(e.d)),D;if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0===e.d){var h=(E=new l({curve:e.crv})).ecparams.keycharlen,d="04"+("0000000000"+b64utohex(e.x)).slice(-h)+("0000000000"+b64utohex(e.y)).slice(-h);return E.setPublicKeyHex(d),E}if("EC"===e.kty&&void 0!==e.crv&&void 0!==e.x&&void 0!==e.y&&void 0!==e.d){h=(E=new l({curve:e.crv})).ecparams.keycharlen,d="04"+("0000000000"+b64utohex(e.x)).slice(-h)+("0000000000"+b64utohex(e.y)).slice(-h);var f=("0000000000"+b64utohex(e.d)).slice(-h);return E.setPublicKeyHex(d),E.setPrivateKeyHex(f),E}if("pkcs5prv"===n){var p,g=e,w=ASN1HEX;if(9===(p=r(g,0)).length)(D=new a).readPKCS5PrvKeyHex(g);else if(6===p.length)(D=new s).readPKCS5PrvKeyHex(g);else{if(!(p.length>2&&"04"===g.substr(p[1],2)))throw new Error("unsupported PKCS#1/5 hexadecimal key");(D=new l).readPKCS5PrvKeyHex(g)}return D}if("pkcs8prv"===n)return D=c.getKeyFromPlainPrivatePKCS8Hex(e);if("pkcs8pub"===n)return c._getKeyFromPublicPKCS8Hex(e);if("x509pub"===n)return X509.getPublicKeyFromCertHex(e);if(-1!=e.indexOf("-END CERTIFICATE-",0)||-1!=e.indexOf("-END X509 CERTIFICATE-",0)||-1!=e.indexOf("-END TRUSTED CERTIFICATE-",0))return X509.getPublicKeyFromCertPEM(e);if(-1!=e.indexOf("-END PUBLIC KEY-")){var m=pemtohex(e,"PUBLIC KEY");return c._getKeyFromPublicPKCS8Hex(m)}if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var v=u(e,"RSA PRIVATE KEY");return c.getKey(v,null,"pkcs5prv")}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){var y=i(_=u(e,"DSA PRIVATE KEY"),0,[1],"02"),b=i(_,0,[2],"02"),S=i(_,0,[3],"02"),$=i(_,0,[4],"02"),C=i(_,0,[5],"02");return(D=new s).setPrivate(new BigInteger(y,16),new BigInteger(b,16),new BigInteger(S,16),new BigInteger($,16),new BigInteger(C,16)),D}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1==e.indexOf("4,ENCRYPTED")){v=u(e,"EC PRIVATE KEY");return c.getKey(v,null,"pkcs5prv")}if(-1!=e.indexOf("-END PRIVATE KEY-"))return c.getKeyFromPlainPrivatePKCS8PEM(e);if(-1!=e.indexOf("-END RSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var I=c.getDecryptedKeyHex(e,t),x=new RSAKey;return x.readPKCS5PrvKeyHex(I),x}if(-1!=e.indexOf("-END EC PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var E,D=i(_=c.getDecryptedKeyHex(e,t),0,[1],"04"),A=i(_,0,[2,0],"06"),k=i(_,0,[3,0],"03").substr(2);if(void 0===KJUR.crypto.OID.oidhex2name[A])throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+A);return(E=new l({curve:KJUR.crypto.OID.oidhex2name[A]})).setPublicKeyHex(k),E.setPrivateKeyHex(D),E.isPublic=!1,E}if(-1!=e.indexOf("-END DSA PRIVATE KEY-")&&-1!=e.indexOf("4,ENCRYPTED")){var _;y=i(_=c.getDecryptedKeyHex(e,t),0,[1],"02"),b=i(_,0,[2],"02"),S=i(_,0,[3],"02"),$=i(_,0,[4],"02"),C=i(_,0,[5],"02");return(D=new s).setPrivate(new BigInteger(y,16),new BigInteger(b,16),new BigInteger(S,16),new BigInteger($,16),new BigInteger(C,16)),D}if(-1!=e.indexOf("-END ENCRYPTED PRIVATE KEY-"))return c.getKeyFromEncryptedPKCS8PEM(e,t);throw new Error("not supported argument")},KEYUTIL.generateKeypair=function(e,t){if("RSA"==e){var n=t;(l=new RSAKey).generate(n,"10001"),l.isPrivate=!0,l.isPublic=!0;var r=new RSAKey,i=l.n.toString(16),o=l.e.toString(16);return r.setPublic(i,o),r.isPrivate=!1,r.isPublic=!0,(s={}).prvKeyObj=l,s.pubKeyObj=r,s}if("EC"==e){var l,s,a=t,u=new KJUR.crypto.ECDSA({curve:a}).generateKeyPairHex();return(l=new KJUR.crypto.ECDSA({curve:a})).setPublicKeyHex(u.ecpubhex),l.setPrivateKeyHex(u.ecprvhex),l.isPrivate=!0,l.isPublic=!1,(r=new KJUR.crypto.ECDSA({curve:a})).setPublicKeyHex(u.ecpubhex),r.isPrivate=!1,r.isPublic=!0,(s={}).prvKeyObj=l,s.pubKeyObj=r,s}throw new Error("unknown algorithm: "+e)},KEYUTIL.getPEM=function(e,t,n,r,i,o){var l=KJUR,s=l.asn1,a=s.DERObjectIdentifier,u=s.DERInteger,c=s.ASN1Util.newObject,h=s.x509.SubjectPublicKeyInfo,d=l.crypto,f=d.DSA,p=d.ECDSA,g=RSAKey;function w(e){return c({seq:[{int:0},{int:{bigint:e.n}},{int:e.e},{int:{bigint:e.d}},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.dmp1}},{int:{bigint:e.dmq1}},{int:{bigint:e.coeff}}]})}function m(e){return c({seq:[{int:1},{octstr:{hex:e.prvKeyHex}},{tag:["a0",!0,{oid:{name:e.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]}]})}function v(e){return c({seq:[{int:0},{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}},{int:{bigint:e.y}},{int:{bigint:e.x}}]})}if((void 0!==g&&e instanceof g||void 0!==f&&e instanceof f||void 0!==p&&e instanceof p)&&1==e.isPublic&&(void 0===t||"PKCS8PUB"==t))return hextopem($=new h(e).tohex(),"PUBLIC KEY");if("PKCS1PRV"==t&&void 0!==g&&e instanceof g&&(void 0===n||null==n)&&1==e.isPrivate)return hextopem($=w(e).tohex(),"RSA PRIVATE KEY");if("PKCS1PRV"==t&&void 0!==p&&e instanceof p&&(void 0===n||null==n)&&1==e.isPrivate){var y=new a({name:e.curveName}).tohex(),b=m(e).tohex(),S="";return S+=hextopem(y,"EC PARAMETERS"),S+=hextopem(b,"EC PRIVATE KEY")}if("PKCS1PRV"==t&&void 0!==f&&e instanceof f&&(void 0===n||null==n)&&1==e.isPrivate)return hextopem($=v(e).tohex(),"DSA PRIVATE KEY");if("PKCS5PRV"==t&&void 0!==g&&e instanceof g&&void 0!==n&&null!=n&&1==e.isPrivate){var $=w(e).tohex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",$,n,r,o)}if("PKCS5PRV"==t&&void 0!==p&&e instanceof p&&void 0!==n&&null!=n&&1==e.isPrivate){$=m(e).tohex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",$,n,r,o)}if("PKCS5PRV"==t&&void 0!==f&&e instanceof f&&void 0!==n&&null!=n&&1==e.isPrivate){$=v(e).tohex();return void 0===r&&(r="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",$,n,r,o)}var C=function(e,t){var n=I(e,t);return new c({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:n.pbkdf2Salt}},{int:n.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:n.encryptionSchemeIV}}]}]}]},{octstr:{hex:n.ciphertext}}]}).tohex()},I=function(e,t){var n=CryptoJS.lib.WordArray.random(8),r=CryptoJS.lib.WordArray.random(8),i=CryptoJS.PBKDF2(t,n,{keySize:6,iterations:100}),o=CryptoJS.enc.Hex.parse(e),l=CryptoJS.TripleDES.encrypt(o,i,{iv:r})+"",s={};return s.ciphertext=l,s.pbkdf2Salt=CryptoJS.enc.Hex.stringify(n),s.pbkdf2Iter=100,s.encryptionSchemeAlg="DES-EDE3-CBC",s.encryptionSchemeIV=CryptoJS.enc.Hex.stringify(r),s};if("PKCS8PRV"==t&&null!=g&&e instanceof g&&1==e.isPrivate){var x=w(e).tohex();$=c({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:x}}]}).tohex();return void 0===n||null==n?hextopem($,"PRIVATE KEY"):hextopem(b=C($,n),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==t&&void 0!==p&&e instanceof p&&1==e.isPrivate){var E={seq:[{int:1},{octstr:{hex:e.prvKeyHex}}]};"string"==typeof e.pubKeyHex&&E.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+e.pubKeyHex}}]});x=new c(E).tohex(),$=c({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:e.curveName}}]},{octstr:{hex:x}}]}).tohex();return void 0===n||null==n?hextopem($,"PRIVATE KEY"):hextopem(b=C($,n),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==t&&void 0!==f&&e instanceof f&&1==e.isPrivate){x=new u({bigint:e.x}).tohex(),$=c({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:e.p}},{int:{bigint:e.q}},{int:{bigint:e.g}}]}]},{octstr:{hex:x}}]}).tohex();return void 0===n||null==n?hextopem($,"PRIVATE KEY"):hextopem(b=C($,n),"ENCRYPTED PRIVATE KEY")}throw new Error("unsupported object nor format")},KEYUTIL.getKeyFromCSRPEM=function(e){var t=pemtohex(e,"CERTIFICATE REQUEST");return KEYUTIL.getKeyFromCSRHex(t)},KEYUTIL.getKeyFromCSRHex=function(e){var t=KEYUTIL.parseCSRHex(e);return KEYUTIL.getKey(t.p8pubkeyhex,null,"pkcs8pub")},KEYUTIL.parseCSRHex=function(e){var t=ASN1HEX,n=t.getChildIdx,r=t.getTLV,i={},o=e;if("30"!=o.substr(0,2))throw new Error("malformed CSR(code:001)");var l=n(o,0);if(l.length<1)throw new Error("malformed CSR(code:002)");if("30"!=o.substr(l[0],2))throw new Error("malformed CSR(code:003)");var s=n(o,l[0]);if(s.length<3)throw new Error("malformed CSR(code:004)");return i.p8pubkeyhex=r(o,s[2]),i},KEYUTIL.getKeyID=function(e){var t=KEYUTIL,n=ASN1HEX;"string"==typeof e&&-1!=e.indexOf("BEGIN ")&&(e=t.getKey(e));var r=pemtohex(t.getPEM(e)),i=n.getIdxbyList(r,0,[1]),o=n.getV(r,i).substring(2);return KJUR.crypto.Util.hashHex(o,"sha1")},KEYUTIL.getJWK=function(e,t,n,r,i){var o,l,s={},a=KJUR.crypto.Util.hashHex;if("string"==typeof e)o=KEYUTIL.getKey(e),-1!=e.indexOf("CERTIFICATE")&&(l=pemtohex(e));else{if("object"!=typeof e)throw new Error("unsupported keyinfo type");e instanceof X509?(o=e.getPublicKey(),l=e.hex):o=e}if(o instanceof RSAKey&&o.isPrivate)s.kty="RSA",s.n=hextob64u(o.n.toString(16)),s.e=hextob64u(o.e.toString(16)),s.d=hextob64u(o.d.toString(16)),s.p=hextob64u(o.p.toString(16)),s.q=hextob64u(o.q.toString(16)),s.dp=hextob64u(o.dmp1.toString(16)),s.dq=hextob64u(o.dmq1.toString(16)),s.qi=hextob64u(o.coeff.toString(16));else if(o instanceof RSAKey&&o.isPublic)s.kty="RSA",s.n=hextob64u(o.n.toString(16)),s.e=hextob64u(o.e.toString(16));else if(o instanceof KJUR.crypto.ECDSA&&o.isPrivate){if("P-256"!==(c=o.getShortNISTPCurveName())&&"P-384"!==c&&"P-521"!==c)throw new Error("unsupported curve name for JWT: "+c);var u=o.getPublicKeyXYHex();s.kty="EC",s.crv=c,s.x=hextob64u(u.x),s.y=hextob64u(u.y),s.d=hextob64u(o.prvKeyHex)}else if(o instanceof KJUR.crypto.ECDSA&&o.isPublic){var c;if("P-256"!==(c=o.getShortNISTPCurveName())&&"P-384"!==c&&"P-521"!==c)throw new Error("unsupported curve name for JWT: "+c);u=o.getPublicKeyXYHex();s.kty="EC",s.crv=c,s.x=hextob64u(u.x),s.y=hextob64u(u.y)}if(null==s.kty)throw new Error("unsupported keyinfo");return o.isPrivate||1==t||(s.kid=KJUR.jws.JWS.getJWKthumbprint(s)),null!=l&&1!=n&&(s.x5c=[hex2b64(l)]),null!=l&&1!=r&&(s.x5t=b64tob64u(hex2b64(a(l,"sha1")))),null!=l&&1!=i&&(s["x5t#S256"]=b64tob64u(hex2b64(a(l,"sha256")))),s},KEYUTIL.getJWKFromKey=function(e){return KEYUTIL.getJWK(e,!0,!0,!0,!0)},RSAKey.getPosArrayOfChildrenFromHex=function(e){return ASN1HEX.getChildIdx(e,0)},RSAKey.getHexValueArrayOfChildrenFromHex=function(e){var t,n=ASN1HEX.getV,r=n(e,(t=RSAKey.getPosArrayOfChildrenFromHex(e))[0]),i=n(e,t[1]),o=n(e,t[2]),l=n(e,t[3]),s=n(e,t[4]),a=n(e,t[5]),u=n(e,t[6]),c=n(e,t[7]),h=n(e,t[8]);return(t=new Array).push(r,i,o,l,s,a,u,c,h),t},RSAKey.prototype.readPrivateKeyFromPEMString=function(e){var t=pemtohex(e),n=RSAKey.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},RSAKey.prototype.readPKCS5PrvKeyHex=function(e){var t=RSAKey.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},RSAKey.prototype.readPKCS8PrvKeyHex=function(e){var t,n,r,i,o,l,s,a,u=ASN1HEX,c=u.getVbyListEx;if(!1===u.isASN1HEX(e))throw new Error("not ASN.1 hex string");try{t=c(e,0,[2,0,1],"02"),n=c(e,0,[2,0,2],"02"),r=c(e,0,[2,0,3],"02"),i=c(e,0,[2,0,4],"02"),o=c(e,0,[2,0,5],"02"),l=c(e,0,[2,0,6],"02"),s=c(e,0,[2,0,7],"02"),a=c(e,0,[2,0,8],"02")}catch(e){throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(t,n,r,i,o,l,s,a)},RSAKey.prototype.readPKCS5PubKeyHex=function(e){var t=ASN1HEX,n=t.getV;if(!1===t.isASN1HEX(e))throw new Error("keyHex is not ASN.1 hex string");var r=t.getChildIdx(e,0);if(2!==r.length||"02"!==e.substr(r[0],2)||"02"!==e.substr(r[1],2))throw new Error("wrong hex for PKCS#5 public key");var i=n(e,r[0]),o=n(e,r[1]);this.setPublic(i,o)},RSAKey.prototype.readPKCS8PubKeyHex=function(e){var t=ASN1HEX;if(!1===t.isASN1HEX(e))throw new Error("not ASN.1 hex string");if("06092a864886f70d010101"!==t.getTLVbyListEx(e,0,[0,0]))throw new Error("not PKCS8 RSA public key");var n=t.getTLVbyListEx(e,0,[1,0]);this.readPKCS5PubKeyHex(n)},RSAKey.prototype.readCertPubKeyHex=function(e,t){var n,r;(n=new X509).readCertHex(e),r=n.getPublicKeyHex(),this.readPKCS8PubKeyHex(r)},RSAKey.prototype.sign=function(e,t){var n=function(e){return KJUR.crypto.Util.hashString(e,t)}(e);return this.signWithMessageHash(n,t)},RSAKey.prototype.signWithMessageHash=function(e,t){var n=parseBigInt(KJUR.crypto.Util.getPaddedDigestInfoHex(e,t,this.n.bitLength()),16);return _zeroPaddingOfSignature(this.doPrivate(n).toString(16),this.n.bitLength())},RSAKey.prototype.signPSS=function(e,t,n){var r,i=(r=rstrtohex(e),KJUR.crypto.Util.hashHex(r,t));return void 0===n&&(n=-1),this.signWithMessageHashPSS(i,t,n)},RSAKey.prototype.signWithMessageHashPSS=function(e,t,n){var r,i=hextorstr(e),o=i.length,l=this.n.bitLength()-1,s=Math.ceil(l/8),a=function(e){return KJUR.crypto.Util.hashHex(e,t)};if(-1===n||void 0===n)n=o;else if(-2===n)n=s-o-2;else if(n<-2)throw new Error("invalid salt length");if(s<o+n+2)throw new Error("data too long");var u="";n>0&&(u=new Array(n),(new SecureRandom).nextBytes(u),u=String.fromCharCode.apply(String,u));var c=hextorstr(a(rstrtohex("\0\0\0\0\0\0\0\0"+i+u))),h=[];for(r=0;r<s-n-o-2;r+=1)h[r]=0;var d=String.fromCharCode.apply(String,h)+""+u,f=pss_mgf1_str(c,d.length,a),p=[];for(r=0;r<d.length;r+=1)p[r]=d.charCodeAt(r)^f.charCodeAt(r);var g=65280>>8*s-l&255;for(p[0]&=~g,r=0;r<o;r++)p.push(c.charCodeAt(r));return p.push(188),_zeroPaddingOfSignature(this.doPrivate(new BigInteger(p)).toString(16),this.n.bitLength())},RSAKey.prototype.verify=function(e,t){if(null==(t=t.toLowerCase()).match(/^[0-9a-f]+$/))return!1;var n=parseBigInt(t,16),r=this.n.bitLength();if(n.bitLength()>r)return!1;var i=this.doPublic(n).toString(16);if(i.length+3!=r/4)return!1;var o=_rsasign_getAlgNameAndHashFromHexDisgestInfo(i.replace(/^1f+00/,""));if(0==o.length)return!1;var l=o[0],s=o[1],a=function(e){return KJUR.crypto.Util.hashString(e,l)}(e);return s==a},RSAKey.prototype.verifyWithMessageHash=function(e,t){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var n=parseBigInt(t,16);if(n.bitLength()>this.n.bitLength())return 0;var r=_rsasign_getAlgNameAndHashFromHexDisgestInfo(this.doPublic(n).toString(16).replace(/^1f+00/,""));return 0!=r.length&&(r[0],r[1]==e)},RSAKey.prototype.verifyPSS=function(e,t,n,r){var i=function(e){return KJUR.crypto.Util.hashHex(e,n)}(rstrtohex(e));return void 0===r&&(r=-1),this.verifyWithMessageHashPSS(i,t,n,r)},RSAKey.prototype.verifyWithMessageHashPSS=function(e,t,n,r){if(t.length!=Math.ceil(this.n.bitLength()/4))return!1;var i,o=new BigInteger(t,16),l=function(e){return KJUR.crypto.Util.hashHex(e,n)},s=hextorstr(e),a=s.length,u=this.n.bitLength()-1,c=Math.ceil(u/8);if(-1===r||void 0===r)r=a;else if(-2===r)r=c-a-2;else if(r<-2)throw new Error("invalid salt length");if(c<a+r+2)throw new Error("data too long");var h=this.doPublic(o).toByteArray();for(i=0;i<h.length;i+=1)h[i]&=255;for(;h.length<c;)h.unshift(0);if(188!==h[c-1])throw new Error("encoded message does not end in 0xbc");var d=(h=String.fromCharCode.apply(String,h)).substr(0,c-a-1),f=h.substr(d.length,a),p=65280>>8*c-u&255;if(0!=(d.charCodeAt(0)&p))throw new Error("bits beyond keysize not zero");var g=pss_mgf1_str(f,d.length,l),w=[];for(i=0;i<d.length;i+=1)w[i]=d.charCodeAt(i)^g.charCodeAt(i);w[0]&=~p;var m=c-a-r-2;for(i=0;i<m;i+=1)if(0!==w[i])throw new Error("leftmost octets not zero");if(1!==w[m])throw new Error("0x01 marker not found");return f===hextorstr(l(rstrtohex("\0\0\0\0\0\0\0\0"+s+String.fromCharCode.apply(String,w.slice(-r)))))},RSAKey.SALT_LEN_HLEN=-1,RSAKey.SALT_LEN_MAX=-2,RSAKey.SALT_LEN_RECOVER=-2,X509.EXT_PARSER={},X509.registExtParser=function(e,t){X509.EXT_PARSER[e]=t},X509.hex2dn=function(e,t){void 0===t&&(t=0);var n=new X509;return ASN1HEX.getTLV(e,t),n.getX500Name(e).str},X509.hex2rdn=function(e,t){if(void 0===t&&(t=0),"31"!==e.substr(t,2))throw new Error("malformed RDN");for(var n=new Array,r=ASN1HEX.getChildIdx(e,t),i=0;i<r.length;i++)n.push(X509.hex2attrTypeValue(e,r[i]));return(n=n.map((function(e){return e.replace("+","\\+")}))).join("+")},X509.hex2attrTypeValue=function(e,t){var n=ASN1HEX,r=n.getV;if(void 0===t&&(t=0),"30"!==e.substr(t,2))throw new Error("malformed attribute type and value");var i=n.getChildIdx(e,t);2!==i.length||e.substr(i[0],2);var o=r(e,i[0]),l=KJUR.asn1.ASN1Util.oidHexToInt(o);return KJUR.asn1.x509.OID.oid2atype(l)+"="+hextorstr(r(e,i[1]))},X509.getPublicKeyFromCertHex=function(e){var t=new X509;return t.readCertHex(e),t.getPublicKey()},X509.getPublicKeyFromCertPEM=function(e){var t=new X509;return t.readCertPEM(e),t.getPublicKey()},X509.getPublicKeyInfoPropOfCertPEM=function(e){var t,n,r=ASN1HEX.getVbyList,i={};return i.algparam=null,(t=new X509).readCertPEM(e),n=t.getPublicKeyHex(),i.keyhex=r(n,0,[1],"03").substr(2),i.algoid=r(n,0,[0,0],"06"),"2a8648ce3d0201"===i.algoid&&(i.algparam=r(n,0,[0,1],"06")),i},X509.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWS=function(){var e=KJUR.jws.JWS.isSafeJSONString;this.parseJWS=function(t,n){if(void 0===this.parsedJWS||!n&&void 0===this.parsedJWS.sigvalH){var r=t.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==r)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var i=r[1],o=r[2],l=r[3],s=i+"."+o;if(this.parsedJWS={},this.parsedJWS.headB64U=i,this.parsedJWS.payloadB64U=o,this.parsedJWS.sigvalB64U=l,this.parsedJWS.si=s,!n){var a=b64utohex(l),u=parseBigInt(a,16);this.parsedJWS.sigvalH=a,this.parsedJWS.sigvalBI=u}var c=b64utoutf8(i),h=b64utoutf8(o);if(this.parsedJWS.headS=c,this.parsedJWS.payloadS=h,!e(c,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+c}}},KJUR.jws.JWS.sign=function(e,t,n,r,i){var o=KJUR,l=o.jws.JWS,s=l.readSafeJSONString,a=l.isSafeJSONString,u=o.crypto;u.ECDSA;var c,h,d,f=u.Mac,p=u.Signature,g=JSON;if("string"!=typeof t&&"object"!=typeof t)throw"spHeader must be JSON string or object: "+t;if("object"==typeof t&&(h=t,c=g.stringify(h)),"string"==typeof t){if(!a(c=t))throw"JWS Head is not safe JSON string: "+c;h=s(c)}if(d=n,"object"==typeof n&&(d=g.stringify(n)),""!=e&&null!=e||void 0===h.alg||(e=h.alg),""!=e&&null!=e&&void 0===h.alg&&(h.alg=e,c=g.stringify(h)),e!==h.alg)throw"alg and sHeader.alg doesn't match: "+e+"!="+h.alg;var w=null;if(void 0===l.jwsalg2sigalg[e])throw"unsupported alg name: "+e;w=l.jwsalg2sigalg[e];var m=utf8tob64u(c)+"."+utf8tob64u(d),v="";if("Hmac"==w.substr(0,4)){if(void 0===r)throw"mac key shall be specified for HS* alg";var y=new f({alg:w,prov:"cryptojs",pass:r});y.updateString(m),v=y.doFinal()}else if(-1!=w.indexOf("withECDSA")){(S=new p({alg:w})).init(r,i),S.updateString(m);var b=S.sign();v=KJUR.crypto.ECDSA.asn1SigToConcatSig(b)}else{var S;if("none"!=w)(S=new p({alg:w})).init(r,i),S.updateString(m),v=S.sign()}return m+"."+hextob64u(v)},KJUR.jws.JWS.verify=function(e,t,n){var r,i=KJUR,o=i.jws.JWS,l=o.readSafeJSONString,s=i.crypto,a=s.ECDSA,u=s.Mac,c=s.Signature;if(void 0!==typeof RSAKey&&(r=RSAKey),!isBase64URLDot(e))return!1;var h=e.split(".");if(3!==h.length)return!1;var d=h[0]+"."+h[1],f=b64utohex(h[2]),p=l(b64utoutf8(h[0])),g=null,w=null;if(void 0===p.alg)throw"algorithm not specified in header";if((w=(g=p.alg).substr(0,2),null!=n&&"[object Array]"===Object.prototype.toString.call(n)&&n.length>0)&&-1==(":"+n.join(":")+":").indexOf(":"+g+":"))throw"algorithm '"+g+"' not accepted in the list";if("none"!=g&&null===t)throw"key shall be specified to verify.";if("string"==typeof t&&-1!=t.indexOf("-----BEGIN ")&&(t=KEYUTIL.getKey(t)),!("RS"!=w&&"PS"!=w||t instanceof r))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==w&&!(t instanceof a))throw"key shall be a ECDSA obj for ES* algs";var m=null;if(void 0===o.jwsalg2sigalg[p.alg])throw"unsupported alg name: "+g;if("none"==(m=o.jwsalg2sigalg[g]))throw"not supported";if("Hmac"==m.substr(0,4)){if(void 0===t)throw"hexadecimal key shall be specified for HMAC";var v=new u({alg:m,pass:t});return v.updateString(d),f==v.doFinal()}if(-1!=m.indexOf("withECDSA")){var y,b=null;try{b=a.concatSigToASN1Sig(f)}catch(e){return!1}return(y=new c({alg:m})).init(t),y.updateString(d),y.verify(b)}return(y=new c({alg:m})).init(t),y.updateString(d),y.verify(f)},KJUR.jws.JWS.parse=function(e){var t,n,r,i=e.split("."),o={};if(2!=i.length&&3!=i.length)throw"malformed sJWS: wrong number of '.' splitted elements";return t=i[0],n=i[1],3==i.length&&(r=i[2]),o.headerObj=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(t)),o.payloadObj=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(n)),o.headerPP=JSON.stringify(o.headerObj,null,"  "),null==o.payloadObj?o.payloadPP=b64utoutf8(n):o.payloadPP=JSON.stringify(o.payloadObj,null,"  "),void 0!==r&&(o.sigHex=b64utohex(r)),o},KJUR.jws.JWS.verifyJWT=function(e,t,n){var r=KJUR.jws,i=r.JWS,o=i.readSafeJSONString,l=i.inArray,s=i.includedArray;if(!isBase64URLDot(e))return!1;var a=e.split(".");if(3!=a.length)return!1;var u=a[0],c=a[1];b64utohex(a[2]);var h=o(b64utoutf8(u)),d=o(b64utoutf8(c));if(void 0===h.alg)return!1;if(void 0===n.alg)throw"acceptField.alg shall be specified";if(!l(h.alg,n.alg))return!1;if(void 0!==d.iss&&"object"==typeof n.iss&&!l(d.iss,n.iss))return!1;if(void 0!==d.sub&&"object"==typeof n.sub&&!l(d.sub,n.sub))return!1;if(void 0!==d.aud&&"object"==typeof n.aud)if("string"==typeof d.aud){if(!l(d.aud,n.aud))return!1}else if("object"==typeof d.aud&&!s(d.aud,n.aud))return!1;var f=r.IntDate.getNow();return void 0!==n.verifyAt&&"number"==typeof n.verifyAt&&(f=n.verifyAt),void 0!==n.gracePeriod&&"number"==typeof n.gracePeriod||(n.gracePeriod=0),!(void 0!==d.exp&&"number"==typeof d.exp&&d.exp+n.gracePeriod<f)&&(!(void 0!==d.nbf&&"number"==typeof d.nbf&&f<d.nbf-n.gracePeriod)&&(!(void 0!==d.iat&&"number"==typeof d.iat&&f<d.iat-n.gracePeriod)&&((void 0===d.jti||void 0===n.jti||d.jti===n.jti)&&!!i.verify(e,t,n.alg))))},KJUR.jws.JWS.includedArray=function(e,t){var n=KJUR.jws.JWS.inArray;if(null===e)return!1;if("object"!=typeof e)return!1;if("number"!=typeof e.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t))return!1;return!0},KJUR.jws.JWS.inArray=function(e,t){if(null===t)return!1;if("object"!=typeof t)return!1;if("number"!=typeof t.length)return!1;for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},KJUR.jws.JWS.isSafeJSONString=function(e,t,n){var r=null;try{return"object"!=typeof(r=jsonParse(e))||r.constructor===Array?0:(t&&(t[n]=r),1)}catch(e){return 0}},KJUR.jws.JWS.readSafeJSONString=function(e){var t=null;try{return"object"!=typeof(t=jsonParse(e))||t.constructor===Array?null:t}catch(e){return null}},KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(e){var t=e.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==t)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return t[1]},KJUR.jws.JWS.getJWKthumbprint=function(e){if("RSA"!==e.kty&&"EC"!==e.kty&&"oct"!==e.kty)throw"unsupported algorithm for JWK Thumprint";var t="{";if("RSA"===e.kty){if("string"!=typeof e.n||"string"!=typeof e.e)throw"wrong n and e value for RSA key";t+='"e":"'+e.e+'",',t+='"kty":"'+e.kty+'",',t+='"n":"'+e.n+'"}'}else if("EC"===e.kty){if("string"!=typeof e.crv||"string"!=typeof e.x||"string"!=typeof e.y)throw"wrong crv, x and y value for EC key";t+='"crv":"'+e.crv+'",',t+='"kty":"'+e.kty+'",',t+='"x":"'+e.x+'",',t+='"y":"'+e.y+'"}'}else if("oct"===e.kty){if("string"!=typeof e.k)throw"wrong k value for oct(symmetric) key";t+='"kty":"'+e.kty+'",',t+='"k":"'+e.k+'"}'}var n=rstrtohex(t);return hextob64u(KJUR.crypto.Util.hashHex(n,"sha256"))},KJUR.jws.IntDate={},KJUR.jws.IntDate.get=function(e){var t=KJUR.jws.IntDate,n=t.getNow,r=t.getZulu;if("now"==e)return n();if("now + 1hour"==e)return n()+3600;if("now + 1day"==e)return n()+86400;if("now + 1month"==e)return n()+2592e3;if("now + 1year"==e)return n()+31536e3;if(e.match(/Z$/))return r(e);if(e.match(/^[0-9]+$/))return parseInt(e);throw"unsupported format: "+e},KJUR.jws.IntDate.getZulu=function(e){return zulutosec(e)},KJUR.jws.IntDate.getNow=function(){return~~(new Date/1e3)},KJUR.jws.IntDate.intDate2UTCString=function(e){return new Date(1e3*e).toUTCString()},KJUR.jws.IntDate.intDate2Zulu=function(e){var t=new Date(1e3*e);return("0000"+t.getUTCFullYear()).slice(-4)+("00"+(t.getUTCMonth()+1)).slice(-2)+("00"+t.getUTCDate()).slice(-2)+("00"+t.getUTCHours()).slice(-2)+("00"+t.getUTCMinutes()).slice(-2)+("00"+t.getUTCSeconds()).slice(-2)+"Z"},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWSJS=function(){var e=KJUR.jws.JWS,t=e.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(e){this.init();var t=e.split(".");if(3!=t.length)throw"malformed input JWS";this.aHeader.push(t[0]),this.sPayload=t[1],this.aSignature.push(t[2])},this.addSignature=function(e,t,n,r){if(void 0===this.sPayload||null===this.sPayload)throw"there's no JSON-JS signature to add.";var i=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var o=KJUR.jws.JWS.sign(e,t,this.sPayload,n,r).split(".");o[0],o[2];this.aHeader.push(o[0]),this.aSignature.push(o[2])}catch(e){throw this.aHeader.length>i&&this.aHeader.pop(),this.aSignature.length>i&&this.aSignature.pop(),"addSignature failed: "+e}},this.verifyAll=function(e){if(this.aHeader.length!==e.length||this.aSignature.length!==e.length)return!1;for(var t=0;t<e.length;t++){var n=e[t];if(2!==n.length)return!1;if(!1===this.verifyNth(t,n[0],n[1]))return!1}return!0},this.verifyNth=function(t,n,r){if(this.aHeader.length<=t||this.aSignature.length<=t)return!1;var i=this.aHeader[t],o=this.aSignature[t],l=i+"."+this.sPayload+"."+o,s=!1;try{s=e.verify(l,n,r)}catch(e){return!1}return s},this.readJWSJS=function(e){if("string"==typeof e){var n=t(e);if(null==n)throw"argument is not safe JSON object string";this.aHeader=n.headers,this.sPayload=n.payload,this.aSignature=n.signatures}else try{if(!(e.headers.length>0))throw"malformed header";if(this.aHeader=e.headers,"string"!=typeof e.payload)throw"malformed signatures";if(this.sPayload=e.payload,!(e.signatures.length>0))throw"malformed signatures";this.aSignature=e.signatures}catch(e){throw"malformed JWS-JS JSON object: "+e}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return 0==this.aHeader.length?1:0}},KJUR.crypto.ECDSA,KJUR.crypto.DSA,KJUR.crypto.Signature,KJUR.crypto.MessageDigest,KJUR.crypto.Mac,KJUR.crypto.Cipher;var b64utoutf8_1=b64utoutf8,KJUR_1=KJUR;KJUR.crypto,KJUR.asn1,KJUR.jws,KJUR.lang;class LicenseController{constructor(){this._key=[52,50,52,50,52,50]}verifyLicense(e){if(!e||"string"!=typeof e)return{valid:!1};return{valid:KJUR_1.jws.JWS.verifyJWT(e,this.key,{alg:["HS256"]})}}getLicensePayload(e){if(!e)throw new Error("No license key was provided");const t=KJUR_1.jws.JWS.readSafeJSONString(b64utoutf8_1(e.split(".")[1]));if(!t||"string"!=typeof t.type||"number"!=typeof t.expiration)throw new Error("The license key payload is invalid");return t.type=t.type.toLowerCase(),t}checkExpired(e){if(!e||"number"!=typeof e)return!1;return e<=Math.floor((new Date).getTime()/1e3)}get key(){return String.fromCharCode(...this._key)}}class Builder{constructor(e,t,n,r){this.glueController=e,this.sessionStore=t,this.windowsController=n,this.workspacesController=r}get logger(){return logger.get("layouts.builder")}saveGlobalLayout(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){const o=yield this.getRawWindowsLayoutData({layoutType:"Global",layoutName:e.layout.name,context:e.layout.context,instances:e.layout.instances,ignoreInstances:e.layout.ignoreInstances},t);null===(n=this.logger)||void 0===n||n.trace(`[${t}] received valid data for the eligible windows`);const l=yield this.glueController.getLayout(e.layout.name),s=l?yield this.updateLayout(l,e.layout,o.windows,t):yield this.buildNewLayout(e.layout,o.windows,t);return null===(r=this.logger)||void 0===r||r.trace(`[${t}] the layout object was constructed, importing.`),yield this.glueController.importLayout(s),null===(i=this.logger)||void 0===i||i.trace(`[${t}] the import for layout: ${s.name} was completed, responding.`),s}))}updateLayout(e,t,n,r){var i,o,l,s,a;return __awaiter$7(this,void 0,void 0,(function*(){null===(i=this.logger)||void 0===i||i.trace(`[${r}] updating an existing layout with name ${t.name}`),e.context=null!==(o=t.context)&&void 0!==o?o:{},e.metadata=null!==(l=t.metadata)&&void 0!==l?l:{};const u=n.filter((e=>!!e.layoutComponentId)).map((e=>e.layoutComponentId)),c=this.getLayoutIdOccurrenceMap(u),h=n.map((t=>this.generateWindowComponent(e,t,c,r)));null===(s=this.logger)||void 0===s||s.trace(`[${r}] the window components are completed, we have ${h.length} windows for the layout`);const d={layoutName:t.name,layoutType:"Global",context:t.context},f=e.components.filter((e=>"workspaceFrame"===e.type)),p=yield this.compileWorkspacesFrameComponents(f,d,r);return null===(a=this.logger)||void 0===a||a.trace(`[${r}] the workspaces frame components are completed, we have ${p.length} frames for the layout`),e.components=[],e.components.push(...h),e.components.push(...p),e}))}buildNewLayout(e,t,n){var r,i,o,l,s;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`[${n}] build a brand new layout with name ${e.name}`);const a={name:e.name,type:"Global",context:null!==(i=e.context)&&void 0!==i?i:{},metadata:null!==(o=e.metadata)&&void 0!==o?o:{},components:[],version:2},u=t.map((e=>this.buildNewWindowComponent(e,n)));null===(l=this.logger)||void 0===l||l.trace(`[${n}] the window components are completed, we have ${u.length} windows for the layout`);const c={layoutName:e.name,layoutType:"Global",context:e.context},h=yield this.compileWorkspacesFrameComponents([],c,n);return null===(s=this.logger)||void 0===s||s.trace(`[${n}] the workspaces frame components are completed, we have ${h.length} frames for the layout`),a.components.push(...u),a.components.push(...h),a}))}getRawWindowsLayoutData(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling send save requests for layout: ${e.layoutName} to instances: ${null===(r=e.instances)||void 0===r?void 0:r.join(", ")}`);const o={windows:[...yield Promise.all(this.getEligibleGlueWindows(e.instances,e.ignoreInstances).map((n=>this.buildRawGlueWindowData(n,e,t)))),...yield Promise.all(this.getEligibleNonGlueWindows(e.instances,e.ignoreInstances).map((e=>this.buildRawNonGlueWindowData(e))))]};return null===(i=this.logger)||void 0===i||i.trace(`[${t}] request completed, responding to the caller`),o}))}buildRawGlueWindowData(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){const i=`Cannot fetch the layout save data from: ${e.name} with id: ${e.windowId}`;if(!e.initialUrl)throw new Error(`Missing URL for client: ${e.name}`);const o=yield PromiseWrap((()=>__awaiter$7(this,void 0,void 0,(function*(){try{return yield this.glueController.callWindow("layouts",{name:"clientSaveRequest",execute:()=>__awaiter$7(this,void 0,void 0,(function*(){}))},t,{windowId:e.windowId})}catch(e){return{}}}))),15e3,i),l=this.sessionStore.getAllInstancesData().find((t=>t.id===e.windowId));return{bounds:yield this.windowsController.getWindowBounds(e.windowId,n),windowContext:null!==(r=o.windowContext)&&void 0!==r?r:{},url:e.initialUrl,name:e.name,application:l?l.applicationName:defaultNoAppWindowComponentAppName,initialContext:e.initialContext,windowId:e.windowId,layoutComponentId:e.layoutComponentId}}))}buildRawNonGlueWindowData(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){if(!e.initialUrl)throw new Error(`Missing URL for client: ${e.name}`);const n=this.sessionStore.getAllInstancesData().find((t=>t.id===e.windowId));return{bounds:null!==(t=e.initialBounds)&&void 0!==t?t:defaultPlatformConfig.windows.defaultWindowOpenBounds,windowContext:{},url:e.initialUrl,name:e.name,application:n?n.applicationName:defaultNoAppWindowComponentAppName,initialContext:e.initialContext,windowId:e.windowId,layoutComponentId:e.layoutComponentId}}))}getEligibleNonGlueWindows(e,t){const n=this.getAllEligibleWindows(e,t),r=this.sessionStore.getAllNonGlue(),i=this.sessionStore.pickWorkspaceClients((()=>!0));return n.filter((e=>r.some((t=>t.windowId===e.windowId))&&i.every((t=>t.windowId!==e.windowId))))}getEligibleGlueWindows(e,t){const n=this.getAllEligibleWindows(e,t),r=this.sessionStore.getAllNonGlue(),i=this.sessionStore.pickWorkspaceClients((()=>!0));return n.filter((e=>i.every((t=>t.windowId!==e.windowId))&&r.every((t=>t.windowId!==e.windowId))))}getAllEligibleWindows(e,t){let n=this.sessionStore.getAllWindowsData().filter((e=>"Platform"!==e.name));if(e&&e.length){const t=this.glueController.getServers().filter((t=>e.some((e=>t.instance===e))));n=n.filter((e=>t.some((t=>t.windowId===e.windowId))))}if(t&&t.length){const e=this.glueController.getServers().filter((e=>t.some((t=>e.instance===t))));n=n.filter((t=>e.every((e=>e.windowId!==t.windowId))))}return n}updateExistingWindowComponent(e,t,n){var r,i;return null===(r=this.logger)||void 0===r||r.trace(`[${n}] performing a soft update on am existing component ${e.application} with id ${e.state.instanceId}`),e.state.context=t.windowContext?t.windowContext:e.state.context,e.state.bounds=t.bounds,e.state.createArgs.context=t.initialContext?t.initialContext:null===(i=e.state.createArgs)||void 0===i?void 0:i.context,e.state.instanceId=e.state.instanceId?e.state.instanceId:t.windowId,e}buildNewWindowComponent(e,t){var n,r,i;return null===(n=this.logger)||void 0===n||n.trace(`[${t}] building a brand new component ${e.application} with id ${e.windowId}`),{type:"window",componentType:"application",application:e.application,state:{context:null!==(r=e.windowContext)&&void 0!==r?r:{},bounds:e.bounds,createArgs:{name:e.name,url:e.url,context:null!==(i=e.initialContext)&&void 0!==i?i:{}},windowState:"Normal",restoreState:"Normal",restoreSettings:{groupId:"glue_42_core",groupZOrder:0},instanceId:e.windowId,isSticky:!0,isCollapsed:!1}}}compileWorkspacesFrameComponents(e,t,n){var r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`[${n}] requesting information about all running workspaces frames`);const o=yield this.getAllFramesSnapshotsWithBounds(t,n);null===(i=this.logger)||void 0===i||i.trace(`[${n}] got information on ${o.length} frames, composing the frame components`);const l=o.filter((e=>{var t;return!!(null===(t=e.config)||void 0===t?void 0:t.layoutComponentId)})).map((e=>e.config.layoutComponentId)),s=this.getLayoutIdOccurrenceMap(l);return o.map((t=>this.generateFrameComponent(t,e,s,n)))}))}getLayoutIdOccurrenceMap(e){const t={};return e.forEach((e=>{t[e]?t[e]=1+t[e]:t[e]=1})),t}softUpdateFrameComponent(e,t,n,r){var i;return null===(i=this.logger)||void 0===i||i.trace(`[${r}] performing a soft update on am existing frame component ${e.state.instanceId}`),e.state.bounds=t.bounds,e.state.selectedWorkspace=-1===n?0:n,e.state.workspaces=t.snapshot.workspaces,e.state.context=Object.assign({},e.state.context,{isPlatform:t.config.isPlatform}),e}createNewFrameComponent(e,t,n){var r;return null===(r=this.logger)||void 0===r||r.trace(`[${n}] building a new frame component ${e.snapshot.id}`),{type:"workspaceFrame",application:"workspaces-demo",componentType:"application",state:{context:{isPlatform:e.config.isPlatform},bounds:e.bounds,instanceId:e.snapshot.id,selectedWorkspace:-1===t?0:t,workspaces:e.snapshot.workspaces,restoreState:"Normal",windowState:"Normal"}}}generateWindowComponent(e,t,n,r){const i=e.components.find((e=>"window"===e.type&&e.state.instanceId===t.layoutComponentId)),o=t.layoutComponentId?n[t.layoutComponentId]:0;return i&&o<2?this.updateExistingWindowComponent(i,t,r):this.buildNewWindowComponent(t,r)}generateFrameComponent(e,t,n,r){const i=e.snapshot.workspaces.findIndex((e=>{var t;return null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.isSelected})),o=t.find((t=>t.state.instanceId===e.config.layoutComponentId)),l=e.config.layoutComponentId?n[e.config.layoutComponentId]:0;return o&&l<2?this.softUpdateFrameComponent(o,e,i,r):this.createNewFrameComponent(e,i,r)}getAllFramesSnapshotsWithBounds(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=(yield this.workspacesController.getAllFramesSummaries(void 0,t)).summaries||[];return yield Promise.all(n.map((n=>__awaiter$7(this,void 0,void 0,(function*(){const r=yield this.workspacesController.handleGetWorkspacesLayouts(Object.assign({frameId:n.id},e),t),i=yield this.workspacesController.getFrameSessionData({frameId:n.id},t);return{bounds:(yield this.workspacesController.getFrameBounds({itemId:n.id},t)).bounds,snapshot:{id:n.id,workspaces:r.workspaces,config:{}},config:{isPlatform:null==i?void 0:i.isPlatform,layoutComponentId:null==i?void 0:i.layoutComponentId}}})))))}))}}class Restorer{constructor(e,t,n,r){this.glueController=e,this.validator=t,this.resetter=n,this.workspacesController=r}get logger(){return logger.get("layouts.restorer")}restoreGlobalLayout(e,t,n,r){var i,o,l;return __awaiter$7(this,void 0,void 0,(function*(){const s=yield this.glueController.getLayout(e.layout.name);if(!s)throw new Error(`Cannot restore layout: ${e.layout.name}, because it was not found in this platform`);if("Global"!==s.type)throw new Error(`Cannot restore layout: ${e.layout.name}, because it is not a Global Layout`);if(!n||!r)throw new Error(`Cannot restore layout: ${e.layout.name}, because the callerId or callerType are missing`);yield this.validator.doInitialValidation(s,t),null===(i=this.logger)||void 0===i||i.trace(`[${t}] the initial validation of the compliancy of the layout was completed`),yield this.closeInstances(r,n,t,e.layout.closeMe,e.layout.closeRunningInstances),null===(o=this.logger)||void 0===o||o.trace(`[${t}] closed all necessary running instances`),yield this.restore(s,e,t),null===(l=this.logger)||void 0===l||l.trace(`[${t}] the layout ${s.name} was restored`)}))}closeInstances(e,t,n,r,i){return __awaiter$7(this,void 0,void 0,(function*(){(void 0===i||i)&&(yield this.resetter.closeAllExceptCaller(t,n));(r||void 0===r&&void 0===i||void 0===r&&i)&&(yield this.resetter.closeCaller(e,t,n))}))}restore(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){null===(r=this.logger)||void 0===r||r.trace(`[${n}] starting the restore process of ${e.name}`);const i=(yield this.canPlatformFrameAcceptComponent(n))?this.pickComponentForPlatformFrame(e.components.filter((e=>"workspaceFrame"===e.type))):null,o=Promise.all(e.components.map((r=>{if("window"===r.type)return this.restoreWindowComponent(r,n,e.context,t.layout.context);if("workspaceFrame"===r.type){const o=i===r;return this.restoreWorkspaceFrameComponent(r,n,e.context,t.layout.context,o)}})));yield o}))}restoreWindowComponent(e,t,n,r){var i,o,l,s;return __awaiter$7(this,void 0,void 0,(function*(){null===(i=this.logger)||void 0===i||i.trace(`[${t}] restoring window component ${e.application} with id ${e.state.instanceId} and bounds: ${JSON.stringify(e.state.bounds)}`);const a=Object.assign({},n,e.state.context,e.state.createArgs.context,r),u=e.state.bounds,c=yield this.checkTargetBoundsPossible(u);c.isPossible||null===(o=this.logger)||void 0===o||o.warn(`Restoring ${e.application} not possible with the saved bounds, falling back to default bounds`);const h=c.isPossible?u:void 0;null===(l=this.logger)||void 0===l||l.trace(`[${t}] calling the respective glue open/start method`);const d=e.application===defaultNoAppWindowComponentAppName?this.glueController.openWindow({name:e.state.createArgs.name,url:e.state.createArgs.url,layoutComponentId:e.state.instanceId,context:a,bounds:h}):this.glueController.startApp({name:e.application,layoutComponentId:e.state.instanceId,context:a,bounds:h});null===(s=this.logger)||void 0===s||s.trace(`[${t}] the component was started`),yield d}))}restoreWorkspaceFrameComponent(e,t,n,r,i){var o,l,s,a,u,c;return __awaiter$7(this,void 0,void 0,(function*(){null===(o=this.logger)||void 0===o||o.trace(`[${t}] restoring workspace frame component $with id ${e.state.instanceId} and bounds: ${JSON.stringify(e.state.bounds)}`);const h=i?null===(l=yield this.getPlatformFrame(t))||void 0===l?void 0:l.id:void 0,d=yield this.createFrameWithWorkspaceComponents(e,h);null===(s=this.logger)||void 0===s||s.trace(`[${t}] the frame was restored, selecting the correct workspace`);const f=yield d.workspaces();yield null===(a=f[e.state.selectedWorkspace])||void 0===a?void 0:a.focus(),null===(u=this.logger)||void 0===u||u.trace(`[${t}] the correct workspace was selected, restoring the workspaces context`);const p=Object.assign({},n,r);yield Promise.all(f.map((e=>e.updateContext(p)))),null===(c=this.logger)||void 0===c||c.trace(`[${t}] the frame component ${e.state.instanceId} is restored`)}))}canPlatformFrameAcceptComponent(e){return __awaiter$7(this,void 0,void 0,(function*(){const t=yield this.getPlatformFrame(e);if(!t)return!1;const n=yield t.workspaces();return 1===n.length&&0===n[0].getAllWindows().length}))}pickComponentForPlatformFrame(e){if(0===e.length)return;return e.find((e=>{var t;return null===(t=e.state.context)||void 0===t?void 0:t.isPlatform}))||e[0]}checkTargetBoundsPossible(e){return __awaiter$7(this,void 0,void 0,(function*(){if(window.gtf)return{isPossible:!0};return(yield window.getScreenDetails()).screens.find((t=>{const n=e.left>=t.left&&e.left<=t.left+t.width,r=e.top>=t.top&&e.top<=t.top+t.height;return n&&r}))?{isPossible:!0}:{isPossible:!1}}))}getPlatformFrame(e){return __awaiter$7(this,void 0,void 0,(function*(){if(!this.glueController.isWorkspacesEnabled)return;if(!(yield this.workspacesController.handleCheckStarted(void 0,e)))return;const t=(yield this.workspacesController.handleGetPlatformFrameId({},e)).id;return t?this.glueController.getOrCreateWorkspaceFrame({frameId:t}):void 0}))}createFrameWithWorkspaceComponents(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=yield this.glueController.getOrCreateWorkspaceFrame({frameId:t,bounds:e.state.bounds,layoutComponentId:e.state.instanceId});return yield this.glueController.invokeMethod(GlueWorkspaceFrameClientControlName,{operation:"initFrameFromSnapshot",operationArguments:{workspaces:e.state.workspaces,keepWorkspaces:[]}},{windowId:n.id}),n}))}}class LayoutValidator{constructor(e,t){this.glueController=e,this.workspacesController=t}doInitialValidation(e,t){return __awaiter$7(this,void 0,void 0,(function*(){this.validateRequiredApplicationsExistence(e),yield this.validateWorkspaceConfigurationInPlatform(e,t),this.validateNoAppNameAndUrl(e)}))}doFinalValidation(e){return __awaiter$7(this,void 0,void 0,(function*(){this.validateWindowNamesCollision(e),this.validateInstanceIdCollision(e),yield this.validateWorkspaceFramesIdCollisions(e)}))}validateWindowNamesCollision(e){const t=e.components.filter((e=>"window"===e.type&&e.application===defaultNoAppWindowComponentAppName&&!!e.state.createArgs.name)).map((e=>e.state.createArgs.name)),n=this.glueController.getAllWindowNames(),r=t.filter((e=>n.some((t=>e===t))));if(r.length)throw new Error(`Cannot restore layout: ${e.name}, because there are window names collisions: ${r.join(", ")}`)}validateInstanceIdCollision(e){const t=e.components.filter((e=>"window"===e.type&&!!e.state.instanceId)).map((e=>e.state.instanceId)),n=this.glueController.getAllOpenedIds(),r=t.filter((e=>n.some((t=>e===t))));if(r.length)throw new Error(`Cannot restore layout: ${e.name}, because there are instances ids collisions: ${r.join(", ")}`)}validateWorkspaceFramesIdCollisions(e){return __awaiter$7(this,void 0,void 0,(function*(){if(e.components.every((e=>"workspaceFrame"!==e.type)))return;const t=yield this.glueController.getAllOpenedFrameIds(),n=e.components.filter((e=>"workspaceFrame"===e.type)).map((e=>e.state.instanceId)).filter((e=>t.some((t=>e===t))));if(n.length)throw new Error(`Cannot restore layout: ${e.name}, because there are frame ids collisions: ${n.join(", ")}`)}))}validateNoAppNameAndUrl(e){const t=e.components.filter((e=>"window"===e.type&&e.application===defaultNoAppWindowComponentAppName)).filter((e=>!("window"!==e.type||e.state.createArgs.name&&e.state.createArgs.url)));if(!t.length)return;const n=t.map((e=>JSON.stringify(e.state.createArgs))).join(", ");throw new Error(`Cannot restore layout: ${e.name}, because it has window components, which are not defined applications and are missing name or url, provided insufficient createArgs are: ${n}`)}validateRequiredApplicationsExistence(e){const t=this.glueController.getAllApplicationNames(),n=e.components.filter((e=>"window"===e.type&&e.application!==defaultNoAppWindowComponentAppName)).map((e=>e.application));if(n.push(...this.getRequiredAppNamesFromWorkspaceFrameComponents(e)),!n.length)return;const r=n.filter((e=>t.every((t=>t!==e))));if(r.length)throw new Error(`Cannot restore layout: ${e.name}, because some required applications are not registered with this platform: ${r.join(", ")}`)}validateWorkspaceConfigurationInPlatform(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){if(e.components.every((e=>"Workspace"!==e.type||"workspaceFrame"!==e.type)))return;if(!(null===(n=yield this.workspacesController.handleCheckStarted({},t))||void 0===n?void 0:n.started))throw new Error(`Cannot restore layout: ${e.name}, because this platform does not have a valid Workspaces configuration`)}))}getRequiredAppNamesFromWorkspaceFrameComponents(e){const t=[];for(const n of e.components)if("workspaceFrame"===n.type){const e=n.state.workspaces.reduce(((e,t)=>(e.push(...this.getAllAppNamesFromChildren(t.children)),e)),[]);t.push(...e)}return t}getAllAppNamesFromChildren(e){const t=e.filter((e=>"window"===e.type&&!!e.config.appName&&e.config.appName!==defaultNoAppWindowComponentAppName)).map((e=>e.config.appName));for(const n of e)"window"!==n.type&&t.push(...this.getAllAppNamesFromChildren(n.children));return t}}class Resetter{constructor(e,t){this.glueController=e,this.workspacesController=t}get logger(){return logger.get("layouts.resetter")}closeAllExceptCaller(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=this.glueController.getAllOtherNonPlatformWindows(e);yield Promise.all(n.map((e=>__awaiter$7(this,void 0,void 0,(function*(){if(this.glueController.isWorkspacesEnabled){if(yield this.glueController.getWorkspaceWindowById(e.id))return}return e.close()}))))),this.glueController.isWorkspacesEnabled&&(yield this.closeNecessaryWorkspacesFrames(e,t))}))}closeCaller(e,t,n){var r;return __awaiter$7(this,void 0,void 0,(function*(){if("plugin"===e)return;if(yield this.glueController.getWorkspaceWindowById(t))return void(yield this.cleanupWorkspaceCaller(t,n));const i=this.glueController.getWindowById(t);i&&"Platform"!==i.name?yield i.close():null===(r=this.logger)||void 0===r||r.warn("The close caller was missing, is an iframe or is a platform")}))}closeNecessaryWorkspacesFrames(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=(yield this.workspacesController.handleGetPlatformFrameId({},t)).id;let r=yield this.glueController.getAllWorkspacesFrames();n&&(r=r.filter((e=>e.id!==n)),yield this.cleanUpFrameExceptCaller(n,e));const i=yield this.glueController.getWorkspaceWindowById(e);i&&(r=r.filter((e=>e.id!==i.frameId)),yield this.cleanUpFrameExceptCaller(i.frameId,e)),yield Promise.all(r.map((e=>e.close())))}))}cleanUpFrameExceptCaller(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=yield this.glueController.getWorkspacesByFrameId(e),r=n.filter((e=>!e.getWindow((e=>e.id===t)))),i=n.find((e=>e.getWindow((e=>e.id===t))));yield Promise.all(r.map((e=>e.close())));const o=i?i.getAllWindows((e=>e.id!==t)):[];yield Promise.all(o.map((e=>e.close())))}))}cleanupWorkspaceCaller(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=(yield this.workspacesController.handleGetPlatformFrameId({},t)).id,r=yield this.glueController.getWorkspaceWindowById(e);r&&(r.frameId!==n?yield r.frame.close():yield r.workspace.close())}))}}const searchOperationDecoder=oneOf$1(constant$1("operationCheck"));class SearchController{constructor(e,t,n,r){this.glueController=e,this.appsRepo=t,this.layoutsRepo=n,this.workspacesRepo=r,this.started=!1,this.repos=[],this.providerName="Glue42 Core Plus Platform",this.activeQueries={},this.unsubFuncs=[],this.operations={operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)}}}get logger(){return logger.get("notifications.controller")}handlePlatformShutdown(){var e;this.started=!1,this.unsubFuncs.forEach((e=>e())),this.unsubFuncs=[],this.repos=[],this.activeQueries={},null===(e=this.provider)||void 0===e||e.unregister()}configurePostStart(){var e,t,n,r;return __awaiter$7(this,void 0,void 0,(function*(){if(this.repos.push(this.appsRepo),this.repos.push(this.layoutsRepo),!this.glueController.isWorkspacesEnabled)return;this.repos.push(this.workspacesRepo);const i=this.repos.map((e=>({name:e.type,displayName:e.displayType}))),o={name:this.providerName,types:i};if(null===(e=this.logger)||void 0===e||e.trace(`Registering the plus platform as a provider with name: ${o.name} and types: ${JSON.stringify(null===(t=o.types)||void 0===t?void 0:t.join(", "))}.`),this.provider=yield this.glueController.registerProvider(o),!this.provider)throw new Error("The platform was not registered successfully as a provider.");null===(n=this.logger)||void 0===n||n.trace("The platform plus was registered successfully as a provider.");const l=this.provider.onQuery((e=>{this.processQuery(e).then((()=>this.markQueryDone(e))).catch((t=>this.markQueryError(e,t)))})),s=this.provider.onQueryCancel(this.processQueryCancel.bind(this));this.unsubFuncs.push(l),this.unsubFuncs.push(s),this.started=!0,null===(r=this.logger)||void 0===r||r.info("The module started successfully.")}))}start(){var e;return __awaiter$7(this,void 0,void 0,(function*(){null===(e=this.logger)||void 0===e||e.info("Starting the Global Search provider.")}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this search control message, because the controller has not been started");const o=e.data,l=e.commandId,s=searchOperationDecoder.run(e.operation);if(!s.ok)throw new Error(`This search request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Search request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Search request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}processQuery(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.info(`Processing a new query for: ${e.search}`),this.activeQueries[e.id]={allowedResultsCount:(null===(n=e.providerLimits)||void 0===n?void 0:n.maxResults)||Number.MAX_SAFE_INTEGER};const r=e.types?this.repos.filter((t=>{var n;return null===(n=e.types)||void 0===n?void 0:n.some((e=>e.name===t.type))})):this.repos;yield Promise.all(r.map((t=>this.callRepo(t,e))))}))}callRepo(e,t){return __awaiter$7(this,void 0,void 0,(function*(){const n=yield this.getRepoResults(e,t);this.activeQueries[t.id]&&n&&this.sendResults(n,t)}))}getRepoResults(e,t){return __awaiter$7(this,void 0,void 0,(function*(){try{return yield e.getResults(t)}catch(e){return void this.markQueryError(t,e)}}))}sendResults(e,t){var n;try{e.forEach((e=>{this.activeQueries[t.id]&&(this.activeQueries[t.id].allowedResultsCount?(--this.activeQueries[t.id].allowedResultsCount,t.sendResult(e)):this.markQueryDone(t))}))}catch(e){null===(n=this.logger)||void 0===n||n.warn(`Failed sending results for query: ${t.search} with an error: ${extractErrorMsg$1(e)}`)}}markQueryDone(e){var t;this.activeQueries[e.id]&&(null===(t=this.logger)||void 0===t||t.info(`The query for: ${e.search} is completed`),delete this.activeQueries[e.id],e.done())}markQueryError(e,t){var n;this.activeQueries[e.id]&&(null===(n=this.logger)||void 0===n||n.warn(`The query for: ${e.search} ended with an error: ${extractErrorMsg$1(t)}`),delete this.activeQueries[e.id],e.error(extractErrorMsg$1(t)))}processQueryCancel(e){delete this.activeQueries[e.id]}}class ApplicationsRepository{constructor(e){this.glueController=e,this.type="application",this.displayType="Applications"}getResults(e){var t,n;const r=new Set,i={count:Math.min((null===(t=e.providerLimits)||void 0===t?void 0:t.maxResultsPerType)||Number.MAX_SAFE_INTEGER,(null===(n=e.providerLimits)||void 0===n?void 0:n.maxResults)||Number.MAX_SAFE_INTEGER)},o=this.glueController.getAllApplications(),l=o.filter((t=>checkMatch(i,(()=>{var n;return!!(null===(n=t.title)||void 0===n?void 0:n.toLowerCase().includes(e.search.toLowerCase()))}))));if(l.forEach((e=>r.add(e))),!i.count)return Promise.resolve(this.transformApps(r));const s=o.filter((t=>checkMatch(i,(()=>{var n;return!!(null===(n=t.caption)||void 0===n?void 0:n.toLowerCase().includes(e.search.toLowerCase()))}))));if(s.forEach((e=>r.add(e))),!i.count)return Promise.resolve(this.transformApps(r));return o.filter((t=>checkMatch(i,(()=>t.name.toLowerCase().includes(e.search.toLowerCase()))))).forEach((e=>r.add(e))),Promise.resolve(this.transformApps(r))}transformApps(e){const t=[];for(const n of e.values())t.push({type:{name:this.type,displayName:this.displayType},id:n.name,displayName:n.title,description:n.caption,iconURL:n.icon});return t}}class LayoutsRepository{constructor(e){this.glueController=e,this.type="layout",this.displayType="Layouts"}getResults(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){const r=new Set,i={count:Math.min((null===(t=e.providerLimits)||void 0===t?void 0:t.maxResultsPerType)||Number.MAX_SAFE_INTEGER,(null===(n=e.providerLimits)||void 0===n?void 0:n.maxResults)||Number.MAX_SAFE_INTEGER)};return(yield this.glueController.getAllLayoutsSummaries()).filter((t=>checkMatch(i,(()=>t.name.toLowerCase().includes(e.search.toLowerCase()))))).forEach((e=>r.add(e))),this.transformLayouts(r)}))}transformLayouts(e){const t=[];for(const n of e.values())t.push({type:{name:this.type,displayName:this.displayType},id:n.name,displayName:n.name});return t}}class WorkspacesRepository{constructor(e){this.glueController=e,this.type="workspace",this.displayType="Workspaces"}getResults(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){const r=new Set,i={count:Math.min((null===(t=e.providerLimits)||void 0===t?void 0:t.maxResultsPerType)||Number.MAX_SAFE_INTEGER,(null===(n=e.providerLimits)||void 0===n?void 0:n.maxResults)||Number.MAX_SAFE_INTEGER)};return(yield this.glueController.getAllWorkspacesSummaries()).filter((t=>checkMatch(i,(()=>t.name.toLowerCase().includes(e.search.toLowerCase()))))).forEach((e=>r.add(e))),this.transformWorkspaces(r)}))}transformWorkspaces(e){const t=[];for(const n of e.values())t.push({type:{name:this.type,displayName:this.displayType},id:n.name,displayName:n.name});return t}}class LocalStoreController{constructor(){this.defaultGlobalLayoutNamespace="g42_core_plus_default_global_layout",this.themesNamespace="g42_core_plus_themes",this.notificationsNamespace="g42_core_notifications_config",this.username="g42_public",this.localStorage=window.localStorage}start(e){(null==e?void 0:e.username)&&(this.username=e.username);if(!this.localStorage.getItem(this.username)){const e={[this.defaultGlobalLayoutNamespace]:{},[this.themesNamespace]:[]};this.localStorage.setItem(this.username,JSON.stringify(e))}}stop(){this.username="g42_public"}saveThemeIfMissing(e){const t=this.getData(this.themesNamespace)||[];t.some((t=>t.theme.name===e.theme.name))||(t.push(e),this.saveData(this.themesNamespace,t))}getAllThemes(){return this.getData(this.themesNamespace)||[]}markThemeSelected(e,t){const n=this.getData(this.themesNamespace)||[],r=n.find((t=>t.theme.name===e));if(!r)throw new Error(`Cannot mark theme: ${e} as selected, because it doesn't exist`);n.forEach((e=>{e.selected=!1,e.isUserSelected=!1})),r.selected=!0,r.isUserSelected=!!t,this.saveData(this.themesNamespace,n)}getDefaultGlobalLayoutName(){const e=this.getData(this.defaultGlobalLayoutNamespace);return null==e?void 0:e.name}saveDefaultGlobalLayout(e){this.saveData(this.defaultGlobalLayoutNamespace,{name:e})}clearDefaultGlobalLayout(){this.saveData(this.defaultGlobalLayoutNamespace,{})}getNotificationsConfig(){return this.getData(this.notificationsNamespace)}setNotificationsConfig(e){this.saveData(this.notificationsNamespace,e)}updateNotificationsConfig(e){const t=this.getNotificationsConfig();if(!t)throw new Error("Cannot update notifications config, because it doesn't exist");this.setNotificationsConfig(deepMerge(t,e,{arrayMerge:(e,t)=>t}))}getData(e){const t=this.localStorage.getItem(this.username);if(!t)throw new Error(`Cannot get data for namespace: ${e}, because the user data is missing`);return JSON.parse(t)[e]}saveData(e,t){const n=this.localStorage.getItem(this.username);if(!n)throw new Error(`Cannot set data for namespace: ${e}, because the user data is missing`);const r=JSON.parse(n);r[e]=t,this.localStorage.setItem(this.username,JSON.stringify(r))}}const themesOperationDecoder=oneOf$1(constant$1("getCurrent"),constant$1("list"),constant$1("select"),constant$1("operationCheck")),themeDecoder=object$1({displayName:nonEmptyStringDecoder$1,name:nonEmptyStringDecoder$1}),simpleThemeResponseDecoder=object$1({theme:themeDecoder}),allThemesResponseDecoder=object$1({themes:array$1(themeDecoder)}),selectThemeConfigDecoder=object$1({name:nonEmptyStringDecoder$1}),GlueCorePlusThemesStream="T42.Core.Plus.Themes.Stream",lightTheme={name:"light",displayName:"Day"},darkTheme={name:"dark",displayName:"Night"};class ThemesController{constructor(e,t){this.glueController=e,this.localStore=t,this.started=!1,this.operations={getCurrent:{name:"getCurrent",resultDecoder:simpleThemeResponseDecoder,execute:this.handleGetCurrent.bind(this)},list:{name:"list",resultDecoder:allThemesResponseDecoder,execute:this.handleList.bind(this)},select:{name:"select",dataDecoder:selectThemeConfigDecoder,execute:this.handleSelect.bind(this)},operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)}}}get logger(){return logger.get("themes.controller")}start(e){var t,n,r;return __awaiter$7(this,void 0,void 0,(function*(){this.started=!0,this.localStore.saveThemeIfMissing({theme:lightTheme,selected:!1,isUserSelected:!1}),this.localStore.saveThemeIfMissing({theme:darkTheme,selected:!1,isUserSelected:!1}),this.themesStream=yield this.glueController.createSystemStream(GlueCorePlusThemesStream);if(this.localStore.getAllThemes().some((e=>e.isUserSelected)))return;const i="os"===(null===(t=e.themes)||void 0===t?void 0:t.defaultTheme)?this.getOsTheme():"light"===(null===(n=e.themes)||void 0===n?void 0:n.defaultTheme)?"light":"dark";this.localStore.markThemeSelected(i,!1);const o=null===(r=this.localStore.getAllThemes().find((e=>e.selected)))||void 0===r?void 0:r.theme;this.themesStream.push({theme:o})}))}handlePlatformShutdown(){this.started=!1,this.themesStream.close()}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this themes control message, because the controller has not been started");const o=e.data,l=e.commandId,s=themesOperationDecoder.run(e.operation);if(!s.ok)throw new Error(`This themes request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Themes request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Themes request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleClientUnloaded(){}handleGetCurrent(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a getCurrent message`);const e=this.localStore.getAllThemes().find((e=>e.selected));if(!e)throw new Error("No selected theme found!");return{theme:e.theme}}))}handleList(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a list message`);return{themes:this.localStore.getAllThemes().map((e=>e.theme))}}))}handleSelect(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling a select message`),this.localStore.markThemeSelected(e.name,!0);const i=null===(r=this.localStore.getAllThemes().find((e=>e.selected)))||void 0===r?void 0:r.theme;if(!i)throw new Error("No selected theme found!");this.themesStream.push({theme:i})}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}getOsTheme(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}}const managerOperationDecoder=oneOf$1(constant$1("operationCheck")),DEFAULT_RESPONSE_TIMEOUT_MS=1e4;class ManagerController{constructor(e,t,n,r){this.layoutsController=e,this.identity=t,this.session=n,this.buildClient=r,this.started=!1,this.name="Glue42 Server Client",this.operations={operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)}},this.unloadCallback=this.handleUnload.bind(this),window.addEventListener("beforeunload",this.unloadCallback)}get logger(){return logger.get("manager.controller")}callManager(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){return PromiseWrap(e,null!==(r=null===(n=this.config)||void 0===n?void 0:n.responseTimeoutMS)&&void 0!==r?r:DEFAULT_RESPONSE_TIMEOUT_MS,t)}))}get isStarted(){return this.started}get isCritical(){var e,t;return null===(t=null===(e=this.config)||void 0===e?void 0:e.critical)||void 0===t||t}handlePlatformShutdown(){this.started=!1,window.removeEventListener("beforeunload",this.unloadCallback),this.handleUnload(),this.unsubLayouts&&this.unsubLayouts()}configurePostStart(){var e,t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.config)return;const o=null!==(e=this.config.auth.username)&&void 0!==e?e:null===(t=this.config.auth.basic)||void 0===t?void 0:t.username;if(!o)throw new Error("Cannot connect to the Glue42 Server, because no username was provided. Please provide a username in auth.username or auth.basic.username");const l={baseUrl:this.config.url,auth:this.config.auth,headers:this.config.headers};this.client=this.buildClient(l),null===(n=this.logger)||void 0===n||n.trace("The client API is ready.");const s=yield this.identity.getMachineInfo(o),a=this.identity.getGlueInfo();null===(r=this.logger)||void 0===r||r.trace(`Opening a session for machine: ${JSON.stringify(s)} and glue: ${JSON.stringify(a)}`),yield this.session.openSession(this.client,s,a,this.config),this.started=!0,this.unsubLayouts=this.layoutsController.onUserLayoutEvent(this.handleLayoutEvent.bind(this)),null===(i=this.logger)||void 0===i||i.info(`Module ${this.name} started`)}))}start(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){e.manager&&(this.config=e.manager,null===(t=this.logger)||void 0===t||t.info("Starting the Manager controller."))}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this manager control message, because the controller has not been started");const o=e.data,l=e.commandId,s=managerOperationDecoder.run(e.operation);if(!s.ok)throw new Error(`This manager request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Manager request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Manager request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}getDefaultGlobal(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling Get Default Global request`);const r=`Cannot get default global layout from Manager because of timeout (${null===(n=this.config)||void 0===n?void 0:n.responseTimeoutMS} ms)`,i=yield this.callManager((()=>__awaiter$7(this,void 0,void 0,(function*(){var t;const n=yield this.client.getDefaultLayout();return null===(t=this.logger)||void 0===t||t.trace(`[${e}] request completed, default global layout with name ${null==i?void 0:i.name} retrieved from Manager`),n}))),r);return i}))}setDefaultGlobal(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Set Default Global request for name: ${e}`);const o=`Cannot set default global layout in Manager because of timeout (${null===(r=this.config)||void 0===r?void 0:r.responseTimeoutMS} ms)`,l=yield this.getLayoutId(e);l?yield this.callManager((()=>__awaiter$7(this,void 0,void 0,(function*(){var n;yield this.client.setDefaultLayout(l),null===(n=this.logger)||void 0===n||n.trace(`[${t}] request completed, global layout with name ${e} set as default`)}))),o):null===(i=this.logger)||void 0===i||i.trace(`[${t}] layout with name ${e} could not be set as default because it does not exist in Manager`)}))}clearDefaultGlobal(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling Clear Default Global request`);const r=`Cannot clear default global layout in Manager because of timeout (${null===(n=this.config)||void 0===n?void 0:n.responseTimeoutMS} ms)`;yield this.callManager((()=>__awaiter$7(this,void 0,void 0,(function*(){var t;yield this.client.setDefaultLayout(),null===(t=this.logger)||void 0===t||t.trace(`[${e}] request completed, default global layout cleared`)}))),r)}))}saveLayout(e,t){var n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){const o={type:e.type,name:e.name,definition:JSON.stringify(e),default:null!==(n=null==t?void 0:t.default)&&void 0!==n&&n},l=`Cannot save layout with name ${e.name} to Manager because of timeout (${null===(r=this.config)||void 0===r?void 0:r.responseTimeoutMS} ms)`;yield this.callManager((()=>__awaiter$7(this,void 0,void 0,(function*(){yield this.client.saveLayout(o)}))),l),null===(i=this.logger)||void 0===i||i.trace(`Layout with name ${e.name} saved to manager`)}))}getPrefs(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Get Prefs request`);const i=`Cannot get prefs for app ${e} from Manager because of timeout (${null===(r=this.config)||void 0===r?void 0:r.responseTimeoutMS} ms)`;return yield this.callManager((()=>__awaiter$7(this,void 0,void 0,(function*(){var n;const r=(yield this.client.getAllPrefs()).find((t=>t.app===e));return null===(n=this.logger)||void 0===n||n.trace(`[${t}] request completed, prefs for app ${e} retrieved from Manager`),r?this.transformPrefs(r):void 0}))),i)}))}getAllPrefs(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace(`[${e}] handling Get All Prefs request`);const r=`Cannot get all prefs from Manager because of timeout (${null===(n=this.config)||void 0===n?void 0:n.responseTimeoutMS} ms)`;return yield this.callManager((()=>__awaiter$7(this,void 0,void 0,(function*(){var t;const n=yield this.client.getAllPrefs();return null===(t=this.logger)||void 0===t||t.trace(`[${e}] request completed, all prefs retrieved from Manager`),n.map(this.transformPrefs)}))),r)}))}setPrefs(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Set Prefs request`);const i=`Cannot set prefs for app ${e.app} in Manager because of timeout (${null===(r=this.config)||void 0===r?void 0:r.responseTimeoutMS} ms)`;yield this.callManager((()=>__awaiter$7(this,void 0,void 0,(function*(){var n;yield this.client.setPrefs({app:e.app,data:e.data,merge:!1}),null===(n=this.logger)||void 0===n||n.trace(`[${t}] request completed, prefs for app ${e.app} set in Manager`)}))),i)}))}clearAllPrefs(e,t){var n,r;return __awaiter$7(this,void 0,void 0,(function*(){null===(n=this.logger)||void 0===n||n.trace(`[${t}] handling Clear All Prefs request`),yield Promise.all(e.map((e=>this.setPrefs({app:e,data:{}},t)))),null===(r=this.logger)||void 0===r||r.trace(`[${t}] request completed, all prefs cleared`)}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}handleLayoutRemoved(e){var t,n;return __awaiter$7(this,void 0,void 0,(function*(){const r=yield this.getLayoutId(e);r?(yield this.client.deleteUserLayout(r).catch((e=>{var t;return null===(t=this.logger)||void 0===t?void 0:t.warn(extractErrorMsg$1(e))})),null===(n=this.logger)||void 0===n||n.trace(`Deleted layout ${e}`)):null===(t=this.logger)||void 0===t||t.trace(`Layout with name ${e} could not be removed because it does not exist in Manager.`)}))}handleLayoutAdded(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){try{yield this.saveLayout(e)}catch(e){null===(t=this.logger)||void 0===t||t.warn(extractErrorMsg$1(e))}}))}handleLayoutEvent(e){return __awaiter$7(this,void 0,void 0,(function*(){"layoutRemoved"!==e.operation?yield this.handleLayoutAdded(e.layout):yield this.handleLayoutRemoved(e.layout.name)}))}getLayoutId(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){const n=`Cannot get layout id from Manager because of timeout (${null===(t=this.config)||void 0===t?void 0:t.responseTimeoutMS} ms)`;return this.callManager((()=>__awaiter$7(this,void 0,void 0,(function*(){var t;return null===(t=(yield this.client.getLayouts()).find((t=>t.name===e)))||void 0===t?void 0:t.id}))),n)}))}handleUnload(){this.client&&this.client.unload()}transformPrefs({app:e,data:t,lastUpdate:n}){return{app:e,data:t,lastUpdate:n}}}class Identity{constructor(e,t,n,r){this.uaParser=e,this.glueController=t,this.pluginsController=n,this.workspacesFrameUrl=r}getMachineInfo(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){const n=this.uaParser.getResult(),r={name:n.os.name||"",version:n.os.version||"",arch:n.cpu.architecture||""},i={name:n.browser.name,version:n.browser.version,engine:n.engine.name},o="mobile"===(null===(t=n.device)||void 0===t?void 0:t.type)?{vendor:n.device.vendor,model:n.device.model}:void 0,l=yield this.getDisplays();return{user:e,name:"",os:r,browser:i,mobileDevice:o,displays:l}}))}getGlueInfo(){var e;return{version:"",build:"",region:"",env:"",core:{web:{version:this.glueController.clientGlue.version},platform:{version:this.glueController.platformVersion,plugins:this.pluginsController.registeredPlugins},plus:{version:version}},workspaces:this.glueController.isWorkspacesEnabled?{version:null===(e=this.glueController.clientGlue.workspaces)||void 0===e?void 0:e.version,frameUrl:this.workspacesFrameUrl}:void 0}}getDisplays(){return __awaiter$7(this,void 0,void 0,(function*(){const{state:e}=yield navigator.permissions.query({name:"window-placement"});if("granted"!==e)return[];return(yield window.getScreenDetails()).screens.map((e=>({bounds:{x:e.left,y:e.top,width:e.width,height:e.height},workingArea:{x:e.availLeft,y:e.availTop,width:e.availWidth,height:e.availHeight},dpi:e.devicePixelRatio,isPrimary:e.isPrimary})))}))}}const defaultDataRefreshIntervalMS=6e4,defaultTokenRefreshIntervalMS=36e5;class Session{constructor(e,t){this.glueController=e,this.layoutsController=t,this.sessionInitiated=!1}get logger(){return logger.get("manager.session")}openSession(e,t,n,r){var i,o,l;return __awaiter$7(this,void 0,void 0,(function*(){if(this.sessionInitiated)throw new Error("A server session has already been initiated");this.serverConfig=r,this.client=e,this.sessionInitiated=!0;const s=yield this.client.openSession(t,n);null===(i=this.logger)||void 0===i||i.trace("The client session has been opened successfully"),this.token=s.token,yield this.updateApplications(null===(o=s.data)||void 0===o?void 0:o.applications),yield this.updateLayouts(null===(l=s.data)||void 0===l?void 0:l.layouts),this.refreshData().catch((e=>{var t;null===(t=this.logger)||void 0===t||t.warn(`Error while fetching server snapshot: ${JSON.stringify(e)}`)})),this.refreshToken().catch((e=>{var t;null===(t=this.logger)||void 0===t||t.warn(`Error while refreshing the server token: ${JSON.stringify(e)}`)}))}))}closeSession(){return __awaiter$7(this,void 0,void 0,(function*(){this.sessionInitiated=!1,yield this.client.closeSession()}))}refreshData(){var e,t,n,r,i,o;return __awaiter$7(this,void 0,void 0,(function*(){if(this.sessionInitiated){yield this.waitInterval((null===(e=this.serverConfig)||void 0===e?void 0:e.fetchIntervalMS)||defaultDataRefreshIntervalMS);try{null===(t=this.logger)||void 0===t||t.trace("Sending a fresh snapshot request");const e=yield this.client.refreshData({applications:{include:!0,latestDataInfo:null===(n=this.lastApps)||void 0===n?void 0:n.info},layouts:{include:!0,latestDataInfo:null===(r=this.lastLayouts)||void 0===r?void 0:r.info},commands:{include:!1}});null===(i=this.logger)||void 0===i||i.trace("Got a snapshot response, processing the applications and layouts"),yield this.updateApplications(e.applications),yield this.updateLayouts(e.layouts)}catch(e){const t="string"==typeof e?e:JSON.stringify(e.message);null===(o=this.logger)||void 0===o||o.warn(`An error occurred while refreshing the server snapshot: ${t}`)}finally{this.refreshData()}}}))}refreshToken(){var e,t,n,r;return __awaiter$7(this,void 0,void 0,(function*(){if(this.sessionInitiated){yield this.waitInterval((null===(e=this.serverConfig)||void 0===e?void 0:e.tokenRefreshIntervalMS)||defaultTokenRefreshIntervalMS);try{null===(t=this.logger)||void 0===t||t.trace("Sending a fresh token refresh request");const e=yield this.client.refreshToken();this.token=e,null===(n=this.logger)||void 0===n||n.trace("Server token refreshed successfully")}catch(e){const t="string"==typeof e?e:JSON.stringify(e.message);null===(r=this.logger)||void 0===r||r.warn(`An error occurred while refreshing the server token: ${t}`)}finally{this.refreshToken()}}}))}waitInterval(e){return new Promise((t=>setTimeout(t,e)))}updateApplications(e){return __awaiter$7(this,void 0,void 0,(function*(){e&&e.hasChanges&&(this.lastApps=e,yield this.glueController.processServerApplicationsData(e))}))}updateLayouts(e){return __awaiter$7(this,void 0,void 0,(function*(){e&&e.hasChanges&&(this.lastLayouts=e,yield this.processServerLayoutsData(e))}))}processServerLayoutsData(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){if(!e||!e.data)return;const n=e.data.map((e=>"string"==typeof e.definition?JSON.parse(e.definition):e.definition));try{const e=this.sanitizeLayouts(n),t=n.filter((t=>e.valid.some((e=>e.name===t.name))));yield this.layoutsController.handleImport({layouts:t,mode:"merge",isManagerOperation:!0},"ManagerOperation")}catch(e){const n=extractErrorMsg$1(e);null===(t=this.logger)||void 0===t||t.warn(`An error importing layouts: ${n}`)}}))}sanitizeLayouts(e){return e.reduce(((e,t)=>{var n;const r=glueLayoutDecoder.run(t);return r.ok?e.valid.push(t):null===(n=this.logger)||void 0===n||n.warn(`A layout with name: ${t.name} was not imported, because of error: ${JSON.stringify(r.error)}`),e}),{valid:[]})}}const prefsOperationTypesDecoder=oneOf$1(constant$1("operationCheck"),constant$1("clear"),constant$1("clearAll"),constant$1("get"),constant$1("getAll"),constant$1("set"),constant$1("update"),constant$1("prefsHello")),appPreferencesDecoder=object$1({app:nonEmptyStringDecoder$1,data:object$1(),lastUpdate:optional$1(nonEmptyStringDecoder$1)}),basePrefsConfigDecoder=object$1({app:nonEmptyStringDecoder$1}),getPrefsResultDecoder=object$1({prefs:appPreferencesDecoder}),getAllPrefsResultDecoder=object$1({all:array$1(appPreferencesDecoder)}),changePrefsDataDecoder=object$1({app:nonEmptyStringDecoder$1,data:object$1()}),prefsHelloSuccessDecoder=object$1({platform:object$1({app:nonEmptyStringDecoder$1})});class PrefsController{constructor(e,t,n){this.glueController=e,this.idbController=t,this.managerController=n,this.operations={operationCheck:{name:"operationCheck",dataDecoder:operationCheckConfigDecoder,resultDecoder:operationCheckResultDecoder,execute:this.handleOperationCheck.bind(this)},clear:{name:"clear",execute:this.clear.bind(this),dataDecoder:basePrefsConfigDecoder},clearAll:{name:"clearAll",execute:this.clearAll.bind(this)},get:{name:"get",execute:this.get.bind(this),dataDecoder:basePrefsConfigDecoder,resultDecoder:getPrefsResultDecoder},getAll:{name:"getAll",execute:this.getAll.bind(this),resultDecoder:getAllPrefsResultDecoder},set:{name:"set",execute:this.set.bind(this),dataDecoder:changePrefsDataDecoder},update:{name:"update",execute:this.update.bind(this),dataDecoder:changePrefsDataDecoder},prefsHello:{name:"prefsHello",execute:this.prefsHello.bind(this),resultDecoder:prefsHelloSuccessDecoder}},this.started=!1,this.platformAppName=`Platform-${window.location.origin}`}get logger(){return logger.get("prefs.controller")}get shouldUseManager(){var e,t;return this.managerController.isStarted&&"local"!==(null===(t=null===(e=this.config)||void 0===e?void 0:e.store)||void 0===t?void 0:t.type)}handlePlatformShutdown(){this.started=!1}start(e){var t,n,r,i,o;return __awaiter$7(this,void 0,void 0,(function*(){null===(t=this.logger)||void 0===t||t.trace("initializing prefs"),this.started=!0,this.config=e.applicationPreferences,"manager"!==(null===(r=null===(n=this.config)||void 0===n?void 0:n.store)||void 0===r?void 0:r.type)||e.manager||null===(i=this.logger)||void 0===i||i.warn("Prefs store type is set to 'manager', but ioManager is not started"),null===(o=this.logger)||void 0===o||o.trace("initialization is completed")}))}handleControl(e){var t,n,r,i;return __awaiter$7(this,void 0,void 0,(function*(){if(!this.started)throw new Error("Cannot handle this prefs control message, because the controller has not been started");const o=e.data,l=e.commandId,s=prefsOperationTypesDecoder.run(e.operation);if(!s.ok)throw new Error(`This prefs request cannot be completed, because the operation name did not pass validation: ${JSON.stringify(s.error)}`);const a=s.result,u=null===(t=this.operations[a].dataDecoder)||void 0===t?void 0:t.run(o);if(u&&!u.ok)throw new Error(`Prefs request for ${a} rejected, because the provided arguments did not pass the validation: ${JSON.stringify(u.error)}`);null===(n=this.logger)||void 0===n||n.debug(`[${l}] ${a} command is valid with data: ${JSON.stringify(o)}`);const c=yield this.operations[a].execute(o,l),h=null===(r=this.operations[a].resultDecoder)||void 0===r?void 0:r.run(c);if(h&&!h.ok)throw new Error(`Prefs request for ${a} could not be completed, because the operation result did not pass the validation: ${JSON.stringify(h.error)}`);return null===(i=this.logger)||void 0===i||i.trace(`[${l}] ${a} command was executed successfully`),c}))}handleOperationCheck(e){return __awaiter$7(this,void 0,void 0,(function*(){return{isSupported:Object.keys(this.operations).some((t=>t.toLowerCase()===e.operation.toLowerCase()))}}))}clear({app:e},t){return __awaiter$7(this,void 0,void 0,(function*(){this.trace(`[${t}] handling clear command with app: ${e}`,t);const n=this.validateApp(e),r=yield this.idbController.setPrefs({app:n,data:{},lastUpdate:this.getLastUpdateTimestamp()});yield this.callManagerIfApplicable((()=>this.managerController.setPrefs(r,t))),this.emitStreamData("prefsChanged",{prefs:r})}))}clearAll(e,t){return __awaiter$7(this,void 0,void 0,(function*(){this.trace(`[${t}] handling clearAll command`,t);const e=yield this.idbController.clearAllPrefs(this.getLastUpdateTimestamp());yield this.callManagerIfApplicable((()=>this.managerController.clearAllPrefs(e.map((({app:e})=>e)),t))),e.forEach((e=>this.emitStreamData("prefsChanged",{prefs:e})))}))}get({app:e},t){var n;return __awaiter$7(this,void 0,void 0,(function*(){this.trace(`[${t}] handling get command with app: ${e}`,t);const r={app:e,data:{}};if(!this.shouldUseManager){return{prefs:(yield this.idbController.getPrefs(e))||r}}let i;try{i=yield this.managerController.getPrefs(e,t)}catch(t){null===(n=this.logger)||void 0===n||n.warn(extractErrorMsg$1(t));return{prefs:(yield this.idbController.getPrefs(e))||r}}return i?(yield this.idbController.setPrefs(i),{prefs:i}):(yield this.idbController.deletePrefs(e),{prefs:r})}))}getAll(e,t){var n;return __awaiter$7(this,void 0,void 0,(function*(){if(this.trace(`[${t}] handling getAll command`,t),!this.shouldUseManager){return{all:yield this.idbController.getAllPrefs()}}let e;try{e=yield this.managerController.getAllPrefs(t)}catch(e){null===(n=this.logger)||void 0===n||n.warn(extractErrorMsg$1(e));return{all:yield this.idbController.getAllPrefs()}}return yield this.idbController.replaceAllPrefs(e),{all:e}}))}set({app:e,data:t},n){return __awaiter$7(this,void 0,void 0,(function*(){this.trace(`[${n}] handling set command with app: ${e} and data: ${JSON.stringify(t)}`,n);const r=this.validateApp(e),i=yield this.idbController.setPrefs({app:r,data:t,lastUpdate:this.getLastUpdateTimestamp()});yield this.callManagerIfApplicable((()=>this.managerController.setPrefs(i,n))),this.emitStreamData("prefsChanged",{prefs:i})}))}update({app:e,data:t},n){return __awaiter$7(this,void 0,void 0,(function*(){this.trace(`[${n}] handling update command with app: ${e} and data: ${JSON.stringify(t)}`,n);const r=this.validateApp(e),i=yield this.idbController.updatePrefs({app:r,data:t,lastUpdate:this.getLastUpdateTimestamp()});yield this.callManagerIfApplicable((()=>this.managerController.setPrefs(i,n))),this.emitStreamData("prefsChanged",{prefs:i})}))}prefsHello(){return __awaiter$7(this,void 0,void 0,(function*(){return{platform:{app:this.platformAppName}}}))}getLastUpdateTimestamp(){return(new Date).toISOString()}callManagerIfApplicable(e){var t;return __awaiter$7(this,void 0,void 0,(function*(){if(this.shouldUseManager)try{yield e()}catch(e){null===(t=this.logger)||void 0===t||t.warn(extractErrorMsg$1(e))}}))}validateApp(e){const t=this.glueController.getAllApplicationNames();if(!(e===this.platformAppName||t.includes(e)))throw new Error(`The provided app name "${e}" is not valid.`);return e}trace(e,t){var n;t&&(null===(n=this.logger)||void 0===n||n.trace(e))}emitStreamData(e,t){var n;null===(n=this.logger)||void 0===n||n.trace(`sending notification of event: ${e} with data: ${JSON.stringify(t)}`),this.glueController.pushSystemMessage("prefs",e,t)}}class IoC{constructor(e){this.config=e}get gateway(){return this._gatewayInstance||(this._gatewayInstance=new Gateway),this._gatewayInstance}get platform(){return this._platformInstance||(this._platformInstance=new Platform(this.controller,this.sessionController,this.localStorageController,this.config)),this._platformInstance}get domainsController(){return this._domainsController||(this._domainsController=new DomainsController(this.systemController,this.windowsController,this.applicationsController,this.layoutsController,this.workspacesController,this.intentsController,this.channelsController,this.notificationsController,this.extensionController,this.searchController,this.themesController,this.managerController,this.prefsController)),this._domainsController}get controller(){return this._mainController||(this._mainController=new PlatformController(this.domainsController,this.glueController,this.portsBridge,this.stateController,this.serviceWorkerController,this.preferredConnectionController,this.interceptionController,this.pluginsController,this.sessionController,this.licenseController,this.localStorageController,this.idbController)),this._mainController}get glueController(){return this._glueController||(this._glueController=new GlueController(this.portsBridge,this.sessionController)),this._glueController}get systemController(){return this._systemController||(this._systemController=new SystemController(this.sessionController)),this._systemController}get searchController(){return this._searchController||(this._searchController=new SearchController(this.glueController,this.appsSearchRepo,this.layoutsSearchRepo,this.workspacesSearchRepo)),this._searchController}get themesController(){return this._themesController||(this._themesController=new ThemesController(this.glueController,this.localStorageController)),this._themesController}get sessionController(){return this._sessionController||(this._sessionController=new SessionStorageController),this._sessionController}get localStorageController(){return this._localStorageController||(this._localStorageController=new LocalStoreController),this._localStorageController}get stateController(){return this._stateChecker||(this._stateChecker=new WindowsStateController(this.sessionController)),this._stateChecker}get windowsController(){return this._windowsController||(this._windowsController=new WindowsController(this.glueController,this.sessionController,this.stateController,this)),this._windowsController}get applicationsController(){return this._applicationsController||(this._applicationsController=new ApplicationsController(this.glueController,this.sessionController,this.stateController,this.appDirectory,this)),this._applicationsController}get appDirectory(){return this._appDirectory||(this._appDirectory=new AppDirectory(this.sessionController,this.remoteWatcher)),this._appDirectory}get remoteWatcher(){return this._remoteWatcher||(this._remoteWatcher=new RemoteWatcher),this._remoteWatcher}get licenseController(){return this._licenseController||(this._licenseController=new LicenseController),this._licenseController}get layoutsController(){return this._layoutsController||(this._layoutsController=new LayoutsController(this.glueController,this.idbController,this.sessionController,this.localStorageController,this.layoutsBuilder,this.layoutsRestorer,CallbackRegistryFactory(),this.getManager.bind(this))),this._layoutsController}get workspacesController(){return this._workspacesController||(this._workspacesController=new WorkspacesController(this.framesController,this.glueController,this.stateController,this.hibernationWatcher,this)),this._workspacesController}get hibernationWatcher(){return this._hibernationWatcher||(this._hibernationWatcher=new WorkspaceHibernationWatcher(this.sessionController,this.createSequelizer())),this._hibernationWatcher}get intentsController(){return this._intentsController||(this._intentsController=new IntentsController(this.glueController,this.intentsResolverHelper,this.appDirectory,this)),this._intentsController}get intentsResolverHelper(){return this._intentsResolverController||(this._intentsResolverController=new IntentsResolverHelper(this.glueController,this.workspacesController,this.windowsController)),this._intentsResolverController}get channelsController(){return this._channelsController||(this._channelsController=new ChannelsController(this.glueController)),this._channelsController}get extensionController(){return this._extensionController||(this._extensionController=new ExtensionController(this.sessionController)),this._extensionController}get layoutsBuilder(){return this._layoutsBuilder||(this._layoutsBuilder=new Builder(this.glueController,this.sessionController,this.windowsController,this.workspacesController)),this._layoutsBuilder}get layoutsRestorer(){return this._layoutsRestorer||(this._layoutsRestorer=new Restorer(this.glueController,this.layoutsValidator,this.layoutsResetter,this.workspacesController)),this._layoutsRestorer}get layoutsValidator(){return this._layoutsValidator||(this._layoutsValidator=new LayoutValidator(this.glueController,this.workspacesController)),this._layoutsValidator}get layoutsResetter(){return this._layoutsResetter||(this._layoutsResetter=new Resetter(this.glueController,this.workspacesController)),this._layoutsResetter}get notificationsController(){return this._notificationsController||(this._notificationsController=new NotificationsController(this.glueController,this.serviceWorkerController,this.sessionController,this.localStorageController)),this._notificationsController}get framesController(){return this._framesController||(this._framesController=new FramesController(this.sessionController,this.glueController,this)),this._framesController}get idbController(){return this._idbController||(this._idbController=new IDBController),this._idbController}get portsBridge(){return this._portsBridge||(this._portsBridge=new PortsBridge(this.gateway,this.sessionController,this)),this._portsBridge}get serviceWorkerController(){return this._serviceWorkerController||(this._serviceWorkerController=new ServiceWorkerController(this.idbController)),this._serviceWorkerController}get transactionsController(){return this._transactionsController||(this._transactionsController=new TransactionsController),this._transactionsController}get interceptionController(){return this._interceptionController||(this._interceptionController=new InterceptionController),this._interceptionController}get pluginsController(){return this._pluginsController||(this._pluginsController=new PluginsController(this.interceptionController,this.glueController)),this._pluginsController}get appsSearchRepo(){return this._appsSearchRepo||(this._appsSearchRepo=new ApplicationsRepository(this.glueController)),this._appsSearchRepo}get managerController(){return this._managerController||(this._managerController=new ManagerController(this.layoutsController,this.managerIdentity,this.managerSession,this.buildClient.bind(this))),this._managerController}get managerIdentity(){var e,t;return this._managerIdentity||(this._managerIdentity=new Identity(new uaParserExports.UAParser,this.glueController,this.pluginsController,null===(t=null===(e=this.config)||void 0===e?void 0:e.workspaces)||void 0===t?void 0:t.src)),this._managerIdentity}get managerSession(){return this._managerSession||(this._managerSession=new Session(this.glueController,this.layoutsController)),this._managerSession}get layoutsSearchRepo(){return this._layoutsSearchRepo||(this._layoutsSearchRepo=new LayoutsRepository(this.glueController)),this._layoutsSearchRepo}get workspacesSearchRepo(){return this._workspacesSearchRepo||(this._workspacesSearchRepo=new WorkspacesRepository(this.glueController)),this._workspacesSearchRepo}get preferredConnectionController(){return this._preferredConnectionController||(this._preferredConnectionController=new PreferredConnectionController(this.glueController,this.portsBridge,this.createSequelizer())),this._preferredConnectionController}get prefsController(){return this._prefsController||(this._prefsController=new PrefsController(this.glueController,this.idbController,this.managerController)),this._prefsController}createMessageChannel(){return new MessageChannel}createSequelizer(e){return new AsyncSequelizer(e)}buildClient(e){return new client$1.ClientAPI(e)}getManager(){return this.managerController}}const ioConnectBrowserPlatformFactory=e=>__awaiter$7(void 0,void 0,void 0,(function*(){var t;if(window.glue42gd||window.iodesktop)return fallbackToEnterprise(e);const n=!(null===(t=e.connection)||void 0===t?void 0:t.alwaysPlatform)&&(yield checkIsOpenerIOConnect(null==e?void 0:e.connection)),r=checkIfPlacedInWorkspace();if((null==e?void 0:e.clientOnly)||n||r){return{io:(null==e?void 0:e.browserFactory)?yield null==e?void 0:e.browserFactory(null==e?void 0:e.browser):yield iOConnectBrowserFactory(null==e?void 0:e.browser)}}const i=new IoC(e);yield i.platform.ready();return{io:i.platform.getClientGlue(),platform:null==i?void 0:i.platform.getPlatformApi()}}));"undefined"!=typeof window&&(window.IOBrowserPlatform=ioConnectBrowserPlatformFactory);const legacyGlobal=window.glue42gd||window.glue42core,ioGlobal=window.iodesktop||window.iobrowser;return legacyGlobal||ioGlobal||(window.iobrowser={webStarted:!1}),ioConnectBrowserPlatformFactory}));
//# sourceMappingURL=browser.platform.umd.js.map
